Sun Jul 10 22:50:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (rmpd_power_by_big_decimal): fix
	  precision treatment errors.

	* test/bigdecimal/test_bigdecimal.rb: add tests for the above change.
	  fix precision treatment errors.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_power): precision argument
	  should be optional for its compatibility.

Sun Jul 10 22:38:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (var_ref): distinguish vcall from local variable
	  references.  based on a patch by Michael Edgar michael.j.edgar
	  AT dartmouth.edu.  Bug #5002

Sun Jul 10 21:51:29 2011  Koichi Sasada  <ko1@atdot.net>

	* internal.h: add comments (cautions).

Sun Jul 10 20:59:38 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add new class variable `@@testfile_prefix`.
	  This is for changing test name prefix. (For testing)

	* test/testunit/tests_for_parallel/ptest_first.rb: Renamed from
	  test_first.rb

	* test/testunit/tests_for_parallel/ptest_second.rb: Renamed from
	  test_second.rb

	* test/testunit/tests_for_parallel/ptest_third.rb: Renamed from
	  test_third.rb

	* test/testunit/tests_for_parallel/ptest_forth.rb: Renamed from
	  test_forth.rb

	* test/testunit/tests_for_parallel/runner.rb: Remove misc.rb

	* test/testunit/tests_for_parallel/ptest_first.rb: ditto.

	* test/testunit/tests_for_parallel/ptest_second.rb: ditto.

	* test/testunit/tests_for_parallel/ptest_third.rb: ditto.

	* test/testunit/tests_for_parallel/ptest_forth.rb: ditto.

	* test/testunit/tests_for_parallel/misc.rb: Removed because no longer
	  needed.

	* test/testunit/test_parallel.rb: Fix assertions for above.

Sun Jul 10 16:57:08 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_throw): check a class frame.
	  Fixes Bug #4648.
	  The patch is contributed by Kazuki Tsujimoto.

	* bootstraptest/test_proc.rb: add tests for above.

Sun Jul 10 17:28:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (mutex_debug): use exit(EXIT_FAILURE) instead of
	  exit(1).
	* thread_pthread.c (add_signal_thread_list): ditto.
	* thread.c (rb_thread_call_with_gvl): ditto.
	* util.c (Bug): ditto.

Sun Jul 10 15:58:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Merge json gem 1.5.4+ (f7f78896607b6f6226cd).
	  [Bug #4700]

Sun Jul 10 16:41:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (typedef struct rb_vm_struct): create a new
	  'inhibit_thread_creation' field.
	* thread.c (rb_thread_terminate_all): set inhibit_thread_creation.
	* thread.c (thread_s_new): don't permit to create new thread
	  if the VM is under destruction. Otherwise evil finalizer code
	  can make SEGV. [Bug #4992][ruby-core:37858]

	* bootstraptest/test_objectspace.rb: new test for this fix.

Sun Jul 10 16:06:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sigsegv): use abort() instead of exit() when nested
	  SEGV was happen. Because unnested SEGV use abort().
	  [Bug #5013][ruby-dev:44078]

Sun Jul 10 15:30:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* load.c (rb_f_autoload): prevent to autoload for singleton
	  classes.  fixes [Bug #4886] [ruby-dev:43816]

	* bootstraptest/test_autoload.rb: add tests for the above change.

Sun Jul 10 15:09:17 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/assertions.rb: Import documentation patch by Justin
	  Collins. [ruby-core:37225] [Feature #4903]

Sun Jul 10 14:57:36 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: canonicalizes nth and sf.

Sun Jul 10 14:13:50 2011  Koichi Sasada  <ko1@atdot.net>

	* internal.h (rb_thread_call_with_gvl, rb_thread_call_without_gvl):
	  make them visible as experimental C APIs.  fixes Feature #4328.

Sun Jul 10 12:18:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_power): support non-integral
	  exponent.  fixes [Bug #3271]

	* ext/bigdecimal/bigdecimal.c (rmpd_power_by_big_decimal): ditto.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_power_op): add a function to
	  only use for "**" operator.

	* test/bigdecimal/test_bigdecimal.rb: add a bunch of tests for the
	  above changes.

	* ext/bigdecimal/bigdecimal.c (is_integer): add an utility function.

	* ext/bigdecimal/bigdecimal.c (is_negative): ditto.

	* ext/bigdecimal/bigdecimal.c (is_positive): ditto.

	* ext/bigdecimal/bigdecimal.c (is_zero): ditto.

	* ext/bigdecimal/bigdecimal.c (is_one): ditto.

	* ext/bigdecimal/bigdecimal.c (is_even): ditto.

Sun Jul 10 12:08:39 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (when_vals): when a string literal is written on when
	  clause, skip string creation to make it faster.  [ruby-dev:44068]
	  [Feature #5000]

Sun Jul 10 11:35:29 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (reduce_nodes_gen): NODE_RETURN in rescue body must not be
	  reduced when there is an else clause.  This caused bizarre behavior
	  in [Bug #4473] [ruby-core:35629] [ruby-core:37884].

Sun Jul 10 09:46:14 2011  Masaya Tarui  <tarui@ruby-lnag.org>

	* range.c (range_max): fix behavior with excluded end value.
	  [Bug #4591]

Sun Jul 10 09:13:18 2011  Eric Hodel  <drbrain@segment7.net>

	* NEWS:  Fix RubyGems version.  [Ruby 1.9 - Bug #5004]

Sat Jul  9 20:01:59 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* internal.h: rb_rational_reciprocal is defined in rational.c.

Sat Jul  9 19:48:31 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* internal.h: added declarations.
	* complex.c: followed the above change.

Sat Jul  9 17:24:41 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* NEWS: bigdecimal is not a builtin.

Sat Jul  9 17:17:53 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: some improvements for performance.

Sat Jul  9 16:56:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* atomic.h (ATOMIC_OR): _InterlockedOr is unavailable in VC6.

	* numeric.c (ULLONG_MAX): fallback definition.

Sat Jul  9 15:59:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_{read,write}): should be signed.
	  Bug #5001

Sat Jul  9 14:02:20 2011  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb: fix multipart form parsing bug. [Bug #3866]

Sat Jul  9 11:41:03 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Add Vector#normalize [ruby-dev:43829]

Sat Jul  9 09:25:06 2011  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c:  Remove "enumeration sequenced by".
	  [Ruby 1.9 - Bug #4757]

Sat Jul  9 09:14:56 2011  Eric Hodel  <drbrain@segment7.net>

	* io.c:  Note that methods other than IO#gets may increase IO#lineno.
	  [Ruby 1.9 - Bug #4902]

Sat Jul  9 08:39:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RUN_OPT): disable gems.

Sat Jul  9 08:37:05 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_close): close(2) on a fd which is being read by
	  another thread causes deadlock on Mac OS X 10.5

Fri Jul  8 21:20:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: use USE_ELF instead of __ELF__ because Solaris
	  doesn't define it. USE_ELF is already provided by configure.
	  patched by Naohisa Goto. [ruby-dev:44066] [Bug #4998]

	* addr2line.h: ditto.

	* vm_dump.c: ditto.

Fri Jul  8 16:40:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/parser/parser.rl (convert_encoding): should not modify
	  the argument.

	* ext/json/parser/parser.rl (convert_encoding): no needs to use
	  force_encoding.

Fri Jul  8 15:53:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_bug): get rid of segfault after all threads
	  disposed.

Fri Jul  8 15:01:06 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl.h: include openssl/e_os2.h before checking the
	  definition of OPENSSL_SYS_WIN32.

Fri Jul  8 14:40:39 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (wunlink): reverted a part of r32426. it was mistakenly
	  mixed.

Fri Jul  8 14:29:47 2011  Narihiro Nakamura  <authornari@gmail.com>

	* configure.in: can't subtract void *.

Fri Jul  8 14:33:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): define GC_MARK_STACKFRAME_WORD.
	  fixed build problem of r32438.  the value (30) is temporary value.
	  maybe it's enough by 20~24 according to my observation.

Fri Jul  8 13:47:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_unlock_all): folded into
	  rb_threadptr_unlock_all_locking_mutexes.
	* thread.c (rb_threadptr_unlock_all_locking_mutexes) ditto.

Fri Jul  8 13:36:02 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_unlock_all_locking_mutexes): rename to
	  rb_threadptr_unlock_all_locking_mutexes and remove static.
	* vm_core.h: add rb_threadptr_unlock_all_locking_mutexes declaration.
	* thread.c (thread_start_func_2): adjust the above rename.

	* eval.c (ruby_cleanup): call rb_threadptr_unlock_all_locking_mutexes
	  again after finalizer. [Bug #4988] [ruby-dev:44049]

Fri Jul  8 13:06:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (FIBER_MACHINE_STACK_ALLOCATION_SIZE): Fiber stack size
	  don't need to keep multiple number of sizeof(VALUE).

Fri Jul  8 11:39:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (sudo-precheck): true command is not standard on
	  Windows.

Fri Jul  8 10:39:52 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_destroy): fix cond_t leak.

Fri Jul  8 09:17:59 2011  Eric Hodel  <drbrain@segment7.net>

	* gc.c:  Improve documentation

Thu Jul  7 23:35:31 2011  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: change water_mark value that may call
	  gc_mark(lev <= GC_LEVEL_MAX) in gc_mark().
	  In ruby_stack_check(), water_mark is a value that may call some
	  C function. Fixes Bug #3781

	* configure.in: define GC_MARK_STACKFRAME_WORD that approximate
	  size of gc_mark() and gc_mark_children() stackframes.

Thu Jul  7 17:55:05 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/testunit/test_parallel.rb (TestParallelWorker#teardown): wait
	  the child process even if the communication pipe is broken.

Thu Jul  7 15:44:42 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_set_index, rb_enc_associate_index): should
	  check if frozen.

	* parse.y (rb_intern3), ruby.c (process_options, ruby_script):
	  defer freezing after associating encodings.

Thu Jul  7 15:16:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num2ull): use own switch sentence.
	  Current implementation can't convert 18446744073709551615.

Thu Jul  7 06:56:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (FIBER_STACK_FLAGS): workaround fix for r32420 on FreeBSD.

Thu Jul  7 06:46:12 2011  Eric Hodel  <drbrain@segment7.net>

	* benchmark/driver.rb:  Add difference column to report that averages
	  across all runs of a benchmark.  [Ruby 1.9 - Feature #4982]

Thu Jul  7 06:19:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems.rb:  Reduce requires to improve `make benchmark`.
	  [#4962]
	* lib/rubygems/specification.rb:  Delay initialization of rubygems
	  until require is called.

Thu Jul  7 04:31:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (arg): rescue_mod is in inverse order from other
	  modifiers.  patched by michael.j.edgar AT dartmouth.edu at
	  [ruby-core:36248].  fixed #4716.

Thu Jul  7 00:40:16 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (kill): check that the process exited or not before
	  terminating it. [Bug #4943]

Wed Jul  6 23:13:19 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (opt_call_args): allow trailing comma after assoc
	  argument e.g. 'foo(bar:1,)'.  fixed #3456

Wed Jul  6 22:11:12 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Validate date in
	  "Date:" header

Wed Jul  6 21:29:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): cleanup pointer arithmetic.
	  "size/sizeof(VALUE)" is ugly and easy confusing.
	* cont.c (fiber_initialize_machine_stack_context): ditto.

Wed Jul  6 21:24:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): fix mprotect misuse. A stack
	  guard page should have PROT_NONE.
	* cont.c (fiber_initialize_machine_stack_context):
	  th->machine_stack_maxsize shouldn't be included guard pages size.
	  [Bug #4983][ruby-dev:44043]

Wed Jul  6 21:23:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): use MAP_STACK if it's provided.

Wed Jul  6 21:22:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): use MAP_FAILED instead of -1.

Wed Jul  6 21:21:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): remove unnecessary cast.

Wed Jul  6 18:10:13 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Adding space after
	  comma.

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Remove variable
	  `now`. Suppress warning.

Wed Jul  6 12:18:09 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Fix bug depends to
	  time. The test fails if time past 1 second in line 136-145

Tue Jul  5 15:28:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_here_document): should dispatch heredoc_end
	  scanner event on an empty here document.  fixed Bug#4543.

Tue Jul  5 13:49:26 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* addr2line.c: fix r32407 to check HAVE_ALLOCA_H.

Tue Jul  5 14:05:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httpauth/digestauth.rb (_authenticate):
	  Literal texts in HTTP ABNF is case-insensitive (RFC2616 2.1),
	  and a sample implementation in RFC2617 also ignores the case
	  of algorithms. So now this ignores those cases.
	  [ruby-dev:43965] [Feature #4936]

	* lib/webrick/httpauth/digestauth.rb (initialize):
	  Because of above, opera_hack is useless and removed.

Tue Jul  5 01:30:01 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread_pthread.c (native_sleep): cut the waiting time up to
	  100,000,000 because Solaris cond_timedwait() return EINVAL if an
	  argument is greater than current_time + 100,000,000.  This is
	  considered as a kind of spurious wakeup.  The caller to native_sleep
	  should care about spurious wakeup.

Tue Jul  5 01:24:26 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c: disable FIBER_USE_NATIVE on Solaris because resuming any
	  Fiber caused SEGV.  I haven't follow up the issue deeply, but it
	  works when disabling the feature.

Tue Jul  5 01:22:46 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* addr2line.c: include <alloca.h> to fix a build issue on Solaris.

Tue Jul  5 00:49:05 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/coverage/coverage.c: resurrect r32071 + add GC guard for
	  rb_coverages. [ruby-core:37352] [Bug #4927]
	  [ruby-core:36539] [Feature #4796]

	* test/coverage/test_coverage.rb resurrect r32071.

Mon Jul  4 22:24:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_stack): For NetBSD/FreeBSD, use
	  pthread_attr_getstack() if possible. and, remove an assumption
	  of stack growing direction.

Mon Jul  4 20:42:31 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/coverage/coverage.c: revert r32071.  The commit caused SEGV on
	  some minor nonfree OS.  I have no means of debugging the bug.  My
	  personal opinion is that such OS should be unsupported unless there
	  is an active maintainer.  [ruby-core:37352]

	* test/coverage/test_coverage.rb: ditto.

Mon Jul  4 07:14:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (get_stack): the return address of get_stack
	  must be the highest address of the current thread's stack.

Mon Jul  4 06:37:22 2011  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/intern.h, thread_pthread.c (rb_reserved_fd_p,
	  RB_RESERVED_FD_P): added.  This C API is to limit to access
	  fds which are used by RubyVM internal.  In this version of
	  CRuby, return 1 if fd is communication pipe.
	  If your application needs to close all file descriptors to
	  present resource leak, skip internal fds using this C API.
	  We also define a macro RB_RESERVED_FD_P(fd).  So you can write
	    #ifndef RB_RESERVED_FD_P
	    #define RB_RESERVED_FD_P(fd) 0
	    #endif
	  for Ruby 1.9.2 or previous version to write compatible extensions.
	  See [ruby-core:37727]

	* thread_win32.c (rb_reserved_fd_p): added (return 0 for any fds).

	* io.c (rb_io_initialize): raise ArgumentError if given fd is reserved by Ruby.

Sun Jul  3 23:43:56 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/extmk.rb (extmake): suppresses outputs from extconf.rb.
	  (extmake) warns a failure in extconf.rb.

Sun Jul  3 13:44:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_reject_bang): should not remove elements which are
	  not yielded.  [Bug #2545]

Sun Jul  3 06:10:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_stack): pthread_attr_getstack() doesn't
	  return stack start address, but stack base address. Thus,
	  we need to add stack size for getting stack start address.
	  And, we don't have to decrease guard size twice.
	* thread_pthread.c (thread_start_func_1): don't use inaccurate
	  stack start guess if native_thread_init_stack() can be used.
	  [Bug #1813] [ruby-core:24540]

Sun Jul  3 04:50:08 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_stack): add to a care of guard page on Mac
	  OS X. [Bug #1813] [ruby-core:24540]
	* signal.c (ruby_signal): SIGBUS use alternative stack too.
	* signal.c (sigbus): On Mac, thread stack overflow makes SIGBUS
	  instead of SIGSEGV. thus, added stackoverflow check.
	* signal.c (default_handler): get rid of compilation warning.
	* signal.c (Init_signal): ditto.

Sat Jul 02 08:59:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_ocsp.rb
	* test/openssl/test_x509_cert.rb: Perform SHA-256 tests only if
	  supported by the available OpenSSL version. Versions < 0.9.8 don't
	  support it. [ruby-core:37724]

Sat Jul  2 07:17:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_reject_bang, rb_ary_delete_if): rejected
	  elements should be removed.  fixed [Bug #2545]

Sat Jul  2 01:57:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: remove a description of Kernel#respond_to? because it has
	  been reverted at revision 28564.

Sat Jul  2 00:58:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: describe a change of multiplication of Bignum.

Fri Jul  1 18:52:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_app_erb.rb: increase loop count. too short
	  measurement time makes less accuracy.
	* benchmark/bm_app_factorial.rb: ditto.
	* benchmark/bm_app_mandelbrot.rb: ditto.
	* benchmark/bm_app_strconcat.rb: ditto.

	* benchmark/bm_io_file_create.rb: ditto.
	* benchmark/bm_io_file_read.rb: ditto.
	* benchmark/bm_io_file_write.rb: ditto.

	* benchmark/bm_so_concatenate.rb: ditto.
	* benchmark/bm_so_lists.rb: ditto.
	* benchmark/bm_so_matrix.rb: ditto.
	* benchmark/bm_so_random.rb: ditto.
	* benchmark/bm_so_sieve.rb: ditto.

	* benchmark/bm_vm_thread_mutex1.rb: ditto.
	* benchmark/bm_vm_thread_mutex2.rb: ditto.
	* benchmark/bm_vm_thread_mutex3.rb: ditto.

	* benchmark/bm_vm1_block.rb: cleanup.
	* benchmark/bm_vm1_const.rb: cleanup.
	* benchmark/bm_vm1_ensure.rb: cleanup.
	* benchmark/bm_vm1_ivar.rb: cleanup.
	* benchmark/bm_vm1_length.rb: cleanup.
	* benchmark/bm_vm1_neq.rb: cleanup.
	* benchmark/bm_vm1_not.rb: cleanup.
	* benchmark/bm_vm1_rescue.rb: cleanup.
	* benchmark/bm_vm1_simplereturn.rb: cleanup.
	* benchmark/bm_vm1_swap.rb: cleanup.

	* benchmark/bm_vm2_array.rb: cleanup.
	* benchmark/bm_vm2_case.rb: cleanup.
	* benchmark/bm_vm2_defined_method.rb: cleanup.
	* benchmark/bm_vm2_eval.rb: cleanup.
	* benchmark/bm_vm2_method.rb: cleanup.
	* benchmark/bm_vm2_mutex.rb: cleanup.
	* benchmark/bm_vm2_poly_method.rb: cleanup.
	* benchmark/bm_vm2_poly_method_ov.rb: cleanup.
	* benchmark/bm_vm2_proc.rb: cleanup.
	* benchmark/bm_vm2_regexp.rb: cleanup.
	* benchmark/bm_vm2_send.rb: cleanup.
	* benchmark/bm_vm2_super.rb: cleanup.
	* benchmark/bm_vm2_unif1.rb: cleanup.
	* benchmark/bm_vm2_zsuper.rb: cleanup.

	* benchmark/bm_vm_thread_alive_check1.rb: cleanup.

Fri Jul  1 15:23:00 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix: Add LUP decomposition

Fri Jul  1 15:21:14 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Allow non integer exponents for Matrix#**

Fri Jul  1 15:13:25 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix: Add Eigenvalue Decomposition

Fri Jul  1 15:10:22 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix: Add Matrix#round

Fri Jul  1 11:41:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_trans): free heap ptr when the str is not embedded.
	  patched by Eric Wong. [Bug #4956] [ruby-core:37708]

Fri Jul  1 11:07:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): fix memory leak.
	  Patch by Eric Wong. Thank you! [Bug #4953] [ruby-core:37702]

Fri Jul  1 08:21:28 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_getivar): check vm state version
	  to invalidate inline cache (ivar index).
	  fixes Bug #4926.

	* vm_insnhelper.c (vm_setivar): ditto.

Fri Jul  1 08:03:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c, thread_pthread.c (WRITE_CONST): suppress warnings
	  `ignoring return value'.

Fri Jul  1 06:41:36 2011  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_threadptr_check_signal): only wake up main thread.

	* thread.c (rb_threadptr_execute_interrupts_common): check signal
	  delivery if it is main thread.
	  fixes [ruby-dev:44005] [Ruby 1.9 - Bug #4950]

	* bootstraptest/test_fork.rb: add a test for above.

	* signal.c (rb_get_next_signal): skip if signal_buff is empty.
	  (check signal_buff.size first)

	* vm_core.h: remove unused variable rb_thread_t::exec_signal.

	* thread.c (rb_thread_check_trap_pending): check
	  rb_signal_buff_size() because rb_thread_t::exec_signal
	  is no longer available.

Fri Jul  1 03:28:25 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (Init_class_hierarchy): should name BasicObject
	  explicitly.

	* variable.c (rb_const_defined_0): should not check for
	  superclasses as const_get.

Fri Jul  1 03:24:03 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: mathn is still alive (should die soon).

Thu Jun 30 23:50:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* misc/ruby-mode.el (ruby-indent-beg-re): Fix broken regular
	  expression.  Fixes #4546

Thu Jun 30 23:43:30 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl.c/.h: Added ossl_x509_name_sk2ary.
	* ext/openssl/ossl.c: Replaced ossl_x509_ary2k by generic macro to
	  simplify future conversions.
	* ext/openssl/ossl_ssl.c: Implement SSLSocket#client_ca.
	* test/openssl/test_ssl.rb: Add test for SSLSocket#client_ca.
	  Thanks to Ippei Obayashi for providing the patch!
	  [ Ruby 1.9 - Feature #4481 ] [ruby-core:35461]

Thu Jun 30 22:38:58 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm2_defined_method.rb: added to measure performance of
	  bmethod (method defined by define_method()).

Thu Jun 30 22:17:04 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_call_bmethod): fix to hook call/return event
	  for methods defined by define_method().  fixes Bug #4613.

	* thread.c (call_trace_proc): Fix to skip if class is not given (0).
	  Note that ID and Class object are passed for call/return event
	  if the called method was defined by define_method().
	  If you are author of tracer/profiler/debugger, this may be an
	  important change.  You should check passed class as zero or
	  non-zero instead of checking the event type.

	* test/ruby/test_settracefunc.rb: add a test for above.

Thu Jun 30 21:18:35 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* configure.in: Add warnflags for XL/C on AIX during configure
	  to avoid [Bug #3971]. See [ruby-core:32859]

Thu Jun 30 21:16:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (m_ajd): refers a constant.

Thu Jun 30 20:54:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	  * ext/io/console/io-console.gemspec: spin-off gem for 1.9.2.

Thu Jun 30 20:36:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: trivial changes.

Thu Jun 30 20:12:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_module.rb: tests for [Bug #3422] and [Bug #3423].

Thu Jun 30 20:03:39 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified doc.

Thu Jun 30 19:09:19 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (thread_timer): ignore unknown errno.
	  (we observed that select(2) was canceled by errno=514 on
	  boron == Linux/Xen environment)

Thu Jun 30 17:33:25 2011  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (ObjectSpace.count_tdata_objects):
	  Fix rdoc.  Fixes Bug #3892.

	* ext/objspace/objspace.c (ObjectSpace.count_tdata_objects):
	  Change key type if the klass of a object is zero (internal object).
	  Read rdoc for details.

	* internal.h: export rb_objspace_data_type_name().

Thu Jun 30 17:25:08 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (ping_signal_thread_list, thread_timer):
	  fix to keep polling state if there are any ping-tasks.

Thu Jun 30 12:25:34 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (rb_thread_create_timer_thread): allocate
	  machine stack for the timer thread at least 12KB.  FreeBSD 8.2
	  AMD64 causes machine stack overflow (SIGSEGV) only with
	  PTHREAD_STACK_MIN (maybe defined as 2KB).

Thu Jun 30 09:36:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/weakref.rb:  Attach documentation to WeakRef and add missing
	  documentation

Thu Jun 30 09:30:14 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/yaml.rb:  Document toplevel YAML and YAML::ENGINE to describe
	  Psych vs Syck engines.

Thu Jun 30 09:21:52 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Hide handle_no_method_error from RDoc.
	* error.c:  Document or hide undocumented error classes.

Thu Jun 30 07:49:04 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c:  Document ENV

Thu Jun 30 06:37:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): ensure RUBYLIB_PREFIX stored
	  before RUBYLIB, even if MANGLED_PATH is enabled.  fixed #1679.
	  MANGLED_PATH is disabled by the default and will be removed
	  completely in the future.

Thu Jun 30 06:32:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/drb/drb.rb:  Hide deprecated toplevel DRb constants.

Thu Jun 30 06:17:02 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/cmath.rb (CMath.log): second argument: b can be nil.

Thu Jun 30 06:23:28 2011  Eric Hodel  <drbrain@segment7.net>

	* thread.c (ruby_thread_s_pass):  Fix typo.

Thu Jun 30 06:16:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 3.8 which contains fixes for documentation
	  in trunk.

Thu Jun 30 02:53:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_threadptr_execute_interrupts_common): remove
	  meaningless native_thread_yield(). It never close a race.

Thu Jun 30 02:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_limits): minor optimization.
	  eliminate machine context saving when running time is enough small.

Thu Jun 30 02:28:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_rec): move interrupt_flag check to
	  rb_thread_schedule().
	  And also rename to rb_thread_schedule_limits() and remove
	  sched_depth argument. It's no longer called recursive.
	* thread.c (rb_thread_schedule): add to check interrupt_flag as
	  above explained.

	* thread.c (rb_threadptr_execute_interrupts_rec): rename to
	  rb_threadptr_execute_interrupts_common() and remove sched_depth
	  argument. It's no longer called recursive.

	* thread.c (rb_thread_sleep): adapt the renaming.
	* thread.c (rb_threadptr_execute_interrupts): ditto.
	* thread.c (rb_thread_execute_interrupts): ditto.

Thu Jun 30 01:31:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_s_pass): change RDoc description and remove
	  a sample code. The actual implementation never behave as explained by
	  an example. It's a documentation bug.

Thu Jun 30 00:54:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_stop): change RDoc sample code. The old
	  example is buggy and may cause deadlock. The patch is
	  suggested by Heesob Park <phasis@gmail.com>. Thank you!
	  [Bug #3606][ruby-core:31454]

Thu Jun 30 00:49:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_wakeup): change RDoc sample code. The old
	  example is buggy and may not display anything by a race.
	  The patch is suggested by Heesob Park <phasis@gmail.com>.
	  Thank you! [Bug #3606][ruby-core:31454]

Thu Jun 30 00:43:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_run): change RDoc. The old example is buggy
	  and may cause deadlock. The patch is suggested by Heesob Park
	  <phasis@gmail.com>. Thank you! [Bug #3606][ruby-core:31454]

Thu Jun 30 00:30:15 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/cmath.rb: make same exception for Math. fix [Bug #3137].

Thu Jun 30 00:03:20 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/completion.rb: complement correctly string literal. fix
	  [Bug #1145].

Wed Jun 29 23:42:51 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: avoided using timev.
	* ext/date/date_strftime.c: ditto.
	* ext/date/date_tmx.h: ditto.

Wed Jun 29 23:17:57 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/openssl/ossl.h (OPENSSL_SYS_WIN32): support for mingw(msys).

Wed Jun 29 23:09:14 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/tk/extconf.rb (intptr_t, uintptr_t): support for the latest ActiveTcl with mingw.

Wed Jun 29 22:49:10 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/cmd/help.rb: support RDoc 3.7. fix [Bug #3760].

Wed Jun 29 22:04:14 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/tracer.rb: Tracer.on only if required by -r command-line option.
	  and consider --disable-gems option.
	* test/test_tracer.rb: add tests for it.

Wed Jun 29 13:55:36 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_const_get_0): should not look for superclasses if
	  the second optional argument is given for #const_get().
	  fix [Bug #3422] [Bug #3423]

Wed Jun 29 12:07:27 2011  Eric Hodel  <drbrain@segment7.net>

	* math.c:  Attach documentation for Math.
	* object.c:  Document NIL, TRUE, FALSE.
	* io.c:  Improve grammar in ARGF comment.  Document STDIN/OUT/ERR.
	  Document ARGF global constant.
	* lib/rake:  Hide deprecated toplevel constants from RDoc (import from
	  rake trunk).
	* lib/thwait.rb:  Document ThWait.
	* lib/mathn.rb:  Hide Math redefinition from RDoc
	* lib/sync.rb:  Add a basic comment for Sync_m, Synchronizer_m, Sync,
	  Synchronizer.
	* parse.y:  Document SCRIPT_LINES__.
	* hash.c:  Document ENV class and global constant.
	* vm.c:  Document TOPLEVEL_BINDING.
	* version.c:  Document RUBY_* constants.
	* ruby.c:  Document DATA and ARGV.

Wed Jun 29 10:13:12 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Matrix.zero can build rectangular matrices.
	  Vector#r should be called #magnitude

Wed Jun 29 10:11:08 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Add Matrix#diagonal?, hermitian?, normal?,
	  orthogonal?
	  permutation?, symmetric?, {lower|upper}triangular?, unitary?, zero?

Wed Jun 29 10:09:35 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Specialize Matrix#find_index to return [row, col]
	  and accept the same optional argument as #each

Wed Jun 29 10:07:32 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Matrix#each{_with_index} can iterate over a subset
	  of the Matrix

Wed Jun 29 06:21:02 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_stop_timer_thread): skip to close
	  communication pipe to avoid timing bug (process termination timing).
	  The communication pipe will closed by OS.

Wed Jun 29 06:09:54 2011  Koichi Sasada  <ko1@atdot.net>

	* error.c (rb_async_bug_errno): async-safe bug report function.
	  In timer thread, signal handler should use it.
	  The patch is contributed by Eric Wong <normalperson@yhbt.net>.
	  Refs: [ruby-core:37644] and [ruby-core:37647]

	* thread_pthread.c: use rb_async_bug_errno().
	  And replace all fprintf() to write().

	* internal.h (rb_async_bug_errno): add decl. of above func.

Tue Jun 28 23:46:08 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/tracer.rb: count only non-internal libraries in stack trace,
	  ignoring custom_require.

Tue Jun 28 21:44:58 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/ruby-lex.rb: recognize '\char' in ruby statement.

Tue Jun 28 20:39:29 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/debug.rb (var_list): Command 'var *' did not work on 1.9(!).
	  global_variables, local_variables, and instance_variables returns
	  Symbols from 1.9 and need to stringify before evaling it.
	  See #4931.

Tue Jun 28 19:23:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c: Now, USE_TRAP_SIGMASK depend on HAVE_PTHREAD_SIGMASK.
	  The code have already depended on pthread_sigmask since r27464.

Tue Jun 28 15:09:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/benchmark.rb: merge eregon/benchmark.
	  https://github.com/eregon/ruby/tree/benchmark
	  patched by Benoit Daloze. [ruby-core:37593] [Bug #4940]

	* lib/benchmark (Benchmark#bmbm): bmbm should be consistent with bm
	  for the return value.

	* test/benchmark: remove preemptive test instead of skipping
	  I removed the preemptive test I wrote for Feature #4197.
	  I'll add it back when the implementation will be able to satisfy it.

	* lib/benchmark (Benchmark#bmbm): remove useless explicit call,
	  #format is an alias of #to_s test/benchmark: add a test for
	  format of long time.

	* lib/benchmark: fix label width: always add 1 to ensure there is a
	  space delimiter even with times over 100s
	  When I asked for Feature #4197, I wanted to make delimiting spaces
	  consistent for #bm and #bmbm.
	  But with times over 100s, the output contains no space between the
	  label and the first time (user).
	  Now both ensure there is always a space, even if that means 3 spaces
	  with times under 10s (because it is formatted as %10.6f)

	* test/benchmark: let labels be a constant
	  lib/benchmark (Benchmark#realtime): avoid creating an unused Proc
	  lib/benchmark (Benchmark#benchmark): use ensure clause to restore
	  STDOUT.sync, as in #bmbm

Tue Jun 28 13:41:51 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (native_stop_timer_thread): fixed commit miss of
	  r32244.  grep sources before changing the signature of a function.

Tue Jun 28 11:49:14 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (consume_communication_pipe):
	  Make "buff" as static.  (Maybe) "buff" can be shared between
	  any caller (any threads) because no one use the read values.
	  "buff" (1024 byte) on stack may cause stack overflow on
	  several environment (we found a crash on FreeBSD).
	  And remove const value "buff_size", and define CCP_READ_BUFF_SIZE
	  macro.

Tue Jun 28 11:45:30 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake:  Update rake to fix some bugs and hide deprecated features
	  from RDoc.
	* lib/rake/version.rb:  Bump version to 0.9.2.1 to distinguish it from
	  the released version.
	* NEWS:  ditto

Tue Jun 28 11:17:28 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 3.7 (final)
	* NEWS:  ditto

Tue Jun 28 10:18:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (rb_daemon): fix wrong #endif position.

Tue Jun 28 07:50:32 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c (Init_Object):  Teach RDoc what Init_class_hierarchy does to
	  hook up ri for BasicObject, Object, Module and Class.

Tue Jun 28 05:03:32 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* thread.c (rb_thread_local_aref): RDoc fix. Thread#[] example
	  had a race. See #4480.

Tue Jun 28 01:22:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigMath_s_log): move BigMath.log from
	  bigdecimal/math.rb.

	* ext/bigdecimal/lib/bigdecimal/math.rb: ditto.

	* test/bigdecimal/test_bigdecimal.rb: move test for BigMath.log from
	  test/bigdecimal/test_bigmath.rb.

	* test/bigdecimal/test_bigmath.rb: ditto.

Tue Jun 28 01:19:52 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/ruby-lex.rb: fix [Bug #4232].

Tue Jun 28 00:14:13 2011  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: fix [Bug #4409]. add DRbServer#here?.

	* test/drb/test_drb.rb: ditto.

	* test/drb/drbtest.rb: ditto.

	* test/drb/ut_eq.rb: ditto.

Tue Jun 28 00:08:43 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/workspace.rb: fix BUG#4793.

Mon Jun 27 22:06:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (consume_communication_pipe): don't use C99
	  style variable length array.

Mon Jun 27 22:04:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (consume_communication_pipe): change return
	  type to void. caller doesn't use it.

Mon Jun 27 21:29:50 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.h (rb_global_vm_lock_struct): add volatile to
	  gvl->waiting. now thread_timer() access it w/o lock.

Mon Jun 27 21:16:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: s/__gvl_acquire/gvl_acquire_common/ and
	  s/__gvl_release/gvl_release_common/.

Mon Jun 27 11:41:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (rb_thread_create_timer_thread):
	  the type of return value of write(2) is ssize_t.

Mon Jun 27 09:57:02 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (rb_thread_create_timer_thread):
	  Fixes missing initialization of oflags.

Mon Jun 27 09:07:42 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c: Stop polling in the timer thread when there are
	  no waiting thread.  If there are 2 or more runnable threads,
	  the timer thread does polling.  Avoid polling makes power save
	  for several computers (0.2W per a Ruby process, when I measured).
	  If outside-event such as signal or Thread#kill was occurred
	  when the timer thread does not do polling, then wake-up
	  the timer thread using communication-pipe (the timer thread
	  waits this communication-pipe with select(2)).
	  The discussion about this modification can be found from the post
	  [ruby-core:33456] and other related posts.
	  Note that Eric Wong and KOSAKI Motohiro give us the huge
	  contributions for this modification.  Thanks.

	* thread_pthread.c (rb_thread_wakeup_timer_thread): add a function.
	  This function wakes up the timer thread using communication-pipe.

	* thread.c (rb_thread_stop_timer_thread): add a parameter which
	  specify closing communication-pipe or not.

	* thread.c (rb_thread_terminate_all): do not stop timer thread here
	  (ruby_cleanup() terminate timer thread).

	* signal.c: wake up timer thread using
	  rb_thread_wakeup_timer_thread() from signal handler.

	* eval.c (ruby_cleanup): use rb_thread_stop_timer_thread(1).

	* process.c: use rb_thread_stop_timer_thread(0)
	  (reuse communication-pipe).

	* thread_win32.c (rb_thread_wakeup_timer_thread): add a dummy
	  function.

	* vm_core.h: add and fix decl. of functions.

Mon Jun 27 08:01:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: should use ALLOCA_N.

Mon Jun 27 01:34:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/etc/test_etc.rb (TestEtc#test_get{pw,gr}nam): skip entries
	  start with + sign, which means NIS.  these are returned in the
	  case that passwd and group entries in /etc/nsswitch.conf are set
	  to use "nis" explicitly on Debian.  fixed #3683

Mon Jun 27 00:44:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (rb_parser_end_seen_p): fix documentation about return
	  value. patched by Sho Hashimoto. [Bug #4511]

Mon Jun 27 00:40:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* hash.c (rb_hash_reject): add documentation that Hash#reject
	  without block returns enumerator.
	  patched by Michael Edgar [Bug #4847] [ruby-core:36800]

Sun Jun 26 23:49:21 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_switch_hitter.rb: added a test.

 Sun Jun 26 22:21:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: refactoring.

Sun Jun 26 18:03:30 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* parse.y: comma at the end of line is no longer allowed.
	  A patch from Yukihiro Matsumoto  <matz AT ruby-lang.org>.
	  (fixed #3456).

Sun Jun 26 13:35:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_dump.c (rb_vm_bugreport): change CrashReporter suggestion messages
	  on Mac. It should be placed after "-- C level backtrace" line.
	  Suggested by Endoh-san.

	  <before>
	  -- See Crash Report log file under ~/Library/Logs/CrashReporter or ---------
	  -- /Library/Logs/CrashReporter, for the more detail of ---------------------
	  -- C level backtrace information -------------------------------------------

	<after>
	  -- C level backtrace information -------------------------------------------

	     See Crash Report log file under ~/Library/Logs/CrashReporter or
	     /Library/Logs/CrashReporter, for the more detail of.

Sun Jun 26 10:08:28 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/extconf.rb
	* ext/openssl/ossl_missing.h/.c: add ASN1_put_eoc if missing.

	* ext/openssl/ossl_asn1.c: introduce ossl_asn1_object_size and
	  ossl_asn1_put_object to wrap functionality depending on OpenSSL
	  version in use.
	  Fixes	[ Ruby 1.9 - Bug #4916 ] reported by Hiroshi Nakamura.
	  [ruby-core:37286]

Sun Jun 26 01:00:15 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_strftime_internal): removed meaningless braces.
	* ext/date/date_core.c (gengo): the value should be int.

Sat Jun 25 23:45:30 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_insnhelper.c (vm_search_superclass): avoid control frame
	  stack overrun. currently super() in Proc created in a method
	  defined by Module#define_method raise NoMethodError. [Bug #4881]
	* test/ruby/test_method.rb t_super_in_proc_from_define_method):
	  add test for it.

Sat Jun 25 23:23:14 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (sleep_forever): now Kernel#sleep don't wakeup by
	  signal handler execution. [Bug #4072]

Sat Jun 25 23:14:47 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (rb_threadptr_check_signal): remove unnecessary th->status
	  backup. fix race condition which may results unexpected main thread's
	  status transition. see #4072

Fri Jun 24 19:57:30 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/webrick/httprequest.rb (setup_forwarded_info): Parsing request
	  header failed when the request is from 2 or more Apache reverse
	  proxies. It's said that all X-Forwarded-* headers will contain more
	  than one (comma-separated) value if the original request already
	  contained one of these headers.  Since we could use these values as
	  Host header, we choose the initial(first) value. See #4922.

	* test/webrick/test_httprequest.rb (test_forwarded): Test it.

Fri Jun 24 17:06:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_daemon): should not start timer thread
	  twice.  fixed Bug#4920.

Fri Jun 24 15:54:14 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_shutdown): Try to shutdown SSL
	  connection more gracefully. Call SSL_shutdown() max 4 times until it
	  returns 1 (success). Bi-directional SSL close has several states but
	  SSL_shutdown() kicks only 1 transition per call. Max 4 is from
	  mod_ssl.c of Apache httpd that says 'max 2x pending + 2x data = 4'.
	  See #4237.

Fri Jun 24 07:24:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake/version.rb:  Fixed VERSION to work with tool/rbinstall.rb
	* bin/rake:  Import bin/rake from 0.9.2
	* tool/rbinstall.rb (install):  Rake::VERSION is now in
	  lib/rake/version.rb.  Fixes `make install`

Fri Jun 24 07:11:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake: Import Rake 0.9.2

Fri Jun 24 00:44:15 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (c_valid_{julian,gregorian}_p): fixed the range of month.

Fri Jun 24 00:14:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: trivial changes on text.

Thu Jun 23 22:46:57 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_x509name.c: Add X509::Name#hash_old as a wrapper
	  for X509_NAME_hash_old in OpenSSL 1.0.0. See #4805

	* test/openssl/test_x509name.rb (test_hash): Make test pass with
	  OpenSSL 1.0.0.

	* NEWS: Add it.

Thu Jun 23 19:30:53 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_set_time): Check
	  argument type with NUM2LONG if the arg is not a Time object.
	  See #4919.

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_set_timeout): Check
	  type with NUM2LONG. Time as an arg is not allowed. See #4919.

	* test/openssl/test_ssl_session.rb (test_session_time,
	  test_session_timeout): Test it.

Wed Jun 23 13:30:30 2011  Shota Fukumori  <sorah@tubusu.net>

	* signal.c(ruby_atomic_exchange): Fix definition style.

Wed Jun 22 22:34:05 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_sslctx_session_new_cb): Return 0 to
	  OpenSSL from the callback for SSL_CTX_sess_set_get_cb().
	  Returning 0 means to OpenSSL that the session is still valid
	  (since we created Ruby Session object) and was not freed by us with
	  SSL_SESSION_free(). Call SSLContext#remove_session(sess) in
	  session_get_cb block if you don't want OpenSSL to cache the session
	  internally.
	  This potential issue was pointed by Ippei Obayashi. See #4416.

	* test/openssl/test_ssl_session.rb (test_ctx_server_session_cb): Test
	  it.

Wed Jun 22 22:21:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ssl_session.c: Respect T_BIGNUM time values. Patch by
	  Tomoyuki Chikanaga.
	  [ Ruby 1.9 - Bug #4919 ] [ruby-dev:43869]

Wed Jun 22 21:29:25 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/depend (SOCK_HEADERS): use $(top_srcdir) instead of
	  $(topdir). sorry!

Wed Jun 22 19:47:03 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (cont_capture): add volatile.
	  On clang -O, it is needed to avoid the optimization.
	  With this and llvm/clang's recent fix, clang 3.0 can
	  build ruby-trunk with -O option.

	* cont.c (cont_capture): use for-loop.

	* array.c (rb_ary_each): add volatile and use it.

	* vm_insnhelper.c (vm_call_cfunc): ditto.

Wed Jun 22 18:20:46 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_sslctx_session_remove_cb):
	  OpenSSL::SSL::SSLContext#session_remove_cb was broken. It wrongly
	  tried to call the session_*new*_cb callback.

	* test/openssl/test_ssl_session.rb (class OpenSSL): Test it.

Wed Jun 22 17:37:49 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl.h: Introduced OSSL_BIO_reset macro for PEM/DER
	  fallback scenarios.

	* ext/openssl/ossl_pkey_dsa.c
	* ext/openssl/ossl_x509req.c
	* ext/openssl/ossl_pkey_rsa.c
	* ext/openssl/ossl_pkey_ec.c
	* ext/openssl/ossl_ssl_session.c
	* ext/openssl/ossl_x509crl.c
	* ext/openssl/ossl_pkey.c
	* ext/openssl/ossl_pkey_dh.c
	* ext/openssl/ossl_x509cert.c
	* ext/openssl/ossl_pkcs7.c: Use OSSL_BIO_reset.

	* ext/openssl/ossl_ssl.c
	* ext/openssl/ossl_cipher.c
	* ext/openssl/ossl_pkey_ec.c
	* ext/openssl/ossl_pkcs12.c
	* ext/openssl/ossl_ssl_session.c: Replace rb_raise occurrences by
	  ossl_raise. This automatically flushes OpenSSL's error queue.

	* ext/openssl/ossl_pkcs7.c: Raise error if DER fallback for parsing
	  fails.

	* test/openssl/test_pkey_ec.rb
	* test/openssl/test_pkey_dsa.rb
	* test/openssl/test_pkey_rsa.rb: Add assertions that OpenSSL.errors is
	  empty.

	* test/openssl/test_pkey_rsa.rb: Remove initial OpenSSL.errors call in
	  test_new.
	  [ Ruby 1.9 - Bug #4885 ] [ruby-core:37134]

Wed Jun 22 15:01:24 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ssl.c: Use SSL_MODE_RELEASE_BUFFERS if available.
	  Thanks, Eric Wong, for providing the patch.
	  [ Ruby 1.9 - Feature #4672 ] [ruby-core:36127]

Wed Jun 22 14:47:53 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_buffering.rb
	* test/openssl/test_pkcs12.rb: Inherit from Test::Unit::TestCase
	  instead of MiniTest::Unit::TestCase. [ruby-core:37275]

Wed Jun 22 12:41:03 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_to_der):
	  OpenSSL::SSL::Session#to_der was broken. Fix buffer handling.

	* test/openssl/test_ssl_session.rb (test_session): Test it.

Wed Jun 22 12:38:52 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/openssl/test_ssl_session.rb: Split out SSL::Session related
	  tests from test_ssl.rb

Wed Jun 22 03:20:52 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Fix cyclic references of
	  objects.  Thanks to CvX for reporting the bug and a test case.
	* test/psych/test_object.rb: test for cyclic object references.

Wed Jun 22 02:39:54 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP.post_form): Do not ignore query part of
	  the given URI to post. See #655.

	* test/net/http/test_http.rb, test/net/http/utils.rb: Test it.

Wed Jun 22 01:28:13 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/openssl/test_x509store.rb (test_set_errors): Redhat is
	  distributing a patched version of OpenSSL that allows multiple CRL
	  for a key (multi-crl.patch.) Make test pass on such env. See #4122,
	  #4554.

Tue Jun 21 21:50:37 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/webrick/httpresponse.rb (HTTPResponse#setup_header): Close
	  HTTP/1.1 connection when returning an IO object as response body
	  without setting HTTPResponse#chunked to true. See #855 no.1.

	* test/webrick/test_httpserver.rb: Test it.

Tue Jun 21 21:27:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* internal.h: move rb_thread_io_blocking_region() declaration
	  from intern.h to internal.h. It's still experimental API and
	  need more discussion. [ruby-dev:43698]
	* include/ruby/intern.h: ditto.

	* ext/socket/rubysocket.h: include internal.h.
	* ext/socket/depend: add internal.h dependency.
	* ext/socket/extconf.rb: add $INCFLAGS to topdir.

Tue Jun 21 20:38:47 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (datetime_s_*): canonicalize 24 o'clock.

Tue Jun 21 19:46:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_thread.rb (TestThread#test_priority): enable
	  this test again. Current GVL respect thread priority rather
	  than past.

Tue Jun 21 13:25:35 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (readline_getc): applied a patch in
	  #3827 by by Akio Tajima <artonx AT yahoo.co.jp>. (see #3827)

Tue Jun 21 13:16:31 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: fixed bug, specify --disable-libedit
	  then disable libedit, does not specify then check readline and
	  libedit if failed checking readline. (fixes #3375)

Mon Jun 20 22:52:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec): use sig_do_nothing instead of SIG_DFL
	  for avoiding a race.
	* process.c (sig_do_nothing): new function.

Mon Jun 20 21:31:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (thread_timer): rename timeout_10ms to
	  time_quantum. it's no longer 10ms.

Mon Jun 20 18:46:02 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_cipher.c, ext/openssl/lib/openssl/cipher.rb:
	  Documentation fix by Ippei Obayashi. See #4419.

Mon Jun 20 15:41:33 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/webrick/cookie.rb (WEBrick::Cookie.parse): Revert r31228.
	  r31228 was for allowing the 'Cookie:' header which did not have no
	  SP after ';' for separating cookie-pairs but RFC6265 requires single
	  SP after ';' there.  We allow multiple SPs here for compatibility
	  with older WEBrick version.

	* test/webrick/test_cookie.rb: Test it.

Sun Jun 19 13:31:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* NEWS: Introduce --hide-skip on test/unit.

Sun Jun 19 10:05:16 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Override Test::Unit::TestCase#on_parallel_worker?
	  only when $0 == __FILE__.

	* lib/test/unit/parallel.rb: Run Test::Unit::Worker.run only when
	  $0 == __FILE__.

Sat Jun 18 23:59:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fill_cbuf): finish reading at EOF, and the readconv has
	  been cleared by another thread while io_fillbuf() is waiting at
	  select().  a patch in [ruby-core:37197] by Hiroshi Shirosaki
	  <h.shirosaki AT gmail.com>.  fixed #3840

Sat Jun 18 21:36:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: remove GVL_DEBUG

Sat Jun 18 21:32:02 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm.c, vm_core.h (rb_vm_stack_to_heap): remove const.
	  It makes compilations warnings.

Sat Jun 18 18:54:15 2011  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_core.h (rb_vm_stack_to_heap): fix "const" place.

Sat Jun 18 17:23:38 2011  Tanaka Akira  <akr@fsij.org>

	* eval.c, hash.c, load.c, proc.c, range.c, thread.c, time.c: don't
	  declare internal functions.

	* internal.h, vm_core.h: declare internal functions.

	* array.c: include internal.h.

	* common.mk: update dependency for array.o.

Sat Jun 18 13:39:33 2011  Tanaka Akira  <akr@fsij.org>

	* internal.h: declarations declared in include/ruby/*.h removed.

Sat Jun 18 12:42:17 2011  Tanaka Akira  <akr@fsij.org>

	* method.h, internal.h iseq.h: declare internal functions.

	* compile.c, eval.c, iseq.c, object.c, parse.y, proc.c, process.c,
	  thread.c, vm.c, vm_eval.c, vm_insnhelper.c, vm_method.c: don't
	  declare internal functions.

	  Note that rb_method_entry_eq() is defined in vm_method.c but
	  there was a declaration in proc.c with different const-ness.
	  Now it is declared in method.h with same const-ness to the
	  definition.

	* object.c (rb_mod_module_exec): don't declare functions declared in
	  include/ruby/intern.h.

Sat Jun 18 12:05:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/backward/classext.h: for evil gems.  fixed #4803

Sat Jun 18 11:12:13 2011  Tanaka Akira  <akr@fsij.org>

	* common.mk: update dependencies.

Sat Jun 18 11:09:03 2011  Tanaka Akira  <akr@fsij.org>

	* io.c: suppress warnings.

Sat Jun 18 10:22:39 2011  Tanaka Akira  <akr@fsij.org>

	* internal.h: declare more internal functions.

	* iseq.h (rb_method_get_iseq): declared.

	* compile.c, eval.c, eval_error.c, iseq.c, parse.y, proc.c, range.c,
	  ruby.c, time.c, util.c, vm.c: don't declare internal functions.

	* eval.c, parse.y, thread_pthread.c: non-existing function declarations
	  removed.

Sat Jun 18 08:12:54 2011  Tanaka Akira  <akr@fsij.org>

	* common.mk: dependencies updated.

	* tool/update-deps: new file to assist update dependencies in
	  common.mk.

Sat Jun 18 07:27:27 2011  Tanaka Akira  <akr@fsij.org>

	* internal.h: declare internal functions here.

	* node.h: declare NODE dependent internal functions here.

	* iseq.h: declare rb_iseq_t dependent internal functions here.

	* vm_core.h: declare rb_thread_t dependent internal functions here.

	* bignum.c, class.c, compile.c, complex.c, cont.c, dir.c, encoding.c,
	  enumerator.c, error.c, eval.c, file.c, gc.c, hash.c, inits.c, io.c,
	  iseq.c, load.c, marshal.c, math.c, numeric.c, object.c, parse.y,
	  proc.c, process.c, range.c, rational.c, re.c, ruby.c, string.c,
	  thread.c, time.c, transcode.c, variable.c, vm.c,
	  tool/compile_prelude.rb: don't declare internal functions declared
	  in above headers.  include above headers if required.

	  Note that rb_thread_mark() was declared as
	  void rb_thread_mark(rb_thread_t *th) in cont.c but defined as
	  void rb_thread_mark(void *ptr) in vm.c.  Now it is declared as
	  the later in internal.h.

Sat Jun 18 02:36:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (VpNewRbClass): fix type of the 2nd
	  argument.

	* ext/bigdecimal/bigdecimal.h: ditto.

Sat Jun 18 02:30:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigMath_s_exp): move BigMath.exp from
	  bigdecimal/math.rb.

	* ext/bigdecimal/lib/bigdecimal/math.rb: ditto.

	* test/bigdecimal/test_bigdecimal.rb: move test for BigMath.exp from
	  test/bigdecimal/test_bigmath.rb.

	* test/bigdecimal/test_bigmath.rb: ditto.

Sat Jun 18 00:20:54 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: do not define wnum[01].

Fri Jun 17 18:57:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* compile.c (iseq_compile_each): fix return value of obj[a,*b]=c.

Fri Jun 17 13:09:45 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Clean up documentation.

Fri Jun 17 09:25:14 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Document curses constants.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4880]

Fri Jun 17 09:11:05 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c:  Document Module#method_added and #method_removed.
	  Patch by Bryce Kerley.  [Ruby 1.9 - Feature #4867]

Fri Jun 17 08:50:16 2011  Eric Hodel  <drbrain@segment7.net>

	* io.c:  Improve documentation of IO and File open and new.
	  Patch by Roger Pack.  [Ruby 1.9 - Bug #4790]

Fri Jun 17 07:53:50 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/csv.rb:  Document #raw_encoding.  Patch by David Czarnecki.
	  [Ruby 1.9 - Bug #4874]

Fri Jun 17 07:46:50 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Document Benchmark::Tms#memberwise.  Patch by
	  David Czarnecki.  [Ruby 1.9 - Bug #4873]

Fri Jun 17 07:38:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/prettyprint.rb:  Improve documentation.  Patch by Ysiad
	  Ferreiras.  [#4834]

Fri Jun 17 07:23:03 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c (rb_ary_drop):  Improve documentation.  Patch by Caley Woods.
	  [Ruby 1.9 - Bug #4858]

Fri Jun 17 06:11:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/log.rb:  Improve documentation of BasicLog and Log.
	  Patch by Olivier Brisse.  [Ruby 1.9 - Bug #4833]
	* lib/webrick/httpstatus.rb:  Improve documentation of
	  WEBrick::HTTPStatus.  Patch by Olivier Brisse.
	  [Ruby 1.9 - Bug #4833]

Fri Jun 17 04:48:22 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c, thread_pthread.h: remove unused variables.
	  (native_thread_data_t::gvl_cond, native_thread_data_t::gvl_next)

Thu Jun 16 14:32:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* time.c (rb_time_new): prevent overflow by "* 1000".

Fri Jun 17 03:07:36 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm4_thread_create_join.rb,
	  benchmark/bm_vm4_thread_mutex[1-3].rb: renamed to
	  bm_thread_* (fix last rename).

Fri Jun 17 02:26:47 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_thread_create): fix debug message.
	  (add last newline)

Thu Jun 16 23:40:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_rec): fix {UN,}LIKELY macro misuse.
	* gc.c (rb_newobj): ditto.
	* vm_insnhelper.c (vm_method_search): ditto.

Thu Jun 16 20:06:15 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb: Fix Regexp for test.

	* test/testunit/tests_for_parallel/test_third.rb: Use
	  Test::Unit::TestCase#on_parallel_worker? for detecting worker.

	* lib/test/unit/testcase.rb(Test::Unit::TestCase#on_parallel_worker?):
	  New Method Test::Unit::TestCase#on_parallel_worker? returns true
	  when a testcase is running on parallel worker.
	* lib/test/unit/parallel.rb(Test::Unit::TestCase#on_parallel_worker?):
	  ditto.

Thu Jun 16 19:27:12 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/test_securerandom.rb: Add testcase.  This testcase does NOT aim
	  to test cryptographically strongness and randomness.  It includes
	  the test for PID recycle issue of OpenSSL described in #4579 but
	  it's disabled by default.

Thu Jun 16 17:55:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (TestIO#test_copy_stream_socket): fix
	  test hanging up issue. Patch by CHIKANAGA Tomoyuki.

Thu Jun 16 15:17:39 2011  Eric Hodel  <drbrain@segment7.net>

	* variable.c (const_missing):  Add simple example of const_missing.
	  Patch by Anuj Dutta.  [Ruby 1.9 - Bug #4794]

Thu Jun 16 15:09:29 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/monitor.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4823]

Thu Jun 16 14:54:09 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/utils.rb: Document WEBrick::Utils.  Patch by Olivier
	  Brisse.  [Ruby 1.9 - Bug #4819]

Thu Jun 16 14:26:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpservlet/erbhandler.rb:  Allow the ERB document to
	  alter the content-type of the response.  [Ruby 1.9 - Bug #4685]

Thu Jun 16 14:15:47 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb: Clarify timeout duration types.  Patch by Alf Mikula.
	  [Ruby 1.9 - Bug #4791]
	* lib/net/http.rb: ditto

Thu Jun 16 13:25:25 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc*:  Import RDoc 3.7 release candidate

Thu Jun 16 11:35:09 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (search_response): parses SEARCH responses from
	  the Yahoo IMAP server correctly.  patched by Mark Nadig.  [Bug #4509]

Thu Jun 16 09:12:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* fix for build on solaris 10.

Thu Jun 16 09:08:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/io/console/test_io_console.rb (TestIO_Console#test_sync):
	  fix for daemon process.

Thu Jun 16 07:58:01 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb(test_ignore_tzero): Test for r32109.

	* test/testunit/tests_for_parallel/test_third.rb: Use another way to
	  detect that test is running on worker. This fixes sometimes
	  TestParallel failing.

Thu Jun 16 07:20:06 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Runner#_run_parallel): Ignore -j0
	  because it makes blocking forever by IO.select.

Thu Jun 16 03:08:11 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/testunit/test_parallel.rb (TestParallel::TestParallelWorker#
	  setup): now can run on Windows, probably.

	* test/testunit/test_parallel.rb (TestParallel::TestParallel#setup):
	  ditto.

Thu Jun 16 03:00:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (do_select): Windows: no need to poll if select(2) is
	  cancelable.

	* thread_win32.c (native_fd_select): new function to make select(2)
	  cancelable.

	* thread_win32.c (rb_w32_check_interrupt): new function for checking
	  interrupt.

	* win32/win32.c (rb_w32_select_with_thread): new function. cancelable
	  select(2).

	* win32/win32.c (rb_w32_select): use above function internally.

Wed Jun 15 23:30:45 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* gc.c: fix a regression by r31690 on AIX because AIX malloc
	  return NULL if it's passed 0. But some caller don't expect it.
	  patch by Yutaka Kanemoto. [ruby-dev:43779]
	(vm_malloc_prepare): return calculated size.
	(vm_xmalloc): use above result.
	(vm_xcalloc): ditto.

Wed Jun 15 23:11:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c: remove BLOCKING_REGION_CORE() macro. It's no longer used
	  since r32022.

Wed Jun 15 21:00:47 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_config.rb: execute based on the existence of the
	  OpenSSL module.

Wed Jun 15 12:35:11 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io.rb (test_copy_stream_socket): wait a child process
	  before SIGUSR1 handler is removed.

	* test/pathname/test_pathname.rb (define_assertion): use line number
	  for test method names.

Wed Jun 15 10:37:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (rb_stat_rdev): use DEVT2NUM.

	* file.c (rb_stat_rdev_major): ditto.

	* file.c (rb_stat_rdev_minor): ditto.

Wed Jun 15 05:12:59 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (lib_eventloop_core): revert the last change (it's
	  the part for ruby_1_8), and use rb_thread_check_ints() when RUBY_VM
	  is defined.

Wed Jun 15 04:42:47 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm3_thread_*.rb: renamed bm_vm3_thread_*.rb to
	  benchmark/bm_vm_thread_*.rb.

Wed Jun 15 04:28:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_thread_pass.rb: rename bm_vm4* to
	  bm_vm_thread_*. suggested by ko1.
	* benchmark/bm_vm4_pipe.rb: ditto.
	* benchmark/bm_vm4_alive_check1.rb: ditto.
	* benchmark/bm_vm4_pass_flood.rb: ditto.

Wed Jun 15 03:52:50 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pass_flood.rb: new benchmark for GVL fairness.
	* benchmark/bm_vm4_alive_check1.rb: ditto.

Wed Jun 15 01:27:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_yield): fix live lock issue on 1-2 cpus
	  system. It's additional fix for r32021.
	* thread_pthread.c (gvl_init): add switch_wait_cond.
	* thread_pthread.h (typedef struct rb_global_vm_lock_struct): ditto.

Tue Jun 14 23:16:22 2011  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (show_progress): refine verbose mode.
	  (exec_test): ditto.

Tue Jun 14 23:02:36 2011  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (show_progress): extracted from assert_check.
	  (assert_check): use show_progress.
	  (assert_normal_exit): ditto.
	  (assert_finish): ditto.
	  (flunk): ditto.

Tue Jun 14 22:51:42 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_*.rb: added tests.

Tue Jun 14 22:09:58 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: renamed some functions.
	* ext/date/date_core.c: modified doc.

Tue Jun 14 21:26:01 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (cont_save_thread): add new utility function.
	  rb_context_t::saved_thread.machine_stack_start and
	  machine_stack_end should be cleared immediately after a snapshot of
	  current thread is stored to saved_thread. [ruby-dev:43680] [Bug #4855]
	  this change aims to get rid of unnecessary GC mark at machine stack.

Tue Jun 14 19:50:49 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_autoload.rb: remove temporary directory.

Tue Jun 14 11:05:03 2011  Narihiro Nakamura  <narihiro@netlab.jp>

	* gc.c (rb_gc_set_params): call initial_expand_heap if
	  initial_heap_min_slots is set.

Tue Jun 14 11:02:08 2011  Narihiro Nakamura  <narihiro@netlab.jp>

	* gc.c: use size_t.

Tue Jun 14 01:10:38 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/coverage/test_coverage.rb: add a test for restart.  a patch
	  from Xavier Shay.  [ruby-core:36745]

Tue Jun 14 01:05:10 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/coverage/coverage.c: make it restartable.  [ruby-core:36539]

Mon Jun 13 23:55:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_rec): call gvl_yield() unconditionally.
	* thread_pthread.c: remove HAVE_GVL_YIELD macro.
	* thread_win32.c (gvl_yield): new. this fallback logic was moved from
	  rb_thread_schedule_rec().

Mon Jun 13 23:50:25 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/io/console/console.c (console_dev): typo.

Mon Jun 13 23:38:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_parse_string): flush delayed token.  based on a
	  patch by Masaya Tarui in [ruby-dev:43762].  Bug #4544

	* parse.y (yylex): revert r24557.  delayed token at the end of
	  string should be flushed already by the above change.

Mon Jun 13 23:33:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_dev): console should be
	  unbuffered.

	* ext/io/console/console.c (console_dev): take care of no-ctty
	  case.

Mon Jun 13 23:06:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: rewrite GVL completely. This fix improve some
	  benchmark dramatically (e.g. vm3_thread_mutex result changed
	  form 120.601sec to 3.426sec).
	* thread_win32.c: ditto.
	* thread_pthread.h: ditto.
	* vm_core.h: ditto.
	* thread.c: ditto.

Mon Jun 13 23:11:52 2011  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_unix.rb: don't use Thread.abort_on_exception.

Mon Jun 13 23:05:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/unixsocket.c (unix_send_io): race condition fixed.
	  (unix_recv_io): ditto.
	  fixed by Eric Wong.  [ruby-core:35574]

	* test/socket/test_unix.rb: test added for above problem.

Mon Jun 13 21:41:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_win32.c (native_cond_signal): remove unnecessary rb_bug().
	  It's additional fix for r32021. [Bug #4696]

Mon Jun 13 20:50:49 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_ec.rb
	  test/openssl/test_pkey_ec.rb: merge both files into test_pkey_ec.rb.
	  Removed redundant group instantiation from PKey tests.
	* test/openssl/utils.rb: only create TEST_PKEY_EC_P256V1 if EC is
	  defined.

Mon Jun 13 20:28:24 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/digest.rb: remove MDC2 from test, it is not available
	  by default in an OpenSSL installation.

Mon Jun 13 20:18:55 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h, vm_insnhelper.h: move decl. of
	  ruby_vm_global_state_version and related macros
	  from vm_core.h to vm_insnhelper.h.

	* vm.c (vm_clear_all_cache): added.  This function is called
	  when ruby_vm_global_state_version overflows.
	  TODO: vm_clear_all_inline_method_cache() is only place holder.
	        We need to implement it ASAP.

	* vm_method.c (vm_clear_global_method_cache): added.

Mon Jun 13 19:46:21 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/cmath.rb: add new method Object#real?. fix #3137

Mon Jun 13 18:52:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (is_kind_of_BigDecimal): new function to
	  examine the whether the object is kind of BigDecimal.

Mon Jun 13 18:49:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimalCmp): use GetVpValueWithPrec
	  for Float and Rational arguments.

	* test/bigdecimal/test_bigdecimal.rb (test_new, test_cmp, test_power):
	  add and modify tests for the above change.

	* ext/bigdecimal/bigdecimal.c (BigDecimalCmp): modify coding style to
	  match ruby's standard.

Mon Jun 13 18:33:04 2011  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb (SecureRandom.random_bytes): modify PRNG state
	  to prevent random number sequence repetition at forked child
	  process which has same pid.
	  reported by Eric Wong.  [ruby-core:35765]

Mon Jun 13 17:02:34 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP#use_ssl?): require 'openssl' only when
	  https is needed. fixes r31933.

Mon Jun 13 14:35:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* lib/cmath.rb (CMath.cbrt): returns the principal value of the cube
	  root of the argument.  fix #3676

	* test/test_cmath.rb (test_cbrt_returns_principal_value_of_cube_root):
	  test for the above change.

Mon Jun 13 14:17:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* lib/test/unit.rb (Test::Unit::GlobOption#non_options): fix typo.

Mon Jun 13 13:04:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: fix error for digests that have no oid
	(e.g. DSS1).
	* test/openssl/test_digest.c: add tests for this.

Mon Jun 13 12:51:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/yaml.rb: load psych only when syck is not loaded.

Mon Jun 13 12:23:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

Mon Jun 13 12:23:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/psych/lib/psych/deprecated.rb (Object#to_yaml_properties):
	  undef to_yaml_properties before redefine it.

	* ext/syck/lib/syck/rubytypes.rb: ditto.

Mon Jun 13 11:30:10 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: allow Digests to be created by sn, ln or
	  oid.
	* test/openssl/test_digest.rb: add tests for this.
	  [Ruby 1.9 - Feature #4412] [ruby-core:35319]

Mon Jun 13 10:54:03 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/pkey_dh.c: corrected documentation.
	* test/openssl/utils.rb: add test key for DH.
	* test/openssl/test_pkey_dh.rb: add tests.

Mon Jun 13 10:13:08 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/pkey_dh.c: clarify difference between DH#public_key and
	DH#pub_key in documentation.

Mon Jun 13 05:50:43 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS: introduce PKey.read.

Mon Jun 13 05:17:29 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey.c: added PKey.read module function that allows
	  reading arbitrary public/private keys from DER-/PEM-encoded File or
	  string instances.
	* ext/openssl/ossl_pkey_dh.c: improved documentation.
	* test/openssl/utils.rb: added EC test key.
	* test/openssl/test_pkey_rsa.rb
	  test/openssl/test_pkey_dsa.rb: Test PKey.read. Reuse keys from
	  OpenSSL::TestUtils.
	* test/openssl/test_pkey_ec.rb: Created test file for EC tests.
	  Test PKey.read.
	  [Ruby 1.9 - Feature #4424] [ruby-core:35330]

Mon Jun 13 04:42:24 2011  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (total_i): fix to skip no ruby objects.

Mon Jun 13 03:07:38 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/benchmark/test_benchmark.rb (capture_output):
	  replace '-' as space. On NetBSD, subtract between two Process.times
	  after and before the short process may return negative value like:
	  t0=Process.times; yield; t1=Process.times; p t1.utime-t0.utime

Mon Jun 13 02:40:23 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Test for DSA#syssign/sysverify.

Mon Jun 13 01:59:19 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dh.c: completed documentation.
	* ext/openssl/ossl_pkey_dsa.c: corrected examples. Improved parameter
	  sections.

Mon Jun 13 00:25:10 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dsa.c: completed documentation.

Sun Jun 12 23:36:46 2011  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (kill_sub_thread): remove the method. [ruby-core:34185]

Sun Jun 12 21:01:56 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (d_lite_marshal_load): should give converted value.

Sun Jun 12 20:36:30 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: edited doc.

Sun Jun 12 18:12:07 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm3_clearmethodcache.rb: added.

Sun Jun 12 17:40:29 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_method.c (rb_clear_cache*): update only vm state version.

	* vm_method.c (rb_method_entry_get_without_cache, rb_method_entry):
	  Fill method cache entry with vm state version, and
	  check current vm state version for method (cache) look up.
	  This modification speed-up invalidating of global method cache table.
	  [Ruby 1.9 - Feature #3905] [ruby-core:36908]

Sun Jun 12 16:19:48 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: fail on Mac OS X. [Bug #4853][ruby-dev:43655]

Sun Jun 12 15:56:08 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c: remove th->transition_for_lock. It's thread unsafe.
	  [Bug #4723][ruby-dev:43563]

Sun Jun 12 15:47:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c: introduce spurious wakeup safe deadlock check.
	  [Bug #4696][ruby-dev:43554]

Sun Jun 12 13:33:52 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm3_thread_mutex.rb: remove it.

	* benchmark/bm_vm3_thread_mutex[1-3].rb: added 3 benchmarks.
	    1: one thread with one mutex (no contention).
	    2: two threads with one mutex (contention).
	    3: 1000 threads with one mutex (huge number of contention)
	  Above removed benchmark was type 3.
	  Therefore, this commit adds type 1 and 2 benchmark.

Sun Jun 12 11:16:59 2011  Tanaka Akira  <akr@fsij.org>

	* io.c: use select() appropriately for sendfile().
	  Fixed by Eric Wong.  [ruby-core:36150]
	  (maygvl_copy_stream_wait_readwrite): removed.
	  (nogvl_copy_stream_sendfile): use nogvl_copy_stream_wait_write and
	  maygvl_copy_stream_wait_read instead of
	  maygvl_copy_stream_wait_readwrite.

Sun Jun 12 09:32:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* atomic.h (ATOMIC_OR): _InterlockedOr is not available on mingw.h
	* gc.c (rb_gc_set_params): VM_OBJSPACE is disabled on mingw.

Sun Jun 12 01:07:09 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: edited doc.

Sat Jun 11 23:18:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (RUBY_VM_SET_TIMER_INTERRUPT, RUBY_VM_SET_INTERRUPT,
	  RUBY_VM_SET_FINALIZER_INTERRUPT): use atomic ops for preventing
	  interrupt_flag bit lost. [Bug #4770][ruby-dev:43467]
	* thread.c (rb_threadptr_execute_interrupts_rec): ditto.
	* vm_core.h (typedef struct rb_thread_struct): change type of
	  interrupt_flag to rb_atomic_t.
	* atomic.h: move atomic ops definition from signal.c.
	* signal.c: remove atomic ops definition.
	* common.mk (gc, signal, thread, cont): add to dependency to atomic.h.

Sat Jun 11 23:23:52 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: edited doc.

Sat Jun 11 23:02:36 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/buffering.rb (module OpenSSL):
	  Buffering#each_byte should return String in accordance with IO in
	  1.9.

	* test/openssl/test_buffering.rb (class OpenSSL): add tests for getc
	  and each_byte.

Sat Jun 11 22:41:37 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* time.c: a correction of doc for strftime (%v).

Sat Jun 11 22:30:53 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replaced doc for strftime based on Time's one.

Sat Jun 11 22:07:56 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (datetime_s_{iso8601,rfc3339,xmlschema,rfc2822,httpdate}):
	  do not take argument comp.

Sat Jun 11 21:58:31 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: added examples.

Sat Jun 11 19:40:45 2011  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: expand heap if initial_heap_min_slots is bigger than
	  HEAP_MIN_SLOTS.

Sat Jun 11 19:42:50 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ChangeLog (vim): set shiftwidth to 2.

Sat Jun 11 19:27:06 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_x509req.c: raise RequestError instead of
	  CertificateError when Request#to_der gets an error from OpenSSL.
	  Patch from Ippei Obayashi, see #4420. I cannot write a test for
	  this... Request does not allow to create broken bytes...

Sat Jun 11 19:34:51 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (Date::(ABBR_)?(MONTH|DAY)NAMES): should be usascii.

Sat Jun 11 19:24:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: rewrote doc.

Sat Jun 11 19:04:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GlobOption#non_options): should run
	  with 1.8.

Sat Jun 11 18:05:57 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* bootstraptest/runner.rb: should initialize $stress to avoid warnings.

Sat Jun 11 18:02:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_getc): should be 7bit if ascii.  fixes #4557

Sat Jun 11 16:52:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (rb_enc_uint_chr): fix message format. Bug#4869

Sat Jun 11 16:28:25 2011  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/formatters/pretty.rb
	  (REXML::Formatters::Pretty#write_text),
	  test/rexml/test_core.rb
	  (Tester#test_pretty_format_long_text_finite): don't ignore
	  'width' parameter in pretty formatter. fixes #4498
	  Reported by Michael Frasca. Thanks!!!

Sat Jun 11 16:11:36 2011  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb
	  (Tester#test_pretty_format_long_text_finite): remove needless
	  assert_nothing_raised.

Sat Jun 11 16:04:03 2011  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/parsers/xpathparser.rb
	  (REXML::Parsers::XPathParser#parse),
	  test/rexml/test_elements.rb
	  (ElementsTester#test_each_with_frozen_condition):
	  don't modify original XPath. fixes #4161
	  Reported by Pavel Shved. Thanks!!!

Sat Jun 11 15:53:27 2011  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_elements.rb (ElementsTester): remove needless
	  prefix from test name.

Sat Jun 11 15:36:36 2011  Martin Duerst  <duerst@it.aoyama.ac.jp>
	* common.mk: fixed a grammatical error

Sat Jun 11 14:20:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm.c (thread_memsize): don't ignore size of th->local_storage.

Sat Jun 11 10:32:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: should quote arch_hdrdir and libpath for the case
	  installed prefix contains spaces.

Sat Jun 11 10:20:52 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (native_cond_timeout): wrap conditionally used
	  label.

	* thread_pthread.c (native_sleep): remove unused variable.

Sat Jun 11 10:15:50 2011  Tanaka Akira  <akr@fsij.org>

	* thread.c (rb_thread_execute_interrupts): use GetThreadPtr to extract
	  rb_thread_t from VALUE.
	  reported by Motohiro KOSAKI.  [ruby-dev:43700]

Sat Jun 11 10:00:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_process_options): add missing return type.

Fri Jun 10 23:18:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/tk/tcltklib.c (lib_eventloop_core): replace CHECK_INTS with
	  rb_thread_check_ints(). Because current code can't be compiled.

Fri Jun 10 16:38:13 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_locale_charmap): When ruby process is run as Windows
	  Service the console codepage is not set, GetConsoleCP returns 0.
	  So on such environment, use GetACP().
	  http://blogs.msdn.com/b/michkap/archive/2005/02/08/369197.aspx
	  patched by Rafal Bigaj [ruby-core:36832] [Bug #4854]

Fri Jun 10 14:34:24 2011  Koichi Sasada  <ko1@atdot.net>

	* common.mk: restore TESTRUN_SCRIPT to "$(srcdir)/test.rb".
	  TESTRUN_SCRIPT is used by "make run", "make gdb" and so on.

Fri Jun 10 13:01:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_module.rb (TestModule#remove_rake_mixins): remove all
	  module related to Rake.

Fri Jun 10 09:52:38 2011  Eric Hodel  <drbrain@segment7.net>

	* encoding.c:  Mention that Encoding.compatible? can work with more
	  than just Strings.

Fri Jun 10 02:25:53 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: updating version to match released gem.

Fri Jun 10 01:06:29 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/bigdecimal (BigDecimal_to_i): Integer#** may return flonum.

Fri Jun 10 00:35:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (string_to_c_internal): uses rb_reg_nth_match;
	* rational.c (string_to_r_internal): ditto.

Fri Jun 10 00:25:03 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c: remove an unused declaration.

Fri Jun 10 00:24:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (string_to_r): Rational#** may return flonum.

Thu Jun  9 23:57:53 2011  Tanaka Akira  <akr@fsij.org>

	* io.c: fix IO.copy_stream interrupt handling.
	  based on the patch by Eric Wong.  [ruby-core:36156]

	* vm_core.h (rb_thread_call_with_gvl): don't declare here.

	* thread.c: include internal.h.
	  (rb_thread_execute_interrupts): new function.

	* internal.h (rb_thread_execute_interrupts): declared.
	  (rb_thread_call_with_gvl): declared.

Thu Jun  9 23:34:01 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (rb_objspace_call_finalizer): use rb_typeddata_is_kind_of() for
	  type check to get rid of a double free when main Thread has singleton
	  class. [ruby-core:36741] [Bug #4828]
	* thread.c (rb_obj_is_mutex): add a new utility function.
	* vm.c (rb_obj_is_thread): ditto.

Thu Jun  9 22:53:49 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_thread.rb (TestThread#test_kill_thread_subclass):
	  add test for Thread.kill with Thread subclass instance.

Thu Jun  9 22:31:47 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_thread.rb (TestThread#test_kill_wrong_argument):
	  test for [ruby-core:35086].
	  partially forward porting r31402 from ruby_1_9_2 branch.

Thu Jun  9 18:36:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* string.c: Fix the ambiguous description of the behavior of
	  rb_str_aref_m with a range.  It returns nil when the beginning of
	  the range is greater than the end of the string rather than the range.

Thu Jun  9 10:57:03 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Hash subclasses can be read
	  from YAML files.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Hash subclasses can be
	  dumped to YAML files.
	* test/psych/test_hash.rb: corresponding test.

Thu Jun  9 09:18:51 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Ruby modules can be loaded
	  from YAML files.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Ruby modules can be
	  dumped to YAML files.
	* test/psych/test_class.rb: corresponding test.

Thu Jun  9 09:05:04 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Ruby classes can be loaded
	  from YAML files.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Ruby classes can be
	  dumped to YAML files.
	* test/psych/test_class.rb: corresponding test.

Wed Jun  8 21:38:57 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (root_fiber_alloc): set root fiber's status RUNNING.
	  in cont_mark() only RUNNING fiber's machine stack is marked.
	  root fiber's status should be RUNNING at the beginning regardless of
	  FIBER_USE_NATIVE. [ruby-core:36735] fixes #4827

Tue Jun  7 20:50:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* doc/irb/irb.rd: fix typo. patch by Nobuhiro IMAI.
	  [Bug #4843] [ruby-dev:43639]
	* doc/irb/irb.rd.ja: ditto.
	* doc/ChangeLog-YARV: ditto.

Tue Jun  7 18:52:55 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rubygems/user_interaction.rb (Gem::StreamUI#tty?): IO#tty? of
	  Windows has been fixed at r29969.

	* test/rubygems/test_gem_stream_ui.rb: now can run tests.

Tue Jun  7 18:36:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rubygems/test_gem.rb (TestGem#{test_self_user_home_userprofile,
	  test_self_user_home_user_drive_and_path}): should simply ignore
	  meaningless tests instead of skipping them.

Tue Jun  7 18:15:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  should show some messages when skipping tests.

Tue Jun  7 13:59:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (date_s_today, datetime_s_now): check the
	  result of localtime_r().

Tue Jun  7 13:36:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/extconf.rb: use $defs not $CPPFLAGS to get rid of
	  command line escape issues on Windows.  fixed #4835.

Tue Jun  7 03:18:45 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_io.rb (TestIO#test_s_{,bin}write): do not create a
	  file under /tmp. [Bug #4846]

Mon Jun  6 22:51:43 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c: use #if FIBER_USE_NATIVE instead of #ifdef.
	  you can suppress use of setcontext for Fiber with compile option
	  -DFIBER_USE_NATIVE=0

Mon Jun  6 21:59:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_switch_hitter.rb: added a test.

Mon Jun  6 21:37:45 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: added notes.

Mon Jun  6 21:02:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: flattened format to strftimev.
	* ext/date/date_core.c (date_strftime_internal): taints run.

Mon Jun  6 15:10:17 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/{defines,missing}.h (rb_infinity, rb_nan): move from
	  defines.h to missing.h.  (couldn't use RUBY_EXTERN there.)

Mon Jun  6 14:35:48 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_markup_pre_process.rb (TestRDocMarkupPreProcess#
	  {test_include_file,test_include_file_encoding_incompatible}): no
	  need to write such workaround.  don't hide the bug of ruby. (and the
	  bug is already fixed.)

Mon Jun  6 14:11:11 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/date/date_core.c (valid_jd_sub): need to convert from VALUE to
	  double.

	* ext/date/date_core.c (offset_to_sec): get rid of a compiler warning.

Mon Jun  6 14:09:08 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/defines.h (rb_infinity, rb_nan): export for Windows.

Mon Jun  6 10:54:45 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Runner#puke):
	  Add overriding from MiniTest::Unit#puke. This reverts minitest's fix
	  that skip messages are hidden when not verbose mode (-v option).
	  To hide skip messages, use --hide-skip option instead.

Mon Jun  6 10:52:13 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: don't use autoload.

Mon Jun  6 09:39:43 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): release event objects to plug memory
	leak.  Thanks Mark J. Titorenko!

Sun Jun  5 23:26:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* eval.c: remove rb_thread_stop_timer_thread function declaration.
	  Instead, include vm_core.h.
	* process.c: ditto.

Sun Jun  5 21:38:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (thread_timer): add to care a spurious wakeup.
	  When native_cond_timedwait() return 0 by spurious wakeup, we
	  don't have to neither 1) call timer_thread_function and 2)
	  exit the timer thread.

Sun Jun  5 17:50:01 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (m_real_cwyear): new.  derived from m_cwyear.
	* ext/date/date_strftime.c: trivial changes.

Sun Jun  5 17:22:01 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/config_list.in: add new options for tcltklib.

Sun Jun  5 10:06:50 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_tmx.h: now does not place decoded data.  allows to
	  access indirectly via functions on demand.
	* ext/date/date_strftime.c: ditto.
	* ext/date/date_core.c: ditto.
	* ext/date/date_core.c ({d|dt}_lite_to_s): use strftime.

Sun Jun  5 06:22:02 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* NEWS: wrote about changes of date.

Sat Jun  4 16:59:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (d_lite_inspect): changed the format.
	* ext/date/date_core.c: refactoring and fixing some bugs.

Sat Jun  4 11:30:57 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (check_mix_method_i, do_mix_method_i): not mix methods
	  renamed as nil.

Sat Jun  4 04:04:41 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rubygems/test_gem_commands_which_command.rb:
	  "missing" exists on ruby's top source directory. [Bug #4815]

Fri Jun  3 21:48:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rubygems/test_case.rb: Refix for test-all in separate directory.
	  r31147 + r31151.

Fri Jun  3 20:58:47 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/date/date_core.c (d_lite_plus): get rid of compiler warnings.

Fri Jun  3 20:56:40 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/missing.h, numeric.c (round): moved prototype of round()
	  from numeric.c to missing.h.  (note: round() is C99 feature, so ruby
	  provides it if not exist in C runtime.)

Fri Jun  3 20:42:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Keep $stdin, $stdout before run testcase
	  and restore after run. Because some test break $stdin, $stdout.
	  Fixes [Bug #4433] [ruby-core:35353]

Fri Jun  3 19:58:14 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_fflush): windows -- call fsync() only when the FD is tied to
	  file, because if the FD is pipe, it blocks.

Fri Jun  3 09:27:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (URI::HTTP#request_uri): return nil when the uri
	  is path-rootless form. Bug #4759

Thu Jun  2 23:51:03 2011  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Improve the line ending detection algorithm
	  patch by Alexey).

Thu Jun  2 20:05:57 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_s_write, rb_io_s_binwrite): return!!!

Thu Jun  2 16:29:34 2011  Shota Fukumori  <sorah@tubusu.net>

	* io.c: Add File.write, File.binwrite. [Feature #1081] [ruby-core:21701]

	* test/ruby/test_io.rb: Test for File.write, File.binwrite.

	* NEWS: News for above.

Thu Jun  2 12:33:09 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_fflush, rb_io_flush): need to fsync() when ruby calls
	  internal flush. [ruby-core:36670] [Bug #4813]

Thu Jun  2 07:56:24 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: reduce CPU power required by an eventloop.

Tue May 31 21:28:33 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring):
	  redirect stderr to null device.

Thu Jun  2 00:45:26 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: fix for uninitialized global variables.
	  [Ruby 1.9 - Bug #4811]

Wed Jun  1 21:57:08 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_sleep): fix 1000times calculation error.
	  this is a regression since r31457. [Bug #4808] [ruby-dev:43606]

Wed Jun  1 17:19:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: remove unused macro.

Wed Jun  1 15:42:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (peek_n): new macro to see next nth char.

Wed Jun  1 15:40:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): fix for rubygems change.

Wed Jun  1 14:07:57 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*: Imported minitest 2.2.2 (r6281)
	* test/minitest/*: ditto

Wed Jun  1 12:35:50 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.8.5 (released @ 137c80f)
	* test/rubygems: Ditto

Wed Jun  1 12:34:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: add new features of bigdecimal.

Wed Jun  1 09:41:14 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi/util.rb:  Improve documentation.  Patch by Kuba Fietkiewicz.
	  [Ruby 1.9 - Bug #4775]
	* lib/cgi/core.rb:  ditto

Wed Jun  1 09:26:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Improve documentation and attach it to Numeric.
	  Modified from patch by Anil V.  [Ruby 1.9 - Bug #4762]

Wed Jun  1 09:21:30 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/prime.rb:  Indent examples enough to appear as code sections.
	  Note that Prime is Enumerable.  [#4762]

Wed Jun  1 07:34:57 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c (key_i):  Change rdoc from "the first occurrence" to "an
	  occurrence" since first occurrence is not a specification of
	  Hash#key.  [Ruby 1.9 - Bug #4760]

Wed Jun  1 07:26:19 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/pty/pty.c (pty_check):  Restore "not reached" comment.
	  [Ruby 1.9 - Bug #4756]

Wed Jun  1 07:21:40 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Fix document-method declarations for set_sync and
	  set_comment.  [Ruby 1.9 - Bug #4695]

Wed Jun  1 06:43:13 2011  Masaya Tarui  <tarui@ruby-lang.org>

	* load.c (loaded_feature_path): cut nonsense loop execution to fix
	  performance bug.

Wed Jun  1 01:16:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_mix_module): implement Module#mix.

Wed Jun  1 01:15:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_encoding_set): should honor already set ecflags since it
	  might be set by mode option.  fixed #4804

Wed Jun  1 00:34:04 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): remove unused
	  variable.

Wed Jun  1 00:32:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): support instantiation from
	  a Float through Rational.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_new): ditto.

	* test/bigdecimal/test_bigdecimal.rb (test_global_new_float): add a test for
	  the above changes.

	* test/bigdecimal/test_bigdecimal.rb (test_new_with_float): ditto.

Wed Jun  1 00:07:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_coerce): support coerce with a
	  Rational.  The precision used for instantiate a BigDecimal from the
	  given Rational is obtained from the receiver BigDecimal.

	* test/bigdecimal/test_bigdecimal.rb (test_coerce): add a test for the
	  above change.

Tue May 31 23:49:08 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (offset_to_sec): fixed invalid validation.

Tue May 31 23:43:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): replace the algorithm for
	  coercing from a Rational to stop requiring "bigdecimal/util.rb".
	  [ruby-core:34318]

	* ext/bigdecimal/bigdecimal.c (GetVpValue): refactoring.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_new): support instantiation from a
	  Rational.

	* test/bigdecimal/test_bigdecimal.rb (test_global_new_with_rational): add a
	  test for the above change.

	* test/bigdecimal/test_bigdecimal.rb (test_new_with_rational): ditto.

Tue May 31 22:44:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_new): support instantiation a
	  BigDecimal object from an Integer.

	* test/bigdecimal/test_bigdecimal.rb (test_new_with_integer):
	  add for testing the above change.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_global_new): replace its body
	  with a BigDecimal_new call.

	* test/bigdecimal/test_bigdecimal.rb (test_global_new_with_integer):
	  add for testing the above change.

Tue May 31 22:24:39 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: use simple/complex mode instead of light/right mode.
	* test/date/*.rb: followed the above changes.

Tue May 31 21:28:33 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring):
	  initialize SIGINT handler.

Tue May 31 17:03:24 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/net/http.rb, lib/net/protocol.rb: Allow to configure to wait
	  server returning '100 continue' response before sending HTTP request
	  body. See NEWS for more detail. See #3622.
	  Original patch is made by Eric Hodel <drbrain@segment7.net>.

	* test/net/http/test_http.rb: test it.

	* NEWS: Add new feature.

Tue May 31 14:17:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_s_pipe): potential bug. the mode of read IO is set as
	  DEFAULT_TEXTMODE in call of io_set_encoding(), and of write IO is
	  also set as it in call of io_new_instance() via rb_protect().
	  so, if DEFAULT_TEXTMODE is not 0, we should check the result of
	  extract_binmode() and avoid crush of default IO mode and the result.

Tue May 31 13:00:17 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* strftime.c (rb_strftime_with_timespec): improved style consistency.
	  constified some variables.

	* test/test_time.rb (TestTime#test_huge_precision): test for #4456.

Tue May 31 12:53:10 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/io/wait/test_io_wait.rb (TestIOWait#{test_nread,test_ready?,
	  test_wait}: give system some time to process the written data.

Tue May 31 12:40:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#test_open_mode): MUST release resources
	  explicitly. fix problem of r31671

Tue May 31 10:49:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c: remove conditions for clang
	  because clang version 3.0 (trunk 132165) doesn't need them.

Mon May 30 22:19:33 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring): don't
	  close stderr.

Mon May 30 20:22:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring): small
	  but critical typo of r31642.  sorry...
	  [Bug #4798] [ruby-core:36550]

Mon May 30 15:44:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* insns.def (opt_mult): as r31805, volatile it.
	  Without this, clang -O fails calculation.

	* numeric.c (fix_mul): ditto.

	* rational.c (f_imul): ditto.

Mon May 30 10:26:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_pow): make sure to assign the result of x * z.
	  If xz is optimized out, the value won't overflow.

Sun May 29 23:17:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_match): fix rdoc of Regexp#=~.
	  patched by Tsuyoshi Sawada. [Bug #4781]

Sun May 29 23:10:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/https.rb (WEBrick::HTTPRequest#parse_uri):
	  keep parse_uri as private. patched by okkez. [Bug #4773]

Sun May 29 17:53:03 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* numeric.c: add #include "internal.h" for rb_big_uminus() prototype.

Sun May 29 15:09:05 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): fix for negative value.

Sun May 29 02:16:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/net/http/utils.rb (TestNetHTTPUtils#teardown): add nil check.

Sun May 29 00:22:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec, after_exec): change from macro to function.

Sat May 28 19:30:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec, after_exec): change SIGPIPE handler to SIG_DFL
	  before calling execve(). Because r31760 reintroduced an issue that
	  system() may hang up (i.e. [ruby-dev:12261]).
	* process.c (save_sigpipe, restore_sigpipe): new.

Sat May 28 16:08:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (Init_signal, default_handler): change default SIGPIPE handler
	  from empty function to SIG_IGN. [ruby-dev:43215]
	* signal.c (sigpipe): removed.

Sat May 28 03:04:27 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (fill_cbuf): return MORE_CHAR_SUSPENDED when cbuf is not empty.

Sat May 28 02:22:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (rb_str_bytesize): rb_str_bytesize() should use LONG2NUM().
	  Patch by Nikolai Weibull. [Bug #4789] [ruby-core:36511]

Sat May 28 02:06:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (fill_cbuf): Fix test-all crash.

Sat May 28 00:58:40 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/ostruct.rb (method_missing): Handle [] and []= correctly.
	  Based on a patch by Caius Durling, bug #4179 [ruby-core:33792]

Fri May 27 23:56:54 2011  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb (Tester::test_text_frozen): split frozen
	  string test. refs #4783

Fri May 27 22:46:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): install gemspec of json.  fixed #4784

Fri May 27 22:45:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (validate_enc_binmode): do not clear textmode flag if
	  default.  fixed #4732

	* io.c (fill_cbuf): finish reading at EOF.

Fri May 27 11:31:51 2011  misfo <tedwardo2@gmail.com>

	* lib/rexml/text.rb (REXML::Text#initialize): prevent an error
	  when passing a frozen string to REXML::Text.new

	  dup the string passed in instead of cloning so that it's frozen
	  state is ignored

Fri May 27 08:47:26 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* thread.c (ppoll): typo bug fix.

Fri May 27 08:35:04 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: hang-up at exit before calling Tk.mainloop.

	* ext/tk/lib/tk/extconf.rb: cannot make on MinGW [Ruby 1.9 - Bug #4141].

Thu May 27 00:34:07 2011  James Edward Gray II  <jeg2@ruby-lang.org>

    * lib/csv.rb: Enhance each() to support Enumerator.

Thu May 26 10:32:11 2011  James Edward Gray II  <jeg2@ruby-lang.org>

    * lib/csv.rb: Documentation improvements from Ysiad Ferreiras.
      [Ruby 1.9 - Bug #4785]

Thu May 26 15:42:02 2011  Cezary Baginski <cezary.baginski@gmail.com>

	* lib/xmlrpc/parser.rb (FaultException): fix to_s and inspect

	* test/xmlrpc/parser.rb: test for the above

Wed May 25 11:54:31 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Remove color constants block.
	  [Ruby 1.9 - Bug #4748]

Wed May 25 09:56:45 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Add missing documentation for button state, MIN
	  and MAX comments.  Add Curses. to TABSIZE= and ESCDELAY= methods.
	  [Ruby 1.9 - Bug #4747]

Wed May 25 09:35:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Restore nodoc for Benchmark::Job and
	  Benchmark::Report.  [Ruby 1.9 - Bug #4726]

Wed May 25 09:29:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/pop.rb:  Hide implementation details from RDoc.
	  [Ruby 1.9 - Bug #4711]

Wed May 25 09:26:29 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/ftp.rb:  Add :nodoc: for private methods.
	  [Ruby 1.9 - Bug #4710]

Wed May 25 09:19:17 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Fix Document-method declarations.  Improve
	  Zlib::GzipFile's method catalog.  [Ruby 1.9 - Bug #4695]

Wed May 25 08:22:12 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/erb.rb:  Hide documentation for implementation details of ERB.
	  [Ruby 1.9 - Bug #4694]

Wed May 25 07:58:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile.{mkdir,rmdir}): revert for backward
	  compatibility.

Wed May 25 07:13:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* spec/README: update the description.

Wed May 25 07:12:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile.{lock,unlock}_tempfile): refactor.

Tue May 24 17:30:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* spec/README: fix typo.
	  patched by bowsersenior. https://github.com/ruby/ruby/pull/24

Tue May 24 07:06:34 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fail to start Tk.mainloop (exit immediately) on
	  some environment (reported on [ruby-talk:381444]).

	* ext/tk/lib/tk/canvas.rb: support creating a canvas item object from
	  an item ID number.

	* ext/tk/lib/tk/image.rb: import documents which are pull-requested.
	  [Ruby 1.9 - Feature #4595]

	* ext/tk/lib/tk/extconf.rb: search directories for 64bit library (e.g.
	  /usr/lib64), add some new configure options (see README.tcltklib),
	  and bug fix.

	* ext/tk/lib/tk/README.tcltklib: modify docs for some new configure
	  options.

Tue May 24 04:01:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/yaml.rb: switch default YAML engine to Psych, old syck engine
	  may be enabled via YAML::ENGINE.yamler = "syck". [ruby-core:36374]

Mon May 23 09:45:26 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): Revert r30508. Forgot to
	  include this file in the commit r31692. __APPLE__ is not
	  CASEFOLD_FILESYSTEM again, from this time.

Mon May 23 10:01:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Do not parse zero-tagged values as EOC. Do
	  not let current length become negative for infinite length constructed
	  values. Support constructed values of length zero. Added tests.

Mon May 23 09:19:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/smtp.rb:  Document Net::SMTP::Response.  Patch by J.R. Garcia.
	  [Ruby 1.9 - Bug #4768]

Mon May 23 09:03:52 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Never Ignore SIGINT. When received
	Interrupt, immediately puts result and exit. [ruby-dev:43571]

	* lib/test/unit.rb: When received Interrupt, wait results from workers
	and collect them. [ruby-dev:43571]

Mon May 23 09:08:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4767]

Mon May 23 08:45:55 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ostruct.rb:  Improve documentation.  Patch by Franklin Webber.
	  [Ruby 1.9 - Bug #4761]

Mon May 23 08:35:24 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c:  Improve documentation of Hash#key.  Patch by Utkarsh
	  Kukreti.  [Ruby 1.9 - Bug #4760]

Mon May 23 08:32:59 2011  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c:  Improve documentation.  Patch by Dave Copeland.
	  [Ruby 1.9 - Bug #4757]

Mon May 23 07:19:45 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS (openssl): Infinite length support. Different behavior of
	  Constructive and Primitive constructors.

Mon May 23 06:58:33 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Forbid Constructives whose value is not an
	  Array to prevent segfault. Added test.

Mon May 23 06:33:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Forbid Constructive without infinite
	  length. This also prevents a segfault. Added test and improved
	  documentation.

Mon May 23 05:58:14 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Fix decoding of infinite length values.
	  Simplified ossl_asn1_decode0 by splitting it into three separate
	  functions. Add tests.
	  [Ruby 1.9 - Bug #4374][ruby-core:35123]

Mon May 23 04:03:46 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1_initialize): Allow creation of
	  Constructives with an explicit tag_class parameter without
	  automatically setting tagging to :EXPLICIT. Fixes a bug when encoding
	  infinite length primitive values.

Mon May 23 04:03:46 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1_cons_to_der): Add an additional
	  EOC for infinite length Constructives that are supposed to be encoded
	  with explicit tagging. Also tabify method correctly.

Mon May 23 03:44:39 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1data_to_der): Remove redundant
	  flag tmp_cons.

Mon May 23 00:35:00 2001  Kenta Murata  <mrkn@mrkn.jp>

	* bignum.c (dump_bignum, bigmul1_balance, big_split, biglsh_bang),
	  (bigrsh_bang, big_split3, bigmul1_toom3, bigmul0): implement Toom3 (Toom-Cook)
	  multiplication.

	* include/ruby/defines.h: add format prefixes for BDIGIT and BDIGIT_DBL.

Sun May 22 23:24:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Instead of rb_intern use static symbols to
	  improve performance.

Sun May 22 21:56:51 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Use OpenSSL constants V_ASN1_xxx instead of
	  hardcoded numbers for initializing class_tag_map.

Sun May 22 21:29:29 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): Revert r30508. See #4255.
	  Now __APPLE__ is not CASEFOLD_FILESYSTEM again.

	* load.c (loaded_feature_path, rb_feature_p, load_lock): Revert r30508.
	  See #4255. Make $LOADED_FEATURES scanning case-sensitive again.

Sun May 22 18:59:27 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_asn1.c(ossl_asn1_default_tag): avoid using RCLASS_SUPER
	  to make it compilable. Plus, tabify and change variable definition style.

Sun May 22 18:26:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (vm_xcalloc): use calloc provided by platforms.
	  fixes #4754

Sun May 22 11:44:53 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/pty/pty.c:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4756]

Sun May 22 11:26:39 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4755]

Sun May 22 11:21:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ipaddr.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4753]

Sun May 22 11:14:40 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/forwardable.rb:  Document def_delegator.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4752]

Sun May 22 11:11:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/fileutils.rb:  Document block behavior of FileUtils.cd.  Patch by
	  Bil Kleb.  [Ruby 1.9 - Bug #4751]

Sun May 22 11:07:47 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Complete documentation.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4748]

Sun May 22 09:29:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  use spawn. it prevent that other tests inherit renamed $0.

Sun May 22 08:57:13 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Default tag lookup in constant time via hash
	  instead of previous linear algorithm.
	  [Ruby 1.9 - Feature #4309][ruby-core:34813]

Sun May 22 07:54:16 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: Explain DSS and DSS1 in documentation.

Sun May 22 07:10:25 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Add tests for sign/verify.

Sun May 22 06:07:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_x509cert.rb: Merge DSA-related tests from ruby_1_8
	  branch.

Sun May 22 04:11:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (Init_Thread): add a code comment why the meaningless
	  line is necessary.

Sun May 22 01:35:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified documentation.

Sat May 21 22:46:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime(date_strftime_with_tmx): "%v" means "%e-%b-%Y".

Sat May 21 22:14:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_extract_modeenc): accept combination hash and
	  File::Constants. (eg. File.open('yo', :mode => File::WRONLY))
	  [Feature #4742][ruby-core:36338]
	* test/ruby/test_io.rb (TestIO#test_open_mode): new test.

Sat May 21 21:44:14 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_switch_hitter.rb: new.

Sat May 21 21:18:29 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{core,parse}.c: moved nearly all core code from ext/date/lib.
	* ext/date/lib/{date,date/format}.rb: removed nearly all code.

Sat May 21 02:58:46 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/.document:  Add curses to documented extensions.
	* ext/curses/curses.c:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4747]

Sat May 21 02:51:01 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/bigdecimal/lib/bigdecimal/util.rb:  Improve documentation.  Patch
	  by Pete Higgins.  [Ruby 1.9 - Bug #4746]

Sat May 21 02:44:10 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/bigdecimal/lib/bigdecimal/jacobian.rb:  Document isEqual.  Patch
	  by Kuba Fietkiewicz.  [Ruby 1.9 - Bug #4744]

Sat May 21 02:22:34 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/date/lib/date/format.rb:  Document date formats.  Patch by
	  Clinton Nixon.  [Ruby 1.9 - Bug #4743]

Fri May 20 05:15:19 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* gc.c: Fix build on m68k by 'error: too few arguments to
	  function 'mark_locations_array''.

Fri May 20 04:23:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/scanf.rb:  Improve documentation.  Patch by Gabe McArthur.
	  [Ruby 1.9 - Bug #4735]

Fri May 20 00:58:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/ibm737-tbl.rb: greek code page.  fixes #4738

Thu May 19 14:44:05 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_signal.rb (test_signal_requiring): skip on Windows.
	  we can send SIGINT only to pid 0 and the process itself.

Thu May 19 09:07:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib: revert r31635-r31638 and untabify with expand(1).

Thu May 19 07:47:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_rsa.rb: Add tests for sign/verify.

Thu May 19 07:19:16 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey.c: Add documentation.

Thu May 19 07:06:56 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Fix indentation.
	* lib/net/imap.rb:  Fix indentation of regular expressions.

Thu May 19 06:36:11 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/imap.rb:  Fix indentation of EOF for heredoc.
	* lib/debug.rb (Commands):  Fix indentation of EOHELP for heredoc.

Thu May 19 06:30:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mkmf.rb:  Fix indentation of EOM for heredoc.

Thu May 19 06:16:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib:  Convert tabs to spaces for ruby files per
	  http://bugs.ruby-lang.org/projects/ruby/wiki/DeveloperHowto#coding-style
	  Patch by Steve Klabnik [Ruby 1.9 - Bug #4730]
	  Patch by Jason Dew [Ruby 1.9 - Feature #4718]

Thu May 19 06:06:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi/util.rb:  Improve documentation.  Patch by Clinton Nixon.
	  [Ruby 1.9 - Bug #4733]
	* lib/cgi/core.rb:  ditto
	* lib/cgi/cookie.rb:  ditto

Thu May 19 06:02:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/tempfile.rb:  Document Dir.mkdir and Dir.rmdir.  Patch by Clinton
	  Nixon.  [Ruby 1.9 - Bug #4728]

Thu May 19 05:57:52 2011  Eric Hodel  <drbrain@segment7.net>

	* encoding.c:  Improve documentation for Encoding#default_external and
	  Encoding#default_internal.

Wed May 18 22:45:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/lib/console/size.rb (IO#console_size): new
	  method.  (EXPERIMENTAL)

Wed May 18 22:41:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* internal.h: add for internal use only.

Wed May 18 22:36:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (setup_exception): internal exception should be hidden

Wed May 18 20:25:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/timeout.rb (Timeout#timeout): don't leak "execution expired"
	  exception. [Bug #4283] [ruby-core:34534].

Wed May 18 06:09:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Add some examples and improve documentation.  Patch by
	  Sandor Szucs.  [Ruby 1.9 - Bug #4727]

Wed May 18 05:40:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Remove nodoc from Benchmark::Job and
	  Benchmark::Report.  Patch by Sandor Szucs.  [Ruby 1.9 - Bug #4726]

Wed May 18 05:29:26 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/compat.rb:  Improve documentation.  Patch by Sandor
	  Szucs.  [Ruby 1.9 - Bug #4725]

Wed May 18 05:10:35 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/tracer.rb:  Improve documentation.  Patch by Richard Ramsden.
	  [Ruby 1.9 - Feature #4720]

Wed May 18 04:53:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Improve documentation.  Patch by Jason Dew.
	  [Ruby 1.9 - Feature #4717]

Wed May 18 04:50:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/ftp.rb:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4710]

Wed May 18 03:14:49 2011  Eric Hodel  <drbrain@segment7.net>

	* test/test_singleton.rb:  Add tests from lib/singleton.rb.  Patch by
	  Pete Higgins.  [Ruby 1.9 - Bug #4715]

Wed May 18 03:03:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/singleton.rb:  Improve documentation.  Patch by Pete Higgins.
	  [Ruby 1.9 - Bug #4709]

Tue May 17 21:24:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_lock): remove remove_signal_thread_list() call.
	  It's meaningless because lock_interrupt doesn't call
	  add_signal_thread_list().

Tue May 17 20:20:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (rb_thread_struct): add volatile to
	  transition_for_lock because it is not protected by lock.

Tue May 17 20:08:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* LEGAL (missing/{elf,tgamma,lgamma_r}.c): they've been replaced by
	  public domain implementations.

	* LEGAL (vsnprintf.c): it has moved to srcdir from missing/.

	* LEGAL (missing/crypt.c): list its original license.

Tue May 17 19:54:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* LEGAL (configure): add missing/setproctitle.c

Tue May 17 19:35:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	Fix FreeBSD test failure.

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  use ps -o command instead of ps -o cmd. FreeBSD doesn't support
	  -o cmd option.

Tue May 17 08:04:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: Add documentation.

Tue May 17 07:14:58 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Improve documentation of proxy configuration
	  methods.  Patch by Alf Mikula.  [Ruby 1.9 - Bug #4714]

Tue May 17 07:09:01 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/pop.rb:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4711]
	* lib/net/telnet.rb:  ditto

Tue May 17 07:00:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Fix nodoc for Net::HTTP::version_1_1?.  Patch by
	  Alf Mikula.  [Ruby 1.9 - Bug #4713]

Tue May 17 06:56:26 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/optparse.rb:  Add link to make_switch to improve documentation.
	  Patch by David Copeland.  [Ruby 1.9 - Bug #4708]

Tue May 17 06:50:40 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/observer.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4707]

Tue May 17 06:42:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/logger.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4706]

Tue May 17 06:28:14 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/gserver.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4705]

Tue May 17 06:21:15 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi.rb: Add toplevel documentation to class CGI
	* lib/cgi/session.rb: Add overview documentation to CGI::Cookie
	* lib/cgi/html.rb:  Don't add CGI::TagMaker documentation to CGI.
	  Patch by David Copeland.  [Ruby 1.9 - Bug #4704]
	* lib/cgi/core.rb:  Clean up CGI documentation.  Patch by David
	  Copeland.  [Ruby 1.9 - Bug #4704]
	* lib/cgi/cookie.rb:  Clean up CGI::Cookie documentation.  Patch by
	  David Copeland.  [Ruby 1.9 - Bug #4704]

Tue May 17 05:52:30 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/digest: Improve documentation of Digest, Digest::HMAC and
	  Digest::SHA2.  Patch by Pete Higgins.  [Ruby 1.9 - Bug #4702]

Tue May 17 03:51:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/abbrev.rb:  Hide copyright and revision information from RDoc.
	  Inspired by patch from David Copeland, bug #4703.

Tue May 17 03:33:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb (module Timeout):  Hide internal constants.  Patch by
	  Pete Higgins.  [Ruby 1.9 - Bug #4701]

Mon May 16 11:21:09 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (RUBY_SO_NAME): add CPU as prefix
	  of RUBY_SO_NAME on x64/ia64 mswin/mingw.
	  [Feature #4602]

Mon May 16 08:00:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb:  Update to RDoc 3.6.1, allows OpenSSL::Digest to be
	  found.

Mon May 16 05:49:54 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/drb/acl.rb:  Add documentation.

Mon May 16 05:13:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Add documentation.

Mon May 16 00:32:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_signal.rb (TestSignal#test_signal_process_group):
	  skip if the platform doesn't have :pgroup capability. (i.e. skip
	  if mswin32)

Sun May 15 23:53:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h: resurrect old rb_fd_copy().
	* thread.c (rb_fd_copy): ditto.

Sun May 15 23:45:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h: remove rb_fd_copy() to rb_fd_dup() and
	  rb_w32_fdcopy() to rb_w32_fd_dup().
	* win32/win32.c: ditto.
	* thread.c: ditto.

Sun May 15 22:26:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* signal.c (rb_f_kill): accept '-SIGXXX' style signal with Symbol or
	  implicit conversion with #to_str. [ruby-dev:43169] fixes #4362
	* test/ruby/test_signal.rb (test_signal_process_group): add a test
	  for send signal to process group.

Sun May 15 21:22:35 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (cont_init): clear macihne_stack_start/end of saved thread to
	  prevent mark machine stack of GC'ed Thread. root Fiber is not
	  initialized by fiber_init().
	  based on a patch by Serge Balyuk [ruby-core:35891] fixes #4612
	* test/ruby/test_fiber.rb (test_gc_root_fiber): add test for it.

Sun May 15 21:04:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (econv_init): revert r31353.  [ruby-dev:43512]

Sun May 15 03:39:35 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4695]

Sun May 15 03:23:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/erb.rb:  Document ERB::Compiler.  Patch by Simon Chiang.
	  [Ruby 1.9 - Bug #4694]

Sun May 15 00:58:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix mswin32 build error.

	* missing/setproctitle.c: add #ifdef HAVE_UNISTD_H.
	* win32/Makefile.sub (MISSING): add setproctitle.obj

Sat May 14 22:45:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* missing/setproctitle.c: add to include "ruby/util.h".

Sat May 14 19:52:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  add for $0 test.

Sat May 14 19:50:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* missing/setproctitle.c (compat_init_setproctitle): use
	  ruby_strdup() instead of strdup().

Sat May 14 19:37:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/missing.h: add setproctitle() declaration.
	* missing/setproctitle.c: added.
	* configure.in: add check for missing/setproctitle.c.

	* ruby.c (ruby_process_options): add to call compat_init_setproctitle().
	* ruby.c (set_arg0): remove all platform specific code. it's
	  moved to missing/setproctitle.c.
	* ruby.c (origarg): remove len field. It's no longer used.
	* ruby.c (get_arglen): removed.

	This patch makes a lot of cleanup set_arg0 related code and fixes
	[Feature #4689].

Sat May 14 17:42:21 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* process.c (rb_proc_times): improve documentation.
	  [ruby-core:35785] fixes #4581, reported by Andrew Grimm.

Sat May 14 12:12:54 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Add basic tests and tests that
	  ensure new public key PEM encoding behavior and ensure backward
	  compatibility.
	  [Ruby 1.9 - Bug #4422] [ruby-core:35328]
	* test/openssl/test_pkey_rsa.rb: Remove line with 'puts'.

Sat May 14 12:06:49 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/context.rb (class RDoc):  Fix infinite loop caused by
	  re-encountering BasicObject.

Sat May 14 10:32:36 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_rsa.rb: Add tests that ensure new public key
	  encoding behavior and also ensure backward compatibility.
	  [Ruby 1.9 - Bug #4421] [ruby-core:35327]

Sat May 14 09:50:10 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/yaml/dbm.rb:  Add documentation.  Patch by Justin Collins.
	  [Ruby 1.9 - Bug #4693]
	* lib/yaml/store.rb:  ditto

Sat May 14 09:31:43 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb: Updated to RDoc 3.6

Sat May 14 07:30:29 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: released a new gem, so increasing version.

Sat May 14 05:08:32 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c
	* ext/openssl/ossl_pkey.c
	* ext/openssl/ossl_pkey.h
	* test/openssl/pkey/test_pkey_rsa.rb
	  Reverted premature commit. Sorry for the noise!

Sat May 14 05:02:58 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/uri.rb:  Add toplevel documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4690]

Sat May 14 04:19:06 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS: Describe altered behaviour for RSA and DSA public key
	  encoding. [Ruby 1.9 - Bug #4421, Bug #4422]
	  [ruby-core:35327,35328]

Sat May 14 02:57:52 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ipaddr.rb (unless Socket):  Document valid*? methods.  Patch by
	  Sebastian Martinez.  [Ruby 1.9 - Feature #4687]

Sat May 14 02:54:04 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rexml/functions.rb:  Add some documentation for REXML::Functions.
	  Patch by Sebastian Martinez.  [Ruby 1.9 - Feature #4688]

Sat May 14 02:51:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/resolv.rb:  Hide private method and state-tracking constants from
	  RDoc.  Patch by Mark Turner.  [Ruby 1.9 - Feature #4691]

Fri May 13 19:23:21 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* numeric.c (flo_coerce): Add #flo_coerce documentation.
	  Patch by Sebastian Martinez.
	  https://github.com/ruby/ruby/pull/21

Fri May 13 18:42:22 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* README.EXT: fix typo.  Patch by William Blackerby.
	  https://github.com/ruby/ruby/pull/19

	* README.EXT.ja: ditto.

Fri May 13 15:22:34 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_select): check invalid handle before doing
	  select operations.  see [ruby-dev:43513], [ruby-dev:43535]

Fri May 13 08:34:00 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/rdoc.rb:  Output summary after documentation report.
	* lib/rdoc/stats/normal.rb:  Don't output information for users when
	  we're not on a TTY

Fri May 13 07:49:02 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/fileutils.rb:  Hide internal methods from RDoc.  Patch by Darragh
	  Curran.  [Ruby 1.9 - Bug #4684]

Fri May 13 07:36:23 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpservlet/erbhandler.rb:  Add documentation.

Fri May 13 07:04:33 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Fix indentation.  Patch by Jason Dew.
	  [Ruby 1.9 - Feature #4682]

Fri May 13 06:50:43 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Add documentation.  Patch by Jason Dew.  [Ruby 1.9 -
	  Feature #4667]

Fri May 13 05:44:19 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/logger.rb (class Logger):  Document Logger#datetime_format.
	  Patch by Sergio Gil Perez de la Manga.  [Ruby 1.9 - Bug #4678]

Fri May 13 05:39:11 2011  Eric Hodel <drbrain@segment7.net>

	* re.c (Init_Regexp): Document option constants.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4677]
	* lib/uri/common.rb (module URI):  Documentation for URI.  Patch by
	  Vincent Batts.  [Ruby 1.9- Bug #4677]
	* lib/uri/ftp.rb (module URI):  ditto
	* lib/uri/generic.rb (module URI):  ditto
	* lib/uri/http.rb (module URI):  ditto
	* lib/uri/https.rb (module URI):  ditto
	* lib/uri/ldap.rb (module URI):  ditto
	* lib/uri/ldaps.rb (module URI):  ditto
	* lib/uri/mailto.rb (module URI):  ditto
	* process.c (Init_process):  Document Process constants.  Patch by
	  Vincent Batts.  [Ruby 1.9- Bug #4677]

Fri May 13 05:16:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rss/atom.rb (module RSS):  Document URIs.  Patch by Mark Turner.
	  [Ruby 1.9 - #4671]
	* lib/rss/rss.rb (module RSS):  Document exception classes.  Patch by
	  Mark Turner.  [Ruby 1.9 - #4671]

Fri May 13 02:15:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (select_internal): remove unused variable (interrupt_flag).

Thu May 12 18:24:34 2011  Kouhei Sutou  <kou@clear-code.com>

	* configure.in: limit to "T" type for prefix of external symbols
	  because x86_64-w64-mingw32-gcc on Debian GNU/Linux generates the
	  following symbol:
	    0000000068483390 D _GLOBAL__F__conftest_external

	  Approved by nobu.

Thu May 12 14:50:52 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/dl/test_base.rb (Fiddle::LIBC_SO): its always msvc*.dll on
	  mswin/mingw.

Thu May 12 14:47:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (Logging.postpone): copy only when temporary logfile
	  exists.

Thu May 12 12:24:22 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* ext/openssl/ossl_ssl.c: By trunk@31346, function check of SSLv2 is
	  executed.
	  However, the problem is not revised in this.
	  This adds the control of using function of SSLv2 in made macro by
	  function check.

Thu May 12 08:10:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/set.rb (class Set):  Add nodoc to internal-use methods.  Patch
	  by Pete Higgins.  [Ruby 1.9 - Bug #4665]

Thu May 12 08:01:14 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_ec.c: Allow encryption when PEM-encoding
	  Elliptic Curve private keys.
	  [ruby-core:35329] [Bug #4423]

Thu May 12 07:54:59 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c (rb_obj_equal):  Add documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4664]
	* lib/rexml:  ditto
	* lib/mkmf.rb:  ditto
	* ext/socket/lib/socket.rb:  ditto

Thu May 12 07:30:08 2011  Eric Hodel  <drbrain@segment7.net>

	* Various .document files: Update .document files to match files which
	  have documentation.

Thu May 12 07:18:45 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dsa.c: Use generic X.509 SubjectPublicKeyInfo
	  format for PEM-encoding DSA public keys.
	  [ruby-core:35328] [Bug #4422]

Thu May 12 06:27:31 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_rsa.c: Use generic X.509 SubjectPublicKeyInfo
	  format for encoding RSA public keys.
	  [ruby-core:35327] [Bug #4421]

Wed May 11 19:45:27 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/forwardable.rb: support 'delegate :foo => :bar' for to meet
	  by specification of RDOC.

Wed May 11 08:36:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick: Add documentation for WEBrick::HTTPAuth

Wed May 11 03:06:35 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rss.rb: Add documentation for RSS.  Patch by Steve Klabnik.
	  [Ruby 1.9 - Bug #4663]

Tue May 10 14:50:32 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add option for hiding skip messages when test
	  ends. #4657

	* test/testunit/test_hideskip.rb, test/testunit/test4test_hideskip.rb:
	  test for above.

Tue May 10 10:53:04 2011  Eric Hodel  <drbrain@segment7.net>

	* common.mk (rdoc): Add rdoc-coverage rule

Tue May 10 09:13:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick: Add Documentation

Tue May 10 04:22:09  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/log.rb: Hide copyright info from ri
	* lib/webrick/httpstatus.rb: ditto
	* lib/webrick/htmlutils.rb: ditto
	* lib/webrick/httpversion.rb: ditto
	* lib/webrick/version.rb: ditto
	* lib/webrick/httpauth/userdb.rb: ditto
	* lib/webrick/httpauth/authenticator.rb: ditto
	* lib/webrick/accesslog.rb: ditto

Mon May  9 20:57:13 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex,rational}.rb: added tests.

Mon May  9 20:29:44 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (string_to_c_internal): a refactoring.

Mon May  9 18:33:05 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c: Improve documentation for String#start_with? and
	  String#end_with?. fixes #4652
	  patched by Andrew Grimm <andrew.j.grimm at gmail.com>

Mon May  9 13:49:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* complex.c (string_to_c_internal): support scientific notation.
	  patched by Tinco Andringa. https://github.com/ruby/ruby/pull/16
	  [ruby-core:36046][Bug #4655]

Mon May  9 11:52:48 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_ord): remove K&R style.
	  patched by Daehyub Kim. https://github.com/ruby/ruby/pull/17

Sun May  8 22:17:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex2,complexrational}.rb: use skip.
	* test/date/*.rb: ditto.

Sun May  8 21:02:31 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex2,complexrational}.rb: NEVER SKIP.

Sun May  8 21:01:21 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_date_base.rb: fixed.

Sun May  8 20:54:11 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: NEVER SKIP.

Sun May  8 20:37:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: reverted 31432.

Sun May  8 20:32:43 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: reverted 31483.

Sun May  8 19:39:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_cond_timedwait): add to care EINTR.
	* thread_pthread.c (thread_timer): remove EINTR check.

Sun May  8 19:04:15 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/time.rb (xmlschema): avoid passing any negative numbers.

Sun May  8 18:40:03 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{parse,strptime}.c: introduced some macros.

Sun May  8 17:17:13 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: use skip /w messages.

Sun May  8 17:04:55 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_httpdate): omitted to call zone_to_diff.

Sun May  8 16:56:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_s_test_*): use macros.

Sun May  8 10:24:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: cleanup signal_thread_list related ifdef.
	  1) we don't have to use #ifdef FOO-PLATFORM directly 2) About
	  half #ifdef didn't care symbian properly.

Sun May  8 05:19:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: Linux socketpair(2) only support
	  AF_UNIX, but windows socketpair doesn't support it. we can't
	  avoid platform check. sigh!

Sun May  8 00:13:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: use Socket.pair instead of pipe.
	  Windows can only treat a socket.

Sat May  7 22:43:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_zero): remove redundant zero fill.

Sat May  7 22:38:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_init): remove volatile qualifier.

Sat May  7 22:34:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_init_copy): new internal api. It provide efficient
	  copy constructor semantics.
	* thread.c (do_select): use rb_fd_init_copy().

Sat May  7 15:18:06 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix incorrect native_cond_signal call when deadlock was detected.

	* thread.c (lock_func): decrement cond_waiting if timeout was happen.

Sat May  7 18:28:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (USE_MONOTONIC_COND): check the availability
	  more strictly.

	* thread_pthread.h (rb_thread_cond_t): ditto.

Sat May  7 15:15:10 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	fix win32 native_cond_timedwait() makes SIGSEGV.

	* thread_win32.h (rb_thread_cond_struct): add prev field instead of
	  last. (ie cond_event_entry is now using double linked list instead of
	  single)
	* thread_win32.c (cond_event_entry): add prev field.

	* thread_win32.c (__cond_timedwait): remove entry properly if timeout
	  was happen.

	* thread_win32.c (native_cond_signal): change for double linked list.
	* thread_win32.c (native_cond_broadcast): ditto.
	* thread_win32.c (native_cond_initialize): ditto.

Sat May  7 12:41:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix mutex deadlock test hang-up.

	* thread_win32.c (abs_timespec_to_timeout_ms): fix 1000x calculation
	  mistake. (ie fix hang-up native_cond_timedwait())

Sat May  7 03:14:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	sleep_cond use monotonic time if possible.

	* thread_pthread.c (native_thread_init): change sleep_cond
	  attribute to monotonic.
	* thread_pthread.c (native_sleep): use native_cond_timeout().

	* thread_pthread.c (native_cond_timeout): add overflow care.
	* thread_win32.c (native_cond_timeout): ditto.

Sat May  7 02:49:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	  fix win32 compile error.

	* thread_win32.c (RB_CONDATTR_CLOCK_MONOTONIC): define
	  RB_CONDATTR_CLOCK_MONOTONIC always.
	* thread_pthread.c (RB_CONDATTR_CLOCK_MONOTONIC): ditto.

Sat May  7 02:29:41 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	  mutex: deadlock check timeout use monotonic time.

	* thread_pthread.c (native_cond_timeout): new internal api.
	  it calculate a proper time for argument of native_cond_timedwait().
	* thread_win32.c (native_cond_timeout): ditto.

	* thread_pthread.c (thread_timer): use native_cond_timeout()
	  instead of get_ts.
	* thread.c (lock_func): ditto.

	* thread_pthread.c (get_ts): removed. use native_cond_timeout().
	* thread.c (init_lock_timeout): ditto.

Sat May  7 01:54:21 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_ts): add monotonic clock capability.
	* thread_pthread.c (rb_thread_create_timer_thread): use monotonic
	  clock if possible.

Sat May  7 01:43:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.h (rb_thread_cond_t): add clockid field. it's
	  no longer an alias of pthread_cond_t.
	* thread_pthread.c: adapt new rb_thread_cond_t type.
	* thread.c (mutex_alloc): ditto.
	* thread_win32.c (native_cond_initialize): ditto.
	* configure.in: add check for pthread_cond_attr_setclock() and
	  clockid_t type.

Fri May  6 23:29:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): use ppoll() instead of poll()
	  if possible. based on a patch from Eric Wong. [ruby-core:36003].

Fri May  6 23:13:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: remove nanosleep check. we no longer use it.
	  r20124 removed last usage.

Fri May  6 22:35:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): extra digits are not used.

Fri May  6 17:43:07 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): remove unused variable offset.

	* ext/syck/syck.h: use #ifdef instead of #if DEBUG.

Fri May  6 16:27:33 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (DAY_IN_NANOSECONDS): refix: 31438.
	  check with LONG_MAX and cast as long; without this the calculation
	  will be done as int and overflow.

Fri May  6 15:01:11 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): avoid buffer overrun, by
	  silently ignoring lesser significant digits.  Required buffer
	  length can be computable so you might at first think of
	  allocating enough memory space on the fly using alloca().  That
	  is a wrong idea because when using alloca there is always risk
	  of integer overflow.  A function that accepts outer-process
	  resources like this should not blindly trust its inputs.  In
	  this particular case we just want to generate milliseconds
	  resolution by strtod() so the string in question needs no more
	  length than what we originally have.  Ignoring lesser
	  significant digits should suffice I believe.

Fri May  6 14:25:53 2011  Tinco Andringa <mail@tinco.nl>

	* ext/syck/rubyext.c (mktime_do): YAML.load time correctly parse
	  usecs smaller than 1 fixes #4571

Thu May  5 22:23:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_mutex_reinitialize_atfork): removed
	  unused macro.
	* thread_win32.c (native_mutex_reinitialize_atfork): ditto.

Thu May  5 22:09:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (DAY_IN_NANOSECONDS): long long int is not
	  available on all platforms.

Thu May  5 17:36:31 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* eval.c (frame_func_id): store result of method_entry_of_iseq() to
	  cfp->me because method_entry_of_iseq() might become expensive.

Thu May  5 15:03:51 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* eval.c (frame_func_id): __method__ return different name from
	  methods defined by Module#define_method with a same block.
	  [ruby-core:35386] fixes #4606
	* eval.c (method_entry_of_iseq): new helper function. search control
	  frame stack for a method entry which has given iseq.
	* test/ruby/test_method.rb: add tests for #4606

Wed May  4 22:13:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pipe.rb: Reduced iterations. Too slow benchmark
	  is bad.
	* benchmark/bm_vm4_thread_pass.rb: ditto.

Wed May  4 22:08:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/date/test_date_base.rb: don't use no message skip().

Wed May  4 21:11:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select2.rb: reduce number of using file
	  descriptors. because gdb need some fds.

Wed May  4 19:00:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): Fix wrong return value.
	* test/-ext-/wait_for_single_fd/test_wait_for_single_fd.rb
	  (TestWaitForSingleFD#test_wait_for_closed_pipe): test for it.

Wed May  4 18:46:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/-test-/wait_for_single_fd: New. for testing
	  rb_wait_for_single_fd() internal function.
	  The patch was written by Eric Wong. [ruby-core:35991]

	* test/-ext-/wait_for_single_fd/test_wait_for_single_fd.rb: ditto.

Wed May  4 12:46:25 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): Added POLLNVAL check.
	  based on a patch from Eric Wong at [ruby-core:35991].

Wed May  4 11:51:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_select): remove useless ifdef.

Wed May  4 11:42:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (wait_connectable): fix error handling code.
	  RB_WAITFD_OUT is turned on even though an error occur.

Wed May  4 10:12:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/readline/readline.c (readline_event): use rb_wait_for_single_fd().
	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 10:10:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (wait_connectable): use rb_wait_for_single_fd().
	  The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

	* ext/socket/init.c (try_wait_connectable, wait_connectable_ensure):
	  removed.

Wed May  4 10:07:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/io/wait/wait.c (io_wait): use rb_wait_for_single_fd().
	  The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 10:01:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): new. poll(2) based backend for
	  rb_wait_for_single_fd().
	  Now only Linux uses it.

	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 09:56:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): new.
	* thread.c (select_single): select(2) based backend for
	  rb_wait_for_single_fd().

	* io.c (make_writeconv): use rb_wait_for_single_fd() instead of
	  rb_thread_fd_select().
	* io.c (rb_io_wait_readable): ditto.
	* thread.c (rb_thread_wait_fd_rw): ditto.

	* io.c (wait_readable): removed.
	* thread.c (init_set_fd): new helper function.
	* include/ruby/io.h (RB_WAITFD_IN, RB_WAITFD_PRI, RB_WAITFD_OUT):
	  new constant for rb_single_wait_fd().

	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 08:04:59 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: fix time dumping so that
	  Syck can load UTC times that Psych dumps.

Wed May  4 07:33:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_copy): fix wrong argument.This issue was pointed
	  out by Eric Wong. [ruby-core:35982]

Tue May  3 20:29:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_symbol_mode):
	  Skip sticky bit test if the platform is FreeBSD. It doesn't allow to
	  change sticky bit if a target is regular file.

Tue May  3 18:23:57 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/date/test_date.rb (TestDate#test_coerce):
	  test for [ruby-core:35127].

Tue May  3 04:27:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_select): preserve errno if no error
	  occurred.

Tue May  3 03:57:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_w32_fdcopy): add prototype.  fixes
	  #4640

Mon May  2 01:02:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/fileutils.rb (FileUtils#chmod): accept symbolic mode argument.
	  The patch was written by takkanm. [ruby-core:26029][Feature #2190]

	* lib/fileutils.rb (FileUtils#fu_mode): new helper function.
	* lib/fileutils.rb (FileUtils#symbolic_modes_to_i): ditto.
	* lib/fileutils.rb (FileUtils#mode_mask): ditto.
	* lib/fileutils.rb (FileUtils#user_mask): ditto.

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_symbol_mode):
	  new test for the above symbolic mode.
	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_R): ditto.

Mon May  2 00:36:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (rsock_connect): add to care EINTR. based
	  on a patch from Eric Wong at [ruby-core:35621][Bug #4555]

Sun May  1 01:06:24 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_select): release GVL while waiting select().

Sat Apr 30 23:10:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_fdcopy): New. This can copy even though
	  fdset size exceed FD_SETSIZE.
	* include/ruby/intern.h (rb_fd_copy): use rb_w32_fdcopy()

Sat Apr 30 20:18:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): Change argument type to rb_fdset_t.
	  Now do_select() is free from unexpected hangup if
	  HAVE_RB_FD_INIT=1 [Bug #4636]

	* thread.c (rb_thread_fd_select, rb_thread_wait_fd_rw):
	  adapt new argument type.

	* thread.c (rb_thread_select): make dummy implementation.

Sat Apr 30 20:16:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_copy): Change function argument. Now
	  rb_fd_copy() has fully copy semantics.
	* include/ruby/intern.h: ditto.

Sat Apr 30 20:11:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h (rb_thread_select): mark as deprecated.

	* ext/io/wait/wait.c (wait_readable): use rb_thread_fd_select
	  instead of rb_thread_select.
	* ext/socket/init.c (wait_connectable0): ditto.
	* ext/readline/readline.c (readline_event): ditto.
	* io.c (rb_io_wait_readable, wait_readable, rb_io_wait_writable,
	  wait_writable): ditto.

Sat Apr 30 20:06:36 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): remove useless ifdef. time calculation
	  is not heavy weight.

Sat Apr 30 16:48:36 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select3.rb: New.

Sat Apr 30 16:27:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (copy_stream_body, rb_io_s_copy_stream): move rb_fd_init()
	  from copy_stream_body to rb_io_s_copy_stream. fds of passing
	  rb_fd_term() have to be guaranteed initialized.

Sat Apr 30 16:13:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select.rb, benchmark/bm_io_select2.rb: New.
	  based on a patch from Eric Wong at [Feature #4531]

Sat Apr 30 03:25:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: New. for testing ext/io/wait.
	  the patch was written by Eric Wong. [Feature #4531]

Sat Apr 30 00:34:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/win32.h: remove redundant declaration of
	  rb_w32_time_subtract().

Sat Apr 30 00:16:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_init): fix hangup if GVL_SIMPLE_LOCK=1.
	  We don't have to call mutex_unlock() before initialize it!

Fri Apr 29 13:15:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_win32.c (native_cond_timedwait): New. r31373 caused
	  win32 build failure.

	* thread_win32.c (__cond_timedwait, abs_timespec_to_timeout_ms):
	  New helper functions.

	* win32/win32.c (rb_w32_time_subtract): rename from subtract and
	  remove static.

Fri Apr 29 10:43:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pipe.rb: Add two new benchmark for GVL
	  performance. They was written by Koichi Sasada.
	* benchmark/bm_vm4_thread_pass.rb: ditto.

Fri Apr 29 10:25:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_method.c (rb_clear_cache_by_class): Revert r29673. It made
	  a segmentation fault regression. [Bug #4289][ruby-core:34554].

Fri Apr 29 10:24:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (make_writeconv): do not add textmode newline decorator if any
	  newline decorator is set already.  fixes #4618, fixes #4619

Fri Apr 29 10:17:42 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (lock_func): small cleanup.

Fri Apr 29 10:07:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_lock, lock_func): Avoid busy loop and
	  performance regression. bm_vm3_thread_mutex.rb performance
	  change from 109.064sec to 16.331sec. [Feature #4607]

	* thread.c (init_lock_timeout): New helper function.

Thu Apr 28 16:15:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{win32.c,dir.h} (rb_w32_uopendir): new API to pass UTF-8 path.

	* win32/win32.c (opendir_internal, rb_w32_opendir): extract and merge
	  common part of rb_w32_opendir() and rb_w32_uopendir().

	* dir.c (do_opendir, glob_helper): encoding.

	* dir.c (dir_initialize, do_opendir): convert path to UTF-8 and call
	  rb_w32_uopendir() instead of rb_w32_opendir() on Windows.
	  fixes #4491, reported by Joey Zhou.

Thu Apr 28 15:32:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/dl/test_base.rb (DL::LIBC_SO): its always msvc*.dll on
	  mswin/mingw.

Thu Apr 28 06:07:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/csv.rb (CSV::open): suppress universal newline decorator.
	  fixes #4603

	* lib/csv.rb (CSV.read): no mode is needed.

Thu Apr 28 06:06:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_extract_modeenc, rb_f_backquote): set default text
	  mode.  fixes #4619

	* io.c (pipe_open): set universal newline decorator if needed.

Wed Apr 27 11:33:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/emoji_iso2022_kddi.trans: ISO-2022-JP-KDDI doesn't have
	  CP932 UDA. Another reason is emacs-mule: the implementation of
	  stateless-iso-2022-jp doesn't support beyond 94x94 (0x7fxx);
	  but CP932 UDA is in 7Fxx-92xx.

Wed Apr 27 07:42:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (STRIP): use proper toolchain.  based on a patch
	  from Jon Forums at [ruby-core:35909].  fixes #4617

Wed Apr 27 01:20:59 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_zone_to_diff): renamed.
	* ext/date/date_parse.c: ditto.
	* ext/date/date_strptime.c: ditto.

Wed Apr 27 01:16:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_find): accept Encoding objects.

Wed Apr 27 00:55:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (econv_opts): add newline option.

	* io.c (validate_enc_binmode, rb_io_extract_modeenc): set newline
	  decorator according to open mode.

	* transcode.c (rb_econv_prepare_options): new function, to prepare
	  econv options with newline flags.

	* include/ruby/encoding.h (ECONV_NEWLINE_DECORATOR_MASK): add.

Wed Apr 27 00:51:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_truncate): fix function.

	* include/ruby/win32.h (ftruncate, truncate, ftello, fseeko): non-64
	  versions on mingw are useless because they use int32_t.  fixes #4564

Wed Apr 27 00:50:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified validation methods.
	* ext/date/lib/date.rb: ditto.

Wed Apr 27 00:00:37 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (dt_lite_set_tmx): should get df value.

Tue Apr 26 22:34:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): allowed day only civil
	  date.  disallowed separatorless day only ordinal date.

Mon Apr 25 21:31:36 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* ext/openssl/extconf.rb: Should check SSLv2_*method.
	  openssl compiled with "no-ssl2" the extconf don't fail
	  when running `make' having this compilation errors.
	  Patched by Laurent Arnoud. fixes #4562, #4556

Mon Apr 25 20:53:32 2011  Tajima, Akio <artonx@yahoo.co.jp>

	* win32/win32.c (kill): accept 0 only sig is SIGINT #4596

Mon Apr 25 19:59:47 2011  Tajima, Akio <artonx@yahoo.co.jp>

	* win32/win32.c (kill): accept 0 as pid, fixes #4596

Mon Apr 25 16:43:45 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (random_rand): remove unused variables.

	* struct.c (rb_struct_define_without_accessor): ditto.

	* strftime.c (rb_strftime_with_timespec): ditto.

	* sprintf.c: ditto.

	* time.c (time_asctime): remove useless GetTimeval().

	* thread_pthread.c: cast to (void *) for %p.

Mon Apr 25 11:02:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/ripper/lib/ripper/sexp.rb: fix rdoc around sexp.
	  patched by Sho Hashimoto. fixes #4599

Mon Apr 25 08:24:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* random.c (rb_f_rand, random_s_rand): RDocs for them.

Mon Apr 25 07:18:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* random.c (random_s_rand, Init_Random): Random.rand should behave as
	  Random::DEFAULT.rand rather than Kernel#rand.

	* random.c (rand_range, random_rand): rand_range function extracted
	  from random_rand function.

	* random.c (rb_f_rand): accept a Range argument as Random#rand
	  [ruby-dev:43427] #4605

Mon Apr 25 03:31:06 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/time.rb: require 'date'.
	* ext/date/lib/date/format.rb: removed require line.

Mon Apr 25 03:08:39 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: require 'date'.

Mon Apr 25 03:04:16 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): added a pattern.

Mon Apr 25 02:51:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/lib/date/format.rb: require 'date_core.so'.
	  date/format needs methods which are now in date_core.so.
	  This breaks make rdoc which uses Date._parse from time.rb.

Mon Apr 25 02:47:46 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): fixed a bug of regex.

Mon Apr 25 02:12:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: an adjustment of regex.

Mon Apr 25 01:58:50 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: omitted to call _parse.

Mon Apr 25 01:03:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (rb_to_id): remove unused variable.

Sun Apr 24 22:19:05 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c: omitted some method calls.

Sun Apr 24 02:57:27 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c (n2i): takes long.

Sun Apr 24 02:51:06 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: reverted.

Sun Apr 24 02:25:23 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/intern.h: pcc can't use __builtin_constant_p.

	* vm_exec.c: change condition.

Sun Apr 24 01:58:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (leap_p): suppress warning: parentheses.

	* ext/date/date_core.c (date_s__parse_internal): remove unused
	  variable "str".

	* ext/date/date_parse.c (parse_ddd_cb): use RSTRING_LENINT.

	* ext/date/date_strftime.c (date_strftime_with_tmx): remove unused
	  variable.

Sun Apr 24 00:34:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: removed some unused macros.  use strchr()
	  instead of index().

Sat Apr 23 21:29:42 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  _parse.  [experimental]
	* ext/date/date_parse.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of _parse.

Fri Apr 22 12:04:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_sort_bang): fix rdoc.
	  patched by burningTyger. https://github.com/ruby/ruby/pull/11

Fri Apr 22 11:49:49 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/xmlrpc/create.rb (XMLRPC::Create#conv2value):
	  XML-RPC's int is 32bit int, and Fixnum also may be beyond 32bit.

	* lib/xmlrpc/create.rb (XMLRPC::Create#conv2value):
	  XML-RPC doesn't allow Infinity and NaN.
	  http://www.xmlrpc.com/spec

Fri Apr 22 04:16:14 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): strings from psych have proper taint
	  markings.

	* test/psych/test_tainted.rb: test for string taint

Thu Apr 21 01:30:02 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rb_f_srand): fix rdoc: srand(0)'s 0 is a seed.
	  [ruby-core:35833] fixes #4590

Thu Apr 21 01:01:28 2011  Masaya Tarui  <tarui@ruby-lang.org>

	* win32/win32.c (CreateChild): maximum length of lpCommandLine is
	  32,768 characters, including the Unicode terminating null character.

Wed Apr 20 21:32:11 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strptime.c (date__strptime_internal): do not
	  overwrite local variables.

Wed Apr 20 14:41:28 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_each_line): check string's length when compare
	  separator and string. [ruby-core:35815] fixes #4586

Wed Apr 20 00:02:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): use position of open paren.

Tue Apr 19 01:00:21 2011  Tajima Akio <artonx@yahoo.co.jp>

	* test/ruby/test_io.rb (TestIO#test_cross_thread_close_fd):
	  skip cross thread pipe close if windows

Mon Apr 18 12:15:46 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_range.rb (TestRange#test_step_ruby_core_35753):
	  avoid float error. [ruby-core:35804]

Sun Apr 17 00:20:14 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{core,strftime}.c: use struct tmx instead of vtm.
	* ext/date/date_tmx.h: new.

Sat Apr 16 22:23:52 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c (date_strftime_wo_timespec): changed
	  the way of validation of locale modifiers.

Sat Apr 16 21:55:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  _strptime.  [experimental]
	* ext/date/date_strptime.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of _strptime.

Sat Apr 16 10:18:30 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vm.c (Init_VM): suppress warning: "OPT_BASIC_OPERATIONS" is not
	  defined.

Fri Apr 15 23:41:18 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ruby.c (proc_options): suppress warning:
	  "ALLOW_DEFAULT_SOURCE_ENCODING" is not defined.

Fri Apr 15 15:10:29 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/uri/generic.rb (#route_from_path): Fix a bug where
	  URI('http://h/b/').route_to('http://h/b') wrongly returned './'
	  (should be '../b'). [Bug #4476]

Fri Apr 15 14:58:06 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/fileutils.rb (FileUtils#touch): Fix corrupted output when
	  mtime is specified in addition to nocreate (and verbose).
	  ref [ruby-dev:43401]

Thu Apr 14 23:43:43 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (ruby_float_step): wrong loop condition.
	  fixes [ruby-core:35753], reported by Joey Zhou.

	* test/ruby/test_range.rb (TestRange#test_step_ruby_core_35753):
	  test above change.

Thu Apr 14 22:48:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Options#setup_options): set possible
	  values for completion. no conversion is needed.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#initialize): use
	  positional arguments instead of keyword arguments.

	* lib/test/unit.rb (Test::Unit::Runner#jobs_status): io/console may
	  not be available. use 80 as the last resort if IO#winsize and
	  COLUMNS are unavailable.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#died): rename using a
	  verb.

	* lib/test/unit.rb (Test::Unit::Runner#_run_parallel): check if worker
	  is signaled and use its exit status.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#dead): no longer @in
	  and @out are separated.

Thu Apr 14 21:23:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_autoload_p): search superclasses as same as actual
	  loading.  fixes [ruby-core:35679]

Thu Apr 14 21:21:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (frexp, modf): wrongly declared as pure in
	  mingw math.h.

	* include/ruby/win32.h (ftruncate, truncate): mingw64 misses
	  prototypes.

	* win32/win32.c (rb_w32_read): suppress warning.

Thu Apr 14 19:55:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/fileutils.rb (FileUtils#touch): fix corrupted output when
	  FileUtils.touch(:nocreate => true, :verbose => true) case.
	  The patch was written by Hiroyuki Iwatsuki. [ruby-dev:43401]

Thu Apr 14 16:01:45 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_f_syscall): suppress warning: "HAVE___SYSCALL" is not
	  defined.

Thu Apr 14 00:41:09 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (thread_fd_close_i): IOError exception should be assigned
	  to rb_thread_t::thrown_errinfo.

Wed Apr 13 20:12:26 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_io_fdatasync): remove unused variable.

Tue Apr 12 20:54:12 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/st.h: parenthesize macro arguments.

Tue Apr 12 19:19:50 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb: avoid race condition. fixes #4572

Tue Apr 12 18:07:13 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: --disable-libedit to disable
	  libedit. fixes #4550

Tue Apr 12 10:37:39 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: VC doesn't have ftruncate() and others, but
	  ruby needs HAVE_ macros to use our emulation functions.
	  (fix the problem of 31262)

Tue Apr 12 01:33:00 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: properly evaluate existence of truncate, ftruncate
	  and ftello for MinGW. [ruby-core:35678]
	* win32/win32.c: rename truncate, ftruncate and ftello to avoid
	  redefinitions.
	* win32/win32.h: ditto.

Mon Apr 11 21:51:52 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c: revert r31230. Because it made a regression.
	  [ruby-core:35631]

Mon Apr 11 21:49:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb: Added TestIO#test_cross_thread_close_stdio
	  and TestIO#test_cross_thread_close_fd.
	  The patch was written by Eric Wong. [ruby-core:35669]

Mon Apr 11 21:15:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (rb_group_member): kill 256K of stack usage.
	  the patch was written by Eric Wong. [ruby-core:35699]

Mon Apr 11 07:24:13 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c:  Fix typo, document version constants.

Sun Apr 10 22:23:45 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h: parenthesize macro arguments.

Sat Apr  9 23:31:47 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each, strio_readlines):
	  Use `NUM2LONG` instead of `FIX2INT`. Fixes [ruby-dev:43395].

Sat Apr  9 23:22:27 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each):
	  Fix exception message and don't raise immediately if block is not
	  given.
	  Fixes [ruby-dev:43394].

	* test/stringio/test_stringio.rb (test_each_line_limit_0):
	  Fix test for above.

Sat Apr  9 21:54:15 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each, strio_readlines):
	  limit must not be zero. Fixes [ruby-dev:43392].

	* test/stringio/test_stringio.rb: Add tests for above.

Sat Apr  9 18:01:36 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/util.h: parenthesize macro arguments.

Fri Apr  8 16:01:56 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): check whether str is
	  a string when str and lim are given.
	  https://twitter.com/watson1978/status/56225052152168449

Thu Apr  7 20:03:52 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h: parenthesize macro arguments.

Wed Apr  6 21:08:31 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h: parenthesize macro arguments.

Wed Apr  6 15:12:40 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_pkey_dh.c (ossl_dh_initialize):
	  pop pushed error after each try of reading. fixes #4550

	* ext/openssl/ossl_pkey_dsa.c (ossl_dsa_initialize): ditto.

	* ext/openssl/ossl_pkey_ec.c (ossl_ec_initialize): ditto.

Wed Apr  6 11:36:44 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_pkey_rsa.c (ossl_rsa_initialize):
	  pop pushed error after each try of reading. fixes #4550

Tue Apr  5 20:33:43 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h: parenthesize macro arguments.

Mon Apr  4 22:02:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/io/nonblock/nonblock.c (io_nonblock_set): Avoid F_SETFL if
	  we're not changing the O_NONBLOCK bit. F_SETFL is an expensive
	  operation since it needs to affect all processes with the same
	  file object.
	  The patch is written by Eric Wong. [ruby-core:35556]

Mon Apr  4 21:41:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_syswrite): While local FS writes are usually
	  buffered, the buffers can be full or the file opened with
	  O_SYNC. IO#syswrite can also be used on blocking IOs
	  (pipe/socket) just like IO#write.
	  The patch is written by Eric Wong. [ruby-core:35554]

Mon Apr  4 11:50:40 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/test_tempfile.rb: simply ignore platform dependent testcases
	  instead of skipping.

Sun Apr  3 22:52:22 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/syslog/syslog.c: improve rdoc.
	  a patch by Jonas Pfenniger. [ruby-core:35592] fixes #4545

Sun Apr  3 22:10:09 2011  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c: parenthesize macro arguments.

Sun Apr  3 21:33:58 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: disable fdatasync again on Mac OS X.
	  [ruby-core:35493][Bug #4500]

Sun Apr  3 21:16:20 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_reopen): IO#close releases GVL if possible.
	  close() may block for certain file types (NFS, SO_LINGER
	  sockets, inotify), so let other threads run. The patch was
	  created by Eric Wong [ruby-core:35555][Bug #4527]

	* io.c (fptr_finalize): ditto.

	* io.c (maygvl_fclose): new.
	* io.c (nogvl_fclose): ditto.
	* io.c (maygvl_close): ditto.
	* io.c (nogvl_close): ditto.

Fri Apr  1 22:25:50 2011  Tanaka Akira  <akr@fsij.org>

	* ext/syslog/syslog.c: parenthesize macro arguments.

Fri Apr 1 18:53:06 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/cookie.rb (WEBrick::Cookie.parse): 'white space is
	  permitted between tokens' according to RFC2965. Though 'Netscape
	  spec' does not define the syntax clearly, make it tolerant as a
	  server. As a real-world example, rest-client gem sends
	  'Cookie: foo=1;bar=2'

	* test/webrick/test_cookie.rb (test_parse_non_whitespace): test it.

Fri Apr  1 13:19:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (RUBY_VM_CHECK_INTS_TH): merge a patch by ko1
	  in [ruby-dev:43373].

Thu Mar 31 23:15:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-brace-to-do-end, ruby-do-end-to-brace):
	  adjust space between block beginning and block arguments

Thu Mar 31 20:42:05 2011  Tanaka Akira  <akr@fsij.org>

	* ext/strscan/strscan.c:  parenthesize macro arguments.

Thu Mar 31 18:06:12 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): should ignore crefs with
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag.

Thu Mar 31 16:49:56 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): search root cref properly.
	  [ruby-dev:43365]

Thu Mar 31 14:50:25 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* eval.c (rb_mod_s_constants): should ignore crefs with
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag.

Wed Mar 30 22:55:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-toggle-block): toggle do/end and {}.

	* misc/ruby-mode.el (ruby-move-to-block): move to opening of
	  block.

Wed Mar 30 14:35:15 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.h (COPY_CREF): should copy
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag to hide constants from
	  methods defined by class_eval.  [ruby-dev:43365]

Wed Mar 30 00:24:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/stringio/stringio.c: parenthesize macro arguments.

Tue Mar 29 21:51:31 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* object.c (rb_String): Kernel#String should call to_str before to_s.

Tue Mar 29 10:28:08 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/test_filehandler.rb
	  (WEBrick::TestFileHandler#test_short_filename): the cgi doesn't exist
	  on current directory.

Tue Mar 29 05:19:57 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c: parenthesize macro arguments.

Tue Mar 29 00:03:51 2011 Tajima Akio <artonx@yahoo.co.jp>

	* test/webrick/test_filehandler.rb (test_short_filename):
	  read real short filename by cmd because smb mounted files
	  have different naming convention.

Mon Mar 28 11:38:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (date_s_today): use int for year.

	* ext/date/date_core.c (datetime_s_now): ditto.

Mon Mar 28 11:07:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/extmk.rb: set MFLAGS from MAKEFLAGS when using nmake.

Mon Mar 28 11:07:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (love): all you need is love.

Sun Mar 27 23:16:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c: parenthesize macro arguments.

Sun Mar 27 16:55:34 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-map): remove unnecessary
	  binding. fixes
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=468952

	* misc/ruby-mode.el: suppress warnings at byte compile.  fixes
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502926

Sun Mar 27 11:18:35 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: removed unused variables.

Sat Mar 26 15:16:09 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/getaddrinfo.c: parenthesize macro arguments.

Sat Mar 26 05:27:34 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/lib/date/format.rb (DateTime#strftime): removed because
	  date_core defines it.

Fri Mar 25 21:59:45 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: should not force cast with macros.

Fri Mar 25 21:56:10 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/init.c: parenthesize macro arguments.

Fri Mar 25 19:39:40 2011  Ben Walton <bwalton@artsci.utoronto.ca>

	* test/test_syslog.rb:
	  Skip syslog tests that rely on LOG_PERROR unless it's defined

	  Instead of checking looking at the platform to determine if the tests
	  relying on LOG_PERROR should be run, look for the definition of the
	  constant as this will be robust against all platforms as long as the
	  underlying syslog.c code sets it up correctly.

	  This specifically addresses failures on Solaris 9.

	  Use LOG_PID instead of LOG_PERROR in Syslog.open test

	  LOG_PERROR isn't a POSIX option for syslog, so it fails on platforms
	  that don't define it.  Solaris 9 and 10 are examples of this.

	  Use LOG_PID instead.

Fri Mar 25 15:42:17 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/sdbm/_sdbm.c (sdbm_open): use size_t.

	* ext/syck/bytecode.c: ditto.

	* ext/sdbm/_sdbm.c (delpair): use ptrdiff_t.

	* ext/sdbm/init.c: use RSTRING_LENINT.

	* ext/dl/handle.c: suppress warning: shorten-64-to-32.

	* ext/strscan/strscan.c: ditto.

	* ext/syck/emitter.c: ditto.

	* ext/syck/implicit.c: ditto.

	* ext/syck/syck.c: ditto.

	* ext/syck/token.c: ditto.

Fri Mar 25 12:14:58 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: import nkf 7f18e30.

Fri Mar 25 11:49:29 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#test_no_curdir): skip silently
	  on Windows, because this tests a platform specific feature and it'll
	  never be supported on ruby on Windows.

	* test/ruby/test_dir_m17n.rb
	  (TestDir_M17N#test_filename_extutf8_invalid,
	  TestDir_M17N#test_filename_as_bytes_extutf8): ditto.

	* test/open-uri/test_open-uri.rb
	  (TestOpenURI#test_find_proxy_case_sensitive_env): ditto.

	* test/dl/test_handle.rb (DL::TestHandle#test_NEXT,
	  DL::TestHandle#test_DEFAULT): ditto.

Thu Mar 24 23:06:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): should not autoload in
	  defined? mode.

	* variable.c (rb_const_defined_0): fix autoloading base.
	  [ruby-core:35509]

Thu Mar 24 22:48:43 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c: parenthesize macro arguments.

Thu Mar 24 14:45:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl.c: suppress warning: shorten-64-to-32.

	* ext/openssl/ossl.h: ditto.

	* ext/openssl/ossl_asn1.c: ditto.

	* ext/openssl/ossl_bio.c: ditto.

	* ext/openssl/ossl_bn.c: ditto.

	* ext/openssl/ossl_cipher.c: ditto.

	* ext/openssl/ossl_hmac.c: ditto.

	* ext/openssl/ossl_ns_spki.c: ditto.

	* ext/openssl/ossl_ocsp.c: ditto.

	* ext/openssl/ossl_pkcs5.c: ditto.

	* ext/openssl/ossl_pkey.c: ditto.

	* ext/openssl/ossl_pkey_dh.c: ditto.

	* ext/openssl/ossl_pkey_dsa.c: ditto.

	* ext/openssl/ossl_pkey_ec.c: ditto.

	* ext/openssl/ossl_pkey_rsa.c: ditto.

	* ext/openssl/ossl_rand.c: ditto.

	* ext/openssl/ossl_ssl.c: ditto.

	* ext/openssl/ossl_x509ext.c: ditto.

	* ext/openssl/ossl_x509name.c: ditto.

Thu Mar 24 11:48:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_rand.c (ossl_rand_egd_bytes): use NUM2INT because
	  the result is used with functions whose argument is int.

	* ext/openssl/ossl_ssl.c (ossl_sslctx_setup): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_purpose): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_trust): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_set_purpose): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_set_trust): ditto.

Thu Mar 24 11:36:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_x509name.c: id_aref's type is ID.

Thu Mar 24 10:04:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/io/console/console.c (console_set_winsize):
	  suppress warning: shorten-64-to-32.

Thu Mar 24 09:56:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_ocsp.c (ossl_ocspreq_verify): flags is VALUE,
	  so it should use NUM2INT.

	* ext/openssl/ossl_ocsp.c (ossl_ocspbres_verify): ditto.

Wed Mar 23 21:09:29 2011  Tanaka Akira  <akr@fsij.org>

	* ext/readline/readline.c: parenthesize macro arguments.

Wed Mar 23 08:07:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): fix inaccurate results.

Wed Mar 23 00:12:16 2011  Tajima Akio <artonx@yahoo.co.jp>

	* win32/win32.c: wait process real termination after reading
	  exit code. fixes #4518

Tue Mar 22 21:20:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rubygems/test_case.rb: save current dir to @current_dir
	  before Dir.chdir.

Tue Mar 22 20:10:04 2011  Tanaka Akira  <akr@fsij.org>

	* ext/psych/parser.c: parenthesize macro arguments.

Tue Mar 22 20:10:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ruby_missing.h: parenthesize macro arguments.

Tue Mar 22 13:33:22 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/buffering.rb: removed circular require of
	  openssl.rb.

	* ext/openssl/lib/openssl/*: removed following comment for transition
	  measures of avoiding circular require. No one claimed about this as
	  far as I know.
	  ##
	  # Should we care what if somebody require this file directly?
	  # require "openssl"

Tue Mar 22 10:57:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/runner.rb: set Gem::TestCase's @@project_dir.

	* lib/rubygems/test_case.rb: set Gem::TestCase's @@project_dir only
	  when it is not defined.

Tue Mar 22 09:38:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (flo_round): use pow instead of while-loop. fixes #4510
	  patched by Alex Young [ruby-core:35526]

Tue Mar 22 06:47:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_strftime.c (date_strftime_wo_timespec):
	  suppress warning: shorten-64-to-32.

Tue Mar 22 06:42:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c: suppress warning: shorten-64-to-32.

Tue Mar 22 06:41:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit/parallel.rb: remove unused variable.

Tue Mar 22 06:19:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_16le.c: suppress warning: shorten-64-to-32.

	* ext/dbm/dbm.c: ditto.

	* ext/gdbm/gdbm.c: ditto.

	* parse.y (Init_ripper): suppress warning: unused value.

Mon Mar 21 11:21:32 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Refactoring. Unified if and elsif.

Sun Mar 20 23:09:34 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c: checks duplicated modifiers.

Sun Mar 20 22:32:30 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c: removed unused code and arguments.

Sun Mar 20 21:34:49 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  strftime. It has some limitations that is same as Time's
	  one.  [experimental]
	* ext/date/date_strftime.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of strftime.

Sun Mar 20 12:43:12 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509store.c: parenthesize macro arguments.

Sun Mar 20 01:39:48 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): check env process block size with OS ver.
	* win32/win32.c: export rb_w32_osver for above patch.
	* include/ruby/win32.h: declare rb_w32_osver for Win32 Libs.

Sat Mar 19 18:35:05 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): calculate total env block size for win32.
	* test/ruby/test_env.rb: add test for above patch.

Sat Mar 19 17:14:46 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): checking with max process environment
	  block size for Win32. 32767 for 2000/XP, 2003. if failed to
	  read the block, then checking with 5120 for earlier Windows.

Sat Mar 19 12:30:25 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509revoked.c: parenthesize macro arguments.

Fri Mar 18 20:44:36 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509req.c: parenthesize macro arguments.

Fri Mar 18 08:48:06 2011  Oleg Shaldybin  <oleg.shaldybin@gmail.com>

	* lib/fileutils.rb (FileUtils::Entry_#copy_file): updated FileUtils.cp
	  to still copy file permissions when :preserve is false (as cp does
	  this even when -p isn't set).

Fri Mar 18 00:59:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/win32ole/extconf.rb (create_docfile): removed.  should not
	  modify source directory unnecessarily, platform dependent
	  documentation should be dealt with by rdoc.  [ruby-core:35495]

Fri Mar 18 00:54:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_funcall_passing_block): add prototype.
	  a patch by James M. Lawrence at [ruby-core:35501]

Wed Mar 17 06:23:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509name.c: parenthesize macro arguments.

Wed Mar 16 20:36:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c (init_inetsock_internal): raise an error on
	  listen(2) failure.
	  reported by Xavier Shay.  [ruby-core:35505]

Wed Mar 16 15:06:21 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/buffering.rb (module OpenSSL): #flush should
	  not change sync mode on exception.
	* test/openssl/test_buffering.rb: added

Wed Mar 16 13:45:28 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/buffering.rb: de-nest Buffering module

	* ext/openssl/lib/openssl/buffering.rb: add RDoc

Wed Mar 16 08:40:39 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509ext.c: parenthesize macro arguments.

Tue Mar 15 18:34:27 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509crl.c: parenthesize macro arguments.

Tue Mar 15 09:49:03 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/misc/test_ruby_mode.rb (test_singleton_class): Skip for Pending.

Mon Mar 14 21:20:44 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_require.rb (test_require_too_long_filename):
	  increase path length, because MAXPATHLEN is defined as 4096 on linux.

	* test/ruby/test_require.rb (test_require_path_home_1): ditto.

	* test/ruby/test_require.rb (test_require_path_home_2): ditto.

Mon Mar 14 19:54:37 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509cert.c: parenthesize macro arguments.

Sun Mar 13 18:11:28 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509attr.c: parenthesize macro arguments.

Sun Mar 13 16:07:58 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/pstore.rb: Fix don't raise "nested transaction" when thread_safe
	  is true. Patch by Masaki Matsushita (Glass_saga). [ruby-dev:43337]

	* test/test_pstore.rb: Test for above.
	  Patch by Masaki Matsushita (Glass_saga) [ruby-dev:43337]

Sat Mar 12 04:12:41 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl_session.c: parenthesize macro arguments.

Sat Mar 12 02:27:07 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c ({d,dt}_lite_marshal_load): checks the given
	  argument.

Sat Mar 12 01:26:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: changed some directives.

Sat Mar 12 01:16:02 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c, ext/date/lib/*: moved rdoc descriptions.

Sat Mar 12 00:06:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib: moved from lib.

Fri Mar 11 23:32:38 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta*: removed undocumented delta.

Fri Mar 11 18:42:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (find_executable0): should exclude directories.

Fri Mar 11 01:40:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getmaxgroups, proc_setmaxgroups): Process#maxgroups
	  and Process#maxgroups= now raise NotImplementedError if the
	  platform don't support supplementary groups concept.

Fri Mar 11 01:25:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (get_sc_ngroups_max): return -1 if platform don't
	  support NGROUPS_MAX.

Thu Mar 10 22:28:15 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.h: parenthesize macro arguments.

Thu Mar 10 21:59:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (parser_encode_length): add exception as UTF8-MAC for
	  magic comment's emacs newline specifier
	  patched by James M. Lawrence [ruby-core:35476] fixes #4489

Thu Mar 10 16:00:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (parser_encode_length): fix typo: the length of
	  "-dos" and "-mac" is not 5 but 4.
	  patched by James M. Lawrence [ruby-core:35476] fixes #4489

Thu Mar 10 10:52:01 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_require.rb: setting too long string to ENV causes
	  Errno::EINVAL on Windows.  long path name errors may causes over
	  about 1024 bytes, then limit it about 4000 bytes.

Thu Mar 10 10:09:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Runner::Worker#read): fix for the case
	  when IO#read or IO#gets returns nil.

Thu Mar 10 07:12:03 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.6.2 (release candidate @ 2026fbb5)
	* test/rubygems: Ditto
	* test/runner.rb: Added test to load path to fix test requires.

Thu Mar 10 03:00:43 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.c: parenthesize macro arguments.

Wed Mar  9 23:51:26 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_io_m17n.rb (test_io_new_enc): "sjis" is now an alias
	  of Windows-31J.

Wed Mar  9 23:06:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): fix indent after aref.

Wed Mar  9 12:50:24 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: Rescue exceptions when
	  people implement the method method. Thanks Lin Jen-Shin.
	  [ruby-core:35255]

	* test/psych/visitors/test_yaml_tree.rb: test for implementation of
	  method method.

Wed Mar  9 11:53:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c: Change SJIS as an alias of Windows-31J.
	  [ruby-dev:43027] fixes #4280

	* enc/shift_jis.c: Add PCK as an alias of Windows-31J.

Wed Mar  9 00:45:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: nmake substitutes all occurrences in macro.

	* ext/extmk.rb: workaround for nmake.

Tue Mar  8 23:49:45 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setgroups): cleanup.

Tue Mar  8 23:40:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/misc/test_ruby_mode.rb: test for ruby-mode.el.

Tue Mar  8 23:27:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (get_sc_ngroups_max): try to use NGROUPS_MAX at first if
	  _SC_NGROUP_MAX is not defined.

Tue Mar  8 23:10:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): fix for array in block.

Tue Mar  8 21:44:49 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_rand.c: parenthesize macro arguments.

Tue Mar  8 16:45:31 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (ruby_setenv): MSDN says that Windows XP or earlier limits
	  the total size of environment block to 5,120 chars.  and on such
	  OS, putenv() causes SEGV.  So, ruby should limit the size of an
	  environment variable to 5,120 bytes for workaround.

Tue Mar  8 15:57:20 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rubygems/test_gem_spec_fetcher.rb
	  (TestGemSpecFetcher#test_cache_dir_escapes_windows_paths): cache_dir
	  may have driveletter and `:' for base of cache_dir itself, so need
	  to skip it for checking.

Tue Mar  8 12:30:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-deep-indent-paren-p, ruby-calculate-indent):
	  do not apply deep-indent inside parens at the beginning of
	  expressions.

Tue Mar  8 09:32:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (configure-ext, build-ext), ext/extmk.rb (extmake):
	  support parallel-make under ext.

Tue Mar  8 09:25:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_setgroups): use getgrnam() if getgrnam_r() is
	  not available.

	* process.c: RARRAY_LEN() returns long int.

Tue Mar  8 09:07:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_REPLACE_TYPE): enclose in quotes for multiple
	  type names.

Tue Mar  8 01:43:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (get_sc_ngroups_max): define to wrap sysconf(3).
	  this also supports Windows which doesn't have sysconf(3).

	* process.c (maxgroups): use get_sc_ngroups_max.

	* process.c (proc_setmaxgroups): ditto.

Tue Mar  8 01:16:49 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (rb_objspace): an initializer must be a constant.

Tue Mar  8 01:11:44 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (maxgroups): cast because sysconf(3)'s return value is long.

	* process.c (proc_setmaxgroups): ditto.

	* process.c (proc_setgroups): cast because RARRAY_LEN() is long.

Tue Mar  8 00:02:47 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_rsa.c: parenthesize macro arguments.

Mon Mar  7 22:59:39 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/pstore.rb: Delete variable @transaction and fix #4474. Patch by
	  Masaki Matsushita (Glass_saga).

	* test/test_pstore.rb(test_thread_safe): Add test for #4474.

Mon Mar  7 21:31:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setgroups): replace getgrnam() with getgrnam_r()
	  because getgrnam() isn't thread safe.

Mon Mar  7 20:49:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getmaxgroups, proc_setmaxgroups): reflect
	  platform maxgroups limitation by default instead hardcoded 65536.

Mon Mar  7 17:13:00 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (rb_gc_set_params): allow GC parameter configuration by
	  environment variables.  based on a patch from funny-falcon at
	  https://gist.github.com/856296, but honors safe level.

Mon Mar  7 09:05:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c: NUM2RLIM is defined but no getrlimit and setrlimit on
	  mingw.

Mon Mar  7 08:38:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (DateTimeData): should not use bare 'long long'
	  and 'long double', which are not defined by C89.

	* ext/date/date_core.c (dt_lite_plus): get rid of overflow at casting
	  down double to integer.

Mon Mar  7 00:21:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getgroups): get rid of maxgroups dependency.
	  ngroups can be calculated dynamically.

Sun Mar  6 23:45:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: rlim_t use standard RUBY_REPLACE_TYPE mechanism.

Sun Mar  6 23:26:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setmaxgroups): added negative value check.
	  This was suggested by Daniel Berger. Thanks Daniel!
	  [ruby-core:35426][Bug#4467]

Sun Mar  6 23:18:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (maxgroups, proc_setmaxgroups): increase max groups
	  limitation up to 65536.

Sun Mar  6 22:20:59 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_ec.c: parenthesize macro arguments.

Sun Mar  6 21:49:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* sample/list.rb (MyElem#initialize): initialize @head
	  explicitly. Otherwise -W2 option makes following warning.
	  "warning: instance variable @head not initialized".
	  This issue was founded by Andrew Grimm. Thanks Andrew!
	  [ruby-core:35435][Bug#4471]

Sun Mar  6 05:21:41 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* class.c: fix camelCase to snake_case in documentation code examples.
	  patched by Andrew Grimm. fixes Bug #4469

	* marshal.c: ditto.

	* proc.c: ditto.

	* sample/biorhythm.rb: ditto.

	* vm_eval.c: ditto.

	* vm_method.c: ditto.


Sun Mar  6 03:22:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl): use rb_thread_io_blocking_region() instead
	  rb_thread_blocking_region().

Sat Mar  5 22:54:36 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* include/ruby/intern.h: fix a typo of prototype declaration.
	  rb_mutex_try_lock -> rb_mutex_trylock [ruby-dev:43213]

Sat Mar  5 19:44:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (TestIO#test_fcntl_lock): small clean up.

Sat Mar  5 01:33:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl, nogvl_io_cntl): IO.fcntl() and IO.ioctl()
	  release GVL during calling kernel interface.
	  Suggested by Eric Wong. [ruby-core:35417][Bug #4463]

	* test/ruby/test_io.rb (TestIO#test_fcntl_lock): add new test for
	  IO.fcntl().

Fri Mar  4 23:09:12 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/testunit/test_parallel.rb
	  (test_should_run_all_without_any_leaks): consider that the order of
	  testcase could change. [ruby-dev:43300] [Bug #4466]

Fri Mar  4 22:01:14 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl): change 'cmd' type to int. ioctl and fcntl need to
	  be passed int.
	* io.c (rb_io_ctl): ditto.

Fri Mar  4 21:10:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: save warnflags. the patch is created by Eric Wong.
	  [Bug #4465]

Wed Mar  2 21:15:00 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_dsa.c: parenthesize macro arguments.

Thu Mar  3 22:10:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (check_exec_redirect_fd, check_exec_redirect): raise
	  ArgumentError if fd >= 3 on Windows because the feature is not
	  supported.

	* test/ruby/test_process.rb (test_execopts_redirect): remove meaningless
	  argument.

Thu Mar  3 21:21:42 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (test_execopts_redirect): redirecting fd
	  >= 3 is not supported on Windows, so should not specify such options
	  when calling spawn or others.

Thu Mar  3 18:59:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_slice_bang): raise error when the string is frozen.

Thu Mar  3 14:25:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* strftime.c (STRFTIME): return 0 and ERANGE when precision is too
	  large. [ruby-dev:43284] fixes #4456

Thu Mar  3 00:46:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (uleb128): cast the value to unsigned long.

	* addr2line.c (fill_lines): print error when lseek fails.

Thu Mar  3 00:36:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/encoding.rb (REXML::Encoding#encoding=): store @encoding
	  a String which means the name of the encoding.
	  this partially revert r29646.

	* lib/rexml/document.rb: follow above.

	* lib/rexml/output.rb: ditto.

	* lib/rexml/parsers/baseparser.rb: ditto.

	* lib/rexml/source.rb: ditto.

	* lib/rexml/xmldecl.rb: ditto.

Wed Mar  2 23:19:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_byte_substr): return nil for negative length.

Wed Mar  2 21:15:00 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_dh.c: parenthesize macro arguments.

Wed Mar  2 14:24:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Fix name from `inclement_io` to
	  `increment_io`.

Wed Mar  2 14:06:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_slice_bang): move treatments which is only needed
	  when the result is not nil.

Wed Mar  2 14:02:29 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb(TestParallel#spawn_runner):
	  Fix outputing empty line in running test.

	* test/testunit/tests_for_parallel/test_third.rb: Remove `sleep`

Tue Mar  1 22:29:10 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey.h: parenthesize macro arguments.

Tue Mar  1 22:02:35 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Fix number.

Tue Mar  1 21:48:22 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: For Windows.

	* test/testunit/test_parallel.rb(TestParallelWorker#test_quit_in_test):
	  Fix for above specification change.
	* test/testunit/test_parallel.rb(TestParallel#spawn_runner):
	  Fix outputing empty line in running test.

Tue Mar  1 20:51:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  remove tests for [bug#4396]. because we decided to reject this
	  ticket.

Tue Mar  1 19:46:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/{test_date.rb,test_date_attr.rb}: [ruby-dev:43280]

Tue Mar  1 18:40:38 2011  Ryan Davis  <ryan@YPCMC09457>

	* lib/rubygems*: Import rubygems 1.6.0 (released version @ 58d8a0b9)
	* test/rubygems: Ditto

Tue Mar  1 16:22:22 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c: revert r30987 because it causes some failures in
	  test-all, especially webrick.

Tue Mar  1 15:59:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_byteslice): the resulted encoding should keep
	  original encoding. this also fixes the encoding when the result
	  shares internal string. [ruby-core:35376]

Tue Mar  1 13:25:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (VpMemAlloc): CVE-2011-0188.
	  Fixes a bug reported by Drew Yao <ayao at apple.com>

Tue Mar  1 10:34:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_byteslice): Add String#byteslice. [ruby-core:35376]

Tue Mar  1 00:12:49 2011  Tajima Akio <artonx@yahoo.co.jp>

	* include/ruby/win32.h: define WIN32 if neither _WIN64 nor WIN32
	  defined. it forces to use push/pop for pack(4) pragma.

Mon Feb 28 23:52:13 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/testunit/test_rake_integration.rb (test_with_rake_runner):
	  use assert_in_out_err for suppress messages.

Mon Feb 28 22:48:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_spawn): use shell if a commandline contain
	  double-quote character.
	* win32/win32.c (is_internal_cmd): similar, use shell if a commandline
	  contain caret character.

	* test/ruby/test_system.rb (TestSystem#test_system_at): fix
	  wrong test case. if system() invoke a command by using shell,
	  system() never return nil. Also, "" quotation must not appear
	  twice in a command line.

Mon Feb 28 17:36:57 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkcs7.c: parenthesize macro arguments.

Mon Feb 28 16:48:42 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkcs12.c: parenthesize macro arguments.

Mon Feb 28 16:28:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_trans): when the hash for multibyte repl is empty,
	  tr is inverse mode, and a character doesn't much the table, the
	  character should be replaced by last replacement. Bug #4449

Mon Feb 28 16:38:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ocsp.c: parenthesize macro arguments.

Mon Feb 28 13:02:15 2011  Danial Pearce <github@tigris.id.au>

	* lib/tempfile.rb: Fix example file paths in docs for tempfile.
	  https://github.com/ruby/ruby/pull/5

Mon Feb 28 12:56:18 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_init): typo fix.
	  https://github.com/ruby/ruby/pull/8

Mon Feb 28 12:28:13 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/date/date_core.c (datetime_s_now): localtime() and localtime_r()
	  required time_t pointer as 1st parameter, and tv_sec member of struct
	  timeval is long.

Mon Feb 28 11:57:40 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb: Temporally disable test on Windows.

Mon Feb 28 07:28:35 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Runner#after_worker_quit):
	  method name more be natural English.

	* lib/test/unit.rb(Test::Unit::Runner::Worker.launch):
	  IO.sync doesn't need. Should use "b" for mode.

Sun Feb 27 21:59:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_redirect_win):
	  add test for system().

Sun Feb 27 18:00:09 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Refactoring; Worker never use Hash for internal
	  storage.

	* lib/test/unit.rb: Never use Kernel#spawn. Use IO.popen instead.

Sun Feb 27 13:16:48 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ns_spki.c: parenthesize macro arguments.

Sat Feb 26 17:07:53 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: [Feature #4257]

	* ext/date/extconf.rb: new

	* ext/date/date_core.c: new

Sat Feb 26 16:10:23 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: --jobs-status won't puts over 2 lines.

	* test/testunit/test_parallel.rb: Fix test for above.

	* lib/test/*: refactoring.

Sat Feb 26 07:10:05 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: fix parsing timezone's whose
	  whose format is (+/-)hhmm.  Thanks Goncalo Silva!

	* test/psych/test_scalar_scanner.rb: test for bug.

Thu Feb 24 23:02:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_hmac.c: parenthesize macro arguments.

Thu Feb 24 22:53:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (love): for the birthday.

Thu Feb 24 22:51:54 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_vm_destruct): run vm exit hooks after all objects are
	  destructed.

Thu Feb 24 14:40:33 2011  Shota Fukumori  <sorah@tubusu.net>

	* ChangeLog (vim): Modeline for vim

Thu Feb 24 13:39:25 2011  Shota Fukumori  <sorah@tubusu.net>

	* common.mk: Use $RUNRUBY for worker process.

	* lib/test/unit.rb: Fix bug.

	* lib/test/unit.rb: @options[:ruby](@opts[:ruby]) is now Array.

	* test/testunit/parallel.rb: Fix for above.

Thu Feb 24 10:05:55 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/tests_for_parallel/misc.rb: Fix bug in r30947.

	* lib/test/unit.rb, lib/test/unit/assertions.rb: For this test.

Wed Feb 23 23:07:38 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb, test/testunit/parallel/*:
	  Test for r30939.

	* lib/test/unit.rb: For test.

	* lib/test/parallel.rb: For test.

	* lib/test/unit/testcase.rb: For test.

Wed Feb 23 22:05:13 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_engine.c: parenthesize macro arguments.

Tue Feb 22 23:15:17 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Fix --ruby option doesn't effect.

	* lib/test/unit.rb: Fix typo.

Tue Feb 22 21:39:28 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_digest.c: parenthesize macro arguments.

Tue Feb 22 14:34:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Fix merging miss.

Tue Feb 22 12:27:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add new options; --jobs,-j,--ruby,--jobs-status,
	  --no-retry.
	  [Feature #4415] [ruby-dev:43226],[ruby-dev:43222],[ruby-core:35294]

	* lib/test/unit/parallel.rb: Used at test/unit --jobs(-j) option.

	* test/csv/test_serialization.rb: test/unit parallel running ready.

	* test/rake/test_file_task.rb: test/unit parallel running ready.

Tue Feb 22 06:09:10 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/syslog/syslog.c: Apply documentation patch from mathew murphy.
	  [Bug #4149]

Tue Feb 22 03:09:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: increase Psych to 1.1.0 for help with
	  debugging.

Tue Feb 22 03:04:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/streaming.rb: refactor streaming methods to a
	  module.
	* ext/psych/lib/psych/stream.rb: extracted streaming specific methods
	  to a module.
	* ext/psych/lib/psych/json/stream.rb: JSON stream inherits from
	  JSONTree and includes streaming methods.
	* ext/psych/lib/psych/visitors/json_tree.rb: JSON does not support
	  object references, so remove object reference testing when building
	  JSON trees.

Tue Feb 22 02:41:51 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb (accept): use Hash#key?
	  when looking up object references to err on the side of cache
	  misses.

Mon Feb 21 10:58:39 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/yaml_events.rb: refactoring JSON event
	  handling methods to a module for reuse.
	* ext/psych/lib/psych/json/tree_builder.rb: AST builder uses JSON
	  event methods.
	* ext/psych/lib/psych/json/stream.rb: stream emitter uses JSON event
	  methods.

Mon Feb 21 10:54:29 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/stream.rb: do not emit custom tags in maps
	  or sequences when emitting JSON.
	* ext/psych/lib/psych/json/tree_builder.rb: do not emit custom tags in
	  sequences when emitting JSON.
	* test/psych/json/test_stream.rb: tests for custom stream emits.
	* test/psych/test_json_tree.rb: tests for JSON emits.

Mon Feb 21 10:05:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/ruby_events.rb: DRY up ruby event handling
	  for JSON.
	* ext/psych/lib/psych/visitors/json_tree.rb: use ruby events module
	* ext/psych/lib/psych/json/stream.rb: ditto

Mon Feb 21 10:01:01 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/stream.rb: fix JSON stream emits to use
	  double quotes during stream.
	* test/psych/json/test_stream.rb: tests to reflect changes.

Mon Feb 21 00:38:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  add testcase for bug4396.

Sun Feb 20 19:59:32 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_cipher.c: parenthesize macro arguments.

Sun Feb 20 16:26:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (exec_recursive): prevent temporary objects from GC.

	* prevent temporary objects from GC, and should not use
	  RSTRING_PTR() for function calls since it evaluates the argument
	  a couple of times.

Sun Feb 20 16:22:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_flock): use rb_thread_io_blocking_region for the
	  time being.

Sun Feb 20 05:33:17 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.2 r6207.
	* test/minitest/*: ditto

Sun Feb 20 02:14:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sig_trap): avoid pthread_sigmask(xx, &mask, &mask) usage
	  because FreeBSD don't permit it. If it's used, it behave as
	  pthread_sigmask(xx, NULL, &mask).

	* signal.c (init_sigchld): ditto.

Sun Feb 20 00:46:51 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_bn.c: parenthesize macro arguments.

Sat Feb 19 22:37:42 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_insnhelper.c (vm_check_if_namespace): guard temporary object
	  from GC.

Sat Feb 19 06:36:27 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/test/unit.rb: partial revert of r30849. [ruby-core:32864]

	* test/testunit/test_rake_integration.rb: adding an integration test
	  with the rake loader to prevent regressions.

Fri Feb 18 19:31:31 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::remove_entry_secure): there is a
	  race condition in the case where the given path is a directory,
	  and some other user can move that directory, and create a
	  symlink while this method is executing.
	  Reported by: Nicholas Jefferson <nicholas at pythonic.com.au>

Fri Feb 18 00:28:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* compile.c (get_exception_sym2type): guard temporary object from GC.

Thu Feb 17 23:54:29 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* iseq.c (prepare_iseq_build): initialize iseq_compile_data::err_info
	  with nil. this fix exception in rb_iseq_load().

Thu Feb 17 22:32:35 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_marshal.rb (test_marshal_dump_extra_iv):
	  fix a typo of local variable. [Bug #3720] [ruby-dev:42083]

Thu Feb 17 21:32:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl.h: parenthesize macro arguments.

Wed Feb 16 20:37:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* eval_jump.c (rb_exec_end_proc): changed at_exit and END proc
	  evaluation order. [Bug #4400] [ruby-core:35237]
	* eval_jump.c (rb_mark_end_proc): ditto.

	* test/ruby/test_beginendblock.rb (TestBeginEndBlock#test_nested_at_exit):
	  added a test for nested at_exit.
	* test/ruby/test_beginendblock.rb (TestBeginEndBlock#test_beginendblock):
	  changed the test to adopt new spec.

Wed Feb 16 20:17:06 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/openssl_missing.h: parenthesize macro arguments.

Tue Feb 15 21:37:45 2011  Tanaka Akira  <akr@fsij.org>

	* ext/gdbm/gdbm.c: parenthesize macro arguments.

Tue Feb 15 20:34:53 2011  Tanaka Akira  <akr@fsij.org>

	* array.c (ary_join_1): fix array size.

Tue Feb 15 19:43:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: fix and resubmit r30621. [ruby-dev:43203]

Tue Feb 15 15:41:30 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (array_join): copy the encoding of the first element as
	  an initial encoding.

	* array.c (array_join_0): ditto.

	* array.c (array_join_1): ditto.

	* array.c (inspect_ary): ditto.

	* array.c (array_join_1): add an argument to check the appending is
	  first one or not.

Tue Feb 15 15:40:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* hash.c (inspect_i): copy the encoding of the first key as
	  an initial encoding.

Mon Feb 14 15:00:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (inspect_ary): don't taint the inspected result of a
	  recursive array.

Tue Feb 15 15:43:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): change the rule for empty strings:
	  remove the special treatment of the US-ASCII encoded empty string.
	  Now Encoding.compatible? usually respect the encoding of the
	  receiver.

Tue Feb 15 15:39:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): remove special treatment of
	  ASCII-8BIT receivers.

	* string.c (str_gsub): set initial encoding of the buffer as the
	  same of the receiver. [ruby-core:35141]

Tue Feb 15 09:49:33 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_system.rb (TestSystem#test_system_at): use findstr
	  command instead of find command, because the latter is confusing
	  another famous Unix command.

Mon Feb 14 23:01:19 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (rb_thread_io_blocking_region): reset th->waiting_fd
	  after blocking region, because remaining waiting_fd might
	  cause unnecessary IOError.

Mon Feb 14 21:06:50 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in: revert r30621.  That revision introduced mkmf test
	  failures and it turned out to be OK to revert. [ruby-dev:43203]

Mon Feb 14 21:04:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/fiddle/conversions.h: parenthesize macro arguments.

Mon Feb 14 18:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/setup.mak (USE_RUBYGEMS): fixed r30835. It didn't work on
	  mswin32 port. If you changed win32/configure.bat, you should change
	  setup.mak too.

Mon Feb 14 17:28:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  added test. [ruby-core:35218] (#4393)

Mon Feb 14 13:15:35 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (is_internal_cmd): if the first char of prog is '@',
	  execute it via shell.  [ruby-core:35218] (#4393)

Mon Feb 14 10:33:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb: revert r30863, because it causes too many noise.

Mon Feb 14 07:34:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c: parenthesize macro arguments.

Sun Feb 13 19:41:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::RequireFiles#non_options): skip
	  test suites failed to load instead of mere messages.

Sun Feb 13 09:56:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/openssl/test_config.rb (OpenSSL#test_freeze): fix error
	  message assertion.

	* test/io/nonblock/test_flush.rb (TestIONonblock#flush_test):
	  return true to finish the test.

	* test/syck/test_string.rb (Syck::TestString#test_non_binary_string):
	  use assert_not instead of refute, unless required minitest
	  explicitly.

	* test/test_prime.rb (TestPrime::sieve.Integer): ditto.

	* test/xmlrpc/webrick_testing.rb (WEBrick_Testing#start_server):
	  catch IOError when server socket was closed.

Sun Feb 13 07:39:51 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_inject): typo fixed. a patch from Gaku Ueda in
	  [ruby-core:35216].

Sun Feb 13 00:48:47 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (Date#===): [ruby-core:35127]

Sun Feb 13 00:29:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Options#process_args): always
	  return options.

	* lib/test/unit.rb (Test::Unit::RequireFiles#non_options): return
	  if any test case get loaded.

	* lib/test/unit.rb (Test::Unit::AutoRunner#initialize): do not add
	  default directory if it is nil.

	* lib/test/unit.rb (Test::Unit::AutoRunner#process_args): return
	  true if any test cases to run.

Sat Feb 12 23:17:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (assert_include): add alias.

Sat Feb 12 14:44:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_io_blocking_region): new function to run
	  blocking region with GIL released, for fd.

	* thread.c (rb_thread_fd_close): implement.  [ruby-core:35203]

	* vm.c (th_init): rename from th_init2.

Sat Feb 12 14:41:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::AutoRunner#initialize): use
	  default_dir if no test case given.

	* lib/test/unit.rb (Test::Unit::Runner): rename from Test::Unit::Mini.

	* lib/test/unit.rb (Test::Unit::GlobOption#non_options): run tests
	  under base directory if no argument given.

Sat Feb 12 08:03:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_settracefunc.rb (TestSetTraceFunc): ensure to use
	  method_added hook defined in Module.

Sat Feb 12 01:04:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): enable rubygems if --gem option is given.

	* ruby.c (process_options): load rubygems if it is disabled but
	  --gem option is given.

Fri Feb 11 23:27:50 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ruby.c (proc_options): add --gem=enabled as an alias of
	  --enable=gems and --gem=disabled as an alias of --disable=gems.
	  Gem named "enabled" or "disabled" has already been reserved
	  legitimately for this purpose.

Fri Feb 11 23:17:04 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dl/cfunc.c: parenthesize macro arguments.

Fri Feb 11 21:41:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bin/testrb, test/runner.rb, lib/test/unit.rb: improve backward
	  compatibility.

Fri Feb 11 19:45:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): use rb_ary_free to free internal object.

	* gc.h (RUBY_FREE_UNLESS_NULL): get rid of double free.
	  [ruby-core:35192]

Fri Feb 11 16:57:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_transcode.rb (test_from_cp50221): fix wrong
	  assertion and move back.

Fri Feb 11 14:33:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_no_match): alias for
	  backward compatibility.

Fri Feb 11 12:06:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (add_gems, require_libraries, proc_options): add
	  --require and --gem options.

Fri Feb 11 12:03:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rubygems): add --disable-rubygems option.

Fri Feb 11 11:39:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in (CROSS_COMPILING): get rid of NameError.

Thu Feb 10 23:12:34 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dl/dl.h: parenthesize macro arguments.

Wed Feb  9 23:11:27 2011  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c: parenthesize macro arguments.

Tue Feb  8 11:47:11 2011  Loren Sands-Ramshaw  <lorensr@gmail.com>

	* array.c: documentation clarification in rotate, rotate!,
	  index, and rindex. [ruby-core:35144]

Wed Feb  9 09:45:43 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_encoding.rb: remove unnecessary (and wrong)
	  platform-dependent hacks.

Wed Feb  9 00:47:18 2011  Tanaka Akira  <akr@fsij.org>

	* ext/etc/etc.c: parenthesize macro arguments.

Tue Feb  8 19:38:00 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg): fix for invalid nest errors.

Tue Feb  8 19:22:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in (AC_MSG_CHECKING): fixed typo. the patch is
	  created by Benoit Daloze. Thanks a lot. [Bug #4384][ruby-core:35148]

Tue Feb  8 16:04:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_s_sysopen): use NUM2MODET() instead NUM2UINT().

Tue Feb  8 15:59:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (rb_run_exec_options_err): use MODET2NUM() instead
	  LONG2NUM().

Tue Feb  8 13:59:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: revert r30725. Now we have proper runtime fallback.
	  Therefore, no need compile time disabling. (see r30762).

Tue Feb  8 01:00:21 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* process.c (proc_setgroups): add GC guard to prevent intermediate
	  variable from GC.

Tue Feb  8 00:56:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg, ruby-in-here-doc-p): tell
	  singleton class definitions from here documents.

	* misc/ruby-mode.el (ruby-expr-beg, ruby-parse-partial): keyword
	  followed by colon is label.

Mon Feb  7 22:56:16 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/benchmark.rb (Benchmark#bmbm): use ensure clause instead of
	  Object#tap to restore STDOUT.sync.

Mon Feb  7 22:34:20 2011  Tanaka Akira  <akr@fsij.org>

	* lib/net/http.rb (Net::HTTP#connect): support SNI (Server Name
	  Indication) for HTTPS.  [ruby-dev:43164]
	  http://stackoverflow.com/questions/4685736/openssl-server-name-indication-support-in-ruby

Mon Feb  7 16:05:32 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.3  Fixes [Bug #4376]

Mon Feb  7 11:46:59 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (rdoc): add --encoding=UTF-8; ruby's rdoc must be UTF-8.

Mon Feb  7 10:21:50 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_options.rb (TestRDocOptions#test_check_files):
	  there is no easy way to create owner unreadable file on Windows.
	  So, skip the test.

Sun Feb  6 13:48:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/lib/json/common.rb (JSON::MissingUnicodeSupport.iconv):
	  should not drop rest of the result.  use Iconv.conv instead.

Sun Feb  6 12:46:02 2011  Eric Hodel  <drbrain@segment7.net>

	* string.c (gsub): Ensure result encoding is the same as input
	  encoding.  [Bug #4340].

Sun Feb  6 12:18:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (words, qwords): dispatch array events.  based on a
	  patch from Michael Edgar.  [Bug #4365].

Sun Feb  6 12:12:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/fileutils/fileasserts.rb (FileAssertions): separate module.

Sun Feb  6 11:29:23 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c: parenthesize macro arguments.

Sat Feb  5 22:01:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  revert r30796. r30797 and r30798 are an alternative fix.
	  [ruby-dev:43174]

Sat Feb  5 21:47:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (mlhs_basic): include mlhs_post for ripper.  a patch
	  from Michael Edgar at [ruby-core:35078].

Sat Feb  5 21:22:21 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_block): move from
	  test/fileutils/fileasserts.rb.

	* test/fileutils/fileasserts.rb (assert_block): pass arguments
	  as-is.  [ruby-dev:43174]

Sat Feb  5 16:47:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  msg can be passed nil. [Bug #4371] [ruby-dev:43174]

Sat Feb  5 15:18:25 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.2

Sat Feb  5 12:05:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (syck_node_init_copy): SyckNode is not
	  copiable.  [ruby-core:35094]

Sat Feb  5 11:48:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_alloc): leave data ptr
	  NULL.

	* ext/openssl/ossl_cipher.c (ossl_cipher_new, ossl_cipher_initialize):
	  allocate internal structure.  [ruby-core:35094]

	* ext/openssl/ossl_cipher.c (ossl_cipher_copy): ditto.

Sat Feb  5 11:29:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/parser/parser.h (GET_PARSER): raise TypeError.

	* ext/json/parser/parser.rl (cParser_initialize): ditto.

	* ext/json/parser/parser.h (GET_PARSER): check if initialized.
	  [ruby-core:35079]

	* ext/json/parser/parser.rl (cParser_initialize): ditto.

Sat Feb  5 10:09:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_get_expanded_load_path): always expand load paths.

Sat Feb  5 09:38:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (encoded_dup): extract.

Sat Feb  5 03:37:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::LowMethods): make low level methods
	  in NoWrite and DryRun to do nothing.  [ruby-dev:43129]

	* test/fileutils/fileasserts.rb: add message arguments.

	* test/fileutils/fileasserts.rb (Test::Unit::Assertions#assert_block):
	  show the given message.

Sat Feb  5 02:09:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lex_getline, parser_set_encode): set encoding of lines
	  in SCRIPT_LINES__ as source encoding.  [ruby-dev:43168]

Sat Feb  5 02:08:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_thread_data_type): add prefix.

Sat Feb  5 00:59:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (GetThreadPtr): use TypedData_Get_Struct() instead
	  CoreDataFromValue() because we need type check. Otherwise,
	  type mismatch can cause segmentation fault crash.
	  [ruby-core:35086] [Ruby 1.9-Bug#4367]

	* vm.c (thread_data_type): remove static.

Fri Feb  4 19:14:27 2011  Tanaka Akira  <akr@fsij.org>

	* enc/trans/utf8_mac.trans: parenthesize macro arguments.

Fri Feb  4 12:11:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (str_utf8_nth): fixed a condition of optimized lead
	  byte counting. [Bug #4366][ruby-dev:43170]

Fri Feb  4 01:50:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (count_utf8_lead_bytes_with_word): wrote function
	  comments.

Fri Feb  4 00:14:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_reader_get_unused): no need to dup
	  before rb_str_resurrect.

Thu Feb  3 20:04:44 2011  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c (CHECK): unused macro removed.

Thu Feb  3 18:33:26 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_reader_get_unused): use rb_str_resurrect
	  because gz->z.input is hidden string. [ruby-core:35057]

Thu Feb  3 16:34:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c (code_to_mbc): cast as int from the subtraction of
	  pointers.

	* enc/utf_16le.c (utf16le_mbc_enc_len): use ptrdiff_t.

	* enc/utf_32be.c (utf32be_left_adjust_char_head): ditto.

	* enc/utf_32le.c (utf32le_left_adjust_char_head): ditto.

Thu Feb  3 16:31:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/missing.h: don't use HAVE_STDDEF_H because it never
	  defined by configure though configure.bat defines it.

	* include/ruby/ruby.h: move include stddef.h to defines.h

	* include/ruby/defines.h: ditto.

Wed Feb  2 20:25:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_step_back): cast 4th argument 'n'
	  as int because Ruby usually treats length value as long but
	  onigenc_step_back's 4th argument is int.

Thu Feb  3 07:20:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: use Regexp::NOENCODING
	  rather than magic number.

	* ext/syck/lib/syck/rubytypes.rb: ditto

Thu Feb  3 07:16:11 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* re.c (Init_Regexp): added a constant for ARG_ENCODING_NONE
	  [ruby-core:35054]

	* test/ruby/test_regexp.rb: corresponding test.

Thu Feb  3 07:02:16 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: ARG_ENCODING_NONE regular
	  expressions can round trip. [ruby-core:34969]

	* test/psych/test_yaml.rb: test for ARG_ENCODING_NONE regex

	* ext/sych/lib/syck/rubytypes.rb: ARG_ENCODING_NONE regular
	  expressions can round trip.

	* test/syck/test_yaml.rb: test for ARG_ENCODING_NONE regex

Wed Feb  2 17:09:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_fdatasync): Use fsync(2) if the underlying
	  operating system does not support fdatasync(2).

Wed Feb  2 14:51:08 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup/to_tt_only.rb: commit miss
	* test/rdoc/test_rdoc_markup_to_tt_only.rb: ditto
	* test/rdoc/test_rdoc_single_class.rb: ditto

Wed Feb  2 09:27:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.1

Wed Feb  2 00:30:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/st.h (st_table): Added comment why we need __extension__.

Tue Feb  1 20:45:44 2011  Tanaka Akira  <akr@fsij.org>

	* enc/encdb.c: parenthesize macro arguments.

Tue Feb  1 15:12:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_require.rb (TestRequire#test_require_with_unc):
	  use ``127.0.0.1'' instead of ``localhost'' as host name, because
	  XP or earlier cannot resolv it as NBT hostname.

Tue Feb  1 13:20:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/benchmark/test_benchmark.rb (#capture_bench_output):
	  Added explicit sleep. Windows have imprecise time support.
	  Thus Tms.new.Add!{} may be or may be not equal 0. The
	  test failure started since r30747.

Tue Feb  1 11:03:47 2011  Ryan Davis  <ryan@lust.local>

	* lib/rubygems*: Import rubygems 1.5.0 (released version @ 1fb59d0)
	* test/rubygems: Ditto

Tue Feb  1 08:01:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_set_winsize): new method to set
	  console size.  [EXPERIMENTAL]

	* ext/io/console/console.c (console_winsize): use GetWriteFD.

Tue Feb  1 02:28:14 2011  Masaya Tarui  <tarui@ruby-lnag.org>

	* include/ruby/win32.h, win32/win32.c: add rb_w32_inet_ntop.
	  inet_ntop's minimum supported client is Vista.

Tue Feb  1 00:10:30 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/benchmark.rb: fix benchmark to work with current ruby.
	  patched by Benoit Daloze [ruby-core:33846] [ruby-dev:43143]
	  merged from https://github.com/eregon/ruby/commits/benchmark

	*  lib/benchmark (Report#width): update documentation
	*  lib/benchmark: document the return value of #benchmark and the
	   :list attribute in Report
	*  lib/benchmark (Tms#format): rename variables, use String#%
	   instead of Kernel.format
	*  lib/benchmark: remove undocumented Benchmark::times (an alias
	   of Process::times used twice)
	*  lib/benchmark (#benchmark): use label_width for the caption
	*  lib/benchmark (Tms#initialize): rename variables
	*  lib/benchmark: allow title to not be a String and call #to_s
	*  lib/benchmark (Benchmark#bm): return an Array of the times with
	   the labels
	*  lib/benchmark: correct output for Benchmark#bmbm
	   (remove the extra space)
	*  lib/benchmark: add a few tests for Benchmark::Tms output
	*  lib/benchmark: improve style (enumerators, ljust, unused vars)
	*  lib/benchmark: add spec about output and return value
	*  lib/benchmark: improve basic style and consistency
	   no parenthesis for print and use interpolation instead of printf
	*  lib/benchmark: remove unnecessary conversions and variables
	*  lib/benchmark: correct indentation
	*  lib/benchmark: rename the FMTSTR constant and variable to FORMAT
	*  lib/benchmark: remove useless exception

	*  test/benchmark: remove unused variable warnings

Mon Jan 31 23:27:23 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* node.c (add_id): remove duplicated rb_id2str() call.

Sun Jan 30 17:19:46 2011  Tanaka Akira  <akr@fsij.org>

	* missing/langinfo.c: parenthesize macro arguments.

Mon Jan 31 21:57:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: revert r30698.

Mon Jan 31 21:32:44 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (thread_start_func_2): check deadlock condition before
	  release thread stack. fix memory violation when deadlock detected.
	  reported by Max Aller. [Bug #4009] [ruby-core:32982]

Mon Jan 31 14:45:47 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale::#search_file):
	  Gem might be undefined if --disable-gems. [ruby-core:34990]

Mon Jan 31 12:26:14 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: suppressed shorten-64-to-32 warnings.
	* regcomp.c: ditto.
	* regexec.c: ditto.
	* regint.h: ditto.
	* regparse.c: ditto.
	* regparse.h: ditto.
	* time.c: ditto.
	* variable.c: ditto.

Mon Jan 31 04:45:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_uniq_bang): call ARY_SET_LEN(ary, 0) before
	  ary_resize_capa because ary_resize_capa expects resized length is
	  smaller than current array length. call rb_ary_unshare before
	  ary_resize_capa because ary_resize_capa lost the reference to
	  original shared array. [ruby-core:34997]

Sun Jan 30 17:19:46 2011  Tanaka Akira  <akr@fsij.org>

	* missing/crypt.c: parenthesize macro arguments.

Sun Jan 30 16:40:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rubygems/test_gem_security.rb (TestGemSecurity): valid only
	  if OpenSSL is available.

	* test/dl/test_dl2.rb (TestDL#test_sin): math functions do not
	  work on x86_64 due to the design of DL2.

	* test/dl/test_func.rb (DL::TestFunc#test_{sinf,sin): ditto.

Sun Jan 30 16:09:22 2011  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): %G produces 4 digits.

Sun Jan 30 15:13:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/emacs_mule.c (emacsmule_islead): 7bit range is also leading
	  byte.

Sun Jan 30 13:03:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_fetch_m): use useful message for longer key, not a
	  nonsense id value.

	* string.c (rb_str_ellipsize): new function to ellipsize a string.

	* include/ruby/encoding.h (rb_enc_step_back): new function to step
	  back n characters.

Sun Jan 30 12:53:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/emacs_mule.c (emacsmule_islead): fix inverse condition.

Sun Jan 30 09:37:25 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* io.c (struct argf): char behaves like an unsigned char
	  by default on AIX.

Sun Jan 30 08:02:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: Mac OS X wrongly reports it has fdatasync(3).

Sun Jan 30 03:29:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (GetBNPtr): add missing nil case.
	  patched by Martin Bosslet. [ruby-core:34987]

Sun Jan 30 01:02:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/ruby.h: Added NUM2MODET() and MODET2NUM() default
	  definition.
	  Because r30686 introduced win32 build failure.

Sat Jan 29 22:16:26 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_join): [].join.encoding must be US-ASCII.
	  [ruby-list:47790]

Sat Jan 29 20:22:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/driver.rb (BenchmarkDriver#measure): Show command line
	  when abnormal exiting occur.

Sat Jan 29 10:53:16 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_get_ev_const): no-scope reference to toplevel
	  private constant has been prohibited incorrectly.

	* test/ruby/test_module.rb (test_toplevel_private_constant): add a
	  test for above.

Sat Jan 29 08:43:23 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.5.0 (release candidate @ 09893d9)
	* test/rubygems: Ditto

Sat Jan 29 02:02:37 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (rb_mod_const_of, sv_i): Module#constant should exclude
	  private constants.  see [ruby-core:32912].

	* test/ruby/test_module.rb (test_constants_with_private_constant): add
	  a test for above.

Sat Jan 29 01:36:41 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (rb_const_set): const_set should preserve constant
	  visibility.  see [ruby-core:32912].

	* test/ruby/test_module.rb: add a test for above.

Sat Jan 29 01:24:57 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (NODE_CLASS, NODE_MODULE), insns.def (defineclass): raise
	  an exception when "class Foo::Bar" is evaluated and Foo::Bar is
	  private.  To implement this, define_type of "defineclass" is added
	  so that the instruction can distinguish whether the class definition
	  is scoped (class Foo::Bar) or not (class Bar).

	* test/ruby/test_class.rb (test_redefine_private_class),
	  test/ruby/test_module.rb
	  (test_define_module_under_private_constant): add tests for above.

Sat Jan 29 01:19:17 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* constant.h, variable.c: to ensure compatibility, rb_const_get_* must
	  not raise an exception even when the constant is private.  Instead,
	  rb_public_const_get_* and rb_public_const_defined_* are introduced,
	  which raise an exception when the referring constant is private.
	  see [ruby-core:32912].

	* vm_insnhelper.c (vm_get_ev_const): use rb_public_const_get_* instead
	  of rb_const_get_* to follow the constant visibility when user code
	  refers a constant.

	* test/ruby/test_marshal.rb (test_marshal_private_class): add a test.
	  This test had failed because of incompatibility of rb_const_get.

Sat Jan 29 00:30:44 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): fix typo.  a patch from Tomoyuki
	  Chikanaga in [ruby-core:32919].

Fri Jan 28 23:20:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_no_create,
	  TestGDBM2#test_writer_open_notexist): We only need to skip libgdbm
	  1.8.0, not all 1.8.x. 1.8.1 or later don't have GDBM_WRITER sickness.

Fri Jan 28 21:56:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/dbm/extconf.rb: Added new header places for Fedora13.

Fri Jan 28 21:49:30 2011  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c: parenthesize macro arguments.

Fri Jan 28 17:47:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM2#test_writer_open_notexist):
	  gdbm 1.8.x changed GDBM::WRITER behavior. Thus our testcase need
	  to be changed too.

Fri Jan 28 17:33:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_no_create): skip
	  the test if gdbm version is 1.8.x.

Fri Jan 28 16:30:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_too_long_filename):
	  Added -w option because too long path error don't output a message
	  by default since r30660. [Bug #4336] [ruby-dev:43134]

Fri Jan 28 16:19:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_path_home_{1,2}):
	  Added -w option because too long path error don't output a message
	  by default since r30660. [Bug #4336] [ruby-dev:43134]

Fri Jan 28 16:04:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_path_home_{1,2,3}):
	  split from test_require_path_home.

Fri Jan 28 13:04:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in (--with-valgrind): Fixed r29683. Now this option
	  is really default on.

Fri Jan 28 12:05:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add #include<sys/stat.h> when struct stat is
	  tested. Otherwise, incomplete type dereference error will occur.

Fri Jan 28 11:53:19 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: redundant variable names made strange conftest
	  error. Fixed it.

Fri Jan 28 11:47:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path{,2}):
	  should handle Errno::E2BIG, because this test checks crash of ruby,
	  not the error type system.

Fri Jan 28 11:23:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_open): Use NUM2MODET() instead NUM2UINT().
	* io.c (rb_scan_open_args): ditto.

Fri Jan 28 10:58:20 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Added mode_t type checking.
	* process.c (rb_exec_arg_addopt): Use NUM2MODET() instead
	  NUM2LONG because clang makes compile error by this narrowing
	  conversion.
	* process.c (rb_run_exec_options_err): ditto.

Fri Jan 28 02:37:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* re.c (rb_reg_raise): add GC guard to prevent intermediate
	  variable from GC.

Fri Jan 28 02:35:41 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* hash.c (rb_hash_fetch_m): add GC guard to prevent intermediate
	  variable from GC.

Fri Jan 28 01:33:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path)
	  TestProcess#test_too_long_path): Reduced string size from 100MB
	  to 10MB. 100MB may cause no memory error. It isn't intended.

Fri Jan 28 01:27:42 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path2):
	  Factored out from test_too_long_path. A test should only do
	  one test.

Thu Jan 27 23:29:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_foreach): check if unpacked.

Thu Jan 27 23:14:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-map): remove deprecated binding.
	  use M-; instead.

Thu Jan 27 21:58:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* bignum.c (rb_str_to_inum): get rid of too huge alloca().

Thu Jan 27 21:43:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): rewrite again. use ALLOCV instead
	  rb_str_tmp_new().

Thu Jan 27 21:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c: get rid of STRNDUPA(). It's dangerous API.

Thu Jan 27 21:31:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_aspawn): get rid of too huge alloca().
	  [Bug #4330] [ruby-core:34898]

Thu Jan 27 20:30:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_spawn): get rid of too huge alloca().

Thu Jan 27 18:49:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (open_dir_handle): get rid of too huge alloca().

Thu Jan 27 18:34:58 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (w32_io_info): get rid of too huge alloca().
	  [Bug #4313] [ruby-core:34830]

Thu Jan 27 18:19:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (wstati64): get rid of too huge alloca().
	  [Bug #4316] [ruby-core:34834]

Thu Jan 27 15:11:52 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): get rid of too huge
	  alloca(). this is the real fix of [ruby-core:34833].

Thu Jan 27 12:46:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (ALLOC_ARGV_WITH_STR): fix void pointer arithmetic.

Thu Jan 27 08:41:40 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_exec_v, rb_proc_exec_n, rb_proc_exec)
	  (proc_spawn_n, proc_spawn): get rid of too huge alloca().
	  [ruby-core:34827], [ruby-core:34833]

Thu Jan 27 08:32:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ALLOCV): new API for exception-safe
	  temporary buffer.  [ruby-core:34844]

	* string.c (rb_alloc_tmp_buffer, rb_free_tmp_buffer):
	  implementation of the API.

Thu Jan 27 08:22:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln_find.c (dln_find_1): use rb_warning and return immediately
	  if fname is longer than buffer.

Wed Jan 26 22:57:30 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* class.c (clone_method): add GC guard to prevent intermediate
	  variable from GC. [Bug #4321] [ruby-dev:43107]

Wed Jan 26 22:45:16 2011  Tanaka Akira  <akr@fsij.org>

	* template/id.h.tmpl: parenthesize macro arguments.

Wed Jan 26 22:28:49 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_eval.c (rb_throw_obj): add GC guard to prevent intermediate
	  variable from GC. [Bug #4322] [ruby-dev:43108]

Wed Jan 26 17:08:59 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode0): OpenSSL::ASN1.decode
	  should reject indefinite length primitive encodings as that is
	  illegal. Patch by Martin Bosslet. See #4324.

Wed Jan 26 10:36:28 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (=~): documentation fix; the return value is nil when
	  it doesn't match. patched by Andrei Kulakov [ruby-core:34562]

Tue Jan 25 08:41:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln_find.c (dln_find_1): omit too long pathnames.

Tue Jan 25 08:28:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_resize): get rid of out-of-bound access.

Tue Jan 25 07:48:22 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_thread.rb: remove unused variables.

Tue Jan 25 07:45:44 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_thread.rb (TestThread#test_condvar_nolock_2): get
	  rid of method redefined.

Tue Jan 25 07:00:52 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_string_value_cstr): rb_str_modify can change
	  RSTRING_PTR.

Tue Jan 25 03:24:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_thread.rb: Added various ConditionVariable tests.

Mon Jan 24 22:26:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): Fix again. use rb_str_tmp_new()
	  instead ALLOC_N.

Mon Jan 24 21:50:48 2011  Tanaka Akira  <akr@fsij.org>

	* vm_insnhelper.h: parenthesize macro arguments.

Mon Jan 24 21:28:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): use ALLOC_N instead ALLOCA_N because
	  ALLOC_N may cause stack overflow.

Mon Jan 24 21:04:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_invalid_str): prevent intermediate variable from GC.
	  [ruby-core:34820]

Sun Jan 23 23:01:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/console/test_io_console.rb: Don't run test if the system
	  don't support io/console.

Sun Jan 23 22:17:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/fiddle/test_fiddle.rb: Don't run test if the system don't support
	  fiddle.

	* test/fiddle/test_function.rb: ditto.
	* test/fiddle/test_closure.rb: ditto.

Sun Jan 23 11:39:18 2011  Tanaka Akira  <akr@fsij.org>

	* vm_exec.h: parenthesize macro arguments.

Sun Jan 23 10:33:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in (ruby): suppress warnings.

Sun Jan 23 08:00:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_nth_len, str_utf8_nth): return the rest length together.

	* string.c (rb_str_substr): get rid of measure the length always
	  to improve performance for huge string.  [ruby-core:34648]

Sun Jan 23 00:40:10 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/test_syslog.rb: Fix to make a lot of test failure if
	  the platform doesn't support syslog.

Sat Jan 22 11:49:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: fixing merge key support
	  when multiple merge keys are specified.

	* test/psych/test_merge_keys.rb: tests for multi-merge key support

Sat Jan 22 11:33:04 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: merge keys are actually
	  part of YAML 1.1, so they should be supported.  Remove warning and
	  merge keys to parent.  [ruby-core:34679]

	* test/psych/test_merge_keys.rb: test for merge keys

Sat Jan 22 10:25:19 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): add the file name to the exception when
	  parse errors occur.

	* test/psych/test_parser.rb: test for parse error file name

Sat Jan 22 10:12:30 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): fix assertion error when reusing a
	  parser after an exception has been raised

	* test/psych/test_parser.rb: test for assertion error

Sat Jan 22 04:09:22 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/nodes/node.rb: Make Psych::Nodes::Node
	  enumerable.

	* ext/psych/lib/psych/visitors/depth_first.rb: Add a depth-first
	  visitor to enumerate over a YAML AST in a depth-first fashion

	* test/psych/nodes/test_enumerable.rb: test for enumerating nodes

	* test/psych/visitors/test_depth_first.rb: test for depth-first
	  visitor

Sat Jan 22 00:53:42 2011  Tanaka Akira  <akr@fsij.org>

	* vm_core.h: parenthesize macro arguments.

Fri Jan 21 18:15:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: should not use -Werror=* flags while conftests.

Fri Jan 21 09:17:00 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: Fix incorrectly detected x86_64-w64-mingw32 due
	  canonalization of target_os. Bug #3889 [ruby-core:32634]

Thu Jan 20 23:44:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Fix rb_cv_va_args_macro was broken. We are using
	  -Werror=implicit-function-declaration compile option. therefore
	  we need a function declaration explicitly.

Thu Jan 20 23:58:02 2011  Tanaka Akira  <akr@fsij.org>

	* node.h: parenthesize macro arguments.

Thu Jan 20 23:25:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add '#include <stdlib.h>' to
	  rb_cv_localtime_overflow test too. It's reported by Tomoyuki
	  Chikanaga. Thanks.

Thu Jan 20 16:11:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* README.EXT, README.EXT.ja: You shouldn't choose ``conftest.c'' as a
	  name of a source file.

Thu Jan 20 12:15:44 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add stdlib.h inclusion into rb_cv_negative_time_t
	  test because it's required for exit(3). The patch is
	  created by Tomoyuki Chikanaga. [Bug #4287] [ruby-dev:43060]

Thu Jan 20 11:39:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/utils.rb (TestWEBrick::RubyBin): test CGI does not need
	  to load rubygems.  if it activated, ruby raises LoadError about
	  rbconfig.rb.

Thu Jan 20 09:19:42 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/json_tree.rb: Fix JSON emit for
	  DateTime and Time classes.

	* test/psych/test_json_tree.rb: test for JSON emit

Thu Jan 20 08:02:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/coder.rb (represent_object): arbitrary objects
	  may be passed to the Psych::Coder object.

	* ext/psych/lib/psych/visitors/yaml_tree.rb: support for visiting
	  arbitrary objects set on the coder.

	* test/psych/test_coder.rb: supporting test case.

Thu Jan 20 06:03:17 2011  Tanaka Akira  <akr@fsij.org>

	* method.h: parenthesize macro arguments.

Wed Jan 19 13:16:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/commands/sources_command.rb: Finish removing code,
	  (fixes sources command test).

Wed Jan 19 13:04:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* proc.c (proc_call): Add gc guard to avoid segfault. The fix
	  is created by Tomoyuki Chikanaga. [Bug #4238][ruby-dev:42963]

Wed Jan 19 12:31:28 2011  Eric Hodel <drbrain@segment7.net>

	* lib/rubygems.rb: Since gem_prelude requires rubygems, enable
	  custom_require always.

Wed Jan 19 12:08:08 2011  Eric Hodel <drbrain@segment7.net>

	* lib/rubygems/commands/dependency_command.rb: Remove require of
	  deleted file.
	* lib/rubygems/commands/fetch_command.rb: ditto
	* lib/rubygems/commands/setup_command.rb: ditto
	* lib/rubygems/commands/sources_command.rb: ditto
	* lib/rubygems/commands/specification_command.rb: ditto

Wed Jan 19 08:13:59 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.5.0 (release candidate)
	* test/rubygems: Ditto

Tue Jan 18 23:31:01 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y: avoid NULL reference.  [ruby-dev:43067]

Wed Jan 19 02:54:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (cvt): set first byte of buf to NUL for the case when
	  no bytes are written to the buf. [ruby-dev:43062]

Tue Jan 18 23:04:51 2011  Tanaka Akira  <akr@fsij.org>

	* gc.h: parenthesize macro arguments.

Tue Jan 18 18:31:14 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/completion.rb: Irb tab completion support for XX::method
	  forms.

Tue Jan 18 15:05:55 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: added RDoc document for logging message escape
	  by Hal Brodigan. See #3869

Tue Jan 18 07:53:52 2011  Tanaka Akira  <akr@fsij.org>

	* eval_intern.h: parenthesize macro arguments.

Tue Jan 18 04:42:44 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/parser.rb (Mark): Adding a class to wrap
	  marker information

	* ext/psych/parser.c (mark): Add a method to return the mark object
	  for the parser

	* test/psych/test_parser.rb: tests for the Mark class.

Tue Jan 18 02:46:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/json_tree.rb (visit_String): JSON
	  strings should be dumped with double quotes. [ruby-core:34186]

	* test/psych/test_json_tree.rb: test for double quotes

Mon Jan 17 23:36:33 2011  Tanaka Akira  <akr@fsij.org>

	* array.c (rb_ary_times): less MEMCPY calls.

Mon Jan 17 22:54:33 2011  Tanaka Akira  <akr@fsij.org>

	* debug.h: parenthesize macro arguments.

Mon Jan 17 21:40:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): revert r30549.

Sun Jan 16 20:55:45 2011  Tanaka Akira  <akr@fsij.org>

	* vsnprintf.c: parenthesize macro arguments.

Sat Jan 15 11:57:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): add -Werror=implicit-function-declaration
	  if available.

	* lib/mkmf.rb (init_mkmf): ignore warnings in mkmf tests.

	* test/mkmf/base.rb (setup, teardown): restore config values.

	* test/mkmf/test_flags.rb: split from test_find_executable.rb.

Sat Jan 15 10:04:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): autoload rubygems.

	* tool/compile_prelude.rb (Prelude#initialize): ignore empty
	  preludes.

	* ruby.c (ruby_init_prelude): get rid of global namespace
	  pollution.

Sat Jan 15 09:42:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h: missing prototypes.

Fri Jan 14 23:25:55 2011  Tanaka Akira  <akr@fsij.org>

	* vm_method.c: parenthesize macro arguments.

Fri Jan 14 15:32:29 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* test/net/imap/test_imap.rb: call neither logout nor disconnect
	  unless connected.  patch by Kazuhiro NISHIYAMA.  [ruby-dev:42860]

Fri Jan 14 14:56:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/imap.rb: use bytesize for binary strings.
	  patched by Yoshimasa Niwa. [ruby-core:34222]

Fri Jan 14 14:01:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_unpack): the resulted string of unpack('M') must have
	  ASCII-8BIT encoding (and ENC_CODERANGE_VALID). [ruby-core:34482]

Fri Jan 14 13:38:58 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_check_footer): ISIZE (Input SIZE) in
	  gzip's header is the size of uncompressed input data modulo 2^32.
	  [ruby-core:34481] http://www.ietf.org/rfc/rfc1952.txt

Fri Jan 14 11:36:25 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (RUNRUBY): require path should
	  include "." because rbconfig.rb is there.

Fri Jan 14 10:40:11 2011  Ryan Davis  <ryan@lust.local>

	* gem_prelude.rb: Just require rubygems. Fixes rubygems 1.4.
	* lib/rubygems.rb: removed all Gem::Quickloader code.
	* ruby.c: renamed ruby_init_gems to ruby_init_prelude. Set
	  $disable_rubygems since there is no fine grained mechanism to
	  skip parts of the prelude. Open to suggestions on how to do this
	  better.
	* test/*.rb: Load path isn't set up correctly, so add
	  --disable-gems as needed to failing tests that are explicitly
	  testing stderr w/ ==.

Fri Jan 14 07:30:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_next_argv): go advance when the next file cannot be
	  read.  [ruby-core:34446]

Thu Jan 13 20:49:19 2011  Tanaka Akira  <akr@fsij.org>

	* vm_insnhelper.c: parenthesize macro arguments.

Thu Jan 13 13:21:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* vm_dump.c: delete dashes to make lines 80 chars, Patched by
	  Shota Fukumori (sora_h).  [Bug #4275] [ruby-dev:43021]

Thu Jan 13 13:21:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* vm_dump.c: fix misspelling of CrashReporter, Patched by Shota
	  Fukumori (sora_h).  [Bug #4275] [ruby-dev:43021]

Thu Jan 13 06:27:29 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* error.c: Exception#to_s should actually call to_s.

Thu Jan 13 00:32:54 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (get_nth_dirname): decrement the directory index
	  because the index specifies the index of given included_directories
	  which is separated by NUL and its index is begun from 1.
	  Note that 0 specifies the current directory of the compilation.
	  see also http://www.dwarfstd.org/doc/dwarf-2.0.0.pdf

Thu Jan 13 00:06:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Add warning messages. [ruby-core:34062]

Thu Jan 13 00:00:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Some syscall return unsigned or pointer value.
	  Therefore we should only check the result is -1 or not.
	  [ruby-core:34062]

Wed Jan 12 23:55:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Add 64bit Linux support. Some syscall takes
	  long type arguments.

Wed Jan 12 19:37:10 2011  Tanaka Akira  <akr@fsij.org>

	* vm_dump.c: parenthesize macro arguments.

Wed Jan 12 19:28:23 2011  Tanaka Akira  <akr@fsij.org>

	* vm.c (thread_free): reset ruby_current_thread if it points the
	  thread to free.
	* gc.c (slot_sweep): don't call RUBY_VM_SET_FINALIZER_INTERRUPT if
	  there is no current thread.
	  [ruby-dev:43000]

Wed Jan 12 19:09:29 2011  Tanaka Akira  <akr@fsij.org>

	* enum.c (sort_by_i): reenter check more strictly.
	  (sort_by_cmp): ditto.
	  [ruby-dev:43003] reported by Usaku NAKAMURA.

Wed Jan 12 16:25:12 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/net/http.rb (Net::HTTP#connect): makes it timeout during
	  SSL handshake too. [ruby-core:34203]
	  Patch by Marc Slemko.

	* test/net/http/test_http.rb (TestNetHTTP_v1_2#test_timeout_during_HTTP_session):
	  test for [ruby-core:34203]

	* test/net/http/test_https.rb (TestNetHTTPS#test_timeout_during_SSL_handshake):
	  ditto.

Wed Jan 12 16:24:53 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/readline/extconf.rb: new checks for RL_PROMPT_START_IGNORE
	  and RL_PROMPT_END_IGNORE. [ruby-core:34331]

	* ext/readline/readline.c: enables USE_INSERT_IGNORE_ESCAPE only if
	  RL_PROMPT_{START,END}_IGNORE are available to get rid of compilation
	  error with libedit.

Wed Jan 12 15:53:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* README.EXT.ja (rb_ensure): typo.

Wed Jan 12 11:33:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: OpenBSD uses the elf_abi.h header file instead of the
	  elf.h header file. patched by Jeremy Evans [ruby-core:34384]

Wed Jan 12 03:59:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/webrick/test_cgi.rb: Removes usage of deprecated
	  :RequestHandler option.
	  patched by Peter Weldon [ruby-core:34010]

	* test/webrick/test_httpproxy.rb: ditto.

	* test/webrick/test_httpserver.rb: Add a test of the deprecation
	  behaviour.

Wed Jan 12 08:37:07 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (hash_i): return different values for inverse hash.
	  [ruby-core:34334]

Tue Jan 11 20:32:59 2011  Tanaka Akira  <akr@fsij.org>

	* variable.c: parenthesize macro arguments.

Tue Jan 11 13:06:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* array.c (rb_ary_resize): should care of embeded array when extending
	  the array.

	* array.c (rb_ary_resize): need to set capa when changing the real
	  size of the array.
	  these are latent bugs.

Mon Jan 10 22:46:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): HFS+ is case
	  insensitive.

	* load.c (loaded_feature_path, rb_feature_p, load_lock): on a
	  case-insensitive filesystem, loaded features search should
	  ignore case.  [ruby-core:34297]

Mon Jan 10 21:34:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags): show LD commands.

Mon Jan 10 14:32:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_method.rb (TestMethod#test_define_method): method
	  transplanting between class and module is impossible.

Mon Jan 10 13:51:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/rdoc-mode.el (rdoc-mode): show trailing whitespace.

Mon Jan 10 11:22:02 2011  Tanaka Akira  <akr@fsij.org>

	* util.c: parenthesize macro arguments.

Mon Jan 10 07:41:31 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/README: mention rdoc-mode.el and ruby-style.el.

Sun Jan  9 20:37:21 2011  Tanaka Akira  <akr@fsij.org>

	* transcode.c: parenthesize macro arguments.

Sun Jan  9 16:31:53 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* io.c (Kernel.#syscall): implemented on LP64/LLP64 environments too.
	  also uses __syscall if available for *BSD on 64bit architecture.
	  [ruby-core:34062]

Sun Jan  9 16:31:34 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale::LOCALE_NAME_RE):
	  some platform has a locale without territory but with
	  encoding.
	  (#each_sub_locale): ditto.

Sun Jan  9 14:47:50 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c: apply a patch from Nobuyoshi Nakada.
	  fixed #3616 [ruby-core:31484] IRB + readline incorrectly counts
	  non-printing characters in prompt

Sat Jan  8 21:47:26 2011  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_sort_by): use rb_ary_resize.
	  (ary_cutoff): removed.

Sat Jan  8 21:24:17 2011  Tanaka Akira  <akr@fsij.org>

	* pack.c (swapf): compilation condition simplified.
	  (swapd): ditto.

Sat Jan  8 20:51:25 2011  Tanaka Akira  <akr@fsij.org>

	* pack.c (swapd): remove duplicated code.

Sat Jan  8 19:28:55 2011  Tanaka Akira  <akr@fsij.org>

	* thread.c: parenthesize macro arguments.

Fri Jan  7 23:07:40 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): backref needs to capture.

Fri Jan  7 21:57:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-variables), misc/ruby-style.el:
	  show trailing whitespace.

	* misc/ruby-mode.el (ruby-font-lock-syntactic-keywords): highlight
	  regexp after open bracket.  [ruby-core:34183]

Fri Jan  7 00:37:35 2011  Tanaka Akira  <akr@fsij.org>

	* string.c: parenthesize macro arguments.

Thu Jan  6 22:42:02 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigmul1_karatsuba): avoid overflow that make assertion
	  fail in certain case.  this patch is contributed from Ray Chason
	  <chasonr at gmail.com> in personal communication.

Thu Jan  6 20:55:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): ignore rest from first dot from
	  TARGET to generate init function name.
	  this is followup of r30464.

Thu Jan  6 11:27:01 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/tree_builder.rb (start_mapping): tags
	  should not be included in JSON mapping

Thu Jan  6 09:23:33 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/protocol.rb (eof?): BufferedIO should proxy eof? to the
	  underlying IO object.

Thu Jan  6 09:12:31 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/mkmf.rb (configuration): fixing gsub when multiple error flags
	  are passed to GCC.

Thu Jan  6 05:25:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_modify): export.

Thu Jan  6 05:14:41 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (get_strio, strio_set_string)
	  (strio_reopen): check if frozen.  [ruby-core:33648]

Thu Jan  6 05:10:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_resize): new utility function.  [ruby-dev:42912]

Thu Jan  6 05:03:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (init_funcname_len): ignore rest from first dot.
	  [ruby-dev:41774]

Thu Jan  6 02:55:48 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: use YAML 1.0 output
	  format for serializing nil values.  Thanks Eric Hodel!

	* test/psych/test_nil.rb: test for nil values

Wed Jan  5 14:21:34 2011  Mark Dodwell  <hi@mkdynamic.co.uk>

	* string.c: fix rdoc typo.
	  https://github.com/shyouhei/ruby/pull/3

Wed Jan  5 14:06:01 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_options.rb (TestRDocOptions#test_check_files):
	  skip on Windows because chmod 0 doesn't mean unreadable by owner.

Wed Jan  5 13:56:54 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/net/http.rb (Net::HTTP#get): A header hash given should not
	  be modified.

Wed Jan  5 12:10:08 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/dl/{cfunc.c,dl.h,handle.c}, ext/fiddle/fiddle.{h,c}: Use _WIN32
	  rather than checking for windows.h.  Thanks Jon Forums!
	  [ruby-core:33977]

Sat Jan  1 17:02:50 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale#search_file): make it possible
	  to load a localization from a gem.
	  (IRB::Locale#lc_path): obsoleted because of the change of #search_file
	  (IRB::Locale#each_localized_path): new private method, based on
	  lc_path
	  (IRB::Locale#find): follows the change of #search_file.
	  (IRB::Locale#load): removed duplicate with #find.

Sat Jan  1 11:44:42 2011  Tanaka Akira  <akr@fsij.org>

	* strftime.c: parenthesize macro arguments.

Sat Jan  1 11:10:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c: take care of platforms where long is bigger
	  than int.

Sat Jan  1 11:03:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS (optparse): shell completion support.

	* misc/README (rb_optparse.{bash,zsh}): for shell completion.

	* include/ruby/intern.h (VALUE rb_ary_print_on): I have never seen
	  this function anywhere.

Sat Jan  1 04:20:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* win32/win32.c (rb_w32_write_console): don't raise exception when
	  the conversion is for writing to console.
	  Patched by Heesob Park [ruby-core:33999]

Fri Dec 31 12:02:06 2010  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_sort_by): use less temporary objects.

Fri Dec 31 11:46:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags), lib/mkmf.rb (configuration): turn
	  warnings into errors only for bundled extensions.
	  [ruby-core:33815]

Fri Dec 31 11:15:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (sizeof): zlib.h mistakenly assumes the result
	  of sizeof to be int, not size_t.

Fri Dec 31 10:27:34 2010  Tanaka Akira  <akr@fsij.org>

	* st.c: parenthesize macro arguments.

Fri Dec 31 03:23:26 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD__uqtoa): Fix overflow when long != quad_t.
	  patched by Peter Weldon <peter.weldon AT null.net>
	  [ruby-core:33985]

Fri Dec 31 03:00:34 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* Makefile.in: remove unnecessary semicolons.

Thu Dec 30 23:09:47 2010  wanabe  <s.wanabe@gmail.com>

	* vm.c (vm_define_method): guard iseq from GC while method definition.
	  [ruby-dev:42832]

Thu Dec 30 20:18:32 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: ditto.

Thu Dec 30 20:57:09 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* Makefile.in: Check V=1 argument if run "make clean" or similar.

Thu Dec 30 20:41:50 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* Makefile.in: Kill ugly line continuation.

Thu Dec 30 11:49:40 2010  Tanaka Akira  <akr@fsij.org>

	* sprintf.c: parenthesize macro arguments.

Wed Dec 29 21:20:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (maygvl_copy_stream_wait_readwrite): define if USE_SENDFILE

Wed Dec 29 20:37:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: strip current directory prefix.

	* enc/depend (clean): remove name2ctype.h when out-of-place build.

	* win32/Makefile.sub (clean-enc): pass V to inferior make.

Wed Dec 29 18:23:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_expr_str): need to escape if the coderange is invalid.

Wed Dec 29 10:06:51 2010  Tanaka Akira  <akr@fsij.org>

	* signal.c: parenthesize macro arguments.

Wed Dec 29 07:22:15 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rake/rdoctask.rb: Deprecate in favor of rdoc/task.

Wed Dec 29 07:07:06 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 3.1

Tue Dec 28 18:36:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* error.c, include/ruby/intern.h (rb_compile_error_with_enc): new
	  function to raise syntax error, with source encoding'ed message.

	* parse.y (compile_error): use above function.
	  [ruby-core:33951] (#4217)

Tue Dec 28 07:37:38 2010  Tanaka Akira  <akr@fsij.org>

	* ruby.c: parenthesize macro arguments.

Tue Dec 28 07:17:11 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add ARGF.write and so on.

Tue Dec 28 07:12:38 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add new magic-comment. (warn-indent) [ruby-core:25442]

Tue Dec 28 04:32:37 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/extconf.rb: check for windows.h while building fiddle.
	  Thanks Jon Forums! [ruby-core:33923]

Tue Dec 28 01:45:12 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: Add Zlib.deflate and Zlib.inflate.
	  [ruby-dev:42833]

Mon Dec 27 21:22:33 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/configure.bat: Remove obsoleted coding rule. Now, we
	  don't support to build on Windows 95/98 and Me.

Mon Dec 27 18:27:13 2010  Tanaka Akira  <akr@fsij.org>

	* re.c: parenthesize macro arguments.

Mon Dec 27 15:22:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/README.win32: note to need NT based OS to build ruby.

Mon Dec 27 12:14:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (EXTMK_ARGS): specify to pass macro V, because nmake
	  doesn't pass it via MAKEFLAGS.

Mon Dec 27 10:33:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (Init_zlib): Add Zlib.deflate and Zlib.inflate.
	  [ruby-dev:42833]

Mon Dec 27 07:38:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: add compdef for generator.

Mon Dec 27 07:32:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/optparse.rb (OptionParser#compsys): escape brackets too.
	  [ruby-dev:42754]

Mon Dec 27 01:30:08 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: add IF_NAMESIZE.
	  add a default for INET6_ADDRSTRLEN.

Sun Dec 26 23:49:47 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: suppress a strange error message when RMALL
	  found no such file.
	* win32/rmall.bat: new.

Sun Dec 26 21:23:23 2010    <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: fix 'nmake clean-enc' breakage since r28322.

Sun Dec 26 22:25:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/depend (ripper.y): fix messages with nmake.
	  [ruby-dev:42896]

Sun Dec 26 22:24:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): get rid of warnings caused by
	  -Wdeclaration-after-statement on cygwin.

Sun Dec 26 20:28:34 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec): add small comment.

Sun Dec 26 20:52:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: define INET_ADDRSTRLEN as 16 if not
	  available.  fix compilation error on mswin32-60.  reported by nobu.

Sun Dec 26 19:37:37 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c: define IFNAMSIZ if not available.
	  fix compilation error on mingw32.  reported by nobu.

Sun Dec 26 12:16:29 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths::HOMEDIR): no exception if
	  HOME is not set.  [ruby-core:33867]

Sun Dec 26 11:39:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): missing ripper rule.  i.e., `a::B ||= c 1'.
	  http://twitter.com/#!/wannabe53/status/18797576396472321
	  http://twitter.com/#!/wannabe53/status/18798416150663168

Sun Dec 26 11:15:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/with_different_ofs.rb (DifferentOFS): should not affect
	  original classes.

Sun Dec 26 09:35:07 2010  Tanaka Akira  <akr@fsij.org>

	* rational.c: parenthesize macro arguments.

Sun Dec 26 09:22:19 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (rb_if_indextoname): new function to abstract
	  environments without if_indextoname.
	  (inspect_ipv6_multicast_if): new function to inspect
	  IPV6_MULTICAST_IF.
	  Socket::Option.new(:INET6, :IPV6, :MULTICAST_IF,
	  [2].pack("I!")).inspect is
	  "#<Socket::Option: INET6 IPV6 MULTICAST_IF eth0>".

Sun Dec 26 04:31:15 2010  Luis Lavena  <luislavena@gmail.com>

	* ext/dl/win32/registry.rb: Corrected RegCreateKeyExA signature.
	  Patch by Rafal Michalski [ruby-core:33874] [Ruby 1.9-Bug#4203]

Sun Dec 26 02:31:58 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (advice_arg_check): Change argument check.
	  Now, an unsupported advice makes NotImplementedError.
	  [ruby-dev:42887] [Ruby 1.9-Feature#4204]

Sun Dec 26 03:00:53 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/extconf.rb: Fix build error which was introduced r30372.

Sun Dec 26 01:37:10 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: check the existence of if_indextoname().

	* ext/socket/option.c: yesterday's akr's commits destroyed the build of
	  some unrelated platforms (such as Windows).

Sat Dec 25 23:29:11 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_ipv4_add_drop_membership): new function
	  to inspect struct ip_mreq and struct ip_mreqn for
	  IP_ADD_MEMBERSHIP and IP_DROP_MEMBERSHIP.
	  Socket::Option.new(:INET, :IP, :ADD_MEMBERSHIP,
	  [239,255,99,81, 0,0,0,0].pack("CCCCCCCC")).inspect is now
	  "#<Socket::Option: INET IP ADD_MEMBERSHIP 239.255.99.81 0.0.0.0>".
	  (inspect_ipv4_multicast_if): new function to inspect struct in_addr
	  and struct ip_mreqn for IP_MULTICAST_IF.
	  Socket::Option.new(:INET, :IP, :MULTICAST_IF,
	  [192,168,0,7].pack("CCCC")).inspect is now
	  "#<Socket::Option: INET IP MULTICAST_IF 192.168.0.7>".

	* ext/socket/extconf.rb: check struct ip_mreq and struct ip_mreqn.

Sat Dec 25 22:49:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv: DifferentOFS needs to be include in each classes.

	* test/digest/test_digest_extend.rb (TestDigestExtend#setup):
	  should not depend on the result of previous tests

	* test/with_different_ofs.rb (DifferentOFS::WithDifferentOFS): give
	  name.

	* test/with_different_ofs.rb (DifferentOFS): test suite for test
	  suites affected by $,.

	* test/digest/test_digest_extend.rb (TestDigestExtend): should not
	  assume $, invariant.

	* test/csv/test_data_converters.rb, test/csv/test_table.rb: don't
	  call setup within tests.

Sat Dec 25 20:01:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (pipe_open): Added rb_thread_atfork(). We must reinitialize
	  GVL at new process creation.

Sat Dec 25 18:26:55 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_ipv6_mreq): new function to inspect
	  struct ipv6_mreq for IPV6_JOIN_GROUP and IPV6_LEAVE_GROUP.
	  Socket::Option.new(:INET6, :IPV6, :JOIN_GROUP,
	  [0xff12,0,0,0,0,0,0,1, 2].pack("nnnnnnnnI!")).inspect is now
	  "#<Socket::Option: INET6 IPV6 JOIN_GROUP ff12::1 eth0>".

	* ext/socket/extconf.rb: check struct ipv6_mreq.

Sat Dec 25 18:04:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/csv.rb (CSV.foreach): 'rb' mode is defaulted in open.

	* lib/csv.rb (CSV#init_separators): cannonicalize encoding options
	  as Encoding objects.

Sat Dec 25 18:30:34 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_atfork): Add small comment why we need
	  reset random seed.

Sat Dec 25 17:33:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv/base.rb (TestCSV.with_different_ofs): give name to
	  anonymous classes.

	* lib/csv.rb (CSV#init_separators): use IO#gets with length
	  parameter to get rid of wrong conversion.

	* lib/csv.rb (CSV::foreach, CSV#initialize): directly use encoding

	* lib/csv.rb, test/csv: should not assume $, invariant.

Sat Dec 25 16:08:06 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c: change rb_atomic_t definition from uchar to uint.

Sat Dec 25 15:04:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv/test_encodings.rb (TestEncodings#setup): fix evil test
	  suite writing to the source directory.

Sat Dec 25 15:08:08 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/pty/pty.c (chfunc): Added rb_thread_atfork_before_exec().
	  We must reinitialize GVL at new process creation. Otherwise
	  we may meet an insane deadlock. [Bug#4121][ruby-dev:42686]

Sat Dec 25 14:27:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_extract_encoding_option): accept Encoding object as
	  encoding: optional argument.  [ruby-dev:42884]

Sat Dec 25 13:37:55 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.2 r6093.

Sat Dec 25 13:05:59 2010  Tanaka Akira  <akr@fsij.org>

	* random.c: parenthesize macro arguments.

Sat Dec 25 12:48:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_f_require_relative): don't omit return type.

Sat Dec 25 11:06:00 2010  Eric Hodel  <drbrain@segment7.net>

	* load.c (rb_f_require_relative): Add documentation.

Sat Dec 25 11:02:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzreader_gets): support optional length
	  parameter.

	* ext/zlib/zlib.c (gzfile_read, gzfile_readpartial): length should
	  be long.

Sat Dec 25 10:51:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/generator/generator.{c,h} (fbuffer_free_only_buffer):
	  unused.

	* ext/openssl/ossl_pkcs5.c (ossl_pkcs5_pbkdf2_hmac): add casts.

Fri Dec 24 08:46:04 2010  Tanaka Akira  <akr@fsij.org>

	* process.c: parenthesize macro arguments.

Thu Dec 23 19:17:14 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/net/imap/cacert.pem: updated because it has been expired.

	* test/net/imap/server.crt: signed again because CA cert was expired.

Thu Dec 23 11:16:52 2010  Tanaka Akira  <akr@fsij.org>

	* parse.y: parenthesize macro arguments.

Thu Dec 23 11:00:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_type): check for type from extensions for ruby
	  1.8.  see [ruby-core:33797].

Thu Dec 23 08:12:59 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/smtp.rb: refactoring Net::SMTP#esmtp= to use an
	  attr_accessor

Thu Dec 23 06:35:41 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/smtp.rb: Net::SMTP should close the SSL connection if the
	  connection verification fails.

Thu Dec 23 01:47:58 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: remove #object_id. [ruby-dev:42840]

Wed Dec 22 08:56:39 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add Module#private_constant and Module#public_constant.
	  [ruby-dev:39685][ruby-core:32698]

Wed Dec 22 07:59:23 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add IO#advise. [ruby-core:33110] [Ruby 1.9-Feature#4038]

Tue Dec 21 23:45:31 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (Init_GC): move back object_id to Kernel. [ruby-dev:42840]

Tue Dec 21 12:45:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (target_archs): remove temporary objects.

	* enc/Makefile.in, enc/depend (clean): remove work directories.

Tue Dec 21 07:39:12 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: parenthesize macro arguments.

Tue Dec 21 06:25:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rexml/test_contrib.rb (ContribTester#test_pos): should not
	  use fixed path name for tests.  [ruby-dev:42827]

	* test/rexml/test_sax.rb (SAX2Tester#test_socket): should not use
	  fixed port for tests.  [ruby-dev:42828]

Tue Dec 21 06:10:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (caller_setup_args): reverted r30241 and r30243
	  except for the test.

Tue Dec 21 01:41:42 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* io.c : add an extra byte to buffer for the specification of read
	  in Windows. see [ruby-core:33460] and r29980. and, we have to
	  discuss how to do this one byte.

Tue Dec 21 01:18:06 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c: Fix build error for win32. This regression was
	  introduced by r30271.

Tue Dec 21 00:59:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_cleanup_func): Moved interrupted_lock
	  destroying code from native_thread_destroy() to
	  thread_cleanup_func() because it's platform independent logic.

	* thread_win32.c (native_thread_destroy): ditto.
	* thread_pthread.c (native_thread_destroy): ditto.

Tue Dec 21 00:46:20 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_cleanup_func): Don't touch native threading
	  resource at fork. Sadly this is purely bandaid. We need to
	  implement proper fix later. [Bug #4169] [ruby-core:33767]

Tue Dec 21 00:22:44 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c (exit_success_p): Check status code more carefully.
	  status code may have garbage in upper bit.

Mon Dec 20 23:12:37 2010  Tanaka Akira  <akr@fsij.org>

	* node.c: parenthesize macro arguments.

Mon Dec 20 20:04:41 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add #__id__ and #object_id. [ruby-dev:42778]

Mon Dec 20 20:03:21 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_thread_destroy): Fixed gvl_cond leak.

Mon Dec 20 13:49:05 2010  Eric Hodel  <drbrain@segment7.net>

	* NEWS: Add item for RDoc 3.0.1

	* lib/rdoc: Import RDoc 3.0.1, remove require for perl parser.

Mon Dec 20 12:15:32 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 3.0.

Mon Dec 20 01:55:03 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (Init_IO): Added O_DIRECT. This feature was proposed by
	  Run Paint Run Run.
	  [Feature #4015] [ruby-core:33018]

Sun Dec 19 19:15:23 2010  Tanaka Akira  <akr@fsij.org>

	* marshal.c: parenthesize macro arguments.

Sat Dec 18 21:52:37 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vsnprintf.c (BSD_vfprintf): suppress warning: "_WIN32" is not
	  defined.

Sat Dec 18 16:02:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (caller_setup_args): fix of r30241. lambda block
	  should check argument number.

Sat Dec 18 14:42:29 2010  Tanaka Akira  <akr@fsij.org>

	* load.c: parenthesize macro arguments.

Sat Dec 18 10:07:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args, iseq_compile_each): optimize AMPER LAMBDA
	  combination as block.

Fri Dec 17 22:07:16 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (Init_GC): move #__id__ and #object_id to BasicObject.
	  [ruby-dev:42778]

Fri Dec 17 19:35:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf::FakeLog): capture output from mkmf.

	* test/mkmf/test_find_executable.rb (test_find_executable):
	  suppress meaningless differences for chkbuild.

Fri Dec 17 13:26:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak (BASERUBY): quit with an error when BASERUBY was not
	  able to set, just like configure.in does. [ruby-dev:42782]

Fri Dec 17 07:04:09 2010  Tanaka Akira  <akr@fsij.org>

	* iseq.c: parenthesize macro arguments.

Fri Dec 17 04:18:37 2010  Eric Hodel  <drbrain@segment7.net>

	* transcode.c (str_encode): Alter comment for better wording and ri
	  output.

Fri Dec 17 00:05:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_advise): New API. IO#advise() allows to tell the
	  ruby runtime how it expects to use a file handle. This feature
	  can be improved a performance some situations.
	  Note: This feature is mainly developed by Run Paint Run Run.
	  Thank you! [ruby-core:33110] [Ruby 1.9-Feature#4038]

	* io.c (do_io_advise): Helper function.
	* io.c (io_advise_sym_to_const): ditto.

Thu Dec 16 23:29:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (bin-comm): use transformed name.
	  [ruby-dev:42777]

Thu Dec 16 21:52:07 2010  Tanaka Akira  <akr@fsij.org>

	* io.c: parenthesize macro arguments.

Thu Dec 16 21:46:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb (RbConfig): honor ARCHFLAGS and RC_ARCHS to
	  override embedded ARCH_FLAG value on universal-darwin.

Thu Dec 16 19:50:12 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{configure.bat,setup.mak,Makefile.sub} (PROGRAM_PREFIX,
	  PROGRAM_SUFFIX): unite the differences of the names of macros of
	  prefix and suffix.
	  reported by HANEDA Norikatsu. [ruby-dev:42775]

Thu Dec 16 08:04:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (RNode): match the type of flags to RBasic, and renamed
	  nd_file as nd_reserved.

	* iseq.c (set_relation), vm_insnhelper.c (vm_cref_push): nd_file
	  is always zero-cleared.

Thu Dec 16 07:22:30 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/unit.rb: Imported minitest 2.0.1 r6079.

Wed Dec 15 20:45:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb (process_args): need to setup @help to print options.

Wed Dec 15 11:19:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/zlib/test_zlib.rb (test_to_io): forgotten to fix with r30201.

Wed Dec 15 11:07:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (simple_sendfile): enable on Mac OS X.

	* io.c (nogvl_copy_stream_sendfile): moved precheck of copy length.

	* io.c (nogvl_copy_stream_sendfile): should wait for both of
	  read/write fds.

Wed Dec 15 07:11:55 2010  Tanaka Akira  <akr@fsij.org>

	* hash.c: parenthesize macro arguments.

Wed Dec 15 04:02:00 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_set_config):
	  fix compile error when !HAVE_X509V3_SET_NCONF. Thanks
	  Chikanaga-san. [ruby-dev:42761] [Ruby 1.9-Bug#4158]

Wed Dec 15 03:41:31 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ripper/test_parser_events.rb (TestRipper#test_block_variables):
	  Limit address space 100MB instead 100KB. Quite frankly, This
	  margin is too narrow to contain ruby. [ruby-dev:42763] [Bug#4159]

Tue Dec 14 23:53:52 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): improve linux compatibility on FreeBSD,
	  and now it works. But without cpuset -l 0, it still gets stuck.

Tue Dec 14 20:31:33 2010  Tanaka Akira  <akr@fsij.org>

	* gc.c: parenthesize macro arguments.

Tue Dec 14 18:31:48 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb: help messages.

Tue Dec 14 18:19:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (help): there is no reason to use the abbreviation for here.

Tue Dec 14 15:03:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (test_reopen, test_reinitialize): should close
	  the temporary files.

Tue Dec 14 14:24:15 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (make_tempfile): change the prefix from 'foo'
	  to 'test_io' because the old one is meaningless and inconvenient.

	* test/ruby/test_io.rb (test_binmode_after_closed): the temporary file
	  made by make_temfile is already closed.

Tue Dec 14 13:52:19 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (test_flush_in_finalizer[12]): should close
	  temporary file because it's only used for taking pathname and
	  unlinking the file after the end of the test (in GC phase).

Tue Dec 14 13:34:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_s_open): should close the IO if some error
	  occurs in initializing.

Tue Dec 14 13:04:16 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPRequest#send_request_body_data):
	  set binmode to tempfile.

Tue Dec 14 12:55:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/zlib/test_zlib.rb (*): should close files associated with zlib.

Tue Dec 14 11:30:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_argf.rb (test_inplace_rename_impossible): unlink
	  the renamed temporary file on no_safe_rename platforms.

	* test/ruby/test_argf.rb (test_readlines_limit_0,
	  test_each_line_limit_0): should close argf because the associated
	  Tempfile object cannot unlink the temporary file when it's gc'ed
	  on some platforms (Windows, etc.)

Tue Dec 14 11:27:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/minitest/unit.rb (Minitest::Unit#_run_suite): split test
	  name and its time. Thiw allows to know test's name when you are
	  running tests and meet a test which spends long time at realtime.

Tue Dec 14 11:25:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: Add -Werror=declaration-after-statement to default
	  warning flag. If you are using GCC, this flag is useful to
	  prevent breaking VC build.

Tue Dec 14 10:25:57 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode0): how many gcc-c99isms
	  must a man mend; before he can build with VC? r30178

Mon Dec 13 21:26:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): disable the use of sendfile(2) on
	  FreeBSD. It blocks on TestIO#test_copy_stream_socket.

Mon Dec 13 18:35:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c: define USE_SENDFILE on FreeBSD or DragonFly BSD.
	  Remove Mac OS X because its argument is different from them.

Mon Dec 13 12:00:09 2010  Tanaka Akira  <akr@fsij.org>

	* file.c: parenthesize macro arguments.

Mon Dec 13 11:21:14 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): added for BSD version of sendfile(2).

Mon Dec 13 09:50:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPRequest#set_form): Added to support
	  both application/x-www-form-urlencoded and multipart/form-data.
	  There is a similar API, Net::HTTPRequest#set_form_data, but
	  to keep its compatibility this is newly added. [ruby-dev:42729]

Sun Dec 12 23:45:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): fix for __goto__ and __label__
	  where were totally broken.

Sun Dec 12 22:45:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ID_H_INCLUDES): now id.h depends on vm_opts.h.

Sun Dec 12 20:42:47 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* template/id.h.tmpl: suppress all warning: "SUPPORT_JOKE" is not
	  defined.  [ruby-dev:42730]

Sun Dec 12 20:35:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: update how to install.

	* misc/rb_optparse.zsh: avoid error when setopt noclobber.

	* lib/optparse.rb: fix typo. pointed out at
	  <http://d.hatena.ne.jp/nagachika/20101207>.

Sun Dec 12 13:27:35 2010  Tanaka Akira  <akr@fsij.org>

	* eval_error.c: parenthesize macro arguments.

Sun Dec 12 11:53:24 2010  Tanaka Akira  <akr@fsij.org>

	* error.c: parenthesize macro arguments.

Sun Dec 12 04:01:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): fix: extra back slash is added when
	  the string is dummy encoding and includes \x22 or \x5C.

Sun Dec 12 02:42:24 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_asn1.c: indefinite length BER to DER encoding is
	  properly supported.  Thanks Martin Bosslet! [ruby-core:33082]

Sat Dec 11 17:43:34 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/bigdecimal/bigdecimal.h: suppress "warning: 'VPrint' declared
	  'static' but never defined".

Sat Dec 11 09:24:57 2010  Tanaka Akira  <akr@fsij.org>

	* encoding.c: parenthesize macro arguments.

Sat Dec 11 08:12:48 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c, ext/openssl/ossl_pkey_rsa.c: Document RSA, RSA
	  encryption/decryption and PKCS #5 encryption/decryption.

Sat Dec 11 06:23:41 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_x509name.c: include Comparable to provide #==.
	  Document OpenSSL::X509::Name#<=>.  [Ruby 1.9-Feature#4116]

Sat Dec 11 05:48:28 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: infinite loop on method_missing at loading.
	  [ruby-dev:42716] [Ruby 1.9-Bug#4129]

	* ext/tk/lib/multi-tk.rb: when no eventloop is running, ruby freezes at
	  exit.

Sat Dec 11 02:23:15 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/extconf.rb: try pkgconfig first, then fall back to
	  normal have_library, etc.  Thanks Erik Hollensbe. [ruby-core:32406]

Fri Dec 10 22:33:39 2010  Tanaka Akira  <akr@fsij.org>

	* dln_find.c: parenthesize macro arguments.

Fri Dec 10 20:05:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/id.h.tmpl (ruby_method_ids): suppress warnings.
	  [ruby-dev:42730]

Fri Dec 10 18:29:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): relatively called non-shared
	  binary cannot be found in PATH, so use given pathname.

Fri Dec 10 18:28:40 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (SCRIPTPROGRAMS): ignore backup files and etc.

	* cygwin/GNUmakefile.in (scriptbin): set executable bit.

	* tool/rbinstall.rb (install_recursive): always skip default ignored
	  files.  if block is given, call it instead of calling install.

	* tool/rbinstall.rb (bin-comm): use install_recursive.

Fri Dec 10 18:12:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf#config_value): extract macro value from
	  config.h.

	* test/mkmf/test_sizeof.rb (TestMkmf::TestSizeof#test_sizeof_builtin),
	  (TestMkmf::TestSizeof#test_sizeof_struct): more tests.

	* lib/mkmf.rb (check_signedness): should use the prelude code.
	  [ruby-dev:42731]

	* lib/mkmf.rb (Logging.log_close): separate from Logging.logfile.

	* test/mkmf/base.rb (TestMkmf::MKMFLOG): show mkmf.log at failures.

	* test/mkmf/base.rb (TestMkmf#teardown): close log file for each tests.

Fri Dec 10 11:36:43 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* compile.c (enum): remove a comma at end of enumerator list.

	* constant.h (rb_const_flag_t): ditto.

	* iseq.h (enum catch_type): ditto.

	* iseq.h (enum defined_type): ditto.

	* vm_core.h (enum iseq_type): ditto.

	* vm_core.h (enum vm_special_object_type): ditto.

Fri Dec 10 10:47:53 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (_HAVE_SANE_QUAD_): Don't forget LP64, r30156.

Fri Dec 10 10:37:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* sprintf.c (_HAVE_SANE_QUAD_): if a certain platform has LONG_LONG in
	  8 byte, it might be sane quad. [ruby-core:33634]

Fri Dec 10 10:07:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: remove version 1.1 features.

Fri Dec 10 02:18:02 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_cleanup): removing C
	  implementation of `cleanup`.

	* ext/openssl/lib/openssl/x509.rb: adding ruby implementation of
	  `cleanup`.  OpenSSL::X509::StoreContext#cleanup is deprecated since
	  reusing the underlying struct doesn't make sense. [ruby-dev:42546]

Thu Dec  9 20:14:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lvar_defined_gen, shadowing_lvar_gen, dvar_defined): no
	  warnings for unused method and block arguments.
	  [ruby-dev:42718] [ruby-dev:42724]

Thu Dec  9 19:25:49 2010  Tanaka Akira  <akr@fsij.org>

	* dln.c: parenthesize macro arguments.

Thu Dec  9 18:51:06 2010  Tanaka Akira  <akr@fsij.org>

	* lib/webrick/accesslog.rb (WEBrick::AccessLog#format): support
	  %{remote}p for logging remote (client) port number.
	  [ruby-dev:42670]

Thu Dec  9 11:00:30 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_dup): should copy contents only.  no instance
	  variable, no class would be copied.  it would affect methods
	  #sort, #reject, #transpose, #uniq, #compact, and #shuffle.
	  [ruby-core:33640]

	* array.c (rb_ary_reverse_m): ditto.

	* array.c (rb_ary_rotate_m): ditto.

Wed Dec  8 21:38:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl/lib/dl/struct.rb: clean a warning: assigned but unused
	  variable. patched by Kouhei Yanagita. [ruby-dev:42722]

	* ext/dl/lib/dl/import.rb: ditto.

Wed Dec  8 21:36:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (shadowing_lvar_gen): fix line number.  [ruby-dev:42718]

Wed Dec  8 20:37:11 2010  Tanaka Akira  <akr@fsij.org>

	* dir.c: parenthesize macro arguments.

Tue Dec  7 22:37:15 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* io.c (io_read): duplicate string if shared. [ruby-dev:42719]

Tue Dec  7 22:31:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Officious): separate completion
	  options from --help.  [ruby-dev:42690]

	* lib/optparse.rb (OptionParser::Completion#candidate),
	  (OptionParser::Switch#compsys): remove unused variables.

Tue Dec  7 22:05:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_loop): call default handler of the given
	  hash, method, proc or [] method as fallback.  [ruby-dev:42692]

Tue Dec  7 21:59:37 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/light/node.rb: remove circular require.

Tue Dec  7 21:56:01 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_light.rb: really suppress a warning.

Tue Dec  7 21:51:57 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_light.rb: suppress a warning.

Tue Dec  7 21:14:03 2010  Tanaka Akira  <akr@fsij.org>

	* debug.c: parenthesize macro arguments.

Tue Dec  7 21:06:38 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/doctype.rb, test/rexml/test_doctype.rb: suppress warnings.
	  [ruby-core:33305]
	  Reported by Aaron Patterson. Thanks!!!

Tue Dec  7 18:56:52 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (String#kconv): fix typo and update rdoc.
	  patched by Kouhei Yanagita [ruby-dev:42696]

Tue Dec  7 20:32:11 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_doctype.rb: add Accessor to test case name.

Tue Dec  7 20:31:02 2010  Kouhei Sutou  <kou@clear-code.com>

	* test/rexml/test_doctype.rb: Doctype -> DocType.

Tue Dec  7 20:29:23 2010  Kouhei Sutou  <kou@clear-code.com>

	* test/rexml/test_doctype_mixin.rb: rename to ...
	* test/rexml/test_doctype.rb: ... this to remove needless name.

Tue Dec  7 17:03:16 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (xlist): supported the XLIST command, which is an
	  extension by Apple and Google.  patch by Geoff Youngs.
	  [ruby-core:33521]

Tue Dec  7 08:00:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, win32/Makefile.sub (WERRORFLAG): flag to treat
	  warnings as errors.

	* lib/mkmf.rb (Logging.postpone): yield log file object.

	* lib/mkmf.rb (xsystem): add options, :werror only right now.

	* lib/mkmf.rb (with_werror): check as if warnings are errors.

	* lib/mkmf.rb (convertible_int): make declaration conflict
	  warnings errors not to pass wrong type.  [ruby-dev:42684]

	* lib/mkmf.rb (COMMON_MACROS): get rid of conflicts.

	* win32/Makefile.sub (WARNFLAGS): make declaration conflict
	  warnings errors if possible.

Sun Dec  7 21:16:10 2010  Tanaka Akira  <akr@fsij.org>

	* cont.c: parenthesize macro arguments.

Tue Dec  7 00:27:14 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* win32/win32.c (rb_w32_read): fixed more for readline,
	  and so on. [ruby-core:33511]

Mon Dec  6 23:18:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf#setup): run quietly.

	* test/mkmf/test_find_executable.rb (test_find_executable): use
	  configured results.

	* common.mk (test-build): test for build process.

Mon Dec  6 22:47:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): skip separators.

	* sample/optparse/opttest.rb: should not override --help.
	  [ruby-dev:42690]

Mon Dec  6 19:00:48 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: fix typos.

Mon Dec  6 18:59:04 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add new encodings.

Mon Dec  6 18:56:42 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_string.rb (TestString#test_scan): add a test for
	  [ruby-core:33338] #4087.

Mon Dec  6 18:55:36 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/uri/test_common.rb (TestCommon#test_encode_www_form): add
	  tests for r30015.

Mon Dec  6 10:39:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_pattern):
	  refix for restrict the pattern.

Mon Dec  6 09:45:11 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl (OpenSSL): add toplevel documentation
	* ext/openssl/ossl_ssl.c (SSLContext, SSLSocket: add additional
	  documentation
	* ext/openssl: move "let rdoc know about mOSSL" comments so they don't
	  show up in output

Mon Dec  6 09:16:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_pattern):
	  workaround fix pattern of hostname for RFC 3986. [ruby-dev:42672]

Mon Dec  6 09:14:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/mkmf.rb (check_signedness): rename unused variable prelude.

Sun Dec  5 17:56:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (make_metaclass): fix probable typo.  builtin type flag
	  cannot be used with FL_TEST.

Sun Dec  5 12:09:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/init.rb (IRB.parse_opts): fix typo. [ruby-core:33574]

Sun Dec  5 11:27:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): decrement for ungotten line.
	  [ruby-dev:42680]

Sun Dec  5 10:32:11 2010  Tanaka Akira  <akr@fsij.org>

	* complex.c: parenthesize macro arguments.

Sat Dec  4 11:39:17 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_x509ext.c (initialize): add documentation.

Sat Dec  4 11:21:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_update_by): new API for Hash#update.

Sat Dec  4 11:18:10 2010  Tanaka Akira  <akr@fsij.org>

	* class.c: parenthesize macro arguments.

Sat Dec  4 11:07:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_vm_inc_const_missing_count): missing prototype.

Sat Dec  4 08:50:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Init_iconv): no warnings if $VERBOSE is nil.

Sat Dec  4 08:25:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): revert r30064 and r30071,
	  because of [ruby-core:26761]. Bug#4106 rejected.

Sat Dec  4 07:46:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (String#tr_cpp): substitute * with P like as
	  autoconf.

Fri Dec  3 22:36:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): protected methods should be
	  checked against the real class.

Fri Dec  3 20:23:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (convertible_int): define printf format prefix too.

	* lib/mkmf.rb (convertible_int): detect convertible integer type.
	  port RUBY_REPLACE_INT from configure.in.

	* lib/mkmf.rb (check_sizeof): should return integer always.

Fri Dec  3 12:54:48 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (RCFLAGS): VC10 and after only. fixed the problem
	  of r30015. [ruby-core:33530]

Fri Dec  3 12:41:52 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* gc.c (rb_objspace_free): With our "lazy-sweep" GC engine, it is
	  possible for an object to survive until its surrounding object
	  space is about to be freed.  Those objects, if any, remains
	  leaked for the rest of a process life.  This is problematic
	  because for instance a T_DATA object may have its own destructor
	  to terminate something.

	* vm.c (ruby_vm_destruct): ruby_current_vm termination should be
	  somewhere after rb_objspace_free for above reason.

Fri Dec  3 12:17:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): protected singleton methods should
	  be visible from same real class methods.  [ruby-core:33506]

Fri Dec  3 07:08:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): round upto next char
	  boundary.  [ruby-dev:42674]

Fri Dec  3 06:52:46 2010  Tanaka Akira  <akr@fsij.org>

	* compile.c: parenthesize macro arguments.

Fri Dec  3 04:08:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): use st_insert2 and change return
	  value to int.

	* encoding.c (enc_alias): follow enc_alias_internal.

Fri Dec  3 01:52:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): use xfree instead of free.

Thu Dec  2 23:52:26 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* NEWS: entry for ruby_vm_at_exit().

	* eval.c (ruby_cleanup): bug fix around at_exit (1) timing was
	  wrong. (2) execution order was opposite.

Thu Dec  2 23:05:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (RCFLAGS): -nologo switch is only available in
	  newer versions of rc.exe. fixed the problem of r30012.

Thu Dec  2 21:28:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/add/rails.rb: removed.

Thu Dec  2 21:22:05 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): free the copied key and
	  return NULL when given key is already registered.

	* encoding.c (enc_alias): call set_encoding_const only when the
	  alias is not registered yet.

Thu Dec  2 19:58:24 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm.c (ruby_vm_at_exit): new API.  This enables extension libs to
	  hook a VM termination.  Right now, because the VM we have is
	  process global, most extensions do not deallocate resources and
	  leave them to Operating System's reaping userland processes.  But
	  in a future we plan to have multiple VMs to run simultaneously in
	  a single process (MVM project).  At that stage we can no longer
	  rely on OSes and have to manage every resources to be reclaimed
	  properly.  So it is.  For a forward-compatibility reason this API
	  is introduced now, encouraging you to be as gentle as you can for
	  your resources; that is, tidy up your room.

	* include/ruby/vm.h: ditto.

	* vm_core.h (rb_vm_struct): new field.

	* vm.c (vm_init2): initialize above new field.

	* eval.c (ruby_cleanup): trigger those hooks.

Thu Dec  2 17:00:44 2010  Tanaka Akira  <akr@fsij.org>

	* bignum.c: parenthesize macro arguments.

Thu Dec  2 15:31:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): more fix. [ruby-core:33513]

Thu Dec  2 13:41:43 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): workaround for console reading troubles.
	  fixed [ruby-core:33511]

Thu Dec  2 13:10:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form):
	  split key-value when the value is Array like object.

Thu Dec  2 10:39:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP#set_form_data):
	  use URI.encode_www_form for application/x-www-form-urlencoded.

Thu Dec  2 10:38:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/extmk.rb: remove $makeflags.defined?, it should be $mflags.

Thu Dec  2 10:19:47 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (rc): suppress meaningless message.

Thu Dec  2 10:09:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/generator/extconf.rb: remove the lines which set -O3
	  when -O option is not set.
	  Note that -O3 doesn't always exist.

	* ext/json/parser/extconf.rb: ditto.

Thu Dec  2 10:01:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/extmk.rb: define $makeflags.defined? like $mflags.

Thu Dec  2 07:20:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GCStressOption): --gc-stress
	  option.

	* lib/test/unit.rb (Test::Unit::Mini#_run_suites): show the result
	  even when interrupted on the way.

Thu Dec  2 07:08:38 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (setattr): should retry on EINTR.
	  [ruby-dev:42666]

Thu Dec  2 02:30:50 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb: fixed positional wording to match revised order.

Thu Dec  2 01:24:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/common.rb: don't use iconv on 1.9.
	  patched by Shota Fukumori [ruby-core:33164]

Thu Dec  2 01:02:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Update github/flori/json from 1.4.2+ to
	  e22b2f2bdfe6a9b0. this fixes some bugs.

Thu Dec  2 00:05:44 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  This change the order of chapter because such overview should
	  begin with simple examples.
	  patched by Eric Hodel [ruby-core:33469]

Wed Dec  1 22:01:49 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (Init_Numeric): fixed a potential bug when using bccwin32
	  ruby with Microsoft's dll, though we already gave up of supporting
	  bccwin32. [ruby-core:33503]

Wed Dec  1 21:43:21 2010  Tanaka Akira  <akr@fsij.org>

	* array.c: parenthesize macro arguments.

Wed Dec  1 21:41:57 2010  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_addrinfo.rb: extract Errno::EADDRINUSE as a method.

	* test/socket/test_socket.rb: ditto.

Wed Dec  1 15:08:32 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/openssl/test_ssl.rb (test_not_started_session): non socket
	  argument of SSLSocket.new is not supported on Windows.

Wed Dec  1 14:36:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_memhash): zero-filled strings should return
	  different values.  [ruby-core:33500]

Wed Dec  1 14:27:49 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.0 r5952.
	* test/minitest/*.rb: ditto.
	* lib/test/unit.rb: Compatibility fix for minitest changes.

Wed Dec  1 10:16:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): fix typo (not 0xFD but 0xFE).

Wed Dec  1 09:28:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: Follow .gnu_debuglink section.
	  A user of distribution provided ruby will see line
	  info if s/he has a debug package for ruby.
	  patched by Shinichiro Hamaji [ruby-dev:42655]

Wed Dec  1 01:29:15 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): inspect as a dummy encoding string
	  when a UTF-16/32 (not BE/LE) string does not have a BOM.
	  Unicode and some RFCs say that a string labeled as UTF-16/32
	  doesn't have a BOM, it should be considered big endian.
	  But many Windows programs generates little endian UTF-16
	  strings without a BOM. So String#inspect treats a string
	  labeled UTF-16/32 without a BOM as a dummy encoding string.
	  patched by Martin Duerst. [ruby-core:33461]

Tue Nov 30 17:04:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (parse_debug_line_cu): ignore DW_LNE_set_discriminator.
	  To ignore, it needs to read a single unsigned LEB128 integer.

Tue Nov 30 16:29:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_dump.c: undef HAVE_BACKTRACE when the OS is FreeBSD (in other
	  words backtrace() is libexecinfo) and it is optimized.
	  This temporary hack may be also applied to other libexecinfo
	  environments.

Tue Nov 30 16:23:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by Eric Hodel ref #4100

Tue Nov 30 12:23:52 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): read only 1 byte at once on console.
	  workaround of Windows bug. see [ruby-core:33460].
	  this is not the final solution.

Tue Nov 30 11:39:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by mathew murphy [ruby-core:33472] ref #4100

Tue Nov 30 05:03:44 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/uri/common.rb (encode_www_form, encode_www_form_component):
	  Improve English in documentation.

	* ext/openssl/ossl_ssl.c (ssl_version=, ciphers=): Document
	  #ssl_version=, add documentation for #ciphers=.

Mon Nov 29 22:55:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/uri/common.rb (URI::WFKV_): get rid of backtrack explosion
	  by nested repeat operators.  [ruby-core:33464]

Mon Nov 29 22:53:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (scriptbin.mk): fix generated rules.

	* win32/win32.c (rb_w32_write_console): fix argument type.

Mon Nov 29 21:12:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-forward-sexp): stop after literal hash
	  key labels.

	* misc/ruby-mode.el (ruby-font-lock-keywords): highlight literal
	  hash key labels as symbols.

Mon Nov 29 18:31:31 2010  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb (test_unicode_public_review_issue_121):
	  - Removed commented-out options that are no longer under discussion.
	  - Added two more tests for forthcomming clarifications.

Mon Nov 29 14:31:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_isatty): use GetConsoleMode() to determine the
	  fd is console or not, just like rb_w32_write_console(). [experimental]

Mon Nov 29 14:19:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (rb_w32_write_console): wrong prototype.

Mon Nov 29 14:10:55 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_write_console): fixed indentation.

Sun Nov 28 22:13:39 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (NATIVE_MUTEX_LOCK_DEBUG): move and use it.

	* ChangeLog: fix my timezone.

Mon Nov 28 21:58:58 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c: remove pthread_atfork().

Mon Nov 28 21:54:22 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_cond_*): Check return code.
	  (Some OSes except Linux return error code).

Sun Nov 28 21:46:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (thread_start_func_1): initialize native thread
	  data immediately before starting.

Sun Nov 28 14:56:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (struct argf): make lineno long, and reorder members.

Sun Nov 28 14:55:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_win32.c (gvl_release, gvl_init): suppress warnings.

Sun Nov 28 14:48:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (gvl_release, gvl_init): suppress warnings.

	* vm_core.h (rb_vm_gvl_destroy): add prototype.

Sun Nov 28 14:46:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (gvl_reinit): register atfork handler only in
	  the parent process, to get rid of dead lock.

Sun Nov 28 12:23:57 2010  Koichi Sasada  <ko1@atdot.net>

	* thread.c, vm_core.h: make gvl_acquire/release/init/destruct
	  APIs to modularize GVL implementation.

	* thread_pthread.c, thread_pthread.h: Two GVL implementations.
	  (1) Simple locking GVL which is same as existing GVL.
	  (2) Wake-up queued threads.  The wake-up order is simple FIFO.
	     (We can make several queues to support exact priorities, however
	      this causes some issues such as priority inversion and so on.)
	      This impl. prevents spin-loop (*1) caused on SMP environments.
	  *1: Only one Ruby thread acquires GVL again and again.
	      Bug #2359 [ruby-core:26694]

	* thread_win32.c, thread_win32.h: Using simple lock
	  not by CRITICAL_SECTION but by Mutex.
	  Bug #3890 [ruby-dev:42315]

	* vm.c (ruby_vm_destruct): ditto.

Sun Nov 28 04:40:00 2010  Luis Lavena  <luislavena@gmail.com>

	* io.c (io_fwrite): use rb_w32_write_console under Windows.

	* win32/win32.c (rb_w32_write_console): added to write to write
	  Unicode using WriteConsoleW for stdout/stderr. [ruby-core:33166]

Sun Nov 28 03:58:47 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by Mike Perham [ruby-core:33433]

Sat Nov 27 19:12:10 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: parenthesize macro arguments.

Sat Nov 27 18:08:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (leap_year_v_p): fixed typo.  [ruby-dev:42631]

Sat Nov 27 17:57:08 2010  Tanaka Akira  <akr@fsij.org>

	* resolv.rb (Resolv::DNS): use the same DNS server when retry using
	  TCP.  reported by Julian Mehnle.  [ruby-core:32970]

Sat Nov 27 15:45:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): see CrashReport log on Mac OS X.

	* configure.in: link addr2line only for ELF.

Sat Nov 27 13:58:55 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): : was missing.  Thanks,
	  Shota Fukumori.  [ruby-dev:42634]

Sat Nov 27 12:07:05 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* man/ruby.1: Ruby man page from Arthur Gunn in [ruby-core:33412]

Sat Nov 27 11:29:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): get rid of 1.9 syntax
	  so that BASERUBY can be 1.8.

Sat Nov 27 08:16:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* addr2line.c (rb_dump_backtrace_with_lines): should close fd on
	  edge case.

Fri Nov 26 13:33:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: apply a patch from shinichiro.h.

Fri Nov 26 12:21:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: added to show source filename and line number of
	  functions in backtrace. [ruby-dev:42625]
	  a patch from shinichiro.h <shinichiro.hamaji AT gmail.com>

	* addr2line.h: ditto.

	* common.mk: add addr2line.$(OBJEXT).

	* configure.in: check dl_iterate_phdr.

	* vm_dump.c (rb_vm_bugreport): use rb_dump_backtrace_with_lines in
	  addr2line.c when the binary is ELF.

Fri Nov 26 12:12:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (setup_tree): restart setup_tree() for a node whose
	  AnchorNode's type is ANCHOR_PREC_BEHIND or ANCHOR_PREC_BEHIND_NOT
	  and divide_look_behind_alternatives() divided it to NT_ALT or
	  NT_LIST. [ruby-core:33370]

Fri Nov 26 11:40:11 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): get only required rights of the target
	  thread because THREAD_ALL_ACCESS causes an access error on XP.
	  reported by Masaya TARUI via IRC.

Fri Nov 26 11:09:07 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): show the displacement from the beginning
	  of the symbol.

Fri Nov 26 10:48:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): follow the output of glibc.
	  see [ruby-dev:42627]

Fri Nov 26 09:48:45 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_initialize_str): should succeed the taint status from
	  the origin. [ruby-core:33338]

Fri Nov 26 09:32:37 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): seems to be necessary the 3rd argument of
	  SymGetLineFromAddr64(), even though MSDN says it can be zero.

Fri Nov 26 09:03:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (onig_is_prelude): added to check whether ruby is still
	  in prelude (or other boot processes) or not.

	* regcomp.c (optimize_node_left): use onig_is_prelude for printing.

	* regcomp.c (set_optimize_info_from_tree): ditto.

	* regcomp.c (onig_compile): ditto.

	* regcomp.c (print_compiled_byte_code_list): print its address.

	* regcomp.c (print_indent_tree): print its contents tree of
	    ANCHOR_PREC_READ(_NOT) and ANCHOR_PREC_BEHIND(_NOT).

Thu Nov 25 23:10:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (print_distance_range): use PRIuSIZE.

	* regcomp.c (print_optimize_info): use %ld because the type of
	  calculated value of integers is long.

	* regexec.c (onig_print_compiled_byte_code): add prototype.

	* regexec.c (match_at): add 2nd argument.

Thu Nov 25 10:29:55 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/callback/mkcallback.rb (gencallback): shouldn't assume that
	  VALUE is the same size with long.

Thu Nov 25 10:03:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/win32ole/test_err_in_callback.rb (teardown): remove tmp file
	  only when it exists.

Thu Nov 25 01:38:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/big5-hkscs-tbl.rb: Update table as HKSCS-2008.
	  patched by oCameLo oTnTh [ruby-core:33256]

	* enc/big5.c: add alias Big5-HKSCS:2008 to Big5-HKSCS.

Wed Nov 24 15:18:07 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vsnprintf (BSD_vfprintf): use QUADINT macro only when _HAVE_SANE_QUAD_
	  macro is defined.

Wed Nov 24 12:47:16 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vsnprintf (BSD_vfprintf): added VC++ compatible size specifications
	  (I, I32, I64).

Wed Nov 24 11:19:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): treat UTF-16 and UTF-32 as BE or LE.

Wed Nov 24 06:35:32 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: add the UTF-32 converter.

Wed Nov 24 05:40:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

Wed Nov 24 06:13:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (filecp, wstr_to_mbstr, mbstr_to_wstr):
	  refactored.

Wed Nov 24 05:40:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: add a converter from UTF-8 to UTF-16.

Wed Nov 24 03:21:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: raise error on unpaired upper
	  surrogates.

Wed Nov 24 01:40:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_16_32.h: add UTF-16 and UTF-32 as a dummy encoding.

	* enc/trans/utf_16_32.trans: add a converter from UTF-16 to UTF-8.

Tue Nov 23 21:59:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (wlink, rb_w32_getppid): use typedef instead of
	  repeating complicated function prototypes.

Tue Nov 23 18:54:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_mark): should mark self in control
	  frames.  [ruby-core:33289]

Tue Nov 23 07:57:31 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta/parser.{ry,rb}: fixed a bug of token scanner.

Tue Nov 23 07:29:24 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c ({nucomp,nurat}_expt): added a check.

Tue Nov 23 07:27:27 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (daynum): should be private.

Tue Nov 23 07:22:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ChangeLog (change-log-indent-text): hanging indent.

Tue Nov 23 06:30:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SITE_DIR, VENDOR_DIR),
	  version.c (ruby_initial_load_paths): exclude directories that
	  are configured without them from $LOAD_PATH. [ruby-core:33267]

	* configure.in (rubylibprefix): No ruby, No libprefix.

Tue Nov 23 01:05:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): don't output floating point
	  when the precision is 0. [ruby-dev:42615]

Mon Nov 22 21:30:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): fix for ascii-compatible external
	  encoding and different encoding string.  [ruby-core:33283]

Mon Nov 22 18:45:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): should not duplicate rules.
	  bug fix of r29842.

Mon Nov 22 18:04:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/big5.c: split CP950 from Big5.

	* enc/big5.c: split CP951 from Big5-HKSCS.

	* enc/trans/big5.trans: import conversion table of Big5, Big5-HKSCS,
	  CP950, and CP951 from ICU. they need fallback conversions.
	  ref [ruby-core:33256]
	  http://source.icu-project.org/repos/icu/data/trunk/charset/data/ucm/

	* tool/transcode-tblgen.rb (import_ucm): add to import ucm files.

Mon Nov 22 18:33:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): append for each chars instead of bulk
	  copy if encoding conversion is needed.  [ruby-core:33283]

Mon Nov 22 14:22:45 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* time.c (time_zone): use rb_locale_str_new_cstr to set encoding
	  as locale and convert its content to internal encoding.
	  [ruby-core:33278]

Mon Nov 22 11:58:11 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): set ENC_CODERANGE_VALID when the
	  receiver is 7BIT and the argument is non ASCII.

Mon Nov 22 01:48:58 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: some improvements for performance.

Sat Nov 20 07:45:50 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/mkmf.rb: adding compilation support for ObjC/ObjC++ extensions.
	  Thanks Scott Gonyea! [ruby-core:33260]

Sat Nov 20 01:57:55 2010  Akio Tajima  <artonx@yahoo.co.jp>

	* common.mk: add dependency(insns.inc) to compile.obj

Fri Nov 19 23:05:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (insns_rules.mk): remove extra backslash.

	* cygwin/GNUmakefile.in, win32/Makefile.sub (clean): rc files are
	  made at compile time, so should be removed by clean.

Fri Nov 19 22:09:46 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb
	  (Tester#test_pretty_format_long_text_finite): skip a test that
	  uses long string on small memory system. [ruby-dev:42599]

Fri Nov 19 21:07:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb: shell completion support for zsh.  based on
	  <http://d.hatena.ne.jp/rubikitch/20071002/zshcomplete>

	* lib/optparse.rb: shell completion support for bash.

Fri Nov 19 00:00:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (SCRIPTPROGRAMS): no needs on cygwin.

	* win32/Makefile.sub (scriptbin): create script binaries.

Thu Nov 18 23:21:23 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/formatters/pretty.rb (REXML::Formatters::Pretty#wrap):
	  REXML::Formatters::Pretty#wrap used a recursive method call to
	  format text.  This switches it to use an iterative approach.
	  [ruby-core:33245]
	  Patch by Jeremy Evans. Thanks!!!

	* test/rexml/test_core.rb: add a test for it.

Thu Nov 18 22:58:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h (rb_io_buffer_t): extract from rb_io_t.

Thu Nov 18 07:37:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (reconfig): force reconfigure with previous options.

	* common.mk (showconfig): show configure flags, like as
	  `config.status --config' generated by recent autoconf.

Thu Nov 18 07:16:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/langinfo.c (strncasecmp): get rid of redefinition.

Thu Nov 18 00:02:17 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Upgrading output encoding with ASCII content
	  as needed.  [ruby-core:33229]

Wed Nov 17 23:19:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/configure.bat: remove quotes from arguments to be quoted.

	* lib/mkmf.rb (create_makefile): use forward slashes in messages.

	* lib/mkmf.rb (create_makefile): make extension libraries messages
	  brief.

	* win32/Makefile.sub (MAKEDIRS): should not include silent flag.

	* common.mk (ext/ripper/ripper.c, ext/json/parser/parser.c): pass
	  Q and ECHO.  [ruby-core:33226]

Wed Nov 17 16:09:52 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_tracer.rb: new test case.
	  minimal regression test for r29280.

Wed Nov 17 16:04:23 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/envutil.rb (Test::Unit::Assersions#assert_warn):
	  new assertion to assert that a particular warning message is
	  displayed.
	  forward port from branches/ruby_1_9_2@29795.

Wed Nov 17 15:16:48 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regint.h (OnigOpInfoType): constify name.

	* regcomp.c (op2name): constify return value.

	* regcomp.c (onig_print_compiled_byte_code): use PRIuPTR and
	  uintptr_t to clean warnings.

	* regcomp.c (print_indent_tree): use PRIxPTR and intptr_t.

	* regexec.c (match_at): use PRIdPTR and intptr_t.

Wed Nov 17 09:49:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c (property_name_to_ctype): fix memory leak.

	* enc/euc_jp.c (property_name_to_ctype): ditto.

Wed Nov 17 08:54:04 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Upgrading output encoding as needed.  [ruby-core:33135]

Tue Nov 16 22:30:39 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_throw): remove fear of undefined behavior :-)
	  Coverity Scan found this bug.

Tue Nov 16 09:33:00 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (to_digits): avoid unused
	  variables warning, reported by Aaron Patterson.

Tue Nov 16 06:39:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (PACK_ITEM_ADJUST): return nil not result array and yield
	  values if block is given.  [ruby-core:33193]

Tue Nov 16 00:21:20 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* regparse.c (and_cclass, or_cclass): fix memory leak.  Coverity Scan
	  found this bug.  [ruby-dev:42579]

Tue Nov 16 00:07:32 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (assign_heap_slot): fix fear of memory leak and memory
	  violation.  Coverity Scan found this bug.

Mon Nov 15 23:54:45 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval_intern.h (CHECK_STACK_OVERFLOW): it was not intended to add
	  size_t to a pointer typed VALUE*.  Coverity Scan found this defect.

Mon Nov 15 23:41:21 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_set_exception_local_table, iseq_set_local_table,
	  rb_iseq_build_from_ary): fix type inconsistency (which is benign
	  because sizeof(ID) == sizeof(ID*), though).  Coverity Scan found
	  these bugs.

Mon Nov 15 22:47:27 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_funcall): ensure va_end after va_init_list.  Coverity
	  Scan found this bug.

Mon Nov 15 08:36:12 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/racc/parser.rb (do_parse, yyparse): using class eval to define
	  method and avoid __send__.

Mon Nov 15 06:43:48 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* etc/openssl/ossl_ssl.c (ossl_ssl_get_cert): raise exception if
	  pointer is invalid.  Thanks Ippei Obayashi! [ruby-dev:42573]

Sun Nov 14 17:57:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/Makefile.in (distclean): should not remove sources which are
	  distributed in tarball.

Sun Nov 14 16:48:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_set_token_info): turn on/off with directives.
	  [ruby-core:25442]

Sun Nov 14 12:05:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_readlines): forward to current_file for arguments
	  check.  http://twitter.com/nagachika/status/3634254856589312

Sun Nov 14 08:48:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/setup.mak (-basic-vars-, -runtime-): suppress trailing
	  space and compiler command line.

Sun Nov 14 04:22:32 2010  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (config.h): Added HAVE_LABS and HAVE_LLABS to config.h.

	* symbian/configure.bat: Changed packaging version in line with API
	  style 3 versioning.

Sat Nov 13 16:37:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags, help): emit messages at once.

	* win32/Makefile.sub (MSG, EOM): remove surrounding quotes by %~I.

Sat Nov 13 01:31:30 2010  Akio Tajima <artonx@yahoo.co.jp>

	* win32/Makefile.sub: reorder variable End Of Message (don't display it)

Fri Nov 12 20:52:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags, help): use caret to quote leading spaces on
	  Windows.

	* Makefile.in, common.mk, cygwin/GNUmakefile.in, enc/depend,
	  ext/ripper/depend, lib/mkmf.rb, win32/Makefile.sub: caddle up.

Fri Nov 12 16:35:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: support C level backtrace information on FreeBSD.
	  When devel/libexecinfo is installed on FreeBSD, now ruby
	  can show C level backtrace information.
	  http://www.freebsd.org/cgi/cvsweb.cgi/ports/devel/libexecinfo/

Fri Nov 12 09:58:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak: use findstr.exe instead of find.exe, because all
	  target build platforms should have findstr.exe, and, find.exe often
	  means another command such as cygwin's.

Fri Nov 12 00:30:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.h): need PRI_LL_PREFIX.

Thu Nov 11 23:38:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: ANSI C-conforming const and volatile are mandatory

	* configure.in (AC_C_CONST, AC_C_INLINE, AC_C_VOLATILE): check
	  before used in other checks.

	* configure.in (RUBY_CHECK_PRINTF_PREFIX): should not break from
	  RUBY_WERROR_FLAG, so that ac_c_werror_flag gets restored.

Thu Nov 11 23:04:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (warn_deprecated): show caller position.

Thu Nov 11 23:03:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_close): untie tied io before closing.

	* io.c (argf_write): add ARGF.write and so on.

	* io.c (argf_read_nonblock): add ARGF.read_nonblock.

Thu Nov 11 21:49:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/stats.rb (RDoc#print): get rid of NaN.

Thu Nov 11 21:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (SHOWFLAGS): show compile flags.

	* common.mk: hide long command lines by default.  verbose-mode is
	  turned on by V=1 as before.
	  http://jarp.does.notwork.org/diary/200605b.html#200605121

Thu Nov 11 21:32:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_func): accept variable address.

	* ext/win32ole/extconf.rb: libuuid is needed on cygwin.

Thu Nov 11 21:24:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): use cygwin_conv_path on cygwin 1.7 or
	  later.

	* ruby.c (push_include_cygwin): ditto.

Thu Nov 11 20:49:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (PRI_LL_PREFIX): format type specifier for
	  LONG_LONG may vary on platforms.

Thu Nov 11 20:45:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SYMBOL_PREFIX): separate from EXPORT_PREFIX.

	* win32/mkexports.rb (Exports#each_export): use SYMBOL_PREFIX.

Wed Nov 10 07:20:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (scriptbin): make executable file from
	  scripts with stub.

	* ruby.c (load_file_internal): assume xflag for exe file as well
	  as no-shebang file.

	* tool/rbinstall.rb: install script programs.

	* win32/mkexports.rb (Exports#initialize): alias ruby_sysinit for
	  stub.

	* win32/stub.c: stub for scripts.  [EXPERIMENTAL]

Tue Nov  9 21:57:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (init_funcname): allocate and build initialization
	  funciton name at once.

Tue Nov  9 21:14:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (AC_FUNC_GETPGRP, AC_FUNC_SETPGRP): no need when
	  not used.

	* configure.in (EXPORT_PREFIX): check generic prefix.

Tue Nov  9 13:24:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regenc.c (onigenc_minimum_property_name_to_ctype):
	  \p{...} should be case insensitive. [ruby-core:33000]

	* regenc.c (onigenc_property_list_add_property):
	  ditto.

	* enc/euc_jp.c (init_property_list, property_name_to_ctype):
	  to lowercase property names.

	* enc/shift_jis.c (init_property_list, property_name_to_ctype):
	  ditto.

Tue Nov  9 13:29:36 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (overlapped_socket_io): get rid of a warning of 64bit
	  mingw.

Tue Nov  9 10:44:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): this code uses FPU's rounding system.
	  But x86's FPU calculates double precision floating-point
	  numbers in 80bit precision, so it fails to round the value.
	  So ensure the value is assigned a variable. [ruby-dev:42551]
	  see also [ruby-math:00802]
	  http://www.shudo.net/java-grandprix99/strictfp/

Tue Nov  9 07:30:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_syserr_new): new function to make SystemCallError
	  instance without errno.  [EXPERIMENTAL]

	* error.c (rb_syserr_fail, rb_mod_syserr_fail): ditto.

Tue Nov  9 05:54:57 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/*.rb: Remove unused variable warnings.
	  Patch by Run Paint [ruby-core:30991]

	* lib/rubygems/*, lib/rdoc/*.rb, lib/rake/*.rb: ditto

Mon Nov  8 18:26:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_hdtoa): fix type cast and bufsize.

Mon Nov  8 15:40:56 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): fix precision specifier doesn't
	  work well on %f. [ruby-dev:42552]

Mon Nov  8 14:41:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (get_wsa_extension_function): typos.

Mon Nov  8 13:41:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Add Age property to regexp. [ruby-core:33019]
	  patched by Ammar Ali, tested by Run Paint Run Run

Mon Nov  8 12:16:39 2010  Ben Walton  <bwalton@artsci.utoronto.ca>

	* configure.in: support -h for solaris linker when gcc not used

Mon Nov  8 11:47:39 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (finish_overlapped_socket): refactoring.

Mon Nov  8 11:02:21 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (get_proc_address): refactoring.

	* win32/win32.c (get_wsa_exetinsion_function): refactoring.

Mon Nov  8 09:45:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/gbk-tbl.rb: Add euro sign. [ruby-core:33094]
	  CP936, which is de facto definition of GBK, has it.
	  http://msdn.microsoft.com/en-us/goglobal/cc305153.aspx

Mon Nov  8 07:26:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check only the first symbol to get rid of
	  duplication.  [ruby-core:33084] #4031

Sun Nov  7 10:13:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (NM): check on all platforms.  #4031

Sun Nov  7 06:16:33 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/openssl/test_ocsp.rb: adding test for r29699.  Thanks Elise
	  Huard! [ruby-core:32460]

Sat Nov  6 07:33:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_export_prefix): check for prefixed
	  underscore of exported symbols

	* tool/rbinstall.rb (bin-comm): prepend prolog shell script if
	  necessary.

	* configure.in (LIBRUBY_RELATIVE): use rpath token expansion.

Sat Nov  6 07:24:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in (arch, sitearch): reordered.

	* configure.in: keep failed file.

Sat Nov  6 07:03:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_fork_err): save errinfo before fdopen.

Sat Nov  6 00:43:58 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_ocsp.c (ossl_ocspcid_initialize): an optional
	  parameter may be used to specify the OpenSSL::OCSP::CertificateId on
	  initialization.  Thanks Elise Huard! [ruby-core:32460]

Fri Nov  5 12:23:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_{process,system}.rb (test_fallback_to_sh):
	  meaningless and wrong tests where /bin/sh does not exist.

	* process.c (proc_spawn_v): should spawn, not exec.

Fri Nov  5 01:21:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_exec_v, proc_spawn_v): try to execute with sh if
	  no shebang.  [ruby-core:32745] [EXPERIMENTAL]

Fri Nov  5 00:39:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_readlines, rb_io_each_line): limit must not be zero.
	  a patch from Tomoyuki Chikanaga at [ruby-dev:42538].  #4024

Fri Nov  5 00:14:15 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/extconf.rb: fixing ffi library location on windows.
	  Thanks Usa! [ruby-core:32930]

Thu Nov  4 20:04:44 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_newobj): force garbage_collect() if GC.stress == true.

Thu Nov  4 19:48:22 2010  Koichi Sasada  <ko1@atdot.net>

	* ChangeLog: missed to write a last ChangeLog.

	* gc.c (gc_finalize_deferred): removed.

	* gc.c (rb_gc_finalize_deferred): Do not invoke a free_unused_heaps().

Thu Nov  4 19:45:27 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (run_final): do not need argument obj.

Thu Nov  4 19:26:10 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (before_gc_sweep): fix commit miss.

Thu Nov  4 19:20:46 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep, before_gc_sweep):
	  invoke rb_sweep_method_entry() as soon as possible.

Thu Nov  4 19:13:58 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep, slot_sweep): finalizers should be invoked
	  as soon as possible.

Thu Nov  4 10:30:40 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in (--with-valgrind): Now this option is default on.
	  You can still explicitly disable this feature by specifying
	  --without-valgrind.

Thu Nov  4 02:06:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (fiber_t_alloc): raise an error when fiber is going to be
	  initialized twice.  [ruby-dev:42524]

Thu Nov  4 02:04:25 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (rb_fiber_resume): raise an "double resume" error when root
	  fiber is going to be resumed.  [ruby-dev:42523]

Wed Nov  3 14:17:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct#delete_field): also undefine
	  accessor methods.  [ruby-core:33010]

Wed Nov  3 14:13:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): concatenation of valid
	  encoding string and invalid encoding string should result
	  invalid encoding.  [ruby-core:33027]

Wed Nov  3 08:58:59 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c, vm.c, vm_core.h: remove USE_VALUE_CACHE option.

Wed Nov  3 07:47:25 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex#identify_string): parse multiple
	  regex options.  a patch from Heesob Park in [ruby-core:32988].

Wed Nov  3 07:33:57 2010  Tanaka Akira  <akr@fsij.org>

	* vm_method.c (rb_clear_cache_by_class): just return if the class has
	  no method.  reported by Eric Wong.  [ruby-core:32689]

Tue Nov  2 22:50:25 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/visitor.rb (initialize): push accessor
	  methods to subclass that actually uses them.

Tue Nov  2 22:47:08 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/visitor.rb (accept): switch to
	  a dispatch cache rather than case / when statement.

Tue Nov  2 21:46:52 2010  Kouhei Sutou  <kou@cozmixng.org>

	* NEWS: fix a typo.

Tue Nov  2 20:10:32 2010  Tajima Akio <artonx@yahoo.co.jp>

	* test/rake/test_tasks.rb: clear env var which is used by the test.
	  [ruby-dev:42508]

Tue Nov  2 00:25:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: win64 is just same with win32 about socket.
	  notice: but wince is not same.

Mon Nov  1 21:25:57 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* main.c: <stdlib.h> is needed, to introduce the getenv(3)
	  prototype declaration.  Without it a C compiler shall infer
	  the getenv type as "int getenv(...);", but this is totally
	  wrong, especially when your machine's sizeof(int) and
	  sizeof(char*) differs.  On such environment a return value
	  of getenv(3), which is in fact a char*, might first casted
	  into a int (loses data here), and then casted back to char*
	  by automatic integral promotion to fit to the prototype of
	  ruby_set_debug_option().

Sun Oct 31 23:27:09 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (finalizer_table, objspace->final.table):
	  Create finalizer_table at Init_heap().
	  Remove all null checks of finalizer_table.

	* gc.c (mark_tbl): skip if no table entries.

	* gc.c (slot_swee): remove useless need_call_final check.

Sun Oct 31 22:32:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_objspace_free): finalizers should be called separately
	  from freeing objspace.  [ruby-dev:42479]

Sun Oct 31 22:24:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): free current VM and its objspace even
	  when exiting by SystemExit.

Sun Oct 31 22:10:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (new_child_iseq): adjust argument types.

	* iseq.c (prepare_iseq_build, rb_iseq_new),
	  (rb_iseq_new_with_bopt_and_opt, rb_iseq_new_with_opt),
	  (rb_iseq_new_with_bopt): ditto.

	* compile.c (iseq_set_exception_table): suppress warnings.

	* insns.def (putspecialobject, defined): ditto.

	* iseq.c (iseq_load): ditto.

Sun Oct 31 09:30:51 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h: some refactoring.
	  - move decl. of rb_compile_option_struct to iseq.h.
	  - define enum iseq_type.
	  - define enum vm_special_object_type.

	* compile.c: some refactoring.
	  - apply above changes.
	  - (struct iseq_link_element): change value of type.
	  - remove unused decl.
	  - fix comment.
	  - rename iseq_build_body and iseq_build_exception to
	    iseq_build_from_ary_body and iseq_build_from_ary_exception.

	* iseq.h: define enum catch_type and enum defined_type.

	* insns.def: apply above changes.

	* iseq.c: define ISEQ_MAJOR_VERSION and ISEQ_MINOR_VERSION.

Sat Oct 30 23:38:59 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/encoding.rb: untabify.

Sat Oct 30 21:06:37 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/encoding.rb: use Ruby native encoding mechanism.
	  [ruby-dev:42464]
	* lib/rexml/encodings/: remove.

	* lib/rexml/document.rb, lib/rexml/formatters/default.rb,
	  lib/rexml/output.rb, lib/rexml/parseexception.rb,
	  lib/rexml/parsers/baseparser.rb, lib/rexml/source.rb,
	  lib/rexml/xmldecl.rb: use Ruby's native Encoding object.

	* test/rexml/, test/rss/: follow the above encoding changes.

	* NEWS: add REXML's incompatible change about encoding.

Sat Oct 30 17:23:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strtod): get rid of overflow/underflow as possible.

Sat Oct 30 14:37:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_pc): erase runtime-defined variables and
	  check if generated pc file is valid.

	* template/ruby.pc.in (DEFFILE): need for mingw.

	* template/ruby.pc.in (LIBRUBY): fix the order.

Sat Oct 30 11:33:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (ruby_pc): ignore missing variables.

	* template/ruby.pc.in: add missing variables for mswin.

Sat Oct 30 10:24:35 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* object.c: Make BasicObject.new accept no parameter.
	  Revert of r26135 [ruby-core:27080], as per [ruby-core:32952].

Sat Oct 30 09:40:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c: use constants in id.h.

Sat Oct 30 09:08:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/fiddle/closure.c (fiddle_closure): embed cif not reference
	  so that the content surely get initialized.  [ruby-dev:42480]

Sat Oct 30 07:01:53 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv-replace.rb: suppress warning.

	* lib/open-uri.rb: ditto.

Sat Oct 30 06:32:52 2010  Tanaka Akira  <akr@fsij.org>

	* test/pathname/test_pathname.rb (TestPathname#test_grpowned?): the
	  group of the created file is inherited from the parent
	  directory on BSDs and MacOS X.  Linux also inherit the group if
	  the setgid bit of the directory is set.  It causes the test fail.
	  fixed by Shota Fukumori.  [ruby-dev:42458]

Sat Oct 30 05:58:54 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: retry via TCP if UDP reply is truncated.
	  fixed by Julian Mehnle.  [ruby-core:32407]

Sat Oct 30 00:35:13 2010  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_s_compile): fix optional argument.
	  a patch from Yutaka HARA [ruby-core:32953] [Ruby 1.9-Bug#4001]

Sat Oct 30 00:24:42 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (memsize_of): take care of
	  T_CLASS/const_tbl.
	  a patch from nagachika <nagachika00@gmail.com> [ruby-dev:42490]

Fri Oct 29 23:32:36 2010  Koichi Sasada  <ko1@atdot.net>

	* test/profile_test_all.rb: added.
	  You can use test-all profiler with the following command:
	    RUBY_TEST_ALL_PROFILE=true make test-all
	  This command generates ./test_all_profile and you can analyze
	  which tests consume memories.

	* test/runner.rb: ditto.

Fri Oct 29 10:02:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Add 'Unknown' Script.
	  patched by Run Paint Run Run. [ruby-core:32937] #3998

Fri Oct 29 05:13:34 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (ObjectSpace.memsize_of_all): rename
	  ObjectSpace.total_memsize_of_all_objects() to
	  ObjectSpace.memsize_of_all([klass]).
	  Accept Class object to filter the objects.

	* test/objspace/test_objspace.rb: fix test for above change.

Fri Oct 29 03:04:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_dump): fix expected length. [ruby-core:32935]

Thu Oct 28 23:31:39 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (before_gc_sweep, run_final): fix decrement timing of final_num.

Thu Oct 28 20:11:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Update Oniguruma for Unicode 6.
	  patched by Run Paint Run Run. [ruby-core:32923] #3989

Thu Oct 28 20:06:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/oniguruma.h (ONIGENC_CTYPE_SPECIAL_MASK):
	  change mask from 128 to 256. [ruby-core:32931]

Thu Oct 28 12:06:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httprequest.rb (read_request_line): extend max
	  length to 2083. This is from Internet Explorer's max uri
	  length. http://support.microsoft.com/kb/208427 [ruby-core:32924]

Thu Oct 28 04:00:08 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (GC.stat): added.  [ruby-dev:38607]

	* test/ruby/test_gc.rb: add a test for above.

Thu Oct 28 03:13:06 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (memsize_of): fix rdoc.

	* ext/objspace/objspace.c (total_memsize_of_all_objects): added.

	* test/objspace/test_objspace.rb:
	  - add a test for ObjectSpace.total_memsize_of_all_objects.
	  - add two tests for ObjectSpace.memsize_of (for nil and Fixnum).

Wed Oct 27 23:55:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Init_iconv): warn deprecated use.

Wed Oct 27 18:50:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2long, rb_big2ulong): rb2ulong() returns VALUE, but
	  its real range is ulong. So, if the size of VALUE is bigger than
	  ulong, upper bits are always zero even if the actual value is
	  negative.
	  fixed #3490

Wed Oct 27 18:27:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): should close write end of pipe
	  before closing read end, to get rid of timing problem.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 27 18:14:27 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getppid): support Win64.

Wed Oct 27 15:07:19 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_error): should get error no only once, because
	  the result of the second getting will indicate the error of the
	  first FormatMessage() call.

Wed Oct 27 13:51:25 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): need to propagate exceptions
	  in read/write thread. fix r29541.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 27 12:05:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* class.c (clone_const): need to return value. fix r29602.

Wed Oct 27 11:58:58 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (NUM2LONG_internal): add cast to get rid of a
	  non GCC compiler warning. this is intentional type conversion.

Wed Oct 27 09:25:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c: apply documentation patch by Run Paint Run Run.
	  [ruby-core:32915]

Wed Oct 27 02:12:10 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* object.c (Init_Object), constant.h, variable.c
	  (rb_mod_private_constant, rb_mod_public_constant,
	  set_const_visibility, rb_const_get_0): add Module#public_constant
	  and private_constant.  [ruby-dev:39685][ruby-core:32698]

	* test/ruby/test_module.rb: add tests for above.

Wed Oct 27 02:02:54 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c, constant.h, gc.c, method.h, object.c, variable.c,
	  vm_insnhelper.c: use struct rb_constant_entry_t as entry of
	  RCLASS_CONST_TBL.  RCLASS_CONST_TBL has contained VALUE of constant
	  directly.  Now instead rb_const_entry_t is contained in
	  RCLASS_CONST_TBL,  rb_const_entry_t is managed by malloc, and
	  have not only the value itself but also visibility flag.
	  This is another preparation for private constant (see
	  [ruby-dev:39685][ruby-core:32698]).

Wed Oct 27 01:56:34 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c, gc.c, object.c, variable.c, vm_insnhelper.c,
	  include/ruby/ruby.h: separate RCLASS_CONST_TBL from RCLASS_IV_TBL.
	  RCLASS_IV_TBL has contained not only instance variable table but
	  also constant table.  Now the two table are separated to
	  RCLASS_CONST_TBL and RCLASS_IV_TBL.  This is a preparation for
	  private constant (see [ruby-dev:39685][ruby-core:32698]).

Tue Oct 26 18:51:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/scanf.rb (extract_float): allow 2.e+2 style.
	  [ruby-dev:42452] #3978

Tue Oct 26 18:09:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (ASFLAGS): needs INCFLAGS.

	* configure.in (rb_cv_dynamic_alloca): check if extra source for
	  dynamic size alloca.

	* missing/x86_64-chkstk.s (___chkstk): necessary for alloca of
	  amd64-mingw32msvc-gcc on Ubuntu.

	* thread_win32.c (ruby_alloca_chkstk): check stack overflow

Tue Oct 26 18:04:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in (Libs): needs DLDFLAGS.

Tue Oct 26 12:47:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (pkgconfig-data): moved from Makefile.in.

	* tool/rbinstall.rb: install pc file only if non-empty.
	  [ruby-core:32901] #3983

	* win32/Makefile.sub (ruby_pc): create pc file.

Tue Oct 26 09:13:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_gcc_atomic_builtins): check for atomic
	  builtins, all are not available in Apple derivative gcc.

Tue Oct 26 00:29:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (pkgconfig-data): create pkg-config metadata file.

	* tool/rbinstall.rb: install pkg-config metadata file.

	* template/ruby.pc.in: template of pkg-config metadata file.

Mon Oct 25 16:38:07 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* signal.c  (rb_atomic_t): GCC (of  at least  recent versions)
	  has  ubiquitous  support  for  atomic operations.   On  that
	  compiler a C program can  issue a memory barrier using these
	  dedicated  instructions.  According to  the GCC  manual they
	  cargo culted  this feature form  the Itanium ABI  so chances
	  are that  other compilers  could also support  this feature.
	  But so far GCC is the  only compiler that I know to have it.
	  Also note that this works on non-Itanium machines.

Mon Oct 25 06:21:35 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): prec digits fractal part should be
	  appended to 0 if prec is given.  [ruby-dev:42453] #3979

Mon Oct 25 02:57:21 2010  Koichi Sasada  <ko1@atdot.net>

	* common.mk (run.gdb): Quit gdb on 'make gdb' when
	  no signals are received.

Mon Oct 25 00:25:23 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: some corrections of documentation.

Sun Oct 24 17:14:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c, gc.c, hash.c, object.c, string.c, struct.c,
	  transcode.c, variable.c, vm.c, vm_insnhelper.c, vm_method.c:
	  replace calls to rb_error_frozen() with rb_check_frozen().  a
	  patch from Run Paint Run Run at [ruby-core:32014]

	* include/ruby/intern.h (rb_check_frozen): optimize.
	  [ruby-core:32878]

Sun Oct 24 15:16:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Mini#run): abort if interrupted.

	* lib/test/unit.rb (Test::Unit::Mini#run_test_suites): show the
	  result even when interrupted on the way.

	* lib/test/unit.rb (Test::Unit::Mini#run_test_suites): ensure
	  output sync mode to be restored.

Sun Oct 24 14:11:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_define_method): defined method is run with the default
	  public visibility regardless the visibility context of definition.
	  [ruby-core:30638]

Sun Oct 24 12:08:54 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/test/unit.rb: make test/unit play nicely with the rake test
	  loader. [ruby-core:32864]

Sun Oct 24 00:25:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (test_segv_test): follow up the
	  change at r29556.

Sat Oct 23 14:39:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: $extmk should be true for test/runner.

Sat Oct 23 10:55:37 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c (rb_vm_bugreport): fix to add bug outputs.
	  - loaded script ($0)
	  - loaded features ($")
	  - process memory map on Linux (/proc/self/maps)

	* vm_dump.c (rb_vmdebug_stack_dump_raw): fix header message.

Fri Oct 22 14:50:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  assertion message must not be nil.

Fri Oct 22 13:59:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  treat nil case. Please run test-all before commit such change.

Thu Oct 21 23:58:14 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_lazy_sweep): Variable declarations should be at
	  the head of block.

Thu Oct 21 23:56:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (objspace_each_objects, rb_objspace_each_objects): use
	  struct.

	* gc.c (objspace_each_objects): fix return with no value.

Thu Oct 21 23:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_initialize): remove useless intermediate variable.

Thu Oct 21 16:07:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_f_select): change rdoc.
	  patched by Eito Katagiri [ruby-core:31805]

Thu Oct 21 15:55:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httpauth/digestauth.rb
	  (WEBrick::HTTPAuth::ProxyDigestAuth#check_uri): privated.
	  [ruby-dev:42344]

Thu Oct 21 15:50:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_f_select): add correct rdoc.
	  patched by Dave Thomas [ruby-core:32467]

Thu Oct 21 15:42:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/telnet.rb (Net::Telnet#close): added.
	  patched by Erik Hollensbe [ruby-dev:42260] #3830

Thu Oct 21 13:08:00 2010  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (rb_objspace_each_objects): don't lazy sweep in
	  rb_objspace_each_objects. [Bug #3940] [ruby-dev:42369]

Thu Oct 21 00:05:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): get rid of deadlock on pipe.
	  a patch from Tomoyuki Chikanaga at [ruby-dev:42435].  #3970

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 20 23:54:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dbm/dbm.c: rdoc based on a patch by mathew meta AT
	  pobox.com, at [ruby-core:32853].

Wed Oct 20 10:47:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): reject 0x1.p+0. [ruby-dev:42432] #3966

Wed Oct 20 10:00:57 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): print floating point on "%#a".
	  [ruby-dev:42431] Bug#3965

Tue Oct 19 19:30:11 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): clear ALT flag for %a.
	  [ruby-core:32841] [ruby-core:32848]

Tue Oct 19 12:19:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): fix over-count of field size.

Tue Oct 19 03:08:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): use HEXPREFIX flag for prefix of %a.
	  [ruby-core:32841]

Mon Oct 18 13:18:01 2010  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_class_init): Define
	  Digest::Class.new(). [Feature #3954]

Mon Oct 18 12:58:40 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_pack): refine the document.  [ruby-dev:42397]
	  (pack_unpack): ditto.

Mon Oct 18 10:19:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (transport_request): @socket may be nil.
	  patched by Egbert Eich [ruby-core:32829]

Mon Oct 18 09:57:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (BSD_vfprintf): wrong padding around prefix and
	  floating point with %a. [ruby-dev:42403] Bug #3956

Sun Oct 17 22:36:33 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta.rb: added an rdoc tag.

Sun Oct 17 10:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_mod_remove_const): update rdoc.
	  [ruby-core:31957]

Sun Oct 17 10:40:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_define_{class,module}_id_under): register to be
	  marked, which probably are defined and used internally.

Sat Oct 16 11:10:55 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_encoding2cp): set codepage 20936
	  according to GB2312. [Bug #3937] [ruby-core:32758]

Sat Oct 16 10:54:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (CPP): already used in .c.i rule.

	* cygwin/GNUmakefile.in (DLLWRAP, WINDRES): add --driver-name and
	  --preprocessor options explicitly.  [ruby-core:32776]

Sat Oct 16 10:06:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/sdbm/_sdbm.c (SEEDUPS, BADMESS): make settable using command
	  line options.

	* ext/sdbm/_sdbm.c (makroom): suppress unused result warning.

	* ext/sdbm/extconf.rb: disable BADMESS, a library should not emit
	  messages directly.

Sat Oct 16 08:39:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_strerror): get English message first, instead of
	  system default. see [ruby-dev:42358].

Sat Oct 16 00:08:00 2010  Koichi Sasada  <ko1@atdot.net>

	* hash.c (rb_hash_aref): skip calling "default" method
	  if it is not needed, for speed-up.

Fri Oct 15 23:36:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (NUM2DEVT, DEVT2NUM, PRI_DEVT_PREFIX): fallback to
	  unsigned int.

Fri Oct 15 22:54:46 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_hresult2msg): get English message first,
	  instead of system default. [ruby-core:32765]

Fri Oct 15 22:47:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (VALUE): prefer long over uintptr_t,
	  FIX2LONG expects VALUE to be long at least.

	* include/ruby/ruby.h (FIX2LONG): parenthesize the argument.

Fri Oct 15 20:30:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (dev_t): use RUBY_REPLACE_TYPE.

	* file.c (rb_stat_inspect): use PRI_DEVT_PREFIX.

Fri Oct 15 17:26:57 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): simplify comparison of explicit_endian
	  as pointed by nobu.

	* pack.c (pack_unpack): ditto.

Fri Oct 15 16:40:37 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): fix more than one modifiers appear in the
	  format string. [ruby-core:32793]

	* pack.c (pack_unpack): ditto.

Thu Oct 14 23:20:42 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb: refactoring.

Thu Oct 14 22:18:29 2010  Koichi Sasada  <ko1@atdot.net>

	* insns.def, iseq.c, vm_insnhelper.c: rename variable name
	  (ip -> iseq).

Thu Oct 14 20:41:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): support endian modifiers: < and >.
	  [ruby-dev:42376] Feature #3491

	* pack.c (pack_unpack): ditto.

Thu Oct 14 20:50:51 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (reg_get_val): expand environment in
	  the pathname. [Bug #3907]

Thu Oct 14 07:35:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (DEVT2NUM): added. Size of dev_t is depend on the
	  environment even if POSIX defines dev_t as unsigned integer.
	  For example, OpenVMS, 64bit Solaris 9, and NetBSD 6 defines
	  dev_t as 64bit unsigned integer.

	* file.c (rb_stat_dev): use DEVT2NUM.

	* file.c (rb_stat_dev_major): dev_t is not long. major(3)'s return
	  value is int.

	* file.c (rb_stat_dev_minor): dev_t is not long. minor(3)'s return
	  value is int.

	* configure.in: check size of dev_t.

Thu Oct 14 07:22:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_and, rb_ary_or), class.c (rb_mod_init_copy),
	  gc.c (undefine_final), time.c (time_mload): get rid of
	  type-punning casts.

Thu Oct 14 04:16:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (ruby_float_step): fix Numeric#step with infinity unit
	  doesn't works well. [ruby-core:32779]

Wed Oct 13 23:16:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/enc-unicode.rb: get rid of lots of warnings.

	* iseq.c (insn_operand_intern, rb_iseq_disasm): fix format specifiers.

	* vm.c (thread_free): ditto.

	* numeric.c (check_uint): get rid of overflow on LLP64 platforms.

	* insns.def (opt_case_dispatch): use st_data_t.

Wed Oct 13 22:32:34 2010  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/util.rb (CGI::unescape): bugfix to unescape the multibyte
	  string. Thanks nobu and tDiary dev members. [Bug #3909]

Wed Oct 13 21:13:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_chr): raise error when the value is negative.

Wed Oct 13 19:24:08 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm.c (ruby_vm_destruct): This function type was wrong; correct to the prototype.

Wed Oct 13 14:58:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num_to_uint): fix 32bit logic.

Wed Oct 13 12:53:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num_to_uint): added to check the range of arguments.
	  Mainly for negative value with NUM2UINT on 32bit environment.

	* string.c (rb_str_concat): use rb_num_to_uint.

Wed Oct 13 12:10:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_error): get English message first, instead
	  of system default. see [ruby-core:32765].
	  [experimental]

Wed Oct 13 11:04:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c (ruby_set_debug_option): define always for binary
	  compatibility with debug env enabled binary.

	* signal.c (ruby_enable_coredump): ditto.

Wed Oct 13 10:52:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ruby_executable_node): missing prototype.

Wed Oct 13 05:23:04 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* missing/strchr.c: add strlen's prototype.

	* missing/strstr.c: ditto.

Wed Oct 13 00:21:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (struct mktime_arg): constified.

	* ext/syck/rubyext.c (mktime_do, mktime_r, rb_syck_mktime): fix
	  function signatures.

Wed Oct 13 00:18:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (MurmurMagic): get rid of literal overflow.

	* configure.in (RUBY_CHECK_PRINTF_PREFIX): check for printf format
	  specifier if possible.

Tue Oct 12 23:58:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_open_osfhandle, rb_w32_wopen, rb_w32_pipe):
	  use uintptr_t instead of long for win64.

	* win32/win32.c (socketpair_internal): suppress warnings.

	* win32/win32.c (ftruncate): use HANDLE instead of long for win64.

	* vsnprintf.c (BSD_vfprintf): fix cast.

	* numeric.c (rb_num2fix): result of rb_num2long is SIGNED_VALUE.

	* compile.c (iseq_build_body), error.c (set_syserr, get_syserr),
	  (syserr_initialize), gc.c (define_final, rb_gc_copy_finalizer),
	  (run_final), hash.c (rb_hash_aref, rb_hash_lookup2),
	  (rb_hash_fetch_m, rb_hash_clear, rb_hash_aset, eql_i),
	  iseq.c (iseq_load, iseq_data_to_ary), marshal.c (r_symlink),
	  thread.c (rb_thread_local_aref),
	  variable.c (generic_ivar_remove, ivar_get, rb_const_get_0),
	  (rb_cvar_get), vm.c (rb_vm_check_redefinition_opt_method),
	  vm_insnhelper.c (vm_get_ev_const), vm_method.c (remove_method),
	  ext/iconv/iconv.c (map_charset): use st_data_t.

	* compile.c (iseq_build_body), insns.def (getglobal, setglobal),
	  iseq.c (iseq_load, iseq_data_to_ary), util.c (valid_filename):
	  use VALUE.

	* gc.c (obj_free, rb_objspace_call_finalizer): fix truncating
	  cast.

	* gc.c (mark_current_machine_context): suppress warnings.

	* compile.c (iseq_compile_each): fix truncating cast.

	* cont.c (fiber_setcontext): missing variable definition.

Tue Oct 12 19:25:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (exc_to_s): use OBJ_INFECT.

	* error.c (name_err_to_s): ditto.

	* error.c (name_err_mesg_to_str): ditto.

	* error.c (syserr_initialize): ditto.

Tue Oct 12 19:07:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): taint message if mesg is given
	  and it is tainted.

Tue Oct 12 18:25:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ungetc): always see Bignum. On 32bit valid value
	  may be a Bignum. On 64bit for errors. [ruby-dev:42366]

Tue Oct 12 18:25:04 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): use unsigned int for GB18030.

Tue Oct 12 17:53:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric (check_uint): the mask must refer to VALUE.

Tue Oct 12 17:47:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric (check_uint): set MSB for negative value.

	* numeric (rb_num2uint): return value's type of rb_num2ulong
	  is VALUE.

	* numeric (int_chr): variable i can't be negative.

Tue Oct 12 16:04:37 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_strerror): get English message first, instead
	  of system default. see [ruby-dev:42358].
	  [experimental]

Tue Oct 12 15:52:35 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_strerror): unmap some range of errno for
	  workaround of VC10's strerror() and sys_nerr problem.
	  based on a patch from Akio Tajima, [ruby-dev:42355].

Tue Oct 12 15:36:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ungetc): use unsigned int for GB18030.

Tue Oct 12 15:14:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_putc): support multibyte characters.
	  [ruby-core:30697]

Tue Oct 12 15:10:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_enc_uint_chr): split from int_chr.

	* numeric.c (int_chr): use rb_enc_uint_chr.

	* include/ruby/encoding.h (rb_enc_uint_chr): added.

Tue Oct 12 14:04:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_chr): a codepoint of Ruby M17N must be 32bit
	  unsigned int; GB18030 uses MSB. Also note that OnigCodePoint
	  is defined as unsigned int.

Tue Oct 12 12:20:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): foolish mistake.

Tue Oct 12 10:39:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_MINGW32): canonicalize only on mingw.

Mon Oct 11 20:20:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (HTTP.get): specify ASCII-8BIT as the result
	  encoding of Zlib::GzipReader.
	  http://hibari.2ch.net/test/read.cgi/tech/1281473294/271

Mon Oct 11 17:42:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): use mesg's encoding when locale
	  encoding is US-ASCII. If locale encoding is not US-ASCII,
	  assume err has non ASCII characters. [ruby-dev:42358]

Mon Oct 11 14:03:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): set the encoding of Errno::*#message
	  as locale. [ruby-dev:42358]

Mon Oct 11 06:38:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_set_encoding):
	  StringIO#set_encoding can get 2nd argument and optional hash
	  for API compatibility to IO. [ruby-dev:42356]

Mon Oct 11 06:11:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_set_encoding): use rb_funcall2 when the io is not
	  a T_FILE. [ruby-dev:42356]

Sun Oct 10 18:42:23 2010  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#replace): Apply a bit of optimization.

Sun Oct 10 10:20:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_MINGW32): canonicalize as like mswin version.

Sun Oct 10 05:33:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_signal_buff_size, rb_signal_exec): moved
	  declarations from thread.c.

Sat Oct  9 16:54:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RSHIFT): quote to get rid of argument expansion
	  for autoconf 2.68.

Sat Oct  9 11:00:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_reset_event_flags, exec_event_hooks): ignore
	  hooks marked as removed.

	* thread.c (thread_exec_event_hooks): remove hooks to be removed.

	* thread.c (rb_threadptr_remove_event_hook, rb_remove_event_hook):
	  defer removing hooks if running the hooks.  [ruby-dev:42350]

Sat Oct  9 10:51:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_threadptr_exec_event_hooks): suppress each event
	  hooks separately.

	* thread.c (thread_suppress_tracing): split from
	  ruby_suppress_tracing, accepting thread pointer and event mask.

Sat Oct  9 08:16:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_threadptr_remove_event_hook): fix typo.

Fri Oct  8 10:52:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RBCONFIG): depends on version.h due to
	  RUBY_PATCHLEVEL.  [ruby-core:32709]

Fri Oct  8 00:24:54 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Fixing documentation typos.  [ruby-core:32712]

Thu Oct  7 09:14:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c (vm_exec_core):  Treat clang as non gcc on this
	  context: It has __asm__ but doesn't works well.

Wed Oct  6 12:28:22 2010  Tanaka Akira  <akr@fsij.org>

	* lib/uri/generic.rb (URI::Generic#hostname): new method.
	  (URI::Generic#hostname=): ditto.

	* lib/open-uri.rb: use URI#hostname

	* lib/net/http.rb: ditto.

	  reported by Adam Majer.  [ruby-core:32056]

Wed Oct  6 11:52:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fptr_finalize): write_mutex might have been destroyed
	  already in finalization phase, as the order of finalizers is not
	  guaranteed.  rb_mutex_t should be used in place of Mutex object
	  in the future.

Tue Oct  5 22:17:02 2010  wanabe  <s.wanabe@gmail.com>

	* win32/mkexports.rb: revert r29320 and r29402.

Mon Oct  4 12:43:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (regexp): dregexp has literal string only at the head
	  and successors are array.  [ruby-core:32682]

Mon Oct  4 10:22:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rand_init): This checks the value is in 32bit or not,
	  so use int32_t, not int.

Mon Oct  4 09:47:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rand_init): remove useless assignment.

	* re.c (update_char_offset): remove unused variable.

	* re.c (read_escaped_byte): ditto.

Mon Oct  4 09:30:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/lib/openssl/bn.rb (Integer#to_bn): OpenSSL::BN.new
	  accepts only Strings, so call Integer#to_s(16).
	  16 is for an optimization. [ruby-dev:42336]

Mon Oct  4 07:57:51 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (fiber_memsize): Return size.
	  Before this change, fiber_memsize always returns 0.

Mon Oct  4 07:16:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/unicode.c (onigenc_unicode_property_name_to_ctype):
	  remove useless assignment.

	* vm.c (vm_make_proc_from_block): ditto.

	* variable.c (rb_ivar_count): ditto.

Mon Oct  4 06:40:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* Makefile.in (clean-rdoc): Don't use \ in variable expansion.
	  BSD make treats it as an escape character.

Mon Oct  4 00:01:53 2010  wanabe  <s.wanabe@gmail.com>

	* tool/config.sub: revert r29320, r29324, r29347, r29354, r29365
	  to automake-1.11.1. [ruby-core:32634]

	* win32/mkexports.rb: no longer use 'mingw64'. a patch from Luis Lavena
	  at [ruby-core:32678].

Sun Oct  3 20:36:37 2010  Akio Tajima (arton)  <artonx@yahoo.co.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb: Change creating
	  shortcut verb to 'Link' [Bug #3339]

Sun Oct  3 19:44:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): get rid of duplicated ruby target when
	  already there it was.

Sat Oct  2 22:59:32 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_thread.rb: add for win32ole with Thread.

Fri Oct  1 17:03:00 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/webrick/test_httpproxy.rb (TestWEBrickHTTPProxy::test_upstream_proxy):
	  My machine fails this test at this line, saying 503 service unavailable.

Thu Sep 30 16:11:08 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getenv): should return NULL if specified name
	  is empty. a patch from Heesob Park at [ruby-core:32650]

Thu Sep 30 15:18:23 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (command_asgn): allow command_call to be right hand side
	  expression of chained assignment.  [ruby-dev:42313]

Thu Sep 30 10:55:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (ruby_setenv): workaround for old Windows. a patch from
	  Heesob Park. [ruby-core:32353]

Thu Sep 30 09:29:06 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form): change treatment of
	  undefined value in given array as latest internet draft for
	  application/www-form-urlencoded.
	  http://tools.ietf.org/html/draft-hoehrmann-urlencoded-01

Thu Sep 30 09:34:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): fixed wrong type of return value of
	  SymGetModuleBase64(). [ruby-dev:42306]

Wed Sep 29 21:04:05 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions::test_script_from_stdin):
	  As usual, PTY is not always available.

Wed Sep 29 18:38:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x64): regularize only for pc vendor, and strip
	  useless 64 suffix.

Wed Sep 29 17:53:02 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BIGDECIMAL_ENABLE_VPRINT):
	  VPrint is usually disabled.  It's only used in debugging.

Wed Sep 29 17:41:34 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_limit):
	  return the result of a block.

	* test/bigdecimal/test_bigdecimal.rb (test_save_limit):
	  add a test for the above change.

Wed Sep 29 16:18:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): remove unused optional arguments.

Wed Sep 29 13:26:30 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_rounding_mode):
	  return the result of a block.

	* test/bigdecimal/test_bigdecimal.rb (test_save_rounding_mode):
	  add a test for the above change.

	* test/bigdecimal/test_bigdecimal.rb (test_save_exception_mode):
	  add a test for the return value of BigDecimal.save_exception_mode.

Wed Sep 29 12:45:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_div2, BigDecimal_add2,
	  BigDecimal_sub2, BigDecimal_mult2, VpLimitRound): remove meaningless
	  casts to get rid of compiler warnings.

Wed Sep 29 12:35:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VPrint, VpToString): fix format.

Wed Sep 29 12:31:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/known_classes.rb (RDoc::KNOWN_CLASSES): add Encoding.

Tue Sep 28 20:50:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x64): regularize same as mswin.

Tue Sep 28 20:06:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): add windows support.
	  based on patches from Peter Weldon at [ruby-core:32551]

Mon Sep 27 23:30:34 2010  Koichi Sasada  <ko1@atdot.net>

	* insns.def (opt_case_dispatch), vm_insnhelper.c:
	  execute the procedures of "when" clauses by bytecode
	  instead of st_foreach() when the object does not hit
	  prepared hash.  [ruby-dev:42304]

Mon Sep 27 15:54:03 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/http/test_https.rb: As always, localhost is not
	  guaranteed to be resolved as 127.0.0.1.  But a SSL
	  certificate needs a socket to listen on a specific address
	  where a CN resolves to.  On situations where localhost is
	  not 127.0.0.1, these tests are not possible.

Mon Sep 27 15:25:05 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/imap/test_imap.rb: resurrection of r29259.
	  this change depends on minitest 1.7.1.

	* lib/test/unit/assertions.rb: ditto.

Sun Sep 26 22:59:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x86_64-pc-mingw64): regularize.

Sun Sep 26 22:21:07 2010  wanabe  <s.wanabe@gmail.com>

	* ext/openssl/ossl_hmac.c (ossl_hmac_hexdigest, ossl_hmac_s_hexdigest),
	  ext/openssl/ossl_pkey_ec.c (ossl_ec_group_set_seed),
	  ext/openssl/ossl_ssl_session.c (ossl_ssl_session_to_der),
	  ext/openssl/ossl_pkcs7.c (numberof): suppress warnings.
	  [ruby-core:31932]

Sun Sep 26 10:25:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.{guess,sub}: updated to automake-1.11.1.

Sat Sep 25 22:48:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_DLDFLAGS): fix quoting.

Sat Sep 25 10:30:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_DLDFLAGS): use -unexported_symbol only
	  when available.  http://trac.macports.org/ticket/26341

Sat Sep 25 10:05:49 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Always add -mieee for Renesas SH4.
	  Thanks, Nobuhiro Iwamatsu. [Feature #3874] [ruby-core:32548]

Sat Sep 25 01:34:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (install-cross): target to install cross-compiling
	  stuff.

Fri Sep 24 23:44:59 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_call), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (vm_yield_with_cfunc): pass given block.
	  [ruby-core:32075]

	* vm_eval.c (rb_funcall_passing_block): new function to call
	  method with passing given block.

Fri Sep 24 15:50:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_to_i): fix rdoc: String#to_i raises an
	  exception when base is invalid. [ruby-core:31685]

Fri Sep 24 15:28:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_rindex): use rb_enc_prev_char instead of repeated
	  str_nth.
	  patched by Michael Selig [ruby-core:32498]

Fri Sep 24 14:19:12 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/test_pty.rb: Same as 229281; existence of PTY class do not
	  guarantee a successful pty operation.

Fri Sep 24 06:25:55 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.7.2 r5879.
	* test/minitest/*.rb: ditto.

Thu Sep 23 23:09:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_cref0): cref is stacked only in normal
	  iseqs, so check if it is the case first.

Thu Sep 23 23:08:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub: mingw64 should use x86_64.  [ruby-core:32514]

Thu Sep 23 21:40:40 2010  wanabe  <s.wanabe@gmail.com>

	* ext/socket/raddrinfo.c (init_addrinfo, inspect_sockaddr): suppress
	  warnings.  see [ruby-core:31932].

Thu Sep 23 19:27:57 2010  wanabe  <s.wanabe@gmail.com>

	* thread_win32.c (w32_wait_events, w32_close_handle): suppress warnings.
	  see [ruby-core:31932].

Thu Sep 23 18:54:39 2010  wanabe  <s.wanabe@gmail.com>

	* tool/config.sub: add mingw64.

	* win32/mkexports.rb (Exports::Mingw64): added.

	* win32/mkexports.rb (Exports::Mingw32): renamed from Exports::Mingw.

Thu Sep 23 09:01:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_cref_push): no outer cref is needed for proc
	  from method.  Bug #3786, Bug #3860, [ruby-core:32501]

Wed Sep 22 17:12:01 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/openssl/utils.rb (OpenSSL#silent): always restore $VERBOSE.
	  [ruby-dev:42285]

Wed Sep 22 16:59:40 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_prime.rb (TestPrime#test_new): the warning expected have
	  not been displayed when $VERBOSE == nil. Patch by Shota Fukumori
	  a.k.a. sora_h. [ruby-dev:42272]
	  Recovers $stderr even if StringIO.new fails. Reported by unak.

Wed Sep 22 01:55:48 2010  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_method.rb: fix last commit.

Wed Sep 22 01:49:52 2010  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_method.rb: add a test for [ruby-core:30534].

Wed Sep 22 00:52:44 2010  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/rdoc/ri/store.rb (save_cache): remove duplicate entries.

Wed Sep 22 00:00:05 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_f_pathname): Pathname() translated
	  from pathname.rb.

Tue Sep 21 22:18:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/mkconfig.rb: fixed build problem on mswin64 introduced in r29278.

Tue Sep 21 02:42:35 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/pathname/test_pathname.rb (TestPathname#test_mkdir): fix typo.

Mon Sep 20 23:23:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (bracket): get rid of scanning at the end of the pattern
	  string, not to raise an exception while globbing command line.
	  [ruby-core:32478]

Mon Sep 20 11:25:49 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (Init_pathname): Pathname#=~ undefinition
	  translated from pathname.rb.

Mon Sep 20 02:34:11 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (check_rounding_mode, BigDecimal_mode):
	  raise ArgumentError instead of TypeError passing invalid modes.

	* test/bigdecimal/test_bigdecimal.rb (test_mode, test_round):
	  change against the above modifications.

Sun Sep 19 22:08:39 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mkmf.rb (try_link): rdoc
	  (try_compile): ditto
	  (try_cpp): ditto
	  (try_func): ditto
	  (try_var): ditto
	  (try_run): ditto
	  (egrep_cpp): ditto

Sun Sep 19 20:43:33 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in (--disable-install-doc): disables capi too, in addition
	  to rdoc.
	  (--disable-install-rdoc): a new option for disabling only rdoc.
	  (--disable-install-capi): a new option for disabling only capi.

Sun Sep 19 20:37:45 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (clean): removes all documents on cleaning.o
	  (CAPIOUT): new variable.
	  (clean-capi, distclean-capi, realclean-capi): new targets

	* Makefile.in (clean-capi, distclean-capi, realclean-capi): ditto.

	* win32/Makefile.sub (clean-capi, distclean-capi, realclean-capi):
	  ditto.

Sun Sep 19 13:44:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_SO): fix an oversight of replace
	  RUBY_INSTALL_NAME with RUBY_SO_NAME.  a patch from Jeremy Evans
	  at [ruby-core:32474].

Sun Sep 19 07:48:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_unlink): Pathname#unlink and
	  Pathname#delete translated from pathname.rb.

Sun Sep 19 06:06:07 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (check_rounding_mode): added for
	  converting symbol to rounding mode number.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode, BigDecimal_round):
	  support to specify rounding mode by symbol.

	* test/bigdecimal/test_bigdecimal.rb (test_mode, test_round):
	  add tests for above changes.

Sun Sep 19 05:14:35 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c: fix rounding algorithms for half-down
	  and half-even.  This change is based on the patch created by Matthew
	  Willson, the reporter of this bug.  [Bug #3803] [ruby-core:32136]

	* test/bigdecimal/test_bigdecimal.rb: add tests for above changes.

Sat Sep 18 20:09:51 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_each_entry): Pathname#each_entry
	  translated from pathname.rb.

Fri Sep 17 23:44:07 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/xpath_parser.rb, test/rexml/test_xpath.rb:
	  add missing method availability check. [ruby-core:32447]
	  Reported by Wiebe Cazemier. Thanks!!!

Fri Sep 17 23:23:26 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_sax.rb: don't use thread and sleep to avoid slow test.

Fri Sep 17 23:10:44 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb: enable.

Fri Sep 17 22:46:02 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: untabify.

Fri Sep 17 22:29:56 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: fix fixture data path. All REXML tests are worked.

Fri Sep 17 22:15:15 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_listener.rb: remove needless codes.

Fri Sep 17 22:12:23 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: import REXML tests from
	  http://www.germane-software.com/repos/rexml/trunk/test/.
	  Many tests are failed temporary. I'll fix them quickly. Sorry.

Fri Sep 17 16:48:49 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/io/console/test_io_console.rb (TestIO_Console::helper):
	  PTY.open is not guaranteed to work.  On my machine opening a
	  pty is prohibited via process control group.  On those cases
	  exceptions shall occur, and that doesn't mean our fault.
	  Skip those tests on such situations.

Fri Sep 17 08:30:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tracer.rb: count only non-internal libraries in stack trace,
	  ignoring custom_require.  [ruby-core:31858]

Fri Sep 17 02:18:41 2010  Akinori MUSHA  <knu@iDaemons.org>

	* tool/mkconfig.rb: Fix build with m4 1.4.15 generating duplicate
	  lines in config.status.  According to nobu, the mswin32 port may
	  depend on the piece of code in question, so the behavior is left
	  unchanged on mswin32.

Thu Sep 16 23:47:59 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_opendir): Pathname#opendir translated
	  from pathname.rb.

Thu Sep 16 21:40:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GlobOption): merged RejectOption.

	* test/runner.rb: utilize GlobOption.

Thu Sep 16 21:31:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/driver.rb (RDoc::RI::Driver.setup_options)
	  (RDoc::RI::Driver.fixup_options): split from process_args.
	  libraries should not parse ARGV inside, since it's a task of
	  applications, not libraries.

Thu Sep 16 21:02:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths.each): HOMEDIR can be nil
	  if $HOME is unset.

Thu Sep 16 14:50:42 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_file_exhaustive.rb (TestFileExhaustive::test_expand_path):
	  ENV["HOME"] might not be set.  On those cases without it an
	  exception raises here, which effectively disables later
	  tests on this method.

Thu Sep 16 08:30:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): fix rdoc.  pointed out by Tomoyuki
	  Chikanaga at [ruby-core:32395], and a patch from Daniel
	  Bovensiepen at [ruby-core:32403].

Thu Sep 16 08:27:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/extconf.rb: use expanded sysconfdir with empty DESTDIR.
	  [ruby-core:32394]

Thu Sep 16 06:07:24 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_rmdir): Pathname#rmdir translated
	  from pathname.rb.

Thu Sep 16 00:36:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/extconf.rb: Remove Readline 6 check because
	  Ruby's license is now GPLv3 compatible. [ruby-core:28736]

Thu Sep 16 00:26:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* COPYING: change Ruby's License from a dual license with GPLv2
	  to a dual license with 2-clause BSDL.
	  [ruby-dev:42166] [ruby-core:31971]
	  [ruby-dev:39167] [ruby-core:25272]

	* COPYING.ja: ditto.

	* BSDL: added. this is from The FreeBSD License.

Wed Sep 15 21:07:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_mkdir): Pathname#mkdir translated
	  from pathname.rb.

Wed Sep 15 13:37:00 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/imap/test_imap.rb: "localhost" not guaranteed to
	  resolve to "127.0.0.1".  On my machine it is "::1" instead.
	  The problem is, you have to connect to the imaps server via
	  the canonical name written in a server certificate, and that
	  of the server.cert is "localhost".  So you have to listen to
	  the address of what "localhost" resolves to.  I think this
	  situation cannot be resolved in a handy manner because the
	  test "test_imaps_post_connection_check" is actually
	  expecting to connect to a server via an address other than
	  the CN.  On my machine several assertions won't pass because
	  the test cannot connect to the server.

Wed Sep 15 09:12:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_puts): fix for wide char encoding strings.
	  [ruby-dev:42212]

Wed Sep 15 07:27:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_format_m): mentioned about Hash argument.  a patch
	  from Daniel Bovensiepen at [ruby-core:32386].

	* sprintf.c (get_hash): ditto, and fix typo.

Wed Sep 15 07:22:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_entries): Pathname#entries translated
	  from pathname.rb.

Wed Sep 15 02:13:44 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/closure.c : Don't use FFI closure alloc on OpenBSD.
	  Thanks Jeremy Evans! [ruby-core:32384]

Tue Sep 14 20:17:48 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_s_getwd): Pathname.getwd and
	  Pathname.pwd translated from pathname.rb.

Tue Sep 14 05:13:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_s_glob): Pathname.glob translated
	  from pathname.rb.

Tue Sep 14 01:24:51 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* ext/socket/raddrinfo.c (ruby_getaddrinfo__aix): suppress a
	  warning.

Mon Sep 13 20:48:30 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_zero_p): Pathname#zero? translated
	  from pathname.rb.

Mon Sep 13 19:56:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/rubysocket.h (__DARWIN_ALIGNBYTES): workaround of a
	  bug in system header of darwin 9.  [ruby-core:32341]

Mon Sep 13 18:11:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_do): fix typo.  a patch from Peter Weldon
	  at [ruby-core:32327].

Mon Sep 13 10:12:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): reject Float('0x0.').
	  [ruby-dev:42239] Bug #3820

Mon Sep 13 09:23:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (ossl_bn_is_prime): fix comparison
	  with rb_scan_args. Before this fix, OpenSSL::BN#prime?
	  is fully broken. [ruby-dev:42225]

Mon Sep 13 06:45:24 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_writable_real_p):
	  Pathname#writable_real? translated from pathname.rb.

Sun Sep 12 21:21:50 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: [ruby-core:32096]  Thanks Colin Bartlett.

Sun Sep 12 19:30:27 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_world_writable_p):
	  Pathname#world_writable? translated from pathname.rb.

Sun Sep 12 09:16:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_writable_p): Pathname#writable?
	  translated from pathname.rb.

Sun Sep 12 08:36:15 2010  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_name2int): support more limits:
	  RLIMIT_MSGQUEUE, RLIMIT_NICE, RLIMIT_RTPRIO, RLIMIT_RTTIME and
	  RLIMIT_SIGPENDING.
	  (Init_process): ditto.
	  patch by Run Paint Run Run.  [ruby-core:32262]

Sun Sep 12 04:27:13 2010  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_name2int): use STRCASECMP to avoid
	  ALLOCA_N.

Sat Sep 11 16:47:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (ruby_setenv): raise if putenv and SetEnvironmentVariable
	  failed, because of the restriction of the size on Windows.
	  based on a patch from Peter Weldon at [ruby-core:32304].  fix:
	  Bug#3812, [ruby-core:32250]

Sat Sep 11 15:19:57 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpauth/digestauth.rb (WEBrick::Config::DigestAuth):
	  Add documentation

	* lib/webrick/config.rb (WEBrick::Config::DigestAuth): Add
	  documentation

Sat Sep 11 12:32:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_set_kcode, rb_get_kcode): removed
	  zombie prototype declarations.  a patch from Eric Hodel
	  at [ruby-core:32305].

Sat Sep 11 06:53:12 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_symlink_p): Pathname#symlink?
	  translated from pathname.rb.

Fri Sep 10 23:03:43 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sticky_p): Pathname#sticky? translated
	  from pathname.rb.

Fri Sep 10 19:11:13 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#continue): add
	  method for generating HTTP/1.1 100 continue response if the client
	  expects it, otherwise does nothing.  Patch by Brian Candler.
	  ref #855.

	* test/webrick/test_httprequest.rb: test added.

Fri Sep 10 17:49:34 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/x509-internal.rb: removed unused local
	  variable.

	* test/openssl/*: less warnings while test running with -w.

Fri Sep 10 16:49:20 2010  Akinori MUSHA  <knu@iDaemons.org>

	* class.c (rb_scan_args): Add support for optional keyword
	  argument hash. [ruby-dev:42221] [ruby-dev:38048]

	* README.EXT, README.EXT.ja: Update documentation accordingly.

	* dir.c (dir_initialize): Make use of the new rb_scan_args()
	  feature.

	* io.c (rb_io_s_popen, rb_scan_open_args, rb_io_initialize)
	  (rb_io_s_pipe, open_key_args, io_s_foreach, io_s_readlines)
	  (rb_io_s_read, rb_io_set_encoding): Ditto.

	* transcode.c (str_transcode, econv_args)
	  (econv_primitive_convert): Ditto.

	* ext/zlib/zlib.c (rb_gzreader_initialize): Ditto.

Fri Sep 10 10:33:18 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rb_genrand_ulong_limited): renamed from
	  rb_rand_internal and now this is public API.

	* include/ruby/ruby.h (rb_genrand_ulong_limited): added.

	* bignum.c (big_sparse_p): use rb_genrand_ulong_limited.

Fri Sep 10 13:07:22 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/digest/lib/digest.rb: removed unused exception variable
	  assignment to avoid a warning.

Fri Sep 10 07:29:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_systmpdir): assume system default tmpdir
	  safe.  [ruby-dev:42089]

Fri Sep 10 07:03:23 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_size_p): Pathname#size? translated from
	  pathname.rb.

Fri Sep 10 02:15:29 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_peercred): support OpenBSD-current.
	  patch by Jeremy Evans.  [ruby-core:32240]

Thu Sep  9 23:25:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace_each): skip allocator frames which have no
	  name.  [ruby-core:32231]

Thu Sep  9 22:39:08 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_size): Pathname#size translated from
	  pathname.rb.

Thu Sep  9 22:34:48 2010  wanabe  <s.wanabe@gmail.com>

	* compile.c (case_when_optimizable_literal): When float value can be
	  treated as integer, add to table hash of case that way.
	  based on a patch from Ikuo KOBORI. [ruby-dev:42038]

	* insns.def (opt_case_dispatch): ditto.

	* test/ruby/test_case.rb: add tests.

Thu Sep  9 17:15:15 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/net/http/test_https.rb (test_identity_verify_failure): follows
	  the SSL hostname check error message of openssl.

Thu Sep  9 10:44:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_env.rb (test_aset): OpenBSD acts like NetBSD in
	  that it ignores characters after = in ENV.
	  patched by Jeremy Evans [ruby-core:32184]

Thu Sep  9 09:02:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/rbinstall.rb (install?): gemspec filename should include
	  its version. patched by Luis Lavena [ruby-core:32165]

Wed Sep  8 22:46:31 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ssl_get_error): Thread context switch was
	  blocked on Windows while blocking call for SSLSocket.  Need to
	  convert errno for letting rb_io_wait_readable detect EWOULDBLOCK.
	  Patch by arton. ref #3794.

Wed Sep  8 20:56:57 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_setgid_p): Pathname#setgid? translated
	  from pathname.rb.

Wed Sep  8 06:25:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_setuid_p): Pathname#setuid? translated
	  from pathname.rb.

Tue Sep  7 21:03:35 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readable_real_p):
	  Pathname#readable_real?  translated from pathname.rb.

Mon Sep  6 23:07:25 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_world_readable_p):
	  Pathname#world_readable?  translated from pathname.rb.

Mon Sep  6 11:03:13 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* Fixed wrong check of missing functions. Patch by Adrian Quark.
	  ref #3400
	  The patch contains following comment:
	    This patch should avoid unnecessary incompatibility with future
	    versions of Openssl.  Changes suggested by bmaher_at_amazon.com.

Mon Sep  6 10:46:55 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* Fixed exception message for SSL post connection check failure. Patch
	  by Paul Betteridge. ref [Bug #3704]

Mon Sep  6 10:31:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_s_get_line_buffer):
	  Readline.line_buffer should return locale string.
	  [ruby-dev:42184] #3791

Mon Sep  6 09:47:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): check there is at least 1 digit after
	  "0x" before ".". [ruby-dev:42183] #3790

Mon Sep  6 09:44:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): check integer overflow.
	  [ruby-dev:42180] #3789

Mon Sep  6 06:17:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readable_p): Pathname#readable?
	  translated from pathname.rb.

Sun Sep  5 23:02:34 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_owned_p): Pathname#owned?
	  translated from pathname.rb.

Sat Sep  4 23:48:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_readlink): symlink target should be in
	  filesystem encoding.

Sat Sep  4 10:40:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (ruby_init_ext): export for golfers.

	* vm_core.h (rb_iseq_eval, rb_iseq_compile_with_option): ditto.

Sun May 23 17:29:41 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (capi): uses a timestamp file to get rid of
	  generating twice.

Fri Jun 18 01:33:21 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* enc/Makefile.in (realclean): has been missing. necessary
	  for make realclean-enc.

Fri Sep  3 23:51:26 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_socket_p): Pathname#socket?
	  translated from pathname.rb.

Fri Sep  3 06:40:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (chfunc): pass through exceptions.

	* io.c (rb_io_bufwrite, rb_io_bufread): added.

	* process.c (rb_fork_err): protect from exceptions.

Fri Sep  3 06:16:07 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_pipe_p): Pathname#pipe?
	  translated from pathname.rb.

Fri Sep  3 06:14:40 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (chfunc): restore errno from SystemCallError and
	  propagate proper exception to the parent.  [ruby-dev:41965]

Thu Sep  2 22:10:38 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_file_p): Pathname#file?
	  translated from pathname.rb.

Thu Sep  2 09:12:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): don't forget to free
	  memory.

Thu Sep  2 09:01:13 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): unicodize.

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): convert arguments of
	  CreateChild() from ACP to WideChar.

Thu Sep  2 06:53:43 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_directory_p): Pathname#directory?
	  translated from pathname.rb.

Wed Sep  1 22:03:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_grpowned_p): Pathname#grpowned?
	  translated from pathname.rb.

Wed Sep  1 17:39:02 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.7.1 r5835.
	* test/minitest/*.rb: ditto.

Wed Sep  1 16:50:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): optimized. don't create hash objects
	  when given pattern is ASCII only.

	* string.c (tr_find): ditto.

Wed Sep  1 14:35:29 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_rotate_m): fix typo of rdoc.
	  patched by Andrei Kulakov [ruby-core:31975]

Wed Sep  1 14:33:36 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enum.c (enum_zip): fix typo of rdoc.
	  patched by Andrei Kulakov [ruby-core:31974]

Wed Sep  1 12:56:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (ruby_suppress_tracing): restore the state and invoke
	  the func with normal state.  a patch from Satoshi Shiba <shiba
	  AT rvm.jp> at [ruby-dev:42162].  [ruby-core:31783]

Tue Aug 31 21:10:23 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_exist_p): Pathname#exist? translated
	  from pathname.rb.

Tue Aug 31 17:32:34 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/stubs.c: fix [Bug #3771] "VC++ can't make ext/tk with enabling
	  stubs". Thanks, Akio Tajima [ruby-dev:42159].

Tue Aug 31 03:42:14 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): fix bug in r29146.
	  Initialize table even if cflag is 0; tr_find see whether
	  del is empty or not.

	* string.c (tr_find): nodel can't be NULL; if NULL, it means
	  it is not specified.

Mon Aug 30 21:29:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_executable_real_p):
	  Pathname#executable_real? translated from pathname.rb.

Mon Aug 30 15:00:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): initialize negating table when
	  negating string is given. [ruby-core:31851]

	* string.c (tr_find): add a sentence for the time when
	  target characters include negating one.

	* string.c (rb_str_count): move definition.

Mon Aug 30 07:32:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_executable_p): Pathname#executable?
	  translated from pathname.rb.

Sun Aug 29 23:54:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser/ruby.rb (RDoc#parse_call_parameters): don't
	  include assignment.  [Bug #3759], [ruby-dev:42154]

	* lib/rdoc/parser/ruby.rb (RDoc#parse_class): ignore non-constant
	  name singleton class.  [Bug #3759], [ruby-dev:42154]

Sun Aug 29 23:25:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_get_path_check): clarify error message for
	  ASCII-incompatible path name.

Sun Aug 29 16:02:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (node_name.inc): remove command option -n and give
	  file as stdin, because IronRuby 1.1 still doesn't support it.
	  So now we can use ir.exe as BASERUBY.

	* tool/node_name.rb: read stdin with while gets.

Sun Aug 29 13:22:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_method_id_and_class): curried proc has no
	  method.  [ruby-core:31871]

Sun Aug 29 12:51:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_provide_feature): clarify error message for frozen
	  $LOADED_FEATURES.  based on a patch from Run Paint Run Run at
	  [ruby-core:31913].

Sun Aug 29 12:19:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_failed): should honor encoding.  [ruby-core:31915]

Sun Aug 29 09:35:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (clean): exclude *.inc. [ruby-dev:41931]

	* common.mk (distclean): include *.inc.

	* common.mk (help): change description about clean and distclean.

Sat Aug 29 06:34:52 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_chardev_p): Pathname#chardev?
	  translated from pathname.rb.

Sat Aug 28 17:39:33 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_exception_mode,
	  BigDecimal_save_rounding_mode, BigDecimal_save_limit): added.

	* test/bigdecimal/test_bigdecimal.rb: added tests for the above
	  features.

Sat Aug 28 08:11:05 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_blockdev_p): Pathname#blockdev?
	  translated from pathname.rb.

Fri Aug 27 16:20:01 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* string.c (rb_str_prepend): new method by Shota Fukumori (sora_h)
	  [Feature #3765]

Fri Aug 27 15:24:20 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* math.c (math_atan2): you should know that M_PI is not the feature
	  of C90.
	  fixed build failure caused by r29115.

Fri Aug 27 15:26:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (null_device): move from io.c.

Fri Aug 27 12:47:44 2010  Kenta Murata  <mrkn@mrkn.jp>

	* math.c (math_atan2): change the behavior when x and y are zero.
	  [ruby-dev:42090] [Bug #3736] [ruby-dev:42116]

	* test/ruby/test_math.rb (test_atan2): add tests for the above
	  changes.

Fri Aug 27 12:26:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* object.c (rb_obj_class): remove mention of obsolete method.
	  a patch from Run Paint Run Run at [ruby-core:31842].

Fri Aug 27 12:25:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (null_device): the name of null device.  [ruby-dev:41791]

Fri Aug 27 07:57:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): bail out from modification during
	  shuffle.

	* array.c (rb_ary_sample): ditto.

Fri Aug 27 05:11:51 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sysopen): Pathname#sysopen translated
	  from pathname.rb.

Thu Aug 26 22:53:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle): rdoc fix.  argument name was missing.
	  a patch from Run Paint Run Run at [ruby-core:31848].

Thu Aug 26 21:49:46 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readlines): Pathname#readlines
	  translated from pathname.rb.

Thu Aug 26 10:37:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regint.h (OnigStackIndex): the type should be intptr_t.
	  Original Oniguruma assumes the size of long and that of void *
	  are equal, but it's not true on LLP64 platform: mswin64.
	  originally patched by shintaro kuwamoto [ruby-dev:42133]

Thu Aug 26 10:38:11 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* test/dl/test_base.rb: AIX does not have dynamically loadable lib[cm].

	* test/fiddle/helper.rb: AIX does not have dynamically loadable lib[cm].

Thu Aug 26 09:49:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): check number of argument.

Tue Aug 26 09:11:40 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_exception_mode, VpGetException,
	  VpSetException): thread-local exception mode.

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_precision_limit, VpGetPrecLimit,
	  VpSetPrecLimit): thread-local precision limit.

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_rounding_mode, VpGetRoundMode,
	  VpSetRoundMode, VpException, VpInternalRound):
	  thread-local rounding mode.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode, BigDecimal_round,
	  VpIsRoundMode, VpGetRoundMode, VpSetRoundMode, VpActiveRound,
	  VpMidRound, VpLeftRound), ext/bigdecimal/bigdecimal.h:
	  use unsigned short for rounding mode.

	* test/bigdecimal/test_bigdecimal.rb (test_mode): add test for
	  setting rounding mode.

	* test/bigdecimal/test_bigdecimal.rb (test_thread_local_mode):
	  add test for setting mode thread-locally.

Thu Aug 26 07:29:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_{shuffle_bang,sample}): use Random class object.

	* random.c (try_get_rnd): use default_rand for Random as same as
	  singleton methods.

	* random.c (rb_random_real): check the range of result.

Wed Aug 25 22:11:11 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_binread): Pathname#binread translated
	  from pathname.rb.

Wed Aug 25 03:42:43 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): workaround for VC9 for x64.
	  reported by kuwamoto shintaro in [ruby-dev:42125].

Tue Aug 24 23:28:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* .gitignore: updated.

Tue Aug 24 22:07:28 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_read): Pathname#read translated from
	  pathname.rb.

Tue Aug 24 10:11:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: read API version from include/ruby/version.h.

	* {bcc,win}32/setup.mak (-version-): ditto.

	* version.h (RUBY_LIB_VERSION): use API version numbers.

Tue Aug 24 07:07:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang, rb_ary_sample): add optional
	  argument random.  [ruby-dev:41923] [EXPERIMENTAL]

	* random.c (rb_random_{int32,real,bytes}): fallback to normal
	  method invocation.

Tue Aug 24 06:08:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/version.h (RUBY_API_VERSION_*): renamed and moved
	  from version.h.  [ruby-dev:42103]

Tue Aug 24 05:58:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ChangeLog: flushed.  [ruby-dev:42050]

Tue Aug 24 01:14:58 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_f): to_f must underflow
	  when the exponent is less than DBL_MIN_10_EXP - BASE_FIG.

	* test/bigdecimal/test_bigdecimal.rb (test_to_f): added test for the above changes.

Mon Aug 23 23:14:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_each_line): Pathname#each_line
	  translated from pathname.rb.

Mon Aug 23 22:30:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (version.o): depends on both of version.h and
	  include/ruby/version.h.   [ruby-dev:42063]

Mon Aug 23 13:09:27 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* backport r29071 from ruby_1_8;

	  * ext/openssl/ossl_asn1.c (obj_to_asn1bool): fixed ASN1::Boolean
	    encoding issue for OpenSSL 1.0.0 compatibility.
	    ASN1::Boolean.new(false).to_der wrongly generated "\1\1\377" which
	    means 'true'.

	    ASN1_TYPE_set of OpenSSL <= 0.9.8 treats value 0x100 as 'false'
	    but OpenSSL >= 1.0.0 treats it as 'true'.  ruby-ossl was using
	    0x100 for 'false' for backward compatibility.  Just use 0x0 for
	    the case OpenSSL >= OpenSSL 0.9.7.

	  * test/openssl/test_asn1.rb: test added.

Mon Aug 23 12:28:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_search): fix: 4th argument should be regexp
	  object. patched by shintaro kuwamoto [ruby-dev:41667] #3459

Mon Aug 23 02:23:05 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): make sure to have digit-sequence after 'p'
	  for hexadecimal-floating-constant. [ruby-dev:42105]

Mon Aug 23 00:23:07 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: [ruby-core:31695]

Sun Aug 22 09:08:02 2010  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (UINT2NUM): fix ifdef condition for LLP64.
	  reported by Daniel Gutmanas.  [ruby-core:31778]

Sun Aug 22 06:46:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (RAND_UPTO): macro for random number.

Sun Aug 22 05:55:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: fix typo.  a patch from Eric Wong at
	  [ruby-core:31810].

Sat Aug 21 20:09:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm.c: add missing prototype of rb_iseq_clone for r29063.

Sat Aug 21 18:54:56 2010  wanabe  <s.wanabe@gmail.com>

	* vm.c (vm_define_method): copy iseq to avoid overwriting iseq->klass.
	  #2502, #3136. see #2420.

Sat Aug 21 17:36:42 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_split): Pathname#split translated from
	  pathname.rb.

Fri Aug 20 10:40:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_expand_path): Pathname#expand_path
	  translated from pathname.rb.

Thu Aug 19 22:44:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot (usage): add usage.

	* tool/make-snapshot (package): accept revision as BRANCH@REV.

Thu Aug 19 19:53:26 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_timestamp): fix a constant type.

	* ext/socket/raddrinfo.c (get_afamily): suppress a warning.

Thu Aug 19 19:28:47 2010  Tanaka Akira  <akr@fsij.org>

	* thread_pthread.c (native_sleep): suppress a warning for platforms
	  which time_t is int.

Thu Aug 19 18:15:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/merger.rb: Add a tool to merge commits between branches.
	  developed by URABE Shyouhei

Thu Aug 19 17:19:09 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* backport r28621 and r28632 from ruby_1_8;

	  * ext/openssl/ossl_config.c, ext/openssl/lib/openssl/config.rb,
	    ext/openssl/lib/openssl.rb: reimplement OpenSSL::Config in Ruby.
	    Now it should work on windows.

	  * test/openssl/test_config.rb: added tests for OpenSSL::Config#dup.

	  * test/openssl/test_config.rb: added tests for Config#clone.

Thu Aug 19 12:04:39 2010  Kenta Murata  <mrkn@mrkn.jp>

	* array.c (rb_ary_permutation, rb_ary_repeated_permutation,
	  rb_ary_repeated_combination, rb_ary_product):
	  use ary_make_shared_copy instead of ary_make_substitution.
	  [ruby-dev:42067] [Bug #3708]

	* test/ruby/test_array.rb (test_product, test_repeated_permutation,
	  test_repeated_combination): append assertions against [Bug #3708].

Thu Aug 19 11:11:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enum.c (enum_inject): fix typo of rdoc.
	  patched by Andrei Kulakov [ruby-core:31768]

Thu Aug 19 10:06:08 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_extname): Pathname#extname translated
	  from pathname.rb.

Thu Aug 19 06:03:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_push_frame): initialize block_iseq.  a patch
	  from Peter Weldon at [ruby-core:31757].

Wed Aug 18 19:08:17 2010  Kenta Murata  <mrkn@mrkn.jp>

	* array.c (ary_make_shared): revert r29037, it occurs SEGV some
	  situations.

Wed Aug 18 18:36:32 2010  Kenta Murata  <mrkn@mrkn.jp>

	* array.c (ary_make_shared),
	  test/ruby/test_array.rb (test_permutation):
	  always return the original array when it is shared.
	  [ruby-dev:42067] [Bug #3708]

Wed Aug 18 01:37:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c: revert r26701; it introduces Bug #3681.
	  [ruby-core:31677]

Tue Aug 17 20:05:29 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io.rb (test_threaded_flush): test "hi" is not output
	  twice.

Tue Aug 17 15:13:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/date.rb: Re-revert the part of r28950.
	  It reverted the part of r28619.

Tue Aug 17 13:00:07 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_dirname): Pathname#dirname translated
	  from pathname.rb.

Tue Aug 17 07:50:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/extconf.rb: check functions more.
	  [ruby-core:31722]

Tue Aug 17 07:42:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_make_independent_expand): set capacity properly. a
	  patch from Peter Weldon at [ruby-core:31734].  [ruby-core:31653]

Tue Aug 17 07:38:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gem_prelude.rb, lib/rubygems.rb (Gem.suffixes): include empty
	  suffix.  [ruby-core:31730]

Mon Aug 16 22:16:12 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_basename): unused variable removed.

Mon Aug 16 21:39:33 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_basename): Pathname#basename translated
	  from pathname.rb.

Mon Aug 16 20:26:13 2010  Narihiro Nakamura  <narihiro@netlab.jp>

	* gc.c (gc_profile_result): Index begins with 1.

Mon Aug 16 20:21:17 2010  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (gc_profile_result): use size_t. based on patches from
	Tomoaki NISHIYAMA <tomoakin@kenroku.kanazawa-u.ac.jp> at
	[ruby-dev:42042].

Mon Aug 16 19:23:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_dtoa, ruby_hdtoa): use same representations for
	  Infinity and NaN.  a part of a patch from Peter Weldon at
	  [ruby-core:31725].

	* util.c (ruby_hdtoa): fixed buffer overrun.  based on a patch
	  from Peter Weldon at [ruby-core:31725].

Mon Aug 16 17:44:55 2010  Tanaka Akira  <akr@fsij.org>

	* common.mk (capi): use -b option for doxygen.  It disables stdout
	  buffering and prevents wrong reordering between stdout and stderr
	  even when the output of "make" is redirected.

Sun Aug 15 19:59:58 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/webrick/httpresponse.rb (WEBrick::HTTPResponse#set_error):
	  Fix for possible cross-site scripting (CVE-2010-0541).
	  Found by Apple, reported by Hideki Yamane.
	  Patch by Hirokazu Nishio <nishio.hirokazu AT gmail.com>.

Mon Aug 16 12:29:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, win32/Makefile.sub (test-rubyspec-precheck): split
	  from test-rubyspec.

	* common.mk (test-rubyspec): moved from Makefile.in.

Mon Aug 16 10:00:45 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.h (llabs): never never never never never
	  use "long long".

	* ext/bigdecimal.bigdecimal.c (BigDecimal_to_i): get rid of a warning.

Sun Aug 15 18:14:20 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_dump, BigDecimal_inspect,
	  VPrint, VpToString, VpVarCheck): use PRIuSIZE, PRIdSIZE, PRIdVALUE,
	  and PRIxVALUE.

Sun Aug 15 16:14:31 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (Logging.postpone): close @log only when it's available.

Sun Aug 15 13:30:35 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.h (VpVtoD): fix a type of e.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_dump, BigDecimal_inspect):
	  fix format for size_t.

Sun Aug 15 00:22:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/extconf.rb, ext/bigdecimal/bigdecimal.h
	  (labs, llabs): support environments missing labs and llabs.

	* ext/bigdecimal/bigdecimal.h (vabs): added.

	* ext/bigdecimal/extconf.rb, ext/bigdecimal/bigdecimal.h,
	  ext/bigdecimal/bigdecimal.c, test/bigdecimal/test_bigdecimal.rb
	  (TestBigDecimal#test_new): replace U_LONG, S_LONG, S_INT, and U_INT
	  with appropriate standard or ruby-provided types.

Sun Aug 15 00:15:45 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_utime): Pathname#utime translated
	  from pathname.rb.

Sat Aug 14 21:04:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_gc_mark_threads): deprecated.

Sat Aug 14 19:12:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/{coverage,objspace}/extconf.rb ($INCFLAGS): explicitly add
	  topdir and top_srcdir.  [ruby-dev:42031]

Sat Aug 14 17:48:41 2010  Narihiro Nakamura  <authorNari@gmail.com>

	* test/objspace/test_objspace.rb: added test for objspace.

	* ext/objspace/objspace.c: considers T_ZOMBIE by lazy sweep GC.

	* gc.c: considers that dsize was 0. [ruby-dev:42022]

Sat Aug 14 15:33:02 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, include/ruby/defines.h (RUBY_FUNC_EXPORTED): macro
	  to declare exported function.

	* array.c (rb_ary_memsize), string.c (rb_str_memsize),
	  variable.c (rb_objspace_data_type_memsize): used in
	  objspace.  [ruby-dev:42022]

	* io.c (rb_io_memsize): constified.

	* regcomp.c (onig_memsize): constified.

	* gc.h (rb_objspace_each_objects): used in objspace.

	* vm_core.h (rb_{get,set,reset}_coverages): used in coverage.

	* include/ruby/intern.h (rb_time_interval): used in io/wait.

	* include/ruby/intern.h (rb_make_backtrace, rb_make_exception):
	  used in ripper.

	* node.h (rb_parser_{malloc,realloc,calloc,free}): ditto.

Fri Aug 13 22:48:39 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_truncate): Pathname#truncate translated
	  from pathname.rb.

Fri Aug 13 16:11:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (MiniTest::Unit.new): extend before initialize.
	  [ruby-dev:41970]

	* lib/test/unit.rb (MiniTest::Unit.autorun): use Test::Unit::Mini.

Thu Aug 12 23:39:02 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_make_symlink): Pathname#make_symlink
	  translated from pathname.rb.

Thu Aug 12 21:18:27 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_lstat): Pathname#lstat translated
	  from pathname.rb.

Thu Aug 12 05:58:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (rb_char_to_option_kcode): used in
	  ripper.

	* node.h (rb_reserved_word): ditto.

Thu Aug 12 00:19:53 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_rubyoptions.rb (test_script_from_stdin): disable
	  echo.  [ruby-dev:41966]

Wed Aug 11 23:28:22 2010  Kenta Murata  <mrkn@mrkn.jp>

	* lib/cmath.rb (CMath.sqrt): use floating-point value.
	  [ruby-core:31672] [Bug #3678]

	* test/test_cmath.rb: added for testing lib/cmath.rb.

Wed Aug 11 20:57:25 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: merge from branches/ruby_1_9_2, and move io/console.
	  [ruby-dev:41924]

Wed Aug 11 11:01:15 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c: don't use // comment.

Wed Aug 11 06:18:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_stat): Pathname#stat translated
	  from pathname.rb.

Tue Aug 10 21:18:04 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_to_[ifr]): don't allow complex with in-exact
	  imaginary zero to be converted.

Tue Aug 10 20:56:31 2010  Tanaka Akira  <akr@fsij.org>

	* lib/optparse.rb: suppress a warning.

	* test/test_mutex_m.rb: ditto.

Tue Aug 10 20:56:13 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (Date::Format::Bag): use Struct.
	  as an experimental.

Tue Aug 10 20:45:35 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_rename): Pathname#rename translated
	  from pathname.rb.

Tue Aug 10 20:16:19 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/win32/lib/win32/resolv.rb (get_info): get rid of a warning.

Tue Aug 10 19:56:13 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: [ruby-core:31658]

Tue Aug 10 17:24:56 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* README.EXT.ja: rb_tainted_str_new_cstr() is an alias of
	  rb_tainted_str_new2().

Tue Aug 10 15:24:30 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c, ext/bigdecimal/bigdecimal.h,
	  ext/bigdecimal/extconf.rb: BASE and BASE_FIG are defined
	  based on the size of BDIGIT.

	* ext/bigdecimal/bigdecimal.c, ext/bigdecimal/bigdecimal.h:
	  use BDIGIT for Real#frac.

Tue Aug 10 15:19:45 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.h, ext/bigdecimal/bigdecimal.c:
	  add extern declaration of rb_cBigDecimal.

Tue Aug 10 14:09:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest::parse_uri):
	  rollup leading slashes. [ruby-core:31657]
	  patched by Jamison Wilde
	  NOTE: //authority/path is valid relative URI both RFC2396 and
	  RFC3986. So when give a relative URI-like string to URI lib,
	  users must care leading slashes.

Tue Aug 10 11:26:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/un.rb (httpd): SIGQUIT and SIGHUP are not guaranteed to exist.

Tue Aug 10 06:26:48 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readlink): Pathname#readlink translated
	  from pathname.rb.

Mon Aug  9 22:15:19 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_open): Pathname#open translated from
	  pathname.rb.

Mon Aug  9 22:11:09 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_exit_action): use
	  Process.spawn instead of Process.fork.

Mon Aug  9 15:59:02 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rubygems/source_index.rb: rename unused variable.

	* lib/rubygems/specification.rb: rename unused variable.

	* lib/rubygems/specification.rb: remove unused variable.

Mon Aug  9 14:10:06 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: Fix type of mimeout_state.buf.
	  [nkf-bug:20079]

Mon Aug  9 06:52:59 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (sys_warning_1): show error message.

Mon Aug  9 06:50:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_require.rb (test_require_too_long_filename):
	  clear -w option.

Mon Aug  9 00:18:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb ($ignore_error): initialize after $nmake.

Sun Aug  8 19:16:26 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_make_link): Pathname#make_link
	  translated from pathname.rb.

Sun Aug  8 16:42:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems.rb (Gem.find_files): reverted to use globbing.

	* lib/rubygems.rb (Gem.find_files): fixed search order same as
	  default behavior.

	* gem_prelude.rb, lib/rubygems.rb (Gem.suffixes): return truly
	  require-able suffixes only.

Sun Aug  8 13:20:57 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_ftype): Pathname#ftype translated
	  from pathname.rb.

Sun Aug  8 12:41:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_escape): no similar messages twice.
	  [ruby-core:31048]

Sun Aug  8 10:07:45 2010  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): suppress warnings.

Sun Aug  8 08:58:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RUBY_H_INCLUDES): add subst.h.

Sun Aug  8 08:55:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ruby_snprintf): printf attribute.

Sun Aug  8 07:47:29 2010  Tanaka Akira  <akr@fsij.org>

	* lib/rbconfig/obsolete.rb: show the location which use Config.

Sun Aug  8 07:29:55 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_fnmatch): Pathname#fnmatch and
	  Pathname#fnmatch? translated from pathname.rb.

Sun Aug  8 07:18:22 2010  Tanaka Akira  <akr@fsij.org>

	* include/ruby/subst.h (snprintf): redefinition moved from ruby.h.
	  (vsnprintf): ditto.

Sun Aug  8 00:41:42 2010  Tanaka Akira  <akr@fsij.org>

	* include/ruby/subst.h: new file for substitute standard functions.

	* include/ruby/missing.h: don't substitute "close", etc. here.

	* include/ruby/ruby.h: include ruby/subst.h at last.
	  This prevents substituting "close" in unistd.h.

Sat Aug  7 19:51:10 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (EnvUtil.invoke_ruby): merge stdout and stderr
	  if capture_stderr is :merge_to_stdout.
	  (assert_normal_exit): print abnormal output properly.

Sat Aug  7 19:04:49 2010  Tanaka Akira  <akr@fsij.org>

	* missing/close.c: undef the macros "getpeername", "getsockname" and
	  "shutdown" to prevent infinite recursion.

Sat Aug  7 18:37:39 2010  Tanaka Akira  <akr@fsij.org>

	* missing/close.c: undef the macro "close" to prevent infinite
	  recursion.

Sat Aug  7 18:20:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_lchown): Pathname#lchown translated
	  from pathname.rb.

Sat Aug  7 17:49:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/missing.h: moved BROKEN_CLOSE replacements from
	  include/ruby/ruby.h.

Sat Aug  7 17:40:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb, lib/rbconfig/obsolete.rb: warn obsolete and
	  deprecated Config.

Sat Aug  7 17:18:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): follow the change of
	  install-rb-default line format at r28850, which causes second
	  run to create dummy makefiles.

Sat Aug  7 14:08:44 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/mkmf.rb: change instance variable to global.

Sat Aug  7 13:59:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pathname/pathname.c (path_sub_ext): don't clobber shared string.
	  [ruby-core:31640]

Sat Aug  7 13:33:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (vm_call0): fix for VM_METHOD_TYPE_NOTIMPLEMENTED.
	  [ruby-dev:41953]

Sat Aug  7 09:47:06 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: fix checking version of GCC.

Sat Aug  7 09:31:48 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (Init_pathname): fix number of arguments for
	  Pathname#chown.

Sat Aug  7 09:28:12 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (assert_normal_exit): use assert.  fix
	  faildesc.

	* test/pathname/test_pathname.rb (test_lchmod): test Pathname#lchmod
	  using assert_normal_exit.

Sat Aug  7 08:26:26 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_chown): Pathname#chown translated
	  from pathname.rb.

Sat Aug  7 02:09:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_lchmod): Pathname#lchmod translated
	  from pathname.rb.

Fri Aug  6 21:30:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_chmod): Pathname#chmod translated from
	  pathname.rb.

Fri Aug  6 20:13:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* rational.c (nurat_div): divided by infinity should be zero.

	* rational.c (nurat_div): divided by float zero should be
	  infinity.  [ruby-core:31626]

Fri Aug  6 18:59:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (realpath_rec): rb_str_modify depends on the length, so
	  resize instead.

Fri Aug  6 18:56:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (clean-ext): fixed directories to be removed.

Fri Aug  6 17:42:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/depend: add space at the beginning of @ignore_error.

	* lib/mkmf.rb: ditto.

Fri Aug  6 17:38:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (clean): add  prelude.c, config.log, and rbconfig.rb.

	* common.mk (distclean): remove encdb.h, config.log, and rbconfig.rb.

Fri Aug  6 17:35:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* Makefile.in: ignore error from RMDIRS.

	* enc/depend: ditto.

	* lib/mkmf.rb: ditto.

Fri Aug  6 05:53:32 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_mtime): Pathname#mtime translated from
	  pathname.rb.

Thu Aug  5 22:09:30 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_ctime): Pathname#ctime translated from
	  pathname.rb.

Thu Aug  5 21:20:31 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (NODE_ARGSCAT, NODE_ARGSPUSH): drop unused ARGSCAT
	  results when popped is true.  [ruby-dev:41933], [Bug #3658]
	  This is retry of r28870 and r28873 which were reverted.

Thu Aug  5 20:13:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja (String functions): mention
	  rb_str_resize and rb_str_set_len.

Thu Aug  5 19:59:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_set_len): bail out when buffer overflowed
	  probably.

Thu Aug  5 18:36:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c (nucomp_marshal_load): should check the argument.
	  [ruby-core:31622]

	* rational.c (nurat_marshal_load): ditto

	* marshal.c (w_float): should not append a dot if no fractal part
	  exists.  [ruby-dev:41936]

Thu Aug  5 17:11:43 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (void_expr_gen): add 'possibly' to warning message.
	  [ruby-core:31611]

Thu Aug  5 16:57:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_make_pattern): fold continuous PLAINs to get rid of
	  snail at too deep path.  [ruby-dev:41871]

Thu Aug  5 16:42:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_set_len): should fail to modify shared string.

Thu Aug  5 14:12:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): ensure sopath to be modifiable

Thu Aug  5 12:39:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_make_independent_expand): fix buffer overflow
	  while shrinking.

Thu Aug  5 06:42:31 2010  Tanaka Akira  <akr@fsij.org>

	* file.c (realpath_rec): call rb_str_modify before rb_str_set_len.

Wed Aug  4 19:37:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_set_len): rb_str_modify cannot work before the
	  length is set, which is a precondition for rb_str_modify.

Wed Aug  4 15:47:21 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): no need to create the directory
	  at each library file. this change makes making ext faster.

Wed Aug  4 06:25:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_atime): Pathname#atime translated from
	  pathname.rb.

Tue Aug  3 21:16:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (Init_Random): add Random::DEFAULT.

Tue Aug  3 21:01:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_check_hash_type): added.

Tue Aug  3 20:30:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_eq): never equal to infinity.
	  [ruby-core:31603]

	* rational.c (nurat_div): hack for integral float divisor.

Tue Aug  3 14:42:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/extmk.rb: remove purelib, fixes a bug in r28440, r28441.

	* spec/default.mspec: ditto.

	* template/Doxyfile.tmpl: ditto.

Tue Aug  3 14:19:42 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/ri/driver.rb (setup_pager): no need to check the existence
	  of pagers. the following code checks whether they are executable or
	  not.

Tue Aug  3 12:03:57 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* tool/runruby.rb: no purelib.

Tue Aug  3 07:52:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/purelib.rb: no longer used since the default load path of
	  miniruby is empty.

Tue Aug  3 00:53:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def, vm_core.h: fixed typo.  reported by Rocky Bernstein
	  <rockyb AT rubyforge.org> at [ruby-core:31596].

Mon Aug  2 21:51:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): rb_str_set_len modifies ptr
	  since r26303.

Mon Aug  2 21:16:03 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: NONAMELESSUNION defined only if gcc
	  version is older than 3.4.4. [ruby-core:31567] [Bug #3637]
	* ext/win32ole/extconf.rb: ditto.

Mon Aug  2 16:34:32 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (native_thread_join): need to wait thread, of course.
	  [ruby-dev:41911]

Mon Aug  2 12:22:22 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (file_expand_path): wrong condition. [ruby-core:31591]

Mon Aug  2 05:34:48 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_realdirpath): Pathname#realdirpath
	  translated from pathname.rb.

Sun Aug  1 23:04:49 2010  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb: describe superclasses explicitly.

Sun Aug  1 23:04:35 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_modify_expand, rb_str_resize): get rid of
	  repeating malloc and realloc.

Sun Aug  1 22:16:30 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_hash): use rb_memhash and
	  take care of negative finite numbers properly.
	  [ruby-core:31582][Bug #3640]

Sun Aug  1 20:57:22 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_realpath): Pathname#realpath translated
	  from pathname.rb.

Sun Aug  1 17:27:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub: needs stddef.h for size_t.  a patch from
	  Akio Tajima at [ruby-dev:41905].

Sun Aug  1 14:59:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sub_ext): Pathname#sub_ext translated
	  from pathname.rb.

Sun Aug  1 10:23:48 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/irb/init.rb (IRB.parse_opts): set VERBOSE to true when debug
	  switch called in irb.  a patch from Andrew Grimm in
	  [ruby-core:31558].

Sun Aug  1 09:35:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (big_op): comparison of bignum and infinity has returned 1
	  or -1, but it must return boolean.

Sun Aug  1 09:44:25 2010  Tanaka Akira  <akr@fsij.org>

	* class.c (rb_include_module): don't clear the method cache if the
	  included module has no method.
	  reported by Eric Wong.  [ruby-core:31559]

Sun Aug  1 09:21:32 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sub): Pathname#sub translated
	  from pathname.rb.

Sun Aug  1 09:12:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h: latest x86_64 mingw defines stati64.
	  [ruby-core:27516]

Sun Aug  1 08:51:52 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: fix typo. [ruby-core:31564][Bug #3636]

Sat Jul 31 23:15:27 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_inspect): Pathname#inspect translated
	  from pathname.rb.

Sat Jul 31 15:50:03 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (Init_pathname): The alias,
	  Pathname#to_path, is translated from pathname.rb.

Sat Jul 31 09:12:36 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_to_s): Pathname#to_s translated
	  from pathname.rb.

Sat Jul 31 08:20:07 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/ssl.rb (WEBrick::Utils.create_self_signed_cert):
	  merged r28784 from ruby_1_8: wrongly created dummy SSL certificate
	  with version == 3 (no such version) and serial == 0 (must be >0).

Fri Jul 30 21:43:55 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_hash): Pathname#hash translated
	  from pathname.rb.

Fri Jul 30 12:42:02 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/net/imap.rb (example): use IO#noecho to read password if
	  possible, and defer until needed.  [ruby-dev:41889]

	* lib/net/imap.rb (example): support starttls option.
	  [ruby-dev:41888]

Fri Jul 30 08:51:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): home directory must be absolute.
	  [ruby-core:31537]

Fri Jul 30 08:33:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): should check if could find user.
	  [ruby-core:31538]

Fri Jul 30 07:59:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_add_suffix): fixed a bug returning uninitialized
	  value.

Fri Jul 30 07:48:04 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: use TK_XINCLUDES on tkConfig.sh when not empty,
	  even if MacOS X Aqua version [ruby-dev:41883].

Thu Jul 29 22:28:35 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_cmp): Pathname#<=> translated
	  from pathname.rb.

Thu Jul 29 06:51:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (EXT_SRCS): add ext/json/parser/parser.c.

Thu Jul 29 05:52:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_basename): pass baselen to rmext.

Thu Jul 29 02:38:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: not [freebsd] but [freebsd*] for AS_CASE.

Wed Jul 28 22:23:59 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_eq): Pathname#{==,===,eql?} translated
	  from pathname.rb.

Wed Jul 28 19:37:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): VC6 or later have stddef.h.

	* include/ruby/missing.h: need to include stddef.h for size_t.

	* include/ruby/missing.h: shouldn't declare as dllimport when building
	  ruby itself (for Windows).

Wed Jul 28 17:11:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/*.c: include missing.h

Wed Jul 28 09:38:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* cont.c: typos.

Wed Jul 28 09:24:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c: (RB_PAGE_SIZE): renamed from PAGE_SIZE. [ruby-dev:41870]

	* cont.c: (RB_PAGE_MASK): renamed from PAGE_MASK.

Tue Jul 27 23:09:09 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_taint): use rb_obj_taint.
	  (path_untaint): Pathname#untaint translated from
	  pathname.rb.

Tue Jul 27 18:59:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_framework): added.

Tue Jul 27 18:33:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* defines.h, intern.h, missing.h, ruby.h, st.h, util.h: include
	  config.h and defines.h for autoconf macros.

Tue Jul 27 16:27:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (flo_cmp): typo.

Tue Jul 27 16:09:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* class.c, compile.c, dir.c, file.c, iseq.c, parse.y, random.c:
	  clean unused-value warnings.

	* cont.c, process.c, vm_exec.h: clean cast warnings.

Mon Jul 26 22:34:37 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_taint): Pathname#taint translated from
	  pathname.rb.

Mon Jul 26 18:18:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (config.h): add include guard.

	* win32/Makefile.sub, bcc32/Makefile.sub (config.h): ditto.

Mon Jul 26 14:38:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (XCFLAGS): missing.h needs config.h.

Mon Jul 26 14:08:47 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/missing.h: revert a part of r28727.  config.h is expected
	  to include only once, before including defines.h.
	  including it here breaks some macro definitions.

Mon Jul 26 13:52:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: define BROKEN_CLOSE only on FreeBSD.
	  This needs to merge to 1.9.2.

Mon Jul 26 13:01:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_mark): should mark iseq itself other than normal
	  iseq.  [ruby-dev:41880]

Mon Jul 26 11:51:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: define BROKEN_CLOSE on FreeBSD.
	  This fixes build failure on MSVC. [ruby-core:31481]

	* include/ruby/ruby.h, include/ruby/missing.h:
	  use BROKEN_CLOSE for replacing close(2).

Mon Jul 26 09:51:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_mark): mark only self of normal iseqs, not
	  nodes.  [ruby-dev:41874]

Sun Jul 25 05:37:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_cmp): honor the result of infinite? method of the
	  other.  [ruby-core:31470]

	* test/ruby/envutil.rb (EnvUtil#.suppress_warning): added.

	* test/ruby/test_float.rb (TestFloat#test_Float): suppress
	  warnings under --verbose.

Fri Jul 23 16:07:32 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/mutex_m.rb (sleep): added Mutex_m#sleep to support
	  ConditionVariable.

Fri Jul 23 15:09:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_MINGW32): ignore msvc suffix.

	* configure.in (RUBY_TRY_CFLAGS): try with werror turned on.

Fri Jul 23 09:02:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_expr_str): fixed out-of-boundary access at invalid
	  multibyte characters.

Fri Jul 23 09:00:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (XCFLAGS): reverted mistakenly removed option.
	  [ruby-dev:41872]

	* include/ruby/missing.h: needs ruby/config.h.

Thu Jul 22 20:58:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_EXTERN): unnecessary after all.

Thu Jul 22 17:33:47 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* complex.c (nucomp_to_i): allow complex with imaginary zero to be
	  converted.

	* complex.c (nucomp_to_f, nucomp_to_r): ditto.

Thu Jul 22 20:12:56 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread_pthread.c (get_stack): fix memory leak; pthread_attr_destroy
	  must be called even when pthread_getattr_np is used.
	  [ruby-core:31269]

Thu Jul 22 16:27:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_expr_str): fix broken Regexp#inspect when it
	  is ASCII-8BIT and non-ASCII character.
	  The length of character should be from original byte string.
	  [ruby-core:31431]

Thu Jul 22 14:30:17 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/missing.h: add prototype for ruby_close().

Thu Jul 22 12:58:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_EXTERN): ignore invalid attribute.

	* configure.in: fix for older autoconf.

Thu Jul 22 12:02:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/{intern,io}.h: add missing prototypes.

Thu Jul 22 06:38:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (XCFLAGS): use -fvisibility=hidden if possible.

	* configure.in (RMDIR): use --ignore-fail-on-non-empty if possible.

	* configure.in (RUBY_EXTERN): FUNCTION-BODY was missing.

Thu Jul 22 03:02:55 2010  Eric Hodel  <drbrain@segment7.net>

	* README.EXT: fix signature of rb_ensure and rb_rescue to match
	  implementation.

Wed Jul 21 23:07:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in: get rid of embedding an absolute path.

Wed Jul 21 15:22:17 2010  Evan Phoenix <evan@fallingsnow.net>

	* lib/rubygems/custom_require.rb, gem_prelude.rb: Load code from
	  from gems properly.

Wed Jul 21 15:15:02 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c: add short documentation about named reference.
	  [ruby-core:31294]

Wed Jul 21 15:00:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (local_push_gen): disable unused variable warnings in
	  eval.  [ruby-dev:41869]

Wed Jul 21 13:57:37 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_method.c (rb_method_boundp): revert r28543, r28564.
	  They may be merged in Ruby 2.0. [ruby-core:31217]

Wed Jul 21 13:37:35 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/uri/common.rb: Have URI#route_to, URI#route_from accept
	  string-like arguments [ruby-core:30961]

	* lib/uri/generic.rb: ditto for URI.join, URI#merge

Wed Jul 21 12:39:15 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/cmath.rb (CMath#cbrt): cbrt should accept a negative real
	  numbers.  [ruby-core:31234]

Wed Jul 21 12:31:30 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/uri/common.rb: Have URI() and URI.join accept URI objects in
	  addition to strings. [ruby-core:30960]

Wed Jul 21 11:55:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_hdtoa): renamed from BSD__hdtoa.

Tue Jul 20 11:35:11 2010  Evan Phoenix  <evan@ruby-lang.org>

	* lib/rubygems.rb: Load the custom require if --disable-rubygems
	  was used.

Tue Jul 20 11:27:18 2010  Evan Phoenix  <evan@ruby-lang.org>

	* gem_prelude.rb: Pull in rubygem's custom require

	* lib/rubygems.rb: Handle always having custom require available

Tue Jul 20 18:39:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RSTRING_GETMEM): new macro to get ptr and
	  len at once.

	* string.c (rb_str_cmp, str_eql, rb_str_eql): trivial improvements.

Tue Jul 20 18:23:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/fiddle/closure.c (closure_data_type),
	  ext/fiddle/function.c (function_data_type): rb_data_type_t has
	  changed.

Tue Jul 20 14:21:38 2010  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c: don't call after_gc_sweep() after when garbage_collect()
	  was called, because rb_sweep_method_entry() free live unlinked
	  method entries. [ruby-core:31169]

Tue Jul 20 12:42:06 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/socket/raddrinfo.c (rb_getaddrinfo): according to my
	  valgrind output this variable should be initialized beforehand.

Tue Jul 20 12:50:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_flush_buffer): write and buffer operations should be
	  monolithic.  [ruby-core:31348]

Tue Jul 20 12:27:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::Entry_#copy): check file name
	  separator boundary.  [ruby-core:31360]

Mon Jul 19 18:34:12 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (get_strpath): check the type.
	  (path_initialize): bypass to_path call for T_STRING.
	  (path_freeze): implemented.

	* ext/pathname/lib/pathname.rb (Pathname#freeze): removed.

Mon Jul 19 12:33:29 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_clear): should not unshare embedded array, and
	  should make unshared array embedded.

Mon Jul 19 09:00:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS (Kernel#instance_eval): add an incompatible change since
	  the 1.9.1 release.  [ruby-core:31336]

Mon Jul 19 05:46:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_data_type_t): add new feature macros.

Sun Jul 18 21:20:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_clear): no need to duplicate buffer just before
	  clearing.

Sun Jul 18 16:31:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_data_type_t): restructured.  [ruby-dev:41862]
	  add parent member.

	* error.c (rb_typeddata_inherited_p): new function.

Sun Jul 18 01:09:27 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_initialize): return a value.

Sun Jul 18 00:02:19 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/lib/pathname.rb (Pathname#initialize): removed.

	* ext/pathname/pathname.c (path_initialize): implemented.
	  (get_strpath): new function.
	  (set_strpath): ditto.

Sat Jul 17 19:01:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (MiniTest::Unit#process_args): refactored.

Sat Jul 17 18:30:05 2010  Tanaka Akira  <akr@fsij.org>

	* tool/file2lastrev.rb: don't depend on pathname.rb if File.realpath
	  is available.

Sat Jul 17 14:10:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_add_suffix): fixed type warnings.

Sat Jul 17 13:48:22 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/lib/pathname.rb: moved from lib/pathname.rb.
	  require pathname.so.

	* ext/pathname/pathname.c: new file to define empty Pathname class.

	* ext/pathname/extconf.rb: new file.

Sat Jul 17 13:04:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_wakeup_alive): split from rb_thread_wakeup.
	  merged from r13476.  c.f. [ruby-core:31320]

Sat Jul 17 10:07:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb: MiniTest::Unit is different class from
	  Test::Unit, and install runner before loading test/minitest.

Fri Jul 16 14:58:38 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit.setup_argv): run tests only when
	  any tests have not run.

	* bin/testrb, test/runner.rb: use Test::Unit.start.

Fri Jul 16 12:06:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (ext-arch): prune directories start with '-'.

Thu Jul 15 21:43:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* numeric.c (fix_divide): must not use rb_rational_new1 for coercion
	  because it returns an argument itself when canonical mode is set.
	  [ruby-core:31279]

Thu Jul 15 21:38:31 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (bm_free): fix memory leak.  [ruby-core:30869] [Bug #3466]

Thu Jul 15 15:47:32 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regexec.c (onig_search): don't skip non-ANYCHARs when
	  .* fails to match. This causes to fail matching
	  ANYCHAR_STAR with LOOK_BEHIND. This fix is workaround
	  and disable the optimization. [ruby-dev:41851]

Thu Jul 15 06:11:29 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/rdoc/markup/attribute_manager.rb: fixing ri output when special
	  characters are inside html tags.  Thanks Tomo Kazahaya! [Bug #3512]

Thu Jul 15 06:01:42 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (guess_local_offset): use the UTC offset of an older date on
	  64bit time_t environment.

Thu Jul 15 02:42:51 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/test/unit.rb (setup_argv): convert to using optparse, adding
	  --help and -I. [ruby-core:30154]

Thu Jul 15 00:35:09 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (localtime_with_gmtoff_zone): renamed from
	  localtime_with_gmtoff and return the timezone abbreviation name.
	  (guess_local_offset): return the isdst and timezone abbreviation name.
	  (localtimew): use the returned isdst and timezone abbreviation name.
	  [ruby-core:31275]

Wed Jul 14 20:23:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (frame_func_id), vm_eval.c (rb_iterate),
	  vm_insnhelper.c (vm_yield_with_cfunc): as the name of a C-level
	  block, use the current method ID at the creation point.
	  [ruby-dev:41852]

Wed Jul 14 18:18:05 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regexec.c (match_at): add end point to enclen's argument.
	  This only effect on compiling with -DONIG_DEBUG_MATCH.

Tue Jul 13 21:34:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c: libedit is missing declaration of
	  rl_getc.

Tue Jul 13 21:31:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_daemon): split from proc_daemon.

	* process.c (rb_fork_err): suppress gcc 4.4 warnings.

	* random.c (fill_random_seed): ditto.

Tue Jul 13 21:01:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (establishShell): chfunc must not raise any
	  exceptions.

Tue Jul 13 20:58:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_DEFAULT_ARCH): adjust for target
	  cpu. [ruby-core:31243]

Tue Jul 13 20:46:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/handle.c (rb_dlhandle_close): should not pass a dynamic
	          string to rb_raise directly.

Tue Jul 13 12:04:57 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* missing/close.c: keep original errno.

Mon Jul 12 01:58:56 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/csv.rb: Fix unused variable warnings.
	  Patch by Run Paint [ruby-core:30991]

	* lib/date.rb: ditto

	* lib/debug.rb: ditto

	* lib/drb/drb.rb: ditto

	* lib/drb/invokemethod.rb: ditto

	* lib/irb/ruby-lex.rb: ditto

	* lib/irb/slex.rb: ditto

	* lib/logger.rb: ditto

	* lib/pathname.rb: ditto

Sun Jul 11 21:20:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT{,.ja} (rb_block_call): fixed about third/fourth
	  arguments to the block.  based on [ruby-core:31192] by Asher
	  Haig.  [Bug #3558]

Sun Jul 11 17:01:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in ({,dist-,real-}clean-ext): should also omit
	  semicolon when omitting "in WORDS" of FOR-statement.

	* tool/rmdirs: ditto.

Sun Jul 11 11:07:42 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/rdoc/test_rdoc_ri_driver.rb (test_formatter): add a test.  a
	  patch from caleb clausen in [ruby-core:31182].

Sat Jul 10 21:43:11 2010  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): fix precision handling for
	  %:z and %::z.

Fri Jul  9 22:32:54 2010  Tanaka Akira  <akr@fsij.org>

	* strftime.c: unused declarations removed.

Fri Jul  9 21:20:22 2010  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): clear colons at unknown
	  directive.

Fri Jul  9 21:04:10 2010  Tanaka Akira  <akr@fsij.org>

	* strftime.c: don't call tzset.  strftime.c doesn't depend on
	  the global timezone.

Fri Jul  9 20:30:26 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): 24:00 should be the beginning of the next
	  day even if the leap second, 23:59:60, exists.

Fri Jul  9 01:08:46 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/emitter.rb (initialize): line_width is
	  a valid option passed to the emitter.

	* test/psych/test_psych.rb: corresponding tests.

Fri Jul  9 00:49:46 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/emitter.c (line_width, set_line_width): preferred line may
	  be set on the emitter.

	* test/psych/test_emitter.rb: corresponding tests.

Thu Jul  8 15:47:34 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_conv_enc_opts): fix infinite loop because
	  of ISO-2022-JP conversion with empty string.
	  patched by Brian Buchanan [ruby-core:31107]

Thu Jul  8 08:16:57 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb (push): adding version
	  and header emit options.

	* test/psych/test_psych.rb: corresponding test.

Thu Jul  8 08:01:03 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/emitter.c: updating documentation about emit options

	* ext/psych/lib/psych/core_ext.rb: ditto

	* ext/psych/lib/psych.rb (dump): passing emit options to emitter.

	* ext/psych/lib/psych/nodes/node.rb: ditto

	* ext/psych/lib/psych/visitors/emitter.rb: sending emit options to
	  YAML emitter. [ruby-core:28318]

Thu Jul  8 06:05:58 2010  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): support %:z and %::z.
	  [ruby-dev:41841]

Thu Jul  8 00:15:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* gem_prelude.rb: provide workaround for gem activation.  Currently,
	  gem activation does not work by default.  Now it can be worked
	  around by requiring "rubygems" first.  [ruby-core:29486]
	  a patch from Evan Phoenix in [ruby-core:31096].

	* lib/rubygems.rb: ditto.

Wed Jul  7 10:01:34 2010  Adrian Bloomer  <adrian.bloomer@gmail.com>

	* numeric.c (fix_rev): Replaced fix_rev with '~num | FIXNUM_FLAG'.

Wed Jul  7 13:22:20 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (ruby_find_basename): set correct baselen.

Wed Jul  7 13:02:59 2010  Akinori MUSHA  <knu@iDaemons.org>

	* vm_method.c (rb_method_boundp): respond_to?(:protected_method,
	  true) should return true.  Pointed out by Marc-Andre Lafortune.
	  [ruby-dev:41837]

Wed Jul  7 12:00:24 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (ruby_find_basename): should initialize f.

Wed Jul  7 11:44:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_raise): add invalid header to
	  exceptions.

Wed Jul  7 10:26:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* missing/close.c: ignore ECONNRESET.
	  FreeBSD wrongly sets ECONNRESET on close(2) and
	  it causes false-negative exceptions. [ruby-dev:41778]

	* configure.in: ditto.
Tue Jul  6 22:57:21 2010  Tanaka Akira  <akr@fsij.org>

	* io.c (nogvl_copy_stream_sendfile): jump to retry_sendfile directly
	  to avoid select() on a socket which TCP state is CLOSED.
	  patch by Eric Wong.  [ruby-core:31053]

Tue Jul  6 21:45:34 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io/console/console.c (winsize_row): should return actual screen
	  size, not buffer size.

Tue Jul  6 08:35:58 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/dl/lib/dl/import.rb (handler): add a more helpful error message
	  when calling import_symbol or import_function without calling
	  dlload.  Thanks nobu! [ruby-core:30996]

Tue Jul  6 00:34:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (thread_free): free altstack to prevent memory leak.  a patch
	  from Tomoyuki Chikanaga in [ruby-dev:41815]. [Bug #3537]

Tue Jul  6 00:29:27 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (NONASCII_MASK): NONASCII_MASK must be unsigned.
	  [ruby-dev:41782]

Mon Jul  5 16:05:39 2010  Akinori MUSHA  <knu@iDaemons.org>

	* vm_method.c (rb_method_boundp): Return false for protected
	  methods when called from Kernel#respond_to?. [ruby-dev:40461]

Mon Jul  5 12:32:01 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb (parse_string): support
	  timezones that are not one hour off. [ruby-core:31023]

	* ext/psych/lib/psych/visitors/yaml_tree.rb: ditto

Sun Jul  4 22:49:54 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_syntax.rb: split test_syntax from test_system.rb.

Sun Jul  4 22:02:02 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_system.rb (test_syntax): unified with test_syntax2.

Sun Jul  4 21:00:39 2010  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_system.rb (test_syntax2): moved from sample/test.rb
	  [ruby-dev:41721]

Sun Jul  4 17:13:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (swallow, prepare_getline_args, rb_io_getline_1): fix for
	  paragraph mode reading in non-ascii-compatible encoding.
	  [ruby-dev:41803]

Sat Jul  3 16:14:10 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal): add two new constants
	  BigDecimal::INFINITY and BigDecimal::NAN.

	* ext/bigdecimal/lib/bigdecimal/math.rb (BigMath.exp): modify the
	  behaviors for infinity arguments as same as Math.exp.

Sat Jul  3 09:47:26 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb(visit_Psych_Nodes_Scalar):
	  teaching Psych to deserialize DateTime objects. [Bug #1390]

	* ext/psych/lib/psych/visitors/yaml_tree.rb(visit_DateTime): added a
	  method for serializing DateTime objects.

	* ext/psych/lib/psych/scalar_scanner.rb(parse_time): add method for
	  parsing times objects from a string.

	* test/psych/test_date_time.rb: tests for dumping DateTime objects.

Sat Jul  3 09:13:55 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb (visit_Time): use
	  Time#nsec to accurately serialize time objects. [ruby-core:29233]

Fri Jul  2 23:30:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (argf_inplace_mode_set): prohibits an assignment of a tainted
	  value.

	* file.c (ruby_find_basename, ruby_find_extname): split from
	  rb_file_s_basename() and rb_file_s_extname().

	* util.c (ruby_add_suffix): support arbitrary length of the suffix
	  to get rid of the potential buffer overflow.
	  reported by tarui.

Fri Jul  2 05:31:51 2010  Tanaka Akira  <akr@fsij.org>

	* numeric.c (rb_num2long): accept LONG_MAX < x < LONG_MAX+1 and
	  LONG_MIN-1 < x < LONG_MIN as well because they are converted
	  into the valid range of long by truncation.
	  (rb_num2ulong): accept ULONG_MAX < x < ULONG_MAX+1 and
	  LONG_MIN-1 < x < LONG_MIN as well.
	  (rb_num2ll): accept LLONG_MAX < x < LLONG_MAX+1 and
	  LLONG_MIN-1 < x < LLONG_MIN.

Thu Jul  1 23:10:25 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Improving documentation.

Thu Jul  1 22:15:01 2010  Tanaka Akira  <akr@fsij.org>

	* numeric.c (rb_num2ulong): fix the lower limit for float.
	  [ruby-dev:41361]

Thu Jul  1 21:37:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (EnvUtil#invoke_ruby): integrated with
	  runexec.

Thu Jul  1 16:19:53 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (thread_start_func_1): don't call
	  native_thread_init_stack(th) on cygwin to avoid the segv
	  introduced by r27789. Cygwin's signal implementation is half
	  baked so USE_SIGNALSTACK is not defined and it needs another
	  treatment.

Thu Jul  1 13:00:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (test-knownbug): ignore known bugs.

Thu Jul  1 08:40:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object): suppress empty instance variable entry on
	  compatible dump objects.

Wed Jun 30 07:29:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (test_script_from_stdin): by using
	  a pipe, get rid of not-well-defined behavior after the child
	  process terminated in pty.

Wed Jun 30 02:30:26 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* thread_pthread.c (get_stack): use pthread_getthrds_np() for AIX.

	* configure.in: ditto.

Tue Jun 29 21:11:15 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* ext/stringio/stringio.c (strio_write): add RB_GC_GUARD.

Tue Jun 29 19:39:59 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_method.rb (is_ruby64): check
	  ruby binary is mswin64 or mingw64. [ruby-dev:41756]

Tue Jun 29 14:18:21 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (rb_realpath_internal, realpath_rec): skip UNC share root
	  on DOSISH platforms.
	  http://pc12.2ch.net/test/read.cgi/tech/1272248179/600

Tue Jun 29 11:52:33 2010  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (unlink_heap_slot, slot_sweep): unlink heaps_slot of
	  heaps_slot linked list if heaps_slot is empty at slot_sweep.
	  fixed [ruby-dev:41543], [ruby-core:24894].

Tue Jun 29 01:22:08 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/fiddle.h: added FFI type detection to avoid bug in ffi
	  header files. Thanks Yugui! [ruby-core:30917]

Mon Jun 28 22:14:22 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/rdoc/test_rdoc_ri_driver.rb (TestRDocRIDriver#test_formatter):
	  fix a test accordingly to r28455.

Mon Jun 28 21:56:14 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (rb_fd_resize, rb_fd_copy): avoid NULL dereference upon
	  failed realloc by using xrealloc instead of not realloc.  a patch
	  from Jim Meyering <meyering at redhat.com> in [ruby-core:30920]
	  [Bug #3489]

Mon Jun 28 20:32:33 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_method.rb (test_offset_vtbl): check
	  that Ruby is 32bit or 64bit binary in order to get correct offset
	  value. [ruby-dev:41741]

Mon Jun 28 05:32:51 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rdoc/ri/driver.rb (RDoc::RI::Driver#formatter): should use bs
	  format when stdout is piped.  [ruby-core:30734]

Mon Jun 28 03:12:03 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* bootstraptest/test_class.rb: add a test for [ruby-core:30843].

Mon Jun 28 02:43:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c (rb_mod_init_copy): when class is dup'ed, a metaclass of the
	  class should be attached to the dup'ed class, not the original
	  class.  [ruby-core:30843] [Bug #3461]

Sun Jun 27 23:31:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h, io.c: reverted r21709.

	* ruby.c (load_file_internal): nothing to read if EOF reached
	  while reading shebang.  [ruby-core:30910]

Sun Jun 27 13:25:07 2010  Tanaka Akira  <akr@fsij.org>

	* io.c (simple_sendfile): don't try to send data more than SSIZE_MAX
	  with single sendfile call..
	  based on the patch by Eric Wong.  [ruby-core:30908]

Sun Jun 27 10:41:38 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/require_paths_builder.rb (write_require_paths_file_if_needed):
	  no reason that bin directory should be included in $LOAD_PATH.
	  it is for executable files, but not libraries.  [ruby-core:25936]

Sat Jun 26 13:07:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (enable-debug-env): option for RUBY_DEBUG env.

Sat Jun 26 11:56:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (clear-installed-list): put redirection before set
	  command, since it seems to be handled by nmake in special way.
	  [ruby-dev:41711]

Sat Jun 26 10:08:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (EnvUtil#invoke_ruby): no needs to copy the
	  original ENV, since it's done in spawn automatically.
	  [ruby-dev:41733]

Sat Jun 26 08:44:22 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* NEWS (zlib): new methods.  [ruby-dev:41706] [Bug #3472]

Sat Jun 26 07:59:18 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_method.rb (test_offset_vtbl): check
	  that OS is Windows 32bit or Windows 64bit in order to get
	  correct offset value.

Sat Jun 26 04:39:12 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* ext/dl/lib/dl/func.rb (call): don't overwrite original arguments
	  to defend from GC.
	* test/dl/test_func.rb (test_string): add test for above.

Fri Jun 25 11:45:36 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Fixing a bug that prevented CSV from parsing
	  all multi-line fields correctly.  Patch by Rob Biedenharn.

Fri Jun 25 10:07:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (Test::Unit::Assertions#assert_in_out_err):
	  return the exit status.

	* test/ruby/envutil.rb (EnvUtil#invoke_ruby): change the
	  environment of spawned process only.

	* test/ruby/envutil.rb (EnvUtil#invoke_ruby): get rid of possible
	  deadlock.

Fri Jun 25 06:24:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/un.rb (httpd): MaxClients also should be integer.
	  [ruby-dev:41724] [Bug #3477]

	* lib/un.rb (setup): fix of word splitting.  [ruby-dev:41723]
	  [Bug #3476]

Fri Jun 25 01:07:17 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* include/ruby/ruby.h (static inline rb_gc_guarded_ptr): prevent
	  RB_GC_GUARD_PTR being removed by optimization.

Thu Jun 24 06:22:27 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (ruby_getaddrinfo__darwin): the workaround
	  for Mac OS X moved from rsock_getaddrinfo.

Thu Jun 24 05:44:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (struct dump_arg, struct load_arg): merge taint and
	  untrust flags into infection as bit flags.

	* marshal.c (w_nbyte, clear_dump_arg): infect the buffer as soon
	  as appending, because it might have been finalized already at
	  exit.  based on a patch by Tomoyuki Chikanaga
	  at [ruby-dev:41672].  [Bug #3463]

Wed Jun 23 23:49:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (str_is_number): renamed from str_isnumber to
	  avoid confusion to str_isnumber in ext/socket/getaddrinfo.c.

Wed Jun 23 23:45:31 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* NEWS (stringio): new methods.  [ruby-dev:41687] [Bug #3469]

Wed Jun 23 22:52:00 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c: don't use __P.

Wed Jun 23 21:32:08 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (reg_get_typelib_file_path): try win64
	  registry entry at first. [ruby-dev:41674] [Bug #3464]

Wed Jun 23 21:17:32 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (ruby_getaddrinfo__darwin): new workaround for
	  getaddrinfo problem on Mac OS X Snow Leopard.  [ruby-core:29427]
	  patch by Wataru Kimura.  [ruby-core:30842]

Wed Jun 23 17:12:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS (ptr): new method and deprecated methods.  [ruby-dev:41681]

	* ext/pty/{README,README.ja}: ditto.

	* ext/pty/pty.c (pty_check): add rdoc.

Wed Jun 23 12:44:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_regexp.rb (test_dup_warn): read in UTF-8
	  encoding regardless environment.

	* test/ruby/envutil.rb (invoke_ruby): add encoding option.

Wed Jun 23 06:44:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (fchown): need to check.  a patch by Eric Wong
	  at [ruby-core:30818].

	* io.c (argf_next_argv): check for setting owner/group.

Tue Jun 22 23:10:10 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (num_exact): fix for mathn.  [ruby-dev:41599]

Tue Jun 22 22:00:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb: suppress warnings.

Tue Jun 22 21:33:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/optparse/test_summary.rb: fixed superclass so that it run
	  solely.

Tue Jun 22 19:57:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (shadowing_lvar_gen): should add lvar to vars and
	  used.  [ruby-dev:41666]

Tue Jun 22 13:23:13 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/delegate.rb: Forward #trust, #untrust, #taint and #untaint
	  to both the delegator and __getobj__ [ruby-core:26138]

Mon Jun 21 23:41:08 2010  wanabe  <s.wanabe@gmail.com>

	* eval_error.c (error_print): clear raised_flag while error-printing
	  to avoid hang. [ruby-core:27608]

	* test/ruby/test_beginendblock.rb (test_endblock_raise): add test for
	  above.

Sun Jun 20 16:17:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* id.c (Init_id): add underscore name.

	* parse.y (warn_unused_var): ignore underscore name.

	* parse.y (warn_unused_var): use same format as shadowing local
	  variable.

	* parse.y (shadowing_lvar_gen): get rid of adding extra name for
	  shadowing local variable.  [ruby-dev:41628]

Sat Jun 19 11:11:37 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb.rb: remove double exclamation marks.  a patch from Diego
	  Viola.  [ruby-core:30589]

Sat Jun 19 03:35:58 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb (resolve_klass): fix the
	  exception message when attempting to load an unknown class.  Thanks
	  nobu! [ruby-dev:41399]

	* test/psych/test_psych.rb: test for the exception message

Fri Jun 18 10:37:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (gc_lazy_sweep): clean a warning.
	  "suggest parentheses around assignment used as truth value"

	* transcode_data.h (getGB4bt1): clean a warning.
	  "suggest parentheses around arithmetic in operand of |"

	* transcode_data.h (getGB4bt3): ditto.

	* vm.c (thread_free): clean a warning. "format 'p' expects type
	  'void *', but argument 3 has type 'struct rb_mutex_struct *'"

Fri Jun 18 10:15:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c: add prototype of rb_realpath_internal.

	* load.c: ditto.

Fri Jun 18 01:50:21 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* object.c: Object#public_methods, private_methods, etc. returns
	  method ids that belong to the class or the singleton class(es) of
	  the object.  [ruby-dev:41613]

	* class.c: on the other hand, Module#public_instance_methods, etc.
	  returns method ids that belong to the module itself (even if the
	  module is singleton, it does not return method ids of super
	  class(es); see [ruby-core:28837]).

Fri Jun 18 01:22:55 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/webrick/httpservlet/filehandler.rb
	  (prevent_directory_traversal): apply filesystem encoding to path
	  only during calling File.expand_path.  [ruby-dev:41423]

Thu Jun 17 23:20:14 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* load.c (rb_load_internal): remove call to rb_realpath_internal
	  within rb_load_internal which caused big performance degradation.
	  Instead, call rb_realpath_internal in the caller of
	  rb_load_internal.  [ruby-dev:41502] [ruby-dev:41610]

	* vm.c (rb_vm_call_cfunc): ditto.

	* eval_intern.h (rb_vm_call_cfunc): ditto.

	* ruby.c (process_options): ditto.

Thu Jun 17 18:37:47 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (rb_str_encode_ospath): when the encoding of the parameter
	  is ASCII-8BIT, should recognize as filesystem encoding, and convert
	  to UTF-8 on Windows.

	* file.c (realpath_rec): should convert to ospath encoding before
	  calling lstat().

	* file.c (rb_realpath_internal): resolved string should take over
	  the encoding of base string.

	* transcode.c (rb_str_encode): should return new string always.
	  fixed #3444.

Wed Jun 16 18:34:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y: ripper needs warn_unused_var(), too.

Wed Jun 16 18:20:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (warn_unused_var): warn unused variables.
	  [ruby-dev:41620]

Wed Jun 16 15:40:53 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* error.c (rb_bug): existence of _set_abort_behavior() depends on
	  runtime version, not compiler version.

Wed Jun 16 01:38:40 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/fiddle/extconf.rb: check ffi.h even when pkg-config succeeded.
	  On Debian/lenny, which is a "supported" platform, ffi.h is installed
	  in /usr/include/i486-linux-gnu/.  This causes build error when using
	  gcc whose target is not i486-linux-gnu.

Wed Jun 16 00:04:38 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_io.rb (safe_4): does not use Timeout because
	  Timeout.timeout uses Thread#kill which raises SecurityError when
	  $SAFE == 4.  based on a patch from Tomoyuki Chikanaga.
	  [ruby-dev:41484]

	* test/ruby/test_io.rb (test_print_separators): use pipe (test helper
	  method) instead of IO.pipe.  [ruby-dev:41484]

Tue Jun 15 17:14:58 2010  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/fiddle/extconf.rb: De Morgan's laws.

Tue Jun 15 12:09:00 2010  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/fiddle/extconf.rb: use pkg_config to find ffi.h.

Tue Jun 15 02:31:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.mk (clean-ext, clean-enc): clean up cleaning
	  targets.

Mon Jun 14 22:36:09 2010  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_socket.rb (test_udp_server): rescue Errno::ENOSYS
	  for Windows.

	* test/socket/test_nonblock.rb (test_sendmsg_nonblock_error): ditto.

	  [ruby-dev:41597] reported by Masaya Tarui.

Mon Jun 14 17:44:39 2010  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: raise DRbConnError instead of ArgumentError if too
	  many arguments. [ruby-dev:41481]

	* test/drb/test_drb.rb: ditto.

	* test/drb/drbtest.rb: ditto.

Mon Jun 14 04:03:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/fiddle/closure.c (dealloc): refix workaround r28300.
	  don't use ffi_closure_alloc, ffi_prep_closure_loc and
	  ffi_closure_free on MACOSX and __linux__.
	  [ruby-dev:41483] [ruby-dev:41214]

Sun Jun 13 15:46:07 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rubyoptions.rb: add a simple test for __END__ and
	  DATA.

Sun Jun 13 04:24:18 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/delegate.rb: Delegate !=, eql? and hash [ruby-core:26139]

Sun Jun 13 02:12:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf8_mac.trans (buf_apply): fix for patterns
	  whose result is 2 bytes. [ruby-core:30751]

Sun Jun 13 01:38:17 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* time.c (rb_localtime_r2): fix mixed declarations and code.

Sun Jun 13 00:27:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl/lib/dl.rb: don't require when already loaded.

Sun Jun 13 00:02:56 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/fiddle/closure.c (dealloc): workaround fix for libffi's
	  ffi_closure_free. [ruby-dev:41483] [ruby-dev:41214]

Sat Jun 12 10:02:26 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_syscall): should check argument string taint before
	  invoking system calls.

Sat Jun 12 09:18:31 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (uninitialized_constant): process through
	  rb_class_real() to remove "Object::" from error message.
	  [ruby-dev:40951]

Sat Jun 12 00:38:37 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/dbm/extconf.rb: accept Berkley DB version 3, 4 and 5.
	  a patch from Takahiro Kambe.  [ruby-dev:41531]

Fri Jun 11 23:21:35 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (init_leap_second_info): check the result of
	  gmtime_with_leapsecond.

Fri Jun 11 23:04:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_sslctx_get_ciphers):
	  use sk_SSL_CIPHER_num and sk_SSL_CIPHER_value instead of cast.
	  patched by Takahiro Kambe [ruby-dev:41530]

Fri Jun 11 22:59:31 2010  Tanaka Akira  <akr@fsij.org>

	* include/ruby/missing.h (isnan): fix compilation error on OpenBSD.

Fri Jun 11 22:39:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rubygems/install_update_options.rb
	  (Gem::InstallUpdateOptions#add_install_update_options): deprecate
	  --test option which has not worked.  [ruby-core:21714]

	* test/rubygems/test_gem_command_manager.rb: ditto.

Fri Jun 11 07:34:25 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): test the result of LOCALTIME.

Fri Jun 11 00:42:45 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (rb_localtime_r2): fix localtime overflow check.

Thu Jun 10 23:05:44 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (rb_localtime_r2): refine localtime overflow check for
	  FreeBSD 6.4.

Thu Jun 10 09:10:08 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_putc): documentation updated to mention putc would
	  not work well with multi-byte characters.  [ruby-core:30697]

	* io.c (rb_f_putc): ditto.

Wed Jun  9 22:51:50 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): always extrapolate from past.
	  [ruby-core:30672] reported by Benoit Daloze.

Wed Jun  9 22:13:08 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (calc_tm_yday): extracted from timegmw_noleapsecond.

Tue Jun  8 06:27:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gem_prelude.rb: load full rubygems at LoadError for activation
	  check.  [ruby-core:29486]

Tue Jun  8 06:04:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (parse_mode_enc): set set_by_bom bit.  [ruby-core:30641]

Sun Jun  6 22:37:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_buf_cat_escaped_char): get rid of buffer
	  overflow on platforms int is bigger than 32bit, and warnings.

Sun Jun  6 19:55:21 2010  Tanaka Akira  <akr@fsij.org>

	* array.c (rb_ary_product): clear uninitialized elements in temporary
	  array.

Sun Jun  6 12:31:57 2010  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c: set_heaps_increment is not
	  called before gc_marks of lazy sweeping because live_num not
	  contain finalize objects. So call set_heaps_increment after lazy
	  sweeping if free_num are not enough. And move free_min to struct
	  rb_objspace for above.  [ruby-dev:41499]

Sun Jun  6 10:44:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_product): need to set the length in order to get
	  the entries marked.  [ruby-dev:41540]

Sun Jun  6 08:26:01 2010  Tanaka Akira  <akr@fsij.org>

	* vm.c (Init_BareVM): call Init_native_thread here.

	* thread.c (Init_Thread): don't call Init_native_thread.

	* thread_pthread.c (Init_native_thread): exported.

	* thread_win32.c (Init_native_thread): ditto.

	[ruby-dev:41536]

Sun Jun  6 08:21:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS: Enumerable#join has been reverted.  [ruby-core:30604]

Sat Jun  5 20:30:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_expr_str): ASCII incompatible strings
	  must always escape or converted.

	* re.c (rb_reg_expr_str): use rb_str_buf_cat_escaped_char
	  when resenc is given: for Regexp#inspect or error message.

	* re.c (rb_reg_desc): add 'n' for ENCODING_NONE.

Sat Jun  5 01:20:14 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (sym_inspect): Escape when the symbol is not
	  resulted encoding and not ascii_only. It had escaped
	  ascii-incompatible string, but it is wrong.

Sat Jun  5 01:10:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_buf_cat_escaped_char): defined.
	  Splited from rb_str_inspect.

Sat Jun  5 16:39:13 2010  Tanaka Akira  <akr@fsij.org>

	* .gdbinit (rp): show type name for RTypedData.

Sat Jun  5 15:59:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options, load_file_internal): $0 seen from
	  required libraries by -r option should be the main script.
	  [ruby-core:23717]

Sat Jun  5 15:15:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (EnvUtil#invoke_ruby): support for child
	  process env.

Sat Jun  5 14:11:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/net/imap/test_imap.rb (test_exception_during_shutdown):
	  need to raise always.

Sat Jun  5 13:13:30 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb (eql?, ==, minor): Fix bugs when comparing/returning
	  some empty matrices.

Sat Jun  5 11:00:48 2010  Tanaka Akira  <akr@fsij.org>

	* error.c (rb_name_err_mesg_new): guard mesg, recv and method.
	  The problem in [ruby-dev:41464] is caused because mesg is collected.

Sat Jun  5 10:03:31 2010  Tanaka Akira  <akr@fsij.org>

	* .gdbinit (rp): detect and show RTypedData.

Sat Jun  5 08:30:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_f_test): 'W' should test writable by real uid/git,
	  not world writable.   [ruby-core:30587]

Sat Jun  5 06:20:57 2010  Eric Hodel  <drbrain@segment7.net>

	* dir.c: Clarification of what '*' matches.  Patch by John Wells
	  <john.wells at greatworx.com>

Fri Jun  4 10:46:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_inspect): should taint the result.
	  [ruby-dev:41533]

Fri Jun  4 09:37:15 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (gc_sweep): suppress a warning on VC, again.

Thu Jun  3 23:34:55 2010  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest/hmac.rb: Emit a deprecation warning in
	  verbose mode and add a caution to the overview section of the
	  document. [ruby-dev:41525]

Thu Jun  3 19:33:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_inspect): suppress warnings by
	  rb_sprintf.

	* ext/dl/cptr.c (rb_dlptr_s_malloc): suppress warnings.

Thu Jun  3 18:58:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (ruby_init_ext): statically linked extensions have no
	  real path.  [ruby-dev:41526]

	* vm.c (rb_vm_call_cfunc): add filepath argument.

Thu Jun  3 18:17:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rake/test_win32.rb (Rake::TestWin32): update tests.
	  [ruby-core:30309]

	* test/io/nonblock/test_flush.rb (test_flush): try pipe and
	  socketpair.  [ruby-dev:41517]

Thu Jun  3 09:36:43 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/dl.h (DLSTACK_TYPE): type of stack is same as VALUE.
	  reported by sakiyama shin in [ruby-dev:41514]

Thu Jun  3 06:30:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_path.rb (test_path): workaround for drive
	  letter.

	* test/ruby/test_path.rb (test_path): get rid of blocking on
	  access to non-existent host.

Thu Jun  3 05:37:46 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* tool/rbinstall.rb (install-bin): Allow bin/* install from dot-dirs.
	  Fixes rvm and multiruby installations.

Thu Jun  3 01:22:45 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fix typo and race condition.

Thu Jun  3 00:58:45 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/dl/lib/dl/cparser.rb (parse_ctype): add backwards compatibility
	  by supporting "uint" types in the c parser. [ruby-core:29750]
	* test/dl/test_cparser.rb: adding a test for "uint" changes.

Wed Jun  2 11:40:02 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (iseq_compile_each): should consider block on stack,
	  if block argument is passed.  [ruby-core:30534]

	* parse.c (arg_concat_gen): should append to nd_head, not to
	  nd_iter for NODE_BLOCK_PASS.

Tue Jun  1 23:12:06 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (unescape_nonascii): \P{FOO} is also Unicode property in
	  regexp. [ruby-core:30540]

Tue Jun  1 21:29:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: adding support to rfc5789 patch verb.
	  Added a Net::HTTP::Patch class which expects a message body
	  and response body. It recycles the post method into a patch one,
	  that will send the encoded representation to the server.
	  Summarizing, a new class has been created, the post method
	  extracted into send_entity, including a new argument,
	  which defines which class to use (Post or Patch) and
	  finally a patch method was created. [ruby-core:30426]
	  Patched by Guilherme Silveira
	  <guilherme.silveira AT caelum.com.br>

Tue Jun  1 03:46:08 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/extconf.rb: reject GPLv3 readline. [ruby-dev:39172]
	  [ruby-core:25272] [ruby-dev:39167] [ruby-core:28736]

Tue Jun  1 01:14:31 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* io.c (pipe_open): add RB_GC_GUARD.
	  This caused failure when test/ruby/test_argf.rb is executed with
	  GC.stress = true in mswin32_90

Mon May 31 23:44:22 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: use tclConfig.sh/tkConfig.sh when frameworks
	  are enabled on MacOS X.

	* ext/tk/stubs.c: dirty hack for frameworks and stubs on MacOS X.

	* ext/tk/lib/tk.rb: stop creating a dummy Tcl/Tk interpreter.
	  And hide a root window before starting eventloop. (for ruby 1.9)

	* ext/tk/tcltklib.c: add codes to support Ruby/Tk-Kit (Rubykit).

Mon May 31 21:49:42 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS::Requester#request): rescue ECONNRESET
	  for Windows.  reported by U.Nakamura.  [ruby-dev:41477]

Mon May 31 19:25:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regparse.c (onig_syntax_warn): do not use external strings as
	  printf format.

Mon May 31 18:22:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-set-encoding): skip shebang line
	  always regardless of ruby.

Mon May 31 15:07:18 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_expand_path): Refix r28102: this breaks
	  r28039. test for [ruby-dev:41429] is added. [ruby-core:30516]

Mon May 31 14:47:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): inspect as ASCII when the codepoint
	  of a character in Unicode string is ASCII printable one.

Mon May 31 13:44:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_unicode_p): check the encoding is Unicode
	  or not by the name; not function's pointer. [ruby-dev:41479]

Mon May 31 04:03:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): check if expanded dname encoding is
	  compatible with fname, not just copying.  [ruby-core:30516]

	* test/ruby/test_beginendblock.rb (test_endblockwarn): needs
	  encoding comment.

Mon May 31 02:17:54 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (defined): respond_to_missing? may not be available
	  (for BasicObject instances).

Mon May 31 01:43:42 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/delegate: Delegator: combine (public|protected) methods with
	  those of the delegated object. [ruby-core:27224]
	  DelegateClass: combine (public|protected) instance methods
	  with those of the delegated superclass.

Sun May 30 22:18:49 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/set.rb (keep_if, select!): New methods [ruby-core:29749]

Sun May 30 21:51:59 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/rake/test_application.rb: update a test because of r28089.

Sun May 30 21:48:07 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/tempfile.rb (Tempfile#unlink): leave @data.  Assigning nil to
	  @data caused double closing error of the same IO in finalizer.  a
	  patch from Simon Nicholls.  [ruby-core:29395]

Sun May 30 18:47:15 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: updated to b856dd07.
	  this cleans warnings.

Sun May 30 18:25:55 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* load.c (load_failed): use more accurate error message.
	  [ruby-core:23851]

Sun May 30 16:54:34 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* file.c (rb_file_directory_p): update rdoc.  a patch from Ilkka
	  Laukkanen.  [ruby-core:30016]

Sun May 30 14:59:13 2010  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (gc_mark_all_clear): don't call obj_free() in
	  gc_mark_all_clear(), because obj_free() may make T_ZOMBIE
	  objects.

	* gc.c (gc_clear_mark_on_sweep_slots): renamed.

	* gc.c (rb_objspace_call_finalizer): call
	  gc_clear_mark_on_sweep_slots() before calling mark_tbl().
	  [ruby-dev:41459]

Sun May 30 03:40:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_utf8, parser_tokadd_string): allow NUL
	  containing symbol literals, as well as String#to_sym.
	  [ruby-dev:41447]

Sun May 30 03:03:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/generator/template/darkfish/classpage.rhtml:
	  fix encoding value of XML declaration. [ruby-dev:41452]

Sun May 30 02:20:26 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* thread.c (RB_GC_SAVE_MACHINE_CONTEXT), gc.c (ruby_gc_stress_start):
	  revert r28078.

Sun May 30 02:21:34 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/zlib/zlib.c (zstream_append_input2): add RB_GC_GUARD.
	  This caused failure when test/csv is executed with GC.stress = true.

Sun May 30 01:25:48 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* thread.c (RB_GC_SAVE_MACHINE_CONTEXT): start GC
	  by switching the thread if gc_stress == true

	* gc.c (ruby_gc_stress_start): ditto.

Sun May 30 00:02:39 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (force_chain_object, rb_objspace_call_finalizer): delete
	  finalizer entry after corresponding finalizer is executed.
	  This caused SEGV when test/cgi is executed with GC.stress = true.

Sat May 29 23:30:33 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (str_replace_shared): change embedded state atomically.
	  [ruby-core:29953] [ruby-dev:41456]

Sat May 29 12:56:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_filesystem_encindex): avoid infinite require
	  loop. [ruby-core:30467]

Sat May 29 12:05:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb (RDoc#read_file_contents): take care of BOM.
	  [ruby-dev:41452]

Sat May 29 10:12:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (GC_PROF_TIMER_STOP): regularize `marked' to suppress
	  warnings.

Sat May 29 09:34:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb: fix for --disable-gems.

Sat May 29 09:04:06 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS::Requester#request): rescue ECONNREFUSED.

Sat May 29 08:46:29 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (allocate_sorted_heaps, before_gc_sweep, gc_sweep): removed
	  unused variables.

Fri May 28 20:35:21 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (blocking_region_begin): avoid RUBY_VM_CHECK_INTS()
	  call during GVL state transition. [Bug#3354] [ruby-dev:41435]

Fri May 28 19:37:47 2010  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c: use simple lazy sweep algorithm for response performance
	  gain. See [ruby-dev:41067].

	* object.c: FL_MARK of some objects by lazy sweep is copied when
	  RVALUE is cloned. These objects are not marked in the mark phase.
	  So delete FL_MARK.

	* class.c: ditto.

Fri May 28 18:39:38 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_inspect): escape ASCII-compatible strings.

	* string.c (rb_str_inspect): escape ASCII-compatible strings.

Fri May 28 17:34:48 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* array.c (rb_ary_product): Use tmpary instead, to ensure marking
	  arrays by GC.

Fri May 28 11:40:07 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* array.c (rb_ary_product): Do not rely on GC, t0 should be
	  checked explicitly.

Fri May 28 10:40:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (checking_for): ignore toplevel.

Fri May 28 00:47:16 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* error.c (rb_bug): suppress the error report dialog if report_bug()
	  is finished successfully.

Fri May 28 00:32:25 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* insns.def (invokesuper): check consistency between class of self and
	  class of method being invoked by super.  This is temporary measure
	  for YARV.  See [ruby-core:30313] in detail.  See [ruby-dev:40959]
	  [ruby-dev:39772] [ruby-core:27000] [ruby-core:27230]

	* vm_insnhelper.c (vm_search_superclass): ditto.

Thu May 27 23:38:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (rb_home_dir): set filesystem encoding.

Thu May 27 23:29:18 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_expand_path): set encoding as the same of fname
	  when _result_ is not filesystem encoding. [ruby-dev:41429]

Thu May 27 23:07:45 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_expand_path): use rb_enc_associate_index and
	  rb_filesystem_encindex. Strings related FileSystem should
	  have filesystem_encoding.

	* file.c (SET_EXTERNAL_ENCODING): removed.

Thu May 27 23:03:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/encoding.h (rb_filesystem_encindex): defined.

	* include/ruby/encoding.h (rb_locale_encindex): ditto.

	* encoding.c (rb_filesystem_encindex): remove static.

	* encoding.c (rb_locale_encindex): ditto.

Thu May 27 22:34:27 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): call ReadFile() with len = 0 before
	  reading really on console, because the first ReadFile() call after
	  PeekConsoleInput() always returns broken data. (Windows's bug).
	  [ruby-core:29018]

Thu May 27 12:42:23 2010  Akinori MUSHA  <knu@iDaemons.org>

	* LGPL: Removed.  We no longer have LGPL'd source files in our
	  tree.

Wed May 26 20:19:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_rand): add the result of random to the
	  beginning of range, not the opposite.  [ruby-dev:41415]

Wed May 26 19:55:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (file_expand_path): revert a part of r22392. it's commit miss.

Wed May 26 18:40:23 2010  Masaya Tarui  <tarui@ruby-lang.org>

	* test/rinda/test_rinda.rb (TupleSpaceTest, TupleSpaceProxyTest):
	  kill a used thread at teardown.  [ruby-dev:41397]

Wed May 26 12:08:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_rand): subtraction method of non-numeric can
	  return Float.  [ruby-dev:41410]

Wed May 26 11:50:09 2010  Eric Hodel  <drbrain@segment7.net>

	* marshal.c (Init_marshal): document marshal_dump and marshal_load.

Wed May 26 10:35:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_large_fd_select): needed on mingw, even
	  though fd_mask is not available.  [ruby-core:30401]

Tue May 25 14:00:51 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (add_code_range_to_buf0): fix false negative
	  warning when given range is just before previous range.
	  [ruby-dev:41406]

Tue May 25 16:37:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el (ruby-style-version): take revision if
	  keyword is expanded. [ruby-dev:41408]

Tue May 25 13:26:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/vm.h, include/ruby/encoding.h: add external
	  linkage.

Tue May 25 01:46:49 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_f_caller): update rdoc.  a patch from Nobuhiro IMAI
	  <nov at yo.rim.or.jp> in [ruby-dev:41387].

Mon May 24 23:04:41 2010  Tanaka Akira  <akr@fsij.org>

	* error.c: fix wrong exception class name in rdoc.

Mon May 24 19:00:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (warn_balanced, parser_yylex): no warnings after closing
	  parens.

Mon May 24 12:52:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (change), tool/change_maker.rb: make a brief template
	  for ChangeLog.

Mon May 24 09:19:59 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (gc_sweep): suppress a warning on VC.

Mon May 24 08:16:02 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_f_spawn): use correct command name for the error
	  message.  [ruby-dev:41395]

Sun May 23 17:48:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/lib/openssl/x509-internal.rb, lib/forwardable.rb,
	  lib/irb/cmd/fork.rb, lib/mutex_m.rb,
	  lib/shell/process-controller.rb, lib/sync.rb, object.c:
	  suppress warnings patched by Benoit Daloze at [ruby-core:30366].

	* parse.y (warn_balanced): no warning for singleton class.
	  [ruby-core:30366]

Sun May 23 16:56:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (CONST_ID_CACHE, rb_intern_const): suppress
	  warnings with -Wconversion.

Sun May 23 07:08:34 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/stream.rb: adding a JSON streaming API

	* ext/psych/lib/psych/stream.rb: ditto

	* ext/psych/lib/psych.rb: using autoload

	* ext/psych/lib/psych/json.rb: ditto

	* ext/psych/lib/psych/json/tree_builder.rb: refactor

	* ext/psych/lib/psych/visitors/json_tree.rb: refactor

Sat May 22 03:53:05 2010  Satoshi Shiba  <shiba@rvm.jp>

	* cont.c (fiber_setcontext): Use swapcontext() instead longjmp().
	  [ruby-dev:41316] [Bug #3295]

Fri May 21 19:11:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/nkf/nkf.c (rb_nkf_convert, rb_nkf_guess): check too huge
	  string.

Fri May 21 18:12:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_intern): C90 needs nonempty macro
	  arguments.

Fri May 21 13:55:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBYARG_SHARED): shared library will not be
	  created unless enable-shared.

	* ruby.c (ruby_init_loadpath_safe): use real path for non-shared
	  build.

Fri May 21 12:25:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_float): use dtoa directly instead of stripping
	  needless trailing .0.

	* numeric.c (flo_to_s): reverted.  [ruby-dev:41341]

Fri May 21 01:06:05 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (subtract_tv): if the rest is zero, should finish waiting
	  immediately.

	* win32/win32.c (subtract): ditto.
	  based on a patch from Roger Pack in [ruby-core:27957].

Thu May 20 22:49:04 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* re.c (rb_reg_s_union_m): update rdoc.  [ruby-dev:41354]

Thu May 20 22:08:28 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_f_caller): update rdoc.  a patch from Nobuhiro IMAI
	  <nov at yo.rim.or.jp> in [ruby-dev:41348].

Thu May 20 22:04:05 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (vm_backtrace_each): now takes an init function to distinguish
	  an empty stack from out of stack.  [ruby-dev:41366]

	* vm_eval.c (print_backtrace, rb_thread_backtrace): ditto.

Thu May 20 20:47:46 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_invoke): raise NoMethodError
	  when COM method is not found. [ruby-core:30160] [Bug #3277]

	* test/win32ole/test_win32ole.rb (test_no_method_error): ditto.

Thu May 20 16:17:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/psych/emitter: C99(gcc)-ism.

Thu May 20 12:59:49 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/stream.rb: adding YAML streaming API for
	  infinite length streams.

	* ext/psych/lib/psych.rb: refactoring for streaming API

	* ext/psych/lib/psych/{handler, stream, tree_builder}.rb: ditto

Thu May 20 02:12:20 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/emitter.c: output strings are automatically transcoded

Wed May 19 23:36:57 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: [ruby-dev:41334] [Bug #3307] invalid result
	  on searching tcl.h/tk.h. Thanks, Masaya Tarui.

Wed May 19 23:19:30 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (disconnect): closes the socket of a Net::IMAP
	  object only when it is not closed.  [ruby-dev:41350]

Wed May 19 20:09:38 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_f_caller): return [] instead of nil when the function
	  is called on toplevel.  [ruby-dev:41348]

Wed May 19 19:58:01 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: mswin/mingw ruby has socketpair(), but it's
	  not exist as such name in ruby static library, so mkmf.rb cannot
	  find it.

Wed May 19 19:45:10 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* iseq_compile_each (NODE_DEFINED): put nil first to fix stack
	  consistency.  [ruby-core:30293]
	  Now, lfinish[0] of defined_expr seems not to be used.  Refactoring
	  may be needed.

Wed May 19 16:55:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num2ulong): use rb_big2ulong for data from
	  Bignum. Without this 32bit integer on 32bit environment
	  can't converted into long.
	  This fixes 1) and 2) of [ruby-dev:41289]

Mon May 17 22:19:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* process.c: suppress warning for signed and unsigned type
	  inconsistency.

	* ext/psych/parser.c: ditto.

	* ext/sdbm/_sdbm.c: ditto.

	* ext/syck/rubyext.c: ditto.

Mon May 17 21:30:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* .gitignore: updated.

Mon May 17 21:08:53 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (argv_size): merged into join_argv() to maintain the
	  agreement with it.  removed code has a calculation bug.
	  fixed [Bug#2388]

	* win32/win32.c (join_argv): calc and return the length of joined
	  argv.
	  the cause of the original bug was clarified by Masaya TARUI
	  <tarui AT prx.jp> and the solution was suggested by him, too.

Mon Apr  5 09:20:08 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/iso_2022_jp.h: add CP50220.

	* enc/trans/iso2022.trans: add converter for CP50220.

Mon May 17 09:37:25 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::Entry_#entries): returns pathname in
	  UTF-8 on Windows to allow FileUtils accessing all pathnames
	  internally.

Mon May 17 01:07:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (rb_w32_check_imported): workaround for VC6.

Sun May 16 22:21:32 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (mnew): initialize a field.  a patch from Takahiro Kambe.
	  [ruby-dev:41312]

Sun May 16 22:17:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval.c (setup_exception): let SystemStackError#backtrace return an
	  single element array instead of string itself.  [ruby-core:30196]

Sun May 16 21:51:04 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (parser_read_escape, parser_tokadd_escape): allow a hex or
	  octal encoded character after \c.  This seemed to be prohibited at
	  r13836, but its ChangeLog mentions nothing about this prohibition.
	  So I assume this prohibition is not intended.  [ruby-core:27229]

Sun May 16 21:14:04 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ruby/test_rubyoptions.rb (TestRubyOptions#test_segv_test):
	  fixes "NoMethodError: undefined method `[]=' for nil:NilClass"

Sun May 16 17:16:09 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (proc_binding): don't propagate filename and line_no of
	  binding that is created from C level.  [ruby-dev:41322]

	* vm_eval.c (eval_string_with_cref): ditto.

Sun May 16 15:09:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (rb_w32_check_imported): check if extension library to be
	  loaded imports from different ruby dll.

Sun May 16 14:55:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (dln_find.o): fix dependency.

Sun May 16 13:55:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_loaderror): use locale string, not ascii-8bit.

Sun May 16 11:39:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/missing.h (signbit): add missing prototype.

Sun May 16 10:49:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (rb_iconv_sys_fail): fix number of arguments.
	  a patch by Masaya TARUI <tarui AT prx.jp>.

Sun May 16 02:24:27 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* configure.in: can not load libruby.so if gcc is used with
	  --enable-shared on AIX.

Sat May 15 17:16:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (rb_iconv_sys_fail): raise BrokenLibrary if
	  errno is not set.  [ruby-dev:41317]

Fri May 14 07:27:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_float): strip ".0" from end for rubyspec.

Fri May 14 01:17:10 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_core.c (rb_thread_struct): add a field for sigaltstack.

	* thread_pthread.c (thread_start_func_1): initialize machine stack
	  information.

	* thread.c (thread_start_func_2): set sigaltstack for each sub thread.
	  [ruby-core:24540] [ruby-core:30207]

Thu May 13 21:40:39 2010  Tanaka Akira  <akr@fsij.org>

	* missing/ffs.c (ffs): fixed for non-zero values.

Thu May 13 18:45:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (get_write_fd): return primary fd if no
	  io is tied for writing.

Thu May 13 18:15:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (swallow): should use more_char() instead of fill_cbuf().
	  suggested by akr.

Thu May 13 17:56:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_set_echo, console_echo_p): use
	  primary fd.  [ruby-dev:41309]

Thu May 13 13:30:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_float): use minimal representation.

	* numeric.c (ruby_dbl2cstr): split from rb_float_new.

Thu May 13 13:09:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_vm_get_sourceline): moved from eval_intern.h for
	  vm_dump.c.

Thu May 13 12:53:13 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (swallow): support text mode and UTF-16/32 as internal encoding.
	  [Bug #1576]

	* io.c (io_shift_cbuf): read and throw it away when str is NULL.

Thu May 13 09:45:27 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub: link with ffs.obj.

Thu May 13 07:37:49 2010  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c: include unistd.h before sdbm.h for off_t.
	  fix compilation problem on FreeBSD 6.4.

Wed May 12 23:48:37 2010  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_quad_pack): deprecated.
	  (rb_quad_unpack): ditto.

Wed May 12 22:22:05 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (rb_big_abs_find_minbit): use ffs().

	* configure.in: check ffs().

	* missing/ffs.c: new file.

	* include/ruby/missing.h (ffs): declared.

Wed May 12 16:43:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_to_s): fixed broken output including nuls.

Wed May 12 16:25:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_to_s): exponent needs 2 digits.

Wed May 12 16:02:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_to_s): fill lower zeros.

Wed May 12 15:45:36 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/generator/ri.rb (generate): should load existing cache
	  before generating it.

Wed May 12 15:04:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/math.rb (BigMath#log): improved
	  precision and performance. [ruby-dev:41295]

Wed May 12 11:39:10 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: test all IPPROTO_* constants for recent Win32
	  SDK.

Wed May 12 10:57:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_to_s): make minimum string representation.
	  [ruby-core:30145]

Wed May 12 09:21:05 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_initialize_m): fix wrong index for the lang
	  option's value 'N'. reported by Masaya TARUI via IRC.

Tue May 11 23:07:22 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test IPPROTO_IP and IPPROTO_IPV6 constants.

	* ext/socket/mkconstants.rb: define macros for enum.

	  [ruby-dev:38849]

Tue May 11 21:53:18 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/rake/test_task_arguments.rb: makes ENV empty during tests
	  because ENV may change the behavior of Rake::TaskArguments.
	  [ruby-core:29984]

Tue May 11 15:14:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_8.c: Add new alias UTF-8-HFS for UTF8-MAC.
	  http://www.gnu.org/software/emacs/NEWS.23.2

Tue May 11 13:46:00 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/math.rb (atan),
	  test/bigdecimal/test_bigmath.rb (test_atan): explicitly specify
	  the precision for calculating a reciprocal number of an argument.
	  [Bug #3267]

Tue May 11 11:49:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/sdbm/sdbm.h (DBM): large file support on win32.
	  [ruby-core:23039]

	* ext/sdbm/depend: objects depend on sdbm.h.

Tue May 11 09:57:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_intern.h (rb_vm_get_sourceline): add prototype.

Tue May 11 09:53:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/psych/parser.c (PSYCH_TRANSCODE): get rid of bare use of gcc
	  extension.

Tue May 11 01:20:43 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): Return strings encoded as
	  Encoding.default_internal if set.

Mon May 10 23:50:19 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_unpack): add a missing break.

Mon May 10 14:13:04 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* time.c (rb_big_abs_find_minbit): get rid of a warning of VC.

Mon May 10 13:59:42 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (rb_w32_has_cancel_io): new
	  function.

	* io.c (WAIT_FD_IN_WIN32): check only when it's not cancelable.

Mon May 10 06:59:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (rdoc): rdoc should depend main. Moreover when XRUBY
	  is miniruby, it can run after miniruby is built.

Mon May 10 03:36:56 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (eval_string_with_cref): propagate filename and line_no
	  of binding.  [ruby-dev:38767] [ruby-core:28307]

	* vm_core.h (rb_binding_t), proc.c: add filename and line_no fields to
	  preserve them.

Mon May 10 02:58:33 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_compile_each), vm_insnhelper.c (vm_invoke_block,
	  vm_throw): allow "return" and "yield" even in singleton class
	  definition.  based on a patch from wanabe <s.wanabe AT gmail.com>
	  for "return".  [ruby-core:21379] [ruby-dev:40975]

	* insns.def (defineclass): ditto (straightforwardly push block ptr,
	  instead of dfp ptr with special flag).

	* vm_core.h (RUBY_VM_CLASS_SPECIAL_P): ditto (no longer needed).

	* proc.c (proc_new): ditto (remove handling for special flag).

	* bootstraptest/test_jump.rb: add tests for above.

Mon May 10 02:29:51 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (fiber_switch): raise FiberError when returning to dead
	  fiber.  [ruby-dev:40833]

Mon May 10 02:07:20 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/thread.rb (ConditionVariable#wait): ensure to remove the current
	  thread from waiters.  [ruby-core:29835]

Mon May 10 00:54:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_set_raw): new method.

	* ext/io/console/console.c (ttymode): reverted previous commit.

Sun May  9 23:53:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RB_GC_GUARD_PTR): get rid of removal by
	  optimization.

Sun May  9 23:07:53 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (proc_dup): copy blockprocval.  proc_dup is used by
	  define_method, which made blockprocval be GC'ed mistakenly.
	  [ruby-core:30023]

Sun May  9 16:28:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (fiber_initialize_machine_stack_context): try to release
	  unnecessary fibers and retry to create.  based on a patch from
	  masaya tarui at [ruby-dev:41230].

Sun May  9 08:32:56 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/generator/generator.c (fbuffer_inc_capa):
	  fix the use of REALLOC_N. [ruby-dev:41227]

Sun May  9 09:30:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/{generator/generator.c,parser/parser.rl}: fixed indent.

	* ext/json/{generator,parser}/depend: added.

Sun May  9 09:15:03 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* test/net/imap/test_imap.rb: use IPv4 for
	  test_imaps_post_connection_check.  [ruby-dev:41189]

Sun May  9 08:24:24 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (disconnect): terminates @receiver_thread even if
	  @sock.shutdown raises an exception.  [ruby-dev:34881]

Sun May  9 06:15:21 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (nogvl_copy_stream_sendfile): ISO C90 forbids mixed
	  declarations and code.

Sun May  9 02:57:02 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/lib/fiddle.rb: only require DL if it hasn't been required
	  yet. [ruby-core:30095]

Sun May  9 01:15:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (stackgrowdirection): removed duplicated code, use
	  STACK_UPPER macro instead.

	* gc.h (STACK_DIR_UPPER): moved from thread_pthread.c.

Sun May  9 00:35:56 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/dl/test_base.rb (libc_so, libm_so): supports solaris.

Sat May  8 19:03:31 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/default.mspec (config): . is no longer in $:.

Sun May  9 00:27:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_aset): fixed argument type.

Sat May  8 23:09:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS (io/console): IO#noecho and IO#raw without block are
	  obsolete already.  [ruby-dev:41226]

	* ext/io/console/console.c (ttymode): save duped file descriptors
	  and restore tty modes using them, so that original modes can be
	  restored even if original fds are closed.  [ruby-dev:41225]

Sat May  8 13:48:31 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* array.c (rb_ary_fetch, rb_ary_splice, rb_ary_store): Improve
	  IndexError
	  messages [ruby-core:28394]

	* hash.c (rb_hash_fetch_m): Improve KeyError message

Sat May  8 13:11:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/user_interaction.rb (Gem::StreamUI#ask_for_password):
	  use io/console.

	* ext/io/console: imported.  [ruby-dev:40897]

Sat May  8 12:25:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_systmpdir): moved from ext/tmpdir.

	* ext/etc/etc.c (etc_sysconfdir): added.

	* lib/rubygems/config_file.rb, lib/tmpdir.rb: use etc.

Sat May  8 11:07:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpAlloc): ensure buf does not get
	  collected.  based on a patch masaya tarui at [ruby-dev:41213].

Sat May  8 10:03:39 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (BasicSocket#connect_address): MacOS X 10.6
	  returns "::ffff:a.b.c.d" for IPv4-mapped IPv6 address.
	  [ruby-dev:41215] patch by Tomoyuki Chikanaga.

Fri May  7 23:51:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* version.h: bump up to 1.9.3.

Fri May  7 11:30:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (install-man): install mdocs directly without
	  temporary files.  [ruby-dev:41204]

Fri May  7 09:16:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/extconf.rb (get_tclConfig_dirs): glob with EXEEXT.

	* ext/tk/extconf.rb (search_tclConfig): fixed typo.

Fri May  7 06:45:28 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: search directories on PATH, only if containing
	  tclsh or wish command (probably right fix for [ruby-core:30010]).

Fri May  7 03:40:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpCtoV): fix to check overflow.

Thu May  6 22:19:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* cont.c: define FIBER_USE_NATIVE only when _WIN32_WINNT >= 0x0400
	  on Windows because Fiber APIs are supported only such building
	  (and running) environments.
	  [ruby-dev:41192]

Thu May  6 19:13:43 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/openssl/test_ec.rb: added test_dsa_sign_asn1_FIPS186_3. dgst is
	  truncated with ec_key.group.order.size after openssl 0.9.8m for
	  FIPS 186-3 compliance.

	  WARNING: ruby-openssl aims to wrap an OpenSSL so when you're using
	  openssl 0.9.8l or earlier version, EC.dsa_sign_asn1 raises
	  OpenSSL::PKey::ECError as before and EC.dsa_verify_asn1 just returns
	  false when you pass dgst longer than expected (no truncation
	  performed).

	* ext/openssl/ossl_pkey_ec.c: rdoc typo fixed.

Thu May  6 18:12:43 2010  Koichi Sasada  <ko1@atdot.net>

	* cont.c (fiber_setcontext): Fix last commit.

Thu May  6 17:16:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (rb_localtime_r2): get rid of infinite loop bug of
	  localtime() on x86_64-darwin.  [ruby-core:30031]

Thu May  6 15:56:12 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/*: Adding fiddle library to wrap libffi
	* test/fiddle/*: testing fiddle extension
	* ext/dl/lib/dl.rb: Requiring fiddle if it is available
	* ext/dl/lib/dl/callback.rb: using Fiddle if it is available
	* ext/dl/lib/dl/func.rb: ditto

Thu May  6 15:04:37 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_match_m): add description about optional
	  position parameter. [ruby-list:47064]
	  patched by KISHIMOTO, Makoto <ksmakoto AT dd.iij4u.or.jp>

Thu May  6 14:12:39 2010  Tanaka Akira  <akr@fsij.org>

	* lib/tmpdir.rb: test RUBY_PLATFORM for loading tmpdir.so to avoid
	  LoadError.

Thu May  6 12:41:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: add rationalize methods of Complex, Float, Integer, NilClass,
	  and Rational classes.

Thu May  6 12:12:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README: update.

Thu May  6 03:34:29 2010  Koichi Sasada  <ko1@atdot.net>

	* cont.c: apply FIBER_USE_NATIVE patch.  This patch improve
	  Fiber context switching cost using system APIs.  Detail comments
	  are written in cont.c.

Thu May  6 02:16:48 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_method.c (rb_unlink_method_entry, rb_sweep_method_entry):
	  added.  Unlinked method entries are collected to
	  vm->unlinked_method_entry_list.  On the GC timing, mark all method
	  entries which are on all living threads.  Only non-marked method
	  entries are collected.  This hack prevents releasing living method
	  entry.
	  [Performance Consideration] Since this Method Entry GC (MEGC)
	  doesn't occur frequently, MEGC will not be a performance bottleneck.
	  However, to traverse living method entries, every control frame push
	  needs to clear cfp->me field.  This will be a performance issue
	  (because pushing control frame is occurred frequently).
	  Bug #2777 [ruby-dev:40457]

	* cont.c (fiber_init): init cfp->me.

	* gc.c (garbage_collect): kick rb_sweep_method_entry().

	* method.h (rb_method_entry_t): add a mark field.

	* vm.c (invoke_block_from_c): set passed me.

	* vm.c (rb_thread_mark): mark cfp->me.

	* vm_core.h (rb_thread_t): add a field passed_me.

	* vm_core.h (rb_vm_t): add a field unlinked_method_entry_list.

	* vm_insnhelper.c (vm_push_frame): clear cfp->me at all times.

	* vm_insnhelper.c (vm_call_bmethod): pass me.

	* bootstraptest/test_method.rb: add a test.

Wed May  5 22:22:51 2010  wanabe  <s.wanabe@gmail.com>

	* compile.c (iseq_set_sequence): fix check range of ic_index.
	  a patch from Tomoyuki Chikanaga.  #3236

Wed May  5 21:49:31 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* dln.c (aix_loaderror): use execerror for load error on AIX.
	  This can avoid SEGV reported by Perry Smith.  [Bug #2063]

Wed May  5 20:37:54 2010  wanabe  <s.wanabe@gmail.com>

	* thread_win32.c (w32_wait_events): get GVL before handle interrupt
	  event.   [ruby-core:27199], [ruby-core:29698]

Wed May  5 19:00:01 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: revert. enbugged by last commit.
	  ([ruby-dev:41133], [ruby-dev:41134], [ruby-core:30010])

	* ext/tk/README.tcltklib: ditto.

Wed May  5 15:54:35 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (rb_stat): use STAT macro instead of calling stat() directly.
	  reported by Bill Kelly.  [ruby-core:30012]

Wed May  5 11:43:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/test_io.rb (megacontent-copy_stream): get rid of
	  deadlock.

Wed May  5 07:27:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_mark_method_entry): renamed.

Wed May  5 05:20:27 2010  Koichi Sasada  <ko1@atdot.net>

	* method.h, vm_method.c: rename some internal functions related to
	  rb_method_entry_t.
	  rb_add_method_me()        -> rb_method_entry_set().
	  rb_get_method_entry()     -> rb_method_entry_without_cache().
	  rb_gc_mark_method_entry() -> rb_mark_method_entry().

	* class.c, proc.c: ditto.

Tue May  4 22:59:48 2010  wanabe  <s.wanabe@gmail.com>

	* compile.c (iseq_build_body): update iseq->ic_size.
	  a patch from Tomoyuki Chikanaga. see #3236.

Tue May  4 18:51:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (name_err_mesg_to_str): preserve encoding of inspection.
	  [ruby-core:29948]

Tue May  4 18:38:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/fileutils/test_fileutils.rb (test_copy_stream):
	  IO.copy_stream support binmode only currently.
	  [ruby-core:23724]

Tue May  4 12:46:09 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (argument_error): push correct backtrace.
	  Bug #2281 [ruby-core:26333]

Tue May  4 12:38:40 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (sockopt_inspect): use rb_str_cat2 and
	  rb_str_append.

	* ext/socket/ancdata.c (ancillary_inspect): refined.

Tue May  4 11:48:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_inspect): use rb_str_cat2 and
	  rb_str_append.

Tue May  4 07:52:33 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/net/http.rb (Net::HTTPResponse#read_chunked): ensure to skip the
	  last newline of chunk.  [ruby-core:29229]

	* test/net/http/utils.rb: add an option for chunked response test.

	* test/net/http/test_http.rb: add tests for chunked response.

Tue May  4 03:37:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: Update nkf 2010-04-28.

Mon May  3 21:08:16 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* sample/README: update file list. [ruby-core:28981]

Mon May  3 08:15:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/emitter.c (syck_scan_scalar): set SCAN_WHITEEDGE flag
	  when scalar begins with newline.  patches from Dave B <daz AT
	  d10.karoo.co.uk> at [ruby-core:23019] and caleb clausen at
	  [ruby-core:25851].  [ruby-core:23006][ruby-core:29925]

Sun May  2 17:52:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/task.rb (RDoc::Task): should not override newer code.

Sun May  2 17:25:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): ignore signedness.

Sun May  2 12:04:30 2010  wanabe  <s.wanabe@gmail.com>

	* iseq.c (iseq_load): allow filepath to be nil.
	  a patch from Tomoyuki Chikanaga in [Bug #3229].

Sun May  2 08:54:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/cgi.rb (CGI::NEEDS_BINMODE): check if O_BINARY value instead
	  of fragile check by platform name.

Sun May  2 07:38:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (dir_config): should not modify argument arrays
	  themselves.

Sat May  1 22:53:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#size): stat by path name when it is
	  closed.

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  keep the first trace.

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  fixed filtering.  [ruby-core:29908]

Sat May  1 16:46:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_IsInfinite): don't use
	  non-ascii character.

Sat May  1 14:08:29 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/server.rb:  Fix bug when serving gems.

Sat May  1 14:05:36 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Upgrade to RDoc 2.5.8.

Sat May  1 09:43:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  filter out traces in minitest directory.  [ruby-core:29908]

Sat May  1 06:42:57 2010  wanabe  <s.wanabe@gmail.com>

	* win32/win32.c: add declaration of wstati64 for gcc.

Sat May  1 02:41:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* merge some patches from win32-unicode-test branch.
	  see #1685.

	* file.c, include/ruby/intern.h (rb_str_encode_ospath): new function
	  to convert encoding for pathname.

	* win32.c, include/ruby/win32.h (rb_w32_ulink, rb_w32_urename,
	  rb_w32_ustati64, rb_w32_uopen, rb_w32_uutime, rb_w32_uchdir,
	  rb_w32_umkdir, rb_w32_urmdir, rb_w32_uunlink): new functions to
	  accept UTF-8 path.

	* win32/win32.c (rb_w32_opendir, link, rb_w32_stati64, rb_w32_utime,
	  rb_w32_unlink): use WCHAR path internally.

	* file.c (rb_stat, eaccess, access_internal, rb_file_s_ftype,
	  chmod_internal, rb_file_chmod, rb_file_chown, utime_internal,
	  rb_file_s_link, unlink_internal, rb_file_s_rename): use UTF-8 version
	  functions on Win32.

	* file.c (apply2files, rb_stat, rb_file_s_lstat, rb_file_symlink_p,
	  rb_file_readable_p, rb_file_writable_p, rb_file_executable_p,
	  check3rdbyte, rb_file_identical_p, rb_file_chmod, rb_file_chown,
	  rb_file_s_link, rb_file_s_symlink, rb_file_s_rename): call
	  rb_str_encode_ospath() before passing the path to system.

	* io.c (rb_sysopen): ditto.

	* dir.c (dir_chdir, dir_s_mkdir, dir_s_rmdir): ditto.

Sat May  1 00:26:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  assertion message must be String or Proc.  suggested by caleb
	  clausen at [ruby-core:29884].

Sat May  1 00:14:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_io.rb: skip false tests on Windows.
	  [ruby-core:29886]

Fri Apr 30 22:46:27 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* math.c: Math::DomainError < StandardError [ruby-core:29855]

Fri Apr 30 21:40:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/test_open3.rb (TestOpen3#test_commandline): use simple
	  command via shell.  [ruby-dev:41100]

Fri Apr 30 15:38:45 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: better support for MinGW environment.

Fri Apr 30 12:05:20 2010  Tanaka Akira  <akr@fsij.org>

	* file.c (file_expand_path): call rb_str_set_len before BUFCHECK to
	  prevent rb_str_resize in BUFCHECK discard the content.

Fri Apr 30 11:48:31 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* string.c (rb_str_sub_bang): String#sub! now raises an error when
	  called on a frozen string, even if no change is made.
	  See [ruby-core:23657]

Fri Apr 30 11:40:44 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* eval.c (make_exception, rb_obj_extend): Fix error messages in case
	  of wrong
	  number of arguments

	* file.c (rb_f_test, rb_file_s_umask): ditto

	* numeric.c (int_chr, num_step): ditto

	* process.c (rb_f_sleep): ditto

	* re.c (rb_reg_initialize_m): ditto

	* signal.c (rb_f_kill, sig_trap): ditto

	* string.c (rb_str_aref_m, rb_str_aset_m, rb_str_count,
	  rb_str_delete_bang,
	  rb_str_slice_bang, rb_str_sub_bang, str_gsub): ditto

	* proc.c (curry): rdoc fix

Fri Apr 30 04:09:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* time.c (TIMET_MAX): should be time_t, not unsigned_time_t.

Fri Apr 30 03:59:08 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* time.c (rb_time_unmagnify_to_float): should cast.

Fri Apr 30 03:38:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (fix_mul): the width of fixnum is same as long's on all
	  platforms.

Fri Apr 30 03:17:20 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Improve algorithm for Matrix#determinant and
	  Matrix#rank
	  {determinant,det,rank}_e are now deprecated. [ruby-core:28273]
	  Also fixes a bug in Determinant#rank (e.g. [[0,1][0,1][0,1]])
	  Matrix#singular?, Matrix#regular? now raise on rectangular matrices
	  and use determinant instead of rank.

Fri Apr 30 00:52:56 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): define some constants to select
	  collect code for win64.

Thu Apr 29 20:10:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/test_open3.rb (test_commandline): use dump instead of
	  shellwords.  [ruby-core:23797]

Thu Apr 29 18:39:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/thwait.rb (ThreadsWait#join): refined rdoc again.
	  [ruby-core:29863] [ruby-dev:41092]

Thu Apr 29 14:46:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby: use more descriptive assertions.

	* test/ruby: fixed nonsense assertions.

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  reverted.  [ruby-core:29872]

Thu Apr 29 12:33:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/thwait.rb (ThreadsWait#join): refined rdoc.  [ruby-core:29863]

Thu Apr 29 12:16:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert): reject
	  non-boolean values.  [ruby-core:29868]

Thu Apr 29 11:20:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (seek_before_access): renamed.  see [ruby-core:29861].

	* io.c (rb_io_s_binread): fixed rdoc.  parts of a patch from Roger
	  Pack in [ruby-core:29861].

Thu Apr 29 03:50:49 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/xmlrpc/utils.rb: Fixing an incompatibility with
	  reflection methods returning Symbols.  Patch by
	  HD Moore.  [ruby-core:29821]

Wed Apr 28 23:53:15 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/thwait.rb: revise rdoc.  a patch from Roger Pack in
	  [ruby-core:27362].

Wed Apr 28 23:21:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Update to JSON 1.4.2.

Wed Apr 28 22:53:57 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread. (rb_thread_terminate_all): revert r24591 which caused SEGV
	  sometimes.  [ruby-dev:40936] [ruby-core:27245] [ruby-core:27416]

Wed Apr 28 22:26:55 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/psych/visitors/test_yaml_tree.rb (test_struct_const): remove
	  Struct::Foo which affects test/ruby/test_struct to warn redefining
	  constant.

Wed Apr 28 18:04:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_timespec): use rb_check_funcall.

Wed Apr 28 17:14:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/extconf.rb: CMSG_ macros are broken on 64bit darwin,
	  because of use of __DARWIN_ALIGN.

Wed Apr 28 16:44:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h ({RSTRING,RSTRUCT,RBIGNUM}_LENINT): check long
	  to cast to int.

Wed Apr 28 16:28:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/unixsocket.c (sendmsg_blocking, recvmsg_blocking):
	  define only when used.

	* ext/socket/rubysocket.h: non-implemented method definitions need
	  to be shared.

Wed Apr 28 10:27:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (ruby_vsnprintf, ruby_snprintf): suppress warnings.
	  why return int in spite of the arguments of size_t?

Wed Apr 28 09:49:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/compile_prelude.rb: enable optimization.

Wed Apr 28 09:43:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (warn_balanced): do not warn for EXPR_ENDFN.

Tue Apr 27 23:57:04 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval.c (ruby_cleanup): add exception guard around code running
	  signal handler (of r27513).  Absence of the guard made
	  bootstraptest/test_thread.rb fail sometimes.

Tue Apr 27 22:55:29 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* insns.def (onceinlinecache): add exclusion control for a region
	  between onceinlinecache and setinlinecache.  [ruby-dev:39768]

Tue Apr 27 22:40:54 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* iseq.c (set_relation): do not use top_wrapper as bottom of cref,
	  which caused constant lookup error when "wrapped load" is used;
	  instead, use Object as bottom, and push top_wrapper on Object.
	  [ruby-core:25039]

Tue Apr 27 21:24:40 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval.c (ruby_cleanup): before cleanup, check signal buffer and run
	  handler if any.  [ruby-core:20970]

	* thread.c (rb_threadptr_check_signal): separated from
	  timer_thread_function.

Tue Apr 27 18:00:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/net/smtp.rb (Net::SMTP#rcptto_list): fixed typo.
	  [ruby-core:29809]

Tue Apr 27 12:44:23 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 2.5.7.  Fixes #1318 and ruby-core:29780.

Tue Apr 27 10:54:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_read_escape): deny extra character escapes.
	  [ruby-core:27228]

Tue Apr 27 06:20:13 2010  Tanaka Akira  <akr@fsij.org>

	* io.c (select_internal): IO which cbuf is not empty is readable.

Tue Apr 27 00:07:32 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (program): check void_expr when rb_parse_in_main().
	  [ruby-dev:38717]

Mon Apr 26 20:11:05 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c, lib/cmath.rb, lib/date.rb lib/date/delta*:
	  reverted r27484-27486.  now official spec.

Mon Apr 26 15:42:59 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/json/generator/generator.c (convert_UTF8_to_JSON_ASCII): get rid
	  of a warning.

Mon Apr 26 13:11:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (ripper_get_value): escape Qundef.

Mon Apr 26 12:42:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (warn_balanced): warn according to last state.

Mon Apr 26 09:05:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Update to JSON 1.4.1.

Sun Apr 25 23:50:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (ruby_dup): update max fd.

Sun Apr 25 21:56:49 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (fetch_internal): do not quote message data item
	  names.  Thanks, Eric Hodel.  [ruby-core:23508]

Sun Apr 25 15:59:02 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb: reverted experimental r23900.

Sun Apr 25 15:51:00 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c: reverted experimental r24565.

Sun Apr 25 15:34:48 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/delta*: reverted experimental r24567 and
	  r25393.

Sun Apr 25 11:02:20 2010  wanabe  <s.wanabe@gmail.com>

	* hash.c (ruby_setenv): putenv on msvcrt.dll can't remove empty value.

Sat Apr 24 23:40:50 2010  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb: use [""].pack("p").size to detect the pointer size.

Sat Apr 24 21:07:27 2010  Tanaka Akira  <akr@fsij.org>

	* test/psych/test_psych.rb: don't leave temporary files.

Sat Apr 24 16:27:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (RUBY_PROGRAM_VERSION): added

	* tool/rbinstall.rb: expand target file name.

	* template/fake.rb.in: no need for hook if extmk.

Sat Apr 24 14:40:20 2010  Tanaka Akira  <akr@fsij.org>

	* io.c: raise IOError when byte oriented operations occur with
	  non-empty character buffer.
	  [ruby-dev:40493] [ruby-dev:40506]

Sat Apr 24 13:06:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (get_arglen): skip the last terminator of argv before
	  checking environ.

	* ruby.c (get_arglen): duplicate environ area if setenv and unsetenv
	  are provided.

	* ruby.c (set_arg0): keep empty strings.

Sat Apr 24 09:44:40 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/yaml2byte.c (bytestring_append, bytestring_extend):
	  removed wrong extra assignments.  a patch from Marcus Rueckert
	  <darix AT opensu.se> at [ruby-core:29759].

Sat Apr 24 00:41:52 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* process.c (rb_f_fork): remove after_exec() which sometimes caused
	  two timer threads started.  [ruby-core:25217]

	* signal.c: use pthread_sigmask() instead of sigprocmask().
	  sigprocmask() is unspecified behavior on multi-thread programs.
	  [ruby-core:25217]

Sat Apr 24 00:36:05 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/dl/test_base.rb: add kfreebsd support.  based on a patch from
	  Petr Salinger in [ruby-core:29769].
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=560293

Sat Apr 24 00:14:41 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_ssl_session.c (SSL_SESSION_cmp): remove static for
	  loopy version of openssl (0.9.8l?).

Fri Apr 23 23:27:17 2010  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_config.c: fix compilation failure with
	  OpenSSL 0.9.8.

Fri Apr 23 17:29:35 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_config.c: OpenSSL 1.0.0 support.
	  [ruby-core:29256]

	* ext/openssl/extconf.rb: check some functions added/removed at
	  OpenSSL 1.0.0.

	* ext/openssl/ossl_engine.c (ossl_engine_s_load): use engines which
	  exists.

	* ext/openssl/ossl_ssl_session (SSL_SESSION_cmp): removed at 1.0.0,
	  so implement compatible function here.

Fri Apr 23 14:37:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gem_prelude.rb (Gem::QuickLoader.load_full_rubygems_library):
	  get rid of creating same regexps many times.

	* lib/rubygems/custom_require.rb (Kernel#require): ditto.

Fri Apr 23 14:07:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* doc/etc.rd, doc/etc.rd.ja: moved from ext/etc.

	* ext/etc.c (Init_etc): fixed rdoc.

Fri Apr 23 11:31:25 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Update to RDoc 2.5.6.

Fri Apr 23 04:11:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ripper/test_parser_events.rb (test_unterminated_regexp):
	  separate test.

Fri Apr 23 01:47:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_wopen): shouldn't use FILE_FLAG_OVERLAPPED with
	  normal file.  #1807, #2510, #2549

Fri Apr 23 01:28:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (ubf_handle): remove unused typedef.

Thu Apr 22 23:10:59 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (mnew): fix wrong error message when Kernel#public_method
	  receives name of private method.  [Bug #2425]

Thu Apr 22 22:56:42 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* bootstraptest/test_thread.rb: fix test.  [Bug #2342]

Thu Apr 22 21:50:17 2010  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/ext/multi-irb.rb: fix multi-irb running
	  parallelly. [ruby-dev:41031] [Bug #3182]

Thu Apr 22 17:13:34 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems: Import RubyGems 1.3.7.pre.1 (as 1.3.6.1).

Thu Apr 22 16:43:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (warn_balanced): removed false warning.

	* parse.y (parser_yylex): skip whitespaces after method name.

Wed Apr 22 02:16:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.[ch]: replace _DEBUG with BIGDECIMAL_DEBUG
	  to prevent activating debugging code when compiled with -DEBUG flag
	  on Windows. [ruby-core:22989] #1308

Wed Apr 21 21:24:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/digest/sha2/extconf.rb: check SHA256_CTX and SHA512_CTX to fix
	  compilation failure on OpenBSD 4.4.

Wed Apr 21 15:13:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_getc): fix incomplete character immediately before EOF
	  with newline converter. [ruby-dev:41024]

Wed Apr 21 13:44:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (regexp): check each fragments.   [ruby-core:27374]

Wed Apr 21 13:36:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): reverted r27388 due to backward
	  compatibility.

	* parse.y (parser_yylex): warn confusing binary operators after
	  local variable.

Wed Apr 21 11:53:47 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 2.5.5.  Fixes bugs in ri, Darkfish and
	  rdoc option handling.

Wed Apr 21 11:31:35 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): abandoned EXPR_VCALL.

Wed Apr 21 03:17:17 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_getc): set read_encoding to resulted one character
	  string. [ruby-dev:41023]

Wed Apr 21 00:29:39 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (bigmul1_karatsuba): fix calculation order to prevent
	  underflow.  [ruby-core:29088]

Wed Apr 21 00:26:17 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (NODE_NEXT, NODE_REDO): add dummy putnil instruction to
	  fix stack consistency error.  [ruby-core:28172]

	* bootstraptest/test_jump.rb: add a test for above.

Wed Apr 21 00:16:44 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/zlib/zlib.c (rb_deflate_params): update buf_filled count because
	  deflateParams writes to out buffer.  And, revert r18029 because the
	  flush was not needed now and emits garbage.  [ruby-dev:40802]

Wed Apr 21 00:01:05 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_method.c (rb_add_method_def): decrement alias count of
	  rb_method_definition_t to prevent memory leak.  see
	  [ruby-dev:41021].

Tue Apr 20 21:33:06 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/win32/lib/win32/registry.rb (PredefinedKey#create): root key
	  name should be a string.  fixed [ruby-core:28192]

Tue Apr 20 19:25:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): fix for tLPAREN_ARG.

Tue Apr 20 12:34:23 2010  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/{core, util}.rb (RFC822_DAYS, RFC822_MONTHS):
	  move the constant because used only util.rb.

Tue Apr 20 12:24:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lex_state_e, IS_END, IS_SPCARG, parser_yylex): separate
	  the state after vcall.  [ruby-core:29578]

Tue Apr 20 01:03:00 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* bootstraptest/test_fork.rb: add a test for [ruby-core:28924].

Tue Apr 20 00:43:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_extname): skip last directory separators.
	  [ruby-core:29627]

Tue Apr 20 00:41:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (internal_{read,write}_func, rb_{read,write}_internal):
	  reverted r27265, since now rb_thread_blocking_region() preserves
	  errno.

Mon Apr 19 23:14:45 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (rb_thread_blocking_region, rb_thread_blocking_region_end):
	  preserve errno.  [Bug #2606] [ruby-core:28924]

Mon Apr 19 19:41:10 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::cp_r): backport r11156 from ruby_1_8.

Mon Apr 19 19:18:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): reduced duplicated conditions.

Mon Apr 19 13:58:04 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 2.5.4.  Fixes #3169, #3160, #3023.

Mon Apr 19 12:46:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/timeout.rb (Timeout#timeout): propagate errors to the
	  caller.  [ruby-dev:41010]

Mon Apr 19 00:27:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_method.c (rb_add_method_def): workaround fix for redefinition
	  of methods. This is because cfp->me uses the rb_method_entry
	  which is freed by redefinition of remove_method. Note that
	  reusing may cause another problem when the usage is changed.
	  [ruby-core:27320] [ruby-core:29464]

Sun Apr 18 22:13:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (string_content): cond_stack and cmdarg_stack are VALUE.

Sun Apr 18 18:07:47 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::IPv4::Regex): make it only accept 0 to 255.
	  [ruby-core:29501]

Sun Apr 18 12:48:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): seems like a symbol-literal when spaces
	  are unbalanced.  [ruby-core:29578]

Sun Apr 18 12:32:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (string_content): preserve cond_stack and cmdarg_stack.
	  [ruby-core:29579]

Sun Apr 18 05:50:58 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: defaulting binary string
	  format to "literal" format.

Sun Apr 18 02:13:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/irb/ruby-lex.rb (identify_identifier): add '_' to the regexp.

Sat Apr 17 23:21:15 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: use AC_TRY_LINK instead of AC_TRY_COMPILE.
	  On Solaris it can compile with signbit but can't link.

Sat Apr 17 20:34:09 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/envutil.rb: update Gem::ConfigMap to fake environment for
	  tests.  Some test of rubygems had failed because envutil.rb changed
	  only RbConfig::CONFIG but not Gem::ConfigMap.

Sat Apr 17 20:31:08 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/irb/ruby-lex.rb (identify_identifier): allow multibyte character
	  as identifier.  [ruby-core:27275]

Sat Apr 17 09:19:27 2010  wanabe  <s.wanabe@gmail.com>

	* compile.c (iseq_compile_each): fix splat condition in NODE_WHEN.
	  [Bug #2226]

Sat Apr 17 08:57:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/net/smtp.rb (Net::SMTP#rcptto_list): continue when at least
	  one RCPT is accepted.  based on a patch from Kero van Gelder at
	  [ruby-core:26190].

Sat Apr 17 07:43:55 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/thread/test_queue.rb (TestQueue#grind): fix typos.

Sat Apr 17 07:27:53 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add Array#repeated_{combination,permutation} [Feature #2981]

Sat Apr 17 05:30:22 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/core_ext.rb (yaml_as): supporting deprecated
	  "yaml_as" method
	* ext/syck/lib/syck/tag.rb: ditto

Sat Apr 17 05:25:15 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/coder.rb (scalar): supporting deprecated methods
	* ext/psych/lib/psych/deprecated.rb: supporting deprecated
	  to_yaml_properties method

Sat Apr 17 01:32:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (rb_io_rewind, rb_io_eof): add rdoc.  based on a patch from
	  Roger Pack in [ruby-core:26771] [Bug #2377].

Fri Apr 16 23:42:56 2010  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb (test_invokeverb):
	  run test only when "Create Shortcut (&S)" menu is found.
	  [ruby-core:29550] [Bug #1602]

Fri Apr 16 21:52:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (string_content, etc): counts of CMDARG_PUSH and POP were
	  inconsistent.  [ruby-core:22637]

Fri Apr 16 21:27:57 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_coerce): revert r23389,
	  which not only is unnecessary but also causes the inconsistency of
	  return type.  [ruby-core:25706] [Bug #2129]

Fri Apr 16 20:05:24 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/thread.rb (Queue#push, #pop, SizedQueue#push, #pop): remove
	  code that kicks waiting thread twice, which caused race and
	  deadlock.  a patch from James M. Lawrence.  [ruby-core:25537]

	* test/thread/test_queue.rb: added.

Fri Apr 16 20:01:47 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* .gitignore: updated.

Fri Apr 16 16:51:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/file2lastrev.rb (VCS::SVN::get_revisions.): remind about
	  DOSISH, sometimes.

Fri Apr 16 16:15:40 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_repeated_permutation): new method added. a patch
	  from Makoto Kishimoto in [ruby-core:29267]   [ruby-core:28724]

	* array.c (rb_ary_repeated_combination): ditto.

Thu Apr 15 22:41:47 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (rb_thread_priority, rb_thread_priority_set): fix rdoc.
	  Lower-priority thread may run even if there are higher-priority
	  threads.  See [ruby-dev:40977].

Thu Apr 15 22:33:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/uri/ftp.rb (URI::FTP#set_path): added to correct handling of
	  special case where path of ftp is relative.  This converts relative
	  path to absolute one, because external representation of ftp path is
	  relative and internal representation is absolute.  [ruby-core:24077]

	* lib/uri/ftp.rb (URI::FTP#initialize): converts absolute to relative.

	* lib/uri/generic.rb (URI::Generic#check_path): allow relative path
	  when scheme is ftp.

Thu Apr 15 21:54:39 2010  Tanaka Akira  <akr@fsij.org>

	* tool/file2lastrev.rb: use backtick for ruby 1.8.

Thu Apr 15 21:13:29 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/file2lastrev.rb: this should run with ruby 1.8.

Thu Apr 15 20:41:10 2010  Tanaka Akira  <akr@fsij.org>

	* tool/file2lastrev.rb: make -q effective for files not version
	  controlled.

Thu Apr 15 14:50:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace_each): get rid of use of malloc from signal
	  handler by using ruby_engine_name.  [ruby-core:29497]

	* vm_eval.c (print_backtrace): file may be nil when segfaulted in
	  very early stage.

	* vm_dump.c (bugreport_backtrace): ditto.

Thu Apr 15 11:51:49 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (help): small fix.

Wed Apr 14 22:09:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/source.rb: force_encoding("UTF-8") when the input
	  is already UTF-8. patched by Kouhei Sutou [ruby-core:23404]

Wed Apr 14 18:23:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in (signbit): signbit is a macro in C99.

Wed Apr 14 17:56:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_shift_cbuf): should terminate.
	  http://golf.shinh.org/p.rb?DECimal+number+to+BINary#Ruby

Wed Apr 14 16:29:02 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (GET_STACK_BOUNDS): fixed macro argument names.  a patch from
	  Satoshi Shiba <shiba AT rvm.jp> at [ruby-dev:40973].

	* gc.h (ruby_get_stack_grow_direction): fixed prototype.

	* thread_pthread.c (get_stack, ruby_stack_overflowed_p): both side
	  should be same type.  [Bug #3145]

Wed Apr 14 15:58:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_string_value_cstr): make NUL terminated if it is
	  not done.

Wed Apr 14 12:56:21 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap (encode_utf7): encode & properly.  Thanks, Kengo
	  Matsuyama.  [ruby-dev:38063]

Wed Apr 14 11:39:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/lib/syck/basenode.rb (Syck::BaseNode#match_path): fixed
	  library name.

	* ext/syck/lib/yaml/syck.rb: split from ext/syck/lib/syck.rb for
	  backward compatibility.

Wed Apr 14 09:24:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: Refix [nkf-bug:21393]. (explicit -X)

Tue Apr 13 20:36:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: Fix: Windows Codepages wrongly convert
	  Halfwidth Katakana. [nkf-bug:21393]

Tue Apr 13 15:00:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (make_seed_value): fix leading-zero-guard condition on
	  bdigit is smaller than 32bit.

Tue Apr 13 13:57:36 2010  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/completion.rb (CompletionProc): fix [ruby-dev:40953]
	  [Bug #3126]. Thanks Kazuhiro NISHIYAMA.

Tue Apr 13 09:32:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (transcode_loop): insert output the value when
	  fallback hash has a related key. [ruby-dev:40540]
	  [ruby-dev:40829] #3036

	* transcode.c (rb_econv_prepare_opts): pass to newhash
	  a value with the key :fallback.

Tue Apr 13 00:12:04 2010  Tanaka Akira  <akr@fsij.org>

	* random.c (rand_init): use the absolute value of seed to
	  make srand(-2**40) portable with 32bit and 64bit.
	  [ruby-core:29292](2)

Mon Apr 12 22:48:47 2010  Tanaka Akira  <akr@fsij.org>

	* enumerator.c (inspect_enumerator): don't raise for uninitialized
	  enumerator.

Mon Apr 12 21:47:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* LEGAL: separated the section for parse.c.  contributed by Paul
	  Betteridge in [ruby-core:29472].

Mon Apr 12 09:19:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (fu_each_src_dest): ensure src is accessible.

	* lib/fileutils.rb (fu_same): use File.identical? to get rid of
	  exceptions.  [ruby-core:28141]

	* lib/fileutils.rb (fu_have_st_ino): no longer used.

	* lib/fileutils.rb (fu_have_st_ino): check if required method is
	  defined, instead of platform name.

Mon Apr 12 05:10:20 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: New method Matrix.build [ruby-core:28272]

Mon Apr 12 03:45:25 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Deprecate elements_to_{f/i/r}

Mon Apr 12 03:30:29 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Handle coercion errors by raising TypeErrors
	  [ruby-core:26736]

Mon Apr 12 00:51:21 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_io_getline_fast, rb_io_getline_1): fix ARGF.lineno
	  behavior. [ruby-core:25205]

	* test/ruby/test_argf.rb (TestArgf#test_lineno3): add a test for
	  above.

Sun Apr 11 23:25:17 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* configure.in: can not load libraries if --with-opt-dir is used
	  on AIX. [Bug #3107]

Sun Apr 11 14:44:45 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/irb/ruby-lex.rb (RubyLex#getc): revert r10817, which caused
	  regression for handling case when there is no newline at the end of
	  file.  [ruby-core:28248]

Sun Apr 11 12:08:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_replicate): new encoding name must be valid
	  c-string.  [ruby-dev:40954]

Sun Apr 11 11:58:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (ftruncate): rename to get rid of conflict
	  with same name but non-LFS function on MinGW.  [ruby-core:24757]

Sun Apr 11 10:33:34 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 2.5.3.  Includes r27288 and r27290.

Sun Apr 11 09:31:39 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* test/syck/*: Moved test/yaml to test/syck since it's actually
	  testing the syck YAML engine.

Sun Apr 11 08:56:44 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/rdoc.rb (setup_output_dir): compare by Time#to_i.
	  Cached created time doesn't have fractional times,
	  but FileStat#mtime has; so rdoc almost always judged files
	  are updated.

Sun Apr 11 07:40:48 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/rdoc.rb (setup_output_dir): fix typo. [ruby-core:29415]

Sun Apr 11 07:01:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (decode_www_form_component): validate.
	  [ruby-dev:40938]

	* lib/uri/common.rb (decode_www_form): allow empty string.

	* lib/uri/common.rb: fix nodoc for constant. [ruby-dev:40949]

Sat Apr 10 21:26:22 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/markup/preprocess.rb (RDoc::Markup::PreProcess#handle):
	  use File.binread to avoid locale dependency.

Sat Apr 10 15:18:26 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 2.5.2
	* lib/rdoc/parser/ruby.rb (RDoc::Parser::Ruby): Don't parse rdoc
	  files, reverts r24976 in favor of include directive support in C
	  parser.

Sat Apr 10 13:14:22 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/openssl/ossl_ssl.c (Init_ossl_ssl): add SSLContext#ssl_timeout=,
	  which allows net/https to specify timeout.  [ruby-core:24812]

Sat Apr 10 07:36:13 2010  wanabe  <s.wanabe@gmail.com>

	* vm_method.c (rb_add_method): clear attr.location before rb_ary_new3.
	  a patch from Masaya TARUI in [Bug #3108]

Sat Apr 10 05:27:26 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/deprecated.rb: implementing Psych.quick_emit and
	  adding deprecation warnings.
	* ext/psych/lib/psych/visitors/to_ruby.rb: supporting deprecated
	  yaml_initialize api.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: supporting deprecated
	  to_yaml api.

Sat Apr 10 01:08:53 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/parser.c: parse raises a TypeError when nil is passed in.

Sat Apr 10 00:01:51 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/pty/lib/expect.rb: preserve buffer read, instead of discard.
	  based on a patch from Luiz Angelo Daros de Luca in
	  [ruby-core:23464].

Fri Apr  9 23:58:58 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/pty/lib/expect.rb: raise an error when argument is unexpected
	  type.  based on a patch from Luiz Angelo Daros de Luca in
	  [ruby-core:23464].

Fri Apr  9 23:57:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/pty/lib/expect.rb: add rdoc.  based on a patch from Luiz Angelo
	  Daros de Luca in [ruby-core:23464].

Fri Apr  9 23:54:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/irb/init.rb, lib/irb/lc/help-message,
	  lib/irb/lc/ja/help-message: add -w flag.  [ruby-core:24594]

Fri Apr  9 23:51:45 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/socket/ipsocket.c (init_inetsock_internal),
	  ext/socket/unixsocket.c (rsock_init_unixsock): check the result of
	  listen(2).  based on a patch from Mike Pomraning.  [ruby-core:23698]

Fri Apr  9 21:22:10 2010  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/completion.rb (CompletionProc): irb will be stuck with
	  long variable name at completion. [Bug#1969]. refix [ruby-core:28366].

Fri Apr  9 20:54:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (decode_www_form): don't ignore leading '?'.
	  [ruby-dev:40938]

	* lib/uri/common.rb (decode_www_form): check whether argument is
	  valid application/x-www-form-urlencoded data.

Fri Apr  9 20:29:13 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* dir.c (push_glob): clear up the previous commit (RB_GC_GUARD can
	  precede the last reference).  [ruby-dev:40942]

Fri Apr  9 20:05:05 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* dir.c (push_glob): add RB_GC_GUARD to prevent str being free'ed.
	  a patch from Masaya TARUI in [ruby-dev:40939].  [ruby-dev:40514]

Fri Apr  9 10:53:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* compile.c (iseq_compile_each): stop hiding, and freeze unpopped
	  string nodes to allow method redefinition.  [ruby-dev:40641]

Fri Apr  9 01:26:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (internal_{read,write}_func, rb_{read,write}_internal):
	  preserve errno.  a patch from Takehiro Kubo in [ruby-core:29340].
	  [ruby-core:28924]

Fri Apr  9 01:12:07 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/irb/completion.rb (CompletionProc): calling the method "methods"
	  may raise an exception.  [ruby-core:28366]

Thu Apr  8 14:33:24 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in: --disable-install-doc should prohibit doxygen.

Thu Apr  8 14:23:51 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: include errno.h before defining errnos.
	  see [ruby-core:29314]

Thu Apr  8 11:45:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/yaml.rb: use Psych if only it is loaded already.

	* lib/yaml.rb (YAML::EngineManager#yamler): set the result after
	  successfully switched.

Thu Apr  8 07:22:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rand_init): ignore higher bits if all they are same as
	  the lower sign bit.  [ruby-core:29292](2)

Thu Apr  8 07:16:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/cmd/help.rb (IRB::ExtendCommand::Help#execute): use RI
	  interactive mode if no argument.  [ruby-dev:39839]

Wed Apr  8 02:33:55 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* array.c (rb_ary_permutation): Remove limitation for lengthy permutations
	  [ruby-core:29240]

	* test/ruby/test_array.rb: ditto

Wed Apr  7 23:33:55 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* misc/ruby-mode.el (ruby-mode-map): binded C-c C-c and C-c C-c C-u
	  to comment-region and uncomment-region. Thanks Michael Klishin!
	  [Feature #872] [ruby-core:20552]

Wed Apr  7 21:44:14 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (ASCTIME): unused macro removed.

Wed Apr  7 16:45:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): reverted r27244.

Wed Apr  7 11:49:34 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/quickpath.rb (REXML::QuickPath::predicate):
	  fix regexp.

Wed Apr  7 09:44:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): quote init-commands.

	* configure.in (Makefile): `make ruby` builds ruby command
	  even if RUBY_INSTALL_NAME is customized or it has extension.

Wed Apr  7 03:28:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb (RDoc#{initialize,setup_output_dir}):
	  initialize @last_created and use it.

Wed Apr  7 02:05:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in: not define $extout to make target in cwd.

Tue Apr  6 23:01:35 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h: Introduce UNINITIALIZED_VAR() macro.
	* thread.c (do_select): Use UNINITIALIZED_VAR() instead FAKE_FD_ZERO().
	  Also, remove FAKE_FD_ZERO completely. [Feature #3018]

Tue Apr  6 14:53:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: check definition existence before defining
	  errno macros.

	* win32/win32.c (errmap): define winsock errors mappings.
	  these are VC++10 support. see [ruby-core:29278]

Tue Apr  6 21:55:25 2010  Tanaka Akira  <akr@fsij.org>

	* configure.in: test localtime(3) overflow.  [ruby-dev:40910]

	* time.c (rb_gmtime_r): renamed from rb_gmtime.
	  (rb_localtime_r): renamed from rb_localtime.
	  (rb_localtime_r2): call rb_localtime_r and validate the result if
	  there is overflow problem.
	  (rb_gmtime_r2): call rb_gmtime_r and validate the result if there
	  is overflow problem.

Tue Apr  6 11:21:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in: hooks for extconf.rb.

Tue Apr  6 06:19:36 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/text.rb (REXML::Text.check): comment out
	  broken logic.

Tue Apr  6 05:59:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/parsers/baseparser.rb (LETTER, DIGIT):
	  always use POSIX charclass.

	* lib/rexml/parsers/baseparser.rb (NAMECHAR):
	  remove duplicated range.

	* lib/rexml/xmltokens.rb (NCNAME_STR, NAMECHAR): ditto.

	* lib/rexml/parsers/xpathparser.rb (PathExpr): ditto.

	* lib/rexml/text.rb (REXML::Text#initialize):
	  initialize @parent.

Mon Apr  5 19:54:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (make_regexp): use onig_new_with_source to keep
	  sourcefile and sourceline.

	* re.c (onig_new_with_source): copied from onig_new in
	  regcomp.c for keep sourcefile and sourceline.

Mon Apr  5 13:20:45 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h, win32/win32.c (EWOULDBLOCK): VC10 already
	  defined EWOULDBLOCK.  based on a patch from Charlie Savage,
	  see [ruby-core:29255]

Mon Apr  5 13:10:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/psych/lib/psych/core_ext.rb: remove before alias.

	* ext/syck/lib/syck.rb: don't warn called by itself.

Mon Apr  5 13:08:24 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/mkexports.rb (each_export): VC10 support.
	  a patch from Charlie Savage in [ruby-core:29254]

Sun Apr  4 22:18:32 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (cmp): optimize for fixnums.
	  (lt): use cmp.
	  (gt): ditto.
	  (le): ditto.
	  (ge): ditto.
	  (wlt): use wcmp.
	  (wgt): ditto.
	  (wle): ditto.
	  (wge): ditto.
	  (time_subsec): use wmod.

Sun Apr  4 10:04:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/ruby.h: replace snprintf and vsnprintf by
	  ruby_snprintf and ruby_vsnprintf. [ruby-dev:40909]

	* configure.in: don't check snprintf(3) and vsnprintf(3).

	* include/ruby/missing.h: don't declare snprintf and vsnprintf.

	* include/ruby/ruby.h: include stdarg.h.

	* sprintf.c: include vsnprintf.c

	* vsnprintf.c: renamed from missing/vsnprintf.c.

	* vsnprintf.c: remove useless ifdefs.

	* win32/mkexports.rb: use ruby_snprintf and ruby_vsnprintf.

Sun Apr  4 09:44:01 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (lt): call <=> instead of <.

Sun Apr  4 06:46:16 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* lib/yaml: Moved to ext/syck/lib, Syck only uses Syck constant.
	* lib/yaml.rb: Added an engine manager for choosing YAML engine.
	* ext/syck/lib/syck/rubytypes.rb: squashed warnings when using Psych

Sat Apr  3 22:47:51 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: don't define STRUCT_WIDEVAL.

Sat Apr  3 18:15:02 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb (RDoc#{setup,update}_output_dir): store mtimes
	  per files in the flag file.

	* lib/rdoc/rdoc.rb (RDoc#normalized_file_list): skip already
	  processed and unmodified files.

Sat Apr  3 15:09:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (rdoc): no force-update, and add RDOCFLAGS.

	* lib/rdoc/options.rb (RDoc#parse): no-force-update option.

Sat Apr  3 10:51:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_rand): raise ArgumentError on nil, as the
	  documentation implies.  [ruby-core:29075]

	* random.c (rb_f_rand): mentioned the case of when max is nil.

Sat Apr  3 06:56:11 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* array.c (rb_ary_product): Accept a block [ruby-core:29045]

Sat Apr  3 04:46:00 2010  Tanaka Akira  <akr@fsij.org>

	* tool/file2lastrev.rb (VCS#relative_to): path and @srcdir may have
	  different relative-ness.

Sat Apr  3 03:19:01 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/benchmark.rb (Benchmark::Tms#add): fix NameError.
	  [ruby-dev:40906]

	* test/benchmark/test_benchmark.rb: add a test for above.

Sat Apr  3 01:50:02 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser/ruby.rb (RDoc#make_message): no empty lines.

	* lib/rdoc/stats.rb (RDoc::Normal#print_file): send to stdout and
	  flush always

Sat Apr  3 00:03:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/class_module.rb (RDoc#merge): get rid of stack overflow.

	* lib/rdoc/parser/c.rb (RDoc#handle_method): see source files in
	  source directory.

Fri Apr  2 22:13:38 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb: reverted r27186 to add generators.

Fri Apr  2 21:17:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS: added reverse_lookup option.

Fri Apr  2 15:26:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rdoc/test_rdoc_ri_driver.rb (with_dummy_pager): don't grasp
	  the terminal.

Fri Apr  2 14:43:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb (RDoc::Generator): defer by autoload.

	* lib/rdoc/generator/darkfish.rb: use normal library instead of
	  gem.

Fri Apr  2 14:26:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb (RDoc::RDoc#parse_files): don't branch by
	  RUBY_VERSION.  reapplied r24990.

	* lib/rdoc/rdoc.rb (RDoc::RDoc#parse_files): emacs local variables
	  are delimited by a semicolon.  supported Vim style.  reapplied
	  r24988 with fixing a typo for shebang.

Fri Apr  2 14:16:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser/ruby.rb (RDoc::Parser::Ruby): parse also rdoc
	  files.  reapplied r24976.

	* lib/rdoc/parser/c.rb: fixed a small error in the documentation.
	  [ruby-core:24744]  reapplied r24395.

	* lib/rdoc/parser.rb (RDoc::Parser.binary?): blksize may be nil
	  and is irrelevant to whether a file is binary.  TAB and newlines
	  would be usually considered to be included in text data.
	  reapplied r23071 and r24297.

Fri Apr  2 13:59:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths): Gem::Enable has been
	  obsolete.  reapplied r24599.

	* lib/rdoc/ri/paths.rb: follows $ridir.  reapplied r23554.

	* lib/rdoc/ri/paths.rb (RDoc::HOMEDIR): expand_path deals with
	  platform dependent environments.  reapplied r21312.

Fri Apr  2 12:52:25 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/parser.rb (binary?): regression.

Fri Apr  2 11:54:49 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (init_env): wrong calculation of the head of setenv
	  string.  [ruby-core:29216]
	  a patch from Heesob Park in [ruby-core:29218]

Fri Apr  2 08:24:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (ruby_setsid): split from proc_setsid.

	* process.c (proc_daemon): use EXIT_SUCCESS instead of magic number.

Fri Apr  2 07:00:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cptr.c (rb_dlptr_inspect): fix format specifiers.

Fri Apr  2 05:38:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (InitVM): calls per-VM initialization in
	  single VM, but does nothing in MVM.

Fri Apr  2 02:56:56 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: New instance methods:
	  empty? [ruby-core:26284], each, each_with_index [ruby-core:28400],
	  conjugate, conj, imaginary, imag, real, real?, rectangular, rect
	  [ruby-core:26285]

	  Removed compare_by*, inspect_org, cf [ruby-core:26268]

	  Matrix.empty: raise on negative sizes

	  Matrix.determinant: raise on rectangular matrices [ruby-core:28271]

Thu Apr  1 17:17:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/iso2022.trans: CP50221 supports 8bit JIS.

Thu Apr  1 16:44:00 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc, test/rdoc: Imported RDoc 2.5

Thu Apr  1 14:30:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/utf_16{be,le}.c (utf16{be,le}_mbc_to_code): simplified.

Thu Apr  1 14:07:51 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (BSD__hdtoa): don't use C99 macros. (FP_NORMAL etc)

Thu Apr  1 13:30:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (rb_str_format): support %a format. [ruby-dev:40650]

	* missing/vsnprintf.c (BSD_vfprintf): ditto.

	* missing/vsnprintf.c (cvt): ditto.

	* util.c (BSD__hdtoa): added.  This is 2-clause BSDL licensed
	  by David Schultz and from FreeBSD.

	* LEGAL: add about hdtoa() in util.c.

Thu Apr  1 13:24:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): return 0.0 if hexadecimal and
	  badcheck is FALSE: Float("0x1p+0") works, but "0x1p+0".to_f
	  doesn't. [ruby-dev:40650]

	* util.c (ruby_strtod): allow hexadecimal integers.

Thu Apr  1 13:20:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/scanf.rb: support %a format. [ruby-dev:40650]

Thu Apr  1 12:04:10 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (PRE_TIMET_PREFIX): define if configure doesn't
	  defines it.  [ruby-core:29190]

Thu Apr  1 11:36:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_initialize): fixed a rdoc miss that textmode and
	  binmode flag explanation was reversed each other.  a patch from
	  Heesob Park in [ruby-core:29166].

Thu Apr  1 09:54:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RUBY_{DEFAULT,NEVER}_FREE): added.
	  [ruby-dev:40889]

Thu Apr  1 04:55:08 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (rb_big_abs_find_minbit): fix handling the last word.

Thu Apr  1 04:30:11 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (long_mul): overflow condition changed.
	  (wi_mul): ditto.

Wed Mar 31 23:33:29 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (long_mul): extracted from mul and avoid integer overflow.
	  (wi_mul): extracted from wmul and avoid integer overflow.

Wed Mar 31 21:30:38 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: less bignum allocations.

	* strftime.c (rb_strftime_timespec): defined to avoid rational for
	  nano second resolution time.

Wed Mar 31 16:05:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rake/test_{package_task,rules,task_manager}.rb: use
	  temporary directories.

Wed Mar 31 13:53:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rubygems/gemutilities.rb (setup, teardown):
	  Object#to_yaml must use syck on RubyGem.

Wed Mar 31 06:57:14 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (timew2timespec): fix previous change.

Wed Mar 31 00:32:19 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (wdivmod): renamed from wdivmodv.  fix neg/pos and pos/neg.
	  (split_second): return number of seconds as wideval_t.
	  (timet2wv): new function.
	  (wv2timet): new function.
	  (timet2wideval): removed.

Tue Mar 30 22:24:19 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: use more polymorphic operations.

Tue Mar 30 22:12:38 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add URI.decode and URI.encode to Obsoleted methods,
	  and fix typos. [ruby-dev:40852]

	* NEWS: add Time#subsec.

Tue Mar 30 22:07:12 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: reorder wide value implementation.

Tue Mar 30 22:00:44 2010  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb.rb: support [Feature#988], [ruby-core:21177].
	* lib/irb/context.rb: fix Context#verbose?.

Tue Mar 30 21:56:33 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: make wide value more polymorphic.

Tue Mar 30 21:18:32 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/psych/extconf.rb: install psych .so to not psych/ but direct.
	  This prepends to install *.rb files to psych/psych.

	* ext/psych/lib/psych.rb: require 'psych.so'.

Tue Mar 30 20:55:14 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (w2v): renamed from w2xv.
	  (v2w): renamed from xv2w.
	  (rb_time_magnify): takes wideval_t.
	  (rb_time_unmagnify): returns wideval_t.

Tue Mar 30 19:46:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/psych/lib: moved external library dependent files from lib.
	  [ruby-core:29129]

Tue Mar 30 18:25:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_dirname): split from rb_file_s_dirname.

	* load.c (rb_f_require_relative): use absolute path instead of
	  expanded path.

Tue Mar 30 13:57:08 2010  Akinori MUSHA  <knu@iDaemons.org>

	* process.c (proc_daemon): Process.daemon should raise an error on
	  failure regardless of whether the implementation uses daemon(3)
	  or not. [ruby-dev:40832]

Tue Mar 30 13:11:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/file2lastrev.rb (VCS::GIT_SVN): removed because git-log can
	  deal with git-svn repository faster than git-svn-info.

	* tool/file2lastrev.rb (VCS#get_revisions): particular commands do
	  not depend on instance.

Tue Mar 30 08:55:50 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/extconf.rb: Making library detection more agnostic.

Tue Mar 30 08:10:59 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* lib/psych.rb: Fix problem with empty and white-space only strings.
	  Thanks Peter McLain!
	* test/psych/test_psych.rb: tests for change.

Tue Mar 30 05:31:39 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* lib/psych.rb: documentation updates.  Thanks Peter McLain!
	* lib/psych/{coder,tree_builder}.rb: ditto

Tue Mar 30 03:56:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/psych/{emitter,parser,psych}.c: move variable
	  declaration to the first of the block.

Mon Mar 29 21:47:44 2010  Akinori MUSHA  <knu@iDaemons.org>

	* prelude.rb, .document: Stuff in prelude.rb should be documented
	  as well.

Mon Mar 29 20:23:05 2010  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/matrix.rb(Vector#each2, Vector#collect2): add type check for
	  Integer[Bug #2495].

Mon Mar 29 19:45:09 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: wide value condition changed.

Mon Mar 29 18:10:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (Numeric): accept rationals.

Mon Mar 29 15:10:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#open): re-open with same mode and
	  options as initialize.

Mon Mar 29 09:16:45 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c: change include order; ruby.h should be at first.

Mon Mar 29 06:47:25 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/psych/*: importing Psych to trunk
	* test/psych/*: ditto
	* lib/psych/*: ditto

Sun Mar 28 10:03:51 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/scanf.rb: fix max width modifier for %f.

Sun Mar 28 10:35:45 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.6.0 r5717.
	* test/minitest/*.rb: ditto.

Sun Mar 28 10:12:28 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (rb_time_magnify): fix for LP64.

Sun Mar 28 09:28:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/scanf.rb: fix %[egEFG] isn't accept.

Sun Mar 28 09:53:02 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: rename small integer specialization related identifiers.

Sun Mar 28 08:20:37 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (weq): specialize for small integer.
	  (wne): ditto.
	  (wlt): ditto.
	  (wgt): ditto.
	  (wle): ditto.
	  (wge): ditto.
	  (rb_time_magnify): ditto.
	  (rb_time_unmagnify): ditto.
	  (rb_time_unmagnify_to_float): new function to avoid rational for
	  Time#to_f and Time#-.

Sun Mar 28 07:12:41 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (mul): condition refined.

Sun Mar 28 02:14:13 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: fix previous commit.

Sat Mar 27 23:17:52 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: use 64bit arithmetic even on platforms with 32bit VALUE.

Fri Mar 26 23:52:07 2010  wanabe  <s.wanabe@gmail.com>

	* NEWS: add Thread#add_trace_func and Thread#set_trace_func.

Fri Mar 26 22:58:10 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/openssl/ossl_x509store.c (ossl_x509store_initialize): initialize
	  store->ex_data.sk.  a patch from Christian Holtje in
	  [ruby-core:28907].  [ruby-core:23971] [ruby-core:18121]

Fri Mar 26 19:55:41 2010  Akinori MUSHA  <knu@iDaemons.org>

	* Makefile.in (DOXYGEN): Define a missing variable DOXYGEN.  Build
	  has been failing when doxygen(1) is found by configure but the
	  variable is not defined by the system and make(1) does not allow
	  an empty command. ("@$(DOXYGEN)" was the cause)

Fri Mar 26 19:28:03 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* test/ruby/test_hash.rb (test_recursive_key): recursive keys are
	  permitted now.  [ruby-dev:40735]

Fri Mar 26 12:36:10 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* lib/yaml/basenode.rb: deprecating YPath methods

	* lib/yaml/stream.rb: deprecating YAML::Stream#edit

Fri Mar 26 12:29:28 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* lib/yaml/encoding.rb: YAML.encode, YAML.decode are deprecated.

	* lib/yaml/stringio.rb: yaml/stringio.rb is deprecated.

	* lib/yaml/ypath.rb: YAML::YPath is deprecated.

Fri Mar 26 04:52:19 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: fix [ruby-core:28901] [Bug #2997].
	  Thanks, Michael Graff.

	* ext/tk/tcltklib.c: use xfree() for memories allocated by ALLOC().

	* ext/tk/tkutil/tkutil.c: ditto.

	* ext/tk/lib/tkextlib/version.rb: forgot updating.

Thu Mar 25 23:53:22 2010  wanabe  <s.wanabe@gmail.com>

	* thread.c (thread_reset_event_flags): set flags to thread.  [Bug #693]

Thu Mar 25 23:17:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* file.c (rb_get_path_check): prefer #to_path over #to_str.  a patch
	  originally written by me, and modified by Nobuyoshi Nakada.
	  [ruby-core:24257]

Thu Mar 25 18:10:08 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: Array#{uniq,uniq!} can take a block. see [ruby-dev:37998]

Thu Mar 25 17:21:49 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add IO#autoclose=, IO#autoclose?, IO#codepoints,
	  IO#each_codepoint.

Thu Mar 25 14:50:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_{read,write}): fix handle leaks.  based on
	  a patch from Heesob Park in [ruby-core:28919].  [ruby-core:28833]

Thu Mar 25 12:37:37 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add Kernel#singleton_class.

Thu Mar 25 11:34:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* bignum.c, node.h, strftime.c, enc/trans/utf8_mac.trans:
	  added explicit casts for suppressing warnings.

Thu Mar 25 11:34:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* test/ruby/test_dir_m17n.rb: HFS+ escapes invalid byte sequences of
	  filenames.

Thu Mar 25 05:44:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_version): needs runnable CPP.

Thu Mar 25 04:42:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot (package): take a breath for HP-UX make
	  [ruby-core:28938].

	* tool/make-snapshot (Dir.mktmpdir): for 1.8.6 backward compatibility.

	* tool/make-snapshot (package): $: no longer contains ".", in trunk.

Thu Mar 25 03:52:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/charset_alias.rb: update of URL.  [ruby-dev:38360]

Wed Mar 24 23:43:40 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (thread_create_core): let new thread inherit RUBY_EVENT_VM
	  of event_flags.  [ruby-core:25191]

	* thread.c (rb_threadptr_exec_event_hooks): delete RUBY_EVENT_VM if
	  all event_hooks are removed.

Wed Mar 24 22:58:02 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* configure.in: revert the previous commit, which seemed to break make
	  install.  The files of standard libraries are directly installed to
	  $(PREFIX)/lib/ruby instead of $(PREFIX)/lib/ruby/1.9.1

Wed Mar 24 18:16:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LDSHARED, CPP): keep $(CC).  [ruby-core:28912]

Wed Mar 24 14:33:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_read): limit read size to 16KB if the file
	  seems to be console.  [ruby-core:28902]

Wed Mar 24 10:18:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_expand_path): set length of string before calling
	  rb_enc_check because rb_enc_check scans its content.
	  This prevents warnings by valgrind.

Tue Mar 23 23:58:51 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Incorporating the fixes from the recent
	  FasterCSV releases:  1.5.2 and 1.5.3.  New parser
	  by Tim Elliott.  [ruby-core:25038]

Tue Mar 23 18:35:46 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* object.c (rb_obj_singleton_class): new method
	  Kernel#singleton_class.  [ruby-core:21702]

Tue Mar 23 01:13:59 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket: use rsock_ prefix for internal initialization functions.

Mon Mar 22 20:32:22 2010  wanabe  <s.wanabe@gmail.com>

	* proc.c (rb_method_location): return attr's location if it is setup.
	  [Feature #2084]

	* NEWS: follow above.

	* vm_method.c (rb_add_method): save attr's location.

	* gc.c (mark_method_entry): mark attr's location.

	* method.h (rb_method_definition_t): add member to save attr's location.

	* vm_eval.c (vm_call0): follow above.

	* vm_insnhelper.c (vm_call_method): ditto.

	* vm_method.c (rb_method_definition_eq): ditto.

Mon Mar 22 19:31:06 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (Date#>>): fixed.  [ruby-core:28011]

Mon Mar 22 18:01:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RMDIRS): use rmdir -p if possible.

	* Makefile.in ({dist,real}clean-ext): fix for removing ext
	  directories.

Mon Mar 22 09:06:10 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/.document: extracted from ext/.document.

Mon Mar 22 00:50:33 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (rsock_revlookup_flag): declared.

Mon Mar 22 00:01:24 2010  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (config.h): RUBY_EXEC_PREFIX defined.

Sun Mar 21 00:46:29 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form_component):
	  convert strings of HTML5 ASCII incompatible encoding
	  to UTF-8.

	* lib/uri/common.rb (URI.encode_www_form_component):
	  "\x83\x41" of Shift_JIS should be encoded as "%83A".
	  This follows real implementations.

	* lib/uri/common.rb (URI.decode_www_form_component):
	  use given encoding for force_encoding. [ruby-dev:40721]

Sun Mar 21 21:09:17 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv-replace.rb: specify super class for rdoc.

	* lib/ipaddr.rb: ditto.

Sun Mar 21 19:52:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_initialize): add autoclose argument to control close
	  at finalization.  [ruby-core:26222]

	* io.c (rb_io_autoclose_p, rb_io_set_autoclose): new methods.

Sun Mar 21 19:50:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket: make sources rdoc friendly.

Sun Mar 21 17:57:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (IO_RBUF_CAPA_FOR): use large buffer as cbuf if readconv is
	  needed for performance improvement.  based on a patch by Roger Pack
	  in [ruby-core:28163].  [ruby-core:28162]

Sun Mar 21 17:14:49 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: reuse hash object.

Sun Mar 21 12:32:39 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (transcode_compile_tree): make
	  valid_encoding mandatory unless from_encoding is registered in
	  ValidEncoding.
	  (transcode_tbl_only): ditto.
	  (transcode_tblgen): ditto.
	  (ValidEncoding): new function.

	* enc/trans/escape.trans: specify valid_encoding.

	* enc/trans/emoji_sjis_docomo.trans: ditto.

	* enc/trans/emoji.trans: ditto.

	* enc/trans/emoji_iso2022_kddi.trans: ditto.

	* enc/trans/big5.trans: ditto.

	* enc/trans/emoji_sjis_softbank.trans: ditto.

	* enc/trans/emoji_sjis_kddi.trans: ditto.

	* enc/trans/chinese.trans: use ValidEncoding() instead of
	  ValidEncoding[].

Sun Mar 21 09:43:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (IO_[CRW]BUF_CAPA_MIN): replaced magic numbers.

Sun Mar 21 09:22:10 2010  Tanaka Akira  <akr@fsij.org>

	* object.c (rb_obj_hash): use LONG2FIX to avoid Bignum allocation.

Sat Mar 20 22:51:46 2010  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_sum): use UCHAR_MAX.

Sat Mar 20 19:16:42 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (ActionMap.unambiguous_action): use
	  Array#delete.
	  (ActionMap.merge2): defined.
	  (ActionMap::PostMemo): removed.
	  (transcode_compile_tree): use ActionMap.merge2.

Sat Mar 20 13:26:09 2010  Tanaka Akira  <akr@fsij.org>

	* array.c (rb_ary_uniq_bang): the array is already unique if the
	  length is zero or one.
	  (rb_ary_uniq): ditto.

Sat Mar 20 12:30:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib: fixed typo.  a patch by Sho Hashimoto in [ruby-dev:40716].

Sat Mar 20 11:32:18 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (each_firstbyte_range): tuned for less
	  method calls.

Sat Mar 20 00:59:50 2010  wanabe  <s.wanabe@gmail.com>

	* ext/dl/lib/dl/pack.rb (DL#pack): allow LLP64.

Fri Mar 19 05:26:31 2010  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_sum): don't call method for each byte.

Thu Mar 18 21:24:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (miniruby): link $(NORMALMAINOBJ).

Thu Mar 18 19:52:27 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: scan singleton mappings sequentially.

Thu Mar 18 06:28:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_EXEC_PREFIX): added to config.h.

	* ruby.c (ruby_init_loadpath_safe): TMP_RUBY_PREFIX should be
	  exec_prefix, not rubylibprefix.  [ruby-core:28718]

	* version.c (RUBY_LIB_PREFIX): fallback to RUBY_EXEC_PREFIX.

Thu Mar 18 05:58:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_{to_i,mod,divmod,div2}):
	  removed unused variables.

Thu Mar 18 04:40:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_intern3): get rid of type-punning cast.

Thu Mar 18 02:29:42 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_build_body): add mark to jump table hash of case.

Thu Mar 18 00:58:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): Add support for Hexadecimal
	  floating-point expression [ruby-dev:40650] #2969

Thu Mar 18 00:00:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.{en,de}code_www_form_component):
	  renamed from URI.{en,de}code_www_component. [ruby-dev:40672]

	* lib/uri/common.rb (URI.encode_www_form_component): %-encoded
	  element should have always two hex.

	* lib/uri/common.rb (URI.encode_www_form_component):
	  better treatment for ASCII incompatible encodings and
	  encodings whose lead byte may use 7bit.

	* lib/uri/common.rb (URI.decode_www_form_component): add %20.

	* lib/uri/common.rb (URI.decode_www_form_component): add
	  result's encoding as 2nd argument.

	* lib/uri/common.rb (URI.decode_www_form): added.

Wed Mar 17 16:25:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_aset): allow recursive key.  [ruby-core:24648]

Wed Mar 17 06:39:59 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.h (rb_warning, rb_sys_warning): fixed typo in rdoc.
	  [ruby-core:28696]

Wed Mar 17 02:29:46 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c, iseq.c, ruby.c, vm.c, vm_core.h, vm_eval.c: add absolute
	  path field into rb_iseq_t.  The field contains a string representing
	  a path to corresponding source file. or nil when the iseq is created
	  from -e, stdin, eval, etc.  This field is used for require_relative.
	  [ruby-dev:40004]

	* load.c (rb_f_require_relative): add C implementation of
	  require_relative.

	* prelude.rb (require_relative): get rid of Ruby implementation of
	  require_relative.

Wed Mar 17 01:24:01 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (rb_intern3): prohibit Symbol with an invalid encoding.
	  [ruby-core:24621]

	* test/ruby/test_m17n_comb.rb: modify a test for above.

Tue Mar 16 22:51:11 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: specialize for singleton mappings.

Tue Mar 16 20:13:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* enc/trans/emoji.trans: added codepoints leading 0xf4 into
	  nomap_table.

Tue Mar 16 17:33:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpCtoV): keep e's sign.
	  When e doesn't over flow e * BASE_FIG but overflow e * 10,
	  e will overflow.

Tue Mar 16 17:18:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (rb_str_conv_enc_opts): missing prototype.

Tue Mar 16 15:20:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tmpdir: split from lib/tmpdir.rb.

	* win32/win32.c (rb_w32_system_tmpdir): extracted from init_env.

	* win32/win32.c (rb_w32_getcwd): removed duplicated code.

Tue Mar 16 14:06:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (ENC_TO_ENCINDEX): suppress warnings.

Tue Mar 16 14:03:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RSHIFT): parenthesize the argument of cast instead
	  of the result.

Tue Mar 16 11:23:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): ignore dname if it has different
	  drive letter or UNC.

Tue Mar 16 07:16:56 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: redundant loop removed.

Tue Mar 16 07:01:43 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: refactored to use tree as memo key.

Tue Mar 16 04:05:13 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: more info in generating macro names.

Mon Mar 15 21:58:03 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: ActionMap#each_firstbyte inlined.

Mon Mar 15 21:22:49 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (transcode_tblgen): add valid_encoding
	  optional argument.

	* enc/trans/single_byte.trans use valid_encoding argument for
	  transcode_tblgen.

	* enc/trans/chinese.trans: ditto.

Mon Mar 15 18:33:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (default_rand): removed initial buffer.

	* random.c (Init_RandomSeed): initialize seed of default random.

	* random.c (Init_RandomSeed2): turn the seed to Bignum object.

Mon Mar 15 17:28:30 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_print): RDoc update.  a patch from Daniel Kelley
	  in [ruby-core:28643].

Mon Mar 15 14:06:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (next_state): no initialization here.

	* random.c (default_mt): always return initialized MT.

Mon Mar 15 11:49:48 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rb_reset_random_seed): set seed in this.
	  [ruby-core:28655]

Mon Mar 15 10:26:02 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: import latest nkf. [master 9306cb0]
	  this also fixes [ruby-dev:40607]

Mon Mar 15 09:34:17 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_component):
	  call str.to_s at first.

Mon Mar 15 09:36:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* symbian/README.SYMBIAN: fixed broken patch and converted to
	  unified diff.

Mon Mar 15 07:51:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (Init_File): do not define File::ALT_SEPARATOR on cygwin.

Mon Mar 15 07:41:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (realpath_rec): use same cache.

	* file.c (realpath_internal): regulate separators in prefix.
	  [ruby-core:28653]

	* file.c (FILE_ALT_SEPARATOR): separated condition.

Mon Mar 15 04:41:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_each_codepoint): read directly when readconv is
	  needed but internal encoding is not set.  [ruby-core:28650]

Mon Mar 15 04:18:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/file2lastrev.rb (VCS::{SVN,GIT}#get_revisions):
	  use block argument 'path' to get the path given by super.

Mon Mar 15 02:43:59 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (Action#hash): defined.
	  (Action#eql?): ditto.
	  (Action#==): ditto.

Mon Mar 15 01:52:46 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: refactored.

Mon Mar 15 01:18:31 2010  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (*.pkg): Ruby Core installation separated from standard extensions.

	* symbian/configure.bat: ditto.

	* symbian/README.SYMBIAN: ditto.

	* symbian/setup (config.h): support for 2nd internal drive added.

Mon Mar 15 00:11:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/file2lastrev.rb (VCS::GIT_SVN#get_revisions) :
	  use block argument 'path' to get the path given by super.

	* tool/file2lastrev.rb (VCS::GIT#get_revisions):
	  use double quotes for Windows.
	  patched by Vladimir Sizikov [ruby-core:28651]

Sun Mar 14 22:38:31 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: consider valid_encoding for max_input.

Sun Mar 14 15:46:09 2010  Tanaka Akira  <akr@fsij.org>

	* enc/trans/emoji.trans: fix nomap_table.

Sun Mar 14 09:50:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (insn_data_to_s_detail), iseq.c (insn_operand_intern):
	  fixed format specifiers.

Sun Mar 14 07:20:17 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (EXPAND_PATH_BUFFER): make it back to usascii, to prevent
	  infinite loop on some platform. [ruby-dev:40629]

Sun Mar 14 02:40:38 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: reject ambiguous mapping.

	* enc/trans/single_byte.trans: remove ambiguous mapping such as
	  \xD6 -> U+05F2 and \xD6\xC7 -> U+FB1F in Windows-1255

Sat Mar 13 23:48:27 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (file_expand_path): should not just copy the encoding
	  from fname.  [ruby-core:28635]

	* file.c (EXPAND_PATH_BUFFER): set filesystem_encoding, not
	  usascii for path buffer.

Sat Mar 13 17:48:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/file2lastrev.rb: refactored.  fixed changed revision of git.

Sat Mar 13 15:44:20 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_print): should not print field separator at the end
	  of arguments.  [ruby-talk:358633]

Sat Mar 13 14:49:55 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_join): remove Enumerable#join. [ruby-core:24786]

	* array.c (ary_join_1): use #to_ary to detect recursive array.

Sat Mar 13 12:26:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h (MakeOpenFile): finalize fptr to get rid of
	  memory leak.

Sat Mar 13 11:14:26 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* load.c (rb_get_expanded_load_path): expand paths if any item in $:
	  is not a string.

Sat Mar 13 10:16:32 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* load.c (rb_get_expanded_load_path): does not expand paths if all
	  the items in $: are absolute paths.  [ruby-core:28113]

Sat Mar 13 10:03:52 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: fix [Bug #2840] Tk doesn't built in mingw.

Sat Mar 13 03:24:15 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: show consumed time at last.

Sat Mar 13 00:44:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_basename): check encoding of suffix.

Sat Mar 13 00:11:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): mark initial load paths.

	* gem_prelude.rb (push_all_highest_version_gems_on_load_path):
	  search insertion position by initial load path mark.

	* lib/rubygems.rb (Gem.load_path_insert_index): ditto.

Fri Mar 12 21:34:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: emoji encodings.

Fri Mar 12 17:14:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form): new method to
	  generate URL-encoded form data. [ruby-dev:39246]

	* lib/uri/common.rb (URI.encode_www_component,
	  URI.decode_www_component): new method for encode/decode
	  a name/value of HTML form.

Fri Mar 12 17:36:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httpservlet/cgihandler.rb
	  (WEBrick::HTTPServlet::CGIHandler#do_GET):
	  set binary mode for tempfile.
	  http://pc12.2ch.net/test/read.cgi/tech/1265467681/286

Fri Mar 12 13:52:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* tool/compile_prelude.rb: TMP_RUBY_PREFIX should replace
	  rubylibprefix but not prefix.

Fri Mar 12 09:43:11 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* complex.c (f_signbit): remove condition for signbit because
	  all platforms have signbit from r26871.

Fri Mar 12 07:25:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (init_env): get rid of alloca() for outer string.

Fri Mar 12 07:17:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/racc/cparse/cparse.c: suppressed warnings for shortening on
	  platforms where pointer is bigger than int.

Fri Mar 12 07:15:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe, ruby_init_gems): set and remove
	  TMP_RUBY_PREFIX.

	* variable.c (rb_const_remove): new function.

	* tool/compile_prelude.rb: split each preludes.

Fri Mar 12 07:09:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (config.status): setup MINIRUBY environment for
	  cross-compiling.

Fri Mar 12 06:48:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/extconf.rb: log() is built-in in some compilers and needs
	  proper declaration.

Fri Mar 12 06:37:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sample/timeout.rb: split from lib/timeout.rb.

Thu Mar 11 22:35:27 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (time_round): new method Time#round.  [ruby-dev:40595]

Thu Mar 11 17:31:59 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (str_transcode0): confirm the code range.

Thu Mar 11 12:14:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/signbit.c: added.

Thu Mar 11 11:16:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check if target_archs has changed.

Thu Mar 11 01:33:30 2010  wanabe  <s.wanabe@gmail.com>

	* win32/win32.c (signbit): allow x64.

Thu Mar 11 01:04:48 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* iseq.c (rb_iseq_clone): sets local_iseq and klass properly.

Wed Mar 10 21:25:41 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* enum.c (min_ii, max_ii, minmax_ii): remove wrong optimization that
	  reuses array for yield parameter, which caused unexpected behavior.
	  [ruby-core:25989]

Wed Mar 10 12:10:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* enc/x_emoji.h: renamed from enc/x-emoji.c.

Wed Mar 10 04:17:08 2010  Koichi Sasada  <ko1@atdot.net>

	* compile.c (defined_expr), insns.def (defined): fix to pass a Symbol
	  object such as :$foo for the "defined?($foo)" expression
	  on defined instruction.  This patch fixes ISeq#to_a/load.

Tue Mar  9 20:50:09 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/dl/test_method.rb: delete a residual test for dl on libffi.

Tue Mar  9 18:00:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* enc/trans/EMOJI/*.src, enc/trans/emoji*,
	  enc/x-emoji.c, test/ruby/enc/test_emoji.rb,
	  tool/enc-emoji-citrus-gen.rb, tool/enc-emoji4unicode.rb,
	  tool/jisx0208.rb, tool/test/test_jisx0208.rb:
	  new encodings to support emoji charsets, which are used by
	  Japanese mobile phones [ruby-dev:40528].
	  Thanks Yoji Shidara for a lot of contribution.

	* tool/transcode-tblgen.rb: modified for enc-emoji4unicode.rb.

Tue Mar  9 14:57:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/transcode-tblgen.rb (ActionMap#generate_node):
	  remove useless dup.

	* tool/transcode-tblgen.rb (transcode_tbl_only): remove duplicated
	  method call for encode_utf8.

Tue Mar  9 14:55:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_to_s): remove unused variable.

Tue Mar  9 12:17:34 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* tool/transcode-tblgen.rb (StrSet#parse, ActionMap#generate_node):
	  optimization (reusing object and improving memoize).
	  [ruby-dev:40582]

Sun Mar  7 02:27:03 2010  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* dln.c [DLN_NEEDS_ALT_SEPARATOR] (translit_separator): small typo
	  fixed.

	* symbian/setup (*.pkg): Shared library installation path fixed to
	  match changes in version.c.

	* symbian/setup (ruby.mmp): SOURCE dln_find.c added.

Sun Mar  7 23:14:22 2010  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big_pack): use DIGSPERLONG and BITSPERDIG.
	  (rb_big_unpack): use DIGSPERLONG.

Sun Mar  7 19:21:10 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* io.c: Fix documentation for each/each_line/lines, bytes/each_byte,
	  codepoints/each_code_point [ruby-core:23948]

	* string.c: ditto

	* ext/stringio/stringio.c: ditto

Sun Mar  7 13:49:49 2010  Tanaka Akira  <akr@fsij.org>

	* file.c: add optional basedir argument for realpath/realdirpath.
	  (realpath_internal): handle basedir.
	  (rb_file_s_realpath): extract basedir from argument list.
	  (rb_file_s_realdirpath): extract basedir from argument list.

	* lib/pathname.rb (realpath): pass basedir.
	  (realdirpath): ditto.

Sun Mar  7 02:05:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_set_filesystem_encoding):
	  filesystem encoding on Mac OS X is now
	  default external encoding. so Mac OS X is now
	  treated as one of Unix. [ruby-dev:40439]

	* file.c (file_path_convert): ditto.

Sat Mar  6 22:07:09 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: fix the prototype of rb_big2ulong_pack.

Sat Mar  6 13:45:37 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (rb_io_s_write, rb_io_s_binwrite): delete File#write and
	  #binwrite.  It may take a long time to make them stable, so 1.9.2
	  should not include them.  We need refactoring to implement them
	  again.

	* test/ruby/test_io.rb: delete tests for them.

Sat Mar  6 10:03:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (rb_io_s_binwrite): use mode "r+b" instead of "ab" to handle
	  offset correctly.  [ruby-core:28517]

	* test/ruby/test_io.rb: use assert_equal instead of assert.

Sat Mar  6 01:08:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): VC6 has __int64.

Fri Mar  5 19:36:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (econv_opts): set :undef => :replace when
	  :replace is given and :invalid is not given. [ruby-dev:40554]

Fri Mar  5 17:51:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): suppressed a warning.

	* win32/win32.c (rb_w32_map_errno, winnt_stat, rb_chsize): ditto.

	* win32/win32.c (rb_w32_aspawn): get rid of overflow.

Fri Mar  5 11:59:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (signbit): defined on mingw.

Thu Mar  4 22:49:42 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval.c (setup_exception): avoid line number 0 when setting
	  $DEBUG=true.  [ruby-dev:39116]

Thu Mar  4 22:45:02 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (io_s_write, io_s_binwrite): add File#write and #binwrite.
	  [ruby-core:21701]

	* test/ruby/test_io.rb: add tests for above.

Mon Mar  4 13:14:34 2010  wanabe  <s.wanabe@gmail.com>

	* gc.c (gc_profile_total_time): add GC::Profiler.total_time.
	  [ruby-core:27169]

	* NEWS: ditto.

Thu Mar  4 10:15:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* complex.c (m_log, m_exp): remove unused functions.

Thu Mar  4 02:34:59 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_env.rb (TestEnv#test_select_bang): add tests.

Thu Mar  4 02:29:52 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_hash.rb (TestHash#test_keep_if): fix typo.

Thu Mar  4 00:10:54 2010  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (HEX2): extracted from regexps.

Wed Mar  3 23:16:32 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* complex.c (nucomp_real_check): raise TypeError instead of
	  ArgumentError when argument is not a real as expected
	  [ruby-core:28395]

	* rational.c (nurat_int_check): ditto (for integers)

Wed Mar  3 23:07:08 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb (Vector#each): Return self and optimization
	  [ruby-core:28405]

Wed Mar  3 18:35:55 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_select_bang): add #select! and keep_if to Hash.

	* hash.c (env_select_bang): ..and to ENV.

Wed Mar  3 15:54:20 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/matrix.rb (Vector#each2, collect2): small refactoring.

Wed Mar  3 16:14:24 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/matrix.rb (Vector#each): make Vector enumerable.
	  [ruby-core:28405]

Wed Mar  3 14:28:23 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_select_bang): select! removes all elements for
	  which block returns false.  [ruby-core:27286]

	* array.c (rb_ary_keep_if): #keep_if, new method.

Wed Mar  3 06:19:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (signbit): defined.

	* win32/Makefile.sub, symbian/setup (config.h): pack.c requires
	  SIZEOF_INT*_T now.

Tue Mar  2 21:16:48 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (rb_io_lines, rb_io_bytes, rb_io_chars, rb_io_codepoints):
	  change to alias to each_*, in similar way to ARGF and String.
	  [ruby-core:23948]

Tue Mar  2 15:54:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (noname_disable_map): add NT_ANCHOR case.
	  Without this change, captured groups in anchors (look-ahead,
	  look-behind, and so on) are not removed and
	  unintended invalid backref error occur. [ruby-core:28235]

	* regcomp.c (renumber_by_map): ditto.

Tue Mar  2 14:42:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* test/dl/test_closure.rb: forget to revert at r26764.

Tue Mar  2 14:29:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_find_file_ext_safe, rb_find_file_safe): skip argument
	  checks in file_expand_path().

Tue Mar  2 13:54:44 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* test/ruby/test_math.rb: Fix lgamma test

Mon Mar  1 23:26:56 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (pty_open): refine the path for master IO.

Mon Mar  1 20:07:06 2010  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* ext/zlib/zlib.c (zstream_expand_buffer_into): remove compare
	  different type values warning.

Mon Mar  1 17:42:45 2010  wanabe  <s.wanabe@gmail.com>

	* configure.in (mingw): do not detect snprintf/vsnprintf.

Mon Mar  1 16:54:21 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/oniguruma.h: updated to follow Oniguruma 5.9.2.

	* re.c (make_regexp): use onig_new() instead of onig_alloc_init().

	* re.c (rb_reg_to_s): ditto.
Sun Feb 28 21:32:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (get_device_once): raise on error when fail is
	  non-zero.

Sun Feb 28 18:58:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* math.c (rb_eMathDomainError): new exception class
	  for representing mathematical domain error instead
	  of Errno::EDOM.

	* math.c (domain_check, infinity_check): removed,
	  no longer needed.

	* math.c (math_atan2, math_acos, math_asin, math_acosh,
	  math_atanh, math_log, math_log2, math_log10, math_sqrt,
	  math_gamma, math_lgamma): mathematical domain errors
	  are checked and raised before calling libm's functions.

	* test/ruby/test_math.rb: updated for changes of math.c.

Sun Feb 28 15:07:28 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_pack): use union to avoid pointer cast.
	  (pack_unpack): ditto.

Sun Feb 28 11:49:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* openssl/ossl.c (OSSL_IMPL_SK2ARY): for OpenSSL 1.0.
	  patched by Jeroen van Meeuwen at [ruby-core:25210]
	  fixed by Nobuyoshi Nakada [ruby-core:25238],
	  Hongli Lai [ruby-core:27417],
	  and Motohiro KOSAKI [ruby-core:28063]

	* ext/openssl/ossl_pkcs7.c (pkcs7_get_certs, pkcs7_get_crls):
	  split pkcs7_get_certs_or_crls.

Sun Feb 28 11:42:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/openssl/{test_x509cert.rb,openssl,test_x509crl.rb,
	  test_x509req.rb}:
	  fix false positive tests because of OpenSSL spec change.
	  patched by originally Hongli Lai [ruby-core:27417],
	  and fixed by Motohiro KOSAKI [ruby-core:28063]

Sun Feb 28 11:21:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/openssl/{test_x509cert.rb,openssl,test_x509req.rb}:
	  remove false positive tests because of OpenSSL spec change.
	  patched by Motohiro KOSAKI [ruby-core:28063]
	  see also [ruby-dev:40077]

Sun Feb 28 11:25:16 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_pack): generalized integer packer implemented.
	  (pack_unpack): generalized integer unpacker implemented.

Sun Feb 28 06:58:53 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (swap32): use __builtin_bswap32 on gcc 4.3.0 or later.
	  (swap64): ditto.

Sun Feb 28 00:38:18 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: use integer types with explicit size.

Sat Feb 27 15:54:55 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: check assumption on QUAD_SIZE and SIZEOF_LONG.

	* bignum.c: check assumption on SIZEOF_LONG and SIZEOF_BDIGITS.

Sat Feb 27 03:48:18 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: fix q and Q for big endian environments which have no
	  8 bytes integer type.
	  (pack_pack): use rb_big_pack.
	  (pack_unpack): use rb_big_unpack.

	* include/ruby/intern.h (rb_big_pack): declared.
	  (rb_big_unpack): ditto.

	* bignum.c (rb_big_pack): new function.
	  (rb_big_unpack): ditto.

Fri Feb 26 21:36:51 2010  Tanaka Akira  <akr@fsij.org>

	* bignum.c: fix rb_quad_pack and rb_quad_unpack for environments
	  which don't have 8bytes integer type.  This still depends on little
	  endian.
	  (rb_quad_pack): use quad_buf_complement.  don't raise for large
	  values.
	  (rb_quad_unpack): use quad_buf_complement.
	  (quad_buf_complement): new function extracted from rb_quad_pack.
	  add one after bitwise negation.

Fri Feb 26 21:29:48 2010  Tanaka Akira  <akr@fsij.org>

	* configure.in (RSHIFT): add parenthesis to suppress warning.

Fri Feb 26 20:51:47 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/socket/raddrinfo.c, ext/socket/udpsocket.c: avoid illegal cast
	  from void-returning function to VALUE-returning one.  It causes SEGV
	  on RubySpec with mingw32.

Fri Feb 26 20:07:48 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (QUAD_SIZE): it should be always 8.

	* bignum.c (rb_quad_pack): use LONG_LONG version only if
	  SIZEOF_LONG_LONG == QUAD_SIZE.

Fri Feb 26 16:49:29 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (swap64): fix for VC6.

Fri Feb 26 14:17:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_pack, pack_unpack): suppressed warnings.

Fri Feb 26 07:44:51 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl: revert dl with libffi because it can't run on mswin now.

Thu Feb 25 22:59:46 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: consider DYNAMIC_ENDIAN.  refactored.

Thu Feb 25 11:17:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* rational.c (nurat_expt): use Float#** when Rational ** Float.
	  This fixes Rational(3,1)**3.0=>26.99999999999999 on FreeBSD.

	* complex.c (rb_fexpt): removed.
	  Note that this function is not static but is private.

Thu Feb 25 00:43:57 2010  Koichi Sasada  <ko1@atdot.net>

	* insns.def: Change the operand type of setinlinecache
	  (OFFSET to IC).  This IC must be same as corresponding
	  getinlinecache instruction's IC operand.
	  This change is for a little performance improvement
	  (getting IC directly) and is for the AOT compilation development.

	* compile.c, iseq.c, insns.def: Change the approach to handling inline
	  cache (IC) type operand to enable the above change.
	  This change also affects ISeq#to_a method.  The inline cache operand
	  will be dumped by fixnum, the index of inline cache, in other words,
	  inline cache identity.

	* template/insns_info.inc.tmpl, tool/instruction.rb: No need to count
	  inline cache size (insn_iclen()).

Thu Feb 25 00:57:59 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (swap64): don't redefine.

Thu Feb 25 00:29:55 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_unpack): don't use OFF32 for gcc 4.5.

Wed Feb 24 22:39:15 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: fix [ruby-core:28320] reported by Paul Clegg.
	  (Resolv::DNS::Requester#request): raise ResolvTimeout
	  consistently for timeout.

Wed Feb 24 14:38:16 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/indexer: Removed obsolete files.

Wed Feb 24 11:52:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (translit_separator): moved back from load.c again.

	* dln_find.c: split from dln.c.

Wed Feb 24 09:31:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/digest/extconf.rb: use OpenSSL only when all transform
	  functions are available.

Wed Feb 24 00:39:17 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (str_new_empty): String#split, partition, rpartition
	  taints the resulting strings if self is tainted.

Mon Feb 22 21:35:33 2010  Tanaka Akira  <akr@fsij.org>

	* ext/digest/sha2/sha2init.c: test OpenSSL more strictly.

Mon Feb 22 11:52:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems: update to 1.3.6.

Mon Feb 22 11:21:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/digest/sha2: Use OpenSSL's SHA1 engine if available.

Sun Feb 21 21:20:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile, install_files): honor srcprefix
	  argument if given.  [ruby-dev:40449]

Sun Feb 21 13:29:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/rubygems_version.rb: outdated.  [ruby-core:28275]

Sun Feb 21 06:24:12 2010  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (config.h): HAVE_STRUCT_TIMEZONE, VOID_UNSETENV, and RUBY_LIB_VERSION_STYLE defined.
	* symbian/setup (ruby.mmp): SOURCE node.c added.

Mon Feb 22 09:15:45 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_mark_children): lost comment added.

Sat Feb 20 14:42:19 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_object0): should prepare placeholder before
	  processing instance variables.  [ruby-dev:40414]

	* marshal.c (id2encidx): no longer need arg.

Sat Feb 20 14:36:16 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm.c (vm_backtrace_each): use called_id when method definition
	  structure is already freed.  [ruby-dev:40234] [ruby-core:27959]

Fri Feb 19 00:04:19 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/drb/drb.rb (DRbServer#stop_service): join killed thread to
	  ensure service stops.  [ruby-dev:40441]

Thu Feb 18 22:31:15 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* math.c (math_atanh): raise ERANGE without calling atanh if absolute
	  value is 1 to achieve platform-independent math.  [ruby-core:28219]

	* math.c (math_lgamma): return [Infinity, 1] without calling lgamma_r
	  if argument is infinity or -infinity.  [ruby-core:28219]

Thu Feb 18 22:28:00 2010  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: new --with-ext and --with-out-ext options for extmk.
	* tool/mkconfig.rb: normalizing --with-out-ext to --without-ext.

Thu Feb 18 21:50:00 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_unpack): call PACK_ITEM_ADJUST for 'Q'.

Thu Feb 18 02:14:26 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (io_fread, io_getpartial, io_read, io_sysread): by using lock,
	  prohibit modification of buffer string during read (which had caused
	  EFAULT or SEGV).  [ruby-dev:40437]

	* test/ruby/test_io.rb: rewrite tests for the old behavior.

Wed Feb 17 21:34:01 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* regcomp.c (setup_tree, onig_compile): optimize .* at last by
	  converting into (?>.*), which does not backtrack.  [ruby-core:27791]

	* test/ruby/test_regexp.rb: add a test for above.

Wed Feb 17 21:26:53 2010  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_normal_exit): add :timeout option.

Wed Feb 17 17:05:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_cfunc): removed unused variable.

	* vm.c (vm_frametype_name): define only when VMDEBUG.

Wed Feb 17 15:34:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/dl_conversions.c (rb_dl_type_to_ffi_type): support signed
	  long long.

	* ext/dl/cfunc.c (rb_dlcfunc_inspect): get rid of overflow.

	* ext/dl/closure.c (dlc_callback, rb_dlclosure_init): ditto.

	* ext/dl/cptr.c (rb_dlptr_s_malloc): ditto.

	* ext/dl/method.c (rb_dlfunction_initialize): ditto.

Wed Feb 17 01:16:12 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* hash.c (hash_update): always raise an exception when adding a new
	  key during iteration.  Traditionally, an exception was raised only
	  when rehash occurs, but it may lead to difficult bug to reproduce.
	  [ruby-core:23614]

Tue Feb 16 22:09:27 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (chain_finalized_object): fix precedence.

Tue Feb 16 21:32:01 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (rb_objspace_call_finalizer): always run finalizer at exit,
	  before object is free'd.  [ruby-dev:40382]

Tue Feb 16 20:56:39 2010  Tanaka Akira  <akr@fsij.org>

	* file.c (rb_group_member): renamed from group_member.
	  don't use group_member() in glibc because it's not valgrind clean.
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=570047

Tue Feb 16 19:19:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): convert signed value to
	  unsigned.

Tue Feb 16 19:02:59 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/dl/test_{base,handle}.rb: use more verbose assertions.

	* test/dl/test_import.rb (DL::LIBC::BoundQsortCallback): renamed
	  to get rid of overwriting warning.

Tue Feb 16 11:03:19 2010  Aaron Patterson  <aaron@tenderlovemaking.com>

	* ext/dl/method.c: Adding DL::Method as a superclass for DL::Function

Mon Feb 15 23:37:30 2010  Tanaka Akira  <akr@fsij.org>

	* io.c: check lseek error by errno.  NetBSD 4.0.1 may return -1 as
	  a file position of tty.

Mon Feb 15 23:08:56 2010  Tanaka Akira  <akr@fsij.org>

	* lib/pstore.rb (PStore#initialize): initialize @thread_safe.
	  [ruby-core:27853]

Mon Feb 15 22:45:26 2010  Tanaka Akira  <akr@fsij.org>

	* st.c (st_foreach): don't access ptr->hash after func call.
	  It may access freed area.

Mon Feb 15 22:25:16 2010  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c (zlib_mem_alloc): suppress valgrind warnings.
	  http://www.zlib.net/zlib_faq.html#faq36

Mon Feb 15 22:18:49 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (time_add): propagate fixed time offset.

Mon Feb 15 17:42:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* signal.c (USE_SIGALTSTACK): NetBSD can't use sigaltstack(2)
	  with pthread.
	  http://netbsd.gw.com/cgi-bin/man-cgi?sigaltstack++NetBSD-current

Mon Feb 15 13:11:47 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_push_m): use rb_ary_modify instead of
	  rb_ary_modify_check. This fixes regression due to r26632.

Sun Feb 14 12:54:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): removed duplicated entry for regexp.
	  [ruby-dev:40416]

Sun Feb 14 04:45:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): register regexp object before encoding
	  name.  [ruby-dev:40414]

	* re.c (rb_reg_alloc, rb_reg_init_str): split from rb_reg_new_str.

Sat Feb 13 17:07:20 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_delete): RDoc update.  a patch from Hugh Sasse.
	  [ruby-core:28128]

	* array.c (rb_ary_compact_bang): ditto.

Sat Feb 13 15:01:24 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (id2encidx): duplicated entry for encoding name.
	  [ruby-dev:40388]

Sat Feb 13 12:17:52 2010  Tanaka Akira  <akr@fsij.org>

	* lib/tempfile.rb (Tempfile::Remover): new class to replace
	  Tempfile.callback.  port r24902 from Ruby 1.8.

Fri Feb 12 17:55:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (thread_free): fixed typo.

Fri Feb 12 02:27:39 2010  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#initialize, Set#replace, Set#merge)
	  (Set#subtract, Set#&): Fix duck type tests. [ruby-core:28078]

	* lib/set.rb (Set#initialize, Set#replace, Set#merge)
	  (Set#subtract, Set#&): Try #each if #each_entry fails.

Thu Feb 11 20:43:00 2010  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_oflags_modestr): return "r" for O_RDONLY|O_APPEND.
	  [ruby-dev:40379]

Thu Feb 11 19:19:21 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* missing/alloca.c: s/RUBY_LIB/RUBY_LIB_PREFIX/ [ruby-dev:40395]

Thu Feb 11 17:52:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_exec): reset thread state before restarting vm loop
	  from catch scope.  [ruby-core:28129], [ruby-core:28143]

Thu Feb 11 14:43:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): read sequentially since marshal source
	  may not be possible to rewind.  [ruby-dev:40386]

	* marshal.c (r_object0): replace non-1.8 escapes directly.

Thu Feb 11 09:49:31 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: fix [ruby-core:28144] reported by Hans de Graaff.
	  (Resolv::DNS#make_requester): pass nameserver_port to
	  UnconnectedUDP.new.
	  (Resolv::DNS.bind_random_port): change the is_ipv6 argument to
	  bind_host.
	  (Resolv::DNS::Requester#initialize): change instance variable to
	  store multiple sockets.
	  (Resolv::DNS::Requester#request): pass readable sockets to
	  recv_reply.
	  (Resolv::DNS::Requester#close): close all sockets.
	  (Resolv::DNS::Requester::UnconnectedUDP#initialize): allocate
	  a socket for each address family of name servers.
	  (Resolv::DNS::Requester::UnconnectedUDP#recv_reply): read from the
	  passwd readable socket.
	  (Resolv::DNS::Requester::UnconnectedUDP#sender): use appropriate
	  socket for the target nameserver.
	  (Resolv::DNS::Requester::ConnectedUDP): follow the instance variable
	  change.
	  (Resolv::DNS::Requester::TCP#sender): ditto.
	  (Resolv::DNS::Config#nameserver_port): new method.

Thu Feb 11 01:45:04 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (vm_exec): temporarily revert r26628, which causes SEGV when
	  executing rubyspec.

Wed Feb 10 16:31:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_push_m, rb_ary_unshift_m, rb_ary_aset),
	  (rb_ary_insert, rb_ary_replace, rb_ary_concat),
	  (rb_ary_uniq_bang, rb_ary_flatten_bang): check if frozen after
	  wrong number of arguments but before TypeError.
	  [ruby-core:28140]

	* hash.c (rb_hash_replace): ditto.

	* string.c (rb_str_replace): ditto.

Wed Feb 10 04:06:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_exec): reset thread state before starting vm loop.
	  [ruby-core:28129]

Tue Feb  9 23:48:25 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_divide): fix precision too.

Tue Feb  9 23:26:07 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_DoDivmod): fix precision.
	  [ruby-core:17472][ruby-dev:35372][ruby-dev:40105][ruby-dev:40358]

Tue Feb  9 22:23:27 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (READ_CHECK): do not select fd before reading, that had made
	  TCPServer#gets stuck.  [ruby-dev:40317]

Tue Feb  9 21:27:38 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rexml/text.rb (REXML::Text#initialize): REXML::Text.new checks
	  raw text for illegal characters without entity check, for the sake
	  of 1.8 compatibility.  This had caused rubyspec error.

Mon Feb  8 23:49:24 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_getline_fast): wrong calculation of new position
	  from rb_str_coderange_scan_restartable().  [ruby-core:28103]

	* io.c (read_all): ditto.

	* sprintf.c (rb_str_format): ditto.

Mon Feb  8 21:03:53 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (socket_s_ip_address_list): obtain the scope_id
	  of IPv6 link local address on OpenSolaris.

Mon Feb  8 16:27:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dmyversion.c: empty load path in miniruby.

	* common.mk (COMPILE_PRELUDE): rbconfig is loaded on demand.

	* tool/eval.rb, win32/{mkexports,resource}.rb: miniruby no longer
	  contains "." in $:.

Mon Feb  8 15:15:07 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_clone): call initialize_clone hook method to
	  call initialize_copy.

	* object.c (rb_obj_dup): call initialize_dup hook.

	* lib/delegate.rb (Delegator#initialize_clone): use new hook to
	  implement deep copy.  [ruby-dev:40242]

	* lib/delegate.rb (Delegator#initialize_dup): ditto.

	* test/test_delegate.rb (TestDelegateClass#test_copy_frozen): add
	  a test to ensure #clone copies frozen status.

Mon Feb  8 10:28:58 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: check pthread_attr_getstack to prevent obsolete
	  warning for pthread_attr_getstackaddr.

Sun Feb  7 23:12:34 2010  Tanaka Akira  <akr@fsij.org>

	* sample/test.rb: sort files for syntax validation.

Sun Feb  7 23:08:53 2010  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb: sort test files.

Sun Feb  7 12:53:12 2010  Tanaka Akira  <akr@fsij.org>

	* lib/rake.rb (Rake::FileList::ARRAY_METHODS): fix test failure by <=>
	  definition at Kernel.

Sun Feb  7 03:01:46 2010  Tanaka Akira  <akr@fsij.org>

	* math.c (math_lgamma): initialize sign because
	  lgamma(NaN) doesn't set the sign in OpenSolaris.

Sun Feb  7 00:23:21 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* class.c (rb_class_init_copy): raise a TypeError if the argument is
	  BasicObject.  [ruby-core:27060]

Sat Feb  6 23:37:11 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (initialize): set @sock to a NullSocket instance to
	  raise FTPConnectionError when not connected.   [ruby-dev:40258]

Sat Feb  6 23:25:57 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/curses/view2.rb: replaced with Hugh Sasse's version.
	  [ruby-core:27894]

Sat Feb  6 22:57:00 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (receive_responses): does not hang when an
	  unexpected BYE response received.  fixed [ruby-core:27944].
	  Thanks, Bob Potter.

Sat Feb  6 21:31:23 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb (wait): supported timeout.

	* test/net/imap/test_imap.rb (test_exception_during_idle): use timeout.

Sat Feb  6 19:35:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* tool/compile_prelude.rb: fix require path.

Sat Feb  6 12:02:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/delegate.rb (Delegator#method_missing),
	  (Delegator.delegating_block): don't hide backtrace from
	  __getobj__ and reduced exception messages when $DEBUG.

Sat Feb  6 11:35:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/ipsocket.c (ip_addr, ip_peeraddr),
	  ext/socket/socket.c (sock_s_getaddrinfo): added optional
	  reverse_lookup flag.  [ruby-core:28007]

Sat Feb  6 01:55:02 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/stringio/stringio.c (strio_ungetc): pads with \000 when the
	  current position is after the end.  [ruby-dev:40271]

Sat Feb  6 01:14:54 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/purelib.rb, common.mk: to simulate ruby command more precisely,
	  remove "." from $: of virtual environment for build and test.

Sat Feb  6 00:02:31 2010  Tanaka Akira  <akr@fsij.org>

	* random.c (fill_random_seed): don't use O_NOFOLLOW because
	  /dev/urandom is a symlink in OpenSolaris.

	* lib/securerandom.rb (SecureRandom.random_bytes): ditto.

Fri Feb  5 16:38:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/delegate.rb (Delegator): include copy of Kernel.
	  [ruby-dev:40314]

	* lib/delegate.rb (Delegator#{dup,clone}): class of copy should be
	  Delegator.  [ruby-dev:40313]

Fri Feb  5 09:26:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* bignum.c (big_op): remove unused variables.

Fri Feb  5 02:06:57 2010  Aaron Patterson  <tenderlove@ruby-lang.org>

	* lib/yaml/rubytypes.rb: Struct members are emitted without a leading
	  colon.  Thanks Yusuke Endoh! [ruby-core:28052]

	* test/yaml/test_struct.rb: fixed tests to go with Struct changes

	* test/yaml/test_yaml.rb: fixed tests to go with Struct changes

Fri Feb  5 00:34:24 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (big_gt, big_ge, big_lt, big_ge): added Bignum#>, >=, < and
	  <= to allow to compare with BigDecimal.  [ruby-dev:40167]

Thu Feb  4 15:47:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (native_thread_init_stack): use get_stack.
	  patched by KOSAKI Motohiro [ruby-dev:40309]

	* thread_pthread.c (ruby_init_stack): use get_stack
	  on platforms which have pthread_attr_get_np.
	  (FreeBSD, DragonFlyBSD and NetBSD)
	  This is because FreeBSD and DragonFly BSD must use
	  pthread_attr_get_np to get stack size of main thread,
	  but Mac OS X and Linux with LinuxThreads must use getrlimit.
	  <http://www.nminoru.jp/~nminoru/programming/stackoverflow_handling.html>
	  <http://d.hatena.ne.jp/nurse/20100204>

Thu Feb  4 09:55:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: FreeBSD, DragonFly BSD and OpenBSD needs
	  pthread_np.h to use pthread_*_np functions.
	  OpenBSD's pthread_*_np also depend sys/signal.h,
	  but it is included at signal.h via vm_core.h via thread.c.

Thu Feb  4 08:15:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/delegate.rb (Delegator): now inherits BasicObject.
	  [ruby-dev:39154], [Bug #2679], [ruby-dev:40242]

Thu Feb  4 03:00:59 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_DoDivmod): get red of
	  floating point exception.

Thu Feb  4 01:24:01 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_DoDivmod): fix infinity
	  handling.  1 / Infinity was evaluated to NaN.

Thu Feb  4 00:37:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_mdump, time_mload): dump/load utc_offset.
	  [ruby-dev:40063]

Wed Feb  3 22:22:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check for non-portable stack attribute functions.

Wed Feb  3 20:10:52 2010  Tanaka Akira  <akr@fsij.org>

	* ext/iconv/charset_alias.rb: pass block argument to outer local
	  variable.

Wed Feb  3 20:08:05 2010  Tanaka Akira  <akr@fsij.org>

	* file.c (realpath_rec): rb_path_last_separator may return NULL.

Wed Feb  3 13:15:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c: DragonFlyBSD is also the same as FreeBSD
	  on getting the stack size of the main thread.

Wed Feb  3 12:30:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (ruby_init_stack): use pthread_get_attr_np
	  to get the stack size of the main thread on FreeBSD.

	* thread_pthread.c: include pthread_np.h on FreeBSD.

Wed Feb  3 11:38:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/{closure,function}.c: removed C99 features and warnings.

Wed Feb  3 10:12:09 2010  Aaron Patterson  <tenderlove@ruby-lang.org>

	* ext/dl/function.c: DL::Function now uses libffi

	* ext/dl/cfunc.c (rb_dl_set_last_error): set to non static so errors
	  can be exposed.

	* ext/dl/closure.c: DL::Closure will now be used in place of
	  ext/dl/callback/*.

	* ext/dl/dl.c: legacy callbacks removed in favor of libffi

	* ext/dl/dl_conversions.(c,h): used for converting ruby types to FFI
	  types.

	* ext/dl/callback/*: replaced by libffi callbacks.

	* ext/dl/lib/dl/callback.rb: Converting internal callbacks to use
	  DL::Closure

	* ext/dl/lib/dl/closure.rb: Ruby parts of the new DL::Closure object

	* ext/dl/lib/dl/import.rb: More conversion to use DL::Closure object

	* ext/dl/lib/dl/value.rb (ruby2ffi): adding private method for
	  DL::CPtr to ffi value conversion.

Tue Feb  2 18:15:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c: turn on do_not_reverse_lookup by default,
	  which has been reverted in r9880 probably unintentionally,
	  according to matz.  [ruby-core:24530]

Tue Feb  2 14:46:06 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c: move implementation of each_slice, each_cons,
	  each_with_object to enum.c.

	* enum.c (each_slice_i): convert multiple values from yield into
	  an array.

	* enum.c (each_cons_i): ditto.

	* enum.c (each_with_object_i): ditto.

Tue Feb  2 14:30:27 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_each_entry): new method #each_entry to pack values
	  from yield into an array.

	* lib/set.rb (Set#merge): use Enumerable#each_entry to implement
	  Set compatible to 1.8 behavior.  [ruby-core:27985]

	* lib/set.rb: replace is_a?(Enumerable) with respond_to?(:each)
	  for duck typing.

	* lib/set.rb (SortedSet#add): typo fixed.

Tue Feb  2 11:13:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/delegate.rb (Delegator#marshal_dump): exclude
	  delegator-specific instance variables.

Mon Feb  1 21:26:41 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/matrix.rb (Vector#each2): returns a self.  [ruby-dev:40241]

Mon Feb  1 17:08:42 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_minus): RDoc update.  a patch from red stun
	  in [ruby-core:27951]

Mon Feb  1 07:36:33 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tkutil/tkutil.c: fix SEGV on TkUtil::CallbackSubst._setup_subst_table.

	* ext/tk/lib/tk.rb: [ruby1.9] fix freeze at exit.

	* ext/tk/lib/tk.rb: [POTENTIAL INCOMPATIBLE] return NoMethodError
	  for TkWindow#to_ary and to_str.

	* ext/tk/lib/tkextlib/tcllib/plotchart.rb: wrong arguments.

	* ext/tk/sample/tkballoonhelp.rb: fail to support TkEntry widgets.

Sun Jan 31 23:20:43 2010  wanabe  <s.wanabe@gmail.com>

	* io.c (rb_io_each_codepoint): use cbuf when needs readconv.

Sun Jan 31 23:07:23 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_dir.rb: use string instead of symbol as file name.

Sun Jan 31 22:41:33 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (rb_string_value): fix the previous commit.

Sun Jan 31 21:43:35 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (rb_string_value): make no exception for Symbol.
	  [ruby-dev:40274]

Sun Jan 31 21:10:15 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_throw): fixed infinite loop.  [ruby-core:27969]

Sun Jan 31 21:29:58 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rexml/text.rb (REXML::Text#initialize): do Text.check only when
	  parent is specified, since Text.check may need doctype.  partially
	  revert r26518.

Sun Jan 31 15:50:34 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rexml/text.rb (REXML::Text#initialize): fix typo and a bug that
	  seems to be caused by refactoring.

Sun Jan 31 15:46:37 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rexml/parent.rb (REXML::Parent#delete): return the deleted node
	  because the rdoc of REXML::Element#delete_element says it returns
	  "the element that was removed."  [REXMLTracker#161]

Sun Jan 31 14:33:00 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: A bug fix for deleting blank Table rows from Andy Hartford.

Sun Jan 31 13:31:43 2010  wanabe  <s.wanabe@gmail.com>

	* gc.c (obj_free): free rb_classext_t of eigenclass.  [Bug #1392]

Sun Jan 31 13:00:14 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rexml/document.rb (REXML::Document#add): fix duplicate XMLDecls
	  and bad DocTypes in REXML::Document.    (Bug #19058) [ruby-core:27979]
	  based on the patch by Federico Builes.

Fri Jan 29 22:49:21 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/getoptlong.rb (set_options): ensure that the type of argument is
	  Array, restoring this check that was deleted at r10239.  This caused
	  rubyspec error.

Fri Jan 29 12:59:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (mingw): needs $(DEFFILE) for extension libraries.
	  [ruby-core:27946]

Fri Jan 29 11:09:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_do): log no source when no development env.

	* lib/mkmf.rb (create_makefile): srcprefix always needs $(srcdir).

	* lib/mkmf.rb (create_makefile): yield configuration if a block is
	  given.

Fri Jan 29 09:43:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf8_mac.trans (buf_shift_char): don't see uninitialized
	  value. [ruby-dev:40233]

Fri Jan 29 01:42:24 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator#initialize_copy): use initialize_copy
	  instead of overriding clone/dup.  [ruby-dev:40221]
	  it now always clones the target, it might cause incompatibility.

Fri Jan 29 01:26:53 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_i): update RDoc to
	  denote that #to_i raises FloatDomainError for Inf and NaN.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_i): fast #to_i using
	  BigDecimal_split().

	* bignum.c (conv_digit): use faster ISDIGIT() assuming ASCII.

Fri Jan 29 00:18:54 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/cgi.rb: set autoload to CGI::HtmlExtension.  [ruby-dev:40194]

Thu Jan 28 09:44:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (onig_compile): initialize ScanEnv.
	  mainly to initialize env->warnings_flag [ruby-dev:40196]

	* regparse.c (scan_env_clear): clear warnings_flag.

Wed Jan 27 23:33:21 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/matrix/test_matrix.rb, test/matrix/test_vector.rb: add some
	  tests.

Wed Jan 27 23:29:36 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/thread.rb (ConditionVariable#wait, signal, broadcast): return
	  self (for 1.8 compatibility).

Wed Jan 27 23:27:54 2010  Keiju Ishitsuka  <keiju@emperor2.pendome>

	* lib/matrix.rb: add exception Matrix::ErrOperationNotImplemented
	  [ruby-dev:40149].
	* lib/matrix.rb: change message of exception
	  Matrix::ErrOperationNotDefined [ruby-dev:40150], [ruby-dev:40176].
	* lib/matrix.rb: add method Vector#/ [ruby-dev:40151].
	* lib/matrix.rb(Matrix::Scalar#+,-,/): delete meaningless when
	  switch. [ruby-dev:40149]

Wed Jan 27 23:22:54 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vm_dump.c (bugreport_backtrace): trivial change.

	* vm_dump.c (rb_vm_bugreport): uninitialized local variable i.
	  [ruby-dev:40169]

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_segv_test):
	  follow above change.

Wed Jan 27 23:20:52 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_exception.rb
	  (TestException#test_thread_signal_location):
	  change test method name.

Wed Jan 27 22:48:40 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/matrix.rb (determinant): fix name error.

Wed Jan 27 22:26:25 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_backtrace): "circular require" warning was output to
	  stdout except the first line.  All line is output to stderr now.
	  [ruby-dev:40147]

Wed Jan 27 00:22:20 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_DoDivmod, BigDecimal_mod,
	  BigDecimal_divmod, BigDecimal_div2): BigDecimal#% and #div returned
	  an array itself that was returned by #divmod.

Wed Jan 27 00:19:30 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (VpCtoV): do not raise infinity
	  exception for BigDecimal("0E200000000000").

Tue Jan 26 21:50:31 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (VpCtoV): BigDecimal("0E200000000000")
	  was Infinity, not 0.

	* test/bigdecimal/test_bigdecimal.rb: add a test for above.

Tue Jan 26 21:36:22 2010  Tanaka Akira  <akr@fsij.org>

	* configure.in: test unsetenv returns a value.
	  unsetenv is void in older BSDs (FreeBSD 6 and OpenBSD 4.5 at least).

	* hash.c (ruby_setenv): don't use the result of unsetenv if unsetenv
	  doesn't return a value.

Tue Jan 26 21:32:03 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: suppress a warning.

	* ext/extmk.rb: ditto.

Tue Jan 26 20:23:22 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (rb_vm_invoke_proc): this function must not catch TAG_RETURN
	  because vm_exec does.  This caused rubyspec error.  [ruby-dev:40158]

Tue Jan 26 20:21:28 2010  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/eq.rb: fix circular require in drb.
	  reported by akr. see [ruby-dev:40156] [ruby-core:27661]

Tue Jan 26 19:59:17 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (rb_gzfile_s_wrap): add rdoc. [Bug #2656]
	  patched by Hugh Sasse [ruby-core:27692] [ruby-core:27852]

	* ext/zlib/doc/zlib.rd: removed.

Tue Jan 26 16:43:34 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/strscan/strscan.c: fix rdoc. (length -> bytesize)
	  reported by Kornelius Kalnbach. see [ruby-core:27792]

Tue Jan 26 07:06:05 2010  Tanaka Akira  <akr@fsij.org>

	* lib/matrix.rb: suppress warnings.

Tue Jan 26 03:16:45 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c, vm_core.h, eval.c: because rb_protect must not be jumped by
	  callcc, revert r26407.  And rename trap_tag to protect_tag and
	  change exception message (across trap -> across stack rewinding
	  barrier).

Mon Jan 25 23:08:10 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (do_select): wrong conditions.  [ruby-core:27753]

Mon Jan 25 22:31:53 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/envutil.rb: use method_defined? instead of
	  instance_methods.include?.

Mon Jan 25 22:08:20 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (rb_cont_call, cont_restore_1): remove trap_tag check because
	  it seems not to make sense.  [ruby-dev:40121]

	* vm_core.h, eval.c (rb_protect): ditto.

Mon Jan 25 21:43:05 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/envutil.rb: fix the check if instance method `ruby' is
	  defined or not.

Mon Jan 25 21:17:32 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rubyoptions.rb (test_segv_test): add a test for
	  bugreport trace dumper.

Mon Jan 25 17:47:02 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (pty_check): needs WNOHANG to poll, return $?, and
	  call raise_from_check() with pid_t.  [ruby-dev:40141]

Mon Jan 25 17:36:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* version.c (RUBY_LIB, RUBY_*_LIB): moved from configures.

Mon Jan 25 12:11:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (USE_SIGALTSTACK): only when SA_SIGINFO also is
	  available.  see [ruby-core:27768].

Mon Jan 25 12:02:34 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* dln.c, file.c, io.c, signal.c: add __HAIKU__.
	  patched by Alexander von Gluck [ruby-core:27767]

Mon Jan 25 11:45:47 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* math.c (domain_check): ignore errno if y is inf.
	  r26335 is because NetBSD 5.0's asin and acos returns
	  0.0 with errno EDOM. But it breaks Linux whose gamma returns inf
	  with errno ERANGE on.

Sun Jan 24 22:48:05 2010  Koichi Sasada  <ko1@atdot.net>

	* eval.c, vm.c, vm_eval.c, vm_insnhelper.c: fix issues about
	  return and c-return trace.  This issue skips (c-)return event
	  with global jump such as break or return.  This fix make vm invoke
	  hooks at stack rewind timing.  fix [ruby-core:27606] [Bug #2610].

	* test/ruby/test_settracefunc.rb: add a test for above.

Sun Jan 24 14:21:48 2010  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_enc_strlen_cr): increment by rb_enc_mbminlen(enc) for
	  broken byte sequence.  [ruby-core:27748]
	  (rb_str_inspect): ditto.

Sun Jan 24 05:18:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): unlock all locking mutexes
	  before clean up.  [ruby-core:26877]

	* thread.c (rb_thread_atfork): no other threads to be joined.

	* vm_core.h (rb_thread_lock_unlock, rb_thread_lock_destroy):
	  new functions.

	* vm.c (ruby_vm_destruct): unlock and destroy global VM lock.

Sun Jan 24 00:31:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/parser/ruby.rb: fix typo.
	  patched by Hal Brodigan [ruby-core:21536]

Sun Jan 24 00:02:18 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/markup/to_html_crossref.rb: fix failure of the test.
	  patched by Tomoyuki Chikanaga and nobu [ruby-core:20564]

Sat Jan 23 23:27:12 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (dir_s_glob): add rdoc by Roger Pack. [ruby-core:27669]

Sat Jan 23 23:12:56 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/generator/html.rb (RDoc::Generator::HTML#gen_into):
	  make the rdoc(generating html) run faster and use less memory.
	  patch by Tetsu Soh [ruby-core:27656]

Sat Jan 23 19:54:48 2010  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE.ole_initialize,
	  WIN32OLE.ole_uninitialize to use in win32ole.rb.
	  You must not use these methods.

	* ext/win32ole/lib/win32ole.rb: add win32ole.rb
	  re-define Thread#initialize (fix ruby-core:27634)

Sat Jan 23 00:25:19 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* sample/coverage.rb: preserve exit status.

Sat Jan 23 00:21:18 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_dir.rb: get rid of debug print.

	* test/ruby/test_module.rb: fixed to make test-all work.

Fri Jan 22 23:54:04 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb: add a test for Array#rotate, rotate!.

	* test/ruby/test_dir.rb, test/ruby/test_fnmatch.rb: add some tests
	  (for coverage of dir.c).

	* test/ruby/test_enum.rb: add a test for Enumerable#minmax.

	* test/ruby/test_enumerator.rb: add some tests for Enumerator#inspect,
	  Enumerator::Generator and Yielder.

	* test/ruby/test_env.rb: add a test for ENV#index.

	* test/ruby/test_exception.rb: add some tests (for coverage of
	  error.c).

	* test/ruby/test_hash.rb: add a test for recursive check.

	* test/ruby/test_integer.rb: add a test for number of argument of
	  Integer.

	* test/ruby/test_method.rb: add a test for define_method.

	* test/ruby/test_module.rb: add a test for constant of included
	  module.

	* test/ruby/test_proc.rb: add a test for parameters with cfunc.

Fri Jan 22 23:50:03 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_regexp.rb, test/ruby/test_symbol.rb,
	  test/ruby/test_variable.rb: add some tests (for coverage of
	  compile.c).

Fri Jan 22 21:05:34 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (time_mload): add submicro into vtm.subsecx.  [ruby-dev:40133]

Fri Jan 22 14:26:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (rdoc): needs encodings and exts.

Fri Jan 22 14:16:18 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: add missing comma.

Fri Jan 22 01:07:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_bignum.rb, test/ruby/test_class.rb,
	  test/ruby/test_defined.rb, test/ruby/test_hash.rb,
	  test/ruby/test_primitive.rb, test/ruby/test_variable.rb: add some
	  tests (for coverage).

Fri Jan 22 01:03:28 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_require.rb (test_define_class): expect TypeError
	  instead of NameError.  [ruby-core:27504]

Thu Jan 21 15:09:35 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in: some tidy.

Thu Jan 21 11:15:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_rotate): new methods, Array#rotate! and
	  Array#rotate.  [ruby-dev:17194]

	* array.c (rb_ary_reverse_m): copy directly.

Thu Jan 21 09:38:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: use AS_CASE instead of when, to get rid of
	  an unintentional substitution.

Thu Jan 21 08:45:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (iseq_s_disasm): check for proc first.  based on the
	  patch by Roger Pack in [ruby-core:27626].  [ruby-core:27227]

Wed Jan 20 16:09:59 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* common.mk (compile.$(OBJEXT)): dependencies lacking.

	* vm_method.c (rb_add_method_cfunc): invalid initializer for C89

	* compile.c (iseq_insns_unification): int might be smaller than int*

Tue Jan 19 20:00:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/resolv.rb (Resolv::Config.default_config_hash): return an
	  empty hash when resolv.conf is not available.  [ruby-core:27620]

	* lib/resolv.rb (Resolv::DNS::Config#lazy_initialize): fixed the
	  defaults of nameserver and port.

Tue Jan 19 14:29:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (clean-ext): allow glob patterns.

	* ext/extmk.rb: ditto.

Tue Jan 19 14:19:26 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/{extconf.rb, zlib.c): crc32_combine and adler32_combine is
	  supported on Zlib 1.2.2.1, so check them for old zlib.

Tue Jan 19 09:03:37 2010  Aaron Patterson  <tenderlove@ruby-lang.org>

	* ext/zlib/zlib.c: added Zlib.crc32_combine and Zlib.adler32_combine

	* test/zlib/test_zlib.rb: corresponding tests [ruby-core:27551]

Tue Jan 19 02:02:32 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb: add some tests (for coverage).

	* test/ruby/test_bignum.rb: ditto.

Tue Jan 19 01:57:12 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_bignum.rb: some coerce definitions (for test) was
	  wrong.

Tue Jan 19 01:53:11 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (bigsub_int): remove nonsense loop.

Tue Jan 19 01:42:36 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (top_compstmt, top_stmts, top_stmt): prohibit BEGIN {} in
	  non-toplevel scope.  [ruby-core:21657]

	* test/ruby/test_beginendblock.rb (test_begininclass): add a test for
	  above.

Mon Jan 18 17:16:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/webrick/httpservlet/filehandler.rb (make_partial_content):
	  add bytes-unit.  [ruby-dev:40030]

Mon Jan 18 15:49:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPHeader#{content_range,range_length}):
	  use inclusive range same as the header representation.

Mon Jan 18 03:59:57 2010  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_instance_hexdigest_bang): Fix
	  rdoc.

	* ext/digest/lib/digest.rb (Digest::Class.base64digest)
	  (Digest::Instance#base64digest{,!}): New methods.

Sun Jan 17 22:48:44 2010  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_instance_digest)
	  (rb_digest_instance_hexdigest): Save a method call of reset()
	  for a disposable clone.

Sun Jan 17 19:24:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* math.c (domain_check): check errno first.
	  NetBSD 5.0's asin and acos returns 0.0 with errno EDOM.

Sun Jan 17 14:24:35 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (rb_str_derive): use long.

	* ext/iconv/iconv.c (iconv_convert): suppress a warning.

	* lib/mkmf.rb (check_signedness): new method.

	* lib/mkmf.rb (have_header, create_header): use String#tr_cpp.

Thu Jan 14 13:06:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_hash, int_chr): fixed type.

Thu Jan 14 12:50:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_concat): fixed range check for Fixnum, and
	  added checks for integer overflow and invalid char code.

Thu Jan 14 09:34:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): raise RangeError when the argument is
	  negative value. [ruby-core:27583]

Thu Jan 14 08:49:59 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (time_to_r): convert to rational if internal representation
	  is not rational.

Thu Jan 14 04:01:50 2010  Tanaka Akira  <akr@fsij.org>

	* time.c (time_mdump): use nano_num and nano_den instead of subnano to
	  avoid Rational class in marshaled data which prevent unmarshal by
	  Ruby 1.8.
	  (time_mload): use nano_num and nano_den.

Wed Jan 13 11:57:38 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* object.c (rb_class_initialize): Make sure BasicObject doesn't get
	  initialized twice [ruby-core:27577]

	* class.c (rb_class_init_copy): ditto

Wed Jan 13 06:54:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check for if struct timezone is defined.

	* missing.h (struct timezone): define if not defined.

	* win32/win32.h (struct timezone): defined in the newer w32api.
	  [ruby-core:27515]

Wed Jan 13 00:33:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/shell/command-processor.rb: fix typo by Sho Hashimoto.
	  reported and patched at [ruby-dev:40058] [Bug #2599]

Tue Jan 12 23:48:29 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb, test/rss/test_maker_0.9.rb:
	  accept any time format in maker. [ruby-core:26923]

Tue Jan 12 21:56:00 2010  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_set_len): call rb_str_modify.

	* file.c (realpath_rec): don't call rb_str_modify before
	  rb_str_set_len.

Tue Jan 12 20:44:14 2010  Tanaka Akira  <akr@fsij.org>

	* file.c (realpath_internal): call rb_secure.

Tue Jan 12 16:48:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP.start): options may not be given.

Tue Jan 12 16:48:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_readline): check if instream
	  is closed instead of fd 0.

	* ext/readline/readline.c (Init_readline): use STDIN for input.
	  Reported by Sora Harakami. See
	  http://d.hatena.ne.jp/codnote/20100111/1263174134

Tue Jan 12 16:09:02 2010  wanabe  <s.wanabe@gmail.com>

	* test/ruby/test_process.rb (test_execopts_env): MANDATORY_ENVS might
	  not be a part of ENV.  e.g. TMPDIR.

Tue Jan 12 14:07:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP.start): add hash argument to
	  set ssl related options. when use_ssl is set default value
	  of verify_mode is OpenSSL::SSL::VERIFY_PEER. [ruby-dev:40003]

Tue Jan 12 14:53:07 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (init_env): use _wputenv() instead of
	  SetEnvironmentVariableW() because latter doesn't set msvcrt's environ
	  work area, of course.
	  [Bug #2552]

Tue Jan 12 13:33:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (realpath_rec): trace symbolic link only when supporting
	  readlink().

Tue Jan 12 12:49:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-here-doc-beg-match): fix for here-doc
	  which ends with an underscore.

Tue Jan 12 09:58:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c: need to include errno.h for EINVAL.

	* hash.c (ruby_setenv): fixed typo.  see [ruby-dev:40026]

Tue Jan 12 09:22:43 2010  Tanaka Akira  <akr@fsij.org>

	* prelude.rb (require_relative): use File.realpath.  [ruby-dev:40040]

	* include/ruby/intern.h: declare rb_dir_getwd.

	* dir.c (rb_dir_getwd): copied from dir_s_getwd to export.
	  (dir_s_getwd): use rb_dir_getwd.

	* file.c (rb_file_s_realpath): new method File.realpath.
	  (rb_file_s_realdirpath): new method File.realdirpath.

	* lib/pathname.rb (Pathname#realpath): use File.realpath.
	  (Pathname#realdirpath): use File.realdirpath.

Mon Jan 11 22:45:08 2010  Akinori MUSHA  <knu@iDaemons.org>

	* hash.c (ruby_setenv): Improve the emulation of setenv(3) on
	  environments where putenv(3) is used.  Raise EINVAL If a
	  variable name contains an '='.

Mon Jan 11 18:16:38 2010  wanabe  <s.wanabe@gmail.com>

	* vm_insnhelper.h (GET_BLOCK_PTR): return 0 when in class frame.
	  [Bug #2583]

Mon Jan 11 16:52:05 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_strlen): added. [ruby-dev:40028]

	* include/ruby/intern.h (rb_str_strlen): declared.

Mon Jan 11 13:30:35 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/webrick/accesslog.rb (WEBrick::AccessLog#format): fixed typo.

	* lib/webrick/httpstatus.rb (WEBrick::HTTPStatus::Status#initialize):
	  accept 0 or more arguments.  [ruby-dev:40021]

Mon Jan 11 12:47:58 2010  Akinori MUSHA  <knu@iDaemons.org>

	* hash.c (ruby_setenv): ENV.[]= should raise an error if setenv(3)
	  or putenv(3) fails.  [ruby-dev:40023]

Sun Jan 10 17:25:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/webrick/accesslog.rb : Escape needed.

	* lib/webrick/httpstatus.rb : ditto.

	* lib/webrick/httprequest.rb : ditto.

	* lib/webrick/httputils.rb : ditto.

	* test/webrick/test_cgi.rb (TestWEBrickCGI::test_bad_): Test for it.

Sun Jan 10 04:54:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_define_class): raise TypeError same as class
	  statement.  [ruby-core:27504]

Sun Jan 10 04:41:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): needs ARCH_FLAG.

Sat Jan  9 14:20:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (install-all): maybe typo.

Sat Jan  9 14:01:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* missing/vsnprintf.c (BSD_vfprintf): get rid of a warning of VC++ x64.

Sat Jan  9 08:40:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/configure.bat (WIN32DIR): regularise file separators.

Fri Jan  8 23:35:18 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (mnew): don't check visibility of method body if public
	  ZSUPER method is found.  [ruby-dev:39767]

	* test/ruby/test_method.rb: add a test for above.

Fri Jan  8 22:59:40 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_method.c (rb_alias): skip ZSUPER method when searching body of
	  source method.  [ruby-dev:39760]

	* test/ruby/test_alias.rb: add a test for above.

Fri Jan  8 21:15:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http, lib/net/https: move content from net/https to
	  net/http. [ruby-dev:39986]

Fri Jan  8 14:06:01 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_s_read): close the IO if an exception is raised on
	  seeking. [ruby-core:27429]

Fri Jan  8 13:12:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_symbol): dump no encoding for 7bit only coderange
	  symbol.  [ruby-core:27375]

Thu Jan  7 07:56:09 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.5.0 r5596.
	* test/minitest/*.rb: ditto.

Tue Jan  5 19:30:53 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_exception.rb: add a test. cf [ruby-dev:39116]

Tue Jan  5 02:03:34 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in (DTRACE): clear this when `dtrace -l` fails.
	  Note that current FreeBSD needs privilege to call it;
	  so to use DTrace on FreeBSD, you should run configure as root.

Mon Jan  4 21:24:18 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* gc.c: added UNLIKELY to probes for optimization.

	* vm.c: ditto.

	* thread.c: ditto.

Mon Jan  4 09:30:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (TRACING_MODEL): follow yugui's previous changes.

Mon Jan  4 09:30:25 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (InterlockedExchangePointer): old SDK support.

Sun Jan  3 23:54:51 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* trace.h: new file. wraps tracing mechanisms.

	* defs/dtrace.d: new file. defined a dtrace provider "ruby".

	* include/ruby/ruby.h (LIKELY): moved from vm.c.
	  (UNLIKELY): ditto.
	  (OBJSETUP): probe "object-create".
	  (RUBY_EVENT_RESCUE): new event.

	* vm_exec.c (DEBUG_ENTER_INSN): embedded a probe insn-entry into it.
	  (DEBUG_END_INSN): insn-return.

	* vm.c (LIKELY): moved into ruby.h.
	  (UNLIKELY): ditto.
	  (Init_BareVM): embedded a probe "raise" into it.

	* variable.c (rb_class2name_without_alloc): new utility function.

	* tool/rbinstall.rb (install?(:ext, :arch, :'ext-arch')): installs
	  dtrace.d if necessary.

	* thread_pthread.c (add_signal_thread_list): probe "raise".
	  (rb_thread_create_timer_thread): ditto.

	* thread.c (rb_thread_schedule_rec): probes "thread-enter" and
	  "thread-leave",
	  (thread_start_func_2): ditto.
	  (thread_cleanup_func): probe "thread-term"

	* lib/mkmf.rb: supports dtrace postprocessor on making an extension.

	* iseq.c (rb_vm_insn_name): new utility function.
	  (rb_vm_insn_len): ditto.

	* insns.def (hook): probes "method-entry", "method-return", "line",
	  and "rescue".

	* compile.c (iseq_compile_each): adds a trace op for "rescue" probe.

	* gc.c (garbage_collect): probes "gc-begin" and "gc-end".
	  (obj_free): probe "object-free"
	  (garbage_collect_with_gvl): probe "raise"
	  (negative_size_allocation_error): ditto.
	  (rb_memerror): ditto.

	* eval.c (rb_rescue2): probe "rescue"
	  (rb_longjmp): probe "raise"

	* ext/probe/probe.c: new extension for application defined probes.

	* ext/probe/extconf.rb: ditto.

	* configure.in (--with-tracing-model): new option to choose a tracing
	  mechanism.
	  (DTRACE): new substitution. name of dtrace(1).
	  (RUBY_TRACING_MODEL): new substitution.
	  (DTRACE_OBJ): ditto.
	  (MINIDTRACE_OBJ): ditto.
	  (GOLFDTRACE_OBJ): ditto.
	  (LIBRUBY_DTRACE_OBJ): ditto.
	  (RUBY_DTRACE_POSTPROCESS): new macro. checks whether the dtrace on
	  the system needs postprocessing.
	  (RUBY_DTRACE_BSD_BROKEN): new macro. checks whether the dtrace
	  supports USDT.

	* Makefile.in:
	  (DTRACE): new variable. name of dtrace(1).
	  (TRACING_MODEL): new variable. name of the chosen tracing mechanism.
	  (DTRACE_OBJ): same as the one in configure.in.
	  (MINIDTRACE_OBJ): ditto.
	  (GOLFDTRACE_OBJ): ditto.
	  (LIBRUBY_DTRACE_OBJ): ditto.
	  (CPPOUTFILE): new substitution. necessary for generating dtrace.d
	  (trace_none.h): new target for TRACING_MODEL=none
	  (RUBY_H_INCLUDES): appended a header for tracing.
	  (distclean-local): also removes preprocessed version of dtrace.d
	  ($(LIBRUBY_A)): needs $(LIBRUBY_DTRACE_OBJ) if dtrace needs
	  postprocessing.
	  ($(PROGRAM)): ditto.
	  (golf): ditto.
	  (miniruby): ditto.
	  ($(arch_hdrdir)/ruby/dtrace.d): new target. preprocessed version
	  of defs/dtrace.d. generated if necessary.
	  ($(arch_hdrdir)/ruby/trace_dtrace.h): new target.
	  definition of probes.
	  ($(LIBRUBY_DTRACE_OBJ)): new target. generated if dtrace needs
	  postprocessing.
	  ($(DTRACE_OBJ)): ditto.
	  ($(MINIDTRACE_OBJ)): ditto.
	  ($(GOLFDTRACE_OBJ)): ditto.

Sun Jan  3 15:34:19 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/rexml/text.rb: String no longer has #each.
	  Patch by Mitsutaka Mimura (takkanm). [ruby-dev:39949].

Sun Jan  3 01:29:18 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS::Message::MessageDecoder#inspect):
	  implemented.

Sat Jan  2 15:57:54 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS#initialize): new option :nameserver_port.
	  (Resolv::DNS#each_resource): pass port number.
	  (Resolv::DNS#make_requester): ditto.
	  (Resolv::DNS::Config#lazy_initialize): initialize @nameserver_port
	  instead of @nameserver.
	  (Resolv::DNS::Config#single?): return port number addition to the
	  nameserver.
	  (Resolv::DNS::Config#generate_timeouts): use @nameserver_port.
	  (Resolv::DNS::Config#resolv): yield port number.

Sat Jan  2 00:43:22 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (initialize_regexp): allow leading
	  and trailing white space, and forbid extra characters
	  on another lines. [ruby-core:26223]
	  RFC 3986  Appendix C.  Delimiting a URI in Context
	  draft-duerst-iri-bis-07  7.2.  Web Address processing

Fri Jan  1 23:17:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/generic.rb (URI#normalize!): normalize case of
	  scheme. [ruby-core:27309]

Fri Jan  1 00:47:57 2010  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_instance_method_unimpl): Suppress
	  compiler warnings.

Fri Jan  1 00:00:00 2010  Tanaka Akira  <akr@fsij.org>

	* tool/mkconfig.rb: generate RbConfig.ruby in rbconfig.rb.

	* lib/webrick/httpservlet/cgihandler.rb: use RbConfig.ruby.

	* test/ruby/envutil.rb: ditto.

	* benchmark/report.rb: ditto.

	* benchmark/runc.rb: ditto.

	* tool/eval.rb: ditto.

Thu Dec 31 18:18:55 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/rubysocket.h: include addrinfo.h only when using our own
	  getaddrinfo.c.

Thu Dec 31 14:20:11 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (save_redirect_fd): consider EBADF that the fd is not used.
	  [ruby-dev:39938]

Thu Dec 31 06:03:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/raddrinfo.c (addrinfo_type): typed.

	* ext/socket/extconf.rb: fix for wide-getaddrinfo option.

	* ext/socket/addrinfo.c: rename {addr,name}info functions to ensure
	  those are used on darwin.

Thu Dec 31 03:27:53 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (native_thread_destroy): decreased the probability of
	  using the interrupt event in the thread termination.
	  see [ruby-core:27199].

Thu Dec 31 02:35:57 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_error): should report the function.

Thu Dec 31 01:58:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: fix for extstatic.

Wed Dec 30 19:43:00 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/ruby.h (RREGEXP_SRC_END): added.

Wed Dec 30 19:40:00 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/defines.h (INFINITY): this is float.

	* include/ruby/defines.h (NAN): ditto.

	* numeric.c (rb_infinity): change content as float.

	* numeric.c (rb_nan): ditto.

Wed Dec 30 17:59:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gem_prelude.rb (push_all_highest_version_gems_on_load_path):
	  simplified.

	* lib/rubygems/command_manager.rb (Gem#load_and_instantiate):
	  rescue only NameError from const_get.

	* lib/rubygems/source_index.rb (Gem#load_specification): don't use
	  RUBY_VERSION to branch.

	* lib/rubygems/validator.rb (Gem::TestRunner, Gem#alien): ditto.

	* lib/rubygems.rb: Kernel#gem is already defined, and workaround
	  for home directory and custom_require are no longer needed.

Tue Dec 29 16:03:33 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (Init_Numeric): Add Float::INFINITY and Float::NAN.
	  [ruby-dev:1657] [ruby-dev:4760] [ruby-list:7023]
	  [ruby-list:46690]
	  [ruby-core:26632] [ruby-talk:41352] [ruby-talk:203333]

	* include/ruby/defines.h (INFINITY): defined.

	* include/ruby/defines.h (NAN): defined.

	* include/ruby/util.h (ruby_div0): removed.

	* numeric.c (fix_pow): use INFINITY and NAN
	  instead of ruby_div0(1.0).

	* marshal.c (r_object0): ditto.

	* bignum.c (big_fdiv): ditto.

Tue Dec 29 10:36:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rexml/parsers/baseparser.rb (REXML::Parsers::BaseParser::STANDALONE):
	  any number spaces can be placed between equal-sign and the value.
	  patch from Ed Howland in [ruby-core:27345].

Mon Dec 28 22:33:58 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): force to inherit standard I/O handles.
	  this change fixes [ruby-core:27273], but other side effects might
	  exist.

Mon Dec 28 22:00:10 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_marshal.rb: added tests for taintness/untrustness
	  propagation.

Mon Dec 28 18:13:26 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* sample/occur2.rb: reimplemented in modern style. [ruby-dev:39927].

Mon Dec 28 17:19:37 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/install-sh: correction by Hiro Asari.
	  https://gist.github.com/264558/58ad1cae45cde49600bbb39286af2aae23e639d5

Mon Dec 28 13:18:52 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/install-sh: wrote the intention. [ruby-dev:39928]

Sun Dec 27 10:45:00 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (foleparam_initialize): add foleparam_initialize
	  to check argument of WIN32OLE_PARAM.new

	* test/win32ole/test_win32ole_param.rb (test_s_new): add some assertion
	  to test WIN32OLE_PARAM.new

Sun Dec 27 09:41:54 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/rbinstall.rb (install?(:local, :comm, :bin, :'bin-comm')):
	  Makes it vim friendly.  __END__ in a heredoc is confusing with
	  the script end for vim.

Sun Dec 27 09:13:55 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* sample/occur2.rb: have been broken. fixed for Ruby 1.9 feature.

Thu Dec 24 16:32:30 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/uri/generic.rb (eql?): Check the class of the compared object.
	  Based on a patch by Peter McLain [ruby-core:27019]

Thu Dec 24 15:20:03 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regexec.c (match_at): follow enclen's change.

Thu Dec 24 12:08:00 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/delegate.rb (marshal_dump/load): dump & load instance variables
	  by default [ruby-core:24211]

Thu Dec 24 10:31:50 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/object.c (rb_obj_cmp): Default <=> operator returns 0 if
	  objects are == [ruby-core:24063]

Wed Dec 23 09:12:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/cgi/test_cgi_multipart.rb (CGIMultipartTest#_prepare):
	  always must be binary mode.  c.f. Bug#2341

Thu Dec 10 09:20:58 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (Init_Encoding): undef Encoding.new because
	  a class which is rb_undef_alloc-func-ed can't call new method.
	  [ruby-dev:39862]

	* vm.c (Init_VM): undef RubyVM.new and RubyVM::Env.new.

Mon Dec 21 17:51:44 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (optimize_node_left): include equal on the condition of for-loop.
	  This bug also affects original Oniguruma. [ruby-core:27247]

Mon Dec 21 10:03:33 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (print_enc_string): follow enclen's change.

	* regcomp.c (onig_print_compiled_byte_code): ditto.

	* regcomp.c (onig_print_compiled_byte_code): change prototype.

	* regint.c (onig_print_compiled_byte_code): comment out.

Mon Dec 21 08:04:34 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* object.c: BasicObject#initialize accepts any number of arguments
	  [ruby-core:27080]

Mon Dec 21 02:45:46 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_iterate): remove SEGV (retry).

Sun Dec 20 23:18:23 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_iterate): remove SEGV (use the original patch).
	  [ruby-dev:39874]

Sun Dec 20 21:26:05 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_iterate): pass current block when the argument bl_proc
	  is NULL.  This behavior can be used to make enumerator faster
	  [ruby-dev:39874]

	* enumerator.c (enumerator_each): pass current block directly instead
	  of trampoline block (enumerator_each_i).

	* io.c (argf_each_line, argf_each_byte, argf_each_char): ditto.

Sat Dec 19 14:59:30 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gem_prelude.rb (Kernel#gem): should make gem private.  a patch
	  from Sho Hashimoto in [ruby-dev:39838].

Sat Dec 19 14:57:17 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/webrick/config.rb (WEBrick::Config): typo fixed.  a patch
	  from Sho Hashimoto in [ruby-dev:39835].

Sat Dec 19 11:06:48 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb (each2,collect2,map2): Fix enumerator
	  [ruby-core:27225]

Sat Dec 19 09:58:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (check_funcall): reset method_missing_reason before
	  trying the call.  based on a patch from Yehuda Katz in
	  [ruby-core:27219].

Sat Dec 19 09:29:22 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/set.rb: Add checks that passed argument is Enumerable.
	  [ruby-core:23844]

Wed Dec 16 20:28:46 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/envutil.rb: fix a typo in assert message.

Wed Dec 16 16:57:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/un.rb (httpd): try to convert port number to integer.

Wed Dec 16 11:18:30 2009  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in(MINIRUBY): use "$BASERUBY" as a default ruby executable
	  name.

Wed Dec 16 00:53:14 2009  Tanaka Akira  <akr@fsij.org>

	* lib/find.rb (Find.find): rescue more exceptions which is possible to
	  occur by other process change the directory tree.

Tue Dec 15 09:06:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/find.rb (Find.find): get rid of race condition.

Mon Dec 14 22:33:21 2009  Tanaka Akira  <akr@fsij.org>

	* lib/find.rb (Find.find): rescue only ENOENT and EACCES for lstat.

Mon Dec 14 21:49:30 2009  Tanaka Akira  <akr@fsij.org>

	* lib/find.rb (Find.find): narrow rescue region.

Mon Dec 14 09:20:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/find.rb (Find.find): removed already unnecessary code.

Sun Dec 13 23:48:25 2009  Tanaka Akira  <akr@fsij.org>

	* lib/find.rb (Find.find): sort directory entries.  [ruby-dev:39847]

Sun Dec 13 20:55:30 2009  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (invoke_ruby): call to_str for stdin_data to
	  reject non-string.

Sun Dec 13 20:26:57 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (rb_parser_dump_tree): add prototype.

Thu Dec 10 20:55:55 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode_data.h, transcode.c, tool/transcode-tblgen.rb: Added
	  support for new transcoding instruction FUNsio (with Tatsuya Mizuno)

	* enc/trans/gb18030.trans: Significantly reduced GB18030 conversion
	  table footprint using FUNsio and differences (with Tatsuya Mizuno)

	* test/ruby/test_transcode.rb: Minor name fix (from Tatsuya Mizuno)

Thu Dec 10 17:22:36 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_eval.c (yield_under): yields self the same as 1.8.

Thu Dec 10 15:49:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (native_mutex_reinitialize_atfork): release and
	  re-acquire the lock at re-initialization.

Thu Dec 10 12:56:02 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_replicate): add Encoding#replicate(name).

	* encoding.c (enc_replicate_with_index): renamed from old
	  enc_replicate.

	* encoding.c (rb_enc_from_encoding_index): split from
	  rb_enc_from_encoding.

Thu Dec 10 09:15:00 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): CHAR_ESC_LEN should be 13.

Thu Dec 10 01:12:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (dyna_pop_gen): pop dvars.  [ruby-dev:39861]

Thu Dec 10 00:46:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.c (dump_node): fixed for long members.

Wed Dec  9 22:57:04 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* node.c: node management added.  Currently, only pretty-dumper is
	  implemented.  [ruby-dev:39853]

	* ruby.c: --dump=parsetree and --dump=parsetree_with_comment options
	  added.  This is just for debug or research purpose.  Note that the
	  compatibility of these options are not supported at all.

Wed Dec  9 09:50:35 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_justify): fixed the case a fill size is a
	  multiple of the length of the padding.  [ruby-dev:39856]

Tue Dec  8 23:41:34 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/configure.bat: now recognize --with-*-{dir,include,lib} options
	  and pass them to mkmf.

	* win32/configure.bat: general conversion from ``/'' to ``\'' of
	  configure_args is not necessary any longer.

	* win32/setup.mak: BASERUBY is used as command, so always need to
	  convert ``/'' to ``\'' within it.

Tue Dec  8 23:39:52 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (flo_eq): suppress a warning on VC++ for x64.

Tue Dec  8 16:19:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems: update to 1.3.5.

	* lib/rubygems/defaults.rb (Gem::default_dir): removed a clause
	  doing nothing.

Tue Dec  8 03:50:24 2009  Tanaka Akira  <akr@fsij.org>

	* file.c (rb_f_test): use string form in unknown command error
	  message.

Mon Dec  7 14:11:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object): reverted r26007.  [ruby-dev:39845]

	* test/test_delegate.rb (test_marshal): moved from test_marshal.rb.

Mon Dec  7 13:05:59 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* string.c (rb_str_justify): CVE-2009-4124.
	  Fixes a bug reported by
	  Emmanouel Kellinis <Emmanouel.Kellinis AT kpmg.co.uk>, KPMG London;
	  Patch by nobu.

Sun Dec  6 23:50:46 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* strftime.c: %l should be 1..12 instead of 0..12 [ruby-core:27072]

Sun Dec  6 23:16:35 2009  Tanaka Akira  <akr@fsij.org>

	* lib/find.rb (Find.find): reduce stat system call.

Sun Dec  6 16:02:15 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httpservlet/filehandler.rb: escape filename of index.
	  [ruby-dev:37768]

Sun Dec  6 00:35:16 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (config.h): EXECUTABLE_EXTS moved from
	  dln.c:dln_find_1().

Sat Dec  5 15:35:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object): dump instance variables when using
	  marshal_dump.   [ruby-core:24211]

	* variable.c (rb_ivar_count): added.

Sat Dec  5 13:19:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: default ac_cv_prog_CC to CC.

Sat Dec  5 10:18:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/extend-command.rb (def_extend_command): fixed argument
	  number for negative arity.

Fri Dec  4 16:50:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (k_def): adjust the location of method definition to the
	  line of def.  [Bug #2427]

Fri Dec  4 19:05:28 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (defined): should respect #respond_to_missing? as
	  #respond_to? does.

Fri Dec  4 15:50:18 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_eval.c (yield_under): does not yield self, and passes blockptr
	  instead of &block to vm_cref_push().  [ruby-dev:39833]

Fri Dec  4 15:15:43 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (num_exact): should not accept strings as operands, even
	  though they respond to #to_r.  ideally, strict rational
	  conversion should be done by a method like #to_rational, not #to_r.
	  [ruby-core:23729]

Fri Dec  4 13:10:23 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/stringio/stringio.c (ungetc): RDoc updated.  trunk allows
	  pushing back behind the beginning of the pseudo stream.

Fri Dec  4 03:10:38 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* compile.c (compile_cpath, iseq_compile_each): reverted
	  constant/class variable lookup in instance_eval etc. to the
	  behavior of 1.8.

	* eval.c (rb_mod_nesting): ditto.

	* insns.def (putspecialobject, defineclass): ditto.

	* node.h (NODE_FL_CREF_PUSHED_BY_EVAL): ditto.

	* vm_core.h (VM_SPECIAL_OBJECT_CONST_BASE): ditto.

	* vm_eval.c (yield_under, eval_under): ditto.

	* vm_insnhelper.c (vm_cref_push, vm_get_const_base,
	  vm_get_ev_const, vm_get_cvar_base): ditto.

Thu Dec 3 20:27:27 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/gb18030-tbl.rb: Fix omission of C1 region in code table
	  (from Tatsuya Mizuno)

	* test/ruby/test_transcode.rb: Added test for converting full range of
	  Unicode codepoints from/to GB18030 (from Tatsuya Mizuno)

Wed Dec  2 23:51:28 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c: initialize @hostname of SSLSocket to avoid
	  warning at SSLSocket#connect.

Tue Dec  1 18:01:43 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/digest/test_digest_extend.rb: added tests for digest framework.

Tue Dec  1 12:01:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (dyna_push_gen, dyna_pop_gen): no needs to save both of
	  args and vars.  [ruby-core:26961]

	* parse.y (dyna_push_gen): use rb_node_newnode() for ripper.
	  [ruby-core:26961]

	* parse.y (dyna_push_gen, dyna_pop_gen): adjust local vtable level
	  for the case of syntax errors in method name or argument inside
	  do block.   [ruby-core:26961]

Mon Nov 30 16:57:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (command_output): $makeflags are already quoted.

Mon Nov 30 16:54:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, win32/Makefile.sub (EXECUTABLE_EXTS): moved from
	  dln.c:dln_find_1().

	* lib/mkmf.rb (def find_executable0): use EXECUTABLE_EXTS, not
	  only EXEEXT.  [ruby-core:26821]

Mon Nov 30 11:00:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): suppress an extra error message after
	  numeric literal without digits.  based on a patch from ujihisa .
	  in [ruby-dev:39811].  [ruby-dev:39798]

Sun Nov 29 16:56:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (check_funcall_failed): pass ID.  [ruby-core:26934]

Sun Nov 29 06:37:53 2009  Aaron Patterson  <tenderlove@ruby-lang.org>

	* lib/rexml/formatters/default.rb (write_attribute): fix an
	  exception when printing a document when duplicate namespaced
	  attributes exist. Thanks, Alexey Froloff [ruby-core:26837]

Sat Nov 28 09:05:53 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_eval.c (check_funcall_failed): should rescue user raised
	  NoMethodError.  rescue all NoMethodError if receiver does not
	  respond to the method name.  [ruby-dev:39796]

Thu Nov 26 21:14:30 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_complex.rb (@unify): fix the detection if math
	  loaded. This makes test_complex.rb work fine with the previous
	  commit.

	* test/ruby/test_rational.rb (@unify): ditto.

Thu Nov 26 21:13:36 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_mathn.rb (TestMathn): new test case.
	  test for r25067.

Thu Nov 26 21:11:23 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/openssl/test_config.rb (OpenSSL::TestConfig): new test case.
	  test for r25017.

Thu Nov 26 21:08:54 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_range.rb (TestRange#test_comparison_when_recursive):
	  test for r25010.

	* test/ruby/test_struct.rb (TestStruct#test_comparison_when_recursive):
	  ditto.

Thu Nov 26 20:18:02 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* gem_prelude.rb (Gem.set_home): must dup before force_encoding
	  and must force_encoding before gsub.
	  cf. Yen Sign problem of SJIS [ruby-core:26910]

Thu Nov 26 17:54:37 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{configure.bat, setup.mak, Makefile.sub}: add new configure
	  option ``--with-ntver''.

Thu Nov 26 11:42:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb: use $INCFLAGS to add -I option.  [Bug#2387]

Thu Nov 26 07:17:58 2009  wanabe  <s.wanabe@gmail.com>

	* marshal.c (mark_dump_arg): mark str.  see also [ruby-dev:39735]

Thu Nov 26 00:05:58 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/digest/test_digest_extend.rb: Added tests for current digest
	  framework.

Wed Nov 25 20:46:37 2009  Tanaka Akira  <akr@fsij.org>

	* vm_eval.c (rb_search_method_entry): refine error message.

Wed Nov 25 19:29:05 2009  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_instance_method_unimpl): Do not
	  call rb_inspect() on an object that does not implement necessary
	  methods; reported by NaHi.

Wed Nov 25 19:30:30 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c: Added a check for an internal error
	  (with Tatsuya Mizuno)

Tue Nov 24 22:57:46 2009  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (EnvUtil.invoke_ruby): raise Timeout::Error
	  instead of flunk.  reported by Yusuke Endoh.

Tue Nov 24 22:31:44 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (ruby_vm_destruct, thread_memsize): fix argument type to make
	  RUBY_MARK_FREE_DEBUG available.

Tue Nov 24 21:25:21 2009  Tanaka Akira  <akr@fsij.org>

	* error.c: include errno.h at beginning.

Tue Nov 24 20:11:37 2009  Tanaka Akira  <akr@fsij.org>

	* strftime.c: %Y format a year with 4 digits at least.

	* lib/time.rb: format a year with 4 digits at least.

Tue Nov 24 20:05:27 2009  Tanaka Akira  <akr@fsij.org>

	* defs/known_errors.def: more errors.

Tue Nov 24 20:01:49 2009  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (rb_bug_errno): declared.

	* include/ruby/intern.h (rb_strerrno): declaration removed.

	* error.c (rb_strerrno): make it static.  return NULL for unknown
	  errors.
	  (rb_bug_errno): defined.

	* thread_pthread.c: use rb_bug_errno.

	* signal.c (ruby_signal): use rb_bug_errno.

Tue Nov 24 10:17:38 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_path_convert): fix fs_encoding is not assign.

Tue Nov 24 10:00:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_strerrno): constified.

Tue Nov 24 09:49:31 2009  Tanaka Akira  <akr@fsij.org>

	* error.c (rb_strerrno): return "UNKNOWNERROR" for non-zero unknown
	  error.

Tue Nov 24 09:18:33 2009  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_strerrno): declared.

	* template/known_errors.inc.tmpl: generate defined_error() and
	  undefined_error() instead of set_syserr.

	* error.c (Init_syserr): define defined_error() and undefined_error()
	  to follow the above change.
	  (rb_strerrno): defined.

	* thread_pthread.c: show error message and errno macro name with
	  rb_bug.

Mon Nov 23 16:06:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (RUBY_STACK_MIN, RUBY_STACK_SPACE): delay for
	  platforms where PTHREAD_STACK_MIN is not compile time constant.
	  [ruby-dev:39751]

Mon Nov 23 11:26:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_find_1): removed duplication.

Mon Nov 23 04:12:00 2009  Tanaka Akira  <akr@fsij.org>

	* enc/trans/newline.trans (fun_so_universal_newline): generate \n
	  after \r\n detection instead of just after \r.
	  [ruby-list:45988] [ruby-core:25881] [ruby-core:26788]

Sat Nov 21 18:48:35 2009  Tanaka Akira  <akr@fsij.org>

	* vm_eval.c (rb_search_method_entry): show flags and klass value in
	  not implemented error message.

Sat Nov 21 16:38:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (marshal_dump): use normal object as the buffer so
	  that no hidden object is exposed to ruby-level.  [ruby-dev:39744]

Sat Nov 21 15:58:43 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (read_all): fix: false negative invalid byte sequence
	  on reading from pipes. [ruby-dev:39743]
	  fix: assign the variable 'pos' as relative value from recent pos.

Sat Nov 21 14:44:16 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_path_convert): delay getting UTF8-MAC encoding
	  while really needed. [ruby-core:26807]

Fri Nov 20 21:16:54 2009  Tanaka Akira  <akr@fsij.org>

	* vm_eval.c (rb_search_method_entry): avoid trigraph.

Thu Nov 19 23:17:06 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (putbinaryfile): use APPE for resume.
	  Thanks, Tomoyuki Chikanaga.

Thu Nov 19 22:50:05 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (flag_list): untaint strings to intern in the safe
	  level 1.

	* lib/net/imap.rb (max_flag_count=): new methods to set the max
	  number of flags interned to symbols.

Thu Nov 19 20:43:39 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/getnameinfo.c: need to include extconf.h for HAVE_* macros.
	  reported by Kenta Murata <mrkn AT mrkn.jp> via IRC.

Thu Nov 19 17:00:59 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub: nmake execute the file named echo if it exists
	  in the PATH.  reported by Kenta Murata <mrkn AT mrkn.jp> via IRC.

Thu Nov 19 02:50:47 2009  Tanaka Akira  <akr@fsij.org>

	* vm_eval.c (rb_search_method_entry): show the type of the hidden
	  object.
	  (rb_type_str): new function for above.

Thu Nov 19 00:47:09 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (MORE_CHAR_SUSPENDED): renamed from MORE_CHAR_CBUF_FULL.

Wed Nov 18 22:00:13 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (fill_cbuf): extracted from more_char.
	  (io_shift_cbuf): fix memmove condition.
	  (read_all): use fill_cbuf directly to avoid ECONV_AFTER_OUTPUT.
	  [ruby-dev:39708]

Wed Nov 18 18:25:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_atfork_internal): reinitialize global lock
	  at fork to get rid of deadlock.  based on the patch from Hongli
	  Lai in [ruby-core:26783].  [ruby-core:23572]

Wed Nov 18 17:48:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (terminate_atfork_i): all mutex locks by other threads
	  have been abandoned at fork.

Wed Nov 18 15:27:20 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (file_path_convert): delay getting filesystem encoding
	  while really needed.

Wed Nov 18 12:33:42 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_set_default_encoding): reset filesystem
	  encoding because on resetting default_external because
	  Unix's filesystem encoding depends on default_external.

	* encoding.c (enc_set_filesystem_encoding): added.

	* ruby.c (process_options): don't call rb_filesystem_encoding
	  because filesystem encoding is reset when default_external
	  is reset.

Wed Nov 18 11:57:32 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* math.c (math_gamma): fix incorrect comparison expression.
	  see also [ruby-dev:39709] [Bug #2381]

Wed Nov 18 11:37:05 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_scan_open_args): move path encoding conversion
	  for filesystem encoding of Mac OS X.

	* file.c (file_path_convert): added for convert encoding
	  of file path.

	* file.c (rb_get_path_check): add file_path_convert.

Wed Nov 18 10:17:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_utf8_nth): no count_utf8_lead_bytes_with_word
	  optimization for short string.  [ruby-core:26787]

	* string.c (str_utf8_offset): str_utf8_nth never return NULL.

Wed Nov 18 10:12:34 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_method.c (rb_undef): should raise TypeError if klass is nil.
	  1.instance_eval { undef to_s } causes SEGV before this fix.

	* test/ruby/test_undef.rb: new tests for undef.

Wed Nov 18 08:41:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_utf8_nth): fixed overrun.  [ruby-core:26787]

Wed Nov 18 07:51:01 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (parse_mode_enc): fix invalid access.

Tue Nov 17 23:50:06 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_method.c (rb_alias): should raise TypeError if klass is nil.
	  1.instance_eval { alias to_string to_s } causes SEGV before this
	  fix.

	* test/ruby/test_alias.rb (test_special_const_alias): ditto.

Tue Nov 17 17:53:53 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/big5.c, enc/trans/big5.trans, enc/trans/big5-uao-tbl.rb,
	  test/ruby/test-transcode.rb: Added Encoding 'Big5-UAO' and transcoding
	  for it (from Tatsuya Mizuno) (see Bug #1784)

Tue Nov 17 16:26:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (opt_case_dispatch): runtime value cannot be used as
	  an element initializer.

	* vm_insnhelper.c (opt_case_dispatch_i): gets rid of type-punning
	  calls.

Mon Nov 16 15:51:53 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): protected singleton methods of
	  an object should not be able to called from other instances of the
	  class of the object.  [ruby-core:26761]

	* vm_eval.c (rb_method_call_status): ditto.

	* test/ruby/test_module.rb (test_protected_singleton_method): ditto.

Mon Nov 16 14:03:53 2009  wanabe  <s.wanabe@gmail.com>

	* io.c (read_all): shift read buffer if exception occurred.
	  pointed out in [ruby-dev:39702].

Mon Nov 16 07:59:38 2009  wanabe  <s.wanabe@gmail.com>

	* io.c (read_all): don't call io_shift_cbuf until buffering enough or
	  econv_finished.   [ruby-dev:39696]

	* io.c (more_char): don't call clear_readconv to read buffer after
	  econv_finished.

	* io.c (appendline, rb_io_each_codepoint): clear readconv when done.

Mon Nov 16 01:58:08 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* include/ruby/ruby.h (rb_classext_t): annotate @internal.

Mon Nov 16 01:35:34 2009  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_filesystem_encindex): use default external encoding
	  instead of locale encoding in Unix.

	* ruby.c (process_options): delay filesystem encoding
	  initialization until default external encoding initialization.

Mon Nov 16 00:06:26 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (thread_cleanup_func): delete locking_mutex when thread
	  object become dummy because of fork.  [ruby-core:26744]
	  [ruby-core:26745]

	* bootstraptest/test_thread.rb: add a test for above.

Sat Nov 14 21:54:46 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c (rb_mod_init_copy): fix memory leak of Class#dup.
	  [ruby-dev:39687]

Sat Nov 14 17:09:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (--with-opt-dir): ignore and suppress a warning.
	  [ruby-dev:39684]

Sat Nov 14 16:43:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (ruby_setenv): get rid of crash in Solaris 8 and 10.
	  [ruby-core:26668]

Sat Nov 14 09:16:54 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* ext/bigdecimal/bigdecimal.c (BigDecimalCmp): Fix comparisons
	  [ruby-core:26646]

	* test/bigdecimal/test_bigdecimal.rb (class): Fix and improve tests.

Sat Nov 14 04:07:06 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb (TkVariable::coerce): fix bug on a
	  numeric value.

Sat Nov 14 03:35:29 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb: TkVariable#*(other) and /(other) have a
	  bug on handling of the "other" value.

Fri Nov 13 21:18:15 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/zlib/zlib.c (rb_zlib_adler32): fix typo.

Fri Nov 13 16:22:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): see first_func, not first_proc,
	  to decide which to use.

	* gc.c (vm_xrealloc): use the given object space.

Fri Nov 13 00:46:24 2009  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/util.rb (CGI::pretty): fix the overflow bug
	  if stripped string.[ruby-dev:37975]

Thu Nov 12 23:08:11 2009  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (read_from_cmdline): this code is better.
	  [ruby-core:25991]

Thu Nov 12 22:55:42 2009  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/net/telnet.rb: don't use simple delegate.
	  because SimpleDelegate behavior changed.

Thu Nov 12 14:33:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_win32.c (thread_errno): CreateThread does not set errno.

	* thread.c (thread_create_core): moved failure handling from
	  native_thread_core().

	* thread_pthread.c (native_thread_create): constified.

Thu Nov 12 10:08:56 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* .document: remove documents not in rdoc format until
	  rdoc supports non rdoc files. [ruby-core:26459]

Thu Nov 12 06:42:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#initialize): option hash may not be
	  given.  [ruby-core:26681]

Thu Nov 12 01:29:15 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* enumerator.c (yielder_yield_push): Yielder#<< should return self.
	  [ruby-dev:39660]

Wed Nov 11 19:17:35 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#initialize): merge mode option.

	* lib/tmpdir.rb (Dir::Tmpname#create): splat options.

Wed Nov 11 12:54:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (ruby_setenv): use ruby_strdup().

Wed Nov 11 12:19:27 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (ruby_setenv): also set CRT workarea.  ref [ruby-core:25010]

Wed Nov 11 09:36:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object, r_object0): use RHASH_IFNONE but not ifnone
	  directly.

Wed Nov 11 08:32:45 2009  Tanaka Akira  <akr@fsij.org>

	* thread.c (blocking_region_begin): define before BLOCKING_REGION.
	  reported by Luis Lavena.  [ruby-core:26670]

Wed Nov 11 08:22:19 2009  Tanaka Akira  <akr@fsij.org>

	* util.c (ruby_strtod): use dval() consistently.

Wed Nov 11 02:14:48 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/matrix/test_matrix.rb (TestMatrix#test_rank):
	  added a test method for r24969.

Tue Nov 10 08:23:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_f_exec, rb_f_system, rb_f_spawn): mentioned about
	  the shell to be used when the command line is single string.
	  See [ruby-core:26652]

Mon Nov  9 20:15:16 2009  Tanaka Akira  <akr@fsij.org>

	* thread.c (rb_gc_save_machine_context): don't save the stack pointer
	  in this function.
	  (RB_GC_SAVE_MACHINE_CONTEXT): call rb_gc_save_machine_context and
	  save the stack pointer at caller side.
	  (rb_thread_schedule_rec): use RB_GC_SAVE_MACHINE_CONTEXT instead of
	  rb_gc_save_machine_context.
	  (blocking_region_begin): changed to a macro.  use
	  RB_GC_SAVE_MACHINE_CONTEXT instead of rb_gc_save_machine_context.
	  [ruby-dev:39659]

Mon Nov  9 11:28:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): add -Wno-long-long.

Sun Nov  8 18:13:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c: use RHASH_IFNONE but not ifnone directly.

Sat Nov  7 21:02:57 2009  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb (PP::ObjectMixin#pretty_print): use to_s regardless of
	  instance variables.

Sat Nov  7 20:59:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_push_frame): get rid of out-of-bounds
	  access.

Sat Nov  7 12:41:19 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_insnhelper.c (VM_CALLEE_SETUP_ARG): revert r25521.
	   [ruby-core:26427] [ruby-core:26447]

Fri Nov  6 18:33:47 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_insnhelper.c (vm_push_frame): add CHECK_STACK_OVERFLOW.
	  [ruby-dev:39592]

	* eval.c (rb_longjmp): add 1 level backtrace for sysstack_error
	  without calling any method to prevent further stack overflow.

	* eval.c (make_exception): don't call #exception for
	  sysstack_error to prevent stack overflow.

	* proc.c (Init_Proc): don't freeze sysstack_error.

	* eval.c (rb_longjmp): move reentrant check after exception
	  preparation.

Fri Nov  6 17:13:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_header): split the line by tabs.

Fri Nov  6 12:02:32 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in (MINIDLNOBJ): set default as dmydln.o.
	  Now LLVM clang seems to be able to build Ruby 1.9.

Fri Nov  6 09:29:32 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_filesystem_encindex): add fallback to
	  ASCII-8BIT on Windows.

Fri Nov  6 07:29:07 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_case.rb: merged r25658 from ruby_1_8.

Thu Nov  5 12:27:07 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* gem_prelude.rb (Gem.user_home): force_encoding(
	  Encoding.find('filesystem')). [ruby-core:26525]

Thu Nov  5 07:47:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (BEGIN): now local_push and local_pop are necessary in
	  ripper.

Wed Nov  4 21:39:10 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* .document: add some README files to default rdoc's of trunk.
	  patched by Roger Pack [ruby-core:26459]

Wed Nov  4 16:06:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/st.h (SIZEOF_ST_INDEX_T): moved from st.c for
	  Init_RandomSeed().

Wed Nov  4 15:50:16 2009  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* include/ruby/ruby.h (NUM2CHR): prefix __extension__ for
	  braced-groups within expressions.

Wed Nov  4 15:46:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (set_{internal,external}_encoding_once): fixed typos.

Wed Nov  4 12:49:18 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* proc.c (mnew): Fix scope issue [ruby-core:26069]

Wed Nov  4 08:50:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rb_hash_start): moved from string.c.

	* random.c (Init_RandomSeed2): register global address before set.

	* random.c (Init_RandomSeed): initialize hashseed.

Wed Nov  4 08:26:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_check): moved other checks from GetDIR.

	* dir.c (GetDIR): fixed a variable name.

Wed Nov  4 08:19:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (rb_fiber_start): fixed unconditional test.

Wed Nov  4 02:08:14 2009  Aaron Patterson  <tenderlove@ruby-lang.org>

	* ext/dl/cptr.c (rb_dlptr_eql, rb_dlptr_cmp): DL::CPtr#== and DL::CPtr#<=>
	  should not raise an exception when compared to a different object.

Wed Nov  4 00:05:36 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_upto): make next object before yield its block.
	  fix: can modify original begin string of String#upto.
	  [ruby-dev:26384] [ruby-dev:39626]

Mon Nov  2 18:33:21 2009  wanabe  <s.wanabe@gmail.com>

	* cont.c (fiber_free): don't free unallocated local_storage. see #1325.

	* cont.c (cont_init): clear local_storage not to use current thread's.

	* cont.c (fiber_t_alloc, root_fiber_alloc): link itself always for
	  a case that fiber_link_remove() is called before fiber_link_join().

	* cont.c (fiber_init): clear cont->vm_stack and th->stack before
	  root_fiber_alloc() in rb_fiber_current().

Mon Nov  2 14:52:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_exc_raise, rb_exc_fatal, rb_make_exception):
	  suppressed shorten-64-to-32 warnings.

Mon Nov  2 14:43:48 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_pthread.c (native_stop_timer_thread): delay joining timer
	  thread after unlocking mutex.

Mon Nov  2 13:31:14 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_pthread.c (native_stop_timer_thread): need to join timer thread
	  only when really stopping it.

Mon Nov  2 12:55:50 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_{pthread,win32}.c (native_stop_timer_thread): join the thread
	  here.

	* thread_{pthread,win32}.c (native_reset_timer_thread): new function.

	* thread.c (rb_thread_stop_timer_thread, rb_thread_reset_timer_thread):
	  call above function instead of simply setting 0.

Mon Nov  2 11:22:19 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl/win32/lib/win32/registry.rb: update rdoc. [ruby-core:26022]

Sun Nov  1 20:16:03 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c: fixed rdoc. [ruby-core:26457]

Sun Nov  1 16:24:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_stack_grow_dir): fix for universal binary.

	* configure.in (sitehdrdir, vendorhdrdir): fixed default values.

Sun Nov  1 13:31:16 2009  wanabe  <s.wanabe@gmail.com>

	* win32/win32.c (overlapped_socket_io, recvmsg, sendmsg): pass handle
	  instead of pointer to CloseHandle().

Sun Nov  1 13:11:27 2009  wanabe  <s.wanabe@gmail.com>

	* ext/socket/socket.c (socket_s_ip_address_list): use FreeLibrary() to
	  free HMODULE.

Sun Nov  1 08:17:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (GET_STACK_BOUNDS): refactored common code.  based on a
	  patch from Suraj N. Kurapati <sunaku AT gmail.com> in
	  [ruby-core:26443].

Sat Oct 31 23:44:35 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_count): remove optimization using #size.
	  revert r25560.

	* vm_eval.c (rb_funcall_no_recursive): remove method.

Sat Oct 31 23:28:49 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_eval.c (check_funcall): logic updated according to
	  [ruby-dev:39594].  search method entry, call if it exists;
	  otherwise check method_missing, call if it was overridden,
	  protecting exceptions; if NoMethodError happens, check method
	  name.

	* vm_eval.c (vm_call0): use idMethodMissing.

	* vm_eval.c (rb_search_method_entry): typo fixed.

Sat Oct 31 17:19:28 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPResponse#each_response_header):
	  cosmetic: '?\ ' -> '?\s'

Fri Oct 30 22:09:47 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPResponse#each_response_header):
	  accept multiline message header of HTTP response.  see #1796.
	  cf. RFC 2616 '4.2 Message Header'.

	* test/net/http/test_httpresponse.rb: added.

Fri Oct 30 18:54:04 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (trnext): detect empty range and raise exception.
	   [ruby-dev:39108]

Fri Oct 30 17:01:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (enum call_type): get rid of last comma.

	* vm_eval.c (vm_call0, vm_call_super, rb_f_send, rb_f_public_send):
	  fixed call_type.  [ruby-dev:39581]

	* vm_eval.c (rb_search_method_entry, rb_method_call_status): split
	  from rb_call0().

	* vm_eval.c (rb_check_funcall): get rid of raising exceptions and
	  hiding further exceptions.  [ruby-dev:39584]

	* vm_eval.c (rb_funcall_no_recursive): ditto.

Fri Oct 30 13:36:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_blocking_region): reverted r25566, and added
	  description that no exception is allowed inside `func', instead.
	  see [ruby-dev:39582]

Fri Oct 30 13:13:16 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32.c (recvmsg, sendmsg, link): shouldn't raise ruby's exceptions
	  in the functions expected as system API.  see [ruby-dev:39579] and
	  [ruby-dev:39582]

Fri Oct 30 12:59:20 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (rb_thread_blocking_region): standard C doesn't accept
	  preprocessing directive within macro expansion.

Fri Oct 30 10:55:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_blocking_region): must ensure to unlock GVL.
	  [ruby-dev:39579]

Fri Oct 30 04:47:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RSTRING_END): trivial optimization.

	* string.c (rb_str_sub_bang): trivial optimization.

Fri Oct 30 02:11:36 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_count): call #size using rb_funcall_no_recursive()
	  to prevent infinite recursive calls.  [ruby-core:24794]

	* vm_eval.c (rb_funcall_no_recursive): utility function to check
	  direct recursive call.

	* vm_eval.c (rb_check_funcall): move from eval.c. [refactoring]

Thu Oct 29 18:37:02 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (Init_Encoding): revert previous commit.

	* ruby.c (process_options): ditto.

Thu Oct 29 15:35:39 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (Init_Encoding): set locale and filesystem encindex.

	* ruby.c (process_options): move setting func of filesystem
	  encoding to Init_Encoding.

Thu Oct 29 15:43:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_name_err_mesg_new): added prototype.

Thu Oct 29 13:53:18 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_to_ary): do not use #respond_to? to detect
	  to_ary.  Just call.  [ruby-core:23738]

	* eval.c (rb_check_funcall): new function with method existence
	  check.  returns Qundef when the method does not exist.

	* enumerator.c (enumerator_rewind): just call method, using
	  rb_check_funcall().  [ruby-core:23738]

	* error.c (exc_equal): ditto.

	* object.c (convert_type): ditto.

	* error.c (rb_name_err_mesg_new): export function.

	* eval.c (make_exception): ditto.

	* io.c (pop_last_hash): return early when the last argument is nil.

	* io.c (rb_io_puts): treat T_STRING specially for small
	  optimization.

	* vm_eval.c (raise_method_missing): skip method call if possible
	  using rb_method_basic_definition_p().

	* vm_eval.c (method_missing): ditto.

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_debug): test
	  suites changed to ignore exceptions caused by just-call policy.

Thu Oct 29 04:41:44 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (process_options): call rb_filesystem_encoding().

Thu Oct 29 04:40:36 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (Init_IO): rb_default_rs should be US-ASCII.

Thu Oct 29 01:22:01 2009  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* ext/socket/extconf.rb : Compilation failure on AIX.
	  ss_len (a member of struct sockaddr_storage) has preceding __,
	  but ss_family does not have it from AIX 5.2.

Wed Oct 28 16:32:49 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (get_filesystem_encoding): removed.

	* encoding.c (rb_locale_encindex): added.

	* encoding.c (rb_filesystem_encindex): added.

	* encoding.c (rb_filesystem_encindex): add an alias 'filesystem'.
	  [ruby-dev:39574]

	* encoding.c (enc_find): add rdoc about special aliases.

	* gem_prelude.rb (Gem.set_home): use Encoding.find('filesystem').

	* gem_prelude.rb (Gem.set_paths): ditto.

Wed Oct 28 15:02:31 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* gem_prelude.rb (Gem.set_home):
	  force_encoding(Encoding.filesystem_encoding)
	  [ruby-core:25959]

	* gem_prelude.rb (Gem.set_paths): ditto.

Wed Oct 28 14:24:45 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (get_filesystem_encoding):
	  add Encoding.filesystem_encoding [ruby-dev:39546]
	  also see [ruby-core:25959]

Wed Oct 28 14:51:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_each_group): fixed typo.

Wed Oct 28 13:02:10 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (Net::FTP#initialize): sets @binary to true.

	* lib/net/ftp.rb (Net::FTP#binary=): sends a TYPE command only when
	  logged in. [ruby-dev:39548]

	* lib/net/ftp.rb (Net::FTP#send_type_command): new private method
	  which sends an appropriate TYPE command according to the value of
	  @binary.

	* lib/net/ftp.rb (Net::FTP#login): calls send_type_command instead
	  of binary=.

Wed Oct 28 12:26:51 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_insnhelper.c (vm_setup_method): should push call frame before
	  raising exception, to put the Ruby-defined method name in the
	  error message.  [ruby-core:26333]

	* vm_insnhelper.c (VM_CALLEE_SETUP_ARG): macro modified.

	* vm_insnhelper.c (vm_yield_setup_args): modified for new
	  VM_CALLEE_SETUP_ARG macro.

Tue Oct 27 22:46:44 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/ftp.rb (Net::FTP#initialize): @sock = nil.

	* lib/net/ftp.rb (Net::FTP#binary=): send command only when
	  socket is open. [ruby-dev:39548]

Tue Oct 27 22:22:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (Init_stringio): added read_nonblock and
	  write_nonblock aliases.  [ruby-dev:39551]

	* ext/stringio/stringio.c (strio_data_type): typed.

Tue Oct 27 21:20:35 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb: add TkVariable#+@ and -@ method.

Tue Oct 27 16:36:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (chopped_length): get rid of unexpected exception.
	  see [ruby-core:26336].

Tue Oct 27 15:53:10 2009  Tanaka Akira  <akr@fsij.org>

	* gc.h (SET_MACHINE_STACK_END): use __i386.
	  Some compiler may not define __i386__.
	  Solaris 64-bit Developer's Guide:
	  http://docs.sun.com/app/docs/doc/816-5138/dev-env?l=en&a=view

Tue Oct 27 15:44:48 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (getbinaryfile, list): call to_s to convert
	  a Pathname instance into a string.  [ruby-core:26237]

Tue Oct 27 12:30:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.h (SET_MACHINE_STACK_END): use __i386__ instead of __i386,
	  and explicit size qualifiers.

Tue Oct 27 09:40:55 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.h (SET_MACHINE_STACK_END): add x86_64 version by nobu.

Tue Oct 27 09:27:59 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c (DECL_SC_REG): use __clang__.

Tue Oct 27 08:56:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: reverted r25443 because build_os is used in mkmf.rb
	  on some platforms.  [ruby-core:26332]

Tue Oct 27 08:01:57 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* parse.y (ripper_filename): add Ripper#filename. [ruby-dev:37856]

	* test/ripper/test_filter.rb: add more tests.

Tue Oct 27 07:53:25 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (garbage_collect_with_gvl): do not garbage_collect when
	  dont_gc flag turned on.  [ruby-core:26327]

Tue Oct 27 07:38:39 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c,stubs.c: remove errors or warnings when compiled
	  with old ruby 1.8.x.

	* ext/tk/tkutil/tkutil.c: ditto.

Tue Oct 27 05:56:39 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm.c (invoke_block_from_c): return Qnil when its iseq is
	  SPECIAL CONST. [ruby-core:26335]

Tue Oct 27 05:11:49 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c (DECL_SC_REG): check defined(__asm__) before use it.
	  LLVM/clang defines __GNUC__ but doesn't have __asm__.

Tue Oct 27 03:45:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.h): added RUBY_SITEARCH to use
	  different name from RUBY_ARCH.  [ruby-core:26324]

Mon Oct 26 20:04:13 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* array.c (rb_ary_cmp): Array#<=> returns nil when comparison fails
	  [ruby-core:26316]

Mon Oct 26 18:37:57 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (default_proc_arity_check): new support function.

	* hash.c (rb_hash_initialize): should do arity check as #default_proc=.
	  [ruby-core:26281]

Mon Oct 26 13:24:17 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/remote-tk.rb: typo fixed.

Mon Oct 26 12:34:08 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* ruby.c (usage): -T and -W descriptions updated.  see
	  [ruby-dev:39539]

	* man/ruby.1: ditto.

Mon Oct 26 12:06:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_fwrite): adjust stdio file position after direct write on
	  BSDish platforms.   [ruby-core:26300]

Sun Oct 25 15:44:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/handle.c (dlhandle_sym): fixed an invalid local variable
	  declaration.

Sun Oct 25 13:33:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_cntl): F_DUPFD is platform dependent.

Sun Oct 25 10:19:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/handle.c (rb_dlhandle_close): fixed an invalid local
	  variable declaration.

Sun Oct 25 05:44:34 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb (**): Optimization (up to 45% faster)

Sat Oct 24 14:28:40 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_set_default_proc): checks arity of default_proc
	  of a Hash.  [ruby-core:26087]

Sat Oct 24 13:38:45 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_cmp): defines Object#<=>.  [ruby-core:24063]

Sat Oct 24 09:51:28 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_flat_map): new method that concatenates the values
	  from given block.  also provides alias #collect_concat.

Sat Oct 24 00:36:47 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (io_cntl): update max file descriptor by the result of
	  fcntl(F_DUPFD).

Fri Oct 23 16:31:14 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (rb_class_new): move class check to rb_check_inheritable().

	* class.c (rb_check_inheritable): should not allow subclass of
	  class Class.  [ruby-core:26225]

Fri Oct 23 14:25:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (target, target_alias): replace with real cpu.

	* mkconfig.rb: build* are not needed in rbconfig.rb.

	* configure.in (warnflags): use -Wextra only when
	  -Wno-missing-field-initializers is available.

	* configure.in (optflags): removed -fomit-frame-pointer by default.

Fri Oct 23 09:12:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pathname.rb (Pathname::SAME_PATHS): FNM_SYSCASE is always
	  non-nil.

Fri Oct 23 07:32:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, Makefile.in, win32/Makefile.sub (XRUBY): runnable
	  ruby without current libraries.

	* common.mk (rdoc): use XRUBY.

Fri Oct 23 07:28:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): use -Wextra instead of -Wall.

	* gc.c (mark_current_machine_context): get rid of warning.

Thu Oct 22 21:10:39 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* class.c (rb_obj_basic_to_s_p): typo.  Please become familiar with
	  the ANSI style.

Thu Oct 22 20:20:27 2009  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (assert_in_out_err): test_stdout and
	  test_stderr should be an array.

	* test/ruby/test_rubyoptions.rb (test_notfound): test_stdin of
	  assert_in_out_err should be a string.

Thu Oct 22 17:49:05 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/fileutils.rb (FileUtils#fu_get_uid, fu_get_gid): Do not
	  convert an integer back and forth.

Thu Oct 22 17:29:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (arg_prepend): removed.  a patch from Mikhail T. in
	  [ruby-core:26217].

Thu Oct 22 04:54:41 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_inspect): print instance variables only when
	  Object#to_s is not overridden.  [ruby-core:24425]

	* class.c (rb_obj_basic_to_s_p): new function.

Wed Oct 21 19:32:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_obj_inspect): fixed rdoc about the case that to_s
	  is called.  [ruby-core:24425]

Wed Oct 21 08:17:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/logger/test_logger.rb (TestLogDevice#test_write): check
	  also error message.

Wed Oct 21 03:54:41 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb:
	  Creator functions now strict with their arguments
	  Support for empty matrices (see new method Matrix.empty)
	  Matrix#trace raises an ErrDimensionMismatch if the matrix is not square
	  Enumerators are returned when no block given
	  Consistent results when accessing elements with out of bounds indices
	  Details in [ruby-core:23598].

Wed Oct 21 00:27:15 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/httpauth/digestauth.rb: typo in exception message fixed.

Wed Oct 21 00:17:28 2009  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: imported upstream version (logger/1.2.7) see #2238.
	  * do not raise an exception even if log writing failed.
	  * do not raise ShiftingError if an aged file already exists.
	    (no ShiftingError will be raised from 1.2.7, just warn() instead)
	* test/logger/test_logger.rb: ditto.

Tue Oct 20 22:29:06 2009  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/matrix.rb:  Bug fix. See detail [ruby-core:23598].

Tue Oct 20 17:57:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_symbol, r_symreal): fixed the order of symbol and
	  its encoding modifier, in order to make the dump readable from
	  1.8.  [ruby-dev:39515]

Tue Oct 20 16:41:18 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (finite, scalb): inline'ed non-standard
	  identifier macros.  [ruby-core:26166]

Tue Oct 20 15:38:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (ripper_intern): enable literal optimization.

	* parse.y (method_call): dispatch symbols.  a patch from Andy Keep in
	  [ruby-core:26169].  [ruby-core:26165]

	* parse.y (mlhs_basic): fixed handling splat in middle of mlhs.  a
	  patch from Andy Keep in [ruby-core:26163]

	* parse.y (parser_here_document): dispatch delayed heredoc
	  contents.  based on a patch from Andy Keep in [ruby-core:24855].

Mon Oct 19 15:17:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .gdbinit (rb_method_entry): search method entry by class and id.

Mon Oct 19 15:03:31 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (enc/unicode/name2ctype.h): no need to create
	  directory if it already exists.

Mon Oct 19 11:34:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .gdbinit (rb_ps): dump all threads and their callstacks.  based
	  on [ruby-core:26155] by Joshua ben Jore <twists AT gmail.com>.

Mon Oct 19 10:59:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (prepare_iseq_build, rb_iseq_build_for_ruby2cext):
	  untrust mark array.  [ruby-core:26137]

Mon Oct 19 05:49:53 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/rexml/element.rb (text=): false should be converted to string.
	  A patch by Teruo Oshida [ruby-dev:38351]

Sun Oct 18 22:33:25 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: do not require lib/delta.rb.

	* lib/date/delta.rb: follows the above change.

Sun Oct 18 19:14:21 2009  Tanaka Akira  <akr@fsij.org>

	* parse.y (is_special_global_name): add boundary check.

Sun Oct 18 18:31:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): should not dup tmp string.  a
	  patch from neomjp neomjp in [ruby-core:24251].

Sun Oct 18 09:49:14 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_prime.rb
	  (TestPrime#test_eratosthenes_works_fine_after_timeout):
	  test for [ruby-dev:39465].

	* lib/prime.rb (Prime::EratosthenesSieve):
	  fixed [ruby-dev:39465].
	  suppressed memory reallocation.
	  constantified some magic numbers.

Sat Oct 17 22:11:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (id2encidx): register encoding name.
	  (r_object0): register object before encoding name.
	  [ruby-core:24882]

Sat Oct 17 17:56:58 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/rake/test_fileutils.rb (Rake::TestFileUtils#test_sh): uses
	  FileUtils::RUBY instead of fixed "ruby" so that the ruby command
	  works fine in Ruby's "make test-all".
	  (test_sh_with_a_single_string_argument): ditto.
	  (test_sh_with_multiple_arguments): ditto.
	  (test_sh_failure): ditto
	  (test_sh_special_handling): ditto.

Sat Oct 17 17:30:06 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (big_split): fix off-by-one error.  [ruby-dev:39501]

Sat Oct 17 16:34:27 2009  Tanaka Akira  <akr@fsij.org>

	* parse.y (parser_yylex): fix token even after trailing under score.

Sat Oct 17 11:27:44 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (basic_obj_respond_to): call #respond_to_missing?
	  always with two arguments.  [ruby-core:26090]

Sat Oct 17 08:51:44 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator#respond_to_missing): warn only when
	  specified method is a private.  [ruby-dev:39498]

Fri Oct 17 00:05:53 2009  wanabe  <s.wanabe@gmail.com>

	* st.c (unpack_entries): save table->bins and never change the table
	  during unpacking. Because st_insert() may cause GC and refer the
	  table, i.e. st_foreach().  [Bug #2196]

Fri Oct 16 22:20:25 2009  Tanaka Akira  <akr@fsij.org>

	* prelude.rb (require_relative): defined as a module function of
	  Kernel.

Fri Oct 16 20:18:28 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator#method_missing): remove backtrace
	  lines _until_ `method_missing'.

Fri Oct 16 20:09:55 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator#freeze): #freeze should freeze self
	  and the target at once.   [ruby-core:26118]

Fri Oct 16 19:39:28 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator#respond_to_missing): warn if optional
	  include_private argument is not false.  Delegator does (and
	  should) not forward private methods.  [ruby-core:26080]

	* lib/delegate.rb (Delegator#respond_to_missing): instead of
	  redefining #respond_to?, use #respond_to_missing?.  [ruby-core:26081]

Fri Oct 16 18:42:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/test_gc.rb: added tests based on [ruby-dev:39484]
	  from wanabe <s.wanabe AT gmail.com>.

Fri Oct 16 16:09:01 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn): `\'' is also quote character.

Fri Oct 16 13:40:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.h (rb_gc_debug_body): constified.

Fri Oct 16 13:20:39 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpMidRound): remove warnings.
	  patch from Charlie Savage. [ruby-core:22869]

	* ext/digest/bubblebabble/bubblebabble.c (bubblebabble_str_new): ditto.

	* ext/digest/digest.c (hexencode_str_new): ditto.

	* ext/iconv/iconv.c (iconv_convert): ditto.

	* ext/socket/socket.c (inspect_sockaddr): ditto.

	* ext/socket/raddrinfo.c (sockaddr_obj): ditto.

	* ext/syck/emitter.c (syck_emitter_write): ditto.

	* ext/syck/emitter.c (syck_emitter_flush): ditto.

	* ext/syck/emitter.c (syck_emit_tag): ditto.

Fri Oct 16 12:03:31 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/csv.rb (CSV#raw_encoding): returns ASCII-8BIT when the io
	  doesn't have encoding.

Fri Oct 16 03:15:52 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/csv.rb (CSV#read_to_char): set encoding and verify data
	  which read from io before encode it to @encoding.

	* lib/csv.rb (CSV#raw_encoding): add to get @io's encoding.

	* lib/csv.rb (CSV#read_io): add to read string and set @io's
	  encoding.

Thu Oct 15 18:26:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_intern3): check symbol table overflow before generate
	  next id.  [ruby-core:26092]

Thu Oct 15 15:14:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_encoding_set): get rid of parsing non-ascii string, and
	  refine messages for invalid name encoding.

	* io.c (io_reopen): unread current buffer before telling the
	  position, for the case of reopening same file.  [ruby-dev:39479]

Thu Oct 15 14:20:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_create): cannot retry with given block.
	  [ruby-dev:39487]

Thu Oct 15 09:25:07 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/init.c (rsock_init_sock): mswin doesn't have S_IFSOCK
	  flag in st_mode of struct stat. so, use rb_w32_issocket() function
	  instead of S_ISSOCK macro.

Thu Oct 15 00:47:42 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  use UTS#18 for POSIX character class.
	  http://rubyspec.org/issues/show/161

Thu Oct 15 00:26:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (rsock_init_sock): validate file descriptor.

Wed Oct 14 13:24:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): script name should not be shown in an
	  error message before loaded.

Wed Oct 14 09:06:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_run_node): need to call ruby_cleanup() always even
	  if any error occurred so far.

Wed Oct 14 08:08:12 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* proc.c (mnew): Method#new checks for respond_to_missing? with
	  private set to true
	  [ruby-core:26069]

Tue Oct 13 21:05:01 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Add DerivedCoreProperties, PropList (Binary Property),
	  PropertyAlias and PropertyValueAlias.
	  Now users of tool/enc-unicode.rb should specify
	  the directory of UCD files.

Tue Oct 13 18:54:25 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/variable.rb: bug fix. additional trace definition changes the
	  option of first trace definition.

Tue Oct 13 18:23:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (token_info_push, token_info_pop): reduced ifdefs.

	* parse.y (parser_magic_comment): fixed normalization.

Tue Oct 13 09:04:14 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* thread.c: Revert changes to Thread#raise made in r25278
	  [ruby-core:25367]

	* eval_intern.h: ditto

Mon Oct 12 23:27:57 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (login): use "anonymous@" as a default password.
	  [ruby-dev:39451]

Mon Oct 12 22:48:25 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (retrlines): added a new block parameter.

	* lib/net/ftp.rb (gettextfile): preserve missing end-of-line at end
	  of files.  [ruby-core:24590]

Mon Oct 12 19:48:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_run_node): if an exception occurred in ruby_option,
	  the result is not executable.

Mon Oct 12 05:51:11 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (fetch_token): warn invalid back reference
	  and subexp call. (\k and \g).

Mon Oct 12 03:47:42 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* marshal.c (has_encoding): added for check the regexp
	  is dumped by 1.8 or 1.9.

	* marshal.c (r_object0): use has_encoding.

Sun Oct 11 15:54:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/gdbm/gdbm.c (fgdbm_select): fixed rdoc.  a patch from Justin
	  Collins in [ruby-core:26050].

Sun Oct 11 10:27:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/context.rb (IRB::Context#irb_name): removed duplicated
	  attr_reader.  [ruby-core:26047]

	* lib/irb/ruby-lex.rb (RubyLex#lex_int2): removed duplicated
	  character class range.

Sun Oct 11 10:04:35 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (fetch_token_in_cc): warn when \p is not
	  followed by property name.

	* regparse.c (fetch_token): ditto.

Sun Oct 11 09:44:46 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regerror.c (onig_vsnprintf_with_pattern): added.

	* regparse.c (onig_syntax_warn): use above.

Sun Oct 11 09:04:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RB_GC_GUARD_PTR): workaround for gcc
	  optimization.

	* include/ruby/ruby.h (ruby_exec_node): declared.

Sun Oct 11 03:10:50 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (onig_syntax_warn): added.

	* regparse.c (CC_ESC_WARN, CLOSE_BRACKET_WITHOUT_ESC_WARN,
	  CC_DUP_WARN, UNKNOWN_ESC_WARN): use onig_syntax_warn.

Sun Oct 11 00:14:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (marshal_dump, marshal_load): prevent from GC.

Sat Oct 10 23:57:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (path_check_0): prevent from GC.

Sat Oct 10 23:51:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (rb_transcoding, str_transcoding_resize): fixed
	  types.

Sat Oct 10 20:35:27 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* math.c (math_atanh): reverted r25279.

Sat Oct 10 19:03:29 2009  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c: use rb_thread_blocking_region to avoid
	  rb_read_check.  This makes other threads runnable in getstr and
	  wgetstr.
	  (getch_func): extracted from curses_getch.
	  (curses_getch): use rb_thread_blocking_region with getch_func.
	  (getstr_func): extracted from curses_getstr.
	  (curses_getstr): use rb_thread_blocking_region with getstr_func.
	  (wgetch_func): extracted from window_getch.
	  (window_getch): use rb_thread_blocking_region with wgetch_func.
	  (wgetstr_func): extracted from window_getstr.
	  (window_getstr): use rb_thread_blocking_region with wgetstr_func.

	* include/ruby/io.h (rb_read_check): deprecated because it access
	  internal of stdio.

Sat Oct 10 18:59:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (cflags, cxxflags): remove duplicating options.

Sat Oct 10 18:19:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, Makefile.in (LIBRUBY_SO), common.mk (ruby.imp),
	  win32/mkexports.rb (each_export): exclude _threadptr_ functions.

Sat Oct 10 17:55:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_threadptr_errinfo): renamed.

Sat Oct 10 17:03:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_exec_node): removed unused argument.

Sat Oct 10 14:55:55 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* math.c (math_atanh): Fix bug for Math.atanh(+/-1). It now returns
	  +-Infinity. [ruby-core:26028]

Sat Oct 10 14:09:40 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* thread.c (rb_threadptr_execute_interrupts_rec, rb_threadptr_raise):
	  Thread#raise with no argument will now re-raise the current exception
	  if there is one [ruby-core:25367]

	* eval.c (get_errinfo, rb_rubylevel_thread_errinfo): Getter for
	  current exception for a given thread

Fri Oct  9 23:10:04 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (rb_method_boundp): should exclude NOEX_RESPONDS.
	  based on the patch from Nikolai Lugovoi.  [ruby-core:25949]

Fri Oct  9 21:14:40 2009  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS::Requester::ConnectedUDP): disable
	  reverse lookup.
	  (Resolv::DNS::Requester::UnconnectedUDP): ditto.

Fri Oct  9 10:12:13 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/irb/context.rb (IRB::Context#initialize):
	  remove warnings when $VERBOSE is set as true in .irbrc.

Fri Oct  9 02:58:18 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb: optimized.

	* enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  U+100000-U+10FFFD is assigned, not Cn.

Fri Oct  9 02:12:02 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* ext/curses/curses.c: Many functions of module Curses could cause a
	  crash if the ncurses library was not properly initialized.
	  Fix pointed out by Alexander Beisig [ruby-core:22592]
	  Functions fixed: attroff, attron, attrset, bkgd, bkgdset,
	  can_change_color, close_screen, closed, color_content, curs_set,
	  def_prog_mode, delch, deleteln, getmouse, getstr, has_colors,
	  init_color, init_pair, insertln, keyname, mouseinterval, mousemask,
	  pair_content, pair_number, reset_prog_mode, resizeterm, scrl,
	  setscrreg, standend, standout, start_color, timeout, ungetmouse,
	  use_default_colors

Fri Oct  9 01:07:34 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (ADD_TRACE): fire coverage event in ensure clause.
	  [ruby-dev:39303]

	* iseq.h, iseq.c: ditto.

Fri Oct  9 00:33:29 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/net/telnet.rb (cmd): Pass FailEOF options: patch by Brian
	  Candler [ruby-core:22723]

Fri Oct  9 00:01:17 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.udp_server_recv): extracted from
	  Socket.udp_server_loop_on.

Thu Oct  8 05:45:14 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb: parse range notation of UnicodeData.txt.

	* enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  follow above change. [ruby-dev:39444]

Thu Oct  8 02:46:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): copy by chunks.

Thu Oct  8 01:23:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (iseq_s_disasm): accept proc objects.  [ruby-core:18762]

Wed Oct  7 16:42:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (mark_dump_arg, mark_load_arg): ignore already cleaned
	  data.  [ruby-core:25969]

	* marshal.c (clear_dump_arg, clear_load_arg): clear freed fields.

Wed Oct  7 16:06:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_long2int): evaluates the argument only
	  once.

	* struct.c (rb_struct_alloc): check array length overflow.

Wed Oct  7 09:23:49 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): don't assign -1 to unsigned int.

Wed Oct  7 00:27:01 2009  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS.bind_random_port): bind to "::" for IPv6.
	  (Resolv::DNS::ConnectedUDP#initialize): specify is_ipv6 argument of
	  bind_random_port.
	  [ruby-core:25970]

Tue Oct  6 23:32:38 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_upto): RDoc updated.  a patch from Nobuhiro
	  IMAI <nov at yo.rim.or.jp> in [ruby-dev:39440]. [ruby-dev:39439]

Tue Oct  6 21:30:58 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (io_reopen): avoid close if possible.

Tue Oct  6 18:56:09 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_select): Struct#select should return
	  enumerator when no block given.

Tue Oct  6 06:26:00 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* * ext/tk/lib/tk/canvas.rb: *** POTENTIALLY INCOMPATIBLE ***
	  'tags' option of a TkcItem object should give a list of TkcTag objs.

	* ext/tk/lib/tkextlib/vu/dial.rb: fix logical bug.

	* ext/tk/lib/tk/canvas.rb, ext/tk/lib/tkextlib/blt/component.rb:
	  lack of support for methodcall_optkeys.

Mon Oct  5 17:19:33 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator::public_api): take snapshot of
	  public method at the beginning time.

	* lib/delegate.rb (SimpleDelegator#initialize): use
	  Delegator.public_api since public_method might be added after
	  initialization.  [ruby-dev:39383]

	* lib/delegate.rb (DelegateClass): ditto.

Mon Oct  5 12:22:12 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_{times, shuffle_bang, sample}): reducing macro
	  calls inside of the loop by keeping pointers in local
	  variables. a patch from Masahiro Kanai (CanI) in [ruby-dev:39406].
	  It was found and fixed at Security and Programming camp 2009.

	* string.c (rb_str_{times, split_m}): ditto.

	* struct.c (rb_struct_{getmember, set, aref_id, aset_id}, {make,
	  inspect}_struct, recursive_{equal, hash, eql}): ditto.

Mon Oct  5 00:09:57 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (basic_obj_respond_to): should not call
	  #respond_to_missing? for not implemented methods.
	  [ruby-core:25909]

	* vm_method.c (rb_method_boundp): returns exceptional value 2 for
	  not-implemented methods when called from #respond_to? (specifies
	  by new constant NOEX_RESPONDS).

	* method.h (enum): new constant NOEX_RESPONDS added.

Sun Oct  4 22:16:29 2009  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/cookie.rb: add default value to @@accept_charset
	  if have not defined. [ruby-dev:38987]

	* lib/cgi/util.rb: ditto.

Sun Oct  4 19:30:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (struct {dump,load}_arg): manage with dfree, instead
	  of using local variable which may be moved by context switch.
	  [ruby-dev:39425]

Sun Oct  4 15:00:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (NATINT_LEN, pack_pack): suppressed warnings.

Sun Oct  4 14:01:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems.rb (Gem::binary_mode): binary mode uses binary
	  encoding.

Sun Oct  4 08:27:10 2009  Tanaka Akira  <akr@fsij.org>

	* enum.c (slicebefore_ii): use id_eqq.

Sun Oct  4 06:40:09 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (ruby.mmp): added macro RUBY_EXPORT to match the
	  change in dln.c

Sun Oct  4 05:34:34 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb: add TkVariable#to_hash,to_proc,to_int,
	  to_str,to_ary

Sun Oct  4 00:59:52 2009  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb: fix command-line option of
	  non-interactive terminal. [ruby-core:23016]

Sun Oct  4 00:40:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake/contrib: added.  [ruby-core:25918]

Sat Oct  3 22:14:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (bv_decls, bvar): fix for block variables.
	  [ruby-dev:39423]

Sat Oct  3 21:19:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_add_method_def): no redefinition warning on
	  undef.

Sat Oct  3 18:51:11 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_f_integer): now Integer() takes optional base
	  argument.  base will be ignored for non string values.
	  suggested by Sam Carr at RubyFoo Lounge at London.

	* test/ruby/test_integer.rb (TestInteger#test_Integer): test
	  updated.

Sat Oct  3 04:34:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (assignable_gen): parser_yyerror takes two arguments.

Sat Oct  3 04:07:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake: updated to rake code to rake-0.8.7 source code base.

	* lib/rake/loaders/makefile.rb (Rake::MakefileLoader#process_line):
	  respace dependencies too.

Sat Oct  3 02:59:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (assignable_gen): get rid of macro collision.

Sat Oct  3 02:49:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_make_shared): should count frozen array itself.

Sat Oct  3 01:01:20 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/unicode/name2ctype.h: Updated to Unicode 5.2.0.

Sat Oct  3 01:01:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: workaround for regexp metacharacters of expr in
	  prefix path.

Sat Oct  3 00:47:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ripper/dummyparser.rb (DummyParser): improvement by Magnus
	  Holm in [ruby-core:25884].
	  * remove scanner events which simply returned the first argument.
	  * all parser events are now automatically generated.
	  * simplify blocks.

Sat Oct  3 00:43:52 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* method.h (rb_method_type_t): remove a comma at end of
	  enumerator list.

Sat Oct  3 00:31:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (discrete_object_p): needs the argument type to get rid
	  of truncation on platforms where VALUE is larger than int.

Fri Oct  2 22:30:15 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/unicode/name2ctype.h.blt, enc/unicode/name2ctype.kwd,
	  enc/unicode/name2ctype.src: Updated to Unicode 5.2.0.
	  NOTE: when you update these data, download UnicodeData.txt
	  and Scripts.txt from http://www.unicode.org/Public/UNIDATA/
	  and run
	  ruby1.9 tool/enc-unicode.rb UnicodeData.txt Scripts.txt \
	  > enc/unicode/name2ctype.kwd

	* enc/unicode/Scripts.txt: removed.

	* enc/unicode/UnicodeData.txt: removed.

Fri Oct  2 20:49:19 2009  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_slice_before): take a pattern if no block given.

Fri Oct  2 20:37:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (ripper_yylval_id, ripper_get_{id,value}): wrap ID by
	  NODE to track local variable assignment.

	* parse.y (lvar_defined_gen, assignable_gen): enable local
	  variable check.  [ruby-core:24923]

	* parse.y (validate): use value only.

	* test/ripper/test_parser_events.rb (test_local_variables): tests
	  based on a patch from Magnus Holm in [ruby-core:25885].

Fri Oct  2 15:34:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (ruby_suppress_tracing): get rid of clobbering by
	  longjmp.

Fri Oct  2 09:20:35 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (rb_origenviron): remove unused old variable.
	  [ruby-dev:39412]

Thu Oct  1 14:16:39 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{setup.mak,Makefile.sub,win32.c},include/ruby/win32.h (RT_VER):
	  split compiler specification and runtime library specification.

	* win32/Makefile.sub (LD_SHARED*, config.status): no need to embed
	  manifest if not exist.

Thu Oct  1 13:23:14 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getpid): simply call GetCurrentProcessId()
	  instead of calling MSVCRT's getpid().

Wed Sep 30 13:15:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_add_method_def): show the location where
	  overwritten method was defined.  [ruby-dev:39400]

Wed Sep 30 00:37:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (enumerator_block_call): extracted.

Wed Sep 30 00:00:25 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): escape as \x{XXXX} when the encoding is
	  other than Unicode. [ruby-dev:39388]

Wed Sep 30 00:00:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (THREAD_MODEL): modified message when no thread
	  model is available.

Tue Sep 29 23:17:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_scan_open_args): rb_utf8mac_encoding is undefined.

Tue Sep 29 22:25:41 2009  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_struct_iv_get): deprecated because it is
	  not used and access internal structure.

Tue Sep 29 22:19:36 2009  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb (assert_equal): use Time#subsec if nsec
	  is not enough to distinguish arguments.

Tue Sep 29 21:16:35 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_scan_open_args): add UTF8-MAC to no-conversion encoding.

Tue Sep 29 21:21:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (--enable-pthread): deprecated.

Tue Sep 29 21:03:59 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/pp.rb (Kernel#pp): returns its arguments, like Kernel#p.
	  [ruby-dev:34830]

Tue Sep 29 17:02:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/lib/json/common.rb (recurse_proc): removed needless
	  module_function, since visibility is already module_function.

Tue Sep 29 13:48:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_method_definition_eq): non-null definition is
	  not equal to null definition.

	* vm_method.c (rb_add_method_def): nothing to do if old method had
	  same definition.  [ruby-dev:39397]

Tue Sep 29 06:50:32 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): dump as \uXXXX when the
	  string is in Unicode. [ruby-dev:39388]

Tue Sep 29 06:49:16 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_unicode_p): defined.
	  Returns 1 when the encoding is Unicode series
	  other than UTF-7 else 0.

Tue Sep 29 04:14:08 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_filesystem_encoding): On Unix systems,
	  filesystem encoding should be locale encoding.
	  [ruby-dev:39393]

Tue Sep 29 04:07:58 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* hash.c (rb_f_getenv): use rb_filesystem_str_new_cstr
	  instead of rb_str_new2.
	  ENV['PATH'].encoding should be Filesystem Encoding
	  because its content is related to filesystem.
	  see [ruby-dev:39393]

	* hash.c (env_fetch): ditto.

	* string.c (rb_filesystem_str_new): defined.

	* string.c (rb_filesystem_str_new_cstr): ditto.

	* include/ruby/intern.h (rb_filesystem_str_new): added.

	* include/ruby/intern.h (rb_filesystem_str_new_cstr): ditto.

Tue Sep 29 04:06:18 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/st.h: include inttypes.h and stdint.h.

Tue Sep 29 00:07:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_f_getenv, env_fetch): env string may be overwritten.

Mon Sep 28 23:30:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (load_lib, dln_find_exe_r): env string may be overwritten.

	* dln.c (dln_{exit,loaderror,memerror,notimplement}): renamed as
	  independent names.

	* dln.c (aix_loaderror): needs format string.

Mon Sep 28 19:36:20 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (LK_ERR): with overlapped I/O, LockFileEx() returns
	  ERROR_IO_PENDING if the file is locked.

Mon Sep 28 19:05:05 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* include/ruby/st.h: aligned prototype of st_hash_uint32 with function
	  definition (fixing compiling problem on cygwin)

Mon Sep 28 12:13:15 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* method.h (enum): new method type VM_METHOD_TYPE_MISSING.

	* vm_eval.c (vm_call0): invoking VM_METHOD_TYPE_MISSING method
	  objects.

	* vm_insnhelper.c (vm_call_method): invoking method defined from
	  VM_METHOD_TYPE_MISSING.

	* proc.c (rb_method_entry_arity): ditto.

	* vm_method.c (rb_method_entry_eq): two method object wraps
	  method_missing with same symbol should be equal.
	  [ruby-core:25755]

	* proc.c (mnew): should always return method object.

Mon Sep 28 11:38:07 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (parser_tokadd_string): the byte after ``\'' may be a part of
	  multibyte character, so pushback it. [ruby-list:46416]

Mon Sep 28 10:06:38 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* stringio/stringio.c (strio_read): set ASCII-8BIT encoding
	  when length argument is given.

Mon Sep 28 01:28:17 2009  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* Makefile.in (miniruby): suppress duplication warning on AIX.

Mon Sep 28 01:13:25 2009  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* common.mk (ruby.imp): add text section [Bug #2064].

	* common.mk (ruby.imp): do not export Init_*.

Sun Sep 27 13:06:43 2009  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb (PP:ObjectMixin#pretty_print): delegates has no inspect
	  method.  [ruby-core:25804]

Sun Sep 27 12:01:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_buf_cat2): optimize since all second arguments are
	  constant literals.

	* string.c (str_cat_char): unused now.

	* string.c (rb_hash_{uint{32,},end}): removed.

Sun Sep 27 11:58:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (optflags): add -fomit-frame-pointer by default.

Sun Sep 27 11:28:15 2009  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_minmax): use struct for memo.
	  (enum_minmax_by): ditto.

Sun Sep 27 10:21:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): check all flags if each are available.

Sun Sep 27 05:35:17 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/ext/generator/generator.c: Documentation patch by okkez.
	  [Bug #2075]

Sun Sep 27 04:20:55 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): result's encoding should be fixed.
	  If default_internal is not nil, the encoding is default_internal.
	  Else if default_external is not nil, the encoding is default_external.
	  But the encoding is not ASCII-compatible, the encoding is replaced by
	  US-ASCII.
	  Characters in ASCII-incompatible encoding or non ASCII characters
	  in other than the encoding will be \xXX escaped.
	  [ruby-dev:39343]

	* string.c (str_buf_cat2): defined.

	* string.c (prefix_escape): removed.

Sun Sep 27 05:37:45 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/missing-pips.c: Updated to work with the latest PIPS 1.6.

	* symbian/setup: ditto.

	* symbian/README.SYMBIAN: ditto.

Sun Sep 27 02:00:46 2009  Koichi Sasada  <ko1@atdot.net>

	* string.c: use rename-macro instead of RUBY_ALIAS_FUNCTION_TYPE.
	  Because build causes failure.

Sat Sep 26 23:29:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c: moved murmur hash from string.c.  [ruby-dev:39376]

Sun Sep 26 00:24:14 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup: Updated .mmp file generation due to blockinlining.c removal.

Sat Sep 26 22:39:24 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* Makefile.in(test-rubyspec): explicitly executes run subcommand of
	  mspec.

	* spec/README: typo fix

Sat Sep 26 17:53:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (COLLISION): improved collision log feature.

	* string.c (hash): updated to MurmurHash 2.0 2009-09-19.

	* string.c (rb_hash_start): fixed shift width on 128bit platform.

	* include/ruby/intern.h (rb_hash_{start,uint32,uint,end}): fixed
	  prototypes.

Sat Sep 26 13:26:55 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/net/http.rb (transport_request): Handle timeout error by
	  closing socket if exception raised. [ruby-core:20976]

Sat Sep 26 12:08:17 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (rb_method_entry_eq): method defined from same
	  block/proc should be equal.  [ruby-core:25755] [ruby-core:24791]

Sat Sep 26 08:35:12 2009  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (compile_string): rename to parse_string(), because
	  this function only parse String to NODE.

Fri Sep 25 16:01:45 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (rb_w32_access): new function to
	  replace MSVCRT's access().
	  [ruby-core:25761]

	* file.c (eaccess): workaround for recent MSVCRT is no longer needed.

Fri Sep 25 13:04:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (mnew): fix for instance method of Module, BasicObject
	  and subclass of a class which overrides respond_to_missing?.
	  based on a patch from Nikolai Lugovoi <nlugovoi AT gmail.com> in
	  [ruby-core:25748].

Fri Sep 25 11:56:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_mod_method_defined): should return true or false.

Thu Sep 24 13:32:53 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (mnew): generate method object that wraps method_missing,
	  when #respond_to_missing? is defined.

	* test/ruby/test_object.rb (test_respond_to_missing): add test
	  suites for #respond_to_missing? changes.

Thu Sep 24 09:41:42 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/mathn.rb (Bignum#**): Fixed bignum**fixnum that was broken when
	  requiring lib/mathn
	  [ruby-core:25740]

Thu Sep 24 02:21:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/math.rb (atan): atan(Infinity) is
	  PI/2.

	* ext/bigdecimal/lib/bigdecimal/math.rb (atan): reduce loop with
	  the double-angle formula.  based on a patch from Masahiro
	  Kanai (CanI) in [ruby-dev:39367].

Thu Sep 24 01:14:18 2009  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* dln.c (aix_loaderror): fixed typo. suppress warnings.

Thu Sep 24 00:17:06 2009  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_minmax): reduce comparison.
	  (enum_minmax_by): ditto.

Wed Sep 23 22:58:57 2009  Tanaka Akira  <akr@fsij.org>

	* lib/thread.rb (ConditionVariable#wait): add timeout argument.
	  [ruby-talk:346154]

Wed Sep 23 21:25:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/math.rb (atan): refined.

Wed Sep 23 17:08:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (assign_in_cond): also should warn assignment to dvar in
	  conditional.  [ruby-dev:39363]

Wed Sep 23 13:14:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_upto): keep first width.  [ruby-dev:39361]

Wed Sep 23 11:28:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/instruction.rb (make_header_prepare_stack): check stack
	  overflow.  [ruby-core:25714]

	* tool/instruction.rb (make_footer_stack_val): ditto.

Wed Sep 23 05:03:36 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* proc.c (umethod_bind, rb_mod_define_method): Fix bug that
	  disallowed methods from singleton classes to be used for
	  UnboundMethod#bind, Kernel#define_singleton_method and
	  Module#define_method, even when that singleton class was of the right
	  kind_of. A patch by Shane O'Brien [ruby-core:25632]

Tue Sep 22 22:56:48 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (basic_obj_respond_to): new function to fundamental
	  behavior for #respond_to?

	* vm_method.c (basic_obj_respond_to): calls #respond_to_missing
	  method if overridden, to check responsiveness of methods
	  implemented by #method_missing.

Tue Sep 22 16:34:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_table_entry, st_get_key): use st_index_t.

Tue Sep 22 16:28:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regenc.h (PosixBracketEntryType): constified.

	* regenc.h (PosixBracketEntryInit): suppress warnings.

	* regerror.c (onig_error_code_to_str, onig_snprintf_with_pattern):
	  fixed type.

	* regparse.c (st_str_end_key, str_end_cmp, str_end_hash):
	  constified.

	* tool/transcode-tblgen.rb (transcode_generated_code): fixed type.

Tue Sep 22 10:29:06 2009  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_chunk): new method Enumerable#chunk.
	* enum.c (enum_slice_before): new method Enumerable#slice_before.
	  [ruby-dev:38392] [ruby-dev:39240]

Tue Sep 22 05:58:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c, cont.c, gc.c, insns.def, iseq.c, iseq.h, process.c,
	  thread.c, vm.c, vm_core.h, vm_dump.c, vm_eval.c,
	  vm_insnhelper.c, vm_method.c, template/insns_info.inc.tmpl,
	  tool/instruction.rb: fixed types.

Tue Sep 22 05:04:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/{ludcmp,math}.rb: depend on
	  bigdecimal.

	* ext/bigdecimal/lib/bigdecimal/*.rb: made module functions.

Tue Sep 22 04:47:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (GetVpValue): support conversion from
	  Rational.  [ruby-core:25697]

Tue Sep 22 04:43:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, win32/Makefile.sub (INSNS): depend on tools.

Tue Sep 22 01:10:22 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* ossl_ocsp.c (ossl_ocspres_to_der): Bug fix in Response#to_def.
	  Patch by Chris Chandler [ruby-core:18411]

Tue Sep 22 01:10:02 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* ossl_config.c (ossl_config_add_value_m, ossl_config_set_section):
	  Check if frozen (or untrusted for $SAFE >= 4) [ruby-core:18377]

Mon Sep 21 17:12:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (proc_binding): allow proc from method.  [ruby-core:25589]

	* vm.c (collect_local_variables_in_env): block iseq can be NULL.

Mon Sep 21 10:50:37 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (rb_time_succ): make Time#succ obsolete since time is not
	  a discrete value.

	* range.c (discrete_object_p): treat time objects specially to
	  determine discrete values, since time objects have #succ yet are
	  discrete (for now at least).

Mon Sep 21 10:13:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_new, cont_capture, fiber_t_alloc): needs already
	  running thread.  cf. [ruby-core:25681]

Mon Sep 21 00:07:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/math.rb (sin, cos, atan, exp, log):
	  improved precision and performance.  based on a patch from Makoto
	  Yamashita in [ruby-core:25600] and [ruby-core:25602].

Sun Sep 20 11:11:34 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* struct.c (rb_struct_equal, rb_struct_eql): Handle comparison of
	  recursive structures [ruby-core:24759]

	* range.c (range_eq, range_eql):  ditto for ranges

Sat Sep 19 17:46:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (ENABLE_VM_OBJSPACE): socklist needs st_table in
	  rb_w32_sysinit(), before object space initialization.

Sat Sep 19 17:32:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (GlobPathValue), file.c (rb_get_path_check): path names
	  must be ASCII compatible.

Sat Sep 19 00:02:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_type): forward declaration to suppress a
	  warning.  a patch from Naohisa Goto at [ruby-dev:39350]

Fri Sep 18 23:59:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (GlobPathValue): adjust return types.  based on a patch
	  from Naohisa Goto at [ruby-dev:39350].

Fri Sep 18 23:51:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): entry regexp object before its encoding
	  name.  [ruby-core:25625]

Fri Sep 18 16:29:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (eval.o): needs vm.h.

	* eval.c (ruby_cleanup): destruct current VM before exit.

	* gc.c (rb_objspace_free): free object space.

	* vm.c (ruby_vm_destruct): destruct and free VM struct.

Fri Sep 18 16:15:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each), parse.y (stmt, arg): arg_concat()
	  on op_asgn was inversed.  [ruby-core:25629] [Bug #2050]

Fri Sep 18 16:06:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (GlobPathValue): glob allows null bytes as separators.

Fri Sep 18 10:11:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* doc/re.rdoc: use rdoc mode.

	* misc/rdoc-mode.el: added.

Fri Sep 18 09:02:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb (RDoc::RDoc#parse_files): don't branch by
	  RUBY_VERSION.

	* lib/rdoc/rdoc.rb (RDoc::RDoc#parse_files): emacs local variables
	  are delimited by a semicolon.  supported Vim style.

Fri Sep 18 07:06:41 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/fileutils/test_fileutils.rb: add a test for [ruby-dev:39345]

Fri Sep 18 06:47:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (push_glob): str should be a string always.

	* dir.c (rb_push_glob, dir_globs): use #to_path to convert non-
	  string values.  cf. [ruby-dev:39345]

Fri Sep 18 06:36:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (rm_f, rm_rf): FileUtils.rm can take an array.
	  [ruby-dev:39345]

	* lib/mkmf.rb (create_header): open in binmode.

Thu Sep 17 18:34:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (vm_xrealloc): free as like standard free if size is zero.

Thu Sep 17 15:41:02 2009  Koichi Sasada  <ko1@atdot.net>

	* eval_intern.h: use rb_node_newnode() directly.

Thu Sep 17 15:01:32 2009  Koichi Sasada  <ko1@atdot.net>

	* blockinlining.c: removed.

	* README.EXT: ditto.

	* README.EXT.ja: ditto.

Thu Sep 17 13:50:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_s_debug_set): set level, not only boolean.

Thu Sep 17 13:12:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser/ruby.rb (RDoc::Parser::Ruby): parse also rdoc
	  files.

	* doc/re.rdoc: renamed from re.rb.

Thu Sep 17 09:37:28 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* doc/re.rb: New document for Ruby's fork of Oniguruma.
	  written by Run Paint Run Run [ruby-core:25420]

	* re.c: import document in doc/re.rb.

	* .document: add doc/re.rb.

Thu Sep 17 06:03:40 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb (Matrix#rank): Two bug fixes. One made
	  Matrix[[0,0],[0,0],[1,0]].rank raise a NoMethodError while the other
	  one had Matrix[[0,1],[0,0],[1,0]].rank raise a TypeError.

Thu Sep 17 06:02:04 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Optimizations

Thu Sep 17 00:36:01 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_mdump): error message refined.

Wed Sep 16 19:27:43 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_thread.rb (TestThread#test_recursive): remove
	  implementation dependent test.

Wed Sep 16 17:42:52 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.status): install-capi needs docdir.  And,
	  mandir, infodir and ridir are also depend on datadir like docdir.

Wed Sep 16 17:20:49 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb (Matrix#/): Fix obvious bug

Wed Sep 16 16:59:34 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (DOCTARGETS): rdoc is default.

Wed Sep 16 16:27:40 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub: typo.

Wed Sep 16 16:20:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (CAPITARGET): enable iff doxygen is available.

	* configure.in (INSTALLDOC): enable if rdoc or doxygen are enabled.

	* common.mk (docs): target to make documents.

	* Makefile.in, win32/Makefile.sub (install-{all,nodoc}): trigger
	  by $(INSTALLDOC) from install.

Wed Sep 16 13:39:10 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb (determinant): Bug fix where determinant failed on
	  some matrices [ruby-core:23597]

Wed Sep 16 13:30:20 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb:  trivial optimizations

Wed Sep 16 13:15:17 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* template/Doxyfile.tmpl: RbConfig::CONFIG['DOT'] is sometimes nil.

Wed Sep 16 10:14:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja (rb_protect, rb_jump_tag): added.

Wed Sep 16 10:12:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (main): makes also encs.

Wed Sep 16 06:30:07 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* thread.c (rb_exec_recursive_outer, rb_exec_recursive): Added method
	  to short-circuit to the outermost level in case of recursion

	* test/ruby/test_thread.rb (test_recursive_outer): Test for above

	* hash.c (rb_hash_hash): Return a sensible hash for in case of
	  recursion [ruby-core:24648]

	* range.c (rb_range_hash): ditto

	* struct.c (rb_struct_hash): ditto

	* array.c (rb_array_hash): ditto

	* test/ruby/test_array.rb (test_hash2): test for above

Wed Sep 16 06:17:33 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* vm_eval.c (rb_catch_obj, rb_catch, rb_f_catch): No longer use the
	  obsolete function rb_iterate.

Tue Sep 15 21:48:12 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in (--enable-frame-address): removed.

Tue Sep 15 15:21:01 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{configure.bat,Makefile.sub} (RDOCTARGET): the meaning of this
	  macro was changed at r24923.

Tue Sep 15 15:16:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (install-rdoc), configure.in (RDOCTARGET): removed
	  circular dependency.  [ruby-dev:39339]

Tue Sep 15 15:09:13 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/configure.bat: need a space before a tab to output the tab by
	  echo.

Tue Sep 15 14:24:52 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_split_m): use rb_isspace when the
	  string may be ASCII-incompatible.

	* string.c (rb_str_lstrip_bang): ditto.

	* string.c (rb_str_rstrip_bang): ditto.

Tue Sep 15 12:12:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_USE_BUILTIN_FRAME_ADDRESS): check after real
	  target CPU is set.

	* configure.in (RUBY_UNIVERSAL_ARCH): check real target CPU after
	  AC_PROG_CC.

Tue Sep 15 06:42:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (install-all): target to install all.

	* tool/rbinstall.rb (parse_args): accept all install targets.

	* tool/rbinstall.rb (parse_args): show help message and exit if
	  rbconfig could not load.

Tue Sep 15 04:25:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RDOCTARGET): use install-all.  [ruby-dev:39334]

Tue Sep 15 03:00:35 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_lstrip_bang): use ascii_isspace().  [ruby-dev:39322]

	* string.c (rb_str_rstrip_bang): ditto.

	* string.c (rb_str_split_m): ditto.

Mon Sep 14 16:39:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c, parse.y: fixed types.

	* node.h (nd_line): limit to int.

Mon Sep 14 11:23:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, common.mk, */configure.bat (rdoc): make before
	  install if rdoc is enabled.  [ruby-dev:39325]

Mon Sep 14 10:56:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (check-ruby): run all test of ruby itself.

Mon Sep 14 10:44:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RB_TYPE_P): should not use BUILTIN_TYPE for
	  special constants.

Mon Sep 14 10:08:19 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): use rb_enc_mbc_to_codepoint
	  because we already knew char is found and got length.

Mon Sep 14 09:59:03 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (NUM2INT, NUM2LL, INT2NUM, UINT2NUM),
	  (LONG2NUM, ULONG2NUM, NUM2CHR): get rid of backward references of
	  macros.  the code couldn't compile by VC.

Mon Sep 14 08:33:11 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/net/http.rb (each_*): return enumerator if no block present.
	  Patch by Arthur Schreiber [ruby-core:18310]

Mon Sep 14 06:42:21 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/cgi/cookie.rb (value): Keep CGI::Cookie#value in sync with the
	  cookie itself. Based on a patch by Arthur Schreiber [ruby-core:17634]

Mon Sep 14 05:21:12 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/net/http.rb (fetch): Handle properly default values; a patch by
	  Arthur Schreiber [ruby-core:18308]

Mon Sep 14 04:07:09 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/set.rb (==): Optimization; patch by Arthur Schreiber [ruby-core:17203]

Mon Sep 14 03:30:23 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/pre-build: added rule to generate id.h for Symbian build.

	* symbian/configure.bat: fixed harmless error message.

Sun Sep 13 22:18:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_mod_remove_const): do not change VM state when an
	  exception will occur.

Sun Sep 13 21:25:01 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (oletypelib_get_libattr): some refactoring
	  by adding oletypelib_get_libattr.

Sun Sep 13 20:55:19 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (oletypelib_get_typelib): some refactoring
	  by adding oletypelib_get_typelib.

Sun Sep 13 20:18:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_sflag, proc_options, load_file_internal): fixed
	  types.

Sun Sep 13 19:39:59 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: some refactoring.

Sun Sep 13 19:38:34 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): no need to define DATA when error.

Sun Sep 13 18:48:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (XLDFLAGS): link startup code with ObjC support.

Sun Sep 13 13:38:00 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* thread.c (recursive_*): refactored the access to the inspect
	  table used by rb_exec_recursive_*. The functions recursive_push,
	  pop and check now assume a valid hash table as their first
	  argument. Added documentation.

Sun Sep 13 12:07:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (SYM2ID): needs parens.

	* include/ruby/ruby.h (NUM2INT, NUM2LL, INT2NUM, UINT2NUM),
	  (LONG2NUM, ULONG2NUM, NUM2CHR, rb_type_p, rb_special_const_p):
	  GCC specific optimization.

Sun Sep 13 11:06:12 2009  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI::Meta#content_type_parse): strip quotes.

Sun Sep 13 09:38:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/prime.rb (EratosthenesGenerator#initialize): call super.
	  (TrialDivisionGenerator, Generator23): ditto.  [ruby-core:25539]

Sun Sep 13 09:34:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_add_method_def): no warning for inherited
	  method.

Sun Sep 13 08:30:30 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: fix WIN32OLE_TYPELIB.new when the 1st
	  argument is the non-registered file.

Sun Sep 13 02:08:43 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h: change members of iseq_inline_cache_entry.
	  make cache value members to one union member "ic_value".

	* insns.def: ditto.

	* vm_insnhelper.c: ditto.

Sun Sep 13 01:15:49 2009  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (URI::FTP#buffer_open): fix the %2F handling.

Sun Sep 13 00:46:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (CALL_METHOD_HOOK): refined with macro.

	* vm_method.c (rb_remove_method_id): no definition body is
	  undefined.

	* vm_method.c (rb_add_method, rb_add_method_me): call method added
	  hook after definition.  [ruby-core:25536]

	* vm_method.c (rb_alias): hooks are called from rb_add_method_def.

Sat Sep 12 22:47:24 2009  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (URI::FTP#buffer_open): use the port specified in
	  the URI.

Sat Sep 12 17:31:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (GCC): subst for GCC depending extension libraries.

Sat Sep 12 07:52:59 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (EVENTSINK_Invoke): initialize result
	  variant value.

Fri Sep 11 21:52:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS: update for 1.9.2.  based on a patch from Run Paint Run Run
	  in [ruby-core:25534].

Fri Sep 11 21:38:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check for real target cpu on darwin 10.

Fri Sep 11 18:51:57 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/fileutils: use require_relative to require fileasserts.

Fri Sep 11 14:22:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (debugflags): use gdb by default on linux and
	  darwin.

	* configure.in (XLDFLAGS): keep ARCHFILE macro on AIX.

	* configure.in (RUBY_REPLACE_TYPE): define typename to default
	  type if the latter is found.

Fri Sep 11 13:57:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (fstat): override if large file support is
	  enabled.

Fri Sep 11 11:33:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.{guess,sub}: updated to automake-1.11.

Fri Sep 11 10:38:33 2009  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPHeader::encode_kvpair): also call to_s
	  to k.  A patch from swdyh <youhei@gmail.com>
	  http://github.com/swdyh/ruby/tree/c847f43c2ccb679b9ff728f8b1b16c6ceeb57f39

Fri Sep 11 09:45:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (aix_loaderror): get rid of using uninitialized value in the
	  case loadquery fails.  fixed wrong index variable usage.  see
	  [ruby-core:25479].

Fri Sep 11 07:52:43 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* unicode.c (onigenc_unicode_property_name_to_ctype):
	  ignore case of properties.

	* tool/enc-unicode.rb: downcase properties list.

	* enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  follow above.

Fri Sep 11 05:00:19 2009  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h (rb_data_type_t): Add comments.
	  And add a member variable "data", a multi-purpose storage
	  area for rb_data_type.

Fri Sep 11 02:14:21 2009  Tanaka Akira  <akr@fsij.org>

	* test/dl: use require_relative to require test_base.rb.

Fri Sep 11 02:06:44 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (rb_char_to_option_kcode): ASCII-8BIT should
	  also delay.

	* re.c (parser_regx_options): return rb_ascii8bit_encindex on
	  ASCII-8BIT. [ruby-dev:39300]

Fri Sep 11 01:14:00 2009  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/net/http.rb (fetch): rdoc fix, patch by Arthur Schreiber.
	  [ruby-core:18309].

Thu Sep 10 23:00:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): fix for parallel execution.
	  [ruby-core:25509]

Thu Sep 10 21:22:01 2009  Tanaka Akira  <akr@fsij.org>

	* test/dl/test_cptr.rb (test_free=): test SEGV at first.
	  [ruby-dev:39269]

Thu Sep 10 21:20:59 2009  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (assert_normal_exit): Don't use
	  AssertionMessage.

Thu Sep 10 15:59:05 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (UNKNOWN_ESC_WARN): added.

	* regparse.c (conv_backslash_value): Warn unknown
	  escaped chars in regexp. [ruby-dev:39104]

Wed Sep  9 22:02:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::Entry_#copy_file): open the source
	  file first to ensure it can be copied.  [ruby-core:25498]

Wed Sep  9 21:20:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_data_type): typed.

	* ext/dl/cfunc.c (dlcfunc_data_type): typed.

	* ext/dl/cptr.c (dlptr_data_type): ditto.

	* ext/dl/handle.c (dlhandle_data_type): ditto.

Wed Sep  9 17:17:31 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (parser_regx_options): only one kcode should effect
	  options [ruby-core:25411]

Wed Sep  9 15:46:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_feature_provided): fixed for autoloading extension
	  library without suffix.

Wed Sep  9 15:24:32 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* include/ruby/st.h : revert previous commit.

	* ext/objspace/objspace.c : remove st_memsize declare.

Wed Sep  9 14:07:19 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* include/ruby/st.h : fix duplicate st_memsize declare.

Wed Sep  9 13:33:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_autoload): initialize typed data.

Wed Sep  9 13:10:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_free_table): constified.

Wed Sep  9 13:09:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_data_type): typed.

	* enumerator.c (enumerator_data_type): typed.
	  (yielder_data_type, generator_data_type): ditto.

	* error.c (name_err_mesg_data_type): typed.

	* file.c (stat_data_type): typed.

	* thread.c (thgroup_data_type, mutex_data_type, barrier_data_type):
	  typed.

	* time.c (time_data_type): typed.

	* transcode.c (econv_data_type): typed.

	* variable.c (autoload_data_type): typed.

Wed Sep  9 11:11:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_data_type_struct): constified dsize.

Wed Sep  9 11:07:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_memsize): fixed wrong expression on IA64.

Wed Sep  9 10:51:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_restore_1, rb_cont_call): should be Fiber.

Wed Sep  9 00:27:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_data_type, fiber_data_type): typed.

Tue Sep  8 22:37:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb, lib/tmpdir.rb (Tmpname): extracted new module.
	  [ruby-dev:39197]

Tue Sep  8 22:18:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_init_*table_with_size): use st_index_t.

	* include/ruby/st.h (st_hash_func): use st_index_t.

Tue Sep  8 21:48:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_mark): mark callers iseqs.  [ruby-core:25474]
	  [Bug #2062]

Tue Sep  8 11:53:58 2009  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_mark): no need to mark inline cache entries.

	* insns.def (onceinlinecache, setinlinecache): save a value
	  to mark cached value.

Tue Sep  8 08:32:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/dl/test_{cfunc,ptr}.rb: added tests from Aaron Patterson.
	  see [ruby-dev:39249].

Mon Sep  7 17:22:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_tell): adjustment for ungotten data.

Mon Sep  7 17:13:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_encname_bom_p): removed magic number.

Mon Sep  7 12:26:04 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/inspector.rb (IRB::INSPECTORS.def_inspector): support
	  object without #inspect defined.  a patch from Daniel
	  Bovensiepen.  [ruby-core:25200]

Mon Sep  7 05:38:34 2009  Koichi Sasada  <ko1@atdot.net>

	* insns.def (opt_*): add IC operands.

	* vm_insnhelper.h (CALL_SIMPLE_METHOD): add a version which
	  use an inline cache.  USE_IC_FOR_SPECIALIZED_METHOD macro
	  switches the behaviour.  This change also removes
	  CALL_SIMPLE_METHOD_IC() macro.

	* tool/instruction.rb: fix elimination process to ignore
	  variable "ic".

Mon Sep  7 05:21:09 2009  Koichi Sasada  <ko1@atdot.net>

	* Makefile.in, common.mk: move a id.h generation rule.

Mon Sep  7 05:07:59 2009  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: remove RUBY_VERSION output.

Mon Sep  7 05:06:16 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c: rename macro name ENABLE_IC_FOR_IVAR
	  to USE_IC_FOR_IVAR.

Mon Sep  7 03:21:40 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.escape): obsoleted.

	* lib/uri/common.rb (URI.unescape): ditto.

Sun Sep  6 18:13:54 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.h (CALL_SIMPLE_METHOD_IC): make a macro
	  invoke simple method with inline cache entry.

	* insns.def (opt_length, opt_size): fix to use inline method cache.

Sun Sep  6 17:47:21 2009  Koichi Sasada  <ko1@atdot.net>

	* template/id.h.tmpl: fix this.

	* id.h: removed.  Because this file is generated automatically.

Sun Sep  6 17:31:28 2009  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_specialized_instruction), insns.def (opt_size):
	  optimize #size methods (by specialized instruction).

	* id.c, id.h, vm.c, vm_insnhelper.h: ditto.

Sun Sep  6 16:13:06 2009  Koichi Sasada  <ko1@atdot.net>

	* insns.def (setinstancevariable), vm_insnhelper.c (vm_setivar):
	  fix to use inline cache (trivial optimization).

Sun Sep  6 10:34:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c: fixed rdoc, a patch from Nobuhiro IMAI at [ruby-core:25433].

Sun Sep  6 05:19:09 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c: Add rdoc for ARGF.
	  contributed by Run Paint Run Run. [ruby-core:23854]

Sat Sep  5 15:21:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): op_asgn to aref should return rhs.
	  [ruby-core:25387]

Sat Sep  5 10:38:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): &&= and ||= should return rhs.
	  [ruby-dev:39163] (#1996), [ruby-core:25143]

Sat Sep  5 08:51:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (update_char_offset): position should be long.

	* re.c (match_hash, match_equal): new methods.  [ruby-core:24748]

	* re.c (reg_match_pos, rb_reg_eqq, rb_reg_s_quote): get rid of use
	  VALUE as int.

Fri Sep  4 20:40:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (round): added declaration.  [ruby-dev:39222]

Fri Sep  4 06:15:39 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (Init_Dir): alias Dir#path to Dir#to_path.  [ruby-core:25326]

Fri Sep  4 04:49:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_rand): fixed rdoc.  [ruby-core:25332]

Fri Sep  4 04:46:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/webrick/httpservlet/abstract.rb (do_OPTIONS): method names
	  are symbols now.  [ruby-core:24580]

Thu Sep  3 17:56:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (literal_concat_gen): concat body from dstr instead of
	  nd_next.  [ruby-core:25284]

Wed Sep  2 16:49:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* math.c (math_gamma): get rid of direct comparison between too
	  big double and integer, with gcc on x86_64.  [ruby-core:25257]

Wed Sep  2 13:47:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* math.c (domain_check): simplified.

Wed Sep  2 11:32:24 2009  Koichi Sasada  <ko1@atdot.net>

	* gc.c (obj_free): fix to free method table (fix memory leak).

Wed Sep  2 07:42:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/instruction.rb (RubyVM::InstructionsLoader#make_stackcaching_insns):
	  simplified.

Wed Sep  2 02:32:46 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/common.rb (NaN): Change definition
	  of NaN to 0.0/0 for 1.8/1.9 compatibility.

Wed Sep  2 01:16:32 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Update to JSON 1.1.9.

Tue Sep  1 19:56:28 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_eval.c (eval_string_with_cref): fix to check local_table_size.
	  [ruby-dev:39205] [Bug #2024]

Mon Aug 31 16:20:41 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* class.c (make_singleton_class): variable name changed.
	  removed an unnecessary conditional.

Mon Aug 31 14:17:09 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* class.c: refactored singleton class related matters.
	  Handles eigenclasses and plain classes transparently.

	  (make_metaclass): renamed from make_metametaclass.
	  (METACLASS_OF): new utility macro
	  (META_CLASS_OF_CLASS_CLASS): ditto.
	  (ENSURE_EIGENCLASS): ditto.
	  (make_singleton_class): extracted from rb_singleton_class.
	  (boot_defclass): moved from object.c
	  (Init_class_hierarchy): extracted from Init_Object.
	  (rb_make_metaclass): refactored.
	  (singleton_class_of): extracted from rb_singleton_class.
	  (rb_singleton_class): refactored.
	  (rb_define_singleton_method): it needs a metaclass only
	  but not its metametaclass.

	* object.c: booting class hierarchy was moved to class.c
	  for keeping dependency between compilation units least.
	  (Init_Object): extracting the booting into
	  Init_class_hierarchy.
	  (boot_defclass): moved to class.c.

Sun Aug 30 23:44:09 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): use mktime for the first guess.

Sun Aug 30 16:38:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_enc_symname2_p): not depend on nul terminator.

Sun Aug 30 14:11:45 2009  Tanaka Akira  <akr@fsij.org>

	* common.mk: dependencies updated.

Sun Aug 30 13:00:11 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (add): shortcut implemented for fixnums.
	  (sub): ditto.
	  (mul): ditto.

Sun Aug 30 10:24:43 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (eq): apply RTEST.
	  (ne): ditto.
	  (add): avoid method dispatch for bignums.
	  (sub): ditto.
	  (mul): ditto.
	  (mod): ditto.

Sun Aug 30 09:45:11 2009  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigmul1_single): new function specialized respect to
	  multiply two single digit bignums.
	  (bigmul0): use bigmul1_single.

Sun Aug 30 03:59:43 2009  Tanaka Akira  <akr@fsij.org>

	* timev.h (TIME_SCALE): defined as 1000000000.
	  (struct vtm): subsec is replaced by subsecx.
	  subsec * TIME_SCALE == subsecx.

	* time.c: avoid rational in most cases.
	  (struct time_object): timev is replaced by timexv.
	  timev * TIME_SCALE == timexv.

Sun Aug 30 03:17:25 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (init_leap_second_info): use TIMET_MAX.

Sun Aug 30 01:15:31 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_read_all): use gzfile_newstr;
	  set and convert its encoding. [ruby-dev:38304]

Sat Aug 29 20:40:02 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* vm_eval.c (rb_call0): gets rid of checking method cache twice.

	* method.h (rb_get_method_entry): added a prototype of the function.
	  (rb_method_entry_without_cache): more friendly name.

Sat Aug 29 12:16:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tmpdir.rb (Dir.mktmpdir): rolled back r24699.  [ruby-dev:39193]

Sat Aug 29 03:27:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#make_tmpname): removed thread race
	  condition.

	* lib/tmpdir.rb (Dir.mktmpdir): ditto.

Fri Aug 28 20:29:34 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/tempfile.rb (Tempfile#callback): Debug information should be
	  output to stderr, not stdout; pointed out by akira yamada.
	  cf. [ruby-dev:39072]

Fri Aug 28 20:34:24 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: use SafeStringValue instead of
	  Check_SafeStr.

Fri Aug 28 13:30:43 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (do_select): rollback r24680. void struct initializer is
	  invalid.

Fri Aug 28 11:45:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* method.h (rb_method_definition_t): split from rb_method_entry_
	  to deal aliases.  [ruby-dev:39165]

	* proc.c (struct METHOD): contains rb_method_entry_t copy.

Fri Aug 28 10:21:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (iseq_mark): skip outdated cache entries.

	* vm_core.h ({GET,INC}_VM_STATE_VERSION): moved from
	  vm_insnhelper.h.

Fri Aug 28 07:25:25 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (next_i): typo fixed (reached at end -> reached an
	  end).  pointed out by James Edward Gray II at LoneStar RubyConf.

Thu Aug 27 18:31:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_remove_method_id): exported.

	* numeric.c (num_sadded): fix for non-ascii method name.

Thu Aug 27 14:32:31 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_preprocess_dregexp): set encoding as ASCII-8BIT
	  when /n is specified and the embedded string is escaped text.

Thu Aug 27 13:51:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_rand): random integer can be a fixnum for
	  bignum range.  [ruby-dev:39173]

Thu Aug 27 08:16:34 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/strscan/strscan.c (strscan_set_string): set string should not be
	  duped or frozen, because freezing it causes #concat method failure,
	  and unnecessary to dup without freezing.  a patch from Aaron
	  Patterson at [ruby-core:25145].

Thu Aug 27 02:06:11 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* Makefile.in (enc/unicode/name2ctype.kwd):
	  remove rules to generate name2ctype.kwd from
	  UnicodeData.txt and Scripts.txt.
	  if you want to generate, use tool/enc-unicode.rb.

Thu Aug 27 02:00:09 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* unicode.c (PROPERTY_NAME_MAX_SIZE): use MAX_WORD_LENGTH.

Wed Aug 26 23:59:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_rand): refined error message.

	* random.c (random_rand): fixed for edge cases of ranges.
	  [ruby-dev:39166]

Wed Aug 26 21:49:23 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/tempfile.rb: add documents from Hongli Lai's fork.
	  cf [ruby-core:25131].

Wed Aug 26 19:51:13 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/mkconfig.rb (program_transform_name): fix for multiple trans
	  rules for autoconf 2.61 or earlier.

	* tool/rbinstall.rb (program_transform_name): ditto.

Wed Aug 26 19:20:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_rand): unified random_int and random_float.
	  [ruby-dev:39158].  and fixes [ruby-core:24655], [ruby-core:24677],
	  [ruby-core:24679].

Wed Aug 26 18:59:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/test_tempfile.rb: merged from Hongli Lai's fork.
	  cf [ruby-core:25131].

Wed Aug 26 18:49:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#close!): should not undefine finalizer
	  by just unlink.

Wed Aug 26 17:00:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb (program_transform_name): fix for autoconf 2.61
	  or earlier.

Wed Aug 26 14:34:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#close!, Tempfile#path): added side
	  notes from Hongli Lai's fork.

	* lib/tempfile.rb (Tempfile#unlink, Tempfile.callback): do nothing
	  any more once unlinked.

Wed Aug 26 13:48:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#unlink): reverted r23494, since the
	  usage in RubyInline is considered wrong.

Wed Aug 26 12:36:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (collect_local_variables_in_env): skips internal variables.
	  [ruby-core:25125]

Tue Aug 25 23:51:07 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb: added for generate name2ctype.kwd.
	  contributed by Run Paint Run Run [ruby-core:24775]

	* enc/unicode.c (CodeRanges): move definitions to name2ctype.h.

	* enc/unicode/name2ctype.h.blt, enc/unicode/name2ctype.kwd,
	  enc/unicode/name2ctype.src: updated to v5.1.

	* enc/unicode/UnicodeData.txt, enc/unicode/Scripts.txt: added v5.1.

	* Makefile.in: add rule to generate name2ctype.kwd from
	  UnicodeData.txt and Scripts.txt.

Tue Aug 25 22:31:51 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in (MKDIR_P): Set 'mkdir -p' to MKDIR_P
	  when AC_PROG_MKDIR_P doesn't set MKDIR_P.

Tue Aug 25 17:38:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_clone, bigmul1_normal, bigdivrem): trivial
	  optimization.

	* bignum.c (big2dbl): truncates zero digits to get rid of possible
	  underflow.

Tue Aug 25 12:22:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (enc/unicode/name2ctype.h): explicitly ignores the
	  result of diff and turns -e option off, because *BSD make passes
	  it by default.

Tue Aug 25 02:16:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (DLDFLAGS): use linker_flag and changed undefined
	  and multiply_defined behaviors. cf [ruby-core:25086].

Mon Aug 24 21:31:37 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb, test/rss/test_maker_2.0.rb: fix a bug
	  that RSS Maker doesn't accept 'false' as guid's isPermaLink.
	  Reported by Joe Holt. Thanks!!!

Mon Aug 24 18:58:56 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/missing.h (vsnprintf): rollback a part of r24179, because
	  it's meaningless.

Mon Aug 24 16:35:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_delete_safe): deals with packed entries.
	  [ruby-core:25080]

	* st.c (st_cleanup_safe): ditto.  [ruby-core:25081]

Mon Aug 24 13:24:07 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (MAKEDIRS): define.

	* common.mk (capi): using $(MAKEDIRS), so depends on $(PREP).

Mon Aug 24 13:14:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_SIZEOF): set cross_compiling only when
	  universal binary.

Mon Aug 24 12:55:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (enc/unicode/name2ctype.h): use md instead of
	  $(MAKEDIRS).

Sun Aug 23 15:22:45 2009  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (main): "usage" description updated.

Sun Aug 23 15:12:22 2009  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (Dir.mktmpdir): updated to latest.
	  (in_temporary_working_directory): temporary directory name changed.

Sun Aug 23 00:56:13 2009  Tanaka Akira  <akr@fsij.org>

	* thread.c (rb_thread_schedule): don't recur infinitely.
	  (rb_threadptr_execute_interrupts): ditto.
	  [ruby-dev:38060]

Sat Aug 22 15:07:23 2009  Tanaka Akira  <akr@fsij.org>

	* ext/syck/rubyext.c (id_hash_new): new function to create a hash
	  which key is compared by object id.
	  (syck_emitter_reset): use id_hash_new for bonus->data.

	* lib/yaml.rb (YAML.quick_emit): give the object itself to emitter.
	  don't use object_id and hash.

Sat Aug 22 13:05:22 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* Makefile.in: use CP and MV macros.

Sat Aug 22 01:29:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (rm_f, rm_rf): pass the last hash through if exists.
	  [ruby-dev:39153]

Sat Aug 22 00:48:08 2009  Tanaka Akira  <akr@fsij.org>

	* enumerator.c (ary2sv): add dup argument.
	  (enumerator_next): call ary2sv with dup=0.
	  (enumerator_peek): call ary2sv with dup=1 to return duplicated array.
	  (enumerator_peek_values_m): new function to return duplicated array.
	  (Init_Enumerator): use enumerator_peek_values_m as
	  Enumerator#peek_value.

Sat Aug 22 00:03:19 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (rb_check_deadlock): decrease number of sleepers before
	  deadlock detection because the deadlock exception makes main thread
	  run.  [ruby-dev:39142]

Fri Aug 21 22:34:58 2009  Tanaka Akira  <akr@fsij.org>

	* enumerator.c (get_next_values): extracted from
	  enumerator_next_values.
	  (enumerator_next_values): use get_next_values.
	  (enumerator_peek_values): ditto.

Fri Aug 21 17:01:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/unicode/name2ctype.h: split from enc/unicode.c and made a
	  perfect hash.

Fri Aug 21 15:13:08 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/io.h, io.c (FMODE_SETENC_BY_BOM):
	  renamed from FMODE_STRIP_BOM.

Thu Aug 20 01:24:55 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_fmode_modestr): change modestr syntax for BOM
	  to "BOM|UTF-*". [ruby-dev:39106]

	* io.c (parse_mode_enc): ditto.

Fri Aug 21 15:01:35 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_readline): use rb_prep_terminal
	  only on Windows.

Fri Aug 21 07:25:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/gemdirs.rb: split from lib/rdoc/ri/paths.rb to ge
	  rid of loading rubygems and searching all gems always.

Fri Aug 21 07:14:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_PROGRAM_VERSION, RUBY_RELEASE_DATE): extracts
	  from version.h for cross-compiling.

	* template/fake.rb.in (RUBY_VERSION, RUBY_DESCRIPTION): use above.

Fri Aug 21 00:08:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths): Gem::Enable has been obsolete.

Thu Aug 20 23:56:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_sysopen): moved sysopen_struct from rb_sysopen_internal.

Thu Aug 20 23:39:51 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (reduce_nodes_gen): preserve NODE_FL_NEWLINE flag during
	  node reducing.  [ruby-core:24463]

Thu Aug 20 14:39:47 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_get): add rl_prep_terminal(1).
	  incited by jitte [ruby-list:43546]

Thu Aug 20 12:09:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (ivar2_hash_type): disabled for now.

Thu Aug 20 08:39:50 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (rb_thread_terminate_all): do not ignore interrupt when
	  reaping threads on termination.  [ruby-dev:39107]

Thu Aug 20 02:32:08 2009  Tanaka Akira  <akr@fsij.org>

	* enumerator.c (next_init): don't clear feedvalue.

Thu Aug 20 01:28:42 2009  Tanaka Akira  <akr@fsij.org>

	* enumerator.c: implement Enumerator#{next_values,peek_values,feed}
	  and StopIteration#result.  [ruby-dev:39109]
	  (struct enumerator): replace no_next by stop_exc.
	  new field feedvalue.
	  (enumerator_mark): mark feedvalue and stop_exc.
	  (enumerator_init): initialize feedvalue and stop_exc.
	  (enumerator_init_copy): initialize feedvalue.
	  (next_ii): send yield arguments as an array.  return feedvalue.
	  (next_i): generate StopIteration exception here.  set result.
	  (next_init): initialize feedvalue.
	  (enumerator_next_values): new method Enumerator#next_values.
	  (ary2sv): new function.
	  (enumerator_peek_values): new method Enumerator#peek_values.
	  (enumerator_feed): new method Enumerator#feed.
	  (yielder_yield): return the yield value.
	  (generator_each): return the iterator value.
	  (stop_result): new method StopIteration#result.

Thu Aug 20 01:06:48 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (DEFINE_STRUCT_DIRENT): use union to allocate sufficient
	  memory space for Solaris.  a patch from Naohisa GOTO
	  <ngoto at gen-info.osaka-u.ac.jp> in [ruby-dev:39132].
	  [ruby-dev:39062]

	* configure.in (SIZEOF_STRUCT_DIRENT_TOO_SMALL): Solaris dirent
	  check.

Wed Aug 19 11:32:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/unicode.c (CodeRanges): initialized statically.

Wed Aug 19 02:54:01 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_settracefunc.rb (test_return, test_return2): add two
	  tests for [ruby-dev:38701] and [ruby-core:24463].

Wed Aug 19 01:08:34 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (NODE_RETURN): fire return event at explicit return.
	  [ruby-dev:38701]

Tue Aug 18 21:00:26 2009  Tanaka Akira  <akr@fsij.org>

	* enumerator.c (enumerator_peek): new method Enumerator#peek.
	  (enumerator_next): don't rewind at end.
	  [ruby-dev:38932]

Tue Aug 18 13:46:14 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* touch test/rdoc/empty.dat to run test_rdoc_parser.rb

Tue Aug 18 11:37:24 2009  wanabe  <s.wanabe@gmail.com>

	* vm_insnhelper.c (vm_call_cfunc): ensure hook c-return.
	  [Bug #1588]

	* test/ruby/test_settracefunc.rb (TestSetTraceFunc#test_raise):
	  follow above.

Tue Aug 18 01:57:00 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_step): treat symbols specially so that iterating
	  over symbols should work like strings.  [ruby-core:24780]

	* range.c (range_each): ditto.

Tue Aug 18 01:21:31 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_each): should honor to_str conversion.

Mon Aug 17 23:45:40 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta.rb: removed require 'date'.  added to_c.

Mon Aug 17 14:35:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lex_get_str, lex_io_gets, rb_parser_compile_string):
	  must be ascii compatible.

Mon Aug 17 10:37:41 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (add_code_range_to_buf0): added with checkdup argument.

	* regparse.c (add_code_range_to_buf): use above.

	* regparse.c (add_code_range0): added with checkdup argument.

	* regparse.c (add_code_range): use above.

	* regparse.c (i_apply_case_fold): don't warn if the duplicate is
	  caused by case folding.

Mon Aug 17 08:31:56 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta.rb: merged from date4.  [experimental]

	* lib/date/delta/parser.*: ditto.

	* lib/date.rb: followed the above changes.

Mon Aug 17 08:19:03 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (strptime): removed \v; since \s includes \v.

Mon Aug 17 08:14:26 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_rationalize) added.  [experimental]

	* rational.c ({nurat,nilclass,integer,float}_rationalize) ditto.

Mon Aug 17 08:11:53 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb: use num#i.

Mon Aug 17 07:59:00 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c (flo_pow,fix_pow): may return complex number.

	* bignum.c (rb_big_pow): ditto.

Mon Aug 17 07:16:10 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (num_imaginary): num#i to return imaginary counterpart
	  of the given numeric.

	* complex.c (Init_Complex): undef #i for complex numbers.

Mon Aug 17 00:17:33 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/complex.rb, lib/rational.rb: added warning messages.

Sun Aug 16 23:58:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (yylex): should dispatch scan-event even when follows
	  just after delayed-token.  [ruby-dev:37855] [Bug #1071]

Sun Aug 16 22:20:16 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: reverted.

Sun Aug 16 21:31:21 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/date/format.rb: suppressed a warning.

	* lib/irb/ruby-lex.rb: ditto.

Sun Aug 16 15:25:26 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/csv.rb: Change magic comment to US-ASCII in order to
	  make literals as US-ASCII.

Sun Aug 16 10:45:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regparse.c (parse_char_class, parse_exp, parse_branch),
	  (parse_subexp): fixed memory leak.  a patch from Ralf Junker
	  <ralfjunker AT gmx.de> at [ruby-core:24921].

Sun Aug 16 10:38:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace_each, vm_backtrace_push),
	  vm_eval.c (print_backtrace), vm_dump.c (bugreport_backtrace):
	  rb_backtrace_iter_func now takes VALUE as file and method names.

Sun Aug 16 03:06:59 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (opt_eq_func): fix optimization bug.  This issue
	  was found out and debugged with Takuto Hayashi at Security and
	  Programming camp 2009.

Sun Aug 16 01:10:00 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (add_ctype_to_cc_by_range): fix the first
	  character bigger than sb_out was dropped.

	* test/ruby/test_regexp.rb (TestRegexp#test_posix_bracket):
	  add tests for above.

Sun Aug 16 00:30:33 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/oniguruma.h
	  (ONIGENC_CTYPE_SPECIAL_MASK): added.
	  (ONIGENC_CTYPE_D): ditto.
	  (ONIGENC_CTYPE_S): ditto.
	  (ONIGENC_CTYPE_W): ditto.

	* regparse.c: \d, \s and \w are now non Unicode class.
	  [ruby-dev:39026]
	  (fetch_token_in_cc): use ONIGENC_CTYPE_[DSW] for \d/\s/\w.
	  (fetch_token): ditto.
	  (add_ctype_to_cc): add routines for ONIGENC_CTYPE_[DSW].
	  (parse_exp): ditto.

	* test/ruby/test_regexp.rb (TestRegexp#test_char_class):
	  add tests for above.

Sat Aug 15 10:39:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (fname, string_dvar, sym, dsym, f_arglist): removed
	  duplications.

Fri Aug 14 20:03:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_check_safe_str): deprecated.

	* ext/openssl/ossl_x509store.c (ossl_x509store_add_{file,path}):
	  replaced deprecated function.

Fri Aug 14 17:59:12 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_preprocess_dregexp): change Exception class to
	  RegexpError.

	* test/ruby/test_m17n.rb (test_regexp_usascii): follow above.

	* test/ruby/test_m17n.rb (test_regexp_embed): ditto.

Fri Aug 14 17:17:42 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/Makefile.in (MKDIRS): revert r24525.

Fri Aug 14 16:28:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/digest/lib/digest/hmac.rb (Digest::HMAC#initialize): faster
	  code.

Fri Aug 14 14:31:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rubyhdrdir): fixed typo.  [ruby-dev:39079]

Fri Aug 14 00:29:22 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* doc/ChangeLog-1.8.0: add forgotten entry contributed by
	  TAKAHASHI Kaoru.  [ruby-dev:39065]

Fri Aug 14 00:19:49 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator#method_missing): __FILE__ may contain
	  multi-byte characters.  a patch from Kenta Murata in [ruby-dev:39066].

Thu Aug 13 21:01:03 2009  wanabe  <s.wanabe@gmail.com>

	* vm.c (vm_exec): returning from lambda runs ensure section.
	  [Bug #1729]

Thu Aug 13 18:40:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_SIZEOF): set cross_compiling to yes
	  only when AC_COMPUTE_INT, and inverted the arguments.

Thu Aug 13 18:22:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_SIZEOF): use AC_COMPUTE_INT instead of
	  _AC_COMPUTE_INT_COMPILE with cross compiling, since its arguments
	  have been changed at autoconf 2.64.

Thu Aug 13 16:31:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (opt_case_dispatch): suppressed a warning.

	* vm_insnhelper.c (opt_case_dispatch_i): ditto.

Thu Aug 13 16:20:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, Makefile.in (MAKEDIRS): used MKDIR_P instead of
	  as_mkdir_p.  [ruby-dev:39063]

Thu Aug 13 15:37:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regenc.c (onigenc_strlen_null, onigenc_str_bytelen_null): fixed
	  infinite loop for wide encodings.  reported by Ralf Junker a
	  [ruby-core:24892].  [ruby-core:24904]

Wed Aug 12 21:07:46 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: if ipv6 is enabled, the version of Windows
	  must be XP or later.
	  [ruby-core:24601]

Wed Aug 12 15:59:29 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (yes-test-knownbug): use RUNRUBY instead of MINIRUBY.

Wed Aug 12 15:52:04 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* class.c (rb_define_module_id_under): fix the name.

	* class.c (rb_define_module_under): fix for previous changes.

Wed Aug 12 15:32:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_define_class_id_under, rb_define_module_id_under):
	  new functions to define a nested class/module with non-ascii
	  name.

	* struct.c (make_struct): use name with encoding.

	* struct.c (inspect_struct): ditto.  [ruby-core:24849]

Wed Aug 12 Wed Aug 12 14:54:34 2009  Koichi Sasada  <ko1@atdot.net>

	* insns.def, vm.c, vm_insnhelper.c, vm_insnhelper.h: check
	  definition of (classes)#=== for case/when optimization.
	  Fix Bug #1376 [ruby-core:23190].

	* string.c (Init_String), bignum.c (Init_Bignum),
	  numeric.c (Init_Numeric): define String#===, Symbol#===,
	  Bignum#===, Fixnum#===, Float#=== as same as (classes)#==.

Wed Aug 12 14:14:42 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (readdir_internal): free old temporary filename.
	  [ruby-core:24820]

Wed Aug 12 12:59:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_new_frozen): must not change encoding of frozen
	  shared string.  [ruby-dev:39068]

Wed Aug 12 11:51:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_broken_crypt): needs more checks.

Wed Aug 12 07:41:31 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): If a string is empty and
	  other's encoding is US-ASCII, returns the empty string's encoding.
	  [ruby-list:46274]

Wed Aug 12 07:38:12 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (is_data_encoding): fix condition.

	* encoding.c (enc_capable): ditto.

Tue Aug 11 23:12:31 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (complete_frags): Monday must be suitable for %W's
	  default day.

Tue Aug 11 21:42:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (num_divmod): fixed rdoc.  [ruby-core:24862]

Mon Aug 10 21:45:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_path2class): no deprecation.

Mon Aug 10 10:57:59 2009  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c: reject unused longlife gc. longlife gc target is longlife
	  NODE by method table and vm inline cache. but, fixed it at
	  r24085, r24128. so I rejected longlife gc.

	* debug.c: ditto.

	* include/ruby/intern.h: ditto.

	* include/ruby/ruby.h: ditto.

	* iseq.c: ditto.

	* node.h: ditto.

	* vm_insnhelper.c: ditto.

	* vm_insnhelper.h: ditto.

Mon Aug 10 06:55:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (class2path, w_unique, w_extended, w_class, w_uclass):
	  deal with non-ascii class path.  [ruby-core:24790]

	* marshal.c (r_unique, path2class, path2module, obj_alloc_by_path),
	  (r_object0): ditto.

	* variable.c (rb_path_to_class): new encoding-aware function to
	  get a class from its name.

Sun Aug  9 21:14:03 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb (search_tclConfig): last change isn't enough.
	  fixed it.

Sun Aug  9 16:36:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ruby.imp): excluded prelude.o to get rid of circular
	  dependency.  [ruby-dev:39052]

Sun Aug  9 14:49:24 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (rb_big_cmp, bigsub, big_real_len, bigmul1_normal,
	  bigmul1_balance, big_split): remove BDIGITS() inside of the loops.
	  same as r24444.

Sat Aug  8 17:03:21 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_ascii_compatible_p): added. [ruby-core:24793]
	  (Init_Encoding): New API Encoding#ascii_compatible?.

Sun Aug  9 07:25:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/eventids2.c (token_to_eventid): added
	  keyword_do_LAMBDA.  [ruby-dev:39049]

Sun Aug  9 02:07:41 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/compile_prelude.rb: fixes a regexp pattern for require.
	  It had matched 'require("foo"('.

Sat Aug  8 11:42:44 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigzero_p): removing BDIGITS() inside of the
	  loop. inspired by Masahiro Kanai's blog entry
	  <http://d.hatena.ne.jp/CanI/20090807/1249657492>.

Sat Aug  8 06:18:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_symbol r_symlink, r_symbol, r_object0): fix for
	  non-ascii symbols.  loading such symbols can cause segfaults in
	  older versions.  [ruby-core:24788]

Fri Aug  7 03:25:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.c (error_print): removed an extra argument.

Fri Aug  7 03:22:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_exc_raise, rb_exc_fatal): nil is used to reraise.

Fri Aug  7 01:49:41 2009  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/sha2/sha2.c: The ULL suffix is not supported by
	  pre-C99 compilers, so resurrect the ULL() macro to regain
	  portability. [ruby-dev:39032]

Fri Aug  7 01:35:26 2009  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/*/extconf.rb: inttypes.h and unistd.h need not be
	  checked here. [ruby-dev:39032]

Fri Aug  7 01:04:17 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb (search_tclConfig): fix logic bug.

Thu Aug  6 21:18:15 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/digest/sha2/lib/sha2.rb: should require sha2.so.

Thu Aug  6 21:11:40 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/digest/sha2/sha2.c (*_Final): typos.

Thu Aug  6 19:46:56 2009  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/sha2/sha2.h (BYTE_ORDER): Define BYTE_ORDER as
	  necessary. [ruby-dev:39029]

Thu Aug  6 16:36:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (valid_encoding_name_p): rejects too long encoding
	  names.

	* encoding.c (encoding_data_type): typed data.

	* encoding.c (enc_capable, rb_enc_get_index): Symbol is encoding
	  capable.

	* encoding.c (rb_enc_associate_index): cannot set encoding on
	  special constants.

Thu Aug  6 15:44:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_method_entry_eq): deals with optimized method
	  properly.  [ruby-core:24789]

Thu Aug  6 13:30:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf): was turned into a class, because
	  MiniUnit doesn't complain even if a testcase has no tests.

Thu Aug  6 13:00:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (check_sizeof): added optional compiler option
	  argument.  [ruby-core:24785]

	* lib/mkmf.rb (create_makefile): suppressed shadowing outer local
	  variable warnings.

Thu Aug  6 12:05:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/testcase.rb (Test::Unit): removes silly TestCase
	  class.

Thu Aug  6 01:37:20 2009  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/sha2/sha2.[ch]: Update to 1.0 RELEASE which fixes an
	  off-by-one bug in SHA-256 hashing.  Reduce differences from
	  the original while at it. [Bug #1799]

Thu Aug  6 00:09:56 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb (IPAddr#hash): Take account of netmask; submitted
	  by Nobuhiro IMAI in [ruby-dev:39011]

Wed Aug  5 19:19:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): assumes -x flag if no "ruby" is in
	  the shebang line.  [ruby-dev:39015]

Wed Aug  5 19:11:01 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (rb_stdio_set_default_encoding): declared.

Wed Aug  5 18:46:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c (ruby_dummy_gdb_enums): made public.  [ruby-dev:39001]

Wed Aug  5 13:49:09 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_upto): generate numerical sequence when
	  characters in both edges are all digits.  [ruby-talk:343186]

Wed Aug  5 12:54:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_exc_raise, rb_exc_fatal): require exception object.
	  [ruby-core:24767]

Wed Aug  5 12:39:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_longjmp): reset raised flag before fatal error.

Wed Aug  5 10:20:39 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_preprocess_dregexp): add options to arguments.

	* re.c (rb_reg_new_ary): follow above.

	* re.c (rb_reg_preprocess_dregexp): change error message when
	  /.../n has a non escaped non ASCII character in non ASCII-8BIT
	  script. [ruby-dev:38524]

Wed Aug  5 03:28:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit.setup_argv): expands paths before
	  requiring.  [ruby-dev:39012]

Wed Aug  5 01:38:27 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/pp.rb (guard_inspect_key): untrust internal hash to prevent
	  unexpected SecurityError.

	* test/ruby/test_object.rb: add a test for [ruby-dev:38982].

Wed Aug  5 00:33:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser/c.rb: fixed a small error in the documentation.
	  [ruby-core:24744]

Tue Aug  4 22:10:34 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (has_redirection): need to execute shell if commandline
	  includes newline.  cf. [ruby-core:24560]

Tue Aug  4 15:06:58 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb (IPAddr#{eql?,hash}): Add IPAddr#{eql?,hash} so
	  that an IPAddr object can be used as a hash key, a set element,
	  etc.; suggested by Nick Brown <nick@nick-brown.com>.

Tue Aug  4 13:07:10 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/oniguruma.h (ONIG_SYN_WARN_CC_DUP): defined.
	* regparse.h (ScanEnv): add warnings_flag.
	* regparse.c (CC_DUP_WARN): defined for warn duplicated characters in
	  character class of regexp. [ruby-core:24593]
	  (add_code_range_to_buf): add CC_DUP_WARN.
	  (next_state_val): add CC_DUP_WARN.
	  (OnigSyntaxRuby): add ONIG_SYN_WARN_CC_DUP.
	  (SET_ALL_MULTI_BYTE_RANGE): add env to arguments.
	  (add_code_range): ditto.
	  (add_code_range_to_buf): ditto.
	  (not_code_range_buf): ditto.
	  (or_code_range_buf): ditto.
	  (and_code_range1): ditto.
	  (and_code_range_buf): ditto.
	  (and_cclass): ditto.
	  (or_cclass): ditto.
	  (add_ctype_to_cc_by_range): ditto.
	  (add_ctype_to_cc): ditto.
	  (parse_char_class): ditto.

Tue Aug  4 12:40:45 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/encdb.c (ENC_SET_BASE): fix typo.
	  patch by ujihisa [ruby-dev:39004]

Tue Aug  4 11:57:39 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_eql, range_eq): fixed equality to work for
	  subclasses of Range.  a patch from Marc-Andre Lafortune.
	   [ruby-core:22190]

	* test/ruby/test_range.rb: add assertions for above.

Tue Aug  4 09:41:11 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/big5.c (EncLen_Big5): back to original Big5 table.
	  (EncLen_Big5_HKSCS): for Big5-HKSCS.
	  (trans): add the lead byte table for Big5-HKSCS.
	  (big5_mbc_enc_len): abstract function for Big5 series.
	  (big5_mbc_enc_len): for Big5.
	  (big5_hkscs_mbc_enc_len): for Big5-HKSCS.
	  (BIG5_HKSCS_P): added.
	  (BIG5_ISMB_FIRST): add routine for Big5-HKSCS.
	  (big5_hkscs): add for Big5-HKSCS.

Tue Aug  4 09:33:54 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_set_base): Add for setting base encoding
	  with their names. this is internal function.

	* template/encdb.h.tmpl: specify ENC_SET_BASE for second encodings in
	  each encoding files.

	* enc/encdb.c (rb_enc_set_base): add a declaration.
	  (ENC_SET_BASE): ditto.

Tue Aug  4 06:30:01 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_replace): should copy compare_by_identity status as well.
	  [ruby-core:24728]

Tue Aug  4 05:43:03 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (recursive_push): need to set UNTRUST.  [ruby-dev:38997]

Tue Aug  4 03:56:51 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tcltklib.c: fix trouble on old-style C function
	  declarations [ruby-core:22871].

	* ext/tk/lib/tcltklib.c: (ruby_1_8) fix warning about RUBY_RELEASE_DATE

	* ext/tk/lib/tk/multi-tk.rb: kill zombie threads.

	* ext/tk/lib/tk/fontchooser.rb: fix typo and support OptionObj.

	* ext/tk/lib/tk/{canvas.rb,virtevent.rb,image.rb,timer.rb}:
	  don't create unnecessary array.

Mon Aug  3 22:19:24 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval.c (rb_mod_include): fix document.  [ruby-core:24675]

Mon Aug  3 18:25:08 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/svr.rb: obsolete TCPserver renamed.  [ruby-core:24712]

	* sample/tsvr.rb: ditto.

	* sample/dualstack-httpd.rb: ditto.

Mon Aug  3 18:12:54 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (recursive_push): untrust internal hash to prevent
	  unexpected SecurityError.  a patch from Kazuhiro NISHIYAMA.
	  Fix: #1864  [ruby-dev:38982]

Mon Aug  3 17:06:05 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/README: updated.  a patch from Daniel Bovensiepen.
	  [ruby-core:24693]

Mon Aug  3 16:28:09 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_connect): return value was broken when some
	  error occurred.
	  [ruby-core:24234]

Mon Aug  3 15:56:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (permute0): use chars for boolean array.

	* array.c (rb_ary_{permutation,combination}): disallow reentrance
	  with continuation since work-buffers cannot restore.

	* array.c (rb_ary_{permutation,combination,product}): must not use
	  ary_discard on strings.

Mon Aug  3 06:43:25 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_hash): normalize -0.0 to 0.0.  [ruby-core:24577]

Mon Aug  3 00:32:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rb_random_int): arguments have to be converted to
	  integer.  [ruby-core:24679]

Sun Aug  2 21:04:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (literal_concat0): tail can be nil.  [ruby-dev:38980]

Sun Aug  2 20:09:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_combination, rb_ary_product): prevent from GC.

Sun Aug  2 16:53:19 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rand.rb: add tests for Random#float's rejection
	  against Infinity and NaN.

Sun Aug  2 14:20:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rand_int): prevent from GC.

Sat Aug  1 19:23:27 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_trans): change condition of singlebyte
	  optimization.

Sat Aug  1 18:50:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_float): rejects Infinity and NaN.
	  [ruby-core:24651]

Sat Aug  1 18:34:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): suppressed warnings.
	  cf: [ruby-dev:38975]

Sat Aug  1 05:18:36 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_trans): can't use singlebyte optimization when
	  the replacement is multibyte. [ruby-core:24612]

Fri Jul 31 18:01:34 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/securerandom.rb (SecureRandom.random_bytes): return string should
	  be ASCII-8BIT.  [ruby-core:24640]

Fri Jul 31 16:28:33 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_stdio_set_default_encoding): added.

	* ruby.c (process_options): call rb_stdio_set_default_encoding
	  after setting default internal and external.

Fri Jul 31 15:06:33 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/compile_prelude.rb: too long string literal causes compile error
	  on some platforms.

Fri Jul 31 13:15:27 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* transcode.c (str_encode_bang): C99ism.

Fri Jul 31 11:48:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): used more appropriate construct.

Fri Jul 31 10:54:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (literal_concat_gen): reduced unnecessary node at string
	  literal concatenation with empty head dstr.  [ruby-dev:38968]

Fri Jul 31 02:57:39 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (literal_concat_gen): NODE_DSTR was incorrectly handled as
	  NODE_STR.  [ruby-dev:38968]

	* bootstraptest/test_syntax.rb: add a test for above.

Fri Jul 31 00:55:48 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_module.rb (test_ancestors, test_included_modules):
	  ignore rake mixins.

Fri Jul 31 00:30:54 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_call_cfunc): let set_trace_func use called_id
	  instead of original_id.

Thu Jul 30 23:04:32 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* gem_prelude.rb (Gem.path): uses Gem.default_path as a default value
	  so that ruby finds gems in ~/.gem/.
	  (Gem.user_home): reduced version of lib/rubygems.rb's.
	  Gem.default_path needs it.

Thu Jul 30 22:28:04 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/compile_prelude.rb: replaces "require" with in-place evaluation
	  so that copy & paste for lib/rubygems/default.rb is not necessary.

	* gem_prelude.rb: removes copied codes from lib/rubygems/defaults.rb.
	  uses require instead.

	* common.mk (prelude.c): adds dependency for lib/rubygems/defaults.rb.

Thu Jul 30 21:56:18 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rand.rb: add tests for Random class.

Thu Jul 30 21:48:56 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* random.c (init_genrand): ensure invariant of mt->next and mt->left.
	  mt->next should always equal mt->state + N + 1 - mt->left.
	  In fact, 'r = Random.new(0); r == r.dup' has returned false.

Thu Jul 30 21:43:41 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* random.c (random_bytes): use NUM2LONG instead of FIX2LONG because
	  Random#bytes may receive bignum.

Thu Jul 30 21:39:42 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_compile_each): fix stack consistency error.
	  [ruby-core:24611]

	* bootstraptest/test_method.rb: add tests for above.

Thu Jul 30 18:39:39 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c: added check for frozen string for encode! (see Bug #1836)

	* test/ruby/test_transcode.rb: added tests for the above

Thu Jul 30 16:45:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defineclass): preserve encoding of class/module
	  names.  [ruby-core:24600]

	* variable.c (rb_set_class_path_string): set class path with a
	  string value.

Thu Jul 30 16:12:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (Init_var_tables): initializes __classid__ ID.

	* variable.c: use st_data_t for st functions.

Thu Jul 29 14:25:14 2009  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/util.rb (CGI::unescape): support encoding option.

	* lib/cgi/cookie.rb (CGI::Cookie.parse): fix for the encoded value.

Wed Jul 29 08:08:07 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (regexp): regexp literal at the top of dstr is still needed
	  even if it is empty.

Wed Jul 29 03:36:24 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/json/lib/json/common.rb (JSON#recurse_proc): remove
	  unnecessary private specifier.  [ruby-dev:38929]

Wed Jul 29 03:34:46 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h, vm_insnhelper.c (vm_call_method): revive
	  VM_CALL_OPT_SEND_BIT and use it to recognize "send" method.

Wed Jul 29 03:11:59 2009  Koichi Sasada  <ko1@atdot.net>

	* proc.c (rb_method_entry_arity): support not_implemented method.
	  (I have no idea to test it)

Tue Jul 28 19:36:26 2009  Koichi Sasada  <ko1@atdot.net>

	* proc.c (rb_method_entry_arity): support optimized method (send).

	* test/ruby/test_method.rb: add a test for above.

Tue Jul 28 04:34:05 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/extconf.rb: bug fix and ignore invalid Tcl/Tk libraries.

	* ext/tk/lib/config_list.in: bug fix and add a new option.

	* ext/tk/lib/README.tcltklib: update for a new option.

Mon Jul 27 19:03:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_*str_new_cstr, rb_str_buf_new_cstr),
	  (rb_str_buf_cat2, rb_str_cat2, rb_exc_new2): suppress warnings.

Mon Jul 27 10:24:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser.rb (RDoc::Parser.binary?): fix for empty files.
	  [ruby-dev:38848]

Mon Jul 27 06:51:41 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_eof): should call next_argv() before testing.
	  [ruby-core:24561]

Sun Jul 26 19:17:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_eof): go to the next file if called after ARGF.close
	  or ARGF.skip.  a patch from Mike Kasick at [ruby-core:24561].

Sun Jul 26 18:30:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): __send__ can call protected
	  methods.  [ruby-core:24500]

Sun Jul 26 01:09:14 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* ext/bigdecimal.c: moved BASE_FIG definition before it is used
	  first time.

	* include/ruby/defines.h [__SYMBIAN32__]: defined TRUE and FALSE to match
	  changes in bignum.c and array.c.

Sat Jul 25 17:49:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_eof): should not have reached EOF before trying to
	  read.  based on a patch by Heesob Park <phasis AT gmail.com> in
	  [ruby-core:24559].  [ruby-core:24557]

Sat Jul 25 13:44:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c (nucomp_hash), rational.c (nurat_hash): not to use
	  hash value of class so that equality against subclasses can
	  work.  [ruby-dev:38850]

Sat Jul 25 01:05:59 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/big5.c: Fix EncLen_BIG5 for Big5-HKSCS. see [ruby-core:24390]

Fri Jul 24 19:19:19 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/big5.trans, big5-hkscs-tbl.rb:
	  new Chinese BIG5-HKSCS transcoding (with Tatsuya Mizuno)
	  see [ruby-core:24390]

	* test/ruby/test_transcode.rb: added tests for the above
	  (with Tatsuya Mizuno)

	* enc/big5.c: Added BIG5-HKSCS as a replicate encoding of BIG5
	  (short term solution, needs more work; with Tatsuya Mizuno)

	* tool/transcode-tblgen.rb: made 'pat' directly accessible in
	  class StrSet

Fri Jul 24 18:03:01 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (idle): leaves IDLE in a ensure clause.  a patch
	  from Eric Hodel.

	* test/net/imap/test_imap.rb (setup, teardown): turn on
	  Socket.do_not_reverse_lookup in tests.

Fri Jul 24 00:13:41 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (resp_text_code): accepts response codes without
	  text.  [ruby-core:24194]

	* lib/net/imap.rb (idle, idle_done): new methods for the IMAP4 IDLE
	  command (RFC 2177).  Thanks, Eric Hodel.

	* lib/net/imap.rb (format_date, format_datetime): new method to
	  format IMAP-style date/datetime. Thanks, Eric Hodel.

Thu Jul 23 17:31:02 2009  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/ruby-lex.rb: make irb be able to parse
	  string_dvar. [ruby-core: 24051]

Thu Jul 23 17:26:51 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: should not create "config_list" in a $srcdir.

Thu Jul 23 14:35:02 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_{open,wopen}): fixed typos. these conditions
	  mean to call runtime's open() if textmode.

Thu Jul 23 08:53:24 2009  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup/simple_markup/: Remove useless directory.
	  [Bug #1343]

Thu Jul 23 08:52:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_{state,left}): internal/debug use.

Wed Jul 22 19:29:26 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_module.rb (TestModule#test_alias): warning
	  message updated.

Thu Jul 23 00:39:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (class.o): depends on vm_core.h.

Thu Jul 23 00:10:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (init_leap_second_info): checks the result of gmtime to
	  suppress warnings.

Wed Jul 22 22:23:24 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_core.h (struct rb_iseq_t): add a new field line_no.  This field
	  represents line number from which the original code of the iseq
	  starts.  [ruby-dev:38698]

	* iseq.c, compile.c: ditto.

	* parse.y: line number hack (for Proc#source_location) is no longer
	  needed.

	* test/ruby/test_settracefunc.rb: line number of set_trace_func is now
	  compatible with 1.8's.

Wed Jul 22 22:16:48 2009  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* method.h: Commas at end of enum list not allowed as of C89

	* vm_method.c (rb_add_method): avoid C++ comment

	* vm_insnhelper.c (vm_call_cfunc): ditto.

Wed Jul 22 20:42:52 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: define IPPROTO_IPV6 macro for recent Windows
	  SDK.

Wed Jul 22 19:32:10 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/mkconstants.rb: define IPV6_* constants only when INET6
	  is defined.

Wed Jul 22 19:23:04 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: ipv6 support is disabled by default on mswin.

Wed Jul 22 17:41:08 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/ipsocket.c (init_inetsock_internal): drop IPv6 addresses
	  if INET6 is not defined.

Wed Jul 22 17:29:59 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: enable ipv6 support for win32.

Wed Jul 22 16:38:39 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* hash.c (Hash::[]): rdoc. patch by Marc-Andre Lafortune.
	  #1385.

Wed Jul 22 10:00:53 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (WSAMSG): get rid of compile error on VC9 and mingw.

Wed Jul 22 06:35:56 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_enum.rb (TestEnumerable#each): recursive join now
	  raises ArgumentError.

Wed Jul 22 02:33:57 2009  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb.rb: forget svn commit.

Wed Jul 22 01:20:54 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bootstraptest/test_io.rb: block write may block for long time.

Wed Jul 22 00:34:39 2009  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb.rb, lib/irb/init.rb, lib/irb/ext/save-history.rb: add
	  IRB::irb_at_exit. no use finalizer saving history. [ruby-dev-38563]

Tue Jul 21 23:47:38 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* random.c (rand_init): array length of random seed was broken, which
	  causes memory error with srand(2**1000000-1).

	* test/ruby/test_rand.c: test for above.

Tue Jul 21 21:37:19 2009  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/cmd/help.rb: fixed irb's "help" command. [ruby-core:22310].

	* lib/tracer.rb: no show lines unknown line number. [ruby-core:22096],
	  no trace display  c-call and c-return as default.

Tue Jul 21 16:24:41 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (vtdate2rbtime): VT_DATE variant object
	  is converted to Time object now.

	* test/win32ole/test_win32ole_variant.rb (test_s_new_with_nil,
	  test_conversion_time2date, test_conversion_str2date,
	  test_conversion_vt_date, test_set_value): ditto.

	* ext/win32ole/win32ole.c (rbtime2vtdate): refactoring.

Tue Jul 21 16:07:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tracer.rb: toplevel caller exists now.  [ruby-core:24454]

Tue Jul 21 13:36:20 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.[ch] (recvmsg, sendmsg): new functions to support recvmsg/
	  sendmsg like UNIX. these functions are experimental and not tested
	  well. bug reports are welcome.

Tue Jul 21 13:35:21 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (TEST_RUNNABLE): follow r24209.

Tue Jul 21 12:45:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_gc_enable, rb_gc_disable): should return Qtrue/Qfalse.

Tue Jul 21 12:38:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_generic_ivar_memsize): should not remove generic
	  instance variable table.

Mon Jul 20 20:35:55 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_f_open): add rdoc about specifying ext_enc as *-bom.

Mon Jul 20 19:00:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (compile_dstr_fragments): reduced needless literal.

	* parse.y (xstring, regexp, dsym, literal_concat, evstr2dstr):
	  literal at the top of dstr is no longer needed if it is empty,
	  since concatstrings and toregexp always create new strings.

Mon Jul 20 12:51:39 2009  wanabe  <s.wanabe@gmail.com>

	* lib/matrix.rb (Matrix#rank): revert a part of r20859 to avoid
	  infinite loop.  [Bug #1020]

Mon Jul 20 11:12:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, Makefile.in (TEST_RUNNABLE): tests are no
	  runnable if cross-compiling.

	* common.mk (btest*, test*): ditto.

Mon Jul 20 10:55:18 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Addrinfo#family_addrinfo): fix a typo in
	  error message.  patch by Nobuhiro IMAI.  [ruby-dev:38828]

Sun Jul 19 22:22:54 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (float_to_r): an improvement.

Sun Jul 19 20:41:24 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (make_patterns): do not use \d.

	* rational.c (make_patterns): ditto.

Sun Jul 19 17:32:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_read): should taint the result.  [ruby-dev:38826]

Sun Jul 19 11:00:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (me_opts): fixed optimized method aliasing.
	  [ruby-dev:38824]

Sun Jul 19 10:54:56 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.accept_loop): rescue
	  IO::WaitReadable instead of Errno::EWOULDBLOCK.
	  (Socket.udp_server_loop_on): ditto.

Sat Jul 18 23:44:59 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (reg_enc_error): use rb_enc_get to get the encoding of
	  a Regexp object. REGEXP(re)->ptr->enc is the encoding of the
	  regexp engine for patterns and target strings.
	  [ruby-core:23208]

Sat Jul 18 17:43:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_hash_cmp): got rid of overflow.

Sat Jul 18 16:03:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/defines.h (TRUE, FALSE): for internal use.

Sat Jul 18 11:39:49 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* random.c: workaround for VC++ 6.0.

Sat Jul 18 09:16:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rb_random_{int32,real,bytes,int}): added functions for
	  extension libraries.

Sat Jul 18 09:07:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (fill_random_seed): use cryptographic service on Windows.

Sat Jul 18 07:56:00 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fail to create a widget object for an unknown
	  widget path.

Sat Jul 18 07:06:31 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb,ext/tk/lib/tk/grid.rb: Bug fix on grid_slaves().
	  Extend usage pattern of grid_column()/grid_row().

Sat Jul 18 06:30:35 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: include winsock headers in extern "C++" for
	  C++ extension libraries.

	* include/ruby/missing.h (vsnprintf): workaround for VC++.
	  [ruby-core:23096]

Sat Jul 18 00:23:47 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/readline/readline.c (Init_readline): rl_catch_signals does
	  not exist on some platform like Mac OS X 10.5.

	* ext/readline/extconf.rb: checks existence of rl_catch_signals.

Fri Jul 17 22:37:22 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (socket_s_ip_address_list): drop inactive
	  adapters.

	* test/socket/test_{nonblock,addrinfo,socket}.rb: skip some tests on
	  Windows.
	  [ruby-core:23051]

Fri Jul 17 22:29:21 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/readline/readline.c (Init_readline): use rl_catch_sigwinch only
	  when existing.

	* ext/readline/extconf.rb: check existence of rl_catch_sigwinch, and
	  workaround for native Win32 readline port.

Fri Jul 17 18:18:23 2009  Tanaka Akira  <akr@fsij.org>

	* range.c (recursive_hash): extracted from range_hash.  reject
	  recursive key.
	  (range_hash): use recursive_hash.

Fri Jul 17 18:11:32 2009  Tanaka Akira  <akr@fsij.org>

	* struct.c (recursive_hash): extracted from rb_struct_hash.  reject
	  recursive key.
	  (rb_struct_hash): use recursive_hash.

Fri Jul 17 16:45:22 2009  Tanaka Akira  <akr@fsij.org>

	* array.c (recursive_hash): reject recursive key.

Fri Jul 17 15:20:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (DIGSPERINT): fix for LP64.

	* random.c (fill_random_seed): /dev/urandom is not available on
	  DOSISH systems.

	* random.c (random_equal): new method Random#==.

Fri Jul 17 13:35:47 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (rsock_getfamily): return AF_UNSPEC if getsockname
	  is failed.  [ruby-core:24383]

Fri Jul 17 01:22:57 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (recursive_join): raise ArgumentError for joining
	  recursive array.

	* array.c (ary_join_1): ditto.

	* test/ruby/test_array.rb (TestArray#test_join2): test updated for
	  recursive join.

Thu Jul 16 23:32:16 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb,ext/tk/config_list.in: ignore paths which includes
	  white space characters on Windows.[ruby-dev:38794]

	* ext/tk/lib/tk.rb: works on Cygwin (limitation:: Tk.mainloop works on
	  the main thread only).

Thu Jul 16 20:58:18 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole.rb (test_s_codepage_changed,
	  test_s_locale_set, test_s_locale_change): skip test if Japanese
	  locale is not installed. [ruby-core:23806]

	* test/win32ole/test_win32ole_variant.rb (test_conversion_str2cy):
	  ditto.

Thu Jul 16 19:02:28 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/lib/socket.rb (Socket.tcp_server_sockets_port0): servers
	  is nil if an error occurs before setting it.

Thu Jul 16 18:42:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (fill_random_seed): suppress a warning.

Thu Jul 16 18:30:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_aset, recursive_hash): rejects recursive hash.
	  [ruby-core:22921]

Thu Jul 16 18:28:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* id.c (Init_id), vm.c (vm_exec): @#__ThrowState__ is no longer
	  used.  [ruby-dev:38760]

Thu Jul 16 17:41:28 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_method.c (rb_alias): fix a case which try non-existing method alias.

	* test/ruby/test_alias.rb: add a test.

Thu Jul 16 16:00:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_reopen): discards read buffer.  [ruby-core:24240]

Thu Jul 16 15:52:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_new, rb_bigzero_p), range.c (rb_range_values):
	  added for random.c.

	* random.c (rb_random_t): objectified.  [EXPERIMENTAL]
	  [ruby-dev:30954]

Thu Jul 16 14:08:44 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_sample): RDoc update.  a patch from Florian
	  Frank.   [ruby-core:24347]

Thu Jul 16 12:42:10 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_readline): rl_free_line_state
	  before rl_cleanup_after_signal.

	* ext/readline/readline.c (Init_readline): set rl_catch_signals and
	  rl_catch_sigwinch as 0. [ruby-core:21884]

Thu Jul 16 08:59:22 2009  Koichi Sasada  <ko1@atdot.net>

	* node.h, vm_core.h, variable.c: rename global_entry to rb_global_entry.

	* compile.c, insns.def, iseq.c, vm_insnhelper.h: ditto.

Thu Jul 16 08:57:44 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_method.c: separate clearing cache entry code.

Thu Jul 16 08:56:32 2009  Koichi Sasada  <ko1@atdot.net>

	* dir.c (push_glob): re-fix GC problem.

Thu Jul 16 08:55:27 2009  Koichi Sasada  <ko1@atdot.net>

	* common.mk: add method.h.

Thu Jul 16 08:53:26 2009  Koichi Sasada  <ko1@atdot.net>

	* io.c (argf_free): free data body.

Wed Jul 15 23:46:55 2009  Koichi Sasada  <ko1@atdot.net>

	* method.h, vm_core.h: add rb_method_entry_t.  Remove nodes around
	  method management.  This change affect some VM control stack structure.

	* vm.c, vm_insnhelper.c, vm_method.c, vm_eval.c: ditto.  and make some
	  refactoring.

	* insns.def, class.c, eval.c, proc.c, vm_dump.c : ditto.

	* vm_core.h, compile.c (iseq_specialized_instruction): remove
	  VM_CALL_SEND_BIT.  use another optimization tech for Kernel#send.

	* node.h: remove unused node types.

	* ext/objspace/objspace.c (count_nodes): ditto.

	* gc.c: add mark/free functions for method entry.

	* include/ruby/intern.h: remove decl of
	  rb_define_notimplement_method_id().  nobody can use it
	  because noex is not opened.

	* iseq.c (iseq_mark): fix to check ic_method is available.

	* iseq.c (rb_iseq_disasm): fix to use rb_method_get_iseq().

Wed Jul 15 23:45:11 2009  Koichi Sasada  <ko1@atdot.net>

	* dir.c (push_glob): fix GC problem.

Wed Jul 15 17:33:52 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/purelib.rb: translates a fake path to rubygems in $" into
	  an alternative in $: so that Kernel.#require does not load
	  more rubygems.rb.
	  Resolves many failures in test/rubygems/*.

	* gem_prelude.rb (Gem.load_full_rubygems_library): supports case
	  the rubygems to load is not in $(rubylibprefix).
	  (Gem.path_to_full_rubygems_library): new method for the changes in
	  purelib.rb and Gem.load_full_rubygems_library.
	  (Gem.fake_rubygems_as_loaded): new method.

Wed Jul 15 16:29:35 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (LIBPATHFLAG): path is already quoted in mkmf.rb.

Wed Jul 15 06:21:50 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: --with-{tcl,tk}-dir doesn't work.[ruby-dev:38782]

Wed Jul 15 04:22:54 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/cgi/test_cgi_multipart.rb (CGIMultipartTest#_prepare):
	  set tempfile name with literal.

Tue Jul 14 21:53:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/nonblock: moved from ext/io/wait/lib.

Tue Jul 14 17:29:20 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_index_m): return nil if pos is out of string.
	  [ruby-core:23660]

Tue Jul 14 16:13:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_initialize): check if the descriptor can be accessed
	  in the specified open mode.  [ruby-dev:38571]

Tue Jul 14 09:26:14 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: Long-term-callback support isn't stable yet.
	  So, disable the feature and waiting for improvement in the future.

Tue Jul 14 01:28:17 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_m17n.rb (TestM17N#test_env): the encoding of
	  ENV is now locale encoding.

Tue Jul 14 01:24:56 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* marshal.c (r_object0): should return real object.

Tue Jul 14 01:06:31 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* enumerator.c (yielder_yield_i): use rb_proc_new instead of
	  rb_iterate.  [ruby-dev:38518]

	* README.EXT: rb_iterate is obsolete since 1.9; use rb_block_call
	  instead.

	* README.EXT.ja: ditto.

Tue Jul 14 00:45:41 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_case.rb (TestCase#test_deoptimization):
	  test for [ruby-core:23190].

Mon Jul 13 22:49:50 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/prime.rb (Prime#prime_division): now decomposes
	  negative integer into a decomposition with element [-1, 1].

	* test/test_prime.rb: test for it.

Mon Jul 13 22:28:03 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (pipe_open): handles leaked on win32 when an error occurs.

Mon Jul 13 20:21:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): should not shadow outer variable not to
	  return Qnil always.

Mon Jul 13 19:41:05 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* marshal.c (r_object0): copy instance variables to new regexp.

Mon Jul 13 17:49:11 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h, compile.c: declare struct iseq_inline_cache_entry.
	  Inline cache (IC) entries are no longer GC managed object.
	  IC entries are freed when ISeq is freed.

	* iseq.c: fix mark, free, memsize functions for above change.

	* insns.def: remove rb_gc_write_barrier().

	* vm_insnhelper.c (vm_method_search): ditto.

	* tool/instruction.rb, template/insns_info.inc.tmpl (insn_iclen):
	  added.

Mon Jul 13 13:35:08 2009  Koichi Sasada  <ko1@atdot.net>

	* insns.def, vm_insnhelper.c (getinstancevariable):
	  fix to use inline cache.

	* compile.c: fix to skip inline cache entry (IC).  IC is added
	  automatically by compiler.

	* insns.def, vm_insnhelper.h: fix IC positions.

	* iseq.c: increment minor_version of ISeq because of above change.

Mon Jul 13 08:01:00 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: New strategy for searching Tcl/Tk libraries.

	* ext/tk/*: Support new features of Tcl/Tk8.6b1 and minor bug fixes.
	     ( [KNOWN BUG] Ruby/Tk on Ruby 1.9 will not work on Cygwin. )

	* ext/tk/*: Unify sources between Ruby 1.8 & 1.9.
	            Improve default_widget_set handling.

	* ext/tk/*: Multi-TkInterpreter (multi-tk.rb) works on Ruby 1.8 & 1.9.
	     ( [KNOWN BUG] On Ruby 1.8, join to a long term Thread on Tk
	        callbacks may freeze. On Ruby 1.9, cannot create a second
	        master interpreter (creating slaves are OK); supported master
	        interpreter is the default master interpreter only. )

	* ext/tk/lib/tkextlib/*: Update supported versions of Tk extensions.
	         Tcllib 1.8/Tklib 0.4.1  ==>  Tcllib 1.11.1/Tklib 0.5
	         BWidgets 1.7            ==>  BWidgets 1.8
	         TkTable 2.9             ==>  TkTable 2.10
	         TkTreeCtrl 2005-12-02   ==>  TkTreeCtrl 2.2.9
	         Tile 0.8.0/8.5.1        ==>  Tile 0.8.3/8.6b1
	         IncrTcl 2005-02-14      ==>  IncrTcl 2008-12-15
	         TclX 2005-02-07         ==>  TclX 2008-12-15
	         Trofs 0.4.3             ==>  Trofs 0.4.4

Mon Jul 13 01:18:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_timespec): rounds subsecond toward zero.

Sun Jul 12 23:51:39 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* hash.c (env_str_new): use rb_locale_str_new instead of
	  rb_tainted_str_new. rb_locale_str_new set string locale
	  encoding and tainted.

Sun Jul 12 23:56:40 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: added some shortcuts.

	* rational.c: ditto.

Sun Jul 12 23:30:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_to_integer, rb_check_to_integer): return Bignum
	  as-is.

Sun Jul 12 21:07:46 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: use k_exact_{zero,one}_p macro.

	* rational.c: ditto.

Sun Jul 12 20:42:58 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c (fix_divide): added an entry to rational.

	* rational.c (rb_rational_reciprocal): added.

	* complex.c (f_reciprocal): added.

Sun Jul 12 02:24:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rand_init): use fixed buffer for small numbers.

Sat Jul 11 14:43:34 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_io_m17n.rb (test_strip_bom): added.

Sat Jul 11 07:11:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  array length is long.

	* ext/readline/readline.c (readline_s_get_filename_quote_characters):
	  missing type of self.

Sat Jul 11 02:37:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (limited_rand): expands to long before shift so that
	  the result does not overflow.

Sat Jul 11 00:16:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rand_init): got rid of buffer overflow.

Sat Jul 11 00:11:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_join_1): should recurse for element array.

Fri Jul 10 23:10:11 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_strip_bom): ungetbyte third byte when UTF-16LE.

Fri Jul 10 23:04:16 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_strip_bom): Fix condition of second byte of
	  UTF-16LE/UTF-32LE.

Fri Jul 10 21:45:30 2009  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: checked rl_refresh_line in readline.

	* ext/readline/readline.c (readline_s_refresh_line): add new
	  method, a patch from Koichiro Ohba. see [ruby-list:45922].

Fri Jul 10 21:00:05 2009  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: checked rl_line_buffer and rl_point in
	  readline.

	* ext/readline/readline.c (readline_s_get_line_buffer): new method.
	  (readline_s_get_point): new method.

Fri Jul 10 16:30:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (recursive_join): use obj to tell if recursion occurs.
	  [ruby-core:24150]

	* enum.c (enum_join): reverted r23966.  [ruby-core:24196]

Fri Jul 10 14:41:34 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* marshal.c (r_object0): set encoding only if the encoding
	  is not US-ASCII.

Fri Jul 10 14:44:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (struct MT): ruby already assumes int has 32bit a
	  least, so no needs to use long.

	* random.c (rand_init): copies data to be used really only.

Fri Jul 10 11:41:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_obj_{untrust,untrusted,trust}): added
	  prototypes.  [ruby-dev:38756]

Fri Jul 10 10:25:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_search_superclass): checks for implicit
	  argument passing before method search.  [ruby-core:24244]

Fri Jul 10 07:22:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_data_type): typed.

Thu Jul  9 23:28:48 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/io.h (FMODE_STRIP_BOM): new constant.

	* io.c (io_encname_bom_p): judge whether the encoding name
	  is *-bom or not.
	  (parse_mode_enc): drop "-bom".
	  (rb_io_modestr_fmode): set FMODE_STRIP_BOM if needed.
	  (rb_io_extract_modeenc): ditto.
	  (io_strip_bom): strip bom if exists.
	  (io_set_encoding_by_bom): set encoding if there is bom.
	  Set encoding and strip bom when modeenc string is "r:foo-bom"
	  [ruby-dev:37236]

Thu Jul  9 21:56:59 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* marshal.c (r_object0): replace \u by u when the regexp is
	  made by Ruby 1.8. [ruby-dev:36750]

Wed Jul  8 23:13:54 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_div): omitted zero division check.

Wed Jul  8 21:00:37 2009  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/inspector.rb: forget svn add.

Wed Jul  8 19:10:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_type): rejects typed data.

Wed Jul  8 18:28:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c ({proc,binding,method}_data_type): typed.

Wed Jul  8 16:47:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_basename): returns new string instead of
	  shared string from FilePathStringValue().  [ruby-core:24199]

Wed Jul  8 04:28:16 2009  Eric Hodel  <drbrain@segment7.net>

	* ext/.document:  Update with extensions that appear to have
	  documentation.  [ruby-core:24181]

Wed Jul  8 04:28:16 2009  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h:
	  rename
	    "...TypeStruct" and "typed_struct" to
	    "TypedData..." and "typeddata", respectively.
	  rename
	    rb_data_type_t#name to
	    rb_data_type_t#wrap_struct_name.

	* error.c, gc.c, iseq.c, vm.c: ditto.

Tue Jul  7 20:23:27 2009  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* bin/irb, lib/irb.rb lib/irb/*: irb-0.9.6, extend inspect-mode

Tue Jul  7 17:00:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_gc_call_finalizer_at_exit): deal with typed struct like
	  as obj_free().

	* error.c (rb_typed_struct_is_kind_of): new function to see if the
	  given typed struct.

	* error.c (rb_check_typed_struct): new function to check typed
	  struct.

	* include/ruby/ruby.h (Check_TypedStruct, Data_Get_TypedStruct):
	  new macro to check typed struct.

Tue Jul  7 13:36:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (DEFINE_ENUMFUNCS): included function signature.

	* enum.c (rb_enum_join): non-nil separator must be convertible to
	  String.  [ruby-core:24172]

Tue Jul  7 12:47:28 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (rb_enum_join): should propagate taint to the return
	  value.  the change was overridden by r23967.  [ruby-core:24176]

Tue Jul  7 11:56:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (GC_PROF_SET_MALLOC_INFO, GC_PROF_SET_HEAP_INFO): simplified.

Tue Jul  7 10:12:37 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ext_int_to_encs): Set external encoding if
	  ext==intern. [ruby-dev:38278]

Mon Jul  6 09:31:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (make_curry_proc): should propagate lambda-ness.
	  [ruby-core:24127]

	* proc.c (proc_hash): use long.

Mon Jul  6 09:06:49 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_module.rb (TestModule#test_undef): adjust to
	  message change.

	* test/ruby/test_object.rb (TestObject#test_redefine_method_which_may_case_serious_problem): ditto.

	* test/ruby/test_object.rb (TestObject#test_remove_method): ditto.

Mon Jul  6 09:04:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_join): deals with self recursive objects to get rid
	  of infinite recursion.  [ruby-core:24150]

Mon Jul  6 08:00:10 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_to_a): should propagate taint to the return value.
	  [ruby-core:24152]

	* enum.c (enum_sort_by): ditto.

Mon Jul  6 00:41:41 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: edited rdoc.

Sun Jul  5 23:55:57 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): fix Time.local(2009,2,31) failure on 64bit
	  time_t environment.

Sun Jul  5 22:43:13 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_s_polar): now arg is optional.

Sun Jul  5 20:40:35 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (float_arg): returns PI for -0.0.

Sun Jul  5 14:04:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_threadptr_exec_event_hooks): new function to
	  execute event hooks, with preserving errinfo.  [ruby-core:24118]

Sun Jul  5 08:14:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_add_method, remove_method, rb_undef): fixed
	  minor grammatical errors in warnings.  a patch from Run Pain
	  Run Run at [ruby-core:24141].

	* vm_method.c (Init_eval_method): registers notimplement_body as a
	  mark-object.

	* vm_insnhelper.c (vm_yield_setup_block_args): restores the firs
	  arg where is overwritten at funcall.  [ruby-core:24139]

Sat Jul  4 08:20:03 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (dbl2ival): should raise FloatDomainError on Infinity
	  and NaN as 1.8 does.  [ruby-dev:38726]

Fri Jul  3 22:48:45 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): less number of guesses for hh:mm:60.

Fri Jul  3 21:30:14 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_equal_p): removed.

Fri Jul  3 21:07:29 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: renamed equal_p to eqeq_p.

	* complex.c: ditto.

	* complex.c (nucomp_equal_p): added.
	  Complex(NaN).equal?(Complex(NaN)) should return true.

Fri Jul  3 19:48:40 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: undef-ed some methods.  [ruby-core:24110]

	* complex.c (Numeric#arg): NaN for NaN.  [ruby-core:24116]

Fri Jul  3 18:35:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (struct rb_iseq_struct): fixed types.

	* vm_core.h (ic_vmstat): VM state version is VALUE.

Fri Jul  3 02:52:20 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): time guess strategy refined again.

Fri Jul  3 00:36:16 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (find_time_t): time guess strategy refined.

Thu Jul  2 11:16:25 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: added response to Net::IMAP::ResponseError.
	  a patch from Eric Hodel in [ruby-core:24111].

Thu Jul  2 08:04:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (num_exact): rb_check_to_integer() can deal with both of
	  Fixnum and Bignum together.

Thu Jul  2 07:53:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): fixed wrong variable.

Thu Jul  2 05:37:38 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (num_exact): use to_r for T_FLOAT.

Thu Jul  2 05:15:54 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (quo): return an integer if possible.

Wed Jul  1 21:09:25 2009  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_time_num_new): declared.

	* time.c (nsec2timev): extracted from time_new_internal.
	  (time_new_internal): change argument to VALUE.
	  (rb_time_new): follow the argument change.
	  (rb_time_nano_new): ditto.
	  (rb_time_num_new): new function.

	* ext/socket/ancdata.c (ancillary_timestamp): use rb_time_num_new to
	  represent struct bintime preciously.

Wed Jul  1 08:46:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_encoding): encodings need extra depth.
	  [ruby-core:24100]

Wed Jul  1 06:47:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_grep): gets rid of type-punning calls.

Wed Jul  1 06:36:28 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_join): add Enumerable#join.

	* array.c (ary_join_1): recursive join for Enumerators (and
	  objects with #to_a).

	* array.c (rb_ary_join): performance tune.

Tue Jun 30 18:19:07 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_hash): documentation fix.  a patch from
	  Marc-Andre Lafortune.  [ruby-core:23943]

	* object.c (rb_mod_cmp): ditto.

	* range.c (range_eq): ditto.

	* string.c (rb_str_partition, rb_str_rpartition): ditto.

	* struct.c (rb_struct_s_def): ditto.

Tue Jun 30 17:44:24 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (reg_match_pos): adjust offset based on characters, not
	  bytes.  [ruby-dev:38722]

	* string.c (rb_str_offset): new function.

	* string.c (rb_str_index_m): no call to rb_reg_adjust_startpos().

Tue Jun 30 16:57:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb: renamed to get rid of collision against
	  instruction.rb on command line completion of shell.

	* tool/mkconfig.rb (RbConfig.expand): get rid of exceptions on
	  frozen strings unless really changed.

	* tool/file2lastrev.rb: get rid of global variables.

	* tool/compile_prelude.rb: use US-ASCII name.

Tue Jun 30 16:46:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def, tool/instruction.rb: fixed types.

Tue Jun 30 11:08:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/oniguruma.h, include/ruby/re.h, re.c, regcomp.c,
	  regenc.c, regerror.c, regexec.c, regint.h, regparse.c: use long.

Tue Jun 30 11:05:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_find_1): fixed index overrun.

Tue Jun 30 08:42:34 2009  Eric Hodel  <drbrain@segment7.net>

	* tool/instruby.rb: summary is required in a .gemspec.

Tue Jun 30 01:35:12 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/strip-rdocs.rb: supports QT style doxy-comments.

Tue Jun 30 01:24:10 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (log2, cbrt): added.  [experimental]

Tue Jun 30 01:19:53 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_expt): do not use rb_fexpt.

Mon Jun 29 22:50:10 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* Doxyfile.in: removed. merged into template/Doxyfile.template

	* configure.in: new checking for dot and doxygen.

	* template/Doxyfile.template: merged with Doxyfile.in.
	  configured some options.

	* common.mk (capi): use $(DOXYGEN) instead of "doxygen".
	  (Doxyfile): removed a duplicate entry in the dependency.

Mon Jun 29 21:01:31 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_expt): checks exactness.

Mon Jun 29 20:29:11 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (float_to_r): always returns rational.

Mon Jun 29 18:55:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_find_1): fix for files with dots.  [ruby-dev:38588]

Mon Jun 29 17:14:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): should copy original encoding.
	  [ruby-dev:38612]

Sun Jun 28 23:10:55 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* gem_prelude.c (Gem.default_dir): follows the change on
	  lib/rubygems/default.rb in r23879

Sun Jun 28 23:32:11 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_div): raises ZeroDivisionError immediately
	  when the given second argument is zero.

	* rational.c (nurat_fdiv): never raise even if the given second
	  argument is zero.

	* rational.c (rb_raise_zerodiv): changed the message (zero to 0).

Sun Jun 28 22:25:07 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_expt): convert to a float when the given power
	  is a bignum.

	* rational.c (nurat_expt): ditto.

Sun Jun 28 21:16:48 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (sqrt): fixed an issue [ruby-list:45852].

Sun Jun 28 19:48:29 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_expt): some improvements.

	* rational.c (nurat_expt): ditto.

Sun Jun 28 19:03:46 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/instruby.rb (:gem): registers the bundled version
	  of minitest as a gem as rdoc or rake.
	  c.f. [ruby-dev:38692].

Sun Jun 28 19:02:07 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/rubygems.rb (ConfigMap[:rubylibprefix]): new entry.

	* lib/rubygems/defaults.rb (Gem.default_dir): considers
	  "--with-rubylibprefix" configure option.

Sun Jun 28 09:21:00 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: renamed some static functions.

	* rational.c: ditto.

Sat Jun 27 19:06:22 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_addsub): new

	* complex.c (nucomp_{add,sub}): use nucomp_addsub.

	* complex.c (nucomp_divide): changed the algorithm.

	* complex.c (nucomp_abs): added shortcuts.

Sat Jun 27 16:56:33 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_cmp): use rb_num_coerce_cmp.

Sat Jun 27 16:45:10 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: revised rdoc.

	* rational.c: ditto.

	* numeric.c: ditto.

Sat Jun 27 13:44:48 2009  Kouhei Sutou  <kou@cozmixng.org>

	* NEWS, lib/rss/maker/base.rb, test/rss/test_maker_2.0.rb: add
	  item.guid.permanent_link? and item.guid.permanent_link=.

Sat Jun 27 13:41:00 2009  Kouhei Sutou  <kou@cozmixng.org>

	* NEWS: rss: 0.2.5 -> 0.2.7.

	* lib/rss/rss.rb, test/rss/test_version.rb: 0.2.6 -> 0.2.7.

Sat Jun 27 03:16:56 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_chr): use default_internal encoding as default
	  destination encoding if set.  [ruby-core:23997]

Sat Jun 27 03:09:04 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_rewind): need to rewind $. and ARGF.lineno.
	  [ruby-core:24046]

	* io.c (struct argf): refactoring on $. and ARGF.lineno behavior.

Fri Jun 26 21:48:30 2009  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (pty_getpty): check dup failure.

Fri Jun 26 17:33:46 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_rubyopt):
	  test suite add '.' to RUBYLIB.  remove checks.

	* test/ruby/test_require.rb (TestRequire#test_tainted_loadpath):
	  the default tempdir directory /tmp is world writable, so
	  SecurityError would be raised.  check removed.

Fri Jun 26 16:32:59 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (COMPILE_PRELUDE): need -I. before -rrbconfig.
	  [ruby-dev:38714]

Thu Jun 25 18:41:51 2009  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.4.2 r5269.
	* test/minitest/*.rb: ditto.

Thu Jun 25 17:58:39 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_binmode_m): should call rb_io_ascii8bit_binmode() to
	  set its encoding to ASCII-8BIT.  [ruby-core:24029]

Thu Jun 25 13:04:58 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* instruby.rb: '&' in sed s command's replacement is '\&' in ruby.
	  [ruby-dev:38713]

Thu Jun 25 06:50:23 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_each_codepoint): uninitialized local variable enc.

Thu Jun 25 06:25:49 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (first_i): wrong condition for no argument #first.
	  [ruby-core:24017]

Wed Jun 24 20:19:11 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_s_now): new function.  Time.now don't take arguments.

Wed Jun 24 16:08:03 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/resource.rb: CONFIG["TEENY"] is not ruby's version but API's
	  one.  So need to use RUBY_VERSION instead.

Wed Jun 24 16:07:04 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/mkexports.rb: rbconfig.rb exists at ".".

Wed Jun 24 15:02:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_set_encode): show the erred file name instead of
	  the file that requires it.  [ruby-core:24006]

Wed Jun 24 11:41:20 2009  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-style.el: It is too late to set c-file-style in
	  c-mode-hook (at least on Emacs 23).  Call c-set-style instead.

Tue Jun 23 21:28:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_get_path_check): check with given safe level.

	* file.c (rb_find_file_ext_safe, rb_find_file_safe): ditto.

	* safe.c (rb_insecure_operation): function to raise security
	  error.

Tue Jun 23 20:32:43 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c: remove the definition of GC_DEBUG (debugging macro).

Tue Jun 23 16:16:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_version): defaults revision to 0 when no
	  revision.h exists.

Tue Jun 23 16:04:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_find_file_ext, rb_find_file): no needs to expand
	  paths with tilde twice.

	* load.c (rb_f_load): load the given path directly if not found in
	  load_path.

	* load.c (search_required): search file in specified safe level.

	* load.c (rb_require_safe): path to load is already searched in
	  search_required().

Tue Jun 23 12:43:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: remove PACKAGE_* macros generated by autotools.
	  [ruby-core:20938]

Tue Jun 23 01:17:38 2009  Tanaka Akira  <akr@fsij.org>

	* ruby.c (process_options): don't specify .so for encdb here.
	  "." is replaced by "_" in load_encoding.

	* encoding.c (load_encoding): add .so here.

Mon Jun 22 23:24:22 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_generic_ivar_memsize): typo fixed.  a patch from
	  Kazuhiro NISHIYAMA.  [ruby-dev:38700]

	* ext/objspace/objspace.c (memsize_of): ditto.

Mon Jun 22 21:21:59 2009  Tanaka Akira  <akr@fsij.org>

	* io.c: remove __CHECKER__ test.

	* dir.c: ditto.

	* dln.c: ditto.

	* file.c: ditto.

	* process.c: ditto.

Mon Jun 22 17:15:38 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/stringio/stringio.c (strio_each_codepoint): new method.
	  [ruby-core:23949]

	* ext/stringio/stringio.c (strio_each_codepoint): ditto.

Mon Jun 22 16:26:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): removed "." from load_path.

Mon Jun 22 16:14:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_arguments, iseq_compile_each): internal
	  arrays must be hidden.  [ruby-dev:38613]

	* vm.c (Init_top_self): ditto.

Mon Jun 22 14:41:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options), enc/prelude.rb: encdb and transdb are
	  extension libraries.

	* ruby.c (process_options): set progname earlier.

Mon Jun 22 13:50:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_fdatasync): new method IO#fdatasync.

Sun Jun 21 22:33:05 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* load.c (Init_load): $: must be readonly.  [ruby-dev:38690]

	* ruby.c (ruby_prog_init): $-W must be readonly.  [ruby-dev:38691]

Sun Jun 21 10:47:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::Entry_#copy_file): open with
	  default umask.  [ruby-core:23952]

Sun Jun 21 10:46:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (enc_arg): default internal encoding may not be set.
	  [ruby-core:23932]

Sat Jun 20 21:11:43 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c (num_div): don't use num_floor which is actually
	  flo_floor.

	* numeric.c (num_modulo): don't call '%'.

	* numeric.c (num_divmod): use num_modulo.

	* numeric.c: defined '%'.

	* rational.c (nurat_idiv,nurat_mod,nurat_divmod,nurat_rem): removed.

Sat Jun 20 20:28:44 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: edited rdoc.

	* numeric.c: ditto.

Sat Jun 20 08:56:47 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: edited rdoc.

	* rational.c: ditto.

	* numeric.c: ditto.

Sat Jun 20 07:17:52 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/monitor.rb (MonitorMixin::extend_object): should use
	  #__send__ instead of #send to avoid possible name conflict.
	  [ruby-core:23907]

Sat Jun 20 06:56:31 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: edited rdoc.

	* rational.c: ditto.

Sat Jun 20 05:08:59 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: edited rdoc.

	* rational.c: ditto.

Sat Jun 20 04:30:35 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_abs): removed.

Sat Jun 20 03:34:16 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: added rdoc.

Fri Jun 19 23:43:38 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c: edited rdoc.

Fri Jun 19 22:58:16 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: edited rdoc.

Fri Jun 19 22:21:17 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c: edited rdoc.

Fri Jun 19 21:56:01 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_expt): delegates to complex when self is
	  negative.  because Float#** does not produce complex.

Fri Jun 19 21:40:58 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c: edited rdoc.

	* rational.c: ditto.

Fri Jun 19 20:53:54 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_name_list): update RDoc.  [ruby-core:23926]

Fri Jun 19 20:44:45 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: constant COMPLEX_NAME has been removed.

	* rational.c: constant RATIONAL_NAME has been removed.

Fri Jun 19 20:39:46 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: added rdoc.  a patch from Run Paint Run Run.

Fri Jun 19 17:04:59 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_cmp): should always return nil for NaN.

	* numeric.c (flo_cmp): handle infinite value specially using
	  infinite? method internally.  [ruby-dev:38681]

Fri Jun 19 09:28:45 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c (*_numerator,*_denominator): moved to rational.c.

	* rational.c (*_numerator,*_denominator): moved from numeric.c.

Fri Jun 19 08:14:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (big_lshift, big_rshift): return Bignum always without
	  normalization.  [ruby-dev:38679]

Thu Jun 18 22:31:38 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_s_convert): calls to_r when the given argument
	  is non-integer.

	* rational.c (nurat_s_convert): raises TypeError when the given
	  argument is nil.

	* complex.c (nucomp_s_convert): ditto.

Thu Jun 18 20:32:11 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c (num_numerator, num_denominator): use
	  to_r [ruby-core:23910].

Thu Jun 18 16:21:05 2009  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.4.0 r5083.
	* test/minitest/*.rb: ditto.

Thu Jun 18 10:12:49 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_f): went infinity too
	  early.  add BASE_FIG margin.  [ruby-dev:38673]

Thu Jun 18 01:35:51 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_cmp): Infinity is greater than any bignum
	  number.  [ruby-dev:38672]

	* bignum.c (rb_big_cmp): ditto.

Thu Jun 18 01:29:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): drive letter is ascii only.
	  [ruby-dev:38612]

Thu Jun 18 01:09:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ridir, RI_BASE_NAME): fixed for path expansion.
	  [ruby-core:23876]

Wed Jun 17 23:46:08 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_coerce): accepts Complex when the imag is
	  exact zero.

Wed Jun 17 21:25:54 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* bignum.c (rb_big_fdiv): checks whether the given second argument
	  can be converted to float properly.

	* numeric.c (fix_fdiv): calls rb_big_fdiv when the given second
	  argument is a bignum.

	* rational.c (nurat_fdiv): should calculate Float(x/y), not
	  Float(x)/Float(y).

Wed Jun 17 16:57:40 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* load.c (rb_f_require): RDoc updated.  a patch from Run Paint Run
	  Run in [ruby-core:23833].

	* load.c (rb_mod_autoload): ditto.  [ruby-core:23835]

Wed Jun 17 14:37:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sample/test.rb (valid_syntax?): skips BOM.  [ruby-dev:38666]

	* test/ruby/test_system.rb (TestSystem#valid_syntax?): ditto.

Wed Jun 17 13:54:18 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/strscan/strscan.c (Init_strscan): remove obsolete
	  matchedsize method, use matched_size instead.  [ruby-dev:38591]

Wed Jun 17 12:37:37 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (ruby_thread_stack_overflow): call rb_exc_raise() on
	  stack overflows in the signal handler, if sigaltstack is
	  available.  On stack overflow (and with sigaltstack), the signal
	  handler is more likely to have room to create an exception
	  object.  [ruby-core:23813]

Wed Jun 17 08:10:38 2009  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace: added.  objspace library extends some methods to
	  ObjectSpace module.

Wed Jun 17 08:14:01 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_coerce): accepts Complex instances.

	* rational.c (nurat_coerce): accepts Rational
	  instances. [ruby-core:23859]

Wed Jun 17 07:36:22 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httputils.rb (parse_form_data): escape boundary of
	  multipart/form-data when embed in regexp.

Wed Jun 17 07:24:26 2009  Koichi Sasada  <ko1@atdot.net>

	* array.c (rb_ary_memsize): added.

	* io.c (rb_io_memsize): added.

	* regcomp.c (onig_memsize): added.

	* string.c (rb_str_memsize): added.

	* transcode.c (rb_transcoding_memsize, rb_econv_memsize): added.

	* variable.c (rb_geneic_ivar_memsize): added.

Wed Jun 17 07:04:33 2009  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_memsize): added.  Use RTypedData instead of RData
	  for ISeq.

	* vm.c (env_memsize, vm_memsize, thread_memsize): added.  Use
	  RTypedData instead of RData for Env, VM, Thread.

Wed Jun 17 06:48:28 2009  Koichi Sasada  <ko1@atdot.net>

	* st.c, include/ruby/st.h (st_memsize): added.  This function returns
	  the memory usage of st_table.

Wed Jun 17 06:19:06 2009  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: New structure RTypedData, added.
	  This structure includes more explicit type information for
	  T_DATA objects.  If RData(obj)->dfree is immediate value `1' on
	  T_DATA object obj, obj is needed to be accessed with RTYPEDDATA(obj)
	  instead of RDATA(obj).  A RTypedData structure points the structure
	  rb_typed_data_t.  rb_typed_data_t includes information such as the
	  type name of this data, mark and free function what RData includes,
	  and memsize function show how data consuming the memory size.
	  Note that you do not need any change existing T_DATA objects.
	  If you use RDataType instead of RData on T_DATA object,
	  you can specify explicit type information.

	* gc.c (rb_data_typed_object_alloc, rb_objspace_data_type_memsize,
	  rb_objspace_data_type_name): added.

Wed Jun 17 06:14:23 2009  Koichi Sasada  <ko1@atdot.net>

	* gc.c: fix indent.

Wed Jun 17 06:05:03 2009  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_objspace_each_objects): New C API, added.

Wed Jun 17 00:31:30 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_argf.rb (TestArgf#test_skip): updated test
	  according to clarified behavior.

Tue Jun 16 22:47:37 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (fptr_finalize): revert last change.  [ruby-dev:38648]

	* io.c (fptr_finalize): skip close(2) for fd 0,1,2.

Tue Jun 16 20:07:09 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (transcode_restartable0): refix can't build with VC9.

Tue Jun 16 16:09:59 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* parse.y (parser_read_escape, parser_tokadd_escape):
	  replace scan_oct as ruby_scan_oct.

Tue Jun 16 06:40:31 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (fptr_finalize): should close stdin/stdout/stderr when
	  closed explicitly.   [ruby-core:23853]

	* io.c (argf_skip): should close only when current_file is available.

Tue Jun 16 01:50:02 2009  Tanaka Akira  <akr@fsij.org>

	* vm_eval.c (rb_call0): refine exception message for hidden objects.

Mon Jun 15 22:35:31 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* bignum.c (rb_big2db): (-Float::MAX.to_i*2).to_f should return
	  -HUGE_VAL (-Infinity).

Mon Jun 15 18:48:41 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_each_line): should return self.  [ruby-core:23852]

	* io.c (argf_each_byte, argf_each_char): ditto.

Mon Jun 15 17:48:42 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (os_obj_of): invoke garbage collection before iteration, to
	  avoid accessing half recycled object references.  [ruby-dev:38613]

Mon Jun 15 11:04:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .gdbinit (rp, iseq): load dummy_gdb_enums on demand.
	  [ruby-dev:38606]

Sun Jun 14 14:57:57 2009  Koichi Sasada  <ko1@atdot.net>

	* thread.c, vm_eval.c: add Thread.backtrace.

	* test/ruby/test_thread.rb: add a test.

Sun Jun 14 13:58:32 2009  Koichi Sasada  <ko1@atdot.net>

	* transcode.c (transcode_restartable0): revert last commit because
	  this change cause SEGV at test-all.

Sun Jun 14 10:49:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_find_file_ext, rb_find_file): canonicalize absolute
	  paths.  [ruby-core:23845]

	* file.c (rb_file_size): added rdoc.  a patch from Run Paint Run
	  Run at [ruby-core:23839].

Sun Jun 14 07:53:26 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_fdiv): use fdiv recursively.

	* complex.c (nucomp_expt): reduced code.

Sun Jun 14 03:37:09 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf8_mac.trans: remove wrong optimization.

Sun Jun 14 01:53:00 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (transcode_restartable0): can't build with VC9.

Sun Jun 14 01:23:41 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_to_f): use fdiv.

Sat Jun 13 15:03:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_lock): show backtrace at circular require.

	* load.c (rb_provide): assumes us-ascii only.

	* load.c (rb_require_safe): FilePathValue() implies rb_str_new4().

	* load.c (rb_mod_autoload): try conversion to path like as
	  require.  [ruby-core:23834]

Sat Jun 13 09:58:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_ivar): should not set internal encoding ivar as an
	  ordinary ivar.  [ruby-dev:38596]

Sat Jun 13 07:08:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (rb_f_local_variables): now returns symbols.  a patch from
	  Run Paint Run Run at [ruby-core:23828].

Sat Jun 13 07:06:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (rb_f_catch): updated rdoc about generalized argument,
	  and the case without arguments.  [ruby-core:23827]

Sat Jun 13 06:50:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/net/protocol.rb (Net::BufferedIO#rbuf_fill): TimeoutError is
	  obsolete, use Timeout::Error instead.  [ruby-core:23821]

Sat Jun 13 06:45:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (rb_f_throw): fixed rdoc about exception.
	  [ruby-core:23824]

Fri Jun 12 14:56:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): associate the input encoding when
	  copying an absolute path.  [ruby-dev:38594]

Fri Jun 12 02:41:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_replace_shared): shared target must be frozen.
	  [ruby-core:23727]

Thu Jun 11 21:05:09 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (exp): omitted redundant function call.

Thu Jun 11 17:49:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (gfCheckVal): never used.

	* ext/bigdecimal/bigdecimal.c (VpInit): fixed format modifiers.

	* ext/bigdecimal/bigdecimal.c (VPrint): constified.

Thu Jun 11 15:27:17 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/prime.rb: documentation typo fixed.  a patch from okkez.
	  [ruby-dev:38586]

Wed Jun 10 18:15:17 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* dir.c (dir_s_getwd): directory path's encoding should be filesystem's
	  one.

	* lib/tmpdir.rb: ditto (but not finished yet.)

Wed Jun 10 06:28:15 2009  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*: Upgrade to RubyGems 1.3.4 r2223.

Tue Jun  9 22:38:09 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (log10): raised exception when the given number is
	  a negative real.

Tue Jun  9 15:13:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_s_glob): fixed rdoc.  a patch from Joseph Pecoraro a
	  [ruby-core:23767].

	* dir.c (sys_warning): get rid of type-punning function cast.

	* dir.c (ruby_glob0): get rid of possible overflow.

Tue Jun  9 10:58:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, win32/Makefile.sub (RMALL): need for distclean-rdoc.

Tue Jun  9 01:07:33 2009  Koichi Sasada  <ko1@atdot.net>

	* thread.c: rename functions which require a parameter
	  "rb_thread_t *", the prefix to be rb_threadptr_ instead of
	  rb_thread_.

	* thread.c (rb_thread_add_event_hook(), rb_thread_remove_event_hook):
	  change the parameter type from rb_thread_t * to VALUE.

	* eval.c, eval_error.c, eval_intern.h, signal.c, vm_core.h, vm_eval.c:
	  ditto.

	* include/ruby/intern.h: remove decl of rb_thread_signal_raise() and
	  rb_thread_signal_exit().

Mon Jun  8 05:07:41 2009  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (rb_thread_create_timer_thread): print fatal error
	  message to stderr instead of using rb_bug().

	* KNOWNBUGS.rb, bootstraptest/test_fork.rb: move a fixed test.

Sun Jun  7 22:44:20 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (log): avoided redundant expression.

Sat Jun  6 02:49:05 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_reject_bang): always check frozen status.
	  [ruby-core:23715]

	* hash.c (rb_hash_update): ditto.

	* hash.c (rb_hash_reject_bang): call rb_hash_foreach() directly.

	* hash.c (rb_hash_update_i): call st_insert() directly.

	* hash.c (rb_hash_update_block_i): ditto.

Fri Jun  5 07:12:32 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mkmf.rb (#link_command): should dup CONFTEST_C which is
	  frozen.  ref  [ruby-core:23675].  [ruby-core:23702]

Thu Jun  4 02:25:51 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/base64.rb: typo fixed.  a patch from okkez.   [ruby-dev:38564]

Wed Jun  3 09:03:23 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_first): should check negative length.

Tue Jun  2 17:32:40 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (first_i): Enumerator#first should consume only what is
	  needed.   a patch from Marc-Andre Lafortune.  [ruby-core:23661]

	* enum.c (enum_first): call to_int once for an argument.  based on
	  a patch from Marc-Andre Lafortune.

Tue Jun  2 13:27:21 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ripper/test_filter.rb: add tests. see [ruby-dev:37856]

Tue Jun  2 07:44:43 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_gsub_bang): modify check at the beginning.
	  [ruby-core:23662]  ref [ruby-core:23657]

	* string.c (rb_str_rstrip_bang): ditto.  [ruby-core:23657]

	* string.c (rb_str_chop_bang): ditto.

	* string.c (rb_str_chomp_bang): ditto.

	* string.c (rb_str_reverse_bang): modify check added.  [ruby-core:23671]

Mon Jun  1 11:21:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_capture, fiber_store): reraise transferred error.

	* cont.c (fiber_switch): transfers dead fiber error to the previous
	  or root fiber if the current fiber is dead.  [ruby-core:23651]

Mon Jun  1 10:41:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_exc_new2): optimization for literal.

Mon Jun  1 07:20:02 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_f): returns Inf if
	  exp is bigger than DBL_MANT_DIG.

Sun May 31 23:28:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): checks for duplication of source
	  files.

Sun May 31 23:26:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (istrailinggarbage): fixed typo.

Fri May 29 17:10:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* struct.c (Init_Struct): made #to_s an alias to #inspect to
	  reduce the result of recursive struct.  a patch from ujihisa a
	  [ruby-dev:38554].

Fri May 29 17:08:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (Init_Hash): made #to_s an alias to #inspect to reduce
	  the result of recursive hash.  a patch from ujihisa a
	  [ruby-core:23601].  [ruby-dev:38555]

Fri May 29 09:30:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (collect_all): checks interrupts.  [ruby-core:23594]

Thu May 28 07:39:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (THREAD_MODEL): reject unknown value and checks
	  pthread.h only when pthread.  [ruby-core:23577]

Thu May 28 03:47:46 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/optparse/opttest.rb: typo fixed.  [ruby-dev:38544]

Thu May 28 03:43:10 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_strftime): update RDoc according to info from
	  Marc-Andre Lafortune in [ruby-core:23575].  [ruby-core:23564]

Thu May 28 02:40:54 2009  Tanaka Akira  <akr@fsij.org>

	* lib/uri: don't set @parser if it is DEFAULT_PARSER for marshaling
	  URI objects between Ruby 1.8 and Ruby 1.9.
	  [ruby-dev:38377]

Wed May 27 23:00:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (struct parser_params): lex_gets_ptr should be long.

Wed May 27 18:00:15 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigand_int): new function to calculate bignum and
	  fixnum without allocating internal bignum.

	* bignum.c (bigor_int): ditto.

	* bignum.c (bigxor_int): ditto.

	* bignum.c (bigand_int): even less object allocation.

Wed May 27 14:29:55 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_encoding): more compact encoding information for
	  US-ASCII and UTF-8.  [incompatible] [experimental]

	* marshal.c (r_ivar): restore :E encoding information.

Wed May 27 14:08:39 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* st.c (st_insert2): new function with processing new key,
	  e.g. copy.

	* hash.c (rb_hash_aset): use st_insert2() to reduce redundant
	  st_lookup calls.

Wed May 27 02:31:38 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_getc): the function for
	  rl_getc_function must be a byte function.
	  so use getbyte method. [ruby-dev:38535]

Tue May 26 14:24:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c: fixed types.

	* common.mk (bignum.o, numeric.o): depend on util.h.

	* bignum.c, marshal.c: fixed types.

	* numeric.c (infinite_value): use ruby_div0.

	* include/ruby/util.h (ruby_div0): moved from marshal.c.

Tue May 26 11:01:41 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* lib/mkmf.rb: use map! to replace strings in $objs array.

Tue May 26 10:12:08 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bignew_1): inline memory allocation.

	* bignum.c (bigtrunc): call rb_big_resize() only when needed.

	* bignum.c (bigfixize): declare inline.

Tue May 26 05:39:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (FilePathValue): prevent from GC.

	* include/ruby/ruby.h (NUM2LONG): added GCC specific optimization.

Tue May 26 03:41:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (rb_gmtime, rb_localtime): gmtime and localtime return
	  NULL on error.  [ruby-core:23551]

Tue May 26 03:38:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_each_char, rb_str_each_codepoint): string
	  length must be long.

Mon May 25 13:27:32 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* lib/mkmf.rb: dont use gsub! method for frozen string.

Mon May 25 11:47:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb, tool/instruby.rb: removed redundant code.

Mon May 25 09:34:09 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_hash): avoid calling rb_enc_str_asciionly_p().

	* string.c (rb_str_replace): avoid redundant calling rb_str_new4().

	* string.c (str_replace): factor out replacement from
	  rb_str_replace() without type check nor discarding the
	  destination contents.

Mon May 25 08:06:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_partition): should use the converted result.  a
	  patch from Marc-Andre Lafortune at [ruby-core:23540].

	* string.c (rb_str_rpartition): ditto.

Mon May 25 06:25:38 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_hash.rb (TestHash::test_equal2): recursive hashes
	  are handled properly now. ref: [ruby-core:23402]

	* test/ruby/test_m17n.rb (TestM17N#test_sprintf_p): test fixed

Mon May 25 05:32:19 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi/core.rb (CGI::HTTP_STATUS): typo fixed.  a patch from
	  Nobuhiro IMAI.  [ruby-dev:38538]

Sun May 24 22:48:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_exec_recursive_paired): new function for proper
	  handling of recursive arrays.  [EXPERIMENTAL] [ruby-core:23402]

	* array.c (rb_ary_equal, rb_ary_eql, rb_ary_cmp): use above.

	* hash.c (hash_equal): ditto.

Sun May 24 22:39:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (syserr_initialize): errno is int.

Sun May 24 00:52:54 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in ($ridir): new configuration. [ruby-core:23520].
	  c.f. [ruby-core:23519].

	  (--with-ridir): new configure option.

	* tool/instruby.rb (:doc, :rdoc): uses $ridir instead of
	  a fixed path.

	* lib/rdoc/ri/paths.rb: follows $ridir.

	* Makefile.in: removes RIDATADIR which is no longer used.

	* bcc32/Makefile.sub: generates the 'ridir' entry for RbConfig.
	  removes RIDATADIR which is no longer used.

	* win32/Makefile.sub: ditto.

Sat May 23 23:52:33 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_each_char): return original string.
	  [ruby-core:23499]

	* string.c (rb_str_each_codepoint): protect string from
	  modification.

Sat May 23 21:48:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/handle.c (rb_dlhandle_s_sym): added a method to access
	  using RTLD_NEXT.  [ruby-dev:38152]

	* ext/dl/handle.c (Init_dlhandle): added constants DEFAULT and
	  NEXT which correspond to RTLD_DEFAULT and RTLD_NEXT.

Sat May 23 18:53:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/lib/dl/cparser.rb (DL::CParser#parse_struct_signature):
	  splitting with regexp source string is obsolete.  a patch from
	  Minwoo Lee at [ruby-core:23494].

	* ext/dl/cptr.c (rb_dlptr_cmp): return signed value, and restrict
	  to Fixnum.  [ruby-dev:38533]

Fri May 22 23:22:53 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* missing/vsnprintf.c (errno): [BUG] fixes a compilation
	  error on SIZEOF_LONG > SIZEOF_INT.
	  (BSD_vfprintf): ditto.

Fri May 22 23:20:48 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/default.mspec: follows runruby.rb's move at r23542.

Fri May 22 21:38:55 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* NEWS: add Time#to_r.

Fri May 22 20:29:01 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* config.guess: moved into tool/.

	* config.sub: ditto.

	* install-sh: ditto

	* configure.in: follows the moves.

	* LEGAL: ditto.

Fri May 22 20:10:18 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* instruby.rb: moved into tool/.

	* mkconfig.rb: ditto.

	* rubytest.rb: ditto.

	* runruby.rb: ditto.

	* common.mk: follows the moves.

	* configure.in: ditto.

	* win32/Makefile.sub: ditto.

Fri May 22 05:09:43 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_slice_bang): avoid call of rb_scan_args() unless
	  it's really necessary.

Thu May 21 22:17:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/id.h.tmpl, id.h (enum ruby_method_ids): added some IDs.

	* debug.c (dummy_gdb_enums): added enum ruby_method_ids.

	* .gdbinit (rp): improved output of Symbol.

Thu May 21 21:07:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/vsnprintf.c (BSD_vfprintf): support for 'z' modifier.

Thu May 21 18:55:33 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* gem_prelude.rb (Gem.default_dir and misc.): use rubylibprefix.
	  follows the change in r23368.

Thu May 21 12:07:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RB_EVENT_HOOKS_HAVE_CALLBACK_DATA):
	  new macro for compatibility check.

Thu May 21 01:43:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_long2int, RARRAY_LENINT): check long to
	  cast to int.  [ruby-dev:38508]

	* struct.c, vm_eval.c, vm_insnhelper.c: use RARRAY_LENINT.

Wed May 20 21:00:27 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* rb_enc_get_index: allows an arbitrary RData as the argument but not
	  only what points a rb_encoding.

Wed May 20 20:54:37 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/.gitignore: ignores rubyspec/ and mspec/.

Wed May 20 19:41:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* struct.c (rb_struct_new): get rid of too large alloca.

	* struct.c (rb_struct_hash): use long.

Wed May 20 18:58:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c, vm_insnhelper.c: argument number is restricted to
	  int, and fixed overflow.

Wed May 20 18:34:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (zip_ary): should use long.

	* enumerator.c (inspect_enumerator): should use long.

Wed May 20 09:18:44 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_count): optimized for 1byte string count by
	  avoiding tr_setup_table().

Wed May 20 06:25:29 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_fast_mbclen): faster mbclen for strings known
	  to be valid.

	* string.c (enc_strlen): coderange specified version of
	  rb_enc_strlen().  use rb_enc_fast_mbclen() if coderange is 7bit
	  or valid.

	* string.c (str_gsub): use rb_enc_fast_mbclen().

	* string.c (rb_str_reverse, rb_str_split_m, rb_str_each_char,
	  scan_once): ditto.

Wed May 20 06:20:05 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#unlink): close first for Windows.  a
	  patch from Florian Frank.  [ruby-core:23505]

Wed May 20 00:13:38 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_codepoint_len): combine rb_enc_codepoint()
	  and rb_enc_codelen() in one function to reduce calls.

	* encoding.c (rb_enc_codepoint): compatibility function.

	* sprintf.c (rb_str_format): use rb_enc_codepoint_len().

	* string.c (rb_str_inspect, rb_str_upcase_bang,
	  rb_str_downcase_bang, rb_str_capitalize_bang,
	  rb_str_swapcase_bang, trnext, tr_trans, rb_str_delete_bang,
	  rb_str_squeeze_bang, rb_str_count, rb_str_split_m,
	  rb_str_each_line, rb_str_each_codepoint, rb_str_lstrip_bang,
	  sym_printable): ditto.

	* transcode.c (make_econv_exception): use rb_enc_mbc_to_codepoint()

Wed May 20 00:05:52 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (rb_attr): should preserve encoding info.
	  [ruby-dev:38498]

Tue May 19 22:54:35 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* time.c (time_minus): always return a Float.  [ruby-dev:38446]

	* time.c (time_to_r): new method.  [ruby-dev:38461]

Tue May 19 13:59:35 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (clone_method): add cast to remove warning from
	  rb_gc_write_barrier().

Tue May 19 13:54:15 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (struct_ivar_get): new function to avoid repeated
	  rb_intern() calls.

	* struct.c (rb_struct_iv_get): use struct_ivar_get()

	* struct.c (num_members): ditto.

	* struct.c (rb_struct_s_members): ditto.

	* class.c (rb_singleton_class): cache symbol to reduce calls to
	  rb_intern().

Tue May 19 07:52:05 2009  Tanaka Akira  <akr@fsij.org>

	* test/test_time.rb: make tests timezone independent.
	  reported by zunda.  [ruby-dev:38492]

Mon May 18 21:40:11 2009  Tanaka Akira  <akr@fsij.org>

	* lib/pathname.rb (Pathname#sub): suppress a warning.  [ruby-dev:38488]

Sun May 17 23:23:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (SRC_EXT): should be flat.
	  http://twitter.com/_tad_/status/1825862632

Sun May 17 23:05:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): VARIABLE_LIBPATH is always
	  defined, see its value instead.

Sun May 17 18:59:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (nd_line): NODE_LMASK is not needed.

	* node.h (NOEX_SAFE): made int.

Sun May 17 14:23:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (rb_parse_in_eval): returns true in true eval, not in
	  main.  [ruby-dev:38382]

	* parse.y (program): inherits dvars in eval or main.

Sun May 17 14:02:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_script): sets also VM toplevel program name.

	* ruby.c (process_options): no longer needs additional frame.

	* vm.c (rb_vm_get_sourceline): should not access out of bound.

Sun May 17 09:47:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (cmdline_options_init): initialize encodings.

	* ruby.c (add_modules, require_libraries, process_sflag):

	* ruby.c (process_sflag): not process twice.

	* ruby.c (moreswitches): get rid of possible overflow.

Sun May 17 09:31:05 2009  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (foletypelib_name): should return
	  encoded name corresponding to WIN32OLE.codepage.

Sun May 17 09:02:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): support for cygwin 1.7.  see
	  [ruby-core:23241].
	  gets rid of possible buffer overflow with realpath().

	* ruby.c (set_arg0): get rids of overrun.

Sat May 16 18:38:32 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb: add nil check.

Sat May 16 18:36:01 2009  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_maker_atom_feed.rb: suppress warnings.

Sat May 16 18:33:15 2009  Kouhei Sutou  <kou@cozmixng.org>

	* NEWS: add RSS::Maker.supported?(version).

Sat May 16 18:26:42 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb, test/test_parser_1.0.rb: fix foaf:Image
	  element causes parse error even if ignore_unknown_element mode.

Sat May 16 18:14:19 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker.rb, lib/rss/maker/0.9.rb,
	  test/test_maker_*.rb: add RSS::Maker.supported?

Sat May 16 18:12:39 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/content/*, lib/rss/dublincore/*: fix circular require.
	* test/test_maker_atom_feed.rb,
	  test/test_maker_atom_entry.rb: suppress warnings.

Sat May 16 18:07:17 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/feed.rb, test/test_maker_atom_feed.rb:
	  remove needless codes.

Sat May 16 18:05:07 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/entry.rb: fix a typo.

Sat May 16 18:02:57 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/feed.rb, test/test_maker_atom_entry.rb,
	  test/test_maker_atom_feed.rb: fix duplicated dc:date.
	  Reported by Kazuhiro NISHIYAMA. Thanks!!! [ruby-list:46014]

Sat May 16 18:02:16 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb, lib/rss/maker/1.0.rb, lib/rss/maker/feed.rb,
	  test/rss/test_maker_1.0.rb, test/rss/test_maker_atom_feed.rb:
	  RSS 1.0 and Atom feed maker treat maker.channel.language as
	  maker.channel.dc_language.

Sat May 16 17:57:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/lib/dl/callback.rb (DL#remove_callback_internal): ignore
	  unbound function.  [ruby-dev:38474]

Sat May 16 17:51:11 2009  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/rss_recent.rb, sample/rss/list_description.rb: use
	  UTF-8.

Sat May 16 17:47:55 2009  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb, test/rss/test_version.rb (RSS::VERSION):
	  0.2.5 -> 0.2.6.

Sat May 16 17:26:04 2009  Narihiro Nakamura  <authorNari@gmail.com>

	* iseq.c (rb_iseq_clone): use longlife object and insert write barrier.

	* vm_insnhelper.c (vm_cref_push): ditto.

	* vm_insnhelper.h (COPY_CREF): insert write barrier.

Sat May 16 13:49:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_autoload_load): gets rid of false warning.
	  [ruby-core:23466]

Sat May 16 10:59:54 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/drb/dhasenc.rb: add magic comment for encoding.

	* sample/mine.rb: ditto.

	* ext/tk/sample/tcltklib/sample1.rb: ditto.

Sat May 16 09:49:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (magic_comment_encoding): ignores unused emacs-style
	  encoding comment, as like Vim styles.  [ruby-core:23470]

Sat May 16 09:30:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* defs/keywords (reserved_word): made inline function static.
	  [ruby-core:23210]

	* parse.y (rb_reserved_word): ordinary function for ripper.

Sat May 16 09:19:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (magic_comment_encoding): use rb_compile_warning() to
	  show the currently parsing file name.  [ruby-core:23469]

Sat May 16 09:03:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_version): now version.h includes
	  include/ruby/version.h, so need to tell to cpp to see
	  $(srcdir)/include.  [ruby-core:23468]

Fri May 15 17:35:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shift, rb_ary_shift_m): clears unused elements.
	  [ruby-dev:38448]

Fri May 15 15:15:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_autoload_load): checks if iv_tbl is valid.
	  [ruby-dev:38456]

Fri May 15 11:17:48 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak (-version-): now version.h includes
	  include/ruby/version.h, so need to tell to cpp to check
	  $(srcdir)/include.
	  reported by KIMURA Koichi at http://www.kt.rim.or.jp/%7ekbk/zakkicho/09/zakkicho0905b.html#D20090514-6

Thu May 14 16:13:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_getpwuid): use rb_uid_t.  [ruby-dev:38443]

	* ext/stringio/stringio.c (strio_ungetbyte): encoding should no
	  be effective.

Thu May 14 10:17:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sample/test.rb (valid_syntax?): defaults to us-ascii.

Wed May 13 22:34:31 2009  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c: add longlife garbage collection. [ruby-dev:38423]
	  (NORMAL_HEAPS_USED): new macro.
	  (LONGLIFE_ALLOCATE_HEAPS_MIN): ditto.
	  (add_longlife_heaps_slot): new function.
	  (rb_newobj_from_longlife_heap): ditto.
	  (rb_newobj_longlife): ditto.
	  (rb_node_newnode_longlife): ditto.
	  (rb_gc_write_barrier): ditto.
	  (remembered_set_recycle): ditto.
	  (rb_gc_mark_remembered_set): ditto.
	  (clear_mark_longlife_heaps): ditto.
	  (gc_sweep_for_longlife): ditto.
	  (assign_heap_slot): new argument to longlife heaps slot.
	  (add_freelist): ditto.
	  (gc_sweep): avoid longlife heap slot. set longlife_collection
	  flag at add heap.
	  (rb_gc_force_recycle): avoid mark object and remembered_set
	  object.
	  (garbage_collect): add longlife collection.
	  (rb_gc_start): invoke longlife collection.
	  (gc_profile_record_get): for longlife collection profile.
	  (gc_profile_result): ditto.

	* include/ruby/intern.h (rb_gc_write_barrier): declared.

	* include/ruby/ruby.h (FL_REMEMBERED_SET): renamed from FL_RESERVED.

	* debug.c (FL_REMEMBERED_SET): ditto.

	* insns.def (setinlinecache): insert write barrier.

	* vm_insnhelper.c (vm_method_search): ditto.

	* set_relation (set_relation): use longlife object.

	* vm.c (vm_define_method): ditto.

	* vm_core.h (NEW_INLINE_CACHE_ENTRY): ditto.

	* vm_method.c (rb_add_method): ditto.

	* class.c (rb_add_method): ditto.

	* node.h (NEW_NODE_LONGLIFE): new macro.
	  (rb_node_newnode_longlife): declared.

Wed May 13 15:23:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/version.h: extracted the extensions interface and
	  the never-changeable info.

Wed May 13 03:20:47 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_init_1): unused variable removed.

Tue May 12 21:03:02 2009  Tanaka Akira  <akr@fsij.org>

	* time.c: support fixed UTC offset.  [ruby-dev:38326]
	  (leap_year_v_p): new macro.
	  (TIME_FIXOFF_P): new macro.
	  (TIME_SET_FIXOFF): new macro.
	  (time_init_0): renamed from time_init.
	  (time_set_utc_offset): new function.
	  (vtm_add_offset): new function.
	  (utc_offset_arg): new function.
	  (time_init_1): new function.
	  (time_init): call time_init_0 or time_init_1 according argc.
	  (validate_utc_offset): new function.
	  (time_localtime_m): new function.
	  (time_fixoff): new function.
	  (time_getlocaltime): take optional UTC offset argument.
	  (time_get_tm): support fixed UTC offset time.
	  (Init_Time): make Time#{initialize,localtime,getlocal} varargs.

	* strftime.c (rb_strftime): vtm->zone can be NULL now.

Tue May 12 18:23:40 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* yarvtest: removed because it's outdated.

Mon May 11 21:46:20 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: add semicolons to some grammar rules not terminated
	  with them.  a patch from Dave B in [ruby-core:23422].

Mon May 11 20:08:33 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (Init_IO): add constant File::NOATIME.  [ruby-core:23194]

Mon May 11 13:08:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb (rubylibdir): use rubylibprefix.  [ruby-dev:38426]

Mon May 11 08:37:04 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_coerce): support
	   coercing into Rational.   [ruby-core:23415]

Mon May 11 04:39:45 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/smtp.rb (Net::SMTP#check_auth_args): should not change
	  number of methods for the sake of compatibility.

Sun May 10 11:36:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_instance_p): new function to check if
	  the argument is an instance of DL::CFunc.

	* ext/dl/cptr.c (rb_dlptr_initialize, rb_dlptr_s_malloc): checks
	  if DL::CFunc.  [ruby-dev:38403].

	* ext/dl/lib/dl/cparser.rb (DL::CParser#parse_signature): strips
	  spaces.  based on a patch from Takashi Tamura in [ruby-dev:38398].

	* ext/dl/lib/dl/value.rb (DL::ValueUtil#wrap_arg): block must be
	  given if arg is not bound.  [ruby-dev:38404]

	* ext/dl/cfunc.c (rb_dlcfunc_instance_p): new function to check if
	  the argument is an instance of DL::CFunc.

Sat May  9 19:57:00 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_float.rb (TestFloat#test_sleep_with_Float): add a
	  test. see [ruby-core:23282]

Sat May  9 19:23:46 2009  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: use subsec instead of nsec.

Sat May  9 12:19:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c: 3rd argument of rb_hash_foreach() is VALUE.

	* hash.c (rb_any_hash, recursive_hash): use VALUE for hash.

Sat May  9 11:14:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (rb_f_catch): gets rid of issue with gcc 4.4.  a patch
	  from Alexey Froloff in [ruby-core:23398].  [ruby-core:22924]

Fri May  8 19:38:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_link0): removes waste dSYM directories left
	  when debug and universal-binary are enabled.

	* lib/mkmf.rb (check_sizeof): fixed wrong recurring result for
	  intrinsic types.

Fri May  8 10:14:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, configure.in, win32/Makefile.sub (RUBY_BASE_NAME):
	  program base name.  [ruby-dev:38241]

	* configure.in (--with-soname): base name of shared library.
	  [ruby-dev:38290]

Fri May  8 10:07:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_flatten_bang): clears temporary array.

Fri May  8 02:30:14 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (SortedSet#add): Do not require each newly added
	  element to be Comparable but to respond to <=>. [ruby-dev:38371]

Thu May  7 21:42:51 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rubyoptions.rb (test_indentation_check): add a test
	  for indentation check.  [ruby-dev:38382]

Thu May  7 16:40:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_flatten_bang): returns nil if nothing changed.
	  a patch from Marc-Andre Lafortune in [ruby-core:23382].

Thu May  7 14:26:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sample): negative sample number is invalid.
	  [ruby-core:23374]

Thu May  7 14:16:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c, include/ruby/encoding.h: fixed types.

	* include/ruby/encoding.h (rb_enc_nth): long is used for index.

Thu May  7 14:01:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (r_le): fixed types.

	* range.c (range_eql): fixed rdoc.

Thu May  7 13:10:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): should be rb_pid_t.

Wed May  6 16:50:20 2009  Tanaka Akira  <akr@fsij.org>

	* math.c (math_gamma): use a table for positive small integers.

Wed May  6 09:27:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.ja: code for THINK_C does not exist already.  [Bug #1435]

Wed May  6 05:33:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (CFLAGS, CXXFLAGS): strips extra spaces.

Tue May  5 11:29:07 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/ifchange: Fix: arguments which begin with minus sign may
	  parsed as options.  Because of older systems, don't use --
	  but use parentheses.

Tue May  5 10:42:28 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Update to JSON 1.1.4.

Tue May  5 07:22:37 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c: NOMAP is now multibyte direct map.

	* transcode.c: remove ASIS.

	* transcode_data.h: ditto.

	* tool/transcode-tb (ActionMap#generate_info): remove :asis.

	* tool/transcode-tb (ActionMap#generate_info): add :nomap0.

	* enc/trans/utf8_mac.trans: replace :asis by :nomap0.

Sat May  2 22:53:02 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (SortedSet): Fix document. [Bug #1429]

Sat May  2 10:34:29 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf8_mac-tbl.rb: don't use Unicode escape.

	* enc/trans/utf8_mac.trans: follow above.

Sat May  2 09:19:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (Init_Array): made #to_s an alias to #inspect to reduce
	  the result of recursive array.  a patch from ujihisa at
	  [ruby-dev:38362]

Fri May  1 16:50:05 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#merge): Only directly use the passed objects
	  @hash instance variable when self and the passed object are
	  instances of the same class. [Bug #118]

Fri May  1 16:44:11 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (SortedSet#add): Do not let an incomparable object
	  in. [Bug #118]

Fri May  1 13:18:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_intern.h (_longjmp): never return.  see [ruby-core:23241]

Fri May  1 01:31:19 2009  Tanaka Akira  <akr@fsij.org>

	* ext/extmk.rb: use RbConfig instead of Config.

	* instruby.rb: ditto.

	* lib/rubygems.rb: ditto.

	* test/rubygems/test_config.rb: ditto.

Thu Apr 30 21:23:30 2009  Tanaka Akira  <akr@fsij.org>

	* runruby.rb: use RbConfig::CONFIG instead of Config::CONFIG.

	* spec/default.mspec: ditto.

	* yarvtest/yarvtest.rb: ditto.

	* instruby.rb: ditto.

	* benchmark/report.rb: ditto.

	* benchmark/runc.rb: ditto.

	* tool/eval.rb: ditto.

	* test/rubygems/test_gem.rb: ditto.

	* test/rubygems/test_config.rb: ditto.

	* test/rubygems/test_gem_platform.rb: ditto.

Thu Apr 30 18:18:13 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/http.rb: documentation typo fixed.  [ruby-core:23335]

Thu Apr 30 15:27:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/utf8_mac.trans: get rid of a 1.9 feature for cross
	  compile.

Thu Apr 30 11:35:30 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_filesystem_encoding): Change filesystem_encoding of
	  Mac OS X to UTF-8.

Wed Apr 29 21:23:40 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/iso_2022_jp.h: add CP50221.

	* enc/trans/iso2022.trans: add converter for CP50221.

Wed Apr 29 15:22:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_join): recursive array has no meaning as path
	  name.  [ruby-core:23329]

Tue Apr 28 19:09:45 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/test_timeout.rb (TestTimeout#test_timeout): add a test.

Tue Apr 28 07:13:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pp.rb (Struct#pretty_print): coerce to a string since
	  anonymous class has name no longer.  [ruby-dev:38349]

Mon Apr 27 16:47:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_version): uses sed instead of grep if the
	  result is need, to get rid of GREP_OPTIONS.  [ruby-dev:38336]

Mon Apr 27 01:25:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_getc): use rl_getc_function if
	  possible, to get rid of hang up at EOF without a newline.

Sun Apr 26 23:19:32 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf8_mac.trans: Add converter for UTF8-MAC.

	* enc/trans/utf8_mac-tbl.rb: ditto.

	* test/ruby/test_econv.rb: tests for above.

Sun Apr 26 22:17:02 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/transcode-tb (ActionMap#each_firstbyte):
	  if :asis collides other mappings, use another.

	* tool/transcode-tb (ActionMap#generate_info):
	  add :asis for ASIS.

Sun Apr 26 21:59:43 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (ASIS): added for multi byte direct map.

	* transcode.c (transcode_restartable0): ditto.

Sun Apr 26 20:33:12 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/transcode-tb (ActionMap#generate_node):
	  Use ActionMap#gennode instead of generate_node
	  because of initialization.

Sun Apr 26 20:21:39 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* .gitignore: added.

Sun Apr 26 20:17:24 2009  Tanaka Akira  <akr@fsij.org>

	* lib/rake.rb: use RbConfig::CONFIG instead of Config::CONFIG.

	* lib/rbconfig/datadir.rb: ditto.

Sun Apr 26 19:30:29 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_arg): unused variable removed.

Sun Apr 26 18:35:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_reopen): keeps pathv for prep_stdio.  [ruby-dev:38131]

Sun Apr 26 15:13:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#parse_in_order): do not make an
	  option from non-option argument.  [ruby-dev:38333]

Sat Apr 25 19:11:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ac_cv_func_daemon): use daemon(3) only on *BSD.

	* process.c (proc_daemon): double fork to ensure not having ctty.
	  [ruby-core:23305]

Sat Apr 25 16:19:48 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (month_arg): extracted from time_arg.
	  (validate_vtm): ditto.

Sat Apr 25 16:03:21 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (TIME_COPY_GMT): new macro.
	  (time_s_at): use TIME_COPY_GMT.
	  (time_succ): ditto.

Sat Apr 25 15:54:04 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_mload): use TIME_SET_UTC.

Sat Apr 25 15:47:54 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_get_tm): take time_object instead of gmt.

Sat Apr 25 15:39:44 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_succ): refactored to avoid gmt variable.
	  (strftimev): use TIME_UTC_P.
	  (time_strftime): ditto.

Sat Apr 25 15:21:33 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (TIME_UTC_P): new macro.
	  (TIME_SET_UTC): ditto.
	  (TIME_LOCALTIME_P): ditto.
	  (TIME_SET_LOCALTIME): ditto.
	  (time_utc_p): use the above macro.
	  (time_localtime): ditto.
	  (time_localtime): ditto.
	  (time_gmtime): ditto.
	  (time_to_s): ditto.
	  (time_add): ditto.
	  (time_sec): ditto.
	  (time_min): ditto.
	  (time_hour): ditto.
	  (time_mday): ditto.
	  (time_mon): ditto.
	  (time_year): ditto.
	  (time_wday): ditto.
	  (wday_p): ditto.
	  (time_yday): ditto.
	  (time_isdst): ditto.
	  (time_zone): ditto.
	  (time_utc_offset): ditto.
	  (time_to_a): ditto.
	  (strftimev): ditto.
	  (time_strftime): ditto.
	  (time_mdump): ditto.

Thu Apr 23 01:30:37 2009  Akinori MUSHA  <knu@iDaemons.org>

	* ext/zlib/zlib.c (Zlib::GzipFile#path): New method.

Wed Apr 22 20:25:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_timespec): check out-of-range.  [ruby-core:23282]
	  [Bug #1396]

Wed Apr 22 19:33:13 2009  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time.parse): use year completion in Date._parse.

Wed Apr 22 11:12:15 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* time.c (GMTIME, LOCALTIME): should set result if not have *_r().

	* time.c (localtime_with_gmtoff): now always needed tmbuf.

Wed Apr 22 10:38:47 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* dir.c (glob_helper): C99(gcc)-ism.

	* time.c (find_time_t): GUESS macro needs the variable named ``result''
	  always.

Wed Apr 22 09:27:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (localtime_with_gmtoff): fixed cross function jump.

Wed Apr 22 03:06:56 2009  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time#rfc2822): pad leading zeros for year.
	  (Time#httpdate): ditto.
	  (Time#xmlschema): ditto.

Wed Apr 22 02:10:48 2009  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time#xmlschema): use subsec instead of nsec.

Wed Apr 22 01:27:38 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_arg): use the year argument as-is.  [ruby-dev:38194]

	* lib/time.rb (Time.parse): interpret small year 0..99 as 1950..2049.

Wed Apr 22 00:32:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (find_time_t): constified.

Wed Apr 22 00:11:19 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (leap_year_v_p): removed.

Tue Apr 21 23:52:45 2009  Tanaka Akira  <akr@fsij.org>

	* time.c: remove time_t restriction from Time class.

	* timev.h: new file to define struct vtm.

	* strftime.c: format struct vtm instead of struct tm.

	* ext/syck/rubyext.c (mktime_do): don't use time_t;

	[ruby-dev:38191]

Tue Apr 21 09:25:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_path, dir_each, glob_helper): use readdir_r() if
	  available.

Tue Apr 21 09:20:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (init_mkmf): needs default library path even if
	  cross compiling.

Tue Apr 21 07:07:45 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_push): bypass rb_ary_store().

Tue Apr 21 01:25:16 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigsub_int): subtraction without making internal
	  bignum values.

	* bignum.c (bigadd_int): ditto for addition.

	* bignum.c (bigtrunc): declare inline.

	* bignum.c (rb_quad_pack): fix condition.

Tue Apr 21 01:13:42 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (config.h): added TIMET2NUM and NUM2TIMET to match
	  the change in time.c

Mon Apr 20 20:29:04 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_split_m): faster processing on 7bit strings.

	* string.c (ascii_isspace): faster isspace() for 7bit strings.

Sun Apr 19 14:43:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): the order of local variables on stack is
	  undefined.  should use outermost VALUE for ruby_init_stack.

	* gc.c (ruby_get_stack_grow_direction, Init_stack): allows volatile
	  pointer.

	* thread_*.c (ruby_init_stack): ditto.

Sun Apr 19 13:17:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gem_prelude.rb (Gem::QuickLoader#push_gem_version_on_load_path):
	  check for requirement if the gem is installed.  a patch from
	  Kyosuke MOROHASHI at [ruby-dev:38020].

Sun Apr 19 01:39:17 2009  Tanaka Akira  <akr@fsij.org>

	* process.c (proc_seteuid_m): defined to use rb_f_notimplement if not
	  implemented.
	  (proc_setegid_m): ditto.

Sun Apr 19 01:03:56 2009  Tanaka Akira  <akr@fsij.org>

	* process.c (proc_setuid): use rb_f_notimplement if not implemented.
	  (proc_setgid): ditto.

Sat Apr 18 23:07:18 2009  Tanaka Akira  <akr@fsij.org>

	* ext/readline/readline.c: use rb_f_notimplement for methods not
	  implemented.

	* ext/openssl/ossl_engine.c: ditto.

	* ext/openssl/ossl_config.c: ditto.

	* ext/openssl/ossl_cipher.c: ditto.

	* ext/openssl/ossl_pkcs5.c: ditto.

	* ext/openssl/ossl_x509ext.c: ditto.

	* ext/socket/socket.c: ditto.

	* ext/socket/basicsocket.c: ditto.

	* ext/socket/ancdata.c: ditto.

	* ext/socket/unixsocket.c: ditto.

	* ext/iconv/iconv.c: ditto.

Sat Apr 18 21:07:34 2009  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c: use rb_f_notimplement for methods not
	  implemented.

Fri Apr 17 01:51:17 2009  Tanaka Akira  <akr@fsij.org>

	* node.h (rb_notimplement_body_p): declared.

	* vm_method.c (Init_eval_method): suppress a warning.

	* io.c (rb_io_fsync): use rb_f_notimplement if not implemented.
	  (rb_io_close_on_exec_p): ditto.
	  (rb_io_set_close_on_exec): ditto.
	  (rb_io_fcntl): ditto.
	  (rb_f_syscall): ditto.

	* dir.c (dir_tell): ditto.
	  (dir_seek): ditto.
	  (dir_s_chroot): ditto.

	* process.c (proc_getpgrp): ditto.
	  (proc_setpgrp): ditto.
	  (proc_getpgid): ditto.
	  (proc_setpgid): ditto.
	  (proc_setsid): ditto.
	  (proc_getpriority): ditto.
	  (proc_setpriority): ditto.
	  (proc_getrlimit): ditto.
	  (proc_setrlimit): ditto.
	  (p_sys_setuid): ditto.
	  (p_sys_setruid): ditto.
	  (p_sys_seteuid): ditto.
	  (p_sys_setreuid): ditto.
	  (p_sys_setresuid): ditto.
	  (p_sys_setgid): ditto.
	  (p_sys_setrgid): ditto.
	  (p_sys_setegid): ditto.
	  (p_sys_setregid): ditto.
	  (p_sys_setreuid): ditto.
	  (p_sys_setresgid): ditto.
	  (p_sys_issetugid): ditto.
	  (proc_getgroups): ditto.
	  (proc_setgroups): ditto.
	  (proc_initgroups): ditto.
	  (proc_daemon): ditto.
	  (rb_proc_times): ditto.

	* file.c (rb_file_s_lchown): ditto.
	  (rb_file_s_link): ditto.
	  (rb_file_s_symlink): ditto.
	  (rb_file_s_readlink): ditto.
	  (rb_file_s_truncate): ditto.
	  (rb_file_truncate): ditto.

Fri Apr 17 00:53:47 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/cgi/core.rb (read_multipart): When path is not defined,
	  define local_path as a method always returning nil instead of
	  aliasing.  This is because StringIO#path no longer exists.

Fri Apr 17 00:45:09 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* dir.c (bracket): fix escape handling for range character in bracket
	  of fnmatch pattern.  e.g., '[a\-c]' should not match 'b'.

Thu Apr 16 23:09:03 2009  Tanaka Akira  <akr@fsij.org>

	* class.c (rb_define_method_id): use rb_define_notimplement_method_id
	  if rb_f_notimplement is given.
	  (rb_define_protected_method): ditto.
	  (rb_define_private_method): ditto.
	  (rb_define_method): use rb_define_method_id.

	* include/ruby/intern.h (rb_f_notimplement): declared.
	  (rb_define_notimplement_method_id): declared.

	* proc.c (method_inspect): show not-implemented.

	* vm_method.c (notimplement_body): new variable.
	  (rb_notimplement_body_p): new function.
	  (rb_method_boundp): return false if not implemented.
	  (rb_f_notimplement): new function.
	  (rb_define_notimplement_method_id): new function.

	* process.c (rb_f_fork): use rb_f_notimplement if not implemented.

	* file.c (rb_file_s_lchmod): use rb_f_notimplement if not implemented.

Wed Apr 15 20:24:49 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (rb_ary_flatten): flatten(0) works as Array#dup.
	  [ruby-core:23168]

	* test/ruby/test_array.rb: add a test for above.

Wed Apr 15 11:53:35 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (fnmatch_helper): use rb_enc_precise_mbclen and
	  fail if bytes are invalid. [ruby-dev:38307]

Tue Apr 14 18:11:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (bracket): if same in bytes, path is matching.
	  [ruby-dev:38305]

Mon Apr 13 17:21:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): scan coderange incrementally.

Mon Apr 13 11:35:55 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (rb_str_format): optimize previous commit.
	  [ruby-list:45954]

Mon Apr 13 10:58:54 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (rb_str_format): check encoding compatibility only on
	  real parts.

Sun Apr 12 19:54:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (bracket, fnmatch_helper): compare bytewise first, to get
	  rid of invalid byte sequence.  [ruby-dev:38303]

Sat Apr 11 08:45:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): phony ruby target needs empty command.

Fri Apr 10 11:32:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (up): updates timestamp file.

Fri Apr 10 04:54:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): info-program needs common.mk.

Fri Apr 10 03:46:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_INSTALL_NAME): use --program-transform-name.

	* instruby.rb, mkconfig.rb: deal with --program-transform-name
	  better.  now supports s, y commands and single addressing.

Thu Apr  9 23:59:11 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in: don't override the rule for ruby.

Wed Apr  8 21:58:12 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (rb_str_dump): buffer length plus one byte for null
	  terminator.  [ruby-dev:38294]

	* test/ruby/test_m17n.rb (test_str_dump): add a test for above.

Wed Apr  8 20:08:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_rstrip_bang): should not sign-expand non-ascii.
	  [ruby-core:23158]

Wed Apr  8 17:29:29 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_chop_bang): reset coderange. [ruby-core:23155]

Wed Apr  8 14:00:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (what_type?): fixed typo, and refined for member of
	  aggregation types.

	* lib/mkmf.rb (Logging.postpone): copy postponed output always.

Wed Apr  8 09:45:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_SO): removed redundant additional version
	  numbers.

Tue Apr  7 13:35:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (info): shows configured names.

	* configure.in (Makefile): works even if RUBY_INSTALL_NAME
	  contains macro.

	* configure.in (LIBRUBY_DLDFLAGS): compatibility version is
	  ruby_version.

	* configure.in (RUBY_REPLACE_TYPE): defines type modifier prefix
	  for printf.

Tue Apr  7 02:27:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_DEFINT): should pass includes to
	  AC_CHECK_SIZEOF and RUBY_CHECK_SIZEOF.

	* configure.in (CFLAGS, CXXFLAGS): need ARCH_FLAG for universal
	  binary.

Tue Apr  7 01:08:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_to_s): reduce fragments if no precision lost.
	  c.f. [ruby-core:23075]

Mon Apr  6 23:16:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (CFLAGS, CXXFLAGS): override with $cflags and
	  $cxxflags if not given.  [ruby-core:23130]

Mon Apr  6 19:26:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (utime_failed): refined the error message for EINVAL on
	  DOSISH platforms, where it may fail depending on filesystems.
	  see [ruby-dev:38277].

Mon Apr  6 16:38:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (sys_fail2, rb_file_s_readlink, BUFCHECK, rmext),
	  (rb_file_s_basename): get rid of overflow.

Mon Apr  6 15:11:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (int_chr): checks overflow.

Mon Apr  6 10:49:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/stringio/test_stringio.rb (test_path): StringIO#path is no
	  longer defined.  [ruby-dev:38254]

Mon Apr  6 10:47:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_path): removed.  [ruby-dev:38254]

Sun Apr  5 18:02:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_fd_resize): does nothing on Win32.

Sat Apr  4 17:05:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (RB_NUM_COERCE_FUNCS_NEED_OPID): macro to
	  check compatibility.  [ruby-dev:38162]

Sat Apr  4 07:38:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb (sitearch): default to arch.

Fri Apr  3 14:02:42 2009  Akinori MUSHA  <knu@iDaemons.org>

	* lib/irb/completion.rb (IRB::InputCompletor::Operators): Add
	  overloadable negative operators.

	* lib/irb/ruby-lex.rb (RubyLex#lex_init): Support overloadable
	  negative operators.

	* lib/irb/ruby-lex.rb (RubyLex#identify_identifier): Minus signs
	  need to be escaped in regexp character class.

	* misc/ruby-mode.el (ruby-font-lock-keywords, ruby-parse-partial):
	  Support overloadable negative operators.

Fri Apr  3 12:45:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: quotes arguments with spaces always.

Thu Apr  2 14:50:06 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/getoptlong.rb: remove unused rdoc/usage from example.
	   [ruby-core:23098]

Thu Apr  2 07:42:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.h): updated.

Wed Apr  1 20:37:49 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in (rb_cv_fork_with_pthread): fail if the child process
	  fail.

Wed Apr  1 19:46:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): support for parallel make.  a
	  patch from Takuto Matsuu at [ruby-dev:38220].

Wed Apr  1 19:39:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_LDSHARED): use $(CC) instead of cc.
	  a patch from Wataru Kimura at [ruby-dev:38225].

Wed Apr  1 18:53:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): should not #include inside a
	  function, since headers may have declarations.
	  c.f. [ruby-core:23095]

Wed Apr  1 18:44:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: ignores version numbers in config.status.  replaces
	  all $$s in program_transform_name.

Wed Apr  1 15:12:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (.c.i): use CPP instead of CC, since gcc -E can'
	  work with multiple -arch options.

Wed Apr  1 13:46:20 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (rb_thread_fd_select): new function to call select
	  using rb_fdset_t.

	* io.c (select_internal): use rb_thread_fd_select instead of
	  rb_thread_select.  based on the patch from Kengo Matsuyama.
	  [ruby-dev:38221]

Wed Apr  1 13:16:19 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (rb_f_sleep): RDoc disambiguation.  [ruby-talk:332632]

Tue Mar 31 15:17:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: fixed the help strings for the header and library
	  dir switches, and updated to use AS_HELP_STRING.  patches from
	  Richard Brown, c.f. [ruby-core:23067].

Mon Mar 31 08:18:57 2009  James Edward Gray II  <jeg2@ruby-lang.org>

	* test/csv/test_interface.rb, test/csv/test_serialization.rb:
	  Trying more fixes some failing tests on Windows.

Mon Mar 30 19:04:25 2009  Tanaka Akira  <akr@fsij.org>

	* .gdbinit (rp): show negative fixnum correctly.

Mon Mar 30 12:12:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (eval_string_with_cref): replaces the message if
	  frozen.  [ruby-dev:38208]

Mon Mar 30 01:00:20 2009  James Edward Gray II  <jeg2@ruby-lang.org>

	* test/csv/test_interface.rb: Trying a fix for some failing tests
	  on Windows.

Sun Mar 29 08:59:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pathname.rb (Pathname#relative_path_from): compares path
	  components according to system default case-sensitiveness.
	  [ruby-core:22829]

Sat Mar 28 11:10:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ruby.imp): all symbols in static library need to be
	  exported, so that encoding-extensions can be loaded.  based on a
	  patch from Yutaka Kanemoto <kinpoco AT gmail.com> in
	  [ruby-talk:332282].

Sat Mar 28 08:49:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): checks if named argument given twice.

	* sprintf.c (GETNAMEARG): remembers named arg is used, to get rid
	  of too many arguments warning.

Sat Mar 28 03:16:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (link_command, cc_command, cpp_command): should no
	  override extout defined in extmk.rb.

Fri Mar 27 12:56:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (what_type?): checks more restrictively, and
	  supports universal binary.

Fri Mar 27 01:33:37 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_cmp): negate the result of reverse comparison.

Fri Mar 27 01:19:50 2009  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_cmpint): FIX2INT may fail on LP64 platforms.

Thu Mar 26 12:22:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/yaml/rubytypes.rb (String#is_binary_data?): TAB would be
	  usually considered to be included in text data.

	* lib/rdoc/parser.rb (RDoc::Parser.binary?): blksize may be nil
	  and is irrelevant to whether a file is binary.  copied from
	  above since TAB and newlines would be usually considered to be
	  included in text data.

Thu Mar 26 11:33:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths): considers
	  --program-prefix and --program-suffix.  reapplied r19923.

Wed Mar 25 07:45:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (target_alias): replaces cpu with universal too.

	* configure.in (target): replaces cpu with arch by --with-arch.

	* mkconfig.rb (TOPDIR): chops arch in config instead of
	  RUBY_PLATFORM which varies on universal_binary.

	* mkconfig.rb (MAJOR, MINOR, TEENY): reads from version.h always.

Tue Mar 24 19:23:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_SIZEOF): need to include $4.

Tue Mar 24 17:08:52 2009  Akinori MUSHA  <knu@iDaemons.org>

	* io.c (rb_io_inspect): Cannot access fptr->fd if fptr is NULL.
	  This fixes a coredump caused by: ruby -e "class X < IO; def
	  initialize; end; end; p X.new.inspect"

Mon Mar 23 22:01:00 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_timespec): use NUM2TIMET.
	  (time_s_at): ditto.

Mon Mar 23 21:52:26 2009  Akinori MUSHA  <knu@iDaemons.org>

	* process.c (Init_process): Better patch for eliminating an
	  "unused variable".

Mon Mar 23 21:41:14 2009  Akinori MUSHA  <knu@iDaemons.org>

	* ext/dbm/dbm.c (fdbm_initialize): Make the file variable
	  volatile, because FilePathValue() currently does not protect the
	  given variable from GC. (Probably it should)

	* ext/sdbm/init.c (fsdbm_initialize): Ditto.

Mon Mar 23 19:22:14 2009  Akinori MUSHA  <knu@iDaemons.org>

	* file.c (rb_file_s_lstat): Back out.

Mon Mar 23 18:54:57 2009  Akinori MUSHA  <knu@iDaemons.org>

	* file.c (rb_file_s_stat, rb_file_s_lstat): Remove repeated type
	  checks.

Mon Mar 23 14:57:48 2009  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (init_heap): set default to heap slots length
	  if HEAP_OBJ_LIMIT is larger than HEAP_MIN_SLOTS. [Bug #1310]
	  (set_heaps_increment): increment next_heaps_length if
	  next_heaps_length and heaps_used are same.

Mon Mar 23 14:32:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn): use original command if not found.

Mon Mar 23 06:51:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend (link_so): replaces $(TARGET) with basename of the
	  target.  [ruby-talk:330286]

Sun Mar 22 14:51:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): use NULL as
	  application name for batch files.

Sat Mar 21 15:54:41 2009  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.c (write_would_block): defined.
	  (read_would_block): defined.
	  (ossl_start_ssl): add nonblock argument.
	  (ossl_ssl_connect): follow ossl_start_ssl change.
	  (ossl_ssl_connect_nonblock): new method.
	  (ossl_ssl_accept): follow ossl_start_ssl change.
	  (ossl_ssl_accept_nonblock): new method.
	  (ossl_ssl_read_internal): use write_would_block and
	  read_would_block.
	  (ossl_ssl_write_internal): ditto.

Sat Mar 21 08:19:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_exec): prints error message only on platforms
	  neither close-on-exec nor spawnv is supported.

Sat Mar 21 08:17:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): omit program name
	  if actual program path is found.  [ruby-core:22960]

Sat Mar 21 07:25:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): should pass program name even if multiple
	  arguments are given.  fix for TestProcess::test_argv0.

Sat Mar 21 02:37:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/lib/openssl/buffering.rb
	  (OpenSSL::Buffering#write_nonblock): new method.

	* ext/openssl/ossl_ssl.c (ossl_ssl_write_nonblock): new method.
	  (ossl_ssl_write_internal): defined.
	  (ossl_ssl_write): use ossl_ssl_write_internal.

Fri Mar 20 18:25:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (errmap): added ERROR_MOD_NOT_FOUND.

Fri Mar 20 09:22:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (libprefix): must not append "lib" after $(libdir),
	  when load_relative is not used on darwin.  a patch from Kenta
	  Murata at [ruby-dev:38182].

Thu Mar 19 20:29:40 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_mWaitReadable): defined.
	  (rb_mWaitWritable): defined.
	  (io_getpartial): extend IO::WaitReadable on EWOULDBLOCK and EAGAIN.
	  (rb_io_write_nonblock): extend IO::WaitWritable on EWOULDBLOCK and
	  EAGAIN.

	* error.c (make_errno_exc): extracted from rb_sys_fail.
	  (rb_mod_sys_fail): new function.

	* include/ruby/ruby.h (rb_mod_sys_fail): declared.
	  (rb_mWaitReadable): declared.
	  (rb_mWaitWritable): declared.

	* ext/socket/init.c (rsock_s_recvfrom_nonblock): extend
	  IO::WaitReadable on EWOULDBLOCK and EAGAIN.
	  (rsock_s_accept_nonblock): extend IO::WaitReadable on EWOULDBLOCK,
	  EAGAIN, ECONNABORTED and EPROTO.

	* ext/socket/socket.c (sock_connect_nonblock): extend IO::WaitWritable
	  on EINPROGRESS.

	* ext/socket/ancdata.c (bsock_sendmsg_internal): extend
	  IO::WaitWritable on EWOULDBLOCK and EAGAIN.
	  (bsock_recvmsg_internal): extend IO::WaitReadable on EWOULDBLOCK and
	  EAGAIN.

	* ext/openssl/ossl_ssl.c (ossl_ssl_read_internal): raise SSLError
	  extended by IO::WaitReadable/IO::WaitWritable on
	  SSL_ERROR_WANT_READ/SSL_ERROR_WANT_WRITE.

	* ext/openssl/ossl.c (ossl_make_error): extracted from ossl_raise.
	  (ossl_exc_new): new function.

	* ext/openssl/ossl.h (ossl_exc_new): declared.

	* lib/net/protocol.rb (rbuf_fill): rescue IO::WaitReadable and
	  IO::WaitWritable.

	  [ruby-core:22539], [ruby-dev:38140]

Thu Mar 19 18:49:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_SIZEOF): allows qualified name.

	* configure.in (RUBY_REPLACE_TYPE): checks more strictly.

	* configure.in (struct stat.st_size, struct stat.st_blocks),
	  (struct stat.st_ino): check for size.

	* lib/mkmf.rb (check_sizeof): allows qualified name.

	* file.c (rb_stat_ino, rb_stat_blocks): check by size.

Wed Mar 18 16:59:48 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/test_syslog.rb (TestSyslog#test_open): check
	  param after block again. because detect not to call block.

Wed Mar 18 16:54:04 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* ext/socket/ancdata.c: not use pktinfo.ipi_spec_dst if not defined
	* ext/socket/extconf.rb: define HAVE_IPI_SPEC_DST

Wed Mar 18 16:38:11 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/test_syslog.rb (TestSyslog#test_open): check
	  block parameter in block. [ruby-dev:38180]

Wed Mar 18 12:48:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (report_bug): rb_bug can be caused by extension
	  libraries.

Wed Mar 18 02:41:33 2009  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (open_server_inaddr_any): fixed multiple network
	  families problem. a patch from Charl Matthee at [ruby-core:21033].

Tue Mar 17 21:42:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot (package): creates .revision.time and passes
	  CHDIR to create prerequisite files.

Tue Mar 17 18:00:55 2009  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (Enumerator#{each_,}{with_index,with_object}): Fix
	  a bug where any parameter but the first one is dropped even if
	  multiple values are yielded with. [Bug #1198]

Tue Mar 17 14:25:16 2009  Tanaka Akira  <akr@fsij.org>

	* lib/pathname.rb (Pathname#sub): set $~ in block.binding.
	  [ruby-dev:38173]

Tue Mar 17 13:48:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.h): added RUBY_COREDLL.

	* ext/dl/handle.c (rb_dlhandle_initialize): returns msvcrt if libc
	  or RUBY_COREDLL is given.  [ruby-core:22828]

Tue Mar 17 10:29:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c, dln.c, parse.y, re.c, ruby.c, sprintf.c, strftime.c,
	  string.c, util.c, variable.c: use strlcpy, memcpy and snprintf
	  instead of strcpy, strncpy and sprintf.

Mon Mar 16 17:15:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/dl/test_win32.rb (Win32API): enclosed by DL::TestWin32.
	  [ruby-core:22827]

Mon Mar 16 16:37:22 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/tcltklib.c (eventloop_sleep, lib_eventloop_core),
	  (lib_watchdog_core): tv_usec is not time_t.

Mon Mar 16 12:30:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (REVISION_H): keeps timestamp of revision.h.
	  [ruby-core:22900]

	* tool/ifchange, win32/ifchange.bat: extended --timestamp option.

Mon Mar 16 09:28:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.mk, win32/Makefile.sub: added preprocessing rules.

Sun Mar 15 12:34:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/minitest/test_mini_test.rb: fixed tests depending on the
	  detail of floating point representation.

Sun Mar 15 12:01:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/installer.rb (Gem::Installer#shebang): fix for env
	  shebang.

Sun Mar 15 11:15:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h ({RSTRING,RBIGNUM}_EMBED_LEN_MAX): made int.

	* include/ruby/ruby.h (OBJ_{TAINTED,UNTRUSTED,FROZEN}): return int.

	* include/ruby/encoding.h (ENC_CODERANGE): ditto.

Sun Mar 15 11:11:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_hash_uint, rb_hash_start, rb_hash_end): use VALUE
	  rather than unsigned int.

Sun Mar 15 11:00:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): stop the timer thread before exec.

Sun Mar 15 09:17:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (.y.c): use SRC_FILE which contains slashes instead of
	  backslashes.  [ruby-core:22891]

Sun Mar 15 08:26:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (srcs-ext): creates ext/dl/callback/callback.c also.

Sun Mar 15 03:29:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (SAVED_GROUP_ID, p_gid_switch): should be rb_gid_t.

Sun Mar 15 02:53:13 2009  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_subpat): accept capture name.
	  (rb_str_aref): follow above change.
	  (rb_str_aref_m): pass the 2nd argument to rb_str_subpat.
	  (rb_str_subpat_set): accept capture name.
	  (rb_str_aset): follow above change.
	  (rb_str_partition): ditto.
	  (rb_str_aset_m): pass the 2nd argument to rb_str_subpat_set.

	* include/ruby/intern.h (rb_reg_backref_number): declared.

	* re.c (rb_reg_backref_number): defined.

	  [ruby-core:21057]

Sun Mar 15 02:09:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (bmcall): should not uninitialized variable.  a patch from
	  pegacorn at [ruby-dev:38169].

Sat Mar 14 18:25:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_scan_oct, ruby_scan_hex): use size_t.

Sat Mar 14 18:18:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (rb_proc_call, rb_node_arity, bmcall, curry): checks
	  overflow.

	* proc.c (rb_proc_parameters): unnamed_parameters() expects in
	  not VALUE.

Sat Mar 14 17:54:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_each_words): assume no string exceeds INT_MAX.

Sat Mar 14 15:59:04 2009  Tanaka Akira  <akr@fsij.org>

	* process.c (rb_spawn_internal): use int variable for status.

Sat Mar 14 14:45:51 2009  Tanaka Akira  <akr@fsij.org>

	* process.c (rb_f_system): use rb_pid_t for pid.
	  (rb_spawn_internal): local variable renamed.

Sat Mar 14 14:16:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strdup, Balloc, rv_alloc): use size_t.

Sat Mar 14 13:53:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_qsort): the result of cmp must be signed, so ge
	  rid of reuse of a variable.

Sat Mar 14 10:56:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (init_funcname_len, dln_find_exe_r, dln_find_file_r): use
	  size_t.

	* file.c (rb_stat_inspect, file_expand_path): ditto.

	* util.c (ruby_qsort): ditto.

Sat Mar 14 10:39:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (CXX_EXT): checks for case-sensitive filesystem with
	  FNM_SYSCASE rather than build_os.

Fri Mar 13 23:03:40 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (wait_connectable0): remove unreachable code.

Fri Mar 13 23:00:02 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in (RUBY_CHECK_SIZEOF): pass [include] to AC_CHECK_SIZEOF.

Fri Mar 13 20:58:11 2009  Tanaka Akira  <akr@fsij.org>

	* dln.c (dln_find_1): compare fspace in size_t world.

Fri Mar 13 18:58:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (CFLAGS, CXXFLAGS): moved after warnflags.

Fri Mar 13 18:10:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (rb_throw_obj): inverted call flow.  [ruby-core:22872]

Fri Mar 13 17:04:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (bool): not define to get rid of conflict
	  against curses.

Fri Mar 13 16:45:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/openssl_missing.h (i2d_of_void): cast for callbacks.
	  [ruby-core:22860]

	* ext/openssl/ossl_engine.c (ossl_engine_s_by_id): suppress a
	  warning.

	* ext/openssl/ossl_ssl.c (ossl_sslctx_flush_sessions): time_t may
	  be larger than long.

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_get_time),
	  (ossl_ssl_session_get_timeout): use TIMET2NUM() to convert
	  time_t.

Fri Mar 13 15:10:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_x509ext.c (ossl_x509ext_set_value): should use
	  OPENSSL_free instead of free.  a patch from Charlie Savage at
	  [ruby-core:22858].

Fri Mar 13 21:11:51 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/sdbm/_sdbm.c: should include "ruby/defines.h" as well for
	  prototypes of compatibility functions on Win32 platform.
	  [ruby-core:22870]

Fri Mar 13 10:42:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (AC_HEADER_STDBOOL): added.

	* include/ruby/ruby.h (NUM2INT, rb_special_const_p): returns true
	  and false instead of Qtrue and Qfalse for platforms where VALUE
	  is bigger than int.

	* gc.c (gc_stress_set), ext/openssl/ossl_asn1.c (decode_bool): go
	  rid of variables named `bool'.

Fri Mar 13 10:16:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (struct stat.st_size): may be huge.

Fri Mar 13 09:30:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (bigfixize): zero length Bignum is 0.

Fri Mar 13 09:17:12 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/fileutils.rb (FileUtils#fu_get_gid): stringify group
	  argument before making regexp match.  [ruby-dev:38155]

Fri Mar 13 08:06:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (rv_strdup): macro to duplicate nul-terminated string.
	  [ruby-core:22852]

Thu Mar 12 22:41:41 2009  Tanaka Akira  <akr@fsij.org>

	* ext/openssl: suppress warnings.

	* ext/openssl/ossl.h (OSSL_Debug): don't use gcc extension for
	  variadic macro.

Thu Mar 12 22:29:36 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (WARNFLAGS): warning 4996 is only in VC++8 or
	  later.

Thu Mar 12 22:14:01 2009  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_def_const): use INT2NUM because
	  OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG doesn't fit into Fixnum.

Thu Mar 12 18:16:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c, bignum.c, dln.c, error.c, gc.c, io.c, marshal.c,
	  numeric.c, pack.c, strftime.c, string.c, thread.c, transcode.c,
	  transcode_data.h, util.c, variable.c, vm_dump.c,
	  include/ruby/encoding.h, missing/crypt.c, missing/vsnprintf.c:
	  suppress VC type warnings.  [ruby-core:22726]

	* marshal.c (div0), numeric.c (infinite_value): new functions to
	  get rid of VC division by 0 warnings.

	* st.c: use st_index_t for indexes instead of int.

	* vm.c (rb_vm_get_sourceline), vm_insnhelper.c (vm_throw): use
	  rb_num_t.

Thu Mar 12 09:30:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_SIZEOF): if same size type is found, no
	  more calculation is needed.

	* configure.in (RUBY_DEFINT): falls back to RUBY_CHECK_SIZEOF if
	  size is not immediate.

Thu Mar 12 09:24:24 2009  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h: suppress warnings of overflow.

Thu Mar 12 09:15:14 2009  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h: suppress warnings of overflow.

Thu Mar 12 05:49:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): added some default flags,
	  pointer-arith, write-strings and shorten-64-to-32, but suppress
	  unused-parameter and missing-field-initializers, if possible.

	* configure.in (RUBY_CHECK_HUGE): checks whether a value range is
	  larger than long.

	* file.c (rb_stat_blocks): struct stat.st_blocks may be larger
	  than long.

	* io.c (copy_stream_fallback_body): off_t may be larger than long.

	* iseq.c (rb_iseq_disasm): RSTRING_LEN() returns long.

	* process.c (rb_f_sleep): time() needs time_t.

	* random.c (fill_random_seed): enclosed conditionally used
	  variables.

	* thread_pthread.c (ruby_init_stack): range of rlim_cur may be
	  larger than int.

	* missing/vsnprintf.c (BSD_vfprintf): commented out code which has
	  no effect at all.

Thu Mar 12 02:10:57 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in: strip spaces from ruby_version.
	  Sun C 5.9 SunOS_i386 Build47_dlight 2007/05/22 generates
	  `ruby_version= 1 "." 9 "." 1'.

Thu Mar 12 01:18:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_seek): use long for seekdir().

Thu Mar 12 01:08:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/ytab.sed: replaces backslashes with slash for nmake.

Wed Mar 11 21:23:06 2009  Tanaka Akira  <akr@fsij.org>

	* time.c (time_mload): don't clear tm_mday.

Wed Mar 11 20:13:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/handle.c (rb_dlhandle_sym): RTLD_NEXT is not for symbol
	  name.   [ruby-dev:38150]

Wed Mar 11 17:26:38 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/win32/lib/Win32API.rb: call by :stdcall as default.
	  [ruby-core:22826]

Wed Mar 11 13:27:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stack_type): uses VALUE which is able to be stored
	  parser stack.

Wed Mar 11 13:22:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (init_env): set TMPDIR if none of TMPDIR, TMP,
	  TEMP is set.

	* win32/win32.c (rb_w32_telldir, rb_w32_seekdir): should use long,
	  as defined by SUSv3.

Wed Mar 11 13:03:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/handle.c (rb_dlhandle_sym): fixed heap corruption.
	  [ruby-core:22822]

Wed Mar 11 06:12:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): expands libpath and removes
	  last /lib.

Wed Mar 11 04:47:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_to_i, time_hash): time_t may be bigger than long
	  and int.

	* time.c (time_timeval, rb_time_timeval, obj2nsec, time_strftime),
	  (time_mdump, time_mload): suppress warnings.

	* win32/Makefile.sub (config.h): added TIMET2NUM and NUM2TIMET.

Wed Mar 11 04:29:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c: suppress warnings.  based on a patch from Charlie
	  Savage at [ruby-core:22804].

Wed Mar 11 04:22:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (sig_trap): suppress warnings.

Tue Mar 10 20:07:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (WARNFLAGS): uses -wd4996 instead of
	  CRTDEFFLAGS.  cf. [ruby-core:22725]

Tue Mar 10 19:58:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (strcasecmp, strncasecmp): use _ prefixed
	  versions to suppress warnings.

	* ext/dl/callback/mkcallback.rb (DLTYPE[FLOAT]): cast to suppress
	  warnings.  [ruby-core:22792]

	* array.c, bignum.c, gc.c, numeric.c, string.c, util.c, insns.def,
	  missing/crypt.c, missing/vsnprintf.c, : suppress warnings.
	  [ruby-core:22792]

Tue Mar 10 13:45:54 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (LDFLAGS): moved -link to TRY_LINK, LINK_SO
	  and so on.  based on a patch by Charlie Savage at
	  [ruby-core:22794]

	* win32/Makefile.sub (config.h): passes LDFLAGS to rbconfig.rb so
	  that extconf.rb could refer it.  [ruby-core:22725]

Tue Mar 10 11:36:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (prepare_iseq_build): too few arguments to function
	  rb_ary_tmp_new().

Tue Mar 10 10:53:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (rb_iseq_compile_with_option): argument may be converted.

Tue Mar 10 04:56:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (MINIRUBY): keep macro into Makefile.

	* configure.in (RUBY_CHECK_SIZEOF): fix for fallback.

	* configure.in (MANGLED_PATH): defines for RUBYLIB_PREFIX.

	* ruby.c (ruby_init_loadpath_safe): uses string as buffer.

	* symbian/setup (config_h): defines MANGLED_PATH.

Tue Mar 10 03:48:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/callback/depend: fix for parallel build.

	* ext/dl/callback/extconf.rb: callback.h is no longer created.

	* ext/dl/callback/mkcallback.rb: creates main source first.

	* ext/dl/callback/extconf.rb ($distcleanfiles): added callback.c.

Tue Mar 10 00:06:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (load_relative): new option to enable load path
	  relative to libruby_so.

	* ruby.c (ruby_init_loadpath_safe): added the case using dladdr().

Mon Mar  9 16:49:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake: updated to rake code to rake-0.8.4 source code base.

Mon Mar  9 16:03:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/installer.rb (Gem::Installer#initialize): env may
	  not be under /usr/bin.

	* lib/rubygems/installer.rb (Gem::Installer#shebang): uses /bin/sh
	  if shebang has any options, since env shebang trick does no
	  work with options.

Mon Mar  9 15:19:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (manpages): use basename to compare and for Tempfile.

Mon Mar  9 14:55:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (default gems): installs default gemspecs.

Mon Mar  9 14:48:08 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (OPTFLAGS): simplified. see [ruby-core:22725]

Mon Mar  9 14:33:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb: prints names of the directories where files are
	  installed to.

Mon Mar  9 02:25:54 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_proc.rb: add some tests.

Mon Mar  9 01:38:00 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_enum.rb: add some tests.

Mon Mar  9 01:12:37 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_object.rb: add a test for Object#method_missing.

Mon Mar  9 01:11:17 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_file_exhaustive.rb: add tests for File#size and
	  File.absolute_path.

Sun Mar  8 23:02:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (LDFLAGS): always prepends -link.

Sun Mar  8 11:39:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_SIZEOF): dirty hack to compute multiple
	  sizeof, for apple's universal binary.

Sat Mar  7 22:06:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (universal_binary): checks if sizes are same on all
	  architectures.

Sat Mar  7 18:45:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: checks if cd really succeeded.

Sat Mar  7 14:24:47 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in: don't use CONFIG_SHELL for testing shell feature in
	  Makefile.

Sat Mar  7 14:07:31 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in: fix the location of cdcmd.

Sat Mar  7 13:52:01 2009  Tanaka Akira  <akr@fsij.org>

	* configure.in: the shell which runs configure may be different from
	  the shell for make.  configure likes bash but Makefile specifies
	  SHELL=/bin/sh.

Sat Mar  7 12:31:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/erb/test_erb.rb: reverted space sensitive test results.

	* test/rdoc/test_rdoc_parser_c.rb: ditto.

	* test/rdoc/test_rdoc_ri_default_display.rb: ditto.

Fri Mar  6 23:35:59 2009  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb (SecureRandom.urlsafe_base64): add optional
	  argument to add padding.

Fri Mar  6 19:25:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_LIB_VERSION_STYLE): sets full or minor style
	  not to show RUBY_VERSION_MAJOR and so on.

	* version.h (RUBY_LIB_VERSION): makes from RUBY_LIB_VERSION_STYLE.

	* configure.in, Makefile.in, win32/Makefile.sub (CHDIR): cd using
	  physical directory.

	* Makefile.in (update-mspec): split from update-rubyspec.

	* win32/Makefile.sub (update-{rubyspec,mspec}): added.

Fri Mar  6 14:28:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, win32/Makefile.sub (INSNS): moved variable
	  definition before rule.

Fri Mar  6 13:47:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake/loaders/makefile.rb (Rake::MakefileLoader#load): deals with
	  escaped spaces.  incorporated from rake 0.8.4.

	* lib/rake/testtask.rb (Rake::TestTask#define): passes each libs
	  as each arguments with expanded.  incorporated from rake 0.8.4.

Thu Mar  5 18:36:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_to_s): keeps enough precision for round trip.
	  [ruby-core:22325]

Thu Mar  5 17:42:06 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_fill): doc for Array#fill misses indication
	  about negative value for the start argument.  [ruby-core:22497]

Thu Mar  5 16:56:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tmpdir.rb (Dir.tmpdir): not use USERPROFILE, and ignores
	  non-existent directory.

Thu Mar  5 14:52:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_sysinit): initializes version info first.

	* win32/win32.c (rb_w32_osid): always define for binary compatibility.

Thu Mar  5 11:52:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (make_insns_rules): rule to make rules for insns.

Thu Mar  5 11:27:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (miniruby.exe): workaround for a failure of
	  mt.exe on Windows 7 beta.  [ruby-talk:330284]

Thu Mar  5 10:32:17 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/dl/test_base.rb: Add dragonfly to libc and libm switch.

Thu Mar  5 10:29:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_eql): extracted from rb_str_equal and rb_str_eql.

	* string.c (rb_str_chomp_bang): keeps 7bit coderange.

Thu Mar  5 10:10:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (enc_initialized_p): ENC_UNINITIALIZED
	  is not defined already.

	* include/ruby/encoding.h (ENC_FROM_ENCINDEX): removed because
	  depending on a static variable.

Thu Mar  5 04:42:52 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb: fix wrong test, and add a test for
	  sort_by!.

Thu Mar  5 04:32:38 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb: add some tests for coverage.

Thu Mar  5 00:06:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/README.win32 (Requirement): added unicows.lib and dll.

Wed Mar  4 23:29:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, win32/configure.bat (--enable-win95): new option
	  to enable/disable win95 support.

Wed Mar  4 21:21:51 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/thread.rb (SizedQueue#push): fix limit condition.
	  [ruby-dev:38135]

Wed Mar  4 20:27:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (mingw): checks if unicows.lib is available.

	* include/ruby/win32.h (WIN95): moved to config.h

	* win32/Makefile.sub (LIBS): links unicows.lib if available.

	* win32/Makefile.sub (config.h): defines WIN95 only if unicows.lib
	  is available.

	* win32/setup.mak (-unicows-): checks if unicows.lib is available.

Tue Mar  3 17:10:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): removes object files no longer used and
	  files to be removed by old distclean.

Tue Mar  3 16:51:51 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/win32/lib/win32/resolv.rb: get rid of warning.

	* ext/dl/lib/dl/func.rb: ditto.

Tue Mar  3 16:25:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake), lib/mkmf.rb (create_makefile): $objs and
	  $srcs are always Array or nil now.

Tue Mar  3 15:54:11 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/win32/lib/win32/{registry,resolv}.rb: use dl/import instead
	  of Win32API.

Tue Mar  3 15:53:20 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/lib/dl/func.rb (DL::Function.name): delegate to @cfunc.

Tue Mar  3 15:40:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/dl.c (rb_dl_init_callbacks): autoloads callbacks.

	* ext/dl/callback: split from dl.

	* ext/dl/lib/dl/cparser.rb (DL::CParser::parse_signature): fixed
	  variable name.

	* ext/dl/lib/dl/pack.rb (DL::PackInfo): reduced redundant
	  initialization.

	* ext/dl/lib/dl/stack.rb (DL::Stack): ditto.

	* ext/dl/lib/dl/value.rb (DL::ValueUtil#wrap_arg): NULL for nil.

	* test/dl: moved from ext/dl/test.

Tue Mar  3 14:57:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (main): passes $(MAKE) to mkmain_cmd

	* ext/extmk.rb (command_output): uses arguments to invoke make.

Tue Mar  3 01:56:03 2009  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb (SecureRandom.urlsafe_base64): delete padding.

Mon Mar  2 21:39:08 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/sockport.h (SS_LEN): defined unconditionally.

Mon Mar  2 21:26:42 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (anc_inspect_socket_creds): suppress warnings.

Mon Mar  2 21:13:42 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (rsock_discard_cmsg_resource): defined
	  unconditionally.

Mon Mar  2 21:06:40 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_mload): don't use "sun" variable
	  for Solaris.

Mon Mar  2 21:01:36 2009  Tanaka Akira  <akr@fsij.org>

	* file.c: include fcntl.h for O_RDONLY on Solaris.

Mon Mar  2 19:43:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#escape): escaped string is ascii
	  only.

	* lib/uri/common.rb (URI::Parser#unescape): converts bytewise.
	  [ruby-dev:38005], [ruby-dev:38110]

Mon Mar  2 16:40:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja (Macros): added HAVE_RUBY_*_H.

Mon Mar  2 12:22:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (init_env): keeps wide chars as wide chars.

Mon Mar  2 11:01:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/dl.h (dlerror): fixed on Windows.

	* ext/dl/handle.c (rb_dlhandle_initialize): returns handle to
	  libruby if nil is given on Windows as dlopen.

	* ext/dl/handle.c (rb_dlhandle_sym): get rid of buffer overrun,
	  and try ASCII WINAPI versions too.

Mon Mar  2 10:29:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_longjmp), include/ruby/intern.h (ruby_cleanup): fixed
	  prototypes.

Mon Mar  2 00:56:45 2009  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/observer.rb: The module observable uses now a hash to
	  store listeners. merged a patch from Alessandro Di Maria in
	  [ruby-core:22560].

Sun Mar  1 22:59:41 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c: suppress warnings.

	* ext/socket/socket.c: ditto.

	* ext/socket/unixsocket.c: ditto.

Sun Mar  1 20:57:41 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ (rsock_getfamily): renamed from rb_sock_getfamily.

Sun Mar  1 19:52:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/win32/lib/Win32API.rb (initialize): passes res
	  arguments to DL.

Sun Mar  1 19:38:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (zstream_run): suppress a warning.  a patch from
	  Charlie Savage at [ruby-core:22607].

Sun Mar  1 19:36:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_dtoa): allocates one more byte to get rid of buffer
	  overrun.  a patch from Charlie Savage at [ruby-core:22604].

Sun Mar  1 19:10:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (.y.c): removed extra backslash.  [ruby-core:22602]

Sun Mar  1 19:02:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): fix for stdcall and missing
	  argument numbers.  [ruby-core:22601]

	* ext/dl/dl.h (DLSTACK_PROTO0_): added.

	* ext/dl/mkcallback.rb (gencallback, gen_callback_file),
	  (rb_dl_init_callbacks): omit stdcall functions unless supported.

	* lib/rubygems/config_file.rb (SHGetFolderPath): stdcall.

Sun Mar  1 17:27:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (gfDebug): uncommented out.
	  [ruby-core:22600]

Sun Mar  1 16:15:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_waitpid): use wait_each() on no waitpid platforms.
	  [ruby-dev:38054]

Sun Mar  1 16:01:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_daemon): stops and restarts timer thread because
	  daemon(3) implies fork(2).  [ruby-dev:38055]

Sun Mar  1 15:45:49 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ (rsock_make_hostent): renamed from sock_make_hostent.
	  (rsock_addrinfo): renamed from sock_addrinfo.
	  (rsock_getaddrinfo): renamed from sock_getaddrinfo.
	  (rsock_socket): renamed from ruby_socket.
	  (rsock_sock_s_socketpair): renamed from sock_s_socketpair.
	  (rsock_connect): renamed from ruby_connect.

	* ext/socket/socket.c (sock_listen): make it static.

Sun Mar  1 15:29:31 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket: add rsock_ prefix.

Sat Feb 28 21:52:37 2009  Tanaka Akira  <akr@fsij.org>

	* vm_eval.c (rb_iterate): use volatile to suppress warnings.

	* eval.c (ruby_cleanup): ditto.

Sat Feb 28 20:09:40 2009  Tanaka Akira  <akr@fsij.org>

	* eval_error.c (error_print): use volatile to suppress warnings.

	* vm_eval.c (eval_string_with_cref): ditto.

	* thread.c (rb_exec_recursive): ditto.

	* eval_jump.c (rb_exec_end_proc): ditto.

	* eval.c (ruby_exec_node): ditto.
	  (rb_longjmp): ditto.

Sat Feb 28 18:28:58 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_unix_rights): check message type.

Sat Feb 28 16:18:39 2009  Tanaka Akira  <akr@fsij.org>

	* lib/net/http.rb: suppress warnings of non-existing instance variable
	  access for SSL.

Sat Feb 28 14:50:47 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (BasicSocket#connect_address): returns ::1
	  if the address is IPv4-mapped IPv6 address for 0.0.0.0 for MacOS X.

Sat Feb 28 00:18:40 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c: suppress strict-aliasing warning with
	  gcc version 4.4.0 20090219 (Red Hat 4.4.0-0.21) on Fedora 11 Alpha.

	* ext/socket/socket.c: ditto.

	* ext/socket/unixsocket.c: ditto.

	* ext/socket/sockport.h (SS_LEN): defined.
	  (SET_SS_LEN): ditto.

Fri Feb 27 22:30:18 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): close FDs passed by
	  SCM_RIGHTS unless :scm_rights=>true is given.
	  (discard_cmsg): extracted from rsock_discard_cmsg_resource.

Fri Feb 27 22:14:22 2009  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/lib/openssl/buffering.rb: define Buffering module under
	  OpenSSL.  [ruby-dev:37906]

Fri Feb 27 22:09:24 2009  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb: don't define assert_not_* if already
	  overridden.

Fri Feb 27 22:02:34 2009  Tanaka Akira  <akr@fsij.org>

	* util.c: fix SEGV by test_time.rb with
	  gcc version 4.4.0 20090219 (Red Hat 4.4.0-0.21) on Fedora 11 Alpha.

Fri Feb 27 18:30:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (cdhash_type, iseq_set_sequence): should not call
	  methods of the argument of case, to keep the semantics of
	  case/when.  [ruby-dev:38079]

Fri Feb 27 18:01:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (ruby_get_stack_grow_direction): no needs to use thread
	  here, and not initialized yet.  [ruby-core:22439]

Fri Feb 27 17:45:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_load_ok): checks if regular file, except for the
	  platform disallows to open directories, e.g. dosish.
	  [ruby-dev:38097], [Bug #1221]

Fri Feb 27 14:39:40 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (flo_eq, flo_gt, flo_ge, flo_lt, flo_le, flo_eql): revert
	  isnan() checks for VC++6.

	* insns.def (opt_lt, opt_gt): ditto.

Fri Feb 27 14:23:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ostruct.rb (modifiable): check if really frozen.
	  [ruby-core:22559]

Thu Feb 26 23:14:46 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (BasicSocket#connect_address): new method.

Thu Feb 26 19:29:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (hash_foreach_iter): fix for prototype.

Thu Feb 26 18:36:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (INSNS, newline.c, miniprelude.c, prelude.c),
	  (node_name.inc, known_errors.inc): unified from Makefile.in and
	  win32/Makefile.sub.

Thu Feb 26 13:30:34 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* util.c (valid_filename): use our own implementation of open(),
	  close() and unlink().

Thu Feb 26 13:23:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (cdhash_each): resurrects internal literals.

Thu Feb 26 10:56:48 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (rb_w32_wopen): prototype forgotten.

	* io.c (rb_sysopen_internal): shouldn't replace undefined chars in this
	  case.

Thu Feb 26 01:34:38 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: more MSG_* constants.

Thu Feb 26 00:21:21 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (sockopt_level): extracted from sockopt_level_m.
	  (sockopt_optname): extracted from sockopt_optname_m.
	  (sockopt_data): apply StringValue.
	  (sockopt_s_linger): new method.
	  (sockopt_linger): new method.
	  (inspect_linger): show onoff value if it is neither 0 nor 1.

Wed Feb 25 23:23:03 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_unix_rights): raise
	  NotImplementedError if no fd passing feature.
	  (ancillary_timestamp): raise NotImplementedError if no timestamp
	  feature.

Wed Feb 25 23:18:53 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_s_unix_rights): new method.

Wed Feb 25 23:01:26 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/unixsocket.c (unix_recv_io): prevent FD leak when 2 fd is
	  sent on LP64 platform.

	* ext/socket/rubysocket.h (rsock_discard_cmsg_resource): declared.

	* ext/socket/ancdata.c (rsock_discard_cmsg_resource): renamed from
	  discard_cmsg_resource.  export it.

Wed Feb 25 17:31:32 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (sysopen_func, rb_sysopen_internal, rb_sysopen): open file
	  by UTF-16'ed filename on Windows.

	* io.c (rb_file_open_generic, rb_io_s_sysopen, rb_io_reopen,
	  argf_next_argv): follow above change.

	* io.c (rb_scan_open_args): no longer need to convert filepath here on
	  Windows.

	* win32/wio32.c (rb_w32_wopen): new function to open file by UTF-16'ed
	  filename.

	* win32/win32.c (rb_w32_open): call rb_w32_open().

Wed Feb 25 15:05:35 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.status): use un.rb as cp instead of
	  cmd.exe's copy command.

	* lib/mkmf.rb (create_makefile): no longer need to convert path
	  separator when copying file.

Wed Feb 25 12:27:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_force_encoding): should clear coderange at changing
	  encoding.  [ruby-core:22437]

Wed Feb 25 12:06:09 2009    <nobu@ruby-lang.org>

	* io.c (rb_io_getline_1): enables limit even if rs is given.
	  [ruby-core:22434]

Wed Feb 25 02:28:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_chomp_bang): coderange may change.
	  [ruby-core:22414]

Wed Feb 25 02:17:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_delete_bang): should recalculate coderange.
	  [ruby-talk:329267]

Wed Feb 25 00:41:21 2009  Akinori MUSHA  <knu@iDaemons.org>

	* class.c (rb_scan_args): Allow specifying the number of trailing
	  mandatory arguments right after the number of optional arguments
	  only if the number of leading mandatory arguments is not omitted.

	* ext/socket/tcpserver.c (tcp_svr_init): Make use of it.

Wed Feb 25 00:28:25 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_file_size): new method added.  [ruby-core:22088]

Wed Feb 25 00:15:15 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/curses.c (curses_colors): new method added.  a patch
	  from Alexander Beisig in [ruby-core:22331].

	* ext/curses/curses.c (curses_color_pairs): ditto.

Wed Feb 25 00:05:13 2009  Akinori MUSHA  <knu@iDaemons.org>

	* class.c (rb_scan_args): Revamp rb_scan_args() to compute the
	  number of required and optional arguments precisely to prepare
	  for a more informative error message.

Tue Feb 24 23:58:52 2009  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_index, rb_ary_rindex): Emit a warning that a
	  given block is unused when an argument is specified.

Tue Feb 24 22:00:37 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sockaddr_obj): convert fe80:1::1 to fe80::1%1.

Tue Feb 24 19:56:11 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_timestamp): support SCM_BINTIME.

Tue Feb 24 19:45:15 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_timestamp): new method.

Tue Feb 24 19:01:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (main): split from exts and makes main program after
	  building exts with miniruby, to get rid of overwriting running
	  program.  [ruby-core:22339]

	* Makefile.in, win32/Makefile.sub (RUNCMD, MKMAIN_CMD): macros to
	  run script file.

	* ext/extmk.rb (parse_args): added --command-output option which
	  creates script file to make main program.

Tue Feb 24 17:58:07 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ripper.c): exec can't work on Windows.

	* ext/ripper/depend (.SUFFIXES): nmake doesn't have .y by default.

	* Makefile.in (id.h): overwrites unconditionally.

Tue Feb 24 13:13:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/vsnprintf.c (BSD_vfprintf): ptrdiff_t may be larger than
	  long.

Tue Feb 24 11:21:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (rb_disable_interrupt, rb_enable_interrupt): see
	  USE_TRAP_MASK.

Tue Feb 24 10:49:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_waitpid): last argument was missing.

	* process.c (waitall_each): fixed typo.  a patch from shinichiro.h
	  <shinichiro.hamaji AT gmail.com> at [ruby-dev:38054].

Tue Feb 24 01:53:40 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_eq): remove unnecessary NaN check using isnan().
	  comparison regarding NaN is false anyway.

	* numeric.c (flo_gt, flo_ge, flo_lt, flo_le, flo_eql): ditto.

Tue Feb 24 01:22:19 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* bootstraptest/test_thread.rb: fix for environment where fork is not
	  available.

Tue Feb 24 01:19:38 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (thread_cleanup_func): unlock all locked mutexes even when
	  forking.  [ruby-core:22269]

Tue Feb 24 00:54:16 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (opt_minus): inline float operation.

	* insns.def (opt_lt, opt_gt): ditto.

Tue Feb 24 00:24:13 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_each): check #succ only when it is really
	  needed.  small performance improvement.

	* math.c (Need_Float): call rb_to_float() only when it is really
	  needed.  small performance improvement.

Tue Feb 24 00:19:33 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/pathname.rb (Pathname#foreachline): removed wrongly
	  resurrected method.  [ruby-dev:38065]

Mon Feb 23 20:39:21 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (inspect_timespec_as_abstime): new function to
	  show struct timespec.
	  (ancillary_inspect): use it for SCM_TIMESTAMPNS on GNU/Linux.

Mon Feb 23 20:30:06 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (inspect_bintime_as_abstime): new function to
	  show struct bintime.
	  (ancillary_inspect): use it for SCM_BINTIME on FreeBSD.

	* ext/socket/mkconstants.rb: define SCM_BINTIME.

Mon Feb 23 20:18:49 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (inspect_timeval_as_abstime): use time_t
	  variable to avoid a warning on environments which use long as
	  tv_sec as NetBSD.

Mon Feb 23 15:53:30 2009  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_index, rb_ary_rindex): We know that argc is not
	  zero when we reach here.

	* array.c (rb_ary_initialize, rb_ary_index): Shrink a double
	  space. (NFC)

Mon Feb 23 14:47:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (mv): added description for the case of
	  different partitions.  [ruby-talk:329072]

Mon Feb 23 10:19:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (USE_SYMBOL_AS_METHOD_NAME): Module#methods,
	  #singleton_methods and so on return Symbols.  [ruby-talk:328775]

Mon Feb 23 10:15:35 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja: added macros for the Compatibilities.

Mon Feb 23 03:19:37 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: define SO_TIMESTAMPNS and SCM_TIMESTAMPNS
	  if available.

Mon Feb 23 02:54:31 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_inspect): use SCM_TIMESTAMP instead
	  of SO_TIMESTAMP.  SCM_TIMESTAMP != SO_TIMESTAMP on MacOS X.

Mon Feb 23 02:44:42 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (inspect_timeval_as_abstime): new function.
	  (ancillary_inspect): use it for SO_TIMESTAMP.

Mon Feb 23 02:26:44 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_timeval_as_interval): renamed from
	  inspect_timeval.

Mon Feb 23 02:10:09 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_timeval): fix the size test.

Sun Feb 22 22:42:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (tr_trans): should recalculate coderange.
	  [ruby-core:22326] (reopened at [ruby-core:22328])

Sun Feb 22 20:09:29 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_linger): message refined.

Sun Feb 22 19:28:08 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (s_recvfrom): use rb_io_wait_readable after
	  recvfrom.

Sun Feb 22 18:40:04 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_errno): new function.
	  (sockopt_inspect): use inspect_errno for SO_ERROR.

Sun Feb 22 15:11:51 2009  Tanaka Akira  <akr@fsij.org>

	* re.c (Init_Regexp): define Regexp::FIXEDENCODING.  [ruby-dev:38066]

Sun Feb 22 14:33:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (tr_trans): should not be affected by the encoding of
	  replacement unless actually modified.  [ruby-talk:328967]
	  [ruby-core:22326]

Sun Feb 22 13:38:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/init.c (s_recvfrom_nonblock): handles EAGAIN too.

	* ext/socket/init.c (s_accept_nonblock): ditto, and EPROTO depends
	  on platforms.

Sun Feb 22 13:03:12 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* eval.c (ruby_options): the evaluator now expects iseq instead of tree.

	* ruby.c (ruby_process_options): ditto.

Sun Feb 22 13:03:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (configure): unset PWD to use symlink to building
	  directory.

	* Makefile.in (up): cd doesn't need LC_TIME, VCS needs.

Sun Feb 22 10:43:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (method_missing): should not pop cfp if missing method
	  is method_missing.  [ruby-core:22298]

	* vm_eval.c (rb_raise_method_missing): new function to directly
	  raise NoMethodError.

	* vm_insnhelper.c (vm_call_method): fixed the case method_missing
	  is missing.

Sun Feb 22 02:15:40 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): handle EMSGSIZE as
	  well.

Sun Feb 22 02:03:46 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): check max length
	  overflow.

Sun Feb 22 01:52:30 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): don't call
	  discard_cmsg_resource when EMFILE.

Sun Feb 22 01:48:51 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): gc when SCM_RIGHTS
	  hit the file descriptor limit.

Sun Feb 22 00:51:58 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (io_getpartial): error message describes what should be
	  waited after nonblocking error.
	  (rb_io_write_nonblock): ditto.

	* ext/socket/init.c (s_recvfrom_nonblock): ditto.
	  (s_accept_nonblock): ditto.

	* ext/socket/socket.c (sock_connect_nonblock): ditto.

	* ext/socket/ancdata.c (bsock_sendmsg_internal): ditto.
	  (bsock_recvmsg_internal): ditto.

Sun Feb 22 00:31:42 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): check recvmsg error
	  earlier.

Fri Feb 20 23:28:11 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* util.c (rv_alloc, freedtoa): use our normal xmalloc()/xfree() because
	  couldn't free the returned pointer from ruby_dtoa().

	* missing/vsnprintf.c (cvt): receive buffer and use/return it instead
	  of returning the pointer returned from BSD__dtoa().

	* missing/vsnprintf.c (BSD_vfprintf): pass buf to cvt() as the buffer.
	  [ruby-core:22184]

Thu Feb 19 22:59:09 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (make_io_for_unix_rights): cmsg_len may be
	  bigger than msg_controllen on 4.4BSD at least.
	  freeze unix_rights array.

Thu Feb 19 22:17:38 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): fix exception.

Thu Feb 19 21:13:03 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_unix_rights): method renamed.

Thu Feb 19 15:47:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in: extracted from Makefile.in.

	* configure.in (fake.rb): prefixed with $(arch)-.

Thu Feb 19 15:39:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_ocsp.c (ossl_ocspbres_verify): OCSP_basic_verify
	  returns positive value on success, not non-zero.  [ruby-core:21762]

Thu Feb 19 15:17:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tmpdir.rb (@@systmpdir): File.expand_path also joins paths.

Thu Feb 19 15:14:25 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_each_group): defines only when Etc::Group is
	  available.

Thu Feb 19 15:11:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_intern.h (translit_char): moved from ruby.c.

	* load.c (load_ext): transliterates file separators and back if
	  needed.

	* symbian/setup (DLN_NEEDS_ALT_SEPARATOR): defined.

Thu Feb 19 14:48:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, */Makefile.sub (LOAD_RELATIVE): moved from ruby.c

Thu Feb 19 14:39:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (darwin): uses -unexported_symbol option of ld instead
	  of objcopy

	* configure.in (darwin): makes dylib instead of so.

Thu Feb 19 14:22:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): added phony targets.

	* lib/mkmf.rb (create_makefile): creates target directories before
	  copying.  [ruby-core:21958]

	* lib/mkmf.rb (create_makefile): removes directories in the depth
	  order.

Thu Feb 19 13:56:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_home_dir): checks if HAVE_PWD_H.  [ruby-dev:38049]

Thu Feb 19 08:45:48 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* ext/socket/rubysocket.h: add "#include <sys/stat.h>"

Thu Feb 19 03:42:48 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_rights): new method.
	  (make_io_for_rights): new function to allocate
	  IOs for FDs in SCM_RIGHTS message.
	  (bsock_recvmsg_internal): use make_io_for_rights.  So the FDs can be
	  closed by GC.

Thu Feb 19 03:28:59 2009  Akinori MUSHA  <knu@iDaemons.org>

	* README.EXT, README.EXT.ja: Improve the document about
	  rb_scan_args() even more.

Thu Feb 19 03:12:51 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_file_exhaustive.rb: skip some tests if euid == 0.
	  a patch from Lucas Nussbaum in [ruby-core:22209].

Thu Feb 19 03:00:49 2009  Akinori MUSHA  <knu@iDaemons.org>

	* README.EXT, README.EXT.ja: Improve the document about
	  rb_scan_args().

Wed Feb 18 22:47:01 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (discard_cmsg_resource): new function to close
	  file descriptors in control message.
	  (bsock_recvmsg_internal): call discard_cmsg_resource before retrying
	  recvmsg.

Wed Feb 18 21:47:37 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): prevent misalignment.

Wed Feb 18 21:34:30 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_sendmsg_internal): prevent misalignment.

Wed Feb 18 21:09:43 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): reduce code on
	  environments which have no control message.

Wed Feb 18 20:27:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (OBJCOPY): set ac_cv_prog_ac_ct_OBJCOPY to do nothing
	  on cygwin and mingw because symbols are exported by def file.

Wed Feb 18 15:35:36 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_chown): use chown unless HAVE_FCHOWN.

	* io.c (pipe_open): sarg is always used unless HAVE_FORK.

Wed Feb 18 15:23:34 2009  Akinori MUSHA  <knu@iDaemons.org>

	* bootstraptest/runner.rb: Use RUBY_DESCRIPTION if defined.

Wed Feb 18 14:33:35 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_resurrect), string.c (rb_str_resurrect): new
	  functions based on [ruby-dev:37983]

	* insns.def (putstring, duparray): use rb_{ary,str}_resurrect().

	* iseq.c (iseq_data_to_ary): needs to result TS_VALUE.

Wed Feb 18 12:35:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_extname): fix for spaces before extension.
	  [ruby-dev:38044]

Wed Feb 18 12:00:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): suppress a warning.  named magic
	  numbers.

Wed Feb 18 10:29:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): do not delete main thread from
	  living_threads.  [ruby-core:19385], [ruby-core:22158]

Wed Feb 18 01:05:05 2009  Tanaka Akira  <akr@fsij.org>

	* ext/openssl: avoid cyclic require.

	* ext/openssl/lib/openssl/ssl-internal.rb: renamed from ssl.rb

	* ext/openssl/lib/openssl/x509-internal.rb: renamed from x509.rb.

	* lib/net/imap.rb: require openssl, instead of openssl/ssl.

	* lib/net/pop.rb: require openssl, instead of openssl/ssl.

	[ruby-dev:38018]

Wed Feb 18 00:55:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (Etc::Passwd.each, Etc::Group.each): new methods.
	  [ruby-dev:37999]

Tue Feb 17 23:25:01 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_sendmsg_internal): make the padding
	  removing only on NetBSD.

Tue Feb 17 19:39:04 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_sendmsg_internal): should not remove the
	  last padding of control messages, basically.

Tue Feb 17 12:50:57 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_shared_replace): no need for
	  str_make_independent.

Tue Feb 17 05:41:08 2009  Koichi Sasada  <ko1@atdot.net>

	* compile.c: fix to add "ensure" codes across "while" clause
	  before "return" expression.  [ruby-dev:37967]

	* bootstraptest/test_flow.rb: add a test.

Tue Feb 17 01:53:35 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: generate rb_define_const directly for
	  rdoc.

	* ext/.document: add socket/constdefs.c.

	* ext/socket/constants.c (sock_define_const): removed.
	  (sock_define_uconst): ditto.
	  (rb_mSockConst): new static variable.

Mon Feb 16 23:14:51 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_sendmsg_internal) [OpenBSD]: don't remove
	  the last padding to prevent sendmsg failure in test_udp_server in
	  test/socket/test_socket.rb on OpenBSD 4.4.

Mon Feb 16 21:59:32 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup: Update Symbian config to match recent changes in missing/alloca.c

Mon Feb 16 17:04:14 2009  Akinori MUSHA  <knu@iDaemons.org>

	* class.c (rb_scan_args), README.EXT, README.EXT.ja: Add support
	  for specifying the number of the trailing mandatory arguments.
	  Update the documents accordingly. [ruby-dev:37995]

Mon Feb 16 16:46:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c (set_debug_option): added rtc_error option.

	* win32/Makefile.sub (CRTDEFFLAGS): separated from DEFS.

	* win32/win32.c (rtc_error_handler): ignores RTC errors unless
	  rtc_error debug option is given.

	* win32/win32.c (rb_w32_sysinit): suppress useless CRT assertions.
	  [ruby-core:22116]

Sun Feb 15 21:43:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct#new_ostruct_member): checks if frozen.
	  [ruby-talk:328195], [ruby-core:22142]

Sun Feb 15 21:22:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions): aliases
	  assert_not_ methods.

Sun Feb 15 16:57:35 2009  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb (SecureRandom.urlsafe_base64): new method.

Sun Feb 15 14:58:07 2009  Tanaka Akira  <akr@fsij.org>

	* hash.c (hash_i): use Murmurhash.

Sun Feb 15 11:45:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_define_hooked_variable): suppress false assertion
	  with VC9.  [ruby-core:22115]

Sun Feb 15 08:35:33 2009  Tanaka Akira  <akr@fsij.org>

	* test/test_pp.rb: extract from lib/pp.rb.

	* test/test_prettyprint.rb: extract from lib/prettyprint.rb.

	* test/test_tsort.rb: extract from lib/tsort.rb.

Sun Feb 15 06:34:22 2009  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time.parse): raise ArgumentError if Date._parse don't
	  extract date information.  [ruby-core:20912]

Sun Feb 15 04:48:08 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (rb_hash_uint32, rb_hash_uint, rb_hash_start, rb_hash_end),
	  include/ruby/intern.h: add Murmurhash API.  [ruby-dev:37784]

	* complex.c (nucomp_hash), array.c (rb_ary_hash), time.c (time_hash),
	  string.c (rb_str_hash), object.c (rb_obj_hash), range.c
	  (range_hash), struct.c (rb_struct_hash), hash.c (rb_any_hash),
	  rational.c (nurat_hash): use Murmurhash.  [ruby-dev:37784]

Sun Feb 15 03:50:21 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* hash.c (rb_hash): always return a fixnum value because a return
	  value of rb_hash may be used as a hash value itself and bignums have
	  no unique VALUE.

	* test/ruby/test_hash.rb: add a test for above.

Sun Feb 15 00:45:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_uniq_bang, rb_ary_uniq): unique by the result of
	  given block.  [ruby-dev:37998]

Sun Feb 15 00:39:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_resize_capa): should not overwrite outside embedded
	  array.

Sat Feb 14 20:18:19 2009  Tanaka Akira  <akr@fsij.org>

	* test/test_time.rb: extracted from lib/time.rb.

Sat Feb 14 19:20:15 2009  Tanaka Akira  <akr@fsij.org>

	* lib/pathname.rb: obsolete methods removed.
	  [ruby-core:21564]

Sat Feb 14 15:46:01 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/pathname.rb (Pathname#binread): added.  [ruby-dev:37952]

Sat Feb 14 13:14:18 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* iseq.c: remove nil parameter from Proc#parameters
	  after rest appeared.

Sat Feb 14 07:23:52 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_external_str_new_with_enc): change evaluation order
	  for speed.

Sat Feb 14 02:20:04 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/sockport.h (SET_SA_LEN): cast to void for suppressing a
	  warning.

Fri Feb 13 23:37:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/win32/lib/Win32API.rb (Win32API#initialize): DL.dlopen
	  raises DLError.

Fri Feb 13 21:13:19 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (Init_socket): define TCPServer#listen and
	  UNIXServer#listen here for rdoc.

Fri Feb 13 20:59:48 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (extract_ipv6_pktinfo): set sa_len for 4.4BSD.

Fri Feb 13 15:34:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (simple_default_value): removed.  default values of optional
	  parameters are not available still now.  [ruby-dev:37980]

Fri Feb 13 15:11:11 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_eval.c (eval_string_with_cref): use rb_vm_get_ruby_level_next_cfp()
	  instead of vm_get_ruby_level_caller_cfp().  checking a upper frame
	  is not enough.  [ruby-dev:37984]

	* proc.c, vm_core.h: declare rb_vm_get_ruby_level_next_cfp()
	  on vm_core.h.

Fri Feb 13 15:01:40 2009  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_fiber_alive_p): fix to return true instead of 0.
	  [ruby-dev:37991]

	* test/ruby/test_fiber.rb: add a test for Fiber#alive?

Fri Feb 13 09:43:19 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ac_cv_func_flock): using flock defined in
	  win32/win32.c on mingw.

Fri Feb 13 01:45:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_sequence, compile_dstr_fragments),
	  (iseq_compile_each): hides other internal objects.

	* compile.c (iseq_compile_each): just freeze xstr.

Fri Feb 13 00:48:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defineclass): try to autoload const to be overridden.

Thu Feb 12 23:22:29 2009  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_socket.rb (test_udp_server): filter out unreachable
	  addresses.  [ruby-dev:37970]

Thu Feb 12 22:51:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (hide_obj): OBJ_FREEZE() is not an expression.  a patch
	  from nagachika <nagachika00 AT gmail.com> at [ruby-dev:37977].

	* compile.c (insn_set_sc_state): fixed typo.

Thu Feb 12 12:36:35 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/basicsocket.c (bsock_getpeereid): implemented for Solaris
	  using getpeerucred.

	* ext/socket/extconf.rb: check ucred.h and getpeerucred.

	* ext/socket/rubysocket.h: include ucred.h if available.

Thu Feb 12 19:42:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (compile_array_, defined_expr, iseq_compile_each): hide
	  and freeze internal literal objects, to prevent from modifying.
	  [ruby-dev:37959]

	* iseq.c (insn_operand_intern): copy internal literal objects.

	* insns.def (putstring, duparray): ditto.

	* string.c (rb_str_replace): exported.

Thu Feb 12 17:17:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_ungetc): calculates new position
	  before reallocation.  [Bug#1099]

Thu Feb 12 16:50:27 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: a patch to build on GNU/kOpenSolaris from Rober
	  Millan at [ruby-core:21888].

Thu Feb 12 15:28:04 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* iseq.c (simple_default_value): allow plain strings as default
	  values.

Wed Feb 11 18:09:41 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (define_final, undefine_final): shouldn't add/remove finalizer
	  of frozen objects.

	* gc.c (undefine_final): should remove FL_FINALIZE flag.
	  [ruby-dev:37964] (also see [ruby-dev:37959])

Wed Feb 11 17:37:41 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.udp_server_sockets): call the block
	  if given.  close the sockets when the block exits.
	  (Socket.udp_server_loop): use udp_server_sockets in block form.

Wed Feb 11 17:34:16 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.tcp_server_sockets): call the block
	  if given.  close the sockets when the block exits.
	  (Socket.tcp_server_loop): use tcp_server_sockets in block form.

Wed Feb 11 17:01:52 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.unix_server_loop): use
	  unix_server_socket with a block.

Wed Feb 11 16:54:26 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.unix_server_socket): close the
	  socket when the block exits.

Wed Feb 11 16:50:59 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.unix_server_socket): call the block
	  if given.  remove the socket file when the block exits.

Wed Feb 11 16:44:20 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_s_ip_pktinfo): make 3rd argument
	  optional.

Wed Feb 11 15:47:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_make_shared): returns shared root array itself, and
	  frozen array can be shared.

Wed Feb 11 14:46:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (setspecial, putstring): fixed typos in rdoc.

	* insns.def (toregexp): uses rb_ary_tmp_new(), and clears it after
	  used.

Wed Feb 11 14:08:23 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (anc_inspect_socket_rights): return 1 on
	  success.  0 on failure.
	  (anc_inspect_passcred_credentials): ditto.
	  (anc_inspect_socket_creds): ditto.
	  (anc_inspect_socket_creds): ditto.
	  (anc_inspect_socket_creds): ditto.
	  (anc_inspect_ip_recvdstaddr): ditto.
	  (anc_inspect_ip_pktinfo): ditto.
	  (anc_inspect_ipv6_pktinfo): ditto.
	  (ancillary_inspect): check family.

Wed Feb 11 12:55:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (anc_inspect_ip_pktinfo): make result bit
	  succinct.
	  (Init_ancdata): fix number of arguments.

Wed Feb 11 11:47:41 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c (Init_ipsocket): undef getpeereid at IPSocket.

Wed Feb 11 10:16:34 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: check getpeereid.

	* ext/socket/basicsocket.c (bsock_getpeereid): new method.

Wed Feb 11 09:58:59 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket::UDPSource#inspect): fix variable
	  name.

Wed Feb 11 00:38:16 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_gethostname): use HOST_NAME_MAX.

	* ext/socket/raddrinfo.c (make_ipaddr): local variable renamed.

Tue Feb 10 23:44:53 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (struct recvfrom_arg): use struct
	  sockaddr_storage.
	  (recvfrom_blocking): follow struct recvfrom_arg change.
	  (s_recvfrom): ditto.
	  (s_recvfrom_nonblock): use struct sockaddr_storage.

	* ext/socket/socket.c (sock_accept): use struct sockaddr_storage.
	  (sock_accept_nonblock): ditto.
	  (sock_sysaccept): ditto.

	* ext/socket/ancdata.c (bsock_recvmsg_internal): use struct
	  sockaddr_storage.

Tue Feb 10 23:30:32 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/basicsocket.c (bsock_getpeername): use struct
	  sockaddr_storage.
	  (bsock_local_address): ditto.
	  (bsock_remote_address): ditto.

Tue Feb 10 21:26:33 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.udp_server_sockets): new method.
	  (Socket.udp_server_loop_on): new method.
	  (Socket.udp_server_loop): new method
	  (Socket.ip_sockets_port0): extracted from tcp_server_sockets_port0.
	  (Socket::UDPSource): new class.

Tue Feb 10 21:14:43 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sockaddr_obj): fill pfamily.

Tue Feb 10 21:09:23 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (sockopt_s_bool): new method.
	  (sockopt_bool): new method.

Tue Feb 10 20:58:47 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (sockopt_family_m): renamed from sockopt_family.
	  (sockopt_level_m): renamed from sockopt_level.
	  (sockopt_optname_m): renamed from sockopt_optname.
	  (inspect_local_peercred): follow the renaming.
	  (Init_sockopt): ditto.

Tue Feb 10 20:56:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (anc_inspect_socket_creds): refactored to avoid
	  a rb_str_cat2 call.

Tue Feb 10 04:34:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (when): makes parentheses balanced.

Tue Feb 10 01:28:49 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ip_cmsg_type_to_sym): renamed from
	  cmsg_type_to_sym.

Tue Feb 10 01:22:56 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (sockopt_inspect): refactored.

Tue Feb 10 01:02:16 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: generate intern_family_noprefix.

	* ext/socket/option.c (sockopt_inspect): use intern_family_noprefix
	  not to show AF_ prefix.

	* ext/socket/ancdata.c (ancillary_inspect): ditto.

Mon Feb  9 23:21:29 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/constants.c (level_arg): use unknown_level_to_int for
	  non internet protocol.
	  (optname_arg): use only so_optname_to_int for non internet protocol.
	  (cmsg_type_arg): use only scm_optname_to_int for non internet
	  protocol.

	* ext/socket/mkconstants.rb: generate unknown_level_to_int.
	  rename iplevel_to_int to ip_level_to_int.

Mon Feb  9 23:04:27 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: rename level_to_int to iplevel_to_int.
	  rename intern_level to intern_iplevel.

	* ext/socket/constants.c: follow the renaming.

	* ext/socket/option.c: ditto.

	* ext/socket/ancdata.c: ditto.

Mon Feb  9 22:52:13 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (level_arg): add family argument.
	  (optname_arg): ditto.
	  (cmsg_type_arg): ditto.
	  (rb_sock_getfamily): declared.

	* ext/socket/constants.c (level_arg): add family argument.
	  (optname_arg): ditto.
	  (cmsg_type_arg): ditto.

	* ext/socket/init.c (rb_sock_getfamily): defined.

	* ext/socket/option.c (sockopt_initialize): give family for level_arg
	  and optname_arg.
	  (sockopt_s_int): ditto.

	* ext/socket/basicsocket.c (bsock_setsockopt): ditto.
	  (bsock_getsockopt): ditto.

	* ext/socket/ancdata.c (ancillary_initialize): ditto.
	  (ancillary_s_int): ditto.
	  (ancillary_cmsg_is_p): ditto.
	  (bsock_sendmsg_internal): ditto.
	  (bsock_recvmsg_internal): use rb_sock_getfamily.

Mon Feb  9 21:48:59 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_inspect): show address family.

Mon Feb  9 20:19:36 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/basicsocket.c (bsock_getsockname): use sockaddr_storage.

Mon Feb  9 20:11:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/win32ole/win32ole.c (load_conv_function51932): fixed for the
	  case IMultiLanguage is not available.  [ruby-dev:37950]

Mon Feb  9 20:04:35 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_int): return 1/0 on success/failure.
	  (inspect_uint): ditto.
	  (inspect_linger): ditto.
	  (inspect_socktype): ditto.
	  (inspect_timeval): ditto.
	  (inspect_peercred): ditto.
	  (inspect_local_peercred): ditto.
	  (sockopt_inspect): refactored.

Mon Feb  9 20:00:26 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: more constants for Solaris.

Mon Feb  9 19:59:18 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/basicsocket.c (bsock_getsockopt): refine address family
	  examination.

Mon Feb  9 19:52:32 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (sockopt_initialize): argument conversion
	  reordered.

Mon Feb  9 19:46:22 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_initialize): add family argument.
	  (ancdata_new): ditto.
	  (ancillary_s_int): ditto.
	  (ancillary_family): new function.
	  (ancillary_family_m): new method.
	  (ancillary_s_ip_pktinfo): follow ancdata_new change.
	  (ancillary_s_ipv6_pktinfo): ditto.
	  (bsock_recvmsg_internal): examine the socket address family.

Mon Feb  9 11:31:09 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_encoding_set): ignore second argument when external and
	  internal are same. [ruby-dev:37939]

Mon Feb  9 09:05:12 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_local_peercred): check version.
	  (sockopt_inspect): suppress warning.

Mon Feb  9 02:04:03 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_peercred): struct ucred contains
	  effective uid/gid.

Mon Feb  9 00:44:45 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (sockopt_inspect): add ifdef guard for
	  LOCAL_PEERCRED.

Mon Feb  9 00:37:06 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_local_peercred): cr_uid is a effective
	  uid, not a real uid.

Mon Feb  9 00:30:56 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: check sys/param.h and sys/ucred.h.

	* ext/socket/rubysocket.h: include sys/param.h and sys/ucred.h.

	* ext/socket/option.c (inspect_local_peercred): new function to show
	  LOCAL_PEERCRED socket option on FreeBSD.
	  (sockopt_inspect): show as LOCAL_* socket option if AF_UNIX and level
	  is 0.

Mon Feb  9 00:01:47 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (sockopt_new): add family argument.

	* ext/socket/option.c (sockopt_initialize): add vfamily argument.
	  (sockopt_new): add family argument and record it in the object.
	  (sockopt_family): new method.
	  (sockopt_s_int): add vfamily argument.
	  (sockopt_inspect): show family.

	* ext/socket/basicsocket.c (bsock_getsockopt): check address family
	  using getsockname.

Sun Feb  8 23:37:17 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* enumerator.c (enumerator_with_index): receives one argument which
	  represents a start offset.  [ruby-dev:37921]

Sun Feb  8 23:28:05 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* include/ruby/st.h, st.c: order entries by a linked list instead of
	  a loop to fix iteration miss when hash is modified during iteration.
	  [ruby-dev:37910]

Sun Feb  8 23:22:35 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_peercred): new function to show
	  SO_PEERCRED socket option on GNU/Linux.

Sun Feb  8 22:44:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/backward/rubysig.h (rb_thread_blocking_region_begin),
	  (rb_thread_blocking_region_end): marked as deprecated.

	* include/ruby/backward/rubysig.h (TRAP_BEG): fix for C++.  a
	  patch from Aman Gupta at [ruby-core:21934]

Sun Feb  8 21:47:50 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: check struct cmsgcred.

	* ext/socket/ancdata.c (anc_inspect_passcred_credentials): add
	  "(ucred)".
	  (anc_inspect_socket_creds): show struct cmsgcred too, for FreeBSD.

Sun Feb  8 21:05:35 2009  Tanaka Akira  <akr@fsij.org>

	* lib/drb/extservm.rb (DRb::ExtServManager#invoke_service_command):
	  detach spawned process.  [ruby-dev:37936]

Sun Feb  8 20:30:29 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: check struct sockcred.

	* ext/socket/ancdata.c (anc_inspect_socket_creds): new function to
	  show SCM_CREDS on NetBSD.

Sun Feb  8 19:05:24 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/backward/rubysig.h: extern "C" was missing.
	  [ruby-core:21929]

Sun Feb  8 18:46:15 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (anc_inspect_passcred_credentials): new
	  function to show SCM_CREDENTIALS on GNU/Linux.

Sun Feb  8 18:34:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_s_binread): ensures file path.  [ruby-dev:37940]

Sun Feb  8 13:52:02 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (init_unix_addrinfo): add socktype argument.
	  (addrinfo_initialize): follow init_unix_addrinfo change.
	  (addrinfo_s_unix): add optional argument: socktype

Sun Feb  8 13:09:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_APPEND_OPTION, RUBY_APPEND_OPTIONS),
	  (RUBY_PREPEND_OPTION, RUBY_PREPEND_OPTIONS): add option(s)
	  without duplication.

	* configure.in (RUBY_DEFINE_IF): changed parameter order, now
	  condition comes first.

	* configure.in (universal_binary): checks architecture macros, and
	  improved thin load paths.

Sun Feb  8 09:41:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* runruby.rb: gets extout and arch from rbconfig.rb.

Sat Feb  7 21:26:15 2009  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_addrinfo.rb (test_family_addrinfo): don't use
	  www.ruby-lang.org.
	  http://d.hatena.ne.jp/nagachika/20090204/working_for_0f0e

Sat Feb  7 18:02:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (--with-arch): added new option to support
	  universal binary.  replaced --enable-fat-binary option which
	  didn't work actually.

	* configure.in (RUBY_FUNC_ATTRIBUTE): added conditional test.

	* configure.in (ac_cv_type_getgroups): declared because getgroups()
	  fills rest of the buffer with garbage on Rosetta.

	* configure.in (alloca): defines only for powerpc, but always
	  create empty object to suppress ld warning.

	* configure.in (LIBRUBY_DLDFLAGS): set compatibility version with
	  TEENY.

	* configure.in (CFLAGS, LDFLAGS): separates ARCH_FLAG.

	* configure.in (arch): renamed to "universal" from "fat".

	* Makefile.in (ARCH_FLAG): added.

	* include/ruby/defines.h (WORDS_BIGENDIAN): uses
	  AC_APPLE_UNIVERSAL_BUILD.

	* missing/alloca.c (alloca): defines only if C_ALLOCA is defined.

Sat Feb  7 12:31:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* runruby.rb: added --precommand and --show options.

	* runruby.rb: added --cpu option.

	* runruby.rb: skips version check in rbconfig.rb.

Sat Feb  7 11:44:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_header): needs dependent headers if trying to
	  compile.

	* ext/socket/extconf.rb: net/if.h depends on other headers.

Sat Feb  7 04:02:37 2009  Tanaka Akira  <akr@fsij.org>

	* dir.c (dir_read): don't disable rdoc.

Fri Feb  6 23:28:33 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (io_fread): use rb_io_wait_readable for retry
	  avoid Errno::EINTR on ruby -e 'trap(:CHLD) {}; spawn("sleep 1"); STDIN.read'

Fri Feb  6 22:36:11 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* thread_pthread.c (native_thread_create) [__SYMBIAN32__]: reduced pthread stack size.

	* thread_pthread.c (thread_timer) [__SYMBIAN32__]: compiled out unsupported yet signal-related functionality.

	* io.c (pipe_open) [__SYMBIAN32__]: fixed compile time error.

Fri Feb  6 22:11:46 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* include/ruby/defines.h [__SYMBIAN32__]: included <sys/select.h> for fd_set definition

Fri Feb  6 21:58:24 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/missing-pips.c: added a stub for missing PIPS function execl.

	* process.c (rb_proc_exec) [__SYMBIAN32__]: removed conditional around execl function call.

Fri Feb  6 20:37:42 2009  Tanaka Akira  <akr@fsij.org>

	* signal.c (register_sigaltstack): ignore sigaltstack error.
	  It fails on OpenBSD 4.4 when pthread library is linked.

Fri Feb  6 18:18:07 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_readdir_with_enc): fallback to OS's conversion
	  when ASCII-8BIT is passed.

Fri Feb  6 17:19:23 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{dir.h, win32.c} (rb_w32_readdir_with_enc): new function to
	  read entry with specified enc.

	* win32/win32.c (readdir_internal): extract from rb_w32_opendir().

	* win32/win32.c (opendir_internal): extract from rb_w32_readdir().

	* dir.c (dir_read, dir_each): use new READDIR macro instead of readdir()
	  to pass enc for special version of readdir, such as above.

Fri Feb  6 12:11:24 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (process_options): set initial default_external before -r.

Fri Feb  6 12:03:47 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (process_options): -K and -E in shebang should be reflect to
	  default_external. [ruby-dev:37920]

Fri Feb  6 07:52:57 2009  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (chfunc): type fixed.

Fri Feb  6 02:51:59 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_each_codepoint): update RDoc for
	  String#codepoints.  a patch from Radoslaw Bulat in
	  [ruby-core:21835]

Fri Feb  6 01:09:13 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (cont_mark, cont_capture, cont_restore_1): use #else instead
	  of #elif.  a patch from NISHIMATSU Takeshi <t_nissie at yahoo.co.jp>
	  in [ruby-list:45856].

Thu Feb  5 20:28:27 2009  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_run_exec_options_err): renamed from
	  rb_run_exec_options.
	  (rb_exec_err): renamed from rb_exec.
	  (rb_fork_err): renamed from rb_fork.
	  (rb_spawn_err): renamed from rb_spawn.
	  (rb_run_exec_options): declared with 1.9.1 compatible signature.
	  (rb_exec): ditto.
	  (rb_fork): ditto.
	  (rb_spawn): ditto.

	* process.c (rb_run_exec_options_err): renamed from
	  rb_run_exec_options.
	  (rb_exec_err): renamed from rb_exec.
	  (rb_fork_err): renamed from rb_fork.
	  (rb_spawn_err): renamed from rb_spawn.
	  (rb_run_exec_options): defined.
	  (rb_exec): ditto.
	  (rb_fork): ditto.
	  (rb_spawn): ditto.

	* io.c: follow above change.

	* ext/pty/pty.c: follow above change.

	  [ruby-dev:37893]

Thu Feb  5 19:58:40 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket: AddrInfo is renamed to Addrinfo.  [ruby-dev:37876]

Thu Feb  5 16:18:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_SITE_LIB_PATH, RUBY_VENDOR_LIB_PATH): fix for
	  NetBSD.

Thu Feb  5 16:04:29 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): follow recent changes about paths.

Thu Feb  5 14:26:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (MAJOR, MINOR, TEENY): uses RUBY_VERSION_*.

	* mkconfig.rb (prefix): uses ruby_version in config.status.

Thu Feb  5 12:24:18 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_uniq): gets rid of copying.

Thu Feb  5 12:01:53 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_add_hash): split from ary_make_hash().

	* array.c (ary_make_hash): hide a Hash used internally.

	* array.c (ary_recycle_hash): clears internally used hash.  this
	  name came from [ruby-dev:37908].

	* array.c (rb_ary_diff, rb_ary_and, rb_ary_or, rb_ary_uniq_bang):
	  recycle hashes.

Thu Feb  5 11:21:35 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_LIB_VERSION): added for library version, to
	  split from core version.  [ruby-dev:37748]

	* configure.in (RUBY_LIB_PATH, etc): moved actual version
	  dependent stuff to version.c.

	* ruby.c (ruby_init_loadpath_safe): ditto.

	* version.c (ruby_initial_load_paths): moved initial load path
	  version depending on version from ruby.c.

	* version.h (RUBY_VERSION_{MAJOR,MINOR,TEENY}): now mean library
	  and API version, and reverted to 1.9.1.  [ruby-dev:37889]

Thu Feb  5 07:39:33 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/readline/readline.c (Init_readline): remove_history(0) may be
	  NULL.  [ruby-dev:37891]

Thu Feb  5 03:55:22 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (LOCALTIME): should call tzset() before localtime_r().
	  [ruby-dev:37896]

Thu Feb  5 02:12:35 2009  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/configure.bat: Updated Symbian configuration procedure to
	  avoid creating files outside build directory

	* symbian/pre-build: ditto

	* symbian/setup: ditto

	* symbian/rubyu.def: removed

Thu Feb  5 01:44:02 2009  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_econv_exception): refine error message for
	  undefined conversion.  [ruby-core:21828]

Thu Feb  5 01:18:25 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_s_socketpair): make 3rd argument optional.

	* ext/socket/unixsocket.c (unix_s_socketpair): follow the above
	  change.

	* ext/socket/rubysocket.h (sock_s_socketpair): ditto.

Thu Feb  5 00:09:39 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_ipv6_to_ipv4): new method.

Wed Feb  4 21:59:31 2009  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_econv_exception): show U+XXXX form for undefined
	  conversion error from UTF-8.

Wed Feb  4 21:57:37 2009  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_dump): use MBCLEN_CHARFOUND_P properly.

Wed Feb  4 21:55:38 2009  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb: refine success message.

Wed Feb  4 19:10:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (id.h): updates from parse.h.

Wed Feb  4 11:45:06 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/mkexports.rb: shouldn't export DllMain.
	  reported at http://pc11.2ch.net/test/read.cgi/tech/1233686068/21

Wed Feb  4 10:12:05 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* missing/vsnprintf.c (BSD_vfprintf): should support 't' format
	  modifier to handle PRIdPTRDIFF.  thanks for the info from
	  Kazuhiro NISHIYAMA.  [ruby-core:21807]

Wed Feb  4 01:28:46 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: fix struct in_pktinfo and struct in6_pktinfo
	  detection.

Wed Feb  4 00:32:59 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/etc/test_etc.rb(test_getpwnam, test_getgrgid, test_getgrnam):
	  support an environment that has duplicative entries.  a patch from
	  Tomoyuki Chikanaga <chikanag at nippon-control-system.co.jp> in
	  [ruby-dev:37882].

Wed Feb  4 00:17:52 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.tcp_server_sockets_port0): skip
	  socket creation error.

Tue Feb  3 23:37:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): resets EOF flag after parse.

Tue Feb  3 23:13:34 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace): always returns non-nil array if lev is
	  negative.  [ruby-core:21795]

Tue Feb  3 21:19:06 2009  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: checked rl_set_screen_size and
	  rl_get_screen_size.

	* ext/readline/readline.c (readline_s_set_screen_size): added
	  Readline.set_screen_size.

	* ext/readline/readline.c (readline_s_get_screen_size): added
	  Readline.get_screen_size.

Tue Feb  3 21:07:19 2009  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (readline_s_set_completion_proc): set
	  default if proc is nil. fix #1095

Tue Feb  3 16:36:06 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* array.c (rb_ary_sort_by_bang): RDoc update.

	* NEWS: add Array#sort_by!.

Tue Feb  3 16:23:16 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.tcp_server_sockets_port0): new
	  private function for allocating same port both IPv4 and IPv6.
	  (Socket.tcp_server_sockets): use tcp_server_sockets_port0 for port 0.

Tue Feb  3 14:12:10 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: validate data before sending to a server.
	  [ruby-core:20320]

Tue Feb  3 12:35:41 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (match_array): replace match_check().

	* re.c (match_values_at): ditto.

Tue Feb  3 12:09:08 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (hmac_md5): should use String#ord to get ascii
	  code from the one-character string.

Tue Feb  3 11:25:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_lock): warn for circular require.  [ruby-core:20794],
	  [ruby-core:20797]

Tue Feb  3 08:35:12 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.tcp_server_sockets): extracted from
	  Socket.tcp_server_loop.
	  (Socket.accept_loop): ditto.
	  (Socket.unix_server_socket): extracted from Socket.unix_server_loop.
	  (Socket.unix_server_loop): use Socket.accept_loop.

Tue Feb  3 08:21:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_readpartial.rb (make_pipe): readpartial does not
	  work in text mode.

Tue Feb  3 08:18:26 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (RUBYDEF): uses mkexports.rb on cygwin too.

	* win32/mkexports.rb (Exports::Cygwin): added.

Tue Feb  3 08:10:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (Doxyfile): moved from Makefile.in.

	* template/Doxyfile.tmpl: split from Doxyfile.in.

Tue Feb  3 08:01:38 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_write): use of cast expressions as lvalues
	  is deprecated.

Tue Feb  3 07:57:58 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/extconf.rb (in_pktinfo, in6_pktinfo),
	  ext/socket/ancdata.c: defined in w32api/ws2tcpip.h on cygwin but
	  cannot compile for some reason.

Tue Feb  3 07:02:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/langinfo.c (nl_langinfo_codeset): accepts iso-8859
	  fragment.  [ruby-core:21757]

Tue Feb  3 07:01:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb (patchlevel): config.status may not contain
	  PATCHLEVEL even if other version numbers exist.

Mon Feb  2 23:43:00 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (Init_addrinfo): add AddrInfo#to_s as an
	  alias of AddrInfo#to_sockaddr.

	* ext/socket/option.c (Init_sockopt): add Socket::Option#to_s as an
	  alias of Socket::Option#data.

	  [ruby-dev:37873]

Mon Feb  2 21:04:13 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_sort_by_bang): RDoc update.  [ruby-core:21742]

Mon Feb  2 20:49:24 2009  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c: Introduce id_each to save rb_intern() and SYM2ID()
	  calls.

Mon Feb  2 19:55:51 2009  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_addrinfo.rb: use AddrInfo.getaddrinfo to generate
	  IPv6 address.  AddrInfo.ip generates IPv4 address for IPv4 mapped
	  IPv6 address if --with-lookup-order-hack=INET.
	  [ruby-dev:37868]

Mon Feb  2 19:17:16 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* doc/NEWS-1.9.1: typo fixed: collect_all -> collect.
	   [ruby-core:21706]

Mon Feb  2 17:23:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (dir.o, win32.o): depend on win32/dir.h.

Mon Feb  2 17:13:46 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* mkconfig.rb: patchlevel is sometimes minus.

	* win32/resource.rb: ditto.

Mon Feb  2 17:11:23 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (cmsg_type_to_sym): add #ifdef for no IPv6
	  environment.

Mon Feb  2 17:05:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_find_file_ext): should not be infected from other
	  load paths.

Mon Feb  2 16:33:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_s_home): new method.   [ruby-core:21454]

Mon Feb  2 16:06:10 2009  Tanaka Akira  <akr@fsij.org>

	* version.h: bump up to 1.9.2 patchlevel -1.
	  yugui recommend "-1" strongly.

	* lib/rubygems/version.rb: accept negative patchlevel.

Mon Feb  2 14:53:35 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_initialize): make 3rd argument, protocol,
	  optional.

Mon Feb  2 14:47:53 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_sort_by_bang): new method.  requested in
	  [ruby-core:21709]

Mon Feb  2 14:22:56 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/constants.c (cmsg_type_arg): INET6 check.

Mon Feb  2 14:18:20 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c: use INET6 instead of IPV6.

Mon Feb  2 12:47:47 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/{options,raddrinfo}.c: use INET6 instead of AF_INET6 for
	  VC++6.

Mon Feb  2 12:41:52 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* complex.c (f_signbit): regard NaN as a positive value.
	  [ruby-dev:37861].

Mon Feb  2 12:39:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sample/test.rb (valid_syntax?), test/ruby/test_system.rb
	  (TestSystem::valid_syntax?): use catch and throw instead of
	  return inside BEGIN block.

Mon Feb  2 11:45:10 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (cmsg_type_arg): declared.
	  (Init_ancdata): ditto.

	* ext/socket/init.c (Init_socket_init): call Init_ancdata.

	* ext/socket/constants.c (cmsg_type_arg): defined.

	* ext/socket/depend: add dependency for ancdata.o.

	* ext/socket/mkconstants.rb: generate scm_optname_to_int.
	  more constants.

	* ext/socket/extconf.rb: add ancdata.o.

	* ext/socket/ancdata.c: new file.  new method
	  BasicSocket#{sendmsg,sendmsg_nonblock,recvmsg,recvmsg_nonblock}

Mon Feb  2 10:57:27 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, win32/dir.h (open_dir_handle, rb_w32_opendir,
	  move_to_next_entry, rb_w32_readdir, check_valid_dir): change backend
	  API from A to W.

Mon Feb  2 10:48:38 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/basicsocket.c (bsock_setsockopt): accept Socket::Option
	  object.
	  (bsock_getsockopt): return Socket::Option object.

	* ext/socket/option.c: new file.

	* ext/socket/rubysocket.h (rb_cSockOpt): declared.
	  (sockopt_new): ditto.
	  (Init_sockopt): ditto.

	* ext/socket/init.c (Init_socket_init): call Init_sockopt.

	* ext/socket/depend: add dependency for option.o

	* ext/socket/mkconstants.rb: generate intern_level, intern_so_optname,
	  intern_ip_optname, intern_ipv6_optname, intern_tcp_optname,
	  intern_udp_optname and intern_scm_optname.

	* ext/socket/extconf.rb: add option.o.

Mon Feb  2 09:49:39 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace_each): progname is not available at
	  initializing phase.

Mon Feb  2 08:12:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/xmlrpc/server.rb (Server#serve): gets rid of hardcoded
	  platform names.

	* lib/resolv.rb (Resolv::Hosts::DefaultFileName),
	  (Resolv::DNS::Config.default_config_hash): tries win32/resolv on
	  mswin64 too.

	* lib/rubygems/specification.rb (Gem::Specification#ruby_code):
	  added mswin64.

	* lib/drb/extservm.rb (DRb::ExtServManager#invoke_service_command):
	  spawn is better to start a process in background.

	* ext/extmk.rb: uses FNM_SYSCASE.

	* instruby.rb: installs win32.h on mswin64 platform.
	  [ruby-core:21722]

Mon Feb  2 07:36:13 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace_each): now takes an iterator function.

	* vm_core.h (rb_make_backtrace, rb_backtrace_each): added
	  prototypes.

	* vm_dump.c (rb_vm_bugreport), vm_eval.c (rb_backtrace): gets rid
	  of allocating objects.  [ruby-core:21619]

	* vm_eval.c (rb_backtrace_each): new function which iterates over
	  each backtrace info.

Mon Feb  2 06:51:36 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* encoding.c (rb_filesystem_encoding): Windows' filesystem encoding is
	  sometimes ANSI code page and sometimes OEM code page. we should check
	  whether code page is used.

Sun Feb  1 21:27:55 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_ipv4_private_p): new method.
	  (addrinfo_ipv4_loopback_p): ditto.
	  (addrinfo_ipv4_multicast_p): ditto.

Sun Feb  1 16:10:06 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (Switch#summarize): strips an equal sign from
	  short option, and fills right sides in shorter lines.
	  [ruby-talk:326414]

Sun Feb  1 05:19:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_const_get_0), vm_insnhelper.c (vm_get_ev_const):
	  avoids infinite self recursion autoload.  [ruby-core:21696]

Sat Jan 31 22:50:38 2009  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb (assert_equal): show class in failure
	  message if meaningful.

Sat Jan 31 22:38:46 2009  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS#each_address): don't query IPv6 address
	  if the host has no global IPv6 address.

Sat Jan 31 22:29:05 2009  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (STR2CSTR): removed.
	  (rb_str2cstr): removed.

	* object.c (rb_str2cstr): removed.

Sat Jan 31 20:07:59 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_ipv6_unspecified_p): new method.
	  (addrinfo_ipv6_loopback_p): ditto.
	  (addrinfo_ipv6_multicast_p): ditto.
	  (addrinfo_ipv6_linklocal_p): ditto.
	  (addrinfo_ipv6_sitelocal_p): ditto.
	  (addrinfo_ipv6_v4mapped_p): ditto.
	  (addrinfo_ipv6_v4compat_p): ditto.
	  (addrinfo_ipv6_mc_nodelocal_p): ditto.
	  (addrinfo_ipv6_mc_linklocal_p): ditto.
	  (addrinfo_ipv6_mc_sitelocal_p): ditto.
	  (addrinfo_ipv6_mc_orglocal_p): ditto.
	  (addrinfo_ipv6_mc_global_p): ditto.

Sat Jan 31 19:09:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_require_safe): raises when the path to be loaded is
	  tainted.  [ruby-dev:37843]

Sat Jan 31 18:08:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (optflags): defaulted to -O3 to get rid of slug of
	  gcc 4.3.

Sat Jan 31 18:03:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (List#accept, parse_in_order): n option is no
	  longer needed.

Sat Jan 31 14:12:43 2009  Tanaka Akira  <akr@fsij.org>

	* lib/pathname.rb (Pathname#each_child): new method.

Sat Jan 31 00:07:49 2009  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb
	  (Test::Unit::Assertions#assert_nothing_raised): suppress warning.
	  [ruby-core:21312]

Fri Jan 30 21:49:32 2009  Tanaka Akira  <akr@fsij.org>

	* lib/pathname.rb (Pathname#realdirpath): new method based on the
	  patch in [ruby-dev:36560] by Akinori MUSHA.
	  [ruby-dev:36290]

Fri Jan 30 18:04:23 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_write): limit write size to 32KB if the file
	  seems to be console.  [ruby-core:21613]

Fri Jan 30 16:12:32 2009  TAKAO Kouji  <kouji@takao7.net>

	* ext/curses/curses.c (Init_curses): Curses#crmode and
	  Curses#nocrmode changes to the module function.
	  fix #916

Fri Jan 30 14:31:14 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/make-snapshot (prereq): remove enc.mk from tarball because
	  BSD make checks $(srcdir)/enc.mk and try to run $(builddir)/enc.mk.

Fri Jan 30 14:11:48 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/depend: extract compile rules to each target for nmake.

Fri Jan 30 12:59:49 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (RUBYDEF): depends on makefiles.

	* cygwin/GNUmakefile.in (RUBYDEF): adds DATA to non-function symbols
	  which is not marked as T.

Fri Jan 30 11:03:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_respond_to): gets rid of
	  overcounting.   [ruby-dev:37703]

Fri Jan 30 02:55:56 2009  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_init_by_convpath_i): make it static.

Thu Jan 29 16:22:41 2009  Shugo Maeda  <shugo@ruby-lang.org>

	* load.c (rb_feature_provided): should not calculate len by pointer
	  subtraction because feature may be a expanded path.
	  [ruby-core:21267]

Thu Jan 29 14:12:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (BASERUBY): erases RUBYOPT at the test.

	* configure.in (OBJCOPY): not used on Windows.

Thu Jan 29 13:16:11 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/securerandom.rb (SecureRandom.uuid): uses unpacked array
	  instead of string, because String#[] returns one length string.

Thu Jan 29 12:29:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake.rb (FileUtils#rake_system): no longer needs workaround
	  on Windows.  [ruby-core:21339]

	* lib/rake/win32.rb (Rake::Win32#rake_system): ditto.

	* lib/rake/win32.rb (Rake::Win32#win32_system_dir): no longer
	  needs environment variables other than APPDATA now.

	* lib/rake.rb (Rake::Application#standard_system_dir): uses
	  platform specific definition on Windows system.

Thu Jan 29 12:18:54 2009  Technorama Ltd.  <oss-ruby@technorama.net>

	* lib/securerandom.rb: new method SecureRandom#uuid

Thu Jan 29 11:22:19 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/raddrinfo.c (inspect_sockaddr): if defined AF_INET6,
	  perhaps can inspect IPv6 addresses if not defined INET6.

	* ext/socket/socket.c (socket_s_ip_address_list): support Windows XP
	  or later. (Win2k or earlier is still not supported)

Thu Jan 29 00:24:48 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (zstream_run): previous change didn't resolve the
	  problem.

Wed Jan 28 22:51:12 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (zstream_run): desperately guard the variable.
	  [ruby-core:20576]

Wed Jan 28 15:24:11 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* math.c: SEGV is caused by implicit rb_to_float declaration
	  test_complexrational.rb: [BUG] in IA-64 architecture

Tue Jan 27 20:02:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (socks_connect_blocking): moved from
	  sockssocket.c.  [ruby-dev:37834]

	* sockssocket.c (socks_init): don't omit "int" type.

Tue Jan 27 14:41:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (RUBYDEF): needs DATA marks to export
	  non-function symbols.  [ruby-core:21582]

	* win32/mkexports.rb (Exports::Mingw#each_export): ditto.

Tue Jan 27 12:59:55 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/ripper/depend: use VPATH.
	  If a platform doesn't support VPATH, Ruby doesn't support it:
	  for example MSYS. [ruby-core:21570]

Tue Jan 27 12:21:17 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/ripper/depend: lex.c's correct path is ../../lex.c.

Tue Jan 27 11:09:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_header): checks the header depending on
	  platform.

	* lib/mkmf.rb (have_header, find_header): use try_header.

	* win32/Makefile.sub (try_header): uses try_compile to get rid of
	  slow -E option of VC.

Tue Jan 27 11:03:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (distclean-enc, realclean-enc): do not call clean of
	  enc.mk twice or more.

	* enc/depend (cleanobjs): added deffile.

	* lib/mkmf.rb (create_makefile): removes deffile at clean instead
	  of distclean.

	* win32/Makefile.sub (miniruby, LIBRUBY_SO): removes lib and exp
	  files.

	* win32/Makefile.sub (clean, distclean): have moved to common.mk.

	* win32/rmdirs.bat: omits `not empty' message.

Tue Jan 27 10:15:33 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (struct rb_transcoding): added ary member for debug.

Tue Jan 27 10:10:14 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Doxyfile.in (FILE_VERSION_FILTER, INPUT_FILTER): should not use
	  ./miniruby directly for cross compiling.

Tue Jan 27 04:02:53 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/ripper/depend: fixed dependency path to lex.c.
	  [ruby-core:21570]

Tue Jan 27 03:43:34 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_any_hash): fixed performance issues with nil, true,
	  false as hash keys.  a patch from Matthias Waechter.
	  [ruby-core:21568]

Tue Jan 27 03:23:43 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): should point correct path to
	  ruby.h and defines.h.   [ruby-core:21569]

Mon Jan 26 16:00:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_aset): fixed arguments evaluation order.

Mon Jan 26 15:49:42 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pathname.rb (chop_basename, prepend_prefix): use o option.

Sun Jan 25 16:35:44 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (socket_s_ip_address_list): renamed from
	  socket_s_list_ip_address.  [ruby-dev:37806]

Sun Jan 25 12:17:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (RUBYDEF): needs read-only section too.

Sun Jan 25 12:02:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (clean-ext): condition of EXTS was inverted.

Sun Jan 25 11:50:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): fixed the variables order because
	  converter proc refers the separator.

Sun Jan 25 11:25:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, win32/Makefile.sub (RMDIRS): remove directory and
	  parents.

	* Makefile.in, win32/Makefile.sub (distclean-rdoc): added to remove
	  temporary rdoc.

	* Makefile.in, win32/Makefile.sub (clean-ext): skips non-existent
	  directories.

	* common.mk (clean, distclean): cleans rdoc.

	* common.mk (clean-extout): removes extout directory.

	* configure.in (RMDIRS, RMALL): added to clean extout.

	* lib/fileutils.rb (FileUtils#rmdir): added :parents option.

	* lib/mkmf.rb (create_makefile): cleans installed files at clean
	  instead of distclean.

	* lib/mkmf.rb (create_makefile): added clean-so and clean-rb.

	* lib/mkmf.rb (def init_mkmf): added DISTCLEANDIRS.

	* lib/un.rb (rmdir): added -p option.

	* tool/rmdirs, win32/rmdirs.bat: removes directory and the parents.

	* win32/rm.bat: added -r option.

Sun Jan 25 09:09:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (join_path): use strlcat() to force link.

	* dir.c (glob_helper): no strcpy() is needed since len is known.

Sun Jan 25 06:44:58 2009  Technorama Ltd.  <oss-ruby@technorama.net>

	* ext/openssl/ossl_ssl.c: Server Name Indication support.
	  new methods SSLContext#server_name_cb=, SSLSocket#hostname=.

	* test/openssl/test_ssl.rb: Tests for above.

Sat Jan 24 08:22:35 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): tools under the top source
	  directory are not installed, so unusable outside extmk.rb.

Fri Jan 23 17:24:31 2009  WATANABE Hirofumi  <eban@ruby-lang.org>

	* golf_prelude.rb (Enumerator#inspect): avoid warning.

Fri Jan 23 15:12:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (mkintpath): new function which converts native path
	  to format acceptable in Makefile.

	* lib/mkmf.rb (configuration): leaves PATH_SEPARATOR unchanged.

	* lib/mkmf.rb (configuration): converts srcdir, topdir and hdrdir.
	  a patch by Alexey Borzenkov <snaury AT gmail.com> at
	  [ruby-core:21448].

	* lib/mkmf.rb (try_func): got rid of c-mode confusion.

Fri Jan 23 13:26:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (trap_handler): also accepts symbols.  [ruby-dev:37823]

Thu Jan 22 18:14:04 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): removes installed files under
	  extout at distclean.

Thu Jan 22 17:12:37 2009  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (CGI.parse): generate only key on params hash
	  if request have only key uri parameters.
		(ex. index.cgi?aaa&bbb=1 # params=>{:aaa=>[],:bbb=>["1"]})

	* test/cgi/test_cgi_core.rb: fix test for key only params.

Thu Jan 22 16:29:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/installer.rb (Gem::Installer#initialize): fixed
	  typos.

	* test/rubygems/test_gem.rb (test_self_dir): removed false
	  assertions.

	* test/rubygems/test_gem.rb (test_self_set_paths): checks if paths
	  are included.

	* test/rubygems/test_gem_commands_install_command.rb
	  (test_execute_remote): checks diagnostic message too.

	* test/rubygems/test_gem_installer.rb (load): uses Gem.ruby.

	* test/rubygems/gemutilities.rb (Gem.ruby): initializes from the
	  environment variable to run without installation.

	* test/rubygems/gemutilities.rb (RubyGemTestCase#util_build_gem):
	  creates cache directory.

Thu Jan 22 16:12:51 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* revert previous revision.  it's already out-of-date.

Thu Jan 22 15:54:02 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h, win32/win32.c (rb_w32_is_valid_fd): new function
	  to validate fd.

	* io.c (rb_io_initialize): check fd with above function.

Thu Jan 22 14:53:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_process.rb (MANDATORY_ENVS): needs RUBYLIB to run
	  tests without install.

Thu Jan 22 12:19:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (define_final): cannot define finalizer for immediate
	  values.  [ruby-core:21500]

	* gc.c (define_final): freezes or hides internal values.

Thu Jan 22 11:33:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_time_timeval): made a real prototype.  a patch from
	  Marcus Rueckert <darix AT opensu.se> at [ruby-core:21492].

Wed Jan 21 21:43:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_ungetbyte, rb_io_ungetc): allows nil to reset EOF
	  flag with ungetting nothing.

	* ruby.c (load_file_internal): rests EOF flag to make possible to
	  load from stdin after reading data.

Wed Jan 21 17:17:18 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (ary_double_capa): a new function to expand array more
	  aggressively.   [ruby-core:21460]

	* array.c (rb_ary_store): use ary_double_capa().

	* array.c (rb_ary_unshift_m): ditto.

	* array.c (rb_ary_splice): ditto.

Wed Jan 21 15:32:15 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_ungetbyte, rb_io_ungetc): clears EOF flag.

Wed Jan 21 14:41:48 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* array.c (take_items): to_ary() raises ArgumentError if cannot to
	  convert to Array. [ruby-dev:37797]

Wed Jan 21 14:32:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (debug_lines): calls rb_intern() once.

Wed Jan 21 13:58:17 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h (FMODE_EOF): EOF flag on TTY.

	* io.c (io_set_eof): sets EOF flag for TTY.

	* io.c (io_seek): clears EOF flag.

	* io.c (io_fillbuf): returns EOF if already met EOF.  [ruby-dev:37798]

	* io.c (io_fillbuf, io_fread, io_getpartial): sets EOF.

Wed Jan 21 08:22:04 2009  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.3.1 r4532.
	* test/minitest/*.rb: ditto.

Tue Jan 20 20:16:21 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (socket_s_list_ip_address): new method.
	  (sockaddr_obj): new function.

	* ext/socket/rubysocket.h: include ifaddrs.h, sys/ioctl.h,
	  sys/sockio.h, net/if.h if available.
	  (addrinfo_new): declared.

	* ext/socket/raddrinfo.c (addrinfo_new): exported.

	* ext/socket/extconf.rb: check ifaddrs.h, sys/ioctl.h, sys/sockio.h,
	  net/if.h and getifaddrs.

Tue Jan 20 20:05:21 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (pseudo_AF_FTIP): moved from mkconstants.rb.

	* ext/socket/mkconstants.rb: prepend header if -H is not given.

Tue Jan 20 17:50:00 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (nkf_buf): use nkf_char.

Tue Jan 20 16:17:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (ruby_Init_{Continuation_body,Fiber_as_Coroutine}): prefixed
	  with ruby_ to export.

	* ext/continuation/continuation.c, ext/fiber/fiber.c: ditto.

Tue Jan 20 15:32:29 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (miniruby): renames and then removes, to get rid of
	  EPERM on cygwin and mingw.

	* Makefile.in ($(LIBRUBY_SO)): use wildcard option of objcopy.

	* configure.in (DLDFLAGS): do not export all symbols.

	* cygwin/GNUmakefile.in (RUBYDEF): rejects symbols prefixed with
	  Init_.

	* win32/mkexports.rb (Exports::Mingw): includes all symbols as
	  well as mswin32, except for prefixed with Init_.

Tue Jan 20 13:03:50 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (hash): fixed the tail bytes handling in the aligned
	  access case.

Tue Jan 20 09:26:05 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (nkf_buf_push): maybe a bug.

	* ext/nkf/nkf-utf8/nkf.c (options): no need to support help option.

Tue Jan 20 06:48:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (take_items), enum.c (enum_zip): tries to convert to
	  array first.  [ruby-core:21442]

Tue Jan 20 03:50:37 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: Update nkf to 2.0.9.
	  revert -s meaning as Shift_JIS, etc.

Tue Jan 20 03:42:32 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (hash): fixed typo.  [ruby-dev:37791]

Tue Jan 20 01:15:27 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (SOMAXCONN): defined.

Mon Jan 19 22:31:35 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: use erb for generating code.

Mon Jan 19 17:33:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (hash): defaulted to MurmurHash 2.0.

Mon Jan 19 17:29:34 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/defines.h (RUBY_ALIAS_FUNCTION_TYPE): added.

Mon Jan 19 17:24:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (vm_stack_dump_each): used only if debug mode.

Mon Jan 19 16:32:35 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (hash): added MurmurHash 2.0.

Mon Jan 19 14:31:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_execute_interrupts): needs
	  rb_signal_buff_size to be declared.

Mon Jan 19 13:34:25 2009  Koichi Sasada  <ko1@atdot.net>

	* ruby.c (require_libraries): reset th->parse_in_eval while
	  loading libraries.  fixes [ruby-dev:37780]

Mon Jan 19 11:46:39 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_eval.c, eval.c (rb_f_block_given_p): move definition of
	  "iterator?" and "block_given?" to make static.

	* vm.c (vm_get_ruby_level_caller_cfp): make it static.

	* eval_intern.h, vm_insnhelper.c: move decl. of
	  vm_get_ruby_level_caller_cfp()
	  from eval_intern.h to vm_insnhelper.c.

Mon Jan 19 11:27:39 2009  Koichi Sasada  <ko1@atdot.net>

	* vm.c: add a prefix "rb_" to exposed functions
	  vm_get_ruby_level_next_cfp(), rb_vm_make_env_object(),
	  vm_stack_to_heap(), vm_make_proc(), vm_invoke_proc(),
	  vm_get_sourceline(), vm_cref(), vm_localjump_error(),
	  vm_make_jump_tag_but_local_jump(), vm_jump_tag_but_local_jump().
	  This changes may affect only core because most of renamed functions
	  require a pointer of not-exposed struct such as rb_thread_t or NODE.
	  In short, they are core functions.

	* cont.c, eval.c, eval_intern.h, load.c, proc.c, thread.c,
	  vm_core.h, vm_dump.c, vm_eval.c, vm_exec.c, vm_insnhelper.c:
	  ditto.

Mon Jan 19 11:22:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/rubysocket.h (rb_cUNIXSocket, rb_cUNIXServer),
	  (unixpath, unixaddr): UNIX domain sockets depend on sys/un.h.

Mon Jan 19 11:02:30 2009  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c: add a prefix "rb_vmdebug_" to
	  vm_stack_dump_raw(), vm_stack_dump_raw_current(),
	  vm_env_dump_raw(), vm_proc_dump_raw(), vm_stack_dump_th(),
	  vm_debug_print_register(), vm_thread_dump_regs(),
	  vm_debug_print_pre(), vm_debug_print_post(),
	  vm_thread_dump_state().
	  This change also may affect core (in fact, user of
	  above functions may be only ko1).

	* vm_core.h: ditto.

	* vm_exec.h (SDR2): remove duplicate definition.

Mon Jan 19 11:00:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/raddrinfo.c (addrinfo_ip_port): use AF_INET6 only when
	  defined, as well as addrinfo_ipv6_p().

Mon Jan 19 10:43:38 2009  Koichi Sasada  <ko1@atdot.net>

	* gc.c (garbage_collect_with_gvl): suppress warnings.

Mon Jan 19 10:34:32 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/depend: workaround for nmake. files in depend without
	  paths should converted by RULE_SUBST, but mkmf.rb cannot recognize
	  macros currently.

Mon Jan 19 09:53:43 2009  Koichi Sasada  <ko1@atdot.net>

	* iseq.c:
	  rename ruby_iseq_disasm_insn() -> rb_iseq_disasm_insn().
	  rename ruby_iseq_disasm() -> rb_iseq_disasm().

	* compile.c:
	  rename ruby_iseq_compile() -> rb_iseq_compile_node().
	  rename ruby_iseq_translate_threaded_code() ->
	         rb_iseq_translate_threaded_code().
	  rename ruby_insns_name_array() -> rb_insns_name_array().
	  rename ruby_iseq_build_from_ary() -> rb_iseq_build_from_ary().

	* iseq.c, compile.c: remove ruby_insn_make_insn_table() and make
	  static function insn_make_insn_table().

	* iseq.h, ruby.c, vm.c, vm_core.h, vm_eval.c, vm_dump.c,
	  blockinlining.c: ditto.
	  Rename strange "ruby_" prefix to "rb_" prefix.
	  This changes may affect only core because renamed functions
	  require a pointer of rb_iseq_t which is not exposed.

Mon Jan 19 09:21:04 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/mkconstants.rb: define macros with default value in
	  constdefs.h if not exist them.

	* ext/socket/raddrinfo.c (addrinfo_mdump, addrinfo_mload): support
	  UNIX socket only on platforms which support it.

Mon Jan 19 08:56:53 2009  Koichi Sasada  <ko1@atdot.net>

	* eval.c, vm_eval.c (rb_f_local_variables): move definition from eval.c
	  to vm_eval.c because vm_collect_local_variables_in_heap() should
	  be static function.

	* vm.c (vm_collect_local_variables_in_heap): make it static.

Mon Jan 19 04:06:10 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (rb_iseq_load): renamed from ruby_iseq_load, since it is
	  for C extensions or the ruby core.  [ruby-core:21407]

Mon Jan 19 03:06:22 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (str_transcode0): fix: :xml option doesn't
	  work on str.encode([options]) form without default_internal.

Sun Jan 18 16:56:46 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_inspect_sockaddr): new
	  method AddrInfo#inspect_sockaddr.
	  (inspect_sockaddr): extracted from addrinfo_inspect.
	  (addrinfo_inspect): use inspect_sockaddr.
	  (Init_addrinfo): define the new method.

Sun Jan 18 16:46:37 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_ip_address): new method
	  AddrInfo#ip_address.
	  (addrinfo_ip_port): new method AddrInfo#ip_port.
	  (Init_addrinfo): define the methods above.

Sun Jan 18 14:29:52 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/unixsocket.c: redundant #ifdef removed.

Sun Jan 18 03:33:23 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_mdump): don't use symbol.
	  (addrinfo_mload): ditto.

Sun Jan 18 03:05:20 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (addrinfo_mdump): new method.
	  (addrinfo_mload): new method.
	  (Init_addrinfo): define the method above.

	* ext/socket/constants.c (constant_arg): str_to_int's first argument
	  constified.

	* ext/socket/mkconstants.rb (gen_name_to_int_decl): generated
	  function's first argument constified.
	  (gen_name_to_int_func_in_guard): ditto.
	  (ipproto_to_int): generated.

	* ext/socket/rubysocket.h (IS_IP_FAMILY): moved from raddrinfo.c.

Sun Jan 18 01:37:50 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_s_getnameinfo): accept AddrInfo object.

	* ext/socket/raddrinfo.c (rb_check_sockaddr_string_type): defined.

	* ext/socket/rubysocket.h (rb_check_sockaddr_string_type): declared.

Sat Jan 17 22:01:15 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb: new file.

Sat Jan 17 19:33:48 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in (VCSUP): fixed the cases for git-svn or git.

	* win32/Makefile.sub (VCSUP): ditto.

	* Makefile.in (up): `cd' is necessary for git and git-svn.

Sat Jan 17 19:16:16 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: generate a header file for generated
	  functions.

	* ext/socket/rubysocket.h: include constdefs.h.  don't declare
	  generated functions.

	* ext/socket/constants.c: include constdefs.c instead of constants.h.

	* ext/socket/depend: dependency updated.

Sat Jan 17 17:58:22 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/xmp.rb: multilingualizes XMP::StringInputMethod.
	  [ruby-core:21383].

Sat Jan 17 15:01:22 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (make_inspectname): add a res argument to
	  suppress numeric inspectname.
	  (init_addrinfo_getaddrinfo): call make_inspectname here.
	  (addrinfo_firstonly_new): follow make_inspectname change.
	  (addrinfo_list_new): ditto.
	  (addrinfo_initialize): follow init_addrinfo_getaddrinfo change.

Sat Jan 17 14:52:27 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: don't cause an error for duplicate names.

Sat Jan 17 12:46:17 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket: split files for each class.

	* ext/socket/rubysocket.h: common header.

	* ext/socket/basicsocket.c: new file for BasicSocket.

	* ext/socket/ipsocket.c: new file for IPSocket.

	* ext/socket/tcpsocket.c: new file for TCPSocket.

	* ext/socket/tcpserver.c: new file for TCPServer.

	* ext/socket/sockssocket.c: new file for SOCKSSocket.

	* ext/socket/udpsocket.c: new file for UDPSocket.

	* ext/socket/unixsocket.c: new file for UNIXSocket.

	* ext/socket/unixserver.c: new file for UNIXServer.

	* ext/socket/socket.c: now for Socket.

	* ext/socket/raddrinfo.c: new file for AddrInfo and name resolution.

	* ext/socket/constants.c: new file for constants.

	* ext/socket/init.c: new file for utilities.

	* ext/socket/mkconstants.rb: export *_to_int.

	* ext/socket/extconf.rb: add new object files.

	* ext/socket/depend: add dependencies for new files.

	* ext/.document: add new files.

Sat Jan 17 11:12:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_restore_0): padding size doesn't need to be large
	  if alloca is used.  suppress warnings.

Sat Jan 17 11:12:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (vm_stack_dump_each): initialized at declarations.

	* vm_dump.c (rb_vm_bugreport): constified to suppress a warning.

Fri Jan 16 22:30:27 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c: move addrinfo code.

Fri Jan 16 18:51:11 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (up): tell nmake that need to run command via
	  shell.

Fri Jan 16 18:43:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot (package): includes all rules and expand
	  configured values from the environment to create *.inc, sets RM
	  for ripper.c, and needs chdir if absolute path is given with
	  -exported option.

Fri Jan 16 18:26:47 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (VALUE): use unsigned long or long long
	  instead of uintptr_t, since many %lx and so on are still used.

Fri Jan 16 17:33:59 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): set VCS and VCSUP to support `git svn'
	  and git.

	* Makefile.in, win32/Makefile.sub (up): split from common.mk.

Fri Jan 16 12:24:39 2009  Koichi Sasada  <ko1@atdot.net>

	* thread.c (thread_start_func_2): call ruby_cleanup() if thread is
	  main thread.  [ruby-dev:37624]

Fri Jan 16 12:27:50 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub ($(INSNS), node_name.inc, known_errors.inc,
	  miniprelude.c, newline.c): if dependencies is newer than targets or
	  targets don't exist, try to create targets with BASERUBY. no need to
	  detect errors there because the absence of BASERUBY is not abnormal.
	  after the try, if the targets still don't exist, copy them from
	  $(srcdir).

Fri Jan 16 12:15:07 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (PRI_PTRDIFF_PREFIX): must define as string.
	  if not, cause compile error in using PRI?VALUE.

	* win32/Makefile.sub (config.h): add SIZEOF_INTPTR_T and
	  SIZEOF_UINTPTR_T for SIZEOF_VALUE.

Fri Jan 16 11:51:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* symbian/pre-build (COMSPEC): should not overridden.

Fri Jan 16 11:47:56 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_parse_in_main): fixed typo.

Fri Jan 16 11:41:23 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_REPLACE_TYPE): does not define rb_ prefixed
	  name if no default type is given.

	* configure.in (RUBY_DEFINT): checks size.

	* include/ruby/ruby.h (PRI_PTRDIFF_PREFIX, PRI_SIZE_PREFIX):
	  assumes usable if PRIdPTR is defined.

Fri Jan 16 02:25:46 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (rb_thread_execute_interrupts): if signal is already
	  buffered, main thread should wait until timer thread delivers it.

	* thread.c (timer_thread_function): should defer delivery of a signal
	  if main thread does not yet trap a previous one.  [ruby-dev:37676]

Fri Jan 16 02:05:55 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (addrinfo_s_ip): new method AddrInfo.ip.

Fri Jan 16 01:42:50 2009  Koichi Sasada  <ko1@atdot.net>

	* thread.c (call_trace_proc): as Matz said ([ruby-core:21183]),
	  should skip rb_str_new2() if rb_sourcefile() returns NULL.
	  rb_sourcefile() returns NULL if frame is toplevel of Fiber.
	  [ruby-core:21161] [Bug #985]

Fri Jan 16 01:09:37 2009  Koichi Sasada  <ko1@atdot.net>

	* ruby.c (process_options): decrement parse_in_eval to recognize
	  parsing main or normal eval script.

	* compile.c (rb_parse_in_main): return 1 if parsing main script.
	 (if parse_in_eval is negative value, it means main script)

	* parse.y (yycompile0): check rb_parse_in_main() to accumulate
	  script text.  Bug #848 [ruby-core:20450]

Fri Jan 16 00:57:34 2009  Koichi Sasada  <ko1@atdot.net>

	* lib/debug.rb: as wanabe-san pointed out,
	  set_trace_func should be completely final task in debug.rb.
	  Bug #847 [ruby-core:20449]

Fri Jan 16 00:27:03 2009  Koichi Sasada  <ko1@atdot.net>

	* vm.c (rb_vm_inc_const_missing_count, ruby_vm_const_missing_count):
	  added.

	* vm_insnhelper.h: ditto.

	* variable.c (rb_const_get_0), insns.def: Constants should not be
	  cached if const_missing is called.  [ruby-core:21059] [Bug #967]

	* bootstraptest/test_class.rb: add a test.

Fri Jan 16 00:25:09 2009  Koichi Sasada  <ko1@atdot.net>

	* common.mk: btest-ruby should receive option with OPTS.

Fri Jan 16 00:21:10 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub ($(INSNS), node_name.inc, known_errors.inc,
	  miniprelude.c, newline.c): shouldn't copy when $(srcdir) != ".", too.
	  (this is a workaround.  we need more strict check.)

	* win32/Makefile.sub ($(INSNS)): shouldn't remove BASERUBY.

Fri Jan 16 00:19:55 2009  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_with_gvl): suppress warnings.

Thu Jan 15 20:44:30 2009  Tanaka Akira  <akr@fsij.org>

	* tool/file2lastrev.rb: RUBY_REVISION must be an integer.

Thu Jan 15 15:55:31 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (enc_set_default_encoding): should not treat US-ASCII
	  special here.  a patch from Yui NARUSE in [ruby-dev:37769].
	  [ruby-dev:37699]

Thu Jan 15 14:27:27 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* LEGAL: Added information for missing/langinfo.c

Thu Jan 15 14:17:57 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (stmt): explicit error for "Object::Far += foo 1" just
	  as "Object::Far += 1".

	* parse.y (command): moved return/break/next from command_call for
	  better error message.

	* parse.y (call_args): void value check added.

Thu Jan 15 13:10:58 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (COMPILERFLAG): for enc/trans/gb18030.c.

Thu Jan 15 13:10:09 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, win32/Makefile.sub (MISSING): added langinfo on mingw
	  and mswin.

	* encoding.c (rb_locale_charmap): use environments on mingw and mswin.

	* missing/langinfo.c (nl_langinfo_codeset): MS-Windows Japanese
	  environment uses Windows-31J derived from Shift_JIS, not EUC-JP.

Thu Jan 15 12:10:39 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub ($(INSNS), node_name.inc, known_errors.inc,
	  miniprelude.c, newline.c): copy only when $(srcdir) != pwd.

Thu Jan 15 11:40:44 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (pipe_open): revert a part of previous commit. it may be a
	  mistake.

Thu Jan 15 10:45:52 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* symbian/README.SYMBIAN: symbian support added.  great appreciate
	  to <alexandre.zavorine at symbian.com>.

Thu Jan 15 00:06:12 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/gb18030.trans: get rid of a 1.9 feature for cross
	  compile.  [ruby-core:21345]

Wed Jan 14 23:57:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_locale_charmap): fallback to codepage if no
	  locale is found.  [ruby-core:21110]

	* missing/langinfo.c (nl_langinfo_codeset): returns NULL if no
	  locale is found.

Wed Jan 14 22:38:30 2009  Tanaka Akira  <akr@fsij.org>

	* gc.c (negative_size_allocation_error_with_gvl): abolish a warning.
	  (negative_size_allocation_error): ditto.

	* ext/openssl/ossl.c (ossl_raise): ditto.

Wed Jan 14 20:05:05 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/gb18030.trans, gb18030-tbl.rb:
	  new Chinese GB18030 transcoding (from Yoshihiro Kambayashi)

	* test/ruby/test_transcode.rb: added tests for the above
	  (from Yoshihiro Kambayashi)

	* transcode_data.h, transcode.c, tool/transcode_tblgen.rb:
	  added support for GB18030-specific 4-byte sequences
	  (with Yoshihiro Kambayashi)

Wed Jan 14 16:16:19 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/extconf.rb: check ncursesw earlier than ncurses to
	  support UTF-8 strings.  non UTF-8 strings should be converted
	  explicitly.  [ruby-core:21094]

Wed Jan 14 14:42:30 2009  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* cont.c: fix prototype declare of register_stack_extend

Wed Jan 14 13:19:21 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_aspawn): should not escape with caret
	  unless using cmd.exe.

Wed Jan 14 13:09:00 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/extconf.rb (gai_strerror): checks if available and if
	  returns const pointer.

	* ext/socket/getaddrinfo.c (gai_strerror): defines only if non
	  available.  [ruby-core:21328]

Wed Jan 14 12:39:16 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_wait_readable, rb_io_wait_writable): need rb_fd_ptr.

	* io.c (appendline): reformed.

	* io.c (rb_io_s_pipe): reduced nest of rb_ensure of main block.

Tue Jan 13 22:56:57 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/addrinfo.h (AI_NUMERICSERV): defined.
	  (AI_MASK): add AI_NUMERICSERV.

	* ext/socket/getaddrinfo.c (getaddrinfo): support AI_NUMERICSERV.

Tue Jan 13 21:45:53 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/ostruct.rb (OpenStruct#inspect): fixed the recursion check.
	  Patch by Kornelius Kalnbach.  [ruby-core:20992].

	* test/ostruct/test_ostruct.rb: test for inspect.
	  Patch by Kornelius Kalnbach.  [ruby-core:20992].

Tue Jan 13 21:44:30 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_reopen, rb_io_init_copy): should register fptr to pipe_list
	  when copying pipe fptr.

Tue Jan 13 21:38:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rb_getaddrinfo): use getaddrinfo with GVL if
	  getaddrinfo.c/getnameinfo.c is used.  They are not thread safe
	  because gethostbyname/gethostbyaddr is used.
	  (rb_getnameinfo): ditto.

	* extconf.rb: define GETADDRINFO_EMU if getaddrinfo.c/getnameinfo.c is
	  used.

Tue Jan 13 21:28:14 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* object.c (rb_obj_not_match): rdoc.
	  Patch by Kornelius Kalnbach.  [ruby-core:20991]

Tue Jan 13 18:21:44 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_close_read): call rb_io_fptr_cleanup() instead of
	  fptr_finalize() because the fptr has special finalizer if it is a
	  pipe.  [ruby-dev:37757] (3)

Tue Jan 13 18:19:49 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_initialize): workaround for Windows. [ruby-dev:37686]
	  (also see [ruby-dev:37721])

Tue Jan 13 17:29:02 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/make_transdb.rb (converters): should not depend on the
	  hash order for cross compile.

Tue Jan 13 16:39:11 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/intern.h, thread.c, win32/Makefile.sub (rb_fdset_t,
	  rb_fd_init, rb_fd_term, rb_fd_zero, rb_fd_set, rb_fd_clr, rb_fd_isset,
	  rb_fd_select, rb_fd_ptr, rb_fd_max, HAVE_RB_FD_INIT): new type,
	  functions, and macros for Windows.

	* win32/win32.c (extract_fd, rb_w32_select): use rb_fdset_t to expand
	  fd_array if needed.  [ruby-core:19946]

	* win32/win32.c (copy_fd): new function for rb_w32_select().

Tue Jan 13 12:31:54 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/file2lastrev.rb (get_revisions): fixes problem with
	  svn on cygwin. [ruby-dev:37702].
	  Patch by Kouhei Sutou.

Tue Jan 13 11:58:04 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/input-method.rb: IRB did not prompt for MSwin32.
	  [ruby-dev:37686].
	  Patch by arton <artonx AT yahoo.co.jp>.

Tue Jan 13 12:10:42 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/{getaddrinfo,getnameinfo}.c: need to include ws2tcpip.h
	  on Windows.

Tue Jan 13 09:49:49 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* ext/socket/socket.c: removed warning about unused variable 'rai'.

Tue Jan 13 03:07:28 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* instruby.rb: require "tool/mdoc2man.rb" before chdir if needed.

Tue Jan 13 02:54:54 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: use headers instead of "netdb.h" in checking
	  getnameinfo() and getaddrinfo() because Windows doesn't have it.
	  [ruby-dev:37757] (1)

	* ext/socket/sockport.h (SA_LEN): use sockaddr_in6 when defined AF_INET6
	  if INET6 is not defined.  winsock2's getaddrinfo() returns
	  sockaddr_in6 if ipv6 is available.

Tue Jan 13 02:21:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (internal_cmd_match): extracted from
	  is_internal_cmd.

	* win32/win32.c (argv_size, join_argv): escapes redirection, pipe
	  and caret punctuations with carets.

	* win32/win32.c (rb_w32_aspawn): ditto, and redirections and pipe
	  have no meanings.

Tue Jan 13 02:07:38 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: use Encoding.find("locale") instead of
	  Encoding.locale_charmap

Tue Jan 13 00:57:56 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_s_unpack_sockaddr_in): check too short
	  sockaddr.
	  (sock_s_unpack_sockaddr_un): ditto.

Mon Jan 12 23:55:19 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (addrinfo_ip_unpack): new method
	  AddrInfo#ip_unpack.
	  (addrinfo_unix_path): new method AddrInfo#unix_path.
	  (Init_socket): define above methods.

Mon Jan 12 23:31:42 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (IS_IP_FAMILY): defined.
	  (addrinfo_ip_p): use it.

Mon Jan 12 17:23:05 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_nothing_raised): removes the
	  current trace to get rid of an issue of MiniTest::Unit#location.

Mon Jan 12 16:49:20 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (install): erased a garbage.

Mon Jan 12 16:45:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (open_dir_handle): extracted from rb_w32_opendir.

	* win32/win32.c (winnt_stat): gets rid of strange behavior of
	  GetFileAttributes().  [ruby-core:21269]

Mon Jan 12 12:43:55 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (parse_args, install): added --strip option.

	* instruby.rb (install_recursive): skips the directory if matched
	  to a no_install pattern ending with a file separator.

Mon Jan 12 12:33:56 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: don't use bytesize because 1.9 dependent.
	  [ruby-core:21266]

Mon Jan 12 11:59:19 2009  Koichi Sasada  <ko1@atdot.net>

	* gc.c (ruby_xmalloc, ruby_xrealloc, ruby_xfree):
	  enable to use them without GVL.
	  if GC is invoked, acquire GVL during GC.
	  if NoMemoryError is raised, acquire GVL and raise it.

Mon Jan 12 10:39:19 2009  Koichi Sasada  <ko1@atdot.net>

	* thread.c: fix comment (terminology: Global VM Lock).

	* thread.c (blocking_region_begin, blocking_region_end):
	  save and clear th->blocking_region_buffer.

	* thread.c (rb_thread_call_with_gvl): check if it has GVL.

	* thread.c (ruby_thread_has_gvl_p): added.

	* vm_core.h: add decls.

Mon Jan 12 10:21:11 2009  Koichi Sasada  <ko1@atdot.net>

	* eval.c: remove unused decl.

Sun Jan 11 16:53:14 2009  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/erb.rb (PercentScanner): remove PercentScanner. fixed % after
	  %> bug. [ruby-dev:37751] [Bug #997]

	* test/erb/test_erb.rb: ditto

Sun Jan 11 09:53:01 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/mkconstants.rb (c_str): get rid of a 1.9 feature for
	  cross compile.  [ruby-core:21243]

Sun Jan 11 09:47:30 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_s_create): set nil as the value if assoc length
	  is not enough.  [ruby-core:21249]

Sat Jan 10 21:17:28 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: don't generate unintended newlines.

Sat Jan 10 20:50:02 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: refactored to nest properly in statically
	  and dynamically.

Sat Jan 10 20:26:17 2009  Tanaka Akira  <akr@fsij.org>

	* version.h: make version string succinct:
	  "ruby 1.9.1p5000 (2009-01-10 trunk 21414) [i686-linux]".

Sat Jan 10 19:05:13 2009  Koichi Sasada  <ko1@atdot.net>

	* cont.c (cont_restore_1): should not be inlined.

Fri Jan  9 21:52:47 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_define_const): use INT2NUM.

Fri Jan  9 15:40:07 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/mkconstants.rb: define macro if default_value is passed.

Fri Jan  9 13:20:08 2009  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: rescue abnormal Encoding.locale_charmap value.

Fri Jan  9 12:29:46 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (test-sample), rubytest.rb: use runruby.rb

Fri Jan  9 10:40:52 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess::MANDATORY_ENVS): some
	  platforms need environments for shared objects.

Thu Jan  8 23:19:38 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (bsock_shutdown): accept symbol/string as how.
	  (shutdown_how_arg): new function.

	* ext/socket/mkconstants.rb: generate shutdown_how_to_int.

Thu Jan  8 23:16:37 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* instruby.rb: easy code contains fewer bugs.

Thu Jan  8 22:59:30 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (gen_name_to_int_func): generate
	  name_to_int functions, not only body.

Thu Jan  8 22:44:10 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c: don't use AI_NUMERICSERV for platforms which
	  not define it as old Windows.
	  [ruby-dev:37736]

Thu Jan  8 17:32:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb: should not depend on a library which does not exist
	  in 1.8.

Thu Jan  8 07:52:55 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (init_unix_addrinfo): don't return a value.

Thu Jan  8 07:30:52 2009  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI.redirectable?): reverted https redirection.

Thu Jan  8 00:31:58 2009  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb (assert_no_match): don't count up as two
	  assertions.

Thu Jan  8 00:26:35 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (addrinfo_getnameinfo): use NI_DGRAM if socktype
	  is SOCK_DGRAM.

Thu Jan  8 00:16:22 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (host_str): add flags_ptr argument to specify
	  AI_NUMERICHOST if host is numeric form.
	  (port_str): add flags_ptr argument to specify AI_NUMERICSERV if port
	  is numeric form.

Wed Jan  7 22:24:12 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rb_cAddrInfo): new class AddrInfo.
	  (s_recvfrom): return AddrInfo as address.
	  (s_recvfrom_nonblock): ditto.
	  (sock_accept): ditto.
	  (sock_accept_nonblock): ditto.
	  (sock_sysaccept): ditto.
	  (bsock_send): accept AddrInfo as address argument.
	  (sock_connect): ditto.
	  (sock_connect_nonblock): ditto.
	  (sock_bind): ditto.
	  (sock_s_unpack_sockaddr_in): ditto.
	  (sock_s_unpack_sockaddr_un): ditto.
	  (bsock_local_address): new method BasicSocket#local_address.
	  (bsock_remote_address): new method BasicSocket#remote_address.
	  (addrinfo_initialize): new method AddrInfo#initialize.
	  (addrinfo_inspect): new method AddrInfo#inspect.
	  (addrinfo_afamily): new method AddrInfo#afamily.
	  (addrinfo_pfamily): new method AddrInfo#pfamily.
	  (addrinfo_socktype): new method AddrInfo#socktype.
	  (addrinfo_protocol): new method AddrInfo#protocol.
	  (addrinfo_to_sockaddr): new method AddrInfo#to_sockaddr.
	  (addrinfo_canonname): new method AddrInfo#canonname.
	  (addrinfo_ip_p): new method AddrInfo#ip?.
	  (addrinfo_ipv4_p): new method AddrInfo#ipv4?.
	  (addrinfo_ipv6_p): new method AddrInfo#ipv6?.
	  (addrinfo_unix_p): new method AddrInfo#unix?.
	  (addrinfo_getnameinfo): new method AddrInfo#getnameinfo.
	  (addrinfo_s_getaddrinfo): new method AddrInfo.getaddrinfo.
	  (addrinfo_s_tcp): new method AddrInfo.tcp.
	  (addrinfo_s_udp): new method AddrInfo.udp.
	  (addrinfo_s_unix): new method AddrInfo.unix.
	  (Init_socket): define new class and methods.
	  (sock_getaddrinfo): apply socktype hack regardless of ai_flags.
	  (addrinfo_new): defined.
	  (get_afamily): ditto.
	  (fd_socket_addrinfo): ditto.
	  (io_socket_addrinfo): ditto.
	  (SockAddrStringValue): ditto.
	  (SockAddrStringValuePtr): ditto.
	  (sockaddr_string_value): ditto.
	  (sockaddr_string_value_ptr): ditto.
	  (rb_addrinfo_t): ditto.
	  (addrinfo_mark): ditto.
	  (addrinfo_free): ditto.
	  (addrinfo_s_allocate): ditto.
	  (IS_ADDRINFO): ditto.
	  (check_addrinfo): ditto.
	  (get_addrinfo): ditto.
	  (alloc_addrinfo): ditto.
	  (init_addrinfo): ditto.
	  (addrinfo_new): ditto.
	  (call_getaddrinfo): ditto.
	  (init_addrinfo_getaddrinfo): ditto.
	  (make_inspectname): ditto.
	  (addrinfo_firstonly_new): ditto.
	  (addrinfo_list_new): ditto.
	  (init_unix_addrinfo): ditto.
	  (ai_get_afamily): ditto.

	* ext/socket/mkconstants.rb: generate intern_protocol_family,
	  intern_socktype and intern_ipproto.

	  [ruby-dev:37692]

Wed Jan  7 22:13:03 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (man, gem): fixed errors.

Wed Jan  7 17:14:40 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb: use installed libraries.  [ruby-core:21006]

	* instruby.rb (gem), lib/rubygems/defaults.rb (Gem.default_dir):
	  use version invariant configuration.

Tue Jan  6 19:09:51 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_restore_0): streamlined to ensure O(1) time.  based on
	  a patch by Brent Roman <brent AT mbari.org>.

Tue Jan  6 00:34:25 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_close_before_exec): more heuristics to detect maximum fd.

Mon Jan  5 17:59:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (cygwin): needs properly implemented nl_langinfo().
	  [ruby-core:21110]

	* missing/langinfo.c: added as suggested at [ruby-core:21015], from
	  http://www.cl.cam.ac.uk/~mgk25/ucs/langinfo.c.

	* missing/langinfo.c (nl_langinfo_0): fixed typos for SJIS.

Mon Jan  5 17:38:40 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* encoding.c (rb_locale_charmap): use GetConsoleCP() instead of
	  GetACP() because external encoding should be console's one.

	* encoding.c (rb_filesystem_encoding): use GetOEMCP() instead of
	  GetACP() because VFAT/FAT32 uses OEM CP.

Mon Jan  5 16:26:48 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_filesystem_encoding): use ANSI codepage for file
	  system on cygwin.

	* encoding.c (rb_locale_charmap): reverted.  [ruby-core:21110]

Mon Jan  5 16:15:00 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/curses/curses.c (free_window): use xfree instead of free.
	  [ruby-dev:37200]

Mon Jan  5 15:49:45 2009  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/gdbm/gdbm.c (rb_gdbm_fetch): remove needless cast.

Mon Jan  5 12:52:08 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (init_env): use user profile folder than personal
	  folder.

Mon Jan  5 08:41:13 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_file_s_stat): need type check for non string values.
	  [ruby-dev:37673]  fix: #964

	* file.c (rb_file_s_size, rb_file_s_atime, rb_file_s_mtime,
	  rb_file_s_ctime, rb_f_test): ditto.

Mon Jan  5 08:17:56 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_step): should not add up errors on loops.
	  [ruby-dev:37691]

Mon Jan  5 07:58:37 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* random.c (rb_f_srand): update RDoc.  [ruby-core:21113]

Mon Jan  5 06:39:56 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_max): max value from ... not defined for non
	  Integer Numeric end values. [ruby-dev:37690] fix: #974

Sun Jan  4 22:37:19 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rb_getaddrinfo): defined for address lookup without GVL.
	  (struct getaddrinfo_arg): defined.
	  (nogvl_getaddrinfo): defined.
	  (rb_getnameinfo): defined for name lookup without GVL.
	  (getnameinfo_arg): defined.
	  (nogvl_getnameinfo): defined.

Sun Jan  4 18:10:10 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/gbk.trans, gbk-tbl.rb:
	  new Chinese GBK transcoding (from Yoshihiro Kambayashi)

	* test/ruby/test_transcode.rb: added tests for the above
	  (from Yoshihiro Kambayashi)

Sun Jan  4 17:55:55 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb: added tests for GB2312
	  (from Yoshihiro Kambayashi)

	* enc/trans/chinese.trans: set valid byte patterns for
	  GB2312 and GB12345

Sun Jan  4 17:39:39 2009  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/big5.trans, big5-tbl.rb:
	  new Chinese Big5 transcoding (from Yoshihiro Kambayashi)

	* test/ruby/test_transcode.rb: added tests for the above
	  (from Yoshihiro Kambayashi)

Sun Jan  4 17:07:45 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems.rb (Gem.set_home, Gem.set_paths): should not create
	  directories stealthily.  [ruby-core:20990]

	* lib/rubygems.rb (Gem.find_home): expand_path deals with platform
	  dependent environments.

	* lib/rdoc/ri/paths.rb (RDoc::HOMEDIR): ditto.

	* instruby.rb (gem): creates gem directories at installation.

Sun Jan  4 15:41:37 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_filesystem_encoding, rb_locale_charmap): uses
	  codepage on cygwin.  [ruby-core:20994]

Sun Jan  4 11:58:43 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (ruby_float_step): extracted from num_step().

	* range.c (range_step): uses ruby_float_step() for float range.
	  [ruby-dev:37691]

Sun Jan  4 11:11:31 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): does not use both of makefile.rb and
	  extconf.rb at the same time.

	* lib/mkmf.rb (DLLIB): depends on Makefile.  [ruby-core:21096]

Sun Jan  4 09:27:41 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (constant_arg): constified.

	* ext/socket/socket.c (optname_arg): cygwin does not have
	  IPPROTO_IPV6.

	* ext/socket/mkconstants.rb (ipv6_optname_to_int): ditto.

Sun Jan  4 04:33:14 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c: redundant #ifdef removed.

Sun Jan  4 03:30:18 2009  Tanaka Akira  <akr@fsij.org>

	* io.c (maygvl_copy_stream_wait_read): renamed to add prefix to
	  express GVL state.
	  (nogvl_copy_stream_wait_write): ditto.
	  (nogvl_copy_stream_sendfile): ditto.
	  (maygvl_copy_stream_read): ditto.
	  (nogvl_copy_stream_write): ditto.
	  (nogvl_copy_stream_read_write): ditto.
	  (nogvl_copy_stream_func): ditto.

Sun Jan  4 00:30:50 2009  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/erb.rb: merged r20850, r17881, r16811, r16763, r16748, r15829,
	  r15794 and r15698 from ruby_1_8.

	* test/erb/test_erb.rb: ditto.

Sat Jan  3 22:24:36 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk, Makefile.in, win32/Makefile.sub (INSNS): move the macro
	  definition from common.mk to {Makefile.in,win32/Makefile.sub}.
	  [ruby-dev:37678]

Sat Jan  3 15:30:09 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/chinese.trans: added for transcoding EUC-CN and GB12345.

	* enc/trans/GB/: ditto.

Sat Jan  3 15:26:30 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/euc-cn.c: renamed from gb2312.c because GB2312 is
	  the name of a CSS.  it's encoding name is "EUC-CN".

Sat Jan  3 03:00:42 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk, Makefile.in, win32/Makefile.sub ($(INSNS), node_name.inc,
	  known_errors.inc, miniprelude.c, newline.c): move rules from common.mk
	  to {Makefile.in,win32/Makefile.sub} for nmake.
	  [ruby-core:20993]

Fri Jan  2 23:51:41 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_sleep.rb (test_sleep_5sec): stop gc.

Fri Jan  2 23:36:10 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c: don't apply socktype hack [ruby-core:184] for
	  sock_s_getaddrinfo.
	  (sock_getaddrinfo): add socktype_hack argument.
	  (sock_addrinfo): call sock_getaddrinfo with socktype_hack.
	  (sock_s_getaddrinfo): call sock_getaddrinfo without socktype_hack.
	  [ruby-dev:37674]

Fri Jan  2 23:33:38 2009  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/missing.h, sprintf.c: get rid of a warning of VC++.

Fri Jan  2 22:25:46 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* process.c: use sigaction instead of sigset.  [ruby-core:21021]

Fri Jan  2 22:22:04 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* bootstraptest/test_proc.rb: suppress error message.

Fri Jan  2 22:20:46 2009  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_process.rb (test_wait_and_sigchild): remove debug
	  output.

Fri Jan  2 17:45:19 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: rename family_to_str to intern_family.
	  it returns ID now.

	* ext/socket/socket.c (ipaddr): use intern_family.

Fri Jan  2 17:20:31 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: use ID in the values of
	  family_to_str_hash.  family_to_str returns a VALUE.

	* ext/socket/socket.c (ipaddr): follow family_to_str change.

Fri Jan  2 17:01:51 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: refactored to gather stringizer
	  description.

Fri Jan  2 15:30:57 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: make common prefix optional.

Fri Jan  2 14:59:52 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: use hash for family_to_str to avoid
	  linear search.  lenp argument removed.

	* ext/socket/socket.c (ipaddr): call family_to_str without lenp
	  argument.

Fri Jan  2 14:33:12 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (gen_int_to_name): don't compare constants
	  in preprocessor because the constants may be enum.

Fri Jan  2 14:11:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (gen_int_to_name): add lenp argument.

	* ext/socket/socket.c (ipaddr): follow argument change.

Fri Jan  2 10:20:24 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/singleton.rb: fix documentation. [ruby-core:21038]

Fri Jan  2 06:43:58 2009  NARUSE, Yui  <naruse@ruby-lang.org>

	* signal.c (rb_signal_buff_size): defined for check whether signal
	  is in the buffer or not.

	* thread_pthread.c (thread_timer): don't exit the loop when signal
	  is in the buffer. [ruby-dev:37637]

Fri Jan  2 04:40:00 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: check duplicates.

Fri Jan  2 02:39:08 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (optname_arg): defined.
	  (bsock_setsockopt): use optname_arg.
	  (bsock_getsockopt): ditto.

	* ext/socket/mkconstants.rb: generate so_optname_to_int,
	  ip_optname_to_int, ipv6_optname_to_int, tcp_optname_to_int and
	  udp_optname_to_int.
	  more constants.

Fri Jan  2 02:08:36 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (constant_arg): extracted from family_arg.
	  (family_arg): use constant_arg.
	  (socktype_arg): ditto.
	  (level_arg): ditto.

Fri Jan  2 01:15:11 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (level_arg): defined.
	  (bsock_setsockopt): use level_arg.
	  (bsock_getsockopt): ditto.

	* ext/socket/mkconstants.rb: generate level_to_int.

Fri Jan  2 00:58:40 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (family_arg): accept symbols as well.
	  (socktype_arg): ditto.

Fri Jan  2 00:49:44 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_s_getaddrinfo): use socktype_arg.

Fri Jan  2 00:12:27 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (family_arg): extracted from
	  setup_domain_and_type.
	  (socktype_arg): ditto.
	  (udp_init): use family_arg.
	  (sock_s_gethostbyaddr): ditto.
	  (sock_s_getaddrinfo): ditto.
	  (sock_s_getnameinfo): ditto.

Thu Jan  1 22:27:55 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/default.mspec: fix for builddir != srcdir

	* Makefile.in: ditto.

Thu Jan  1 21:26:05 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_s_getnameinfo): use family_to_int.

Thu Jan  1 21:08:34 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: check all alias possibility.

Thu Jan  1 20:59:55 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: more possible aliases.

Thu Jan  1 20:54:02 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: AF_ISO and AF_OSI may be aliased.

Thu Jan  1 20:50:09 2009  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* process.c (before_exec): it makes no sense for a conditional
	  expression to return a void value.

Thu Jan  1 20:47:09 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_s_getaddrinfo): use family_to_int.

Thu Jan  1 20:17:47 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c: include constants.h at top.

Thu Jan  1 19:53:33 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: add valp argument for family_to_int and
	  socktype_to_int.

	* ext/socket/socket.c (setup_domain_and_type): use valp argument.

Thu Jan  1 19:36:57 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: generate family_to_str.

	* ext/socket/socket.c (ipaddr): use family_to_str.

Thu Jan  1 17:37:12 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: generate socktype_to_int.

	* ext/socket/socket.c (setup_domain_and_type): use socktype_to_int.

Thu Jan  1 17:26:47 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (setup_domain_and_type): initialize ptr.

Thu Jan  1 17:01:50 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: refine family_to_int.

Thu Jan  1 16:48:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: generate family_to_int().

	* ext/socket/socket.c (setup_domain_and_type): use family_to_int.

Thu Jan  1 15:08:46 2009  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/file2lastrev.rb: supports git repositories which are cloned
	  from a git-svn gateway.
	  Patch by Hongli Lai. [ruby-core:21020]

Thu Jan  1 16:08:11 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: generate init_constants function.

	* ext/socket/socket.c (Init_socket): call init_constants.

Thu Jan  1 16:03:04 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (Socket::AF_INET6): moved from socket.c.
	  (Socket::PF_INET6): ditto.

Thu Jan  1 15:27:07 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: use erb.

Thu Jan  1 15:07:56 2009  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: add -o option.

	* ext/socket/depend: use mkconstants.rb with -o option.

Thu Jan  1 07:42:36 2009  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/singleton.rb: fix indentation of RDoc text.  [ruby-core:21029]

Thu Jan  1 07:16:44 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (distclean-ext, realclean-ext): use EXTS as default.

	* win32/Makefile.sub (distclean-ext, realclean-ext): try to remove ext
	  directory.

Thu Jan  1 06:56:28 2009  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/file2lastrev.rb: unset PWD.

Wed Dec 31 23:37:17 2008  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sock_s_socketpair): yield if a block is given.
	  (io_call_close): defined.
	  (io_close): defined.
	  (pair_yield): defined.

Wed Dec 31 19:35:57 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/README: follows the change of directory structure in rubyspec.

	* spec/default.mspec: ditto. Also follows change of mspec command.

	* Makefile.in: ditto.

Wed Dec 31 17:16:46 2008  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_read_internal): show openssl error
	  code in EWOULDBLOCK error.

Wed Dec 31 15:45:18 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_body): don't check to_io because
	  Zlib::GzipWriter#to_io returns the underlying IO.

Wed Dec 31 14:52:33 2008  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_digest.c (GetDigestPtr): use StringValueCStr
	  instead of STR2CSTR.

	* ext/openssl/ossl_pkey_ec.c (ossl_ec_key_initialize): ditto.
	  (ossl_ec_group_initialize): ditto.

Wed Dec 31 14:12:35 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_to_float): replaced by to_flo definition from
	  math.c  [ruby-dev:37668]

	* math.c (Need_Float): use rb_to_float().

Wed Dec 31 13:49:06 2008  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/lib/openssl/buffering.rb (Buffering#read_nonblock):
	  implemented.

	* ext/openssl/ossl_ssl.c (rb_sys_fail_path): removed.
	  (fcntl.h): don't include.
	  (ossl_ssl_read_internal): defined.
	  (ossl_ssl_read): use ossl_ssl_read_internal.
	  (ossl_ssl_read_nonblock): use ossl_ssl_read_internal.
	  (Init_ossl_ssl): define sysread_nonblock, instead of read_nonblock.

Wed Dec 31 00:27:54 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_to_float): prohibit conversion from nil to float.
	  [ruby-dev:37663]

	* pack.c (pack_pack): replace all rb_Float() to rb_to_float().
	  [ruby-dev:37663]

Tue Dec 30 21:17:00 2008  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: use sock_define_uconst for INADDR_*
	  constants because Socket::INADDR_LOOPBACK should be 0x7f000001
	  instead of -0xffffff.

	* ext/socket/socket.c (sock_define_uconst): defined.

Tue Dec 30 18:23:10 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.3.1 r4506.
	* test/minitest/*.rb: ditto.

Tue Dec 30 17:59:59 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c: Minor fixes and tweaks in documentation.

Tue Dec 30 17:03:51 2008  Koichi Sasada  <ko1@atdot.net>

	* ext/dl/test/test_import.rb: fix a prototype decl.
	  pointed out by Takehiro Kubo [ruby-core:20971].

Tue Dec 30 16:56:09 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_blocking_region): add a comment.

	* thread.c (rb_thread_call_without_gvl): added as a alias of
	  rb_thread_blocking_region().

	* thread.c (rb_thread_call_with_gvl): added.

	* vm_core.h (rb_thread_t#blocking_region_buffer): added for
	  rb_thread_call_with_gvl().

Mon Dec 29 23:41:42 2008  Koichi Sasada  <ko1@atdot.net>

	* ext/dl/test/test_base.rb: add libc search logic.
	  this patch is written by Takehiro Kubo.
	  [ruby-core:20963] [Bug #932]

	* ext/dl/dl.h: Add ",..." as the last argument.
	  this patch is written by Takehiro Kubo.
	  Bug #633 [ruby-core:19289]

	* ext/dl/lib/dl/stack.rb: add add_padding() to calculate
	  alignment.  this patch is written by Takehiro Kubo.
	  Bug #633 [ruby-core:19289]

	* ext/dl/test/test_func.rb: atof()'s return value is double.
	  this patch is written by Takehiro Kubo.
	  Bug #633 [ruby-core:19289]

	* ext/dl/test/test_import.rb:
	  - atof()'s return value is double.
	  - The types of qsort's second and third argument are size_t.
	  - fprintf()'s return value is int.
	  this patch is written by Takehiro Kubo.
	  Bug #633 [ruby-core:19289]

Mon Dec 29 22:37:17 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* process.c (rb_waitpid): retries waitpid when EINTR.
	  [ruby-core:19744].

Mon Dec 29 23:18:52 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* bignum.c (rb_cstr_to_inum): changed an error message.

	* complex.c (string_to_c_strict): ditto.

	* rational.c (string_to_r_strict): ditto.

Mon Dec 29 22:37:57 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): template f should not accept non float
	  values.  [ruby-dev:37656]

	* object.c (rb_to_float): new function to type check floats.

Mon Dec 29 22:27:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* random.c (rb_f_rand): type check simplified.  strings are no
	  longer allowed for argument.  [ruby-dev:37655]

	* test/ruby/test_rand.rb (TestRand::o.to_int): need override
	  to_int.

Mon Dec 29 21:22:31 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c: Infinity.numerator returns self. [experimental]

	* numeric.c: Infinity.denominator returns 1. [experimental]

Mon Dec 29 20:57:14 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* man/ri.1: new manpage.

Mon Dec 29 20:45:25 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: floor, ceil, truncate and round accept an extra
	  argument like Float#round. [experimental]

Mon Dec 29 18:24:49 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* Makefile.in (distclean-local): removes Doxyfile and
	  run.gdb at distclean'ing.

Mon Dec 29 17:53:24 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* bin/erb: accepts options in more flexible styles.

Mon Dec 29 17:25:17 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/erb.rb (ERB): m17n of ERB. adds rdoc.
	  fixes #712. c.f. [ruby-dev:37516].

	* lib/erb.rb (ERB::Compiler#compile): recognizes magic comments.
	  returns a pair of compiled script and its script encoding.

	* lib/erb.rb (ERB#set_eoutvar): make generated scripts return a
	  string in correct encoding.

	* lib/erb.rb (ERB#def_method): use Kernel#eval for encoding-awareness
	  of the evaluated string.

	* bin/erb.rb (ERB::Main.run): adds -E and -U options.
	  String is no longer Enumerable.

	* man/erb.1: new manpage.

	* test/erb/test_erb_m17n.rb: new test case for m17n features.

Mon Dec 29 18:02:45 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/io/wait/wait.c (io_nread): returns number of bytes available
	  for read.  response to feature request #936 in [ruby-core:20917].

Mon Dec 29 17:52:16 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/io/wait/wait.c (io_ready_p): updated to follow RDoc.

Mon Dec 29 16:52:15 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (s_recvfrom_nonblock): revert r21162.

Mon Dec 29 16:16:20 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c (vm_set_eval_stack, vm_set_main_stack, vm_set_top_stack):
	  check stack overflow.  [ruby-dev:37646]

Sun Dec 28 18:36:33 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/rubygems/test_gem_command.rb
	  (test_add_option_overlapping_common_and_local_options):
	  follows r21066.

Mon Dec 29 14:50:19 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* Makefile.in (ext-clean): ext-clean always fails.

	* ext/dl/ripper/extconf.rb: adds y.output into the clean list.

Mon Dec 29 11:58:39 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_mutex_trylock): return false if Mutex owned
	  by current thread.  [ruby-core:20943]

	* thread.c (rb_mutex_lock): check dead lock (recursive lock) here.

	* test/ruby/test_thread.rb: add a test.

Mon Dec 29 10:58:54 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (rb_get_path): move encoding conversion of file path
	  from rb_scan_open_args.

	* io.c (rb_scan_open_args): ditto.

Mon Dec 29 07:15:16 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* cont.c: small RDoc fix mentioned from <radek.bulat at gmail.com>
	  in [ruby-core:20921].

Mon Dec 29 03:43:25 2008  Koichi Sasada  <ko1@atdot.net>

	* ruby.c (process_options): set th->base_block only while
	  it is needed.  [ruby-dev:37634] [Bug #939]

	* ruby.c (require_libraries): clear th->base_block before
	  require libraries.

Sun Dec 28 21:33:52 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ext/dl/test_base.rb: add BSD's case.

Sun Dec 28 21:09:12 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/dl/lib/dl/import.rb (DL::Importer#sizeof): follows
	  a feature change in 1.9.

Sun Dec 28 21:03:07 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/dl/lib/dl/import.rb (DL::Importer#extern): adds filename and
	  line number to module_eval'ing for readability of backtrace.
	  (DL::Importer#bind): ditto.

	* ext/dl/lib/dl/struct.rb (DL::CStructBuilder#create): ditto.

Sun Dec 28 19:11:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.h): do not use snprintf/vsnprintf in
	  msvcrt.

	* sprintf.c: not force to override snprintf/vsnprintf.
	  [ruby-core:20824]

Sun Dec 28 17:21:36 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rubygems/test_ext_configure_builder.rb (test_self_build_fail):
	  Extends pattern for FreeBSD's error message.

Sun Dec 28 17:10:13 2008  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* ext/dl/test/test_dl2.rb: modify strncpy, strcpy, qsort, types.
	  Patch by Takehiro Kubo.
	  Bug #633 [ruby-core:19289]
	* ext/dl/test/test_base.rb: /lib/libc.so is x86_64 binary in x86_64 architecture.

Sun Dec 28 12:53:10 2008  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* ext/dl/test/test_base.rb: use libc.dylib when the platform is darwin.

Sun Dec 28 12:24:14 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (mutex_free, mutex_unlock): add qualifiers.

Sun Dec 28 10:28:04 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (mutex_free): GC thread (main thread) has failed to unlock
	  a mutex that is locked by another thread, which makes the mutex
	  dangling in keeping_mutexes and causes [BUG] or stuck finally.
	  Now unlocking is performed as locking thread.

	* thread.c (mutex_unlock, rb_mutex_unlock, rb_mutex_unlock_all):
	  mutex_unlock receives a thread.

Sun Dec 28 05:44:44 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.3.1 r4505.
	* test/minitest/*.rb: ditto.

Sun Dec 28 00:43:33 2008  Tanaka Akira  <akr@fsij.org>

	* runruby.rb: refactored to modify ENV as once.

Sat Dec 27 22:41:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rdoc/test_rdoc_info_formatting.rb (setup, teardown): uses
	  mktmpdir and removes it after the test.

	* test/cgi/test_cgi_session.rb (setup, teardown): ditto.

Sat Dec 27 21:46:10 2008  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* ext/dl/test/test_base.rb: use lib64 when the architecture is x86_64.

Sat Dec 27 20:26:59 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_argv_size): if an argument is empty, it's size
	  is 2, not 0, because it will be converted to "".

Sat Dec 27 19:40:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (after_exec): needs to reset before restart timer
	  thread.

	* thread.c (thread_start_func_2): stops timer thread if forked in
	  the new thread.   [ruby-core:19385]

	* thread.c (rb_thread_atfork, rb_thread_atfork_before_exec): DRY.

Sat Dec 27 18:25:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_eval.c (rb_f_loop): return enumerator if no block given.
	  [ruby-list:45747]

Sat Dec 27 17:08:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .gdbinit (dummy_gdb_enums.special_consts): forces to load debug
	  info on Mac OS X.

	* .gdbinit (rp): added T_ZOMBIE.

Sat Dec 27 16:18:02 2008  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_frame_callee, rb_frame_caller): rb_frame_callee()
	  should return method id on current frame.
	  add rb_frame_caller() to get method id on parent frame.
	  Bug #884 [ruby-dev:37446]

	* eval.c (rb_f_method_name): use rb_frame_caller()
	  instead of rb_frame_callee().

Sat Dec 27 15:28:12 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_econv_exception): show source and destination
	  encoding.  [ruby-dev:37285]

Sat Dec 27 15:23:38 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_yield_with_cfunc): rename parameter name
	  "blockptr" to "blockargptr".

Sat Dec 27 15:15:56 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (revision.h): ignores failure of file2lastrev.

Sat Dec 27 15:02:38 2008  Koichi Sasada  <ko1@atdot.net>

	* ruby.c (process_options): fix to untouch th->mild_compile_error.
	  [ruby-dev:37621], [ruby-dev:37620]

Sat Dec 27 14:48:26 2008  Koichi Sasada  <ko1@atdot.net>

	* iseq.h, iseq.c (rb_iseq_new_main): add a type ISEQ_TYPE_MAIN.
	  [ruby-dev:37619]

	* compile.c (rb_dvar_defined, ruby_iseq_compile): ditto.

	* iseq.c (iseq_data_to_ary, iseq_load): ditto.

	* compile.c (iseq_compile_each): fix to check ip->compile_data.

Sat Dec 27 14:29:33 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI.redirectable?): permit https redirection.
	  patch from Roman Shterenzon.  [ruby-core:20485]

Sat Dec 27 13:36:55 2008  Koichi Sasada  <ko1@atdot.net>

	* eval.c (get_errinfo): return th->errinfo value
	  if normal errinfo place (dynamic local variable) is not found.
	  fixes Bug #732 [ruby-dev:37046].

	* bootstraptest/test_proc.rb: add a test.

Sat Dec 27 13:10:43 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* man/irb.1: adds -v, -h, -E and -U.

Sat Dec 27 11:41:45 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_call_method, vm_call_cfunc): use original id instead of
	  calling id when NODE_CFUNC or NODE_BMETHOD.
	  fixes Bug #632 [ruby-core:19282].

	* vm_eval.c (vm_call0, vm_call_super): ditto.

	* vm_method.c (rb_add_method, rb_alias): store original id
	  in nd_file field of NODE_METHOD.

	* test/stringio/test_stringio.rb: add a test.

Sat Dec 27 09:48:54 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c (Init_VM): create and define TOPLEVEL_BINDING at first.

	* vm.c (vm_set_main_stack, rb_iseq_eval_main): added.

	* parse.y (rb_parser_compile_file): fix to check parse_in_eval flag.

	* eval.c (ruby_exec_node): use rb_iseq_eval_main()
	  instead of rb_iseq_eval().

	* iseq.c (rb_iseq_new_main), vm_core.h: added.
	  main script (specified by -e or script name) should be run
	  under TOPLEVEL_BINDING using Kernel#eval.  Above changes
	  simulate Kernel#eval behaviour.  [ruby-dev:37240]

	* compile.c (make_name_for_block): skip iseq except block type.
	  this fix is needed for [ruby-dev:37240], and also fixes
	  [ruby-dev:35392].

Sat Dec 27 09:14:17 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* cont.c: rdoc for Fiber. patch by Muhammad Ali.
	  [ruby-core:20894]

Sat Dec 27 05:38:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (after_fork): ignores a termination request in the
	  parent process.  [ruby-dev:37447]

Sat Dec 27 01:52:39 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Using a more robust transcoding scheme to produce
	  ASCII compatible inspect() messages.  [ruby-dev:37591]

Fri Dec 26 18:04:10 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (fptr_finalize): don't allocate objects if noraise.
	  (finish_writeconv): add noalloc argument to be able to avoid
	  object allocation.
	  (finish_writeconv_arg): introduced again.
	  (finish_writeconv_sync): follow the above change.

Fri Dec 26 17:04:14 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/input-method.rb (IRB::StdioInputMethod#initialize):
	  removed a 'p' for debugging.

Fri Dec 26 15:50:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::List#summarize): gives priority
	  to latter switches.  [ruby-dev:36692]

	* lib/optparse.rb (OptionParser#summarize): do not append
	  unnecessary line terminator.

Fri Dec 26 14:01:38 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (fptr_finalize): close the IO object even if finish_writeconv or
	  flush is failed.
	  (finish_writeconv): don't raise.  return errno or exception.
	  (finish_writeconv_arg): removed.
	  (finish_writeconv_sync): follow finish_writeconv change.

	* transcode.c (rb_econv_make_exception): new function.

	* include/ruby/encoding.h (rb_econv_make_exception): declared.

Thu Dec 25 20:57:01 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (str_transcode0): set encoding when String#encode was
	  given explicit but the same destination and source encoding.

Thu Dec 25 20:01:50 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_s_pipe): unused variable removed.

Thu Dec 25 19:35:51 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (sym_ignore): remove useless symbol.

Thu Dec 25 18:36:04 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (pipe_close): removed.
	  (pipe_yield): defined.
	  (rb_io_s_pipe): use pipe_yield.

Thu Dec 25 17:49:45 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (decorate_convpath): show type of escaping for
	  xml_attr_quote or some conversions.

Thu Dec 25 17:06:13 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_initialize): check fd validity.  [ruby-dev:36646]

Thu Dec 25 16:23:31 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (flush_before_seek): check io_fflush result.
	  (rb_io_check_readable): ditto.
	  (rb_io_flush): ditto.
	  (rb_io_fsync): ditto.
	  (remain_size): ditto.
	  (rb_io_write_nonblock): ditto.
	  (finish_writeconv): ditto.
	  (fptr_finalize): ditto.
	  (io_reopen): ditto.
	  (rb_io_reopen): ditto.
	  (copy_stream_body): ditto.

Thu Dec 25 15:54:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_fflush): flush write buffer without write lock in
	  finalizers.  [ruby-dev:37572]

	* io.c (rb_io_fptr_finalize): clear write lock before finalizing.

Thu Dec 25 15:07:22 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (fptr_finalize): close the IO object even if close(2) is failed.

Thu Dec 25 14:51:43 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/parser.rb (RDoc::Parser.binary?): should read in binary mode.

Thu Dec 25 14:32:23 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_method_search): fix control flow bug.
	  (committed at r20981)

Thu Dec 25 13:28:20 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_flush): fsync() after buffer is flushed on win32.
	  [ruby-core:20043]

Thu Dec 25 13:13:00 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_method_search): return rb_cObject if there is no
	  super class.  [ruby-dev:37587]

	* bootstraptest/test_method.rb: add tests for above.

Thu Dec 25 12:49:12 2008  Koichi Sasada  <ko1@atdot.net>

	* proc.c (proc_new): should use proc_dup() if block has Proc.

	* vm.c (vm_make_proc_from_block): should use rb_cProc for block.

	* vm.c (vm_make_proc): add an assertion.

	* bootstraptest/test_proc.rb: add a test.

Thu Dec 25 12:44:27 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_yield_with_cfunc): check block has Proc.

Thu Dec 25 05:53:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/id.h.tmpl, id.h (ruby_method_ids): not depend on if
	  token are defined as macros.  [ruby-dev:37553]

	* template/id.h.tmpl, id.h (ruby_method_ids_check): enclosed in a
	  struct.

Thu Dec 25 01:52:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): sets native thread key.

Thu Dec 25 01:09:23 2008  TAKAO Kouji  <kouji@takao7.net>

	* test/readline/test_readline_history.rb: check the encoding that
	  is in the Readline::HISTORY.

Thu Dec 25 00:59:06 2008  TAKAO Kouji  <kouji@takao7.net>

	* test/readline/test_readline_history.rb: did not check the
	  encoding that is in the Readline::HISTORY. I will fix it.

Wed Dec 24 22:36:06 2008  Koichi Sasada  <ko1@atdot.net>

	* error.c, vm_dump.c: change message by rb_bug().

Wed Dec 24 21:57:39 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_peephole_optimize): fix typo.

Sun Dec 21 13:38:04 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c (invoke_block_from_c): fix to point right cfp.

	* vm.c (vm_make_proc, vm_make_proc_from_block), vm_core.h:
	  remove unused parameter cfp.

	* vm_insnhelper.c, proc.c (proc_new): ditto.

Wed Dec 24 20:59:12 2008  Koichi Sasada  <ko1@atdot.net>

	* error.c (exc_equal): == method should not raise Exception.
	  [ruby-dev:37519]

	* sample/test.rb: fix test.

Wed Dec 24 20:33:45 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_call_method): use class of method defined
	  instead of receiver's class on bmethod.  fixes [ruby-core:20786]

	* bootstraptest/test_method.rb: add a test for above.

	* vm_insnhelper.c (vm_setup_method): remove unused parameter klass.

	* vm_insnhelper.h (CALL_METHOD): ditto.

	* insns.def, vm_eval.c: ditto.

Wed Dec 24 20:15:50 2008  Koichi Sasada  <ko1@atdot.net>

	* tool/file2lastrev.rb (get_revisions): fix to ignore end of line.

Wed Dec 24 13:33:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (HAVE_LONG_LONG, HAVE_OFF_T): revised for autoconf
	  2.62 or later.

Wed Dec 24 06:29:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (OBJDUMP, OBJCOPY): autoconf list is not comma
	  separated.

	* configure.in (AC_HEADER_STDC, AC_CHECK_HEADERS, AC_CHECK_FUNCS):
	  removed duplicated checks.

Wed Dec 24 03:21:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el: added comment to mention newer version
	  bundled with Emacs 23 or later.  a patch from Phil Hagelberg
	  <phil at hagelb.org> in [ruby-core:20838].

Tue Dec 23 23:49:37 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_init_copy): call io_seek only if io_tell succeeds.

Tue Dec 23 22:57:48 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (rb_fork): don't propagate an error message if error
	  buffer not given.

Tue Dec 23 21:55:05 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (rb_fork): propagate an error message from child to parent.
	  (rb_f_exec): show details of error in child process on
	  exception.
	  (save_redirect_fd): add error message arguments.
	  (run_exec_dup2): ditto.
	  (run_exec_close): ditto.
	  (run_exec_open): ditto.
	  (run_exec_dup2_child): ditto.
	  (run_exec_pgroup): ditto.
	  (run_exec_rlimit): ditto.
	  (rb_run_exec_options): ditto.
	  (rb_exec): ditto.
	  (rb_exec_atfork): ditto.
	  (rb_spawn_internal): ditto.
	  (rb_spawn): ditto.
	  (rb_f_system): follow arguments change.
	  (proc_daemon): ditto.
	  (rb_f_spawn): show details of error in child process on exception.

	* io.c (popen_exec): add error message arguments.
	  (pipe_open): show details of error in child process on exception.

	* include/ruby/intern.h (rb_run_exec_options): add error message
	  arguments.
	  (rb_exec): ditto.
	  (rb_fork): ditto.
	  (rb_spawn): ditto.

	* ext/pty/pty.c (chfunc): add error message arguments.

Tue Dec 23 20:28:28 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* io.c: rdoc for File::open and 1.9 feature in file modes.

	* transcode.c: rdoc for String#encode

Tue Dec 23 19:51:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn): deals with quoted commands.

Tue Dec 23 18:44:21 2008  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime): use locale insensitive functions for tr_TR
	  locale.

Tue Dec 23 17:38:03 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb (assert_equal): show small differences
	  for Regexp and Float.

Tue Dec 23 16:49:48 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn): support normal commands with arguments.

Tue Dec 23 16:22:41 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_inspect): show fd number if there is no pathname.

Tue Dec 23 15:48:55 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/file2lastrev.rb: shouldn't use single quote in shell's command
	  line if you want to support Windows.

Tue Dec 23 15:46:43 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mathn.rb: Math.sqrt(NaN) should be NaN. [ruby-dev:37537]

Tue Dec 23 15:46:47 2008  Eric Hodel  <drbrain@segment7.net>
	* gem_prelude.rb:  Match full RubyGems behavior when a gem can't be
	  found.

Tue Dec 23 15:36:58 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/file2lastrev.rb: detects vcs directory properly on building
	  outside of srcdir. [ruby-dev:37555] [ruby-dev:37561]

Tue Dec 23 15:30:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (pipe_open): need to initialize args.

Tue Dec 23 14:18:14 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/st.h: need to include defines.h because LONG_LONG is
	  defined there.

Tue Dec 23 13:52:05 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parser/c.rb:  Don't coalesce adjacent comment blocks.
	  [bug#901]

Tue Dec 23 12:00:00 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (pipe_close): fix coding style.  [ruby-dev:37554]

Tue Dec 23 08:10:05 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/installer.rb: Fix documentation.  [bug#827]

Tue Dec 23 08:04:58 2008  Eric Hodel  <drbrain@segment7.net>

	* gem_prelude.rb: Don't remove methods twice.  [bug#555]

Tue Dec 23 00:16:48 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* sprintf.c (rb_str_format): fix buffer overflow.

Mon Dec 22 19:31:19 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (revision.h): uses tool/file2lastrev.rb to support
	  git-svn.

	* version.h: changed version string as
	  `ruby 1.9.1 (2008-12-22 patchlevel-5000 trunk 20912)
	  [i386-darwin9.6.0]'.

Mon Dec 22 16:32:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): encoding of packed string only from 'm',
	  'M', and 'u' should be US-ASCII.  [ruby-dev:37284]

	* pack.c (pack_pack): encoding of packed string only from 'U'
	  should be UTF-8.  also upgrade US-ASCII strings to UTF-8.

Mon Dec 22 15:56:49 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* Doxyfile.in: new file. Template of a configuration file.
	  Introduces C-level API reference generation with Doxygen.

	* tool/file2lastrev.rb: wrapper script that abstracts subversion
	  and git-svn.

	* tool/strip-rdoc.rb: filter for preventing doxygen from processing
	  rdoc comments.

	* configure.in: (Doxyfile): Doxyfile is generated together with
	  Makefile.
	  (PACKAGE): configuration $(PACKAGE) is necessary for $(docdir).

	* instruby.rb: adds a new install target 'capi'

	* common.mk (capi): new target that generates C API documents with
	  Doxygen.
	  (install-capi): new target.
	  (pre-install-capi): ditto.
	  (do-install-capi): ditto.
	  (post-install-capi): ditto.

Mon Dec 22 21:31:11 2008  Tanaka Akira  <akr@fsij.org>

	* numeric.c (int_ord): Integer#ord implemented.

Mon Dec 22 21:26:12 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_s_pipe): IO.pipe can take a block.
	  (pipe_close): new function.

Mon Dec 22 21:08:54 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb (assert_nothing_raised): increment
	  assertion count.  [ruby-dev:37480]

Mon Dec 22 19:10:44 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (Init_native_thread): need to call
	  ruby_thread_set_native() here.

Mon Dec 22 18:00:36 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: fix wrong flag value.

Mon Dec 22 15:15:58 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/protocol.rb (Net::BufferedIO#rbuf_fill): avoid calling
	  read_nonblock in rescue.  use retry instead.

Mon Dec 22 14:35:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_external_str_new_with_enc): set ASCII-8BIT if
	  encoding is US-ASCII and string contains 8bit characters.

Mon Dec 22 12:26:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (rubydll.def), win32/mkexports.rb
	  (Exports#exports): added VERSION.

Mon Dec 22 12:25:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/vsnprintf.c (BSD_vfprintf): fix for test_sprintf_comb.rb, by
	  wanabe in [ruby-dev:36935].

Mon Dec 22 12:05:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (mingw): no longer uses snprintf and vsnprintf of
	  msvcrt.  [Bug#6]

	* win32/win32.c (rb_w32_vsnprintf, rb_w32_snprintf): removed.

	* win32/Makefile.sub (config.h): vsnprintf exists in VC7 or later.

	* win32/mkexports.rb (Exports#initialize): aliases
	  rb_w32_vsnprintf and rb_w32_snprintf for binary compatibility.

	* sprintf.c (rb_str_format): uses snprintf instead of sprintf.

	* numeric.c (flo_to_s, rb_num2long, rb_num2ll): ditto.

Mon Dec 22 10:59:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_upto): should return enumerator if called
	  without block.  [ruby-dev:37526]

Mon Dec 22 09:54:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (gettable_gen): the encoding of __FILE__ should be
	  rb_filesystem_encoding().  [ruby-list:45733]

	* parse.y (gettable_gen): __FILE__ should be ASCII-8BIT when
	  filesystem encoding is US-ASCII and __FILE__ contains non 7bit
	  characters.

Mon Dec 22 02:54:56 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: temporary patch for trouble on TkAqua (> Tk8.4.9).

	* ext/tk/sample/demos-jp/widget: set encoding to a demo-code string to
	  avoid garbled text on the Code Window.

Sun Dec 21 14:55:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (SPLAT_PROC): splat values by hand.

Sun Dec 21 13:50:37 2008  TAKAO Kouji  <kouji@takao7.net>

	* test/readline/test_readline.rb
	  (TestReadline#test_some_characters_methods): checked encoding.

Sun Dec 21 12:23:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (SPLAT_PROC): fix for regexp.  [ruby-dev:37514]

Sun Dec 21 10:43:10 2008  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* sample/test.rb: rescue exception.

Sat Dec 20 18:28:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_find_1): supplements an extension for executable
	  files on DOSish platforms.

	* io.c (pipe_open): use rb_w32_aspawn() for array form.

	* win32/win32.c (rb_w32_pipe_exec): no longer used.

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): deals with batch
	  files and commands with extensions.  [ruby-core:20695]

	* win32/win32.c (has_redirection): supports environment variables
	  references.

Sat Dec 20 15:34:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rake.rb (Rake::FileList#egrep): change open mode to "rb",
	  i.e. default to binary.    [ruby-dev:37385]

	* lib/rake.rb (Rake::FileList#egrep): allow specifying reading
	  encoding, e.g. FileList['*.rb'].egrep(/require/, encoding:
	  "ascii-8bit")

	* lib/rake.rb (Rake::MultiTask): invoke_prerequisites should be
	  private.  a patch from okkez in [ruby-dev:37399]

Sat Dec 20 10:59:16 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale#initialize)
	  initializes instance variables to suppress warnings.
	  typo fix to ignore LoadError: [ruby-dev:37508]

Fri Dec 19 17:01:35 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_extract_encoding_option): "internal_encoding: nil"
	  to specify no-transcoding.  and other corner case fixed.
	  [ruby-dev:37496]

	* hash.c (rb_hash_lookup2): new function to look-up hash with
	  default value.

Fri Dec 19 15:51:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): get rid of warning on DOSISH.

Fri Dec 19 07:45:37 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (exc_equal): duck typing equal to make it transitive.
	  [ruby-dev:34808]

Thu Dec 18 19:31:54 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/init.rb (IRB.opt_parse): (M17N) adds -U and -E as command
	  line options. [ruby-dev:37161]. Fixes #711.
	  improved long options.

	* lib/irb/init.rb (IRB.set_encoding): new subroutine for IRB.opt_parse

	* lib/irb/input-method.rb (IRB::StdioInputMethod): (M17N) regards
	  scripts that user types as encoded in the external_encoding.

	* lib/irb/input-method.rb (IRB::ReadlineInputMethod): ditto.

	* lib/irb/input-method.rb (IRB::FileInputMethod): (M17N) respects
	  magic comment.

	* lib/irb/help.rb (IRB.print_usage): (M17N) respects magic comment
	  in the resource file.

	* lib/irb/lc/help-message: adds -U and -E.

	* lib/irb/lc/ja/help-message: ditto. re-encoded from ISO-2022-JP into UTF-8.

	* lib/irb/lc/ja/encoding_aliases.rb: new file. provides Japanese specific
	  character encoding name table for backward compatibility.

	* lib/irb/lc/ja/error.rb: re-encoded from ISO-2022-JP into UTF-8.
	  magic comment.

	* lib/irb/locale.rb: integrated with Ruby 1.9's M17N support.

	* lib/irb/magic-file.rb: new file. utility to handle files with magic
	  comment and opens in the correct encoding.

	* lib/irb/ruby-lex.rb (RubyLex#each_top_level_statement): recovers
	  character encoding for a statement after it lexed so that irb can
	  eval the statement in correct encoding.

	* lib/irb/src_encoding.rb: new file. utility.

Thu Dec 18 21:12:28 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/session.rb: fix bug for ignore session_id option.
	  report from [ruby-core:18635], [Bug #572]

	* lib/cgi/core.rb: use Encoding#find when encoding set.

	* test/cgi/test_cgi_session.rb: test for session_id specified.

Thu Dec 18 17:00:56 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_aset): string key copying only happen if key is
	  an exact instance of String, not a subclass. based on a patch
	  from Mike Gold <mike.gold.4433 at gmail.com> in [ruby-talk:322667].
	  [incompatible] [ruby-talk:322417]

Thu Dec 18 16:48:12 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/optparse/version.rb: remove variable shadowing to stop
	  warning.   [ruby-core:20612]

	* lib/irb/completion.rb, lib/net/imap.rb, lib/prime.rb,
	  lib/rinda/ring.rb, lib/racc/parser.rb,
	  lib/shell/command-processor.rb, lib/yaml/yamlnode.rb: ditto.

	* lib/racc/parser.rb: remove space before parentheses.

	* lib/shell/command-processor.rb, lib/shell/process-controller.rb:
	  use parentheses around arguments.

	* lib/irb/ext/change-ws.rb, lib/rexml/validation/relaxng.rb,
	  lib/yaml/baseemitter.rb: indentation fix.

	* lib/matrix.rb: small cosmetic change.

Thu Dec 18 08:15:04 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/xmlrpc/server.rb:  Restricting method inspection to show only
	  non-inherited public methods.  [ruby-core:20603]

	* lib/xmlrpc/server.rb:  Fixing method inspection so it doesn't
	  trigger XMLRPC::FaultException when used.  [ruby-core:20604]

Wed Dec 17 19:39:44 2008  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (unix_recv_io): relax msg_controllen error
	  check for x86_64-openbsd4.4.

Wed Dec 17 19:37:30 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/extconf.rb: check util.h for OpenBSD.

	* ext/pty/pty.c: include util.h if available.  fix variable name.

Wed Dec 17 19:23:28 2008  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/matrix.rb: shut up warning. [ruby-dev:37481] [Bug #899]

Wed Dec 17 15:44:28 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_pop_m): use enum ary_take_pos_flags.

	* array.c (rb_ary_push_m): add modification check before actual
	  operation.   [ruby-dev:37440]

Wed Dec 17 15:35:39 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in (OBJDUMP, OBJCOPY):
	  *BSD's ports and MacPorts prefix GNU binutils with 'g'.

Wed Dec 17 11:39:39 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/bigdecimal/test_bigdecimal.rb (TestBigDecimal#test_hash):
	  shut up warning.  see [ruby-dev:37437]

Wed Dec 17 11:01:35 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_hash): gets rid of collisions between different
	  encoding strings.  [ruby-core:20526]

Wed Dec 17 09:50:19 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_metaclass.rb: removed codes for my debugging.
	  sorry. [ruby-dev:37470]

Tue Dec 16 22:55:11 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bin/testrb: set $0.

Tue Dec 16 22:42:16 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit.setup_argv): sorry, fixed wrong commit.

Tue Dec 16 22:15:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/minitest/unit.rb (MiniTest::Assertions#assert_instance_of):
	  should assert by instance_of?, not ===.  [ruby-dev:37458]

	* lib/minitest/unit.rb (MiniTest::Assertions#assert_instance_of):
	  typo fixed.

Tue Dec 16 21:59:29 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit.setup_argv): ALT_SEPARATOR support.

Tue Dec 16 21:59:02 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpToString): reverted modification
	  (that caused a bug) in r20359.  [ruby-dev:37370]

	* ext/bigdecimal/bigdecimal.c (BigDecimal_limit): comment update.
	  [ruby-dev:37465]

Tue Dec 16 20:34:44 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (getDevice): add nomesg argument.
	  (get_device_once): add nomesg argument.  chmod slave tty to 0600
	  if nomesg.  more error tests.
	  (no_mesg): new function.
	  (pty_open): make slave tty's mode 0600.

Tue Dec 16 20:24:20 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (_parse): m17n compliant.

Tue Dec 16 19:48:18 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/extconf.rb: check posix_openpt.

	* ext/pty/pty.c (get_device_once): use posix_openpt if available.

Tue Dec 16 19:43:53 2008  Tanaka Akira  <akr@fsij.org>

	* re.c: use strlcpy for error messages.

Tue Dec 16 16:41:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): returns dispatched result.

	* parse.y (primary): also in ripper, saves in_def before restoring.

Tue Dec 16 12:30:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ac_cv_header_ucontext_h): do not use ucontext.h on Mac
	  OS X 10.5 or later.  merged from MacPorts.

	* configure.in (ac_cv_func_daemon): daemon(3) is deprecated on Mac OS
	  X 10.5 or later.

Tue Dec 16 11:37:07 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (set_arg0): use strlcpy() instead of strncpy().

	* load.c (rb_feature_p): ditto.

	* dln.c (dln_load): ditto.

Tue Dec 16 09:14:28 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (block_call): block should not be given to yield.
	  [ruby-core:20583]

Mon Dec 15 23:48:39 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (sleep_timeval): cast tv_usec to long to shut up
	  warnings on OSX.  [ruby-dev:37449]

Mon Dec 15 23:34:04 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (pty_open): set FMODE_SYNC and FMODE_DUPLEX.

Mon Dec 15 23:29:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (process_options): revive global sub, gsub, chop, chomp
	  only when auto looping options (-p/-n) is specified.
	  [ruby-core:20570]

Mon Dec 15 22:48:11 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (pty_open): new method PTY.open.

Mon Dec 15 21:24:01 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (get_device_once): use DEVICELEN instead of
	  sizeof SlaveName.

Mon Dec 15 21:01:46 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (chfunc): make it static.

Mon Dec 15 20:59:10 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (child_info): add slavename.
	  (chfunc): use slavename.
	  (establishShell): set slavename.

Mon Dec 15 20:16:46 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (EXTMK_ARGS): shouldn't use ``\"'' because cmd.exe eat
	  ''\'' in such quotes.

Mon Dec 15 19:07:31 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): define CANONICALIZATION_FOR_MATHN
	  to follow r20683.

Mon Dec 15 18:12:34 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rake/packagetask.rb (Rake::PackageTask): small document
	  update from okkez in [ruby-dev:37443]

Mon Dec 15 16:28:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_callee_setup_arg_complex): uses cfp from
	  blockptr instead of the current cfp.  [ruby-core:20544]

Mon Dec 15 14:56:59 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_metaclass.rb: new test case for metaclass hierarchy.

	* class.c (make_metametaclass): new function. extracted from
	  rb_make_metaclass.

	* class.c (rb_make_metaclass): uses make_metametaclass when called for a
	  metaclass.

	* class.c (rb_singleton_class): creates a meta^(n+2)-class in
	  addition to a meta^(n+1)-class when called for a meta^(n)-class.
	  This is because the returned meta^(n+1) class must acts as an instance of
	  Class, metaclass of Class, ..., meta^(n+1)-class of Class,
	  Module, metaclass of Module, ..., meta^(n+1)-class of Module,
	  Object, metaclass of Object, ..., meta^(n+2)-class of Object,
	  BasicObject, metaclass of BasicObject, ..., meta^(n+2)-class of
	  and BasicObject even when Class, Module, Object or BasicObject has
	  not have its meta^(i)-class yet.

Mon Dec 15 15:13:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* id.h, template/id.h.tmpl (ruby_method_ids): sees YYTOKENTYPE too.
	  [ruby-dev:37436]

Mon Dec 15 15:02:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (EXTMK_ARGS): needs MINIRUBY for cross-compile.
	  [ruby-core:20131]

Mon Dec 15 14:39:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (vm_call0): NODE_ZSUPER supported.  [ruby-core:20480]

	* vm_eval.c (vm_call_super): uses method_missing().

	* vm_eval.c (method_missing): get rid of too large alloca.

	* vm_eval.c (rb_call0, method_missing): uses idMethodMissing.

	* vm_method.c (rb_add_method, remove_method, rb_undef): uses
	  id__send__.

	* vm_method.c (Init_eval_method): removed IDs which are defined as
	  immediate values.

Mon Dec 15 11:35:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace): defaults to script name for C functions.

Mon Dec 15 11:32:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (rubylib_mangled_path, rubylib_mangled_path2): cannot use
	  locale encoding before load path is initialized

	* ruby.c (ruby_init_loadpath_safe): ditto.

	* ruby.c (process_options): loads encdb so that encodings can be
	  loaded, then associates script name and load paths with the
	  locale encoding.

Mon Dec 15 10:00:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (btest-ruby): use RUNRUBY instead of MINIRUBY to load the
	  shared library.  [Bug #849]

Sun Dec 14 22:31:19 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (bigmul1_karatsuba): remove temporal bignum.

	* bignum.c (bigsqr): call bigmul0(x, x) because it is faster than the
	  original bigsqr at this point.

	* bignum.c (rb_big_pow): a value returned from bigsqr is already
	  truncated.

Sun Dec 14 21:13:02 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (bigmul1_karatsuba): fix comment and refactoring.

Sun Dec 14 14:53:41 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (bigmul1_balance, bigmul1_karatsuba): remove all
	  rb_gc_force_recycle which causes memory leak.

Sun Dec 14 14:26:11 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/README: directory structure changed

Sun Dec 14 09:14:37 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* reverts r20713.

Sun Dec 14 12:51:48 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (rb_big_mul): faster multiplication by Karatsuba method and
	  twice faster square than normal multiplication. [ruby-dev:37392]

	* random.c (rb_rand_internal): used by Bignum#*.

	* test/ruby/test_bignum.rb: add some tests for above.

Sun Dec 14 01:35:48 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (forked_child): new variable.
	  (before_exec): don't call rb_thread_stop_timer_thread if
	  forked_child.
	  (after_exec): reset forked_child after rb_thread_start_timer_thread.
	  (rb_fork): set forked_child just after fork in child.

	* ext/pty/pty.c (chfunc): extracted from establishShell.
	  (establishShell): use rb_fork.

	  [ruby-dev:37418]

Sat Dec 13 22:17:30 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (help): describes more targets.
	  based on a patch by Michael Klishin. [ruby-core:20523].

Sat Dec 13 18:34:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_printable): wrong condition for string iteration.

Sat Dec 13 16:04:48 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* encoding.c (default_external): endless recursion during
	  loading a locale encoding on some locale.
	  fixed by Nobuyoshi Nakada.

Sat Dec 13 15:55:37 2008  TAKAO Kouji  <kouji@takao7.net>

	* ruby.c (process_options): fixed default_internal is nil.
	  (closes #862)

Sat Dec 13 15:52:27 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_equal): remove documentation error "Otherwise,
	  compares them as strings".  [ruby-dev:37398]

	* string.c (sym_inspect): quote if symbol contains non-printable
	  characters.  [ruby-dev:37398]

Sat Dec 13 14:24:38 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/enc/test_utf16.rb: feature changed in r20626.
	  follows it.

Sat Dec 13 13:41:44 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_m17n_comb.rb: feature changed in r20626.
	  follows it.

Sat Dec 13 13:03:20 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: use rb_usascii_str_new2 instead of rb_str_new2.

	* rational.c: ditto.

Sat Dec 13 12:48:57 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_m17n.rb: feature changed in r20626.
	  follows it.

Sat Dec 13 12:38:16 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/minitest/test.rb (MinTest::Unit#location):
	  skips user-defined assertions as MiniTest's.
	  e.g. for test/ruby/test_m17n.rb.

Sat Dec 13 09:17:33 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.3.1 r4503.
	* test/minitest/test_mini_test.rb: ditto.
	* lib/miniunit/autorun.rb: added (as part of r4503).

Sat Dec 13 08:35:14 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_canonicalization): renamed.

	* ext/math/complex.c: followed the above change.

	* rational.c (nurat_canonicalization): renamed.

	* ext/math/rational.c: followed the above change.

	* configure.in: defines a new macro.

Sat Dec 13 01:10:03 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c
	  (readline_s_get_completion_append_character): uses locale
	  encoding but not ASCII-8BIT.

Fri Dec 12 22:12:46 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c: do not use RUBY_VERSION_CODE.

Fri Dec 12 21:41:36 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c: r20662 reverted.

Fri Dec 12 19:29:07 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* encoding.c (rb_enc_set_default_external): default_internal can be
	  nil, but default_external cannot.

	* encoding.c (rb_set_default_internal): adds rdoc.

	* encoding.c (enc_find): ditto.

Fri Dec 12 19:24:47 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (run, runruby, parse, gdb, gdb-ruby): you can also run
	  other scripts than $(srcdir)/test.rb.

Fri Dec 12 19:13:43 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (readline_readline): changed the message
	  of IOError to 'closed stdin' from 'stdin closed' if stdin was
	  closed.

Fri Dec 12 19:00:49 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c: used the ExportStringValue macro
	  instead of the OutputStringValue macro. removed the
	  OutputStringValue macro.

Fri Dec 12 16:23:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (yycompile0): ruby_eval_tree_begin is always 0 when
	  ruby_eval_tree is 0.

Fri Dec 12 14:09:55 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* encoding.c (enc_get_default_encoding): removed.
	  Generalizing rb_default_{external,internal}_encoding seems to be
	  difficult.
	  default_external cannot be NULL even before detected. [ruby-dev:37390]

	* encoding.c (rb_default_external_encoding): has its own
	  implementation again.

	* encoding.c (rb_default_internal_encoding): ditto.

	* gem_prelude.rb: added notice.

	* ruby.c (rubylib_mangled_path, rubylib_mangled_path2): uses locale
	  encoding but not ASCII-8BIT.

	* ruby.c (process_options): refers less to default_external.

Fri Dec 12 11:00:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_feature_p): load path must be expanded.
	  [ruby-dev:37388]

Fri Dec 12 10:28:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_version): greps only the line that defines version.

	* version.h (RUBY_VERSION_CODE, RUBY_RELEASE_CODE): removed.

Fri Dec 12 10:20:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c, rational.c: do not use RUBY_VERSION_CODE.

Fri Dec 12 10:19:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_string_value_ptr, rb_to_id): do not use a side
	  effect expression in RSTRING_PTR.

	* string.c (rb_str_split_m): simplified the argument of
	  RSTRING_LEN.

Thu Dec 11 23:48:00 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (sqrt): should pass nan to the original method.

Thu Dec 11 21:04:04 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker.rb, lib/rss/maker/0.9.rb, lib/rss/maker/base.rb:
	  RSS::Maker.[] returns a maker class corresponds to passed version.

	* test/rss/test_maker_*.rb: add tests for RSS::Maker.[].

Thu Dec 11 20:05:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_aliases_enc_i): skips default internal.

Thu Dec 11 19:31:45 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/assertions.rb: extracted from lib/test/unit.rb.
	  lib/test/unit/testcase.rb: ditto.
	  at asakusa.rb.  [ruby-core:20014]

Thu Dec 11 19:23:09 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io.rb (test_dup_many): extracted from test_dup.
	  test in ruby subprocess.  at asakusa.rb.  [ruby-dev:35648]

Thu Dec 11 19:16:30 2008  Tanaka Akira  <akr@fsij.org>

	* lib/pathname.rb (Pathname#=~): undefed.  at asakusa.rb.
	  [ruby-core:19690]

Thu Dec 11 13:09:01 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (reg_enc_error): raise EncodingCompatibilityError for
	  encoding incompatibility.  [ruby-core:18600]

	* re.c (rb_reg_prepare_enc): more consistent error message.
	  [ruby-core:18611]

Thu Dec 11 13:36:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_set_default_encoding): allowed to set default
	  encoding.

	* encoding.c (rb_locale_encoding): removed Encoding::LOCALE.

	* encoding.c (rb_enc_set_default_external): ditto.

	* encoding.c (rb_enc_set_default_internal): ditto.

	* encoding.c (rb_enc_set_default_internal): defines internal
	  encoding as nil.

Thu Dec 11 11:11:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/st.h (size_t): needs stddef.h or stdlib.h.
	  [ruby-core:20339]

Thu Dec 11 10:25:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_bignum.rb (TestBignum#test_convert): remove
	  platform dependent call of Process.wait.  coverage should be
	  accomplished by other method.  [ruby-dev:36062]

Thu Dec 11 10:18:35 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/document.rb (REXML::Document#write): require
	  rexml/formatters/transitive if transitive flag is on.  a patch
	  from akira yamada in [ruby-dev:36230].  fix #553

	* lib/rexml/element.rb (REXML::Element#write): ditto.

	* lib/rexml/formatters/transitive.rb (REXML::Formatters::Transitive#write_element):
	  add hack for IE.  [ruby-dev:36230]

Thu Dec 11 02:37:22 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* math.c (domain_check): should not raise EDOM exception for NaN
	  value if operand is also NaN.  affects acos, asin, acosh, atanh,
	  log, log2, log10, sqrt, gamma, lgamma. [ruby-dev:37357]

Thu Dec 11 02:23:51 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.pipeline_start): return an array of threads if a
	  block is not given.

Thu Dec 11 01:48:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_round): should be round
	  to integer.  [ruby-dev:37355]

	* ext/bigdecimal/bigdecimal.c (BigDecimal_divmod): division should
	  be integer.  [incompatible] [ruby-dev:37355]

Thu Dec 11 01:21:58 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (rb_mutex_unlock): shut up warning.  a patch from
	  Kazuhiro NISHIYAMA in [ruby-dev:37345]. fix #846

Wed Dec 10 23:58:56 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: avoided warnings on cpp. [ruby-dev:37344]

	* rational.c: ditto.

Wed Dec 10 21:32:02 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker.rb (RSS::Maker.[]): add.
	  Suggested by Akinori MUSHA. Thanks!!! [ruby-dev:37210]

Wed Dec 10 12:56:32 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_rewind): If the enclosed object
	  responds to a "rewind" method, call it; cf. [ruby-dev:37268]

Wed Dec 10 12:46:52 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_next): Fix a typo: s/rewinded/rewound/.

	* lib/prime.rb (Prime::OldCompatibility#each): Ditto.

Wed Dec 10 11:25:53 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_initialize): raise RegexpError when encoding
	  is dummy encoding. [ruby-dev:37091]

Wed Dec 10 01:28:16 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (win32.obj): depend on headers.

Tue Dec  9 18:35:35 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/single_byte.trans, cp850-tbl.rb, cp852-tbl.rb,
	  cp855-tbl.rb, koi8-r-tbl.rb, koi8-u-tbl.rb, tis-620-tbl.rb:
	  new single-byte transcodings (from Yoshihiro Kambayashi)

	* test/ruby/test_transcode.rb: added tests for the above
	  (from Yoshihiro Kambayashi), small cosmetic fixes

Tue Dec  9 13:33:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each), gc.c (assign_heap_slot),
	  (gc_mark_children), parse.y (vtable_alloc, vtable_free, vtable_add),
	  proc.c (proc_to_s), thread.c (terminate_i, rb_thread_terminate_all),
	  (thread_start_func_2, blocking_region_begin, blocking_region_end),
	  (rb_thread_kill), thread_pthread.c (native_thread_create),
	  (ubf_pthread_cond_signal), vm.c (check_env, thread_free), vm_dump.c
	  (vm_env_dump_raw, vm_stack_dump_each, vm_thread_dump_state),
	  (vm_call0): use void pointer for %p.

	* cont.c (fiber_status), template/insns.inc.tmpl (ruby_vminsn_type),
	  vm_insnhelper.h (BOP): ISO C forbids comma at end of enumerator
	  list.

	* vm_insnhelper.c (check_cfunc): use function pointer.

Tue Dec  9 13:23:55 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/curses.c (curses_use_default_colors): add new
	  method.  a patch from Giancarlo F Bellido
	  <support at coaxialhost.com> in [ruby-core:20434].

	* ext/curses/curses.c (curses_tabsize_set): ditto.

	* ext/curses/curses.c (curses_tabsize_get): ditto.

Tue Dec  9 12:08:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .gdbinit (rp): fixed typo for T_STRUCT.

Tue Dec  9 11:50:46 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* pack.c (pack_pack): fixed [ruby-dev:37295].
	  Array#pack always has returned an US-ASCII string when
	  the given format ended with 'u', 'M' or 'm'.

Tue Dec  9 03:21:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: fix for continued lines.  based on a patch from
	  Marcus Rueckert <darix AT opensu.se> at [ruby-core:20420].

Tue Dec  9 00:54:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot (package): enc.mk in snapshot is dummy and should
	  not deal with objects.  [ruby-core:20422]

Tue Dec  9 00:17:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend (clean-srcs): split out from clean.

Mon Dec  8 23:34:18 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* pack.c (pack_pack): fixed odd act of 'm*', 'M*', and 'P*'.
	  just ignores '*' in these cases.
	  [ruby-dev:37289]

Mon Dec  8 18:31:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_pack): fixed length for odd length string.
	  [ruby-dev:37283]

Mon Dec  8 11:28:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): added version, copyright, usage, yydebug,
	  syntax to --dump option.

Mon Dec  8 11:15:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): source-encoding option.

Mon Dec  8 10:32:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (set_option_encoding_once): dry.

	* ruby.c (proc_options): checks extra argument for -E/--encoding.

Sun Dec  7 23:47:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBPATHFLAG): use numbered specifier if RPATHFLAG
	  is set.  [ruby-talk:322136]

Sun Dec  7 23:17:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (LIBRUBY_SO): localizes non-public symbols.

	* configure.in (OBJDUMP, OBJCOPY): for dealing with binary files.

Sun Dec  7 17:44:06 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.capture3): renamed from Open3.poutput3.
	  (Open3.capture2): renamed from Open3.poutput2.
	  (Open3.capture2e): renamed from Open3.poutput2e.

Sun Dec  7 11:48:04 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.poutput3): :binmode option implemented.
	  (Open3.poutput2): ditto.
	  (Open3.poutput2e): ditto.

Sat Dec  6 18:33:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot (package): added RM and CP.  [ruby-dev:37288]

Sat Dec  6 17:51:35 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* pack.c (pack_pack): 'u0' is not special differently from 'm0'.

Sat Dec  6 14:35:06 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): set US-ASCII and CODERANGE_7BIT
	  when quoted-printable ('M') and base64 ('m').
	  [ruby-dev:37284]

	* pack.c (pack_unpack): ditto.

Fri Dec  5 22:56:24 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_make_exception): single argument to raise may be
	  string compatible object.

Fri Dec  5 21:45:45 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_{to_s,inspect}): performance improvement.

Fri Dec  5 21:42:44 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: inspect should not depend on to_s.

Fri Dec  5 21:18:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_truncate): return
	  integer if no optional argument given. [incompatible]

	* ext/bigdecimal/bigdecimal.c (BigDecimal_floor): ditto.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_ceil): ditto.

Fri Dec  5 19:06:04 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.pipeline_start): new method.
	  (Open3.pipeline): ditto.

Fri Dec  5 18:55:25 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (run_exec_dup2): !save is false if Qnil.

Fri Dec  5 18:07:32 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read, rb_w32_write, rb_w32_isatty): check
	  whether fd is valid.

Fri Dec  5 13:05:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (rb_iseq_parameters): proc arguments are always optional.

	* proc.c (get_proc_iseq, rb_proc_parameters): ditto.

Fri Dec  5 12:38:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_sequence): uses rb_compile_warning() for
	  warning at compilation time.

Fri Dec  5 12:35:46 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (ruby_iseq_compile, ruby_iseq_translate_threaded_code),
	  (ruby_insns_name_array, ruby_iseq_build_from_ary): prefixed with
	  ruby_.

	* iseq.c (ruby_iseq_load, ruby_insn_make_insn_table): ditto.

Fri Dec  5 10:01:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_cmp_m): fixed rdoc.  pointed out by <Thomas
	  C. Mitchell AT gmail.com> at [ruby-talk:321967]

Fri Dec  5 07:58:30 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_binwrite): arg.offset should be updated after retry.

Fri Dec  5 03:29:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_get_load_path): returns the load path without
	  touching.

	* load.c (rb_feature_provided): new function to return the loading
	  path in addition to rb_provided().

	* load.c (search_required): sets path if loading.

	* variable.c (autoload_provided): load paths are expanded to check
	  if loading.

	* variable.c (autoload_node): keeps autoload mark while loading.
	  [ruby-core:20235]

	* variable.c (rb_const_get_0): loops while autoload mark is set.

Fri Dec  5 01:37:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): ERROR_BROKEN_PIPE is not a real error
	  at this point.

	* io.c (pipe_open): use rb_w32_spawn() instead of rb_w32_pipe_exec()
	  to use our own redirection scheme.

Fri Dec  5 01:35:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_to_proc): use hidden object.

Fri Dec  5 01:19:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): propagate taint status from format string to
	  result string.

Fri Dec  5 00:34:10 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (run_exec_dup2): need to sort by reverted order when
	  restoring fds.

Fri Dec  5 00:17:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_to_proc): caches Symbol procs, based on a patch from
	  Shumpei Akai <admin AT flexfrank.net>.  [ruby-dev:37265]

Thu Dec  4 23:29:34 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (waitpid): fix bug of checking child slot.

	* win32/win32.c (FindChildSlotByHandle): new.

Thu Dec  4 23:24:05 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.poutput3): new method.
	  (Open3.poutput2): ditto.
	  (Open3.poutput2e): ditto.

Thu Dec  4 23:02:13 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/default.mspec: follows changes in rubyspec project.
	  inherits configurations from ruby.1.9.mspec.

Thu Dec  4 22:13:55 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_complex.rb: added some tests.

	* test/ruby/test_rational.rb: ditto.

Thu Dec  4 19:56:20 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.popen3): simplified.
	  (Open3.popen_run): extracted from Open3.popen3.
	  (Open3.popen2): new method.
	  (Open3.popen2e): new method.
	  (Open3.pipeline_rw): new method.
	  (Open3.pipeline_r): new method.
	  (Open3.pipeline_w): new method.
	  (Open3.pipeline_run): new private method.

Thu Dec  4 19:16:28 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (check_exec_fds): resolve cascaded child fd reference.

Thu Dec  4 16:58:12 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rubygems/validator.rb (Gem#remove_leading_dot_dir): make
	  this method private.  a patch from okkez in [ruby-dev:37245]

Thu Dec  4 16:19:18 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_read_nonblock):
	  OpenSSL::SSL::SSLSocket should implement read_nonblock.  a patch
	  from Aaron Patterson in [ruby-core:20277].  fix: #814 [ruby-core:20241]

Thu Dec  4 16:16:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/gserver.rb: fixed type in sample code.  a report from Oleg
	  Puchinin.

Thu Dec  4 14:54:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rubygems/local_remote_options.rb (Gem#add_update_sources_option):
	  little documentation fix.  a patch from okkez.  [ruby-dev:37271]

Thu Dec  4 13:56:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/curses.c (window_getch): avoid ISPRINT() macro which
	  has an issue with OpenSolaris.  [ruby-core:20189]

	* ext/curses/curses.c (curses_getch): no ISPRINT(). [ruby-core:20294]

	* signal.c (ruby_signal): EINVAL from sigaction(2) is not a bug.

Thu Dec  4 11:40:56 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (inspect_enumerator): Implement #inspect.
	  [ruby-dev:37248]-[ruby-dev:37263]

Thu Dec  4 11:38:40 2008  Akinori MUSHA  <knu@iDaemons.org>

	* vm_method.c (rb_obj_respond_to): Remove a duplicated rdoc
	  comment and fix a markup error.

Thu Dec  4 06:04:16 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/menu.rb: TkOptionMenubutton.new fails to treat
	  'parent' and 'variable' options on a Hash argument.

Thu Dec  4 05:06:47 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: bug fix. use ::RubyVM instead of ::VM
	  [ruby-list:45676]

	* ext/tk/tcltklib.c: update RELEASE_DATE

Thu Dec  4 01:37:47 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nurat_{to_s,inspect}): provides better representation
	  for in-finite imag part.

Thu Dec  4 01:22:41 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (f_signbit): NaN may be signed value.

Wed Dec  3 23:59:32 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (EXEC_OPTION_DUP2_CHILD): defined.
	  (check_exec_redirect_fd): check :in, :out and :err.
	  (check_exec_redirect): check [:child, fd].
	  (check_exec_fds): validate EXEC_OPTION_DUP2_CHILD array.
	  (run_exec_dup2_child): new function.
	  (rb_run_exec_options): call run_exec_dup2_child.

Wed Dec  3 22:54:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (expr): keyword_not can continue across newline.
	  [ruby-core:20252]

Wed Dec  3 22:40:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (simple_default_value): returns simplest assignment only.
	  [ruby-core:20237]

Wed Dec  3 21:30:06 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (check_exec_redirect): accept :in, :out, :err as redirect
	  target.

Wed Dec  3 21:18:27 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_rational.rb: revert.

Wed Dec  3 14:48:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/tcltklib.c (ip_ruby_cmd, ip_invoke_with_position): must
	  not access internal union directly.  [ruby-list:45670]

Wed Dec  3 12:24:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_getc, rb_io_readchar): documentation correction from
	  Emiel van de Laar.  [ruby-core:20212]

	* ext/stringio/stringio.c (strio_readchar): ditto.

Wed Dec  3 09:26:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/xpath.rb (REXML::XPath.first): apply documentation
	  patch from Ken Bloom in [ruby-core:20213].

	* lib/rexml/xpath.rb (REXML::XPath.each): ditto.

Wed Dec  3 02:56:34 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rational.rb: add a test.

Wed Dec  3 02:53:24 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_range.rb: add a test.

Wed Dec  3 02:26:07 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_string.rb: add some tests.

Wed Dec  3 02:04:21 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/pty/pty.c (Init_pty): fix typo.

Tue Dec  2 19:22:13 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.popen3): merge hash options if given.

Tue Dec  2 15:31:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/protocol.rb (Net::BufferedIO#rbuf_fill): use
	  read_nonblock instead of sysread wrapped by timeout to boost
	  performance.  a patch from Aaron Patterson in [ruby-core:20191].
	  fix #806

Mon Dec  1 23:23:52 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* set 1.9.1-p5000 into version number. [ruby-dev:36998]

Mon Dec  1 15:48:47 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* signal.c (register_sigaltstack): no need to define on non-sigaltstack
	  platform.

Mon Dec  1 12:00:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (rb_fiber_start): calls with exact argument number.
	  [ruby-core:20088]

Sun Nov 30 21:41:10 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* man/rake.1: new manual page

Sun Nov 30 18:01:50 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_regexp.rb (TestRegexp#test_parse_curly_brace):
	  now accepts quantifier on anchors again by r20391.

Sat Nov 29 23:56:44 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* man/irb.1 (EXAMPLES): new section

Sat Nov 29 19:19:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regparse.c (is_invalid_quantifier_target): Perl and old Ruby
	  accepts quantifier on anchors.  [ruby-core:20161]

Sat Nov 29 18:28:57 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_getaddrinfo): should have updated for
	  Mac OS X.  a patch from Shumpei Akai in [ruby-dev:37234]

Sat Nov 29 00:18:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* cont.c (fiber_alloc): separate allocation and initialization.
	  allow subclass to override #initialize.   [ruby-core:20086]

Fri Nov 28 18:31:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_s_getaddrinfo): refactored to remove
	  code duplication regarding getaddrinfo.

Fri Nov 28 17:52:26 2008  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/forwardable.rb: should be usable def_single_delegator for
	  Class and Module.

Fri Nov 28 13:19:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (simple_default_value): extracts simplest default
	  argument value.

	* iseq.c (rb_iseq_parameters): returns parameter list.

	* proc.c (get_proc_iseq, get_method_iseq): handles ifunc and
	  bmethod.

	* proc.c (rb_proc_parameters, rb_method_parameters): added
	  Proc#parameters and Method#parameters.  [ruby-core:19759]

Fri Nov 28 02:18:47 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_DoDivmod): bigdecimal
	  division (including modulo) should raise ZeroDivisionError as
	  integer division. [incompatible]

Fri Nov 28 00:12:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flodivmod): floating point division should raise
	  ZeroDivisionError as integer division. [incompatible]

Thu Nov 27 23:54:37 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_mark): still needs to check stack depth during GC.

	* gc.c (stack_check): ditto.

Thu Nov 27 21:41:29 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* strftime.c (rb_strftime): should add padding for %%.

Thu Nov 27 16:32:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (register_sigaltstack): stores alt stack for debug
	  purpose.

Thu Nov 27 16:12:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (ruby_sigaction_t): added.

Thu Nov 27 15:59:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (ruby_stack_check): no check if using sigaltstack.

	* signal.c (ALT_STACK_SIZE): default minimum size is insufficient
	  for method calls.

	* signal.c (sigsegv): handles stack overflow if possible.

	* thread.c (ruby_thread_stack_overflow): helper function to raise
	  sysstack_error.

	* thread_pthread.c (ruby_stack_overflowed_p): checks for stack
	  overflow.

Thu Nov 27 10:40:52 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_div2): should return
	  Integer for #div operation.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_div2): should raise
	  ZeroDivisionError if divisor is zero.  [ruby-dev:37207]

Wed Nov 26 23:15:47 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* strftime.c (STRFTIME): use rb_strftime() recursively, instead of
	  platform's strftime().

Wed Nov 26 22:46:23 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpException): bigdecimal zero
	  division should raise FloatDomainError if mode
	  VP_EXCEPTION_ZERODIVIDE is set.  [ruby-dev:37204]

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode): should handle
	  VP_EXCEPTION_ZERODIVIDE.

Wed Nov 26 15:16:07 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/gdbm/gdbm.c (rb_gdbm_nextkey): fix memory leak.

Wed Nov 26 03:17:48 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_r): raise exception
	  for nan/inf conversion.  [ruby-dev:37187] fix #793

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_i): ditto.

Wed Nov 26 03:00:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpAlloc): avoid ALLOCA_N() to avoid
	  segmentation fault caused by (insanely) long decimal values.
	  [ruby-dev:37189] fix #794

	* ext/bigdecimal/bigdecimal.c (BigDecimal_dump, BigDecimal_to_i,
	  BigDecimal_to_f, BigDecimal_to_s, BigDecimal_split,
	  BigDecimal_inspect): ditto.

	* ext/bigdecimal/bigdecimal.c (VpToString): small performance
	  improvement.

Wed Nov 26 00:26:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* strftime.c (STRFTIME): should add padding for %[xXrR] etc.
	  [ruby-dev:37185] fix: #792

Tue Nov 25 16:26:12 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_times): taint (and untrust) status should be
	  inherited by "ary * 0".  [ruby-dev:37024]

Tue Nov 25 15:54:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* strftime.c (rb_strftime): should not swallow incomplete
	  formatter, e.g. "%E".  [ruby-dev:37170] fix: #787

	* strftime.c (rb_strftime): clear flags before processing unknown
	  formatter, e.g. "%i".  [ruby-dev:37180]

Tue Nov 25 10:35:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* strftime.c (rb_strftime): "%^P" should convert to upper case.
	  [ruby-dev:37180]

Tue Nov 25 07:51:18 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* strftime.c (FMT): use "%0d" formatter for zero padding, not "%.d".
	  [ruby-dev:37168]  fix: #768

	* strftime.c (rb_strftime): %s to use zero padding by default.
	  [ruby-dev:37180]

Tue Nov 25 03:37:42 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkextlib/blt/tabset.rb,
	  ext/tk/lib/tkextlib/blt/tabnotebook.rb:
	  fix many bugs. Now, those work properly.

Tue Nov 25 03:26:04 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (num_step): treat infinite step specially.
	  [ruby-dev:37157] fix: #781.

Tue Nov 25 01:23:25 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (strftime): ignores '_' flag for %[LN].

Tue Nov 25 00:08:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_fork): stops the timer thread during fork.
	  [ruby-dev:37117]

	* thread.c (rb_thread_start_timer_thread): timer thread needs
	  system_working to be set.

Mon Nov 24 23:27:28 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): The # flag should work with %a, %A, %b,
	  %B, and %h.  [ruby-dev:37162]

	* test/ruby/test_time.rb (test_strftime): ditto.

Mon Nov 24 23:16:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (register_sigaltstack): should not add external
	  variable (with some cosmetic changes).  [ruby-dev:37158]

Mon Nov 24 22:57:25 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): A width specifier for %t and %n should
	  work.  [ruby-dev:37160]

	* test/ruby/test_time.rb (test_strftime): ditto.

Mon Nov 24 22:07:07 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): The precision of %0N should be 9.
	  [ruby-dev:37156]

	* test/ruby/test_time.rb (test_strftime): ditto.

Mon Nov 24 21:38:23 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): The default precision should be 1, not
	  0.  [ruby-dev:37155]

	* test/ruby/test_time.rb (test_strftime): ditto.

Mon Nov 24 19:53:47 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (inspect): changed again.

Mon Nov 24 18:35:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/time.rb: r20251 reverted.  The patched behavior do not round
	  trip.  [ruby-core:19988]

Sun Nov 23 16:04:05 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* signal.c (default_handler, Init_signal): compile error if
	  USE_SIGALTSTACK is not defined.

Sun Nov 23 00:04:14 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* signal.c (ALT_STACK_SIZE): 4KB is not enough on Mac OS X.
	  Uses SIGSTKSZ.

Sat Nov 22 21:29:54 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_method.rb (test_default_accessibility): test case for
	  [ruby-dev:37124].

Sat Nov 22 18:24:24 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_file_world_writable_p): should return nil for non
	  world-writable files.

Sat Nov 22 10:31:25 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkextlib/blt.rb, ext/tk/lib/tkextlib/blt/vector.rb:
	  fix NameError bug.

Sat Nov 22 03:41:22 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/pty/pty.c (get_device_once): abandon asynchronous exception
	  that might cause serious problem if a program terminated early.
	  asynchronous exception is a very bad thing anyway.  use
	  Process.waitpid(pid) or PTY.check(pid) to poll program
	  termination. if PTY.check is called with optional second
	  argument being true, it raises an exception same as one from
	  previous behavior.  [incompatible] fix: [ruby-core:19583]

Fri Nov 21 22:24:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/curses.c (curses_escdelay_set): support ESCDELAY.  a
	  patch from Giancarlo F Bellido <support at coaxialhost.com> in
	  [ruby-core:19961].

Fri Nov 21 22:17:15 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (usage): -W description updated.  [ruby-core:19858]

Fri Nov 21 21:50:54 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (register_sigaltstack): use alternative stack for
	  SIGSEGV to avoid uncaught stack overflow. based on a patch from
	  Hiro Yoshioka <hyoshiok at miraclelinux.com> in [ruby-dev:37134].
	  [ruby-dev:36993]

Fri Nov 21 16:06:54 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm.c (thread_free): th->vm may be NULL when pthread_create
	  failed for ENOMEM.  [ruby-dev:37095]

Thu Nov 20 07:33:15 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/logger.rb (Logger): should handle the case that cvs/svn do
	  not expand $Id keyword.  [ruby-core:19991]

Thu Nov 20 07:27:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/minitest/unit.rb (MiniTest::Assertions#capture_io): adjust
	  indentation to shut up warning.  [ruby-core:19993]

Wed Nov 19 17:48:05 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/rubyext.c (rb_syck_mktime): return DateTime for a value
	  out of range of Time.   [ruby-core:19919]

Wed Nov 19 14:14:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* node.h (NOEX_MODFUNC): should be include NOEX_PRIVATE.
	  [ruby-dev:37124]

Wed Nov 19 03:01:04 2008  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb: fixed fails occasionally [ruby-dev:37119].
	  thanks, shinichiro.h.

Wed Nov 19 02:39:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (Init_syserr): moved function definition itself from
	  template/known_errors.inc.tmpl.

Wed Nov 19 01:10:52 2008  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (DRbConn::alive?): fixed NoMethodError problem
	  from NaHi [ruby-dev:37110].

Wed Nov 19 01:05:26 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (cont_mark, cont_capture, cont_restore_1): speed up
	  continuation by copying only valid YARV stack.  [ruby-dev:37106]

Wed Nov 19 00:03:13 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/time.rb: according to RFC2822, -0000 means local time, +0000
	  means UTC.  a patch from Chun Wang.   [ruby-core:19578]

Tue Nov 18 23:02:23 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (proc_eq): equivalence check should not done by pointer
	  comparison, but should be based on iseq contents.   [ruby-dev:37101]

Tue Nov 18 20:30:08 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/ftp.rb (Net::FTP#open_socket): SOCKSsocket is obsolete.
	  a patch from Alan Johnson <alan.wayne.johnson at gmail.com> in
	  [ruby-core:19982].

Tue Nov 18 16:18:23 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/logger.rb (ProgName): fixed for svn, based on a patch from
	  Nobuhiro IMAI at [ruby-dev:37108].

Tue Nov 18 15:56:55 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#read_request_line):
	  use possessive match for path retrieval to avoid huge recursion
	  for insanely long path.

Tue Nov 18 15:50:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_desc): re might be NULL.

	* regerror.c (onig_error_code_to_format): message updated.

Tue Nov 18 09:42:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::make_switch): makes default
	  conversion to splat.  [ruby-list:45645]

Mon Nov 17 18:05:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend (LIBS): fixed for disable-shared.  [ruby-dev:37103]

Mon Nov 17 11:12:24 2008  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* bin/erb: remove -K option.

Mon Nov 17 02:19:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBYARG_STATIC): fixed for --enable-rpath.

Sat Nov 15 22:46:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_regsub): returns -1 unless ascii as well as
	  rb_enc_ascget().  [ruby-dev:37097]

Sat Nov 15 22:23:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LDSHARED): do not suppress debug info if higher debug
	  level is given, on cygwin and mingw.

Fri Nov 14 20:27:46 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* README.EXT, README.EXT.ja, vm_exec.c, vm_insnhelper.c: update
	  filenames.

Thu Nov 13 11:31:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_barrier_wait): gets rid of recursive deadlock.

Thu Nov 13 06:08:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_barrier_{new,wait,release,destroy}): use Mutex so that
	  circular requires fail with deadlock.  [ruby-core:19821]

Wed Nov 12 07:16:01 2008  David Flanagan  <david@think32>

	* ruby.c (set_internal_encoding_once): fix typo in error string

Wed Nov 12 03:30:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_{external,locale}_str_new_cstr): optimized
	  versions for literal strings.

Wed Nov 12 03:28:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_require_safe): destroys barrier after successfully
	  loaded, to get rid of loading same library again.  [ruby-core:19798]

	* thread.c (rb_barrier_wait): can not wait destroyed barrier.

	* thread.c (rb_barrier_destroy): destroys barrier so that no longer
	  waited.

Tue Nov 11 23:02:27 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* man/ruby.1 (RUBYOPT): wrote which option can appear.
	  (--yydebug): wrote "do not use".
	  (--dump): wrote "do not use".

Tue Nov 11 21:22:28 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic#check_path): REL_PATH should a
	  symbol.  [ruby-core:19805]

Tue Nov 11 20:49:29 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* configure.in: fix SEGV on Mac OS X 10.5.3 with pthread.
	  a patch from Wataru Kimura in Bug #193 [ruby-core:17333].

Tue Nov 11 20:39:27 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (inspect): reverted the previous change.

Tue Nov 11 17:35:25 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_accept): secure fd before accept because if
	  error causes in securing, cannot restore the state of accepted
	  socket.
	  fixed [ruby-core:19728]

Tue Nov 11 14:40:40 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb: unnecessary setup method
	  (setup_really_needed?) removed

Tue Nov 11 14:25:25 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/single_byte.trans, macgreek-tbl.rb, macroman-tbl.rb,
	  macromania-tbl.rb, macturkish-tbl.rb, macukraine-tbl.rb,
	  ibm437-tbl.rb, ibm852-tbl.rb, ibm855-tbl.rb, ibm857-tbl.rb,
	  ibm860-tbl.rb, ibm861-tbl.rb, ibm862-tbl.rb, ibm863-tbl.rb,
	  ibm865-tbl.rb, ibm866-tbl.rb, ibm869-tbl.rb, ibm775-tbl.rb:
	  new single-byte transcodings (from Yoshihiro Kambayashi)

	* test/ruby/test_transcode.rb: added tests for the above
	  (from Yoshihiro Kambayashi)

Tue Nov 11 13:20:23 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_r): moved from
	  bigdecimal/util, converted into C.  [ruby-dev:36805]

Tue Nov 11 07:55:57 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (inspect): changed the format.

Mon Nov 10 17:34:50 2008  Akinori MUSHA  <knu@iDaemons.org>

	* test/sdbm/test_sdbm.rb (TestSDBM#test_index): Reflect the method
	  name change from #index to #key and remove a duplicated test
	  method.

Mon Nov 10 10:50:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator.delegating_block): should not refer
	  DelegateClass specific @delegate_dc_obj.  a patch from Erik
	  Hollensbe in [ruby-core:19671].

Mon Nov 10 09:54:21 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (ifs_open_socket): should retry without proto_buffer
	  if cannot find the suitable protocol. a patch from Heesob Park.
	  fixed [ruby-core:19713]

Sun Nov  9 13:04:52 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_initialize_m): avoid unnecessary array
	  allocation.

Sun Nov  9 04:10:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (control_frame_dump): suppresses finished method name.

Sun Nov  9 00:30:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (thread_timer): checks working flags again.

Sun Nov  9 00:02:01 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/session/pstore.rb: fix indentation.

Sat Nov  8 23:47:45 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/session.rb (FileStore): use marshalized data.

	* test/cgi/session_dir: add a session directory in test.

	* test/cgi/test_cgi_session.rb: add a test.

Sat Nov  8 21:57:03 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/session.rb: remove debug code.

Sat Nov  8 21:33:53 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/session.rb: fix indentation.

Sat Nov  8 18:11:14 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/webrick/httpproxy.rb (WEBrick::HTTPProxyServer#do_CONNECT):
	  use #bytesize instead of #size.  a patch submitted from
	  raspberry lemon in [ruby-core:18571].

	* lib/webrick/httpauth/digestauth.rb, lib/webrick/httpproxy.rb,
	  lib/webrick/httprequest.rb, lib/webrick/httpservlet/cgi_runner.rb,
	  lib/webrick/httpservlet/abstract.rb, lib/webrick/httpresponse.rb,
	  lib/webrick/httpservlet/cgihandler.rb, lib/webrick/utils.rb: ditto.

Sat Nov  8 17:31:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/stringio/stringio.c (strio_ungetc): ungetc position should
	  not be changed from 1.8.  [ruby-core:19632]

Sat Nov  8 17:15:08 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/optparse.rb (OptionParser#make_switch): 1.9 Symbols respond
	  to :match.  a patch from keith cascio, <keith at ucla.edu>.
	  [ruby-core:19730]

Sat Nov  8 12:10:15 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/gdbm/gdbm.c (fgdbm_index): make #index warn like Hash.
	  [ruby-dev:37039]

	* ext/sdbm/init.c (Init_sdbm): typo fixed.  [ruby-dev:37039]

Sat Nov  8 07:07:48 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: detect stdio buffer pointers for uClibc.  a patch
	  from Brian Candler <B.Candler at pobox.com> in [ruby-core:12020].
	  [ruby-core:19713]

Sat Nov  8 06:51:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/dbm/dbm.c (fdbm_index): make #index warn like Hash.

	* ext/dbm/dbm.c (fdbm_key): new method.

	* ext/sdbm/init.c: ditto.

Sat Nov  8 06:20:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/curses.c: curses encoding should obey locale.

	* ext/curses/curses.c (curses_getch): 1.9 getch should return one
	  character string for single byte string.  wchar_t support may
	  follow in the future.

Sat Nov  8 05:46:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h (rb_io_t): added write_lock to serialize.
	  [ruby-core:19668]

	* gc.c (gc_mark_children): mark write_lock.

	* gc.c (rb_gc_call_finalizer_at_exit): Mutex also needs to be
	  deferred.

	* io.c (io_fflush, io_binwrite, fptr_finalize): serializes writing.

Sat Nov  8 05:31:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* safe.c (safe_setter): add warning for $SAFE=3.

Sat Nov  8 01:48:07 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (rb_thread_create_timer_thread): do not wait never
	  coming signal if failed to create timer thread.

	* thread_pthread.c (native_cond_timedwait): returns error code.

	* thread_pthread.c (thread_timer): typo fixed.

Sat Nov  8 01:14:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (thread_timer, rb_thread_create_timer_thread):
	  handshakes properly.

Fri Nov  7 22:51:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* inits.c (rb_call_inits): do not repeat.

Fri Nov  7 22:46:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (thread_timer): initializes mutex each time.

Fri Nov  7 21:23:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_win32.c (thread_start_func_1): use already gotten stack info.

Fri Nov  7 12:26:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb.rb (IRB::Irb#eval_input): remove extra  @context.prompt_i.
	  [ruby-core:19718]

Fri Nov  7 11:55:30 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* nkf.c: update to r1.188. fixes for 16bit environment.

Fri Nov  7 07:43:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_timer): pthread_cond_timedwait returns ETIMEDOUT
	  when timed out.

Fri Nov  7 07:32:55 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/yaml/rubytypes.rb: support Rational and Complex as 1.8
	  does.  a patch from Hiroshi Moriyama in [ruby-dev:36899].

Fri Nov  7 07:12:06 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (thread_timer): uses pthread_cond_timedwait always
	  instead of pthread_kill.

Fri Nov  7 06:58:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (Init_String): remove Symbol#===.  [ruby-dev:37026]

Fri Nov  7 04:02:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_timer): uses timedwait on cygwin.

Fri Nov  7 02:00:12 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/rexml/entity.rb (unnormalized): do not call
	  document.record_entity_expansion if document is nil.
	  see <http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502535>.
	  Thanks, Naohisa Goto.

	* test/rexml/test_document.rb: ditto.

Fri Nov  7 01:24:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: binary encoding spec is no longer needed in 1.9.

Thu Nov  6 22:21:23 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_stop_timer_thread): terminates timer thread
	  immediately.

Thu Nov  6 21:21:46 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (fole_s_connect, fole_initialize,
	  folevariant_initialize): check argument type of WIN32OLE.connect,
	  WIN32OLE.new, WIN32OLE_VARIANT.new.

	* test/win32ole/test_win32ole.rb (test_s_new_exc, test_s_connect_exc):
	  ditto.

	* test/win32ole/test_win32ole_variant.rb (test_s_new_exc): ditto.

	* test/win32ole/test_win32ole_method.rb: add assertion of
	  WIN32OLE_METHOD.new.

Tue Nov  4 13:08:01 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit.setup_argv): now can specify ``-xname''
	  instead of ``-x name''.

Tue Nov  4 08:00:00 2008  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* test/zlib/test_zlib.rb(test_readchar): compare in same type.

Tue Nov  4 03:28:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_join): do not repeat self in a recursive array.
	  [ruby-dev:37019]

Tue Nov  4 01:56:46 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_mutex_synchronize): fixed prototype.

	* thread.c (rb_mutex_synchronize): fixed function name.

Mon Nov  3 16:32:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing.h: needs RUBY_EXTERN instead of extern for mswin.

Mon Nov  3 13:01:13 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* array.c (rb_ary_take_first_or_last): renamed rb_ary_partial more
	  appropriately.
	  (ary_take_pos_flags): new enum. makes the fourth argument of
	  rb_ary_take_first_or_last more descriptive.
	  (rb_ary_partial): renamed rb_ary_partial0 more appropriately.
	  takes a new parameter klass for what class to instantiate.

Mon Nov  3 13:00:26 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* range.c (rb_range_beg_len): rb_raise takes C values as arguments.
	  [BUG] ranges turned into other value in a message of RangeError.

Mon Nov  3 00:36:44 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_event.rb: rename test class.

	* test/win32ole/test_win32ole_variant_outarg.rb: add in order
	  to use ADO instead of Internet Explorer.
	  remove test/win32ole/test_win32ole_variant_with_ie.rb.

	* test/win32ole/orig_data.csv: ditto.

Sun Nov  2 23:08:08 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_err_in_callback.rb: add teardown.

Sun Nov  2 22:12:41 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_event_free): invoke IConnectionPoint::Unadvise
	  before invoking IConnectionPoint::Release.

	* test/win32ole/test_win32ole_event.rb, test/win32ole/err_in_callback.rb,
	  test/win32ole/test_err_in_callback.rb: Use ActiveX Data Object
	  Library instead of InternetExplorer.

Sun Nov  2 22:06:55 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* win32/Makefile.sub: add RUNRUBYOPT. [ruby-dev:37009]

Sun Nov  2 16:41:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (Init_zlib): defines readbyte instead redefining
	  readchar.

Sat Nov  1 07:09:40 2008  Eric Hodel  <drbrain@segment7.net>

	* gem_prelude.rb: Don't require rubygems/defaults.rb.

Fri Oct 31 21:58:50 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/converter.rb (RSS::Converter): use String#encode.

Fri Oct 31 21:28:14 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/webrick/httpauth/digestauth.rb
	  (WEBrick::HTTPAuth::DigestAuth#initialize): fix typo.

Fri Oct 31 18:51:42 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_array.rb (test_array_subclass): test for r20076.

Fri Oct 31 18:42:19 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* array.c (ary_partial0): recovers the mistakenly changed feature at r19723.
	  Array#[m,n] had returned an Array even for an instance of a
	  subclass.

Fri Oct 31 18:05:05 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/single_byte.trans, maccroatioan-tbl.rb,
	  maccyrillic-tbl.rb, maciceland-tbl.rb: new single-byte
	  transcodings (from Yoshihiro Kambayashi)

	* test/ruby/test_transcode.rb: added tests for the above
	  (from Yoshihiro Kambayashi)

Fri Oct 31 12:51:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_globs): need taint check.  reported by steve
	  <oksteev at gmail.com>

Fri Oct 31 12:42:45 2008  wanabe  <s.wanabe@gmail.com>

	* array.c (rb_ary_decrement_share): fix to work recycling
	  shared-array without the following.  [ruby-dev:36991]

	* array.c (ary_make_substitution): don't recycle substitution array.

Fri Oct 31 12:27:52 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/default.mspec: supports that the build directory != srcdir.

Fri Oct 31 11:35:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_set_default_internal): no alias "internal" if
	  default internal is not set.  [ruby-dev:37000]

Fri Oct 31 08:16:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): delays setting safe level.
	  [ruby-dev:36997]

Thu Oct 30 21:32:15 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (rb_ary_permutation): hide temporal array.

Thu Oct 30 14:45:45 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/single_byte.trans: refactoring to make it easier
	  to add more transcodings (with Yoshihiro Kambayashi)

	* enc/trans/iso-8859-1-tbl.rb: new file to avoid having to
	  treat ISO-8859-1 as special

Thu Oct 30 14:10:46 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): templates a, A, Z should propagate encoding
	  of original strings.  templates b, B, h, H brings ASCII-8BIT to
	  the result.

Thu Oct 30 10:34:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (moreswitches): splits option string and passes arguments.

	* ruby.c (proc_options): checks if allowed in RUBYOPT.

	* ruby.c (process_options): allows long style options in RUBYOPT.

	* ruby.c (load_file_internal): ditto in shebang.  [ruby-dev:36979]

Thu Oct 30 09:31:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_locale_encoding): makes an alias for locale.
	  [ruby-dev:36976]

	* encoding.c (rb_enc_set_default_external): ditto for external.

	* encoding.c (rb_enc_set_default_internal): ditto for internal.

Thu Oct 30 03:30:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (load_file_internal): should not set script encoding to
	  ASCII-8BIT.

	* ruby.c (load_file_internal): do not auto convert scripts even
	  when default_internal is set.  [ruby-core:19579]

Thu Oct 30 02:20:33 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (rb_ary_sort_bang): remove SEGV when replacing array with
	  embedded one during sort.  [ruby-dev:36983]

	* test/ruby/test_array.rb (test_sort!): add tests for above.

Thu Oct 30 01:44:23 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb: add some tests.

Thu Oct 30 01:32:15 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (rb_ary_splice): remove redundant check.

Thu Oct 30 01:24:55 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (rb_str_cmp): fix condition which always returned true
	  because ENCODING_GET returns unsigned long.

Thu Oct 30 01:10:32 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb (test_permutation): add a test that replaces
	  array during permutation.

Wed Oct 29 23:31:34 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_check_dummy_enc): new function to check dummy
	  encoding.

	* string.c (rb_str_upcase_bang): case conversion functions should
	  not be applicable to strings in dummy encoding.  [ruby-dev:36985]

Wed Oct 29 23:57:29 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (rb_ary_sort_bang): replacing array during sort broke
	  invariant of array.  [ruby-dev:36983]

Wed Oct 29 21:06:46 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_rewind): should reset fptr->readconv if it's
	  available.

	* io.c (more_char): clear readconv at EOF.

	* test/ruby/test_file.rb: should not read after EOF.  use rewind
	  instead.

Wed Oct 29 20:45:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/webrick/utils.rb (start_server): provide a reference to log of
	  webrick.

	* test/webrick/test_httpproxy.rb, test/webrick/test_httpauth.rb,
	  test/webrick/test_cgi.rb, test/webrick/test_httpserver.rb,
	  test/webrick/test_server.rb, test/webrick/test_filehandler.rb: use
	  webrick log as an assertion message.

Wed Oct 29 16:41:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_pack): set encoding from packing string and UTF-8 for
	  "U".  [ruby-core:19590]

Wed Oct 29 15:50:00 2008  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* complex.c (imp1, imp2): should declare type.
	  [BUG] at IA-64

Wed Oct 29 14:36:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (revision.h): have to be updated daily or by non-trivial
	  commits.

Wed Oct 29 13:18:02 2008  Akinori MUSHA  <knu@iDaemons.org>

	* README, README.ja: Update the portability section.

Wed Oct 29 13:02:17 2008  Akinori MUSHA  <knu@iDaemons.org>

	* configure.in (rb_cv_lib_xpg4_needed): Drop legacy FreeBSD
	  support regarding libxpg4.  Those old versions of FreeBSD
	  shipped with the library don't have a working pthread library
	  anyway.

Wed Oct 29 11:50:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (dln-a-out): cannot make shared library nor work with
	  ELF.  [ruby-core:19571]

Wed Oct 29 11:00:25 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_open): shouldn't seek here.

	* win32/win32.c (rb_w32_write): write to the end of the file when
	  FAPPEND is specified.

Wed Oct 29 09:30:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): cache common interned IDs.

Wed Oct 29 00:43:39 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: uses macro in declarations.

Wed Oct 29 00:26:00 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_open): need to seek to the end of the file when
	  O_APPEND is specified.

Wed Oct 29 00:08:05 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* math.c (rb_math_{atan2,cos,cosh,hypot,log,sin,sinh,sqrt}): added.

	* complex.c: follows the above change.

Tue Oct 28 23:29:06 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (kanji_convert): output unicode chars.
	  [ruby-dev:36957]

	* ext/nkf/nkf-utf8/nkf.c (numchar_getc): increase buffer size.
	  reported and patched at [ruby-dev:36957] by mame.

Tue Oct 28 23:03:46 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/test_proc.rb: filled all patterns for testing
	  vm_yield_setup_args.

Tue Oct 28 23:05:35 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: continues to support canonicalization *unofficially*
	  for an odd library mathn for the time being (only 1.9.x).
	  since grand mathn must be very very special library for us.

	* rational.c: ditto.

	* ext/mathn/*/*: follow the above changes.

Tue Oct 28 21:31:55 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (parser_yylex): check EOF explicitly.

Tue Oct 28 20:59:12 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (extract_binmode): new function to extract binmode/textmode
	  options from hash.

	* io.c (rb_io_extract_modeenc): use above function.

	* io.c (rb_io_s_pipe): recognize binmode/textmode options.

Tue Oct 28 20:15:49 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (make_readconv): now can specify the size of cbuf.

	* io.c (read_all, appendline, io_getc, rb_io_ungetc): follow above
	  change.

Tue Oct 28 19:00:51 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_pipe_exec): internal fds should be always
	  binmode.

Tue Oct 28 17:21:18 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* tool/make-snapshot.rb: merged from ruby_1_9_1.

Tue Oct 28 16:56:31 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* gem_prelude.rb: merged from ruby_1_9_1 branch.
	  considers --program-suffix and prefix configure options.

	* lib/rubygems/defaults.rb: ditto.

	* test/rubygems/test_gem.rb (@default_dir_re): ditto.

Tue Oct 28 16:13:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: use String#bytesize.

Tue Oct 28 09:51:48 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bootstraptest/test_thread.rb: ignore some exceptions.
	  [ruby-dev:36951]

Tue Oct 28 09:19:40 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (RUNRUBY): now ruby requires something from
	  gem_prelude, so need to set library path.

Mon Oct 27 22:29:11 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* vm_insnhelper.c (vm_yield_setup_args): supports optional parameters.
	  Fixed [ruby-core:19503].

	* vm_insnhelper.c (vm_yield_setup_block_args): a new function. extracted
	  from vm_yield_setup_args.

	* vm_insnhelper.c (vm_yield_setup_block_args_complex): ditto.

	* test/ruby/test_proc.rb: added tests for arguments on a Proc from
	  Kernel#proc called.

Mon Oct 27 20:03:05 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/mathn/complex/complex.c: no need to define rb_cComplex because
	  it's already defined at $(srcdir)/complex.c.

	* ext/mathn/rational/rational.c: no need to define rb_cRational because
	  it's already defined at $(srcdir)/rational.c.

Mon Oct 27 15:58:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file): preserves $..  [ruby-dev:36937]

	* io.c (argf_init): initial value of $. should be 0.
	  see [ruby-dev:36937].

Mon Oct 27 15:38:38 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/minitest/test_mini_test.rb
	  (test_assert_raises_triggered_different): the test failed when a
	  file path in the backtrace contains something except [\w\/\.],
	  e.g. hyphen, Japanese characters or backslash.

	* test/minitest/test_mini_test.rb
	  (test_assert_raises_triggered_subclass): ditto.

Mon Oct 27 15:32:08 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/minitest/test_mini_test.rb: fixed that r19958 made
	  test-all fail when the ruby was built at $(srcdir).

Mon Oct 27 12:04:58 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/envutil.rb: reverted the changeset 19948 because it
	  concealed unexpected behaviours of ruby.

	* test/ruby/test_io.rb: ditto.

Mon Oct 27 12:02:53 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/nkf/nkf.c (rb_nkf_convert): should specify type of variable.

Mon Oct 27 11:34:56 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/minitest/test_mini_test.rb (test_filter_backtrace):
	  fixed failure on Ruby built at out of $(srcdir).

	* test/minitest/test_mini_test.rb (test_Filter_backtrace_unit_starts):
	  ditto.

Mon Oct 27 10:02:47 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (read_all): the 3rd argument maybe Qnil.

Mon Oct 27 01:29:55 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/nkf/test_nkf.rb: add a test for [ruby-dev:36909].

Mon Oct 27 01:05:48 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf.c (rb_nkf_convert): avoid GC.
	  reported in [ruby-dev:36909] and patched [ruby-dev:36941] by mame.

Sun Oct 26 21:28:42 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/json/test_json.rb: remove dependency on permutation gem.

Sun Oct 26 19:18:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (blocking_region_{begin,end}): declared as inline.

	* util.c (freedtoa): used only when MULTIPLE_THREADS is not defined.

	* win32/win32.c (rb_w32_pipe): serial is DWORD.

	* ext/etc/etc.c (sGroup): getgrent may not be available.

Sun Oct 26 18:11:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/wait/{extconf.rb,wait.c}: needs sys/ioctl.h for fcntl on
	  cygwin.

Sun Oct 26 18:18:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gem_prelude.rb: disables debug and verbose flags to suppress failure
	  messages.  interpolation does not occur inside single quotes.

Sun Oct 26 18:42:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (assert_in_out_err): disables builtin rubygems
	  to get rid of the interference.

	* test/ruby/test_io.rb (ruby): ditto.

Sun Oct 26 13:30:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (read_all): use the given buffer to read when needs readconv.
	  based on the patch by wanabe <s.wanabe AT gmail.com> at
	  [ruby-dev:36931].

Sun Oct 26 07:57:35 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*: Update to RubyGems 1.3.1 r1909.

Sun Oct 26 07:35:56 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/unit.rb: Imported minitest 1.3.0 r4429.
	* test/minitest/*: ditto.

Sun Oct 26 02:16:29 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in ($MANTYPE): followed ruby.1, which had moved.

	* instruby.rb (:man): ditto.

	* mdoc2man.rb: fixed for the case Xr with 2 arguments.

Sun Oct 26 01:42:45 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* man/irb.1: new manual page.

Sun Oct 26 00:11:48 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* man/ruby.1: moved into man/. added some descriptions.

	* man/goruby.1: new file.

	* instruby.rb (:man): followed ruby.1.

Sat Oct 25 20:05:22 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (gc_profile_result): bug fix. The millisecond is 1/1000.

Sat Oct 25 11:12:40 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ruby.c (usage): updated the description of -E option.

Sat Oct 25 09:54:10 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb:  Fixed a bug in read_to_char() that would slurp
	  whole files if the encoding was invalid.  It will now read
	  up to 10 bytes ahead to find a valid character boundary or
	  give up.  [ruby-core:19465]

	* test/csv/test_features.rb, test/csv/test_table.rb, test/csv/test_row.rb:
	  Loosened some tests to check for a compatible? Encoding instead
	  of an exact Encoding.  [ruby-core:19470]

Sat Oct 25 07:42:49 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc*: Update to RDoc 2.2.2 r192.

Sat Oct 25 04:00:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/us_ascii.c (us_ascii_mbc_enc_len): made static.  a patch by
	  Tadashi Saito <shiba AT mail2.accsnet.ne.jp> at [ruby-dev:36916]

	* signal.c (signal_buff): made static.  a patch by Tadashi Saito
	  <shiba AT mail2.accsnet.ne.jp> at [ruby-dev:36915]

	* util.c (freedtoa): made static to get rid of name clash.  a patch by
	  Tadashi Saito <shiba AT mail2.accsnet.ne.jp> at [ruby-dev:36913]

	* util.c (ruby_dtoa): added prefix, ditto.

Sat Oct 25 03:43:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lambda): need to adjust lpar_beg for both of the parser and
	  ripper.

Sat Oct 25 01:29:34 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/mathn/rational/rational.c: undef duplicated macro definition
	  first to shut up the warning.

	* ext/mathn/rational/rational.c (rb_rational_new_mathn): specify
	  omitted return value.

Sat Oct 25 00:14:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sample): fixed sizes and randomness.

Fri Oct 24 23:04:42 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in (sitedir): considers --program-prefix and
	  --program-suffix.
	  (vendordir): ditto.
	  (rubyhdrdir): ditto.

	* mkconfig.rb (CONFIG["rubylibdir"]): ditto.

	* win32/Makefile.sub: ditto.

	* instruby.rb (:rdoc): ditto.

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths): ditto.

Fri Oct 24 22:59:27 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb (test_sample): add tests for size of
	  returned array and randomness.

Fri Oct 24 21:50:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* id.h, template/id.h.tmpl (enum ruby_method_ids): reordered.

Fri Oct 24 21:19:45 2008  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* ext/mathn/rational.c: change several global functions.

Fri Oct 24 21:05:38 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/html.rb: allow symbolized key.

	* test/cgi/test_cgi_tag_helper.rb: add a test.

Fri Oct 24 20:54:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (exts): renamed to get rid of the existent directory.

Fri Oct 24 20:45:41 2008  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* ext/mathn/rational.c: change several global functions to static
	  function.

Fri Oct 24 19:57:19 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_dump): should have removed commented out
	  unnecessary code.  [ruby-cvs:27131]

Fri Oct 24 19:16:36 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* id.h (enum ruby_method_ids): ISO C forbids comma at end of
	  enumerator list.

Fri Oct 24 18:29:00 2008  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/mathn.rb: moved into ext/mathn/rational/rational.c and
	  ext/mathn/complex/complex.c.
	* ext/mathn: new mathn ext-libraries.

Fri Oct 24 18:21:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_array.rb (TestArray#test_join): should restore
	  global variable after the test.  [ruby-dev:36896]

	* test/ruby/test_hash.rb (TestHash#test_to_s): ditto.

Fri Oct 24 17:43:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (lambda): need to adjust lpar_beg for ripper as well.
	  [ruby-dev:36702]

Fri Oct 24 16:13:12 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (read_multipart): change field value as String
	  from StringIO or Tempfile when multipart parse except file field.
	  add files method that can get uploaded files. [ruby-dev:36547]

	* test/cgi/test_cgi_multipart.rb: fix the test for core.rb.

Fri Oct 24 14:22:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ext): split out the target for extension library.

	* common.mk (encs): depends on enc and trans.

Fri Oct 24 10:23:24 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_signal.rb (TestSignal#test_exit_action): Thread
	  may terminate before sysread. [ruby-dev:36835]

Thu Oct 23 22:06:23 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* distruby.rb: removed. "make dist" uses tool/make-snapshot for the 1.9
	  series. distruby.rb has been no longer used.

Thu Oct 23 17:30:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (rb_class_instance_methods): rdoc fixed.  [ruby-core:19458]

Thu Oct 23 16:19:33 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/init.rb (IRB.load_modules): catch LoadError explicitly.
	  a patch from Daniel Berger <Daniel.Berger at qwest.com> in
	  [ruby-core:19451].  fix [ruby-core:19450]

Thu Oct 23 16:16:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (sock_s_getservbyport): check if the port range.
	  [ruby-core:19460]

Thu Oct 23 14:08:07 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (sock_s_getservbyname): unuse unnecessary
	  object.

	* ext/socket/socket.c (sock_s_getservbyport): the port should be
	  converted before the proto so that the #to_int of the former cannot
	  alter the latter.

Thu Oct 23 10:55:08 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_dump): use \u{ff} escape for UTF-8 encoding
	  string.

Thu Oct 23 09:26:22 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (sock_s_getservbyport): cast to get rid of
	  warning.

Thu Oct 23 08:06:03 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_s_getservbyport): port should be
	  network byte order.  a patch from Dave Thomas in [ruby-core:19454].

Thu Oct 23 01:26:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_conv_enc_opts): new function to convert with
	  specifying ecflags and ecopts.

	* ext/zlib/zlib.c (gzfile_newstr): specify ecflags and ecopts for
	  conversion using above function.

	* ext/zlib/zlib.c (gzfile_newstr): use own rb_econv_t for dummy
	  encoding to handling stateful encoding (e.g. iso-2022-jp).
	  [ruby-dev:36857]

	* ext/zlib/zlib.c (gzfile_getc): ditto.

Thu Oct 23 01:24:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_tmpsrc): get rid of side effects.

Thu Oct 23 00:10:01 2008  Koichi Sasada  <ko1@atdot.net>

	* cont.c: separate data structure between rb_fiber_t and
	  rb_context_t (rb_fiber_t includes rb_context_t).
	  rb_fiber_t has double linked list of fibers in same threads.

Wed Oct 22 17:25:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (pipe_open): remove unnecessary flush before fork.
	  a patch from Kazuhiro NISHIYAMA <zn at mbf.nifty.com>
	  in [ruby-dev:36840].

Wed Oct 22 16:27:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_yield_setup_args): should not drop arguments
	  corresponding to default parameters.

Wed Oct 22 14:59:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_larglist): should not allow semicolon separated local
	  variable declarations if formal argument list is not surrounded
	  by parentheses, mostly because semicolon outside of parentheses
	  appears to terminate the expression.

Wed Oct 22 14:52:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_external_str_new_with_enc): no implicit strlen call.
	  [ruby-dev:36854]

	* string.c (rb_external_str_new_cstr): new function to create
	  string from external NUL terminated C string.

	* string.c (rb_locale_str_new_cstr): ditto.

	* ext/readline/readline.c: now use rb_locale_str_new_cstr().

	* test/sdbm/test_sdbm.rb (TestSDBM#test_delete_with_block):
	  deleted key to the block may be a copy of specified key.

	* test/dbm/test_dbm.rb (TestDBM#test_delete_with_block): ditto.

Wed Oct 22 13:16:47 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (unescape_escaped_nonascii): back out the last change on
	  the function.  [ruby-dev:36818]

Wed Oct 22 07:09:19 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/zlib/zlib.c (rb_gzreader_ungetc): should be able to unget
	  Fixnum.

	* ext/stringio/stringio.c (strio_ungetc): should convert unget
	  string.

	* ext/stringio/stringio.c (strio_ungetbyte): new method.

Wed Oct 22 05:46:25 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/vm.h: write a comment.

	* common.mk: remove vm.h from any rules.
	  vm.h is not needed on this version.

	* vm_core.h: ditto.

Wed Oct 22 05:39:39 2008  Koichi Sasada  <ko1@atdot.net>

	* parse.y (arg_concat_gen): concat target node should be NODE_ARRAY.
	  [ruby-core:19413]

	* bootstraptest/test_method.rb: add tests.

Wed Oct 22 00:29:13 2008  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb (test_core_03_notify): Fixed test failures
	  [ruby-dev:36837].

Wed Oct 22 00:22:06 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_external_str_new_with_enc): wrong condition to
	  calculate strlen().

	* ext/readline/readline.c: add encoding support.

Tue Oct 21 23:12:24 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/stringio/stringio.c (strio_write): should convert writing
	  string to the encoding of the buffer.

	* hash.c (rb_any_hash): typo fixed.

	* ext/zlib/zlib.c (rb_gzwriter_write): oops, IO string conversion
	  need to be done by to_s.

Tue Oct 21 22:38:58 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (open_key_args): should adjust argc, argv in struct
	  foreach_arg.

Tue Oct 21 21:52:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/zlib/zlib.c (rb_gzwriter_write): conversion should be done
	  using to_str, not to_s.

	* ext/zlib/zlib.c (rb_gzwriter_write): need proper conversion
	  according to gz encoding.

	* ext/zlib/zlib.c (rb_gzreader_ungetc): convert string encoding
	  before unget.

Tue Oct 21 21:33:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (assert_nothing_raised): raise with backtrace.

Tue Oct 21 20:12:19 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit.rb (assert_nothing_raised): set backtrace.

Tue Oct 21 18:17:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/zlib/zlib.c: remove obsolete prototype macros.

	* ext/zlib/zlib.c (struct gzfile): add encoding field to gzfile
	  structure.

	* ext/zlib/zlib.c (rb_gzreader_getc): now works on characters.

	* ext/zlib/zlib.c (rb_gzreader_getbyte): new method to retrieve
	  single byte.

	* ext/zlib/zlib.c (rb_gzreader_readbyte): ditto.

	* ext/zlib/zlib.c (rb_gzreader_each_byte): renamed from each_char

	* ext/zlib/zlib.c (rb_gzreader_ungetc): allow unget strings.

	* ext/zlib/zlib.c (rb_gzreader_ungetbyte): renamed from ungetc.

Tue Oct 21 13:28:42 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* io.c, include/ruby/intern.h (rb_io_ascii8bit_binmode): externed.

	* ext/socket/socket.c (init_sock): use rb_io_ascii8bit_binmode()
	  instead of rb_io_binmode().

Tue Oct 21 13:17:39 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* mdoc2man.rb: moved into tools/.

	* instruby.rb: followed the change of mdoc2man.

Tue Oct 21 11:34:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (strip_glibc_option, map_charset): check if
	  encoding is a string.  based on the patch by Hiroshi Moriyama at
	  [ruby-dev:36811].

	* test/iconv/test_basic.rb (test_invalid_arguments): added tests.

Tue Oct 21 10:40:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_file_open_internal): should initialize fmode before using.

Tue Oct 21 08:56:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regparse.c (parse_char_class): CCV_SB is only for single
	  byte.  [ruby-dev:36786]

Tue Oct 21 01:49:55 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_extract_modeenc): plain rb/wb should set ASCII-8BIT
	  to the external_encoding.

	* io.c (rb_file_open_internal): ditto.

	* io.c (NEED_WRITECONV): no conversion when the external_encoding
	  is ASCII-8BIT.

	* io.c (do_writeconv): skip ASCII-8BIT.

Tue Oct 21 00:51:59 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_ascii8bit_binmode): renamed from rb_io_binmode.
	  (rb_io_binmode): don't change encoding conversion.
	  (rb_io_binmode_m): call rb_io_ascii8bit_binmode.

Mon Oct 20 21:19:00 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (read_multipart): file's encoding is ascii-8bit
	  from file field of multipart form.

Mon Oct 20 20:16:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/zlib/zlib.c (Init_zlib): add getbyte as an alias to getc.
	  [ruby-dev:36801]

Mon Oct 20 17:31:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (exc_equal): should not compare recursively.
	  [ruby-dev:36796]

Mon Oct 20 16:48:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/ruby.h (ExportStringValue): new macro to convert
	  string in internal encoding to external to export.

	* string.c (rb_str_export): new function to do conversion to
	  external encoding.

	* ext/sdbm/init.c: encoding conversion support.

	* ext/dbm/dbm.c: ditto.

Mon Oct 20 15:42:02 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_locale_str_new): new function to convert string
	  from locale to internal encoding.

Mon Oct 20 09:47:13 2008  Tanaka Akira  <akr@fsij.org>

	* test/runner.rb: search srcdir/test/arg at first to find test/ruby
	  directory when "ruby" is specified.

Mon Oct 20 08:20:01 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: support Encoding.default_internal.

	* ext/tk/tcltklib.c: ditto.

	* ext/tk/extconf.rb: improve the strategy for searching Tcl/Tk headers.

Mon Oct 20 00:57:04 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit.rb (Test::Unit.setup_argv): call given block for
	  filtering files.

	* test/runner.rb: search srcdir/test/arg, srcdir/arg.

	* bin/testrb: show usage if no files given.

Sun Oct 19 21:19:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (srcs): removed ID_H_TARGET.

	* tool/generic_erb.rb: always overwrites if no if-change option.
	  sends the result to stdout if no output option.

	* template/id.h.tmpl: shows which token differs.

Sun Oct 19 18:15:15 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/single_byte.trans: adding WINDOWS-wwww encodings
	  (wwww = 874/1250/1251/1253/1254/1255/1256/1257)
	  (contributed by Yoshihiro Kambayashi)

	* enc/trans/windows-wwww-tbl.rb: 8 new files
	  (contributed by Yoshihiro Kambayashi)

	* test/ruby/test_transcode.rb: added test_windows_wwww
	  (contributed by Yoshihiro Kambayashi)

Sun Oct 19 07:37:13 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (log2,cbrt,frexp,ldexp,hypot,erf,erfc,gamma,lgamma):
	  should be also provided as module function.  [ruby-dev:36787]

Sun Oct 19 07:25:08 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* keywords, lex.c.src, opt_insn_unif.def, opt_operand.def: moved rarely changed
	  input files for code generators into defs/ directory.

	* Makefile.in (lex.c): followed keywords and lex.c.src.

	* common.mk (parser.o): followed keywords.
	  (INSNS): followed opt_*.def

	* tools/instruction.rb: followed opt_*.def.

Sun Oct 19 12:28:01 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* test/csv/*:  Renamed tc_* files to test_* to fit in within Ruby's
	  testing process.

Sun Oct 19 00:15:03 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit.rb (assert_nothing_thrown): don't intern.

Sat Oct 18 14:40:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (num_sadded): remove newly defined singleton method
	  that should not exist after exception handling.  [ruby-dev:36569]

Sat Oct 18 14:27:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (opt_block_arg): allow trailing comma after usual
	  arguments.  not after block argument.

Sat Oct 18 13:30:53 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_external_str_new): a new function to convert from
	  external encoding to internal encoding.  if something went
	  wrong, it returns a string with the external encoding.

	* string.c (rb_external_str_new_with_enc): same as above besides
	  you can specify the source encoding.

	* ruby.c (ruby_set_argv): use rb_external_str_new()

	* ruby.c (set_arg0, ruby_script): ditto.

Sat Oct 18 04:08:18 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#initialize): now Tempfile.new takes
	  keyword arguments to open().  [ruby-dev:36756]

Sat Oct 18 17:10:10 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* tool/transcode-tblgen.rb: added set_valid_byte_pattern
	  to reduce coupling between table generation script and
	  specific encodings.

	* enc/trans/single_byte.trans: using set_valid_byte_pattern

Sat Oct 18 16:39:39 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c: in transcode_search_path, eliminated a warning
	  on cygwin about pathlen potentially not being initialized

Sat Oct 18 13:40:27 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit.rb (assert_nothing_thrown): implemented.

Sat Oct 18 01:33:22 2008  WATANABE Hirofumi  <eban@ruby-lang.org>

	* common.mk: use added options for generic_erb.rb.

Sat Oct 18 00:47:51 2008  wanabe  <s.wanabe@gmail.com>

	* array.c: don't recycle shared-array while sort!.

Fri Oct 17 22:04:38 2008  wanabe  <s.wanabe@gmail.com>

	* array.c: recycle shared-array when it isn't referenced.

Fri Oct 17 20:29:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_initialize_m): specify ARG_ENCODING_NONE instead of
	  ARG_ENCODING_FIXED for Regexp.new("", nil, "n").  [ruby-dev:36761]

	* test/ruby/test_regexp.rb (TestRegexp#test_initialize): test
	  updated.

Fri Oct 17 19:46:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/ifchange, win32/ifchange.bat: --timestamp option added.

	* tool/generic_erb.rb: --timestamp, --output and --if-change options
	  added.

Fri Oct 17 18:33:12 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* array.c (ary_resize_capa): renamed RESIZE_CAPA.

Fri Oct 17 18:16:51 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/bigdecimal/test_bigdecimal.rb (TestBigDecimal#test_sqrt_bigdecimal):
	  test updated.  a patch from TAKANO Mitsuhiro <takano32 at jus.or.jp> in
	  [ruby-dev:36736].

Fri Oct 17 18:14:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (uncommon.mk): ignores failures at loading.

	* test/rubygems/gemutilities.rb (RubyGemTestCase#build_rake_in):
	  get rid of interference with other tests.

Fri Oct 17 18:06:39 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* transcode.c (str_transcode0): String#encode without argument now
	  behave as if :undef => :replace, :invalid => :replace specified.

	* transcode.c (rb_econv_prepare_opts): should preserve options in
	  any case.

Fri Oct 17 11:48:18 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/socket/socket.c (init_sock): sockets should be binmode.

	* test/socket/test_tcp.rb (test_encoding): ditto.

Fri Oct 17 10:26:13 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/insns2vm.rb: remove -Kn option in shebang line because it's
	  inconsistent with -Ks commandline option in common.mk.

Fri Oct 17 01:26:09 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_restartable0): in_pos and out_pos never be
	  NULL, now.

Fri Oct 17 00:39:19 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/test/unit.rb: sort the order of executing tests.

Fri Oct 17 00:24:15 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_binmode): reset encoding conversion.

Fri Oct 17 00:16:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (rb_getc, rb_io_fread, rb_io_fwrite, rb_read_pending):
	  remove deprecated functions which do not work.  [ruby-dev:36697]

Thu Oct 16 23:48:34 2008  Tanaka Akira  <akr@fsij.org>

	* common.mk (TESTS): removed to re-enable test for minitest.

Thu Oct 16 23:37:11 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_set_sequence): fix memory leak.

Thu Oct 16 23:27:27 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit.rb (assert_equal): avoid incompatible character
	  encodings error.

Thu Oct 16 23:23:27 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit.rb (assert_equal): failure message changed.

Thu Oct 16 22:52:54 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit: removed test/unit.

	* lib/test/unit.rb: new compatibility layer using minitest.

	* bin/testrb: use above.

	* test/runner.rb: ditto.

Thu Oct 16 14:34:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk, enc/depend (enc, trans): targets for sources.

Thu Oct 16 14:30:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (lib): installs all files other than README etc.

Thu Oct 16 09:48:03 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_initialize_m): changed the message to clarify the
	  third option argument is now ignored.  [ruby-dev:36753]

Thu Oct 16 08:14:39 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (proc_options): no warning when default_external already
	  set by -E.

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_rubyopt):
	  put -K after -E to set script encoding.

Thu Oct 16 06:20:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_transcode.rb (TestTranscode#test_errors):
	  String#encode now works without any argument. [ruby-dev:36740]

Wed Oct 15 23:48:22 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* .gdbinit (rp): REGEXP handling fixed.

	* string.c (rb_str_rindex_m): need not to call rb_enc_check on
	  regexp.

	* re.c (unescape_escaped_nonascii): try ASCII-8BIT encoding for
	  broken strings.

Wed Oct 15 23:11:10 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (DelegateClass): restored 1.8 behavior for
	  DelegateClass as well.  [ruby-dev:36739]

Wed Oct 15 22:19:14 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* array.c (RESIZE_CAPA): check whether len is longer than capacity.

	* array.c (rb_ary_compact_bang): resize ary before changing capacity.
	  fixed [ruby-dev:36704]

Wed Oct 15 16:57:30 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* version.h (RUBY_DESCRIPTION): remove unnecessary space.

Tue Oct 14 23:18:15 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator): simplified and restored 1.8
	  behavior.  [ruby-dev:35986]

Tue Oct 14 21:50:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (TESTS): skips minitest by default, since it interferes
	  with test/unit.

Tue Oct 14 21:36:29 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (load_conv_function51932): check
	  having IMultiLanguage2 or IMultiLanguage. [ruby-dev:36716]

	* ext/win32ole/extconf.rb: ditto.

Tue Oct 14 20:45:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (Init_IO): $FILENAME and $* must be read-only.  [ruby-dev:36698]

	* variable.c (*_getter, *_setter, *_marker): made public.

	* include/ruby/ruby.h (rb_gvar_*_{getter,setter,marker}): declared.

Tue Oct 14 20:32:09 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/single_byte.trans (transcode_tblgen_singlebyte): renamed
	  from transcode_tblgen_windows.
	  (transcode_tblgen_iso8859): use transcode_tblgen_singlebyte.

Tue Oct 14 19:32:14 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (process_options): -U should be allowed in RUBYOPT
	  environment variable.  [ruby-dev:36720]

Tue Oct 14 14:11:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): -U can be followed by other options.

Tue Oct 14 13:30:30 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/single_byte.trans: added windows-1252

	* enc/trans/windows-1252-tbl.rb: new file
	  (contributed by Yoshihiro Kambayashi)

	* tool/transcode-tblgen.rb: listed windows-1252 as '1byte'

	* test/ruby/test_transcode.rb: added test_windows_1252
	  (contributed by Yoshihiro Kambayashi)

Tue Oct 14 12:22:32 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_variable.rb (TestVariable#test_variable): add
	  a test of [ruby-dev:36698].

Tue Oct 14 11:14:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* transcode.c (str_transcode0): should not raise error when
	  default_internal is not set.  [ruby-core:19309]

Tue Oct 14 11:14:26 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/net/pop.rb: check for invalid APOP timestamp. (CVE-2007-1558)
	  [ruby-dev:36631]

	* test/net/pop/test_pop.rb: ditto.

Tue Oct 14 09:39:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (set_internal_encoding_once): check double contradicted
	  specification of the encoding from command line.

	* ruby.c (set_external_encoding_once): ditto.

Tue Oct 14 08:28:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): allow reserved word to be keyword argument.

Mon Oct 13 19:07:52 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (token_info_pop): show source filename. [ruby-dev:36710]

Mon Oct 13 08:59:08 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (load_conv_function51932): support
	  CP51932 on cygwin and mingw32. thanks to arton.

	* test/win32ole/test_win32ole.rb (test_cp51932): ditto.

Mon Oct 13 07:54:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (proc_options): add -U command line option to specify
	  utf-8 as default_internal.

Mon Oct 13 07:42:57 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* transcode.c (str_transcode0): String#encode() with no encoding
	  specified transcode the string into Encoding.default_internal.
	  inspired by [ruby-core:19298].

Sun Oct 12 18:00:18 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (set_ole_codepage, ole_cp2encoding,
	  ole_wc2mb, ole_vstr2wc, ole_mb2wc): support CP51932 (only mswin32).

	* test/win32ole/test_win32ole.rb: ditto.

Sun Oct 12 12:03:38 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_insnhelper.h (ruby_vm_redefined_flag): apply optimization
	  patch proposed by Paul Brannan.  [ruby-core:19171]

Sun Oct 12 09:46:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* strftime.c (rb_strftime): suppressed warnings on cygwin.

Sat Oct 11 19:49:35 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_prepare): use utf-8 encoding directly.

Sat Oct 11 10:20:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (CLEANINGS): uses escaped form tabs to preventing the
	  confusion.  [ruby-talk:317345]

Sat Oct 11 08:51:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake.rb (Rake::Application#standard_exception_handling): removed
	  unnecessary SystemExit, and exits with false instead of system
	  dependent value.  [ruby-talk:317330]

Sat Oct 11 03:54:05 2008  Koichi Sasada  <ko1@atdot.net>

	* parse.y: optimize 'for' statement when one variable given.

	* benchmark/bm_loop_for.rb: added.

	* benchmark/bm_loop_times.rb: modified.

Sat Oct 11 12:09:05 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv/csv.rb:  Added support for Encoding::default_internal.
	* lib/csv/csv.rb:  Switched to new Hash syntax.

Fri Oct 10 22:16:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (comment_at_top): needed for ripper too.

Fri Oct 10 22:07:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby.h: updated macros for headers.  [ruby-core:19275]

Fri Oct 10 19:21:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (magic_comment_encoding): warns when ignored.

	* parse.y (parser_magic_comment): replaces '-' with '_'.

	* parse.y (parser_yylex): allows magic comments indented and the
	  second line or later.

Fri Oct 10 17:26:50 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/ext/parser/parser.c (JSON_parse_string):
	  associate encoding.

Fri Oct 10 10:18:21 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/test/*: reverted back to test/unit.
	* test/test/*: ditto
	* lib/minitest/*: Imported minitest 1.3.0 r4333.

Fri Oct 10 03:41:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): check if codepoint for %c is valid.
	  [ruby-dev:36691]

Fri Oct 10 01:55:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_names): minor improvement.

Fri Oct 10 00:21:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (ParseError.filter_backtrace): removes internal
	  backtrace.

Fri Oct 10 00:11:16 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* transcode.c (rb_econv_add_converter): remove unnecessary NULL check.

Thu Oct  9 23:53:23 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el (ruby-style-c-mode): buffer may not have file
	  name.

Thu Oct  9 23:30:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* process.c (run_exec_dup2): fix resource leak.

Thu Oct  9 23:19:02 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* process.c (rb_run_exec_options): fix resource leak.

Thu Oct  9 22:13:58 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_module.rb (test_remove_class_variable): add a test
	  for Class#remove_class_variable.

	* test/ruby/test_object.rb (test_remove_instance_variable): add a test
	  for Object#remove_instance_variable.

Thu Oct  9 22:04:38 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (rb_mod_remove_cvar): fix r19711.

Thu Oct  9 21:17:50 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/syck/syck.c (syck_lookup_sym): remove reading uninitialized
	  variable.

Thu Oct  9 16:34:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/ext/generator/extconf.rb: fix target.

	* ext/json/ext/parser/extconf.rb: ditto.

Thu Oct  9 14:37:59 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* include/ruby/ruby.h: embeds the elements of an array into its
	  struct RArray for # of elements <= 3.

	* array.c: ditto.

	* gc.c (gc_mark_children): following the change of struct RArray.

	* ext/tk/tcltklib.c (ip_ruby_cmp): ditto.

	* parse.y (coverage): ditto.

	* proc.c (curry): ditto.

	* .gdbinit: ditto.

Thu Oct  9 11:29:33 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (Init_Encoding): new instance method Encoding#names,
	  returns its name and alias names.

	* encoding.c (enc_names): defined for Encoding#names.

	* encoding.c (enc_names_i): defined for enc_names.

Thu Oct  9 08:47:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (rb_thread_wait_fd_rw): should not block by select if
	  there's only one thread living.  fixed [ruby-dev:36646].

Wed Oct  8 20:59:52 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_init_cp): initialize WIN32OLE.codepage
	  according to Encoding.default_internal and
	  Encoding.default_external.

Wed Oct  8 17:02:21 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/pure/generator.rb (utf8_to_json):
	  process each unpacked Unicode character.

Wed Oct  8 15:00:22 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/pure/parser.rb
	  (JSON::Pure::Parser#parse_string): force_encoding("UTF-8").

Wed Oct  8 11:56:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit/assertions.rb: assert_nothing_thrown,
	  assert_raise, assert_not_equal, assert_no_match, assert_not_nil,
	  assert_not_same are coming back as alias.

Wed Oct  8 11:18:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (autoload_delete, autoload_file): should not delete
	  autoload table, since it may be shared with duplicated modules.
	  [ruby-core:19181]

Wed Oct  8 02:38:28 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_default_internal_encoding): merged a patch from
	  Michael Selig <michael.selig at fs.com.au> in [ruby-core:18985].

	* io.c (rb_io_ext_int_to_encs): ditto.

	* ruby.c (proc_options): support default internal encoding in -E
	  option.

Wed Oct  8 00:03:39 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (today,now): should produce own instances.
	  [ruby-talk:317020]

Tue Oct  7 16:43:51 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/pure/generator.rb (utf8_to_json):
	  force_encoding before gsub.

Tue Oct  7 16:35:41 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/pure/generator.rb (utf8_to_json):
	  downcase the result of Unicode escape.

Mon Oct  6 16:44:52 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (CGI::QueryExtension::initialize_query): fix the
	  condition.

	* test/cgi/test_cgi_core.rb: bug fix encoding.
	  thanks to TAKANO Mitsuhiro <takano32 at jus.or.jp> .

	* test/cgi/test_cgi_multipart.rb: temporary comment in.

Mon Oct  6 15:22:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (gc_mark_children): ignores T_ZOMBIE.

Mon Oct  6 12:45:20 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_module.rb (TestModule#_wrap_assertion): add
	  definition.  is this really needed?

	* test/ruby/test_module.rb (TestModule#test_mod_constants): should
	  not depend on global Module constants.

Mon Oct  6 12:38:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Assertions#assert_nothing_raised):
	  should take optional message argument.

Mon Oct  6 12:18:23 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_comparable): string comparison should be
	  transitive.  [ruby-dev:36484]

	* test/ruby/test_m17n_comb.rb (TestM17NComb#test_str_eq): test
	  updated.

Mon Oct  6 09:00:58 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/bigdecimal/test_bigdecimal.rb (test_sqrt_bigdecimal): test
	  updated.  a patch from TAKANO Mitsuhiro <takano32 at jus.or.jp>
	  in [ruby-dev:36669].

Sun Oct  5 23:34:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb ($config_h): now always defines for old libraries.

Sun Oct  5 23:06:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_mod_modfunc): method undefined in included module
	  may not have nd_body.  [ruby-core:18738]

Sun Oct  5 21:28:58 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/rational.rb: resolved conflicts of aliases.

	* lib/mathn.rb: avoided some warnings.

Sun Oct  5 18:51:50 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb: remove debug code introduced by previous change.

Sun Oct  5 17:49:35 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/open-uri.rb (OpenURI.open_uri): set encoding to strio.

Sun Oct  5 17:39:21 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_set_encoding): defined for
	  StringIO#set_encoding.

Sun Oct  5 11:24:42 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* eval.c: come back definition of environ.

Sun Oct  5 09:19:49 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/utf8tbl.c: update table.

Sat Oct  4 22:50:14 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* dln.c: Ruby no longer supports VMS.

	* error.c: ditto.

	* eval.c: ditto.

	* eval_intern.h: ditto.

	* include/ruby/defines.h: ditto.

	* include/ruby/ruby.h: ditto.

	* io.c: ditto.

	* process.c: ditto.

	* ruby.c: ditto.

	* vms/config.h: removed.

	* vms/vms.h: ditto.

	* vms/vmsruby_private.c: ditto.

	* vms/vmsruby_private.h: ditto.

Sat Oct  4 22:44:23 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* dln.c: Ruby no longer supports Windows CE.

	* eval.c: ditto.

	* include/ruby/defines.h: ditto.

	* include/ruby/win32.h: ditto.

	* ruby.c: ditto.

	* strftime.c: ditto.

	* win32/Makefile.sub: ditto.

	* win32/win32.c: ditto.

	* ext/tk/extconf.rb: ditto.

	* lib/fileutils.rb: ditto.

	* test/fileutils/test_fileutils.rb: ditto.

	* wince/*: removed.

Sat Oct  4 22:35:06 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* dln.c: Ruby no longer supports MacOS 9 or before.

	* eval.c: ditto.

	* eval_intern.h: ditto.

	* ext/extmk.rb: ditto.

	* ext/tk/sample/tkextlib/treectrl/demo.rb: ditto.

	* ext/tk/stubs.c: ditto.

	* file.c: ditto.

	* hash.c: ditto.

	* include/ruby/defines.h: ditto.

	* ruby.c: ditto.

	* signal.c: ditto.

	* vm_core.h: ditto.

Sat Oct  4 22:30:28 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* dln.c: Ruby no longer supports MS-DOS.

	* ext/sdbm/_sdbm.c: ditto.

	* ext/sdbm/sdbm.h: ditto.

	* gc.c: ditto.

	* hash.c: ditto.

	* include/ruby/defines.h: ditto.

	* include/ruby/util.h: ditto.

	* io.c: ditto.

	* process.c: ditto.

	* ruby.c: ditto.

	* strftime.c: ditto.

	* util.c: ditto.

Sat Oct  4 22:14:15 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* djgpp/GNUmakefile.in: removed. Ruby no longer supports djgpp.

	* djgpp/README.djgpp: ditto.

	* djgpp/config.hin: ditto.

	* djgpp/config.sed: ditto.

	* djgpp/configure.bat: ditto.

	* djgpp/mkver.sed: ditto.

	* ext/Setup.dj: ditto.

	* dln.c: removed djgpp supports.

	* file.c: ditto.

	* gc.c: ditto.

	* io.c: ditto.

	* process.c: ditto.

	* ruby.c: ditto.

	* signal.c: ditto.

	* util.c: ditto.

	* vm_core.h: ditto.

	* lib/fileutils.rb: ditto.

	* lib/mkmf.rb: ditto.

	* ext/socket/socket.c: ditto.

	* test/fileutils/test_fileutils.rb: ditto.

	* test/ruby/test_env.rb: ditto.

	* test/ruby/test_path.rb: ditto.

Sat Oct  4 21:59:39 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* x68/_dtos18.c: removed. Ruby no longer supports human68k.

	* x68/_round.c: ditto.

	* x68/fconvert.c: ditto.

	* x68/select.c: ditto.

	* ext/Setup.x68: ditto.

	* missing/x68.c: ditto.

	* dln.c (dln_find_exe_r): removed human68k supports.
	  (dln_find_1): ditto.

	* lib/mkmf.rb: ditto.

	* ext/extmk.rb (Init_ext): ditto.

	* ext/socket/socket.c (init_sock): ditto.

	* gc.c (GC_MALLOC_LIMIT): ditto.
	  (rb_setjmp, rb_jmpbuf): ditto.
	  (mark_current_machine_context): ditto.

	* include/ruby/defines.h (PATH_ENV): ditto.

	* io.c: ditto.

	* process.c: ditto.

	* ruby.c: ditto.

	* test/ruby/test_env.rb: ditto.

	* test/ruby/test_path.rb: ditto.

	* LEGAL

Sat Oct  4 19:02:36 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: no need to require the "lib/rational.rb".

Sat Oct  4 19:02:59 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf.c (rb_nkf_enc_get): don't replicate encoding.
	  [ruby-dev:36575]

Sat Oct  4 18:47:22 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_external_encoding): defined.

	* ext/stringio/stringio.c (strio_internal_encoding): defined.

	* ext/stringio/stringio.c (Init_stringio): define above.

Sat Oct  4 15:52:17 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/mini/test_mini_test.rb: recovered.
	  It had been temporarily removed at r19645.

	* test/mini/test_mini_mock.rb: ditto.

	* test/mini/test_mini_spec.rb: ditto.

	* lib/test/**/*: replaced by miniunit.
	  miniunit had been temporarily reverted at r19643 but
	  now recovered.

Sat Oct  4 15:33:26 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (gdb-ruby): new target. it runs ruby under controlled by
	  gdb.

	* common.mk (dist): accepts RELNAME variable as the second argument of
	  make-snapshot.rb.

Sat Oct  4 12:17:46 2008  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/irb/ext/save-history.rb: change load_history using File.expand_path. see [ruby-dev:36660]. Thanks Kouhei Sutou.
	* lib/irb/irb/context.rb: convert string Symbol of instance variable names in IRB:Context#inspect.

Fri Oct  3 22:43:04 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/dl/extconf.rb ($distcleanfiles): added callback-?.c into
	  the distclean list.

Fri Oct  3 19:33:21 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/pure.rb (module JSON): remove Iconv dependency.

	* ext/json/lib/json/pure/generator.rb (utf8_to_json): process as
	  binary and remove Iconv dependency.

	* ext/json/lib/json/pure/parser.rb (parse_string): ditto.

Fri Oct  3 14:04:05 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{configure.bat,setup.mak,Makefile.sub): add --program-prefix
	  configure option support.

Thu Oct  2 21:22:43 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (CGI::QueryExtension): delete MorphingBody
	  and replace like as 1.8's in multipart reading.
	  see [ruby-dev:36443],
	  reference from CGIAlt http://cgialt.rubyforge.org/

	* test/cgi/test_cgi_multipart.rb : fixed multipart test.

Thu Oct  2 20:46:17 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_sub_bang): fix coderange.

Wed Oct  1 22:54:09 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rexml/parsers/lightparser.rb, lib/debug.rb: remove unused when
	  clauses.

Wed Oct  1 22:43:59 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/xmlrpc, lib/rexml, test/ruby/test_array.rb,
	  test/ruby/test_unicode_escape.rb, test/scanf/test_scanf.rb,
	  test/rss/rss-assertions.rb: fix indentation to remove warning.

Wed Oct  1 21:36:35 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_gc_call_finalizer_at_exit): finalize deferred IO and Data.

	* gc.c (rb_gc_call_finalizer_at_exit): defers IO finalization.
	  [ruby-dev:36646]

Wed Oct  1 19:11:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (marshal_dump): fixed for check_dump_arg.

	* marshal.c (marshal_dump): initializes dump_arg before any funcall.
	  [ruby-dev:36648]

Wed Oct  1 00:54:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_split_m): should use rb_str_subseq() which use
	  offset and length by bytes.  [ruby-dev:36641]

Wed Oct  1 00:29:48 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_settracefunc.rb (test_call, test_class): line number
	  was changed at r19592.

Wed Oct  1 00:20:38 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (check_exec_redirect): don't depend on rb_stdout and
	  rb_stderr.

Tue Sep 30 23:06:58 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/mini/test_mini_test.rb: removed.
	  Temporarily removed the tests for miniunit because of
	  they depend on the miniunit version of test/unit,
	  where test/unit was temporarily reverted to the state
	  before importing miniunit.

	* test/mini/test_mini_mock.rb: ditto.

	* test/mini/test_mini_spec.rb: ditto.

Tue Sep 30 23:04:30 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/test/**/*: recovered.
	  Temporarily reverts the changes of lib/test/unit/* in
	  r19502 and r19501, in order to release 1.9.0-5.

Tue Sep 30 23:00:05 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/test/unit.rb: removed.
	  Temporarily reverts the changes of lib/test/unit/* in
	  r19543, r19534 and r19503, in order to release 1.9.0-5.

	* lib/test/unit/assertions.rb: ditto.

	* lib/test/unit/deprecate.rb: ditto.

	* lib/test/unit/error.rb: ditto.

	* lib/test/unit/testcase.rb: ditto.

Tue Sep 30 20:17:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_extract_modeenc): should honor value of the
	  textmode: and binmode: options.

Tue Sep 30 17:04:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/bigdecimal/test_bigdecimal.rb (test_sqrt_bigdecimal): wrong
	  precision specification.  a patch from TAKANO Mitsuhiro
	  <takano32 at jus.or.jp> in [ruby-dev:36634].

Tue Sep 30 16:53:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): returns non zero.  [ruby-dev:36633]

Tue Sep 30 16:52:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): add %<name>s style named argument
	  support.  a patch from Yusuke Endoh <mame at tsg.ne.jp>
	  in [ruby-dev:35851].

	* sprintf.c (rb_str_format): add gettext style named format
	  (%{name}) support.  inspired by [ruby-dev:35852].

	* sprintf.c (GETNAMEARG): should raise KeyError exception when no
	  named argument found.

	* hash.c (rb_hash_fetch): export fetch function.

Tue Sep 30 13:19:01 2008  Eric Hodel  <drbrain@segment7.net>

	* test/rubygems/test_gem_installer.rb: remove extra call to setup to
	  fix ENV['HOME'] pollution.

Tue Sep 30 13:04:11 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/mini/test.rb: Updated to 1.3.0 r4257.
	* test/mini/*: added from r4257.

Tue Sep 30 07:46:07 2008  Eric Hodel  <drbrain@segment7.net>

	* test/rdoc/test_rdoc_markup_attribute_manager.rb: Test with clean
	  SPECIALS.
	* test/rubygems/gemutilities.rb: Restore ENV['HOME'] after test.
	* test/runner.rb: Pass -n argument down to miniunit.

Tue Sep 30 01:02:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (token_info_push, token_info_pop): do nothing for evaled
	  source.

Tue Sep 30 00:47:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: constified.

Mon Sep 29 23:32:25 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_subseq): don't use rb_str_drop_bytes for short
	  string.

Mon Sep 29 22:54:29 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/mathn.rb: added String#to_[rc].  moved def_canon.

Mon Sep 29 20:41:19 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_subseq): use rb_str_drop_bytes if possible.

Mon Sep 29 20:22:20 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: imported additional tests and some adjustments.

Mon Sep 29 20:13:05 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (fev_initialize): initialization
	  handler instance variable.

	* test/win32ole/test_win32ole_typelib.rb (test_s_typelibs):
	  fix the warning of shadowing outer local variable.

Mon Sep 29 19:59:00 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (rescue_callback): use rb_write_error
	  instead of fprintf.

Mon Sep 29 01:51:54 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/rdoc/test_rdoc_info_formatting.rb (teardown): delete tmpdir for
	  test.

Mon Sep 29 00:30:20 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/html.rb (CGI::HtmlExtension::{radio_group, checkbox_group}):
	  can specify the false as checked or selected value.
	  [ruby-core:18306], [ruby-core:18307]

	* test/cgi/test_cgi_tag_helper.rb: add a test.

Sun Sep 28 23:08:38 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/html.rb (CGI::HtmlExtension::popup_menu):
	  fix the calls #bytesize on array parameters. [ruby-core:18919]

Sun Sep 28 22:44:26 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (CGI::parse): ignore illegal query params.
	  [ruby-dev:36618]

Sun Sep 28 22:05:07 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_set_sequence): check duplicated when clause.
	  [ruby-dev:36616]

Sun Sep 28 19:04:03 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: imported a date test suite ruby 1.9 limited ed.

Sun Sep 28 18:40:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mini/test.rb (MINI_DIR): loaded path is expanded.

	* lib/mini/test.rb (assert_match): get rid of confusion of
	  ruby-mode.el.

Sun Sep 28 12:36:09 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_exec.c (vm_exec_core): add an UNLIKELY() hint.

	* vm_insnhelper.h (BASIC_OP_UNREDEFINED_P): add a LIKELY() hint.

Sun Sep 28 12:04:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_new): sets empty string to coderange 7bit.
	  [ruby-core:18993]

Sun Sep 28 09:39:48 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/mathn.rb ({Fixnum,Bignum,Float}#**): may produce complex
	  value.

Sun Sep 28 09:05:53 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv/csv.rb:  Worked around some minor encoding changes in Ruby
	  pointed out by Nobu.

Sun Sep 28 08:37:12 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/mathn.rb: a hack to provide canonicalization.  This must be
	  temporary, but this seems to be not bad for the time being.

Sat Sep 27 06:22:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake.rb (Module#rake_extension, String#ext, String#pathmap): use
	  built-in methods.

	* lib/rake.rb (String#pathmap): fixed typo in rdoc.

Sat Sep 27 04:28:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rmext): preceding dots are not a part of extension.

	* file.c (rb_file_s_extname): ditto.

Sat Sep 27 03:15:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_jump_tag_but_local_jump): exc is not used if val is nil.

Sat Sep 27 03:12:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (host_str): numeric address should be unsigned.
	  [ruby-core:18971]

Fri Sep 26 22:46:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (primary, brace_block): fix for line number.

	* proc.c (rb_proc_location, rb_method_location): new methods
	  {Proc,Method,UnboundMethod}#source_location.  [ruby-core:18452]

Fri Sep 26 21:36:33 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h (RUBY_VM_CHECK_INTS_TH): add an UNLIKELY hint.

Fri Sep 26 19:33:36 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_str_encode): renamed from
	  rb_str_transcode.  [ruby-dev:36593]
	  (rb_econv_has_convpath_p): renamed from rb_transcode_convertible.

	* transcode.c: follow the renaming.

	* io.c: ditto.

Fri Sep 26 19:01:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/bigdecimal/test_bigdecimal.rb (test_inspect): fixed CPU bit
	  size dependent test.  pointed out by TAKANO Mitsuhiro <takano32 AT
	  jus.or.jp>.

Fri Sep 26 18:57:33 2008  Akinori MUSHA  <knu@iDaemons.org>

	* test/pathname/test_pathname.rb: Fix use of deprecated methods.

Fri Sep 26 18:39:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (dist): nothing is needed to run BASERUBY.

	* tool/make-snapshot: new option -archname.

Fri Sep 26 18:24:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el: safe customizable variables.

Fri Sep 26 17:37:18 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* include/ruby/ruby.h (rb_mPrecision): removed.
	  Precision module was temporarily removed at r19430.

Fri Sep 26 17:25:10 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (dist): Changed its dependencies and action.

Fri Sep 26 17:07:04 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* error.c (Init_syserr): moved to the template.
	  (errno_missing): removed. fixed [ruby-dev:35958].

	* defs/known_errors.def: added. extracted from Init_syserr.

	* templates/known_errors.inc.tmpl: added. Template for Init_syserr.
	  c.f. [ruby-dev:35958].

	* tools/generic_erb.rb: added. general purpose mapper which maps
	  data+template into source code.

	* common.mk (error.$(OBJEXT), incs, known_errors.inc):
	  Fixed dependencies.

Fri Sep 26 17:02:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thlist_signal): clears the woken thread if nothing woke.

	* thread.c (rb_barrier_wait): achieves the lock if no thread was
	  waiting yet.

Fri Sep 26 12:04:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/curses.c: should include <ruby/io.h>.

	* ext/io/wait/wait.c: ditto.

	* ext/openssl/ossl.h: ditto.

Fri Sep 26 11:34:08 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* variable.c (rb_define_hooked_variable): cast to get rid of compiler
	  warnings.

Fri Sep 26 11:05:41 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* transcode.c, include/ruby/encoding.c (rb_transcode_convertible):
	  new function. checking the existence of converter.

Fri Sep 26 10:35:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (global_variable, struct trace_var): made function
	  members more strict.

Fri Sep 26 09:55:06 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby{io,sig}.h: moved to include/ruby/backward.

Fri Sep 26 09:47:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/rubysig.h: old macros for backward compatibility.

	* thread.c (BLOCKING_REGION): rewritten using helper functions.

Fri Sep 26 03:03:32 2008  Tanaka Akira  <akr@fsij.org>

	* vm_eval.c (Init_vm_eval): define module_eval, class_eval and eval
	  here for rdoc.

Fri Sep 26 00:40:30 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* range.c (range_inspect): fix SEGV for cyclic range object.
	  [ruby-core:18835]

Thu Sep 25 23:59:56 2008  Tanaka Akira  <akr@fsij.org>

	* common.mk: dependency updated.

Thu Sep 25 21:46:48 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_eUndefinedConversionError): renamed from
	  rb_eConversionUndefinedError.
	  (rb_eConverterNotFoundError): renamed from rb_eNoConverterError.

Thu Sep 25 21:23:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* pack.c (pack_pack, pack_unpack): 'm0' format (base64) complies with
	  RFC 4648.  It adds no line feed when encoding, and raise ArgumentError
	  if the encoded string contains non-alphabet (including CR and LF).

	* lib/base64.rb: added.  This provides encoding/decoding method for
	  Base64 in standard RFC 2045, Base64 in standard RFC 4648 and ``Base 64
	  Encoding with URL and Filename SafeAlphabet'' in RFC 4648.

	* test_pack.c, test/base64/test_base64.rb: add tests for above.

Thu Sep 25 21:00:32 2008  Koichi Sasada  <ko1@atdot.net>

	* common.mk: fix btest-* rules [ruby-dev:36528].
	  and remove obsolete rules.

Thu Sep 25 20:27:54 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* class.c (rb_make_metaclass): [BUG] Fixed a bus error
	  on the case for metaclass of a class which includes a
	  module.

Thu Sep 25 19:34:33 2008  Eric Hodel  <drbrain@segment7.net>

	* test/rubygems/*: Update some new tests to use build_rake_in.
	* test/rubygems/gemutilities.rb: Fix broken merge of rake detection.

Thu Sep 25 19:13:12 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*: Update to RubyGems 1.3.0 r1891.

Thu Sep 25 18:40:42 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* class.c (rb_make_metaclass): Made class of class of class
	  from Class into its own eigenclass. Now meta^(n)-class
	  hierarchy regresses infinitely, again.
	  (This feature was decided on developer-meeting-20080922.)

Thu Sep 25 16:01:07 2008  Jim Weirich  <jim@tardis.local>

	* lib/rake.rb: Update rake source to version 0.8.3.  This
	  version includes some fixes for running Rake on windows.
	  (1) better APPDATA/HOMExxx/USERPROFILE integration for
	  system rakefiles, (2) Better handling of the :ruby command
	  when installed in directory containing spaces.

Thu Sep 25 11:22:51 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc*: Update to RDoc 2.2.1 r185.

Thu Sep 25 02:08:47 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_mode_enc): make it static.

Thu Sep 25 01:22:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mini/test.rb (Mini::Assertions#assert_raise): fixed typo.

Wed Sep 24 23:39:00 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* test/cgi/test_cgi_multipart.rb : revert last change.
	  ( deprecated is assert_raises. )
	* test/cgi/test_cgi_core.rb      : ditto.
	* test/cgi/test_cgi_header.rb    : ditto.

Wed Sep 24 23:12:49 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (CGI::new, CGI::{accept_charset,accept_charset=}) :
	  accept parameters either in a hash,
	  string as a block. add the encoding validation process.
	* test/cgi/test_cgi_core.rb : test for query encoding check.

Wed Sep 24 22:58:18 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* string.c (rb_str_rstrip_bang): raise exception when the encoding of
	  the string is dummy.

	* string.c (rb_str_rstrip_bang): remove nul characters even if the
	  encoding of the string is not single byte optimizable.
	  fixed [ruby-core:18844], reported by Michael Selig.

Wed Sep 24 19:01:45 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* string.c (rb_str_rstrip_bang): workaround for VC++8 x64.

Wed Sep 24 17:44:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c (Init_Complex), rational.c (Init_Rational): undefines
	  default #allocate methods which call the allocator.

Wed Sep 24 17:02:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c (Init_Complex), rational.c (Init_Rational): ID_ALLOCATOR
	  differs from :allocate, and invisible in ruby level.

Wed Sep 24 15:58:52 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_rstrip_bang): removing mixed spaces and nuls at
	  the end of strings.  [ruby-dev:36497]

Wed Sep 24 15:13:04 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* test/cgi/test_cgi_multipart.rb : test for miniunit.
	* test/cgi/test_cgi_core.rb      : ditto.
	* test/cgi/test_cgi_header.rb    : ditto.

Wed Sep 24 14:38:29 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/tmpdir.rb: setup buffer with nul characters instead of spaces.
	  fixed [ruby-dev:36493]

Wed Sep 24 11:18:33 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_s_binread): offset argument was wrongly passed to
	  internal IO#read call.  [ruby-core:18810]

Wed Sep 24 07:38:23 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm_core.h: ruby/ruby.h should be included at the very first
	  place in an entire compilation unit, as it includes
	  ruby/config.h

Wed Sep 24 06:41:24 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/test/*: removed test/unit.
	* lib/test/*: added miniunit.
	* lib/mini/*: ditto.

Wed Sep 24 04:45:35 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/node.h, node.h: move node.h from include path.
	  This change stop to install node.h because of saving ABI
	  (node.h will be changed. Extensions should not depends on
	   this file).

	* blockinlining.c, class.c, compile.c, debug.h, enum.c,
	  gc.c, iseq.c, parse.y, ruby.c, signal.c, variable.c,
	  vm.c, vm_core.h, vm_dump.c: ditto.

	* ext/ripper/depend: ditto.

Wed Sep 24 04:09:13 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h: remove unused frame values.

Wed Sep 24 04:07:07 2008  Koichi Sasada  <ko1@atdot.net>

	* signal.c (signal_exec): execute rb_eval_cmd() directly.

Wed Sep 24 03:08:58 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/uri/mailto.rb: fix indentation.
	* lib/uri/generic.rb: ditto.
	* lib/yaml.rb: ditto.
	* lib/uri/cgi/core.rb: fix indentation and ambiguous argument warning.

Tue Sep 23 23:39:25 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv/csv.rb:  Improved the idea of whitespace and word characters used
	  in substitutions during header conversion as suggested by Michael Selig.

Tue Sep 23 21:50:53 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_binwrite): allocate wbuf if nosync.

Tue Sep 23 21:45:02 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_body): use io_binwrite instead of io_fwrite.

Tue Sep 23 21:31:16 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_rational2.rb: updated.

	* test/ruby/test_complex2.rb: added.

	* test/ruby/test_complexrational.rb: added.

Tue Sep 23 21:26:32 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_casecmp): make the ordering consistent with
	  String#<=>.

Tue Sep 23 20:52:25 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_binwrite): add nosync argument.
	  (do_writeconv): extracted from io_fwrite.
	  (io_fwrite): add nosync argument.  use do_writeconv.
	  (io_write): add nosync argument.
	  (io_write_m): new function for IO#write.
	  (rb_p): don't append record separator.

Tue Sep 23 20:24:41 2008  Koichi Sasada  <ko1@atdot.net>

	* signal.c (signal_exec): fix to use rb_proc_call().

Tue Sep 23 20:06:46 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/formatters/pretty.rb (REXML::Formatters::Pretty#wrap):
	  abandon wrapping if the line contains no space.  [ruby-dev:36045]

Tue Sep 23 19:38:03 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (subtract): check tv_sec. reported by ko1.

Tue Sep 23 19:21:03 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_s_canonicalize_internal): does no apply
	  canonicalization rule anymore.

	* rational.c (nurat_s_canonicalize_internal(_no_reduce)?): ditto.

	* complex.c: removed class method new! and new.

	* rational.c: ditto.

Tue Sep 23 19:20:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_s_binread): a new method to read binary chunk from a
	  file.  [ruby-core:18674]

	* io.c (open_key_args): wrong permission specified for read-open.

Tue Sep 23 18:24:34 2008  Tanaka Akira  <akr@fsij.org>

	* hash.c (rb_obj_is_proc): declaration moved for rdoc.

Tue Sep 23 18:07:55 2008  Koichi Sasada  <ko1@atdot.net>

	* common.mk (io.o): remove dependency for vm_core.h.

Tue Sep 23 17:56:44 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_blocking_region): fix typo in a document.

Tue Sep 23 17:50:35 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_blocking_region): write a document.

Tue Sep 23 17:14:31 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c, include/ruby/intern.h (rb_thread_interrupted): added.

	* io.c: use VALUE of thead instead of rb_tread_t to check interrupts.

Tue Sep 23 17:05:14 2008  Koichi Sasada  <ko1@atdot.net>

	* class.c, vm_core.h: move decl of rb_iseq_clone() to class.c.

Tue Sep 23 17:02:47 2008  Tanaka Akira  <akr@fsij.org>

	* debug.h (ruby_set_debug_option): declared.

	* main.c: include debug.h.

	* common.mk (main.$(OBJEXT)): dependency updated.

Tue Sep 23 16:59:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (ENVMATCH, ENVNMATCH): reduced same code.

Tue Sep 23 16:55:11 2008  Koichi Sasada  <ko1@atdot.net>

	* ruby.h: fix comment and rename macro HAVE_RUBY_MVM_H to
	  HAVE_RUBY_VM_H.

Tue Sep 23 16:41:31 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/node.h, vm_core.h: move definition of
	  RUBY_VM_METHOD_NODE to node.h.

	* class.c, common.mk: remove useless inclusion.

	* compile.h, iseq.h, vm_core.h: rename compile.h to iseq.h.
	  move some definitions from vm_core.h to iseq.h.

	* compile.c, iseq.c, vm.c: ditto.

	* eval.c, compile.c: move some functions for parser
	  from eval.c to compile.c.

	* eval_intern.h, vm_core.h: move va_init_list() macro to
	  vm_core.h.

	* iseq.c (rb_iseq_new_top, rb_iseq_first_lineno): added.

	* load.c, ruby.c: use rb_iseq_new_top() instead of
	  rb_iseq_new() with ISEQ_TYPE_TOP constant directly.

	* proc.c: use rb_iseq_first_lineno() instead of accessing
	  iseq structure.

Tue Sep 23 16:17:54 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/ripper/eventids2.c (token_to_eventid): supper __ENCODING__
	  keyword.  [ruby-dev:36478]

Tue Sep 23 15:30:53 2008  Koichi Sasada  <ko1@atdot.net>

	* common.mk, hash.c: remove unused inclusion.

Tue Sep 23 09:52:07 2008  Koichi Sasada  <ko1@atdot.net>

	* eval_safe.c, safe.c: rename eval_safe.c to safe.c.

	* common.mk, eval.c, safe.c, inits.c: separate safe.c from eval.c and
	  make Init_safe().

Tue Sep 23 09:20:00 2008  Koichi Sasada  <ko1@atdot.net>

	* common.mk: clean up
	  - remove blockinlining.$(OBJEXT) to built
	  - make ENCODING_H_INCLDUES variable (include/ruby/encoding.h)
	  - make VM_CORE_H_INCLUDES variable (vm_core.h)
	  - simplify rules.
	  - make depends rule to output depend status using gcc -MM.

	* include/ruby/mvm.h, include/ruby/vm.h: rename mvm.h to vm.h.

	* include/ruby.h: ditto.

	* load.c: add inclusion explicitly.

	* enumerator.c, object.c, parse.y, thread.c, vm_dump.c:
	  remove useless inclusion.

	* eval_intern.h: cleanup inclusion.

	* vm_core.h: rb_thread_t should be defined in this file.

	* vm_evalbody.c, vm_exec.c: rename vm_evalbody.c to vm_exec.c.

	* vm.h, vm_exec.h: rename vm.h to vm_exec.h.

	* insnhelper.h, vm_insnhelper.h: rename insnhelper.h to vm_insnhelper.h.

	* vm.c, vm_insnhelper.c, vm_insnhelper.h:
	  - rename vm_eval() to vm_exec_core().
	  - rename vm_eval_body() to vm_exec().
	  - cleanup include order.

	* vm_method.c: fix comment.

Tue Sep 23 09:01:15 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/pathname.rb (each_filename): return Enumerator if no block
	  given.

	* test/pathname/test_pathname.rb: add a test for above.

Tue Sep 23 08:25:56 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (env_aset): allow nil value to remove an entry.
	  [ruby-dev:36465]

	* test/ruby/test_env.rb (TestEnv#test_aset): test updated.

Tue Sep 23 08:07:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-keyword-end-re): emacs21 support.  a
	  patch from Hiroshi Moriyama <hiroshi at kvd.biglobe.ne.jp> in
	  [ruby-dev:36471].

	* misc/ruby-mode.el (ruby-in-ppss-context-p): ditto.

	* misc/ruby-mode.el (ruby-here-doc-end-syntax):

Tue Sep 23 02:07:52 2008  TAKAO Kouji  <kouji@takao7.net>

	* test/readline/test_readline_history.rb
	  (Readline::TestHistory#test_each): checked return value.

Tue Sep 23 02:05:34 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (Init_readline): used remove_history to
	  check offset of history if unsupported clear_history.

Mon Sep 22 17:39:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tempfile.rb (Tempfile#open): should return a value from the
	  block (if given).   [ruby-core:18394]

Mon Sep 22 11:17:51 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* include/ruby/encoding.h (enum): ISO C forbids comma at end of
	  enumerator list

Mon Sep 22 10:15:24 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* LEGAL: updated file names removed and added.  [ruby-dev:36426]

Mon Sep 22 02:39:05 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (get_default_external): add description.

Sun Sep 21 21:52:41 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* math.c (math_log): should check argc.

Sun Sep 21 21:20:24 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: added two macros.

	* rational.c: ditto.

Sun Sep 21 18:06:38 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_s_convert): checks argc.

	* rational.c (nurat_s_convert): ditto.

Sun Sep 21 10:19:04 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_s_canonicalize_internal): checks exactness of
	  imag only.

	* rational.c (nurat_s_convert): accepts non real value
	  (Rational(a,b) as a/b).

	* complex.c (nucomp_s_convert): refined.

Sun Sep 21 09:37:57 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv/csv.rb:  Reworked CSV's parser and generator to be m17n.  Data
	  is now parsed in the Encoding it is in without need for translation.
	* lib/csv/csv.rb:  Improved inspect() messages for better IRb support.
	* lib/csv/csv.rb:  Fixed header writing bug reported by Dov Murik.
	* lib/csv/csv.rb:  Use custom separators in parsing header Strings as
	  suggested by Shmulik Regev.
	* lib/csv/csv.rb:  Added a :write_headers option for outputting headers.
	* lib/csv/csv.rb:  Handle open() calls in binary mode whenever we can to
	  workaround a Windows issue where line-ending translation can cause an
	  off-by-one error in seeking back to a non-zero starting position after
	  auto-discovery for :row_sep as suggested by Robert Battle.
	* lib/csv/csv.rb:  Improved the parser to fail faster when fed some forms
	  of invalid CSV that can be detected without reading ahead.
	* lib/csv/csv.rb:  Added a :field_size_limit option to control CSV's
	  lookahead and prevent the parser from biting off more data than
	  it can chew.
	* lib/csv/csv.rb:  Added readers for CSV attributes:  col_sep(), row_sep(),
	  quote_char(), field_size_limit(), converters(), unconverted_fields?(),
	  headers(), return_headers?(), write_headers?(), header_converters(),
	  skip_blanks?(), and force_quotes?().
	* lib/csv/csv.rb:  Cleaned up code syntax to be more inline with
	  Ruby 1.9 than 1.8.

Sun Sep 21 07:43:16 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: an instance method image has been removed and
	  uses "imag" instead of "image".

	* complex.c: two instance method re and im are removed.

	* rational.c: follows the above changes.

	* include/ruby/ruby.h: ditto.

	* gc.c: ditto.

	* lib/cmath.rb: ditto.

	* lib/mathn.rb: ditto.

	* lib/complex.rb: ditto. and provides some obsolete methods.

Sun Sep 21 02:48:45 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/ext/parser/parse.c: use ruby_xfree().

	* ext/json/ext/parser/parse.rl: ditto.

	* ext/json/ext/parser/unicode.c: ditto.

Sun Sep 21 02:40:20 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: import JSON v 1.1.3.

Sat Sep 20 11:43:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/optparse.rb (summarize): separator "" should output new line.

Sat Sep 20 08:07:34 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y: strings which contain only US-ASCII don't force to have
	  US-ASCII encoding. [ruby-dev:36400]

Sat Sep 20 07:59:31 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_desc): Regexps of ASCII Compatible encoding may
	  contain non-ASCII characters. So in that case its encoding
	  must keep original encoding.

Sat Sep 20 07:44:56 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: prec.c is removed.

Fri Sep 19 22:37:25 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: uses f_(in)?exact_p macro.

	* rational.c: ditto.

	* bignum.c (rb_big_pow): bignum**bignum - should calculate without
	  rational.

	* lib/complex.rb: should override Math module at most once.

	* lib/mathn.rb: requires 'cmath' directly.

Fri Sep 19 20:48:06 2008  Yuki Sonoda  <yugui@yugui.jp>

	* prec.c: removed. Precision will be redesigned and be back again.
	  c.f. [ruby-dev:36352].

	* common.mk (COMMON_OBJS): removed prec.o.

	* inits.c (rb_call_inits): removed Init_Precision.

	* numeric.c (Init_Numeric): removed inclusion of Precision.
	  removed #induced_from from each class.

	* rational.c: ditto.

	* ext/bigdecimal/bigdecimal.c: ditto.

	* lib/rdoc/known_classes.rb: removed the entry for Precision.

	* test/ruby/test_prec.rb: removed.

	* test/ruby/test_integer.rb: removed tests for Precision.

	* test/ruby/test_fixnum.rb: ditto.

	* test/ruby/test_float.rb: ditto.

	* test/ruby/test_rational.rb: ditto.

	* test/ruby/test_complex.rb: ditto.

	* test/bigdecimal/test_bigdecimal.rb: ditto.

Fri Sep 19 19:43:40 2008  Yuki Sonoda  <yugui@yugui.jp>

	* common.mk : Reverts the changeset 18994.
	  Uses the official repository of rubyspec again.

Fri Sep 19 17:41:56 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: applied OS/2 support patch from Brendan Oakley
	  <gentux2 at gmail.com> in [ruby-core:18707].

Fri Sep 19 09:29:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dln.c: newer BeOS support.  a patch from Pete Goodeve
	  <pete.goodeve at computer.org> in [ruby-core:18712].

Fri Sep 19 03:41:25 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: fix memory violation. mentioned by mame [ruby-dev:36373]

Fri Sep 19 01:07:36 2008  Tanaka Akira  <akr@fsij.org>

	* regexec.c (string_cmp_ic): add text_end argument.
	  (slow_search): call enclen with real string end.
	  (map_search): add text_end argument.

Thu Sep 18 22:54:39 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/openssl/ossl_pkey_ec.c (ossl_ec_key_to_string): comment out
	  fragments of unused code.

Thu Sep 18 22:35:03 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (VpCtoV): 1E1000...000 is interpreted as
	  Infinity.  [ruby-dev:36159]

	* ext/bigdecimal/bigdecimal.c (VpPower): Infinity ** 1 returns
	  Infinity instead of NaN.  [ruby-dev:36159]

	* test/bigdecimal/test_bigdecimal.rb: add tests for above.

Thu Sep 18 22:20:08 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (Init_Exception): introduce EncodingError which is a
	  superclass for all encoding related exception classes,
	  e.g. Encoding::CompatibilityError.  [ruby-dev:36371]

	* transcode.c (Init_transcode): ditto.

Thu Sep 18 21:57:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_comparable): make ascii8bit string to be
	  compatible with any other encoding.

	* string.c (rb_str_cmp): use rb_str_comparable() instead of
	  rb_enc_compatible() since <=> is a comparison anyway.

Thu Sep 18 21:37:14 2008  Tanaka Akira  <akr@fsij.org>

	* grapheme cluster implementation reverted.  [ruby-dev:36375]

Thu Sep 18 20:50:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake.rb (Rake::Application#standard_exception_handling):
	  replaced magic numbers for exit status.

Thu Sep 18 20:37:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::ParseError#set_backtrace): omits
	  OptionParser internal backtraces unless debug flag is set.

Thu Sep 18 20:02:48 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/uri/common.rb (unescape): skip '%' to make String#hex work
	  correctly.

Thu Sep 18 19:51:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (big2str_karatsuba): free internal buffer eagerly.
	  a patch from TOYOFUKU Chikanobu <nobu_toyofuku at nifty.com>
	  in [ruby-dev:36217].

	* bignum.c (rb_big2str0): ditto.

Thu Sep 18 19:43:04 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* st.c (new_size): raise RuntimeError when st_table is too big.
	  [ruby-dev:36354]

Thu Sep 18 18:23:23 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (enc_arg): must take pointer argument to avoid GC
	  problem.  StringValueCStr modifies the argument and it should be
	  preserved while the string StringValueCStr returns is used.
	  Since the string is used by caller, the modified argument should be
	  hold by caller.  Actually
	    GC.stress = true
	    def (o=Object.new).to_str()
	      "universal"+"_newline"
	    end
	    "\u3042".encode(o, "")
	  causes curious warning:
	    rb_define_const: invalid name `' for constant

Thu Sep 18 17:32:44 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* transcode.c: add "Error" suffix for Encoding exception classes.
	  a patch from Tadashi Saito <shiba at mail2.accsnet.ne.jp> in
	  [ruby-dev:36346].

	* encoding.c (Init_Encoding): rename EncodingCompatibilityError to
	  Encoding::CompatibilityError.  [ruby-dev:36366]

Thu Sep 18 17:18:35 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* transcode.c (enc_arg): revert last change.  too early exception
	  raising.

	* transcode.c (enc_arg): need not to take pointer argument.

Sun Sep 18 02:22:15 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/bigdecimal/test_bigdecimal.rb: add tests to achieve over 90%
	  test coverage of bigdecimal.

Wed Sep 17 21:50:14 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_casecmp): don't use rb_enc_codepoint.

Wed Sep 17 19:55:33 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_s_convert): accepts complex
	  value (Complex(a,b) as a+bi).

Wed Sep 17 19:16:47 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_io.rb (TestIO#test_dup): avoid infinite loop.
	  [ruby-dev:36326]

	* test/ruby/test_io.rb (TestIO#test_dup): remove needless open.
	  [ruby-dev:35957]

Wed Sep 17 17:44:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_extract_modeenc): process option mode: and perm: as
	  well.

	* io.c (open_key_args): move mode: and perm: related code to
	  rb_io_extract_modeenc().

Wed Sep 17 13:42:59 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/html.rb (checkbox_group,radio_group): bug fix
	  use size instead of	bytesize.

	* test/cgi/test_cgi_tag_helper.rb: test for checkbox_group,radio_group.

Wed Sep 17 06:58:31 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c: provides predicate real? instead of scalar?.

	* complex.c: follows the above change.

	* lib/cmath.rb: ditto.

Wed Sep 17 01:56:27 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io_m17n.rb: use __FILE__ instead of /dev/null.
	  [ruby-dev:36327]

Wed Sep 17 01:33:11 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h (OnigEncodingTypeST): add precise_ret
	  argument for mbc_to_code.
	  (ONIGENC_MBC_TO_CODE): provide NULL for precise_ret.
	  (ONIGENC_MBC_PRECISE_CODEPOINT): defined.

	* include/ruby/encoding.h (rb_enc_mbc_precise_codepoint): defined.

	* regenc.h (onigenc_single_byte_mbc_to_code): precise_ret argument
	  added.
	  (onigenc_mbn_mbc_to_code): ditto.

	* regenc.c (onigenc_single_byte_mbc_to_code): precise_ret argument
	  added.
	  (onigenc_mbn_mbc_to_code): ditto.

	* string.c (count_utf8_lead_bytes_with_word): removed.
	  (str_utf8_nth): removed.
	  (str_utf8_offset): removed.
	  (str_strlen): UTF-8 codepoint oriented optimization removed.
	  (rb_str_substr): ditto.
	  (enc_succ_char): use rb_enc_mbc_precise_codepoint.
	  (enc_pred_char): ditto.
	  (rb_str_succ): ditto.

	* encoding.c (rb_enc_ascget): check length with
	  rb_enc_mbc_precise_codepoint.
	  (rb_enc_codepoint): use rb_enc_mbc_precise_codepoint.

	* regexec.c (string_cmp_ic): add text_end argument.
	  (match_at): check end of character after exact string matches.

	* enc/utf_8.c (grapheme_table): defined for extended grapheme cluster
	  boundary.
	  (grapheme_cmp): defined.
	  (get_grapheme_properties): defined.
	  (grapheme_boundary_p): defined.
	  (MAX_BYTES_LENGTH): defined.
	  (comb_char_enc_len): defined.
	  (mbc_to_code0): extracted from mbc_to_code.
	  (mbc_to_code): use mbc_to_code0.
	  (left_adjust_combchar_head): defined.
	  (utf_8): use a extended grapheme cluster as a unit.

	* enc/unicode.c (onigenc_unicode_mbc_case_fold): use
	  ONIGENC_MBC_PRECISE_CODEPOINT to extract codepoints.
	  (onigenc_unicode_get_case_fold_codes_by_str): ditto.

	* enc/euc_jp.c (mbc_to_code): follow mbc_to_code field change.
	  use onigenc_mbn_mbc_to_code.

	* enc/shift_jis.c (mbc_to_code): ditto.

	* enc/emacs_mule.c (mbc_to_code): ditto.

	* enc/gbk.c (gbk_mbc_to_code): follow mbc_to_code field and
	  onigenc_mbn_mbc_to_code change.

	* enc/cp949.c (cp949_mbc_to_code): ditto.

	* enc/big5.c (big5_mbc_to_code): ditto.

	* enc/euc_tw.c (euctw_mbc_to_code): ditto.

	* enc/euc_kr.c (euckr_mbc_to_code): ditto.

	* enc/gb18030.c (gb18030_mbc_to_code): ditto.

	* enc/utf_32be.c (utf32be_mbc_to_code): follow mbc_to_code field
	  change.

	* enc/utf_16be.c (utf16be_mbc_to_code): ditto.

	* enc/utf_32le.c (utf32le_mbc_to_code): ditto.

	* enc/utf_16le.c (utf16le_mbc_to_code): ditto.

Wed Sep 17 01:17:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (enc_arg): raise exception when unknown encoding is
	  given.

Tue Sep 16 22:23:24 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (CGI#header): performance improvement.
	  From CGIAlt http://cgialt.rubyforge.org/

	* test/cgi/test_cgi_header.rb: exception class fixed.

Tue Sep 16 22:21:33 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): fix rdoc. (codepoint is integer)

	* string.c (rb_str_each_codepoint): use UINT2NUM.

Tue Sep 16 21:48:55 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_desc): Regexp#inspect should be US-ASCII.

Tue Sep 16 21:33:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_crypt): orthodox crypt() sees only first two bytes
	  of salt.

Tue Sep 16 19:18:40 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_marshal_{dump,load}): preserve instance
	  variables.

	* rational.c (nurat_marshal_{dump,load}): ditto.

Tue Sep 16 18:28:52 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_gets_m): rdoc updated.  limit counts in bytes.
	  [ruby-core:18617]

	* io.c (rb_io_readlines, rb_f_gets): ditto.

	* io.c (rb_io_readbyte): rdoc updated.  [ruby-core:18617]

Tue Sep 16 11:55:16 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_each_codepoint): add new methods, #codepoints
	  and #each_codepoint.  a patch from Michael Selig
	  <michael.selig at fs.com.au> in [ruby-core:18532].

Tue Sep 16 11:24:44 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/mkconstants.rb: add new constants.  a patch from
	  IWAMURO Motonori <deenheart+ruby at gmail.com> in [ruby-dev:36309].

Tue Sep 16 09:20:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#test_dup): exception should be
	  raised from IO#dup.

Tue Sep 16 08:35:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#test_dup): this test might fail if
	  there are any garbage IO objects.

Tue Sep 16 02:02:56 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_buf_cat_ascii): codepoint is unsigned int.

	* string.c (rb_str_concat): ditto.

	* string.c (str_cat_char): ditto.

	* string.c (prefix_escape): ditto.

Tue Sep 16 01:47:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (single_byte_optimizable): make function inline.  based
	  on a patch from Michael Selig <michael.selig at fs.com.au> in
	  [ruby-core:18532].

	* string.c (str_modify_keep_cr): new function act as
	  rb_str_modify(), but don't clear coderange

	* string.c (rb_str_casecmp): specialized for single byte strings.

	* string.c (rb_str_splice): preserve coderange.

	* string.c (rb_str_slice_bang, rb_str_reverse_bang,
	  rb_str_upcase_bang, rb_str_downcase_bang, tr_trans,
	  rb_str_capitalize_bang, rb_str_swapcase_bang,
	  rb_str_delete_bang, rb_str_chop_bang, rb_str_chomp_bang,
	  rb_str_lstrip_bang, rb_str_rstrip_bang): ditto.

	* string.c (rb_str_clear): preset coderange.

	* string.c (rb_str_split_m): specialized for splitting with a
	  string.

Tue Sep 16 00:57:56 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_quote): use rb_enc_mbcput to generate ASCII
	  incompatible characters properly.

Tue Sep 16 00:51:59 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (Encoding#base_encoding): removed. [ruby-dev:36270]

Tue Sep 16 00:40:56 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (STR1_LENGTH): defined.
	  (makeSTR1LEN): defined.

	* tool/transcode-tblgen.rb: use makeSTR1LEN.  generate STR1 for 4 to
	  259 bytes.

	* transcode.c (rb_transcoding): new field: output_index.
	  (transcode_restartable0): use STR1_LENGTH.

Mon Sep 15 23:52:45 2008  Koichi Sasada  <ko1@atdot.net>

	* gc.c, include/ruby/ruby.h: rename rb_register_mark_object()
	  to rb_gc_register_mark_object().

	* eval.c, vm.c: initialize vm->mark_object_ary at
	  Init_top_self().

	* bignum.c, complex.c, encoding.c, ext/win32ole/win32ole.c,
	  io.c, load.c, marshal.c, rational.c, ruby.c, vm.c:
	  use rb_gc_register_mark_object() instead of
	  rb_global_variable() or rb_gc_register_address().

Mon Sep 15 23:37:15 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_opts): don't use to_sym.

Mon Sep 15 23:28:28 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_get_index): don't return -1.

	* io.c (rb_scan_open_args): call FilePathValue before encoding
	  conversion.

Mon Sep 15 22:11:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_squeeze_bang): specialized for 7bit characters in
	  ASCII compatible strings.

	* string.c (rb_str_count): ditto.

	* string.c (tr_trans): preserve 7bit/valid coderange flag.

	* string.c (rb_str_squeeze_bang): preserve previous coderange value.

	* string.c (rb_str_lstrip_bang): ditto.

	* string.c (rb_str_rstrip_bang): ditto.

	* encoding.c (rb_default_external_encoding): preserve
	  default_external_encoding in a static variable.

	* string.c (single_byte_optimizable): check coderange first, to
	  reduce number of calling rb_enc_from_index().

Mon Sep 15 20:57:00 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/matrix.rb (Matrix#eql?): fixed [ruby-dev:36298].
	  Reported by an anonymous user.

	* lib/matrix.rb (Vector#eql?): ditto.

	* (Matrix#compare_by_row_vectors): takes comparison
	  strategy as an optional parameter.

	* (Vector#compare_by): ditto.

Mon Sep 15 14:34:32 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (RUBY_MAX_CHAR_LEN): defined.

	* encoding.c (str_cat_char): use RUBY_MAX_CHAR_LEN.

Mon Sep 15 13:53:33 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): accept other than strings and
	  regexps. [ruby-core:18595]

	* encoding.c (rb_enc_get_index): works files and encodings.

Mon Sep 15 13:17:21 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_eql_p): new.

	* complex.c (nucomp_hash): should use hash values of the elements.

	* rational.c (nurat_hash): ditto.

	* hash.c (rb_any_cmp): removed an unused variable.

Mon Sep 15 11:11:04 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoder): resetsize_func and resetstate_func
	  also returns ssize_t.

	* enc/trans/iso2022.trans: follow the type change.

Mon Sep 15 10:28:10 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/matrix/test_matrix.rb (setup): typo.
	  (test_equality): misdefinition of the expected working.
	  Reported by an anonymous user.
	  (test_hash): added.

	* test/matrix/test_vector.rb: ditto.

Mon Sep 15 03:33:10 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h: return output functions ssize_t.

	* transcode.c (transcode_restartable0): don't need to cast the result
	  of output functions.

	* enc/trans/newline.trans: follow the type change.

	* enc/trans/escape.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

	* enc/trans/iso2022.trans: ditto.

	* enc/trans/japanese.trans: ditto.

Mon Sep 15 03:04:29 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h: output function takes output buffer size.

	* transcode.c: give output buffer size for output functions.

	* enc/trans/newline.trans: follow the type change.

	* enc/trans/escape.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

	* enc/trans/iso2022.trans: ditto.

	* enc/trans/japanese.trans: ditto.

Mon Sep 15 02:37:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (str_encode): returns duplicated string if nothing
	  changed.  [ruby-core:18578]

Sun Sep 14 22:09:01 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb (CGI::parse): performance improvement

Sun Sep 14 18:33:32 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: trivial changes.

Sun Sep 14 16:15:22 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/matrix.rb (Vector#eql?): typo of the method name as "eqn?".
	  (Vector#eqn?): removed. Defined by mistake.
	  Fixes [ruby-dev:36294]. Reported by weda <weda AT
	  issp.u-tokyo.ac.jp> and an anonymous user.

	* test/matrix/test_matrix.rb: added.

	* test/matrix/test_vector.rb: added.

Sun Sep 14 16:07:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): associates the locale encoding with $0 as
	  well as ARGV.

Sun Sep 14 13:48:03 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* object.c (Init_Object): added metameta-class initialization for
	  BasicObject, Object, and Module.
	  The metameta-classes of them are now the metaclass of Class, as the
	  metameta-class of Class is.

	* object.c (boot_defmetametaclass): added.

Sun Sep 14 10:10:43 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (f_{add,mul,sub}): omitted some shortcuts for preserving
	  signed zero anyway.

	* complex.c (nucomp_negate): new.

Sun Sep 14 04:15:16 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h (OnigEncodingTypeST): add end argument for
	  left_adjust_char_head.
	  (ONIGENC_LEFT_ADJUST_CHAR_HEAD): add end argument.
	  (onigenc_get_left_adjust_char_head): ditto.

	* include/ruby/encoding.h (rb_enc_left_char_head): add end argument.

	* regenc.h (onigenc_single_byte_left_adjust_char_head): ditto.

	* regenc.c (onigenc_get_right_adjust_char_head): follow the interface
	  change.
	  (onigenc_get_right_adjust_char_head_with_prev): ditto.
	  (onigenc_get_prev_char_head): ditto.
	  (onigenc_step_back): ditto.
	  (onigenc_get_left_adjust_char_head): ditto.
	  (onigenc_single_byte_code_to_mbc): ditto.

	* re.c: ditto.

	* string.c: ditto.

	* io.c: ditto.

	* regexec.c: ditto.

	* enc/euc_jp.c: ditto.

	* enc/cp949.c: ditto.

	* enc/shift_jis.c: ditto.

	* enc/gbk.c: ditto.

	* enc/big5.c: ditto.

	* enc/euc_tw.c: ditto.

	* enc/euc_kr.c: ditto.

	* enc/emacs_mule.c: ditto.

	* enc/gb18030.c: ditto.

	* enc/utf_8.c: ditto.

	* enc/utf_16le.c: ditto.

	* enc/utf_16be.c: ditto.

	* enc/utf_32le.c: ditto.

	* enc/utf_32be.c: ditto.

Sun Sep 14 03:43:27 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h (ONIGENC_STEP_BACK): add end argument.
	  (onigenc_step_back): ditto.

	* regenc.c (onigenc_step_back): add end argument.

	* regexec.c: follow the interface change.

Sun Sep 14 03:20:03 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h (onigenc_get_prev_char_head): add end
	  argument.

	* include/ruby/encoding.h (rb_enc_prev_char): ditto.

	* regenc.c (onigenc_get_prev_char_head): add end argument.

	* regparse.c: follow the interface change.

	* regexec.c: ditto.

	* string.c: ditto.

	* parse.y: ditto.

Sun Sep 14 02:04:28 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h
	  (onigenc_get_right_adjust_char_head_with_prev): add end argument.

	* regenc.c (onigenc_get_right_adjust_char_head_with_prev): use end
	  argument.

	* regexec.c (forward_search_range): follow the interface change.

Sun Sep 14 01:38:26 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h (onigenc_get_right_adjust_char_head): add
	  end argument.

	* include/ruby/encoding.h (rb_enc_right_char_head): add end argument.

	* regenc.c (onigenc_get_right_adjust_char_head): use end argument.

	* re.c (rb_reg_adjust_startpos): follow the interface change.

	* string.c (rb_str_index): ditto.

	* regexec.c (backward_search_range): ditto.
	  (onig_search): ditto.

Sun Sep 14 00:43:28 2008  Tanaka Akira  <akr@fsij.org>

	* ext/ripper/depend (ripper.o): it depends on ruby headers.

Sat Sep 13 19:27:01 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_encoding_set): don't need argc argument.
	  (rb_io_s_pipe): update io_encoding_set call.
	  (rb_io_set_encoding): ditto.

Sat Sep 13 18:46:41 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_transcoding): align state field.

Sat Sep 13 18:21:09 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (DECORATOR_P): renamed from SUPPLEMENTAL_CONVERSION.

Sat Sep 13 18:05:37 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (make_writeconv): use rb_enc_name.
	  (make_readconv): ditto.

	* transcode.c (rb_econv_open_opts): ditto.
	  (econv_args): ditto.
	  (decorate_convpath): ditto.
	  (econv_set_replacement): ditto.

Sat Sep 13 11:15:38 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/rexml/document.rb: fixed typo.

Sat Sep 13 10:53:13 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: refined.

	* rational.c: ditto.

Sat Sep 13 03:44:52 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_prepare_opts): raise ArgumentError if
	  a broken string is specified as a replacement.

Sat Sep 13 03:31:05 2008  Tanaka Akira  <akr@fsij.org>

	* iseq.c (iseq_s_compile_file): use rb_file_open_str.

	* io.c (rb_file_open_generic): call validate_enc_binmode.
	  (rb_file_open_str): call FilePathValue.

Sat Sep 13 02:58:05 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (validate_enc_binmode): extracted from rb_io_extract_modeenc.
	  (rb_io_extract_modeenc): use validate_enc_binmode.
	  (io_encoding_set): call validate_enc_binmode.

Sat Sep 13 02:50:34 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_prepare_opts): initialize *opt and return 0
	  if opthash is nil.

Sat Sep 13 02:29:19 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/escape.trans: transcoder name renamed to use underscore.

	* transcode.c: follow the renaming.

Sat Sep 13 02:12:17 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_init_by_convpath_i): new function.
	  (rb_econv_init_by_convpath): new function.
	  (econv_init): use rb_econv_init_by_convpath.

Sat Sep 13 01:11:14 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_args): take snamev_p and dnamev_p to prevent
	  possible GC problem.

Sat Sep 13 00:38:54 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (enc_arg): take arg as VALUE * to prevent possible GC
	  problem.

Fri Sep 12 23:19:41 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_add_transcoder_at): fix loop condition.

Fri Sep 12 22:39:46 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (decorator_names): extracted from rb_econv_open.
	  (rb_econv_open): use decorator_names.
	  (econv_args): extracted from econv_init.
	  (econv_init): use econv_args.
	  (decorate_convpath): new function.
	  (search_convpath_i): new function.
	  (econv_s_search_convpath): new method.
	  (Init_transcode): new method defined.

Fri Sep 12 21:55:43 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_t): new field: num_allocated.
	  (rb_econv_alloc): extracted from
	  rb_econv_open_by_transcoder_entries.
	  (rb_econv_add_transcoder_at): extracted from rb_econv_decorate_at
	  and generalized
	  (rb_econv_open_by_transcoder_entries): use rb_econv_alloc and
	  rb_econv_add_transcoder_at.
	  (rb_econv_add_converter): extracted from rb_econv_decorate_at.
	  (rb_econv_decorate_at): use rb_econv_add_converter.

Fri Sep 12 21:22:09 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_t): new field: started.
	  (rb_econv_open_by_transcoder_entries): initialize started field.
	  (rb_econv_convert): set started field.
	  (rb_econv_insert_output): ditto.
	  (rb_econv_decorate_at): check started field instead of num_finished.

Fri Sep 12 20:28:59 2008  Tanaka Akira  <akr@fsij.org>

	* regenc.c (onigenc_single_byte_code_to_mbc): follow OnigEncoding
	  change.

Fri Sep 12 20:00:22 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* regparse.c (parse_exp): fix resource leak.

Fri Sep 12 01:21:22 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/syck/node.c (syck_replace_str2): fix wrong check to free ptr.

Thu Sep 11 20:18:24 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_err_in_callback.rb (teardown): get rid
	  of infinite loop.

Thu Sep 11 19:12:56 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/oniguruma.h (OnigCodePoint): unsigned long to unsigned int.

	* include/ruby/encoding.h (rb_enc_codepoint): ditto.

	* encoding.c (rb_enc_codepoint): signed int to unsigned int.

	* encoding.c (rb_enc_ascget): ditto.

	* string.c (rb_str_casecmp): ditto.

	* string.c (enc_succ_alnum_char): ditto.

	* string.c (rb_str_inspect): ditto.

	* string.c (rb_str_upcase_bang): ditto.

	* string.c (rb_str_downcase_bang): ditto.

	* string.c (rb_str_capitalize_bang): ditto.

	* string.c (rb_str_swapcase_bang): ditto.

	* string.c (struct tr): ditto.

	* string.c (trnext): ditto.

	* string.c (tr_trans): ditto.

	* string.c (tr_setup_table): ditto.

	* string.c (tr_find): ditto.

	* string.c (rb_str_delete_bang): ditto.

	* string.c (rb_str_squeeze_bang): ditto.

	* string.c (rb_str_count): ditto.

	* string.c (rb_str_split_m): ditto.

	* string.c (rb_str_each_line): ditto.

	* string.c (rb_str_lstrip_bang): ditto.

	* string.c (rb_str_rstrip_bang): ditto.

	* string.c (rb_str_intern): ditto.

	* dir.c (char_casecmp): ditto.

	* sprintf.c (rb_str_format): ditto.

	* enc/emacs_mule.c (mbc_to_code): to be 32bit clean.

	* enc/emacs_mule.c (code_to_mbc): ditto.

	* enc/gb18030.c (mbc_to_code): ditto.

	* enc/gb18030.c (code_to_mbc): ditto.

Thu Sep 11 19:09:25 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/iconv/iconv.c: add attention for machine independent.

Thu Sep 11 15:23:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigdivrem): adjust length for division and remainder.
	  a patch from TOYOFUKU Chikanobu <nobu_toyofuku at nifty.com> in
	  [ruby-dev:36231].

Thu Sep 11 02:59:47 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_binwrite): extracted from io_fwrite.

Thu Sep 11 02:25:34 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_encoding): new function.
	  (make_encobj): new function.
	  (econv_s_asciicompat_encoding): use make_encoding.
	  (rb_econv_open_exc): use SUPPLEMENTAL_CONVERSION.
	  (econv_convpath): use encoding object in the result.

Thu Sep 11 02:14:38 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_convpath): new method.

Wed Sep 10 23:00:43 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* tool/compile_prelude.rb: print "<internal:prelude>" instead of
	  "prelude.rb" on stack trace.  [ruby-dev:36129]

Wed Sep 10 21:19:58 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (big2str_karatsuba): remove unnecessary fixnum code.  a
	  patch from TOYOFUKU Chikanobu <nobu_toyofuku at nifty.com> in
	  [ruby-dev:36217].

Wed Sep 10 21:09:32 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_err_in_callback.rb: InternetExplorer should
	  be closed.

	* test/win32ole/err_in_callback.rb: ditto.

Wed Sep 10 18:25:19 2008  akira yamada  <akira@rice.p.arika.org>

	* lib/uri/common.rb (URI::Parser): new class.

	* lib/uri/mailto.rb, lib/uri/generic.rb: follow the above change.

	* test/uri/test_parser.rb: added tests for URI::Parser.

Wed Sep 10 10:35:32 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi/cookie.rb (CGI::Cookie#to_s): performance improvement
	  from http://jp.rubyist.net/magazine/?0023-Cgirb.

Wed Sep 10 10:12:29 2008  akira yamada  <akira@arika.org>

	* lib/sync.rb (Sync_m#sync_exclusive): fixed
	  typo. [ruby-dev:36233] [RubyForge#11680]

Wed Sep 10 01:57:23 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (StrSet#hash): cache hash value.
	  (ActionMap#hash): ditto.

Wed Sep 10 01:26:01 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (econv_after_output): renamed from
	  econv_output_followed_by_input.
	  (ECONV_AFTER_OUTPUT): renamed from ECONV_OUTPUT_FOLLOWED_BY_INPUT.

	* transcode.c: follow the renaming.

	* io.c: ditto.

Wed Sep 10 01:16:07 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (get_replacement_character): don't return ASCII
	  incompatible replacements.
	  (make_replacement): don't convert the result of
	  get_replacement_character.

Wed Sep 10 01:05:00 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/newline.trans (rb_universal_newline): swap src_encoding
	  and dst_encoding.

	* transcode.c (rb_econv_decorate_at): call get_transcoder_entry only
	  once.
	  (rb_econv_binmode): follow universal_newline change.

Wed Sep 10 00:01:36 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): rename field: writeconv_stateless to
	  writeconv_asciicompat.

	* io.c: follow the renaming.

	* gc.c: ditto.

Tue Sep  9 23:55:26 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_fwrite): raise an error if ASCII incompatible string
	  written for text mode IO without encoding conversion.
	  (rb_io_extract_modeenc): binmode requirement changed.

Tue Sep  9 21:59:48 2008  Takeyuki Fujioka  <xibbar@ruby-lang.org>

	* lib/cgi*: split cgi.rb into four files. [ruby-dev:36041]

Tue Sep  9 21:17:00 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_DECORATOR_MASK): merge
	  ECONV_ENCODER_MASK and ECONV_DECORATOR_MASK.
	  (ECONV_UNIVERSAL_NEWLINE_DECORATOR): renamed from
	  ECONV_UNIVERSAL_NEWLINE_DECODER.
	  (ECONV_CRLF_NEWLINE_DECORATOR): renamed from
	  ECONV_CRLF_NEWLINE_ENCODER.
	  (ECONV_CR_NEWLINE_DECORATOR): renamed from ECONV_CR_NEWLINE_ENCODER.
	  (ECONV_XML_TEXT_DECORATOR): renamed from ECONV_XML_TEXT_ENCODER.
	  (ECONV_XML_ATTR_CONTENT_DECORATOR): renamed from
	  ECONV_XML_ATTR_CONTENT_ENCODER.
	  (ECONV_STATEFUL_DECORATOR_MASK): renamed from
	  ECONV_STATEFUL_ENCODER_MASK.
	  (ECONV_XML_ATTR_QUOTE_DECORATOR): renamed from
	  ECONV_XML_ATTR_CONTENT_DECORATOR.

	* io.c: follow the renaming.

	* transcode.c: ditto.

Tue Sep  9 20:55:55 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open0): make it static.
	  (rb_econv_open): place decorators at last.

Tue Sep  9 20:40:15 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/openssl/test_ssl.rb (OpenSSL#test_client_session):
	  Debian's openssl 0.9.8g-13 failed at assert(ssl.session_reused?),
	  when use default SSLContext. [ruby-dev:36167]

Tue Sep  9 20:34:26 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_t): last_trans_index removed.
	  (rb_econv_open_by_transcoder_entries): follow the type change.
	  (rb_econv_open0): ditto.
	  (rb_econv_decorate_at): ditto.
	  (rb_econv_binmode): ditto.
	  (rb_econv_insert_output): simplified because there are no decorators
	  at last.

Tue Sep  9 20:21:54 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): reverse the order of decoders.

Tue Sep  9 20:18:26 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open0): num_encoders and num_decoders removed.

Tue Sep  9 03:59:13 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (make_writeconv): useless branch removed.

Tue Sep  9 02:18:20 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_decorate_at_first): declared.
	  (rb_econv_decorate_at_last): declared.

	* transcode.c (rb_econv_open_by_transcoder_entries): initialize
	  replacement_enc.  allocate outbuf for the last transcoder.
	  (rb_econv_open0): extracted from rb_econv_open.
	  (rb_econv_open): use rb_econv_open0 and decorate the result using
	  rb_econv_decorate_at_first and rb_econv_decorate_at_last.
	  (rb_econv_decorate_at): new function.
	  (rb_econv_decorate_at_first): ditto.
	  (rb_econv_decorate_at_last): ditto.
	  (rb_econv_binmode): fix iteration end condition.
	  (econv_init): don't set source_encoding_name and
	  destination_encoding_name because they are set in rb_econv_open0.

Tue Sep  9 01:10:54 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): make ec a local variable.

Tue Sep  9 00:20:10 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_asciicompat_encoding): check decoder.

Tue Sep  9 00:00:47 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_t): last_error.partial_input removed.

Mon Sep  8 23:24:54 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_asciicompat_encoding): renamed
	  from rb_econv_stateless_encoding to apply stateless ASCII
	  incompatible encodings such as UTF-16BE.

	* io.c (make_writeconv): use rb_econv_asciicompat_encoding.

	* transcode_data.h (rb_transcoder_asciicompat_type_t): renamed from
	  rb_transcoder_stateful_type_t.
	  (rb_transcoder): use rb_transcoder_asciicompat_type_t.

	* transcode.c: follow the type change.
	  (asciicompat_encoding_i): renamed from stateless_encoding_i.
	  (rb_econv_asciicompat_encoding): renamed from
	  rb_econv_stateless_encoding.
	  (econv_s_asciicompat_encoding): method renamed.

	* tool/transcode-tblgen.rb: follow the type change.

	* enc/trans/utf_16_32.trans: follow the type change.
	  rb_from_UTF_16BE to UTF-8 is asciicompat_decoder.
	  rb_from_UTF_16LE to UTF-8 is asciicompat_decoder.
	  rb_from_UTF_32BE to UTF-8 is asciicompat_decoder.
	  rb_from_UTF_32LE to UTF-8 is asciicompat_decoder.
	  UTF-8 to rb_to_UTF_16BE is asciicompat_encoder.
	  UTF-8 to rb_to_UTF_16LE is asciicompat_encoder.
	  UTF-8 to rb_to_UTF_32BE is asciicompat_encoder.
	  UTF-8 to rb_to_UTF_32LE is asciicompat_encoder.

	* enc/trans/newline.trans: follow the type change.  universal newline
	  decoder is asciicompat_converter.

	* enc/trans/escape.trans: follow the type change.

	* enc/trans/iso2022.trans: ditto.

	* enc/trans/japanese.trans: ditto.

Mon Sep  8 23:05:42 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_insert_output): "readagain" part should be
	  after replacement.

Mon Sep  8 22:30:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (dir_initialize): rename option name of Dir.open
	  from :external_encoding to :encoding.

Mon Sep  8 22:16:20 2008  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi.rb : obsolete regex "n" option. [ruby-dev:36130]

Mon Sep  8 18:13:20 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (getppid): typo. [ruby-dev:36202]

	* process.c (get_ppid): mention the return value on Windows.

Mon Sep  8 18:15:59 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (ArrayCode): less string substitutions.

Mon Sep  8 18:13:13 2008  Tanaka Akira  <akr@fsij.org>

	* vm.c (rb_mRubyVMFrozenCore): registered for GC.

	* re.c (rb_reg_preprocess_dregexp): fix GC problem on MacOS X with
	  powerpc-apple-darwin8-gcc-4.0.1 (GCC) 4.0.1 (Apple Computer, Inc.
	  build 5367).

Mon Sep  8 18:09:07 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): define SIZE_MAX for VC++6/7.

Mon Sep  8 17:46:09 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (filetime_to_unixtime): remove unused variable.
	  [ruby-dev:36191]

Mon Sep  8 13:47:39 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_io.rb (TestIO#test_dup): add open in block.
	  see [ruby-dev:35957].

Mon Sep  8 07:09:42 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: some adjustments.

	* rational.c: ditto.

Mon Sep  8 06:50:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (XLDFLAGS): added --enable-auto-import for cygwin and
	  mingw.

Mon Sep  8 02:04:25 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_set_replacement): renamed from
	  rb_econv_set_replacemenet.

	* transcode.c: follow the renaming.

Mon Sep  8 01:10:41 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (transcode_tblgen): log message refined.

Mon Sep  8 00:58:04 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: removed unused code.

Mon Sep  8 00:04:09 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/iso2022.trans: upcase to iso-2022-jp.

	* enc/emacs_mule.c: ditto.

Sun Sep  7 23:46:36 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/iso2022.trans: stateless-iso-2022-jp is defined to avoid
	  undefined conversion error between iso-2022-jp and the corresponding
	  stateless encoding.

	* enc/emacs_mule.c: replicate emacs-mule as stateless-iso-2022-jp.

Sun Sep  7 20:03:01 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/escape.trans (hexstr): renamed from str1.

Sun Sep  7 19:45:31 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/escape.trans: use transcode_tblgen.

	* tool/transcode-tblgen.rb: generate an empty line after str1.

Sun Sep  7 19:16:38 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (ActionMap#str_name): new method to
	  generate a name base on string content.
	  (ActionMap#gen_str): extracted from generate_info and use str_name.

Sun Sep  7 18:28:05 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (ActionMap#generate_info): use a memo to
	  avoid duplication for STR1.

Sun Sep  7 18:10:28 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (STR1): defined for a string up to 255 bytes.
	  (STR1_BYTEINDEX): defined.
	  (makeSTR1): defined.

	* tool/transcode-tblgen.rb: generate STR1.

	* transcode.c (transcode_restartable0): interpret STR1.

	* enc/trans/escape.trans (fun_so_escape_xml_chref): removed.  STR1 is
	  used instead.

Sun Sep  7 17:54:45 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* configure.in: Mac OS X's crypt(2) is broken with invalid salt.
	  [ruby-dev:35899]
	* string.c (rb_str_crypt): ditto.

Sun Sep  7 17:29:49 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: o4 is usable only if the first byte is
	  f0-f7.

Sun Sep  7 12:44:26 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (make_writeconv): choose ASCII compatible encoding as
	  intermediate encoding if stateful encoder exists.

Sun Sep  7 12:09:29 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_XML_ATTR_CONTENT_ENCODER): defined.
	  (ECONV_STATEFUL_ENCODER_MASK): defined.
	  (ECONV_XML_ATTR_QUOTE_ENCODER): defined.
	  (ECONV_XML_ATTR_ENCODER): removed.

	* enc/trans/escape.trans (rb_escape_xml_attr_content): defined.
	  (rb_escape_xml_attr_quote): defined.
	  (rb_escape_xml_attr): removed.

	* io.c (NEED_WRITECONV): writeconv is required if supplemental
	  converter is used.
	  (make_writeconv): apply stateful encoder in writeconv.

	* transcode.c: follow the constant change.

Sun Sep  7 07:24:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/*.el:  merged the following patches from Nathan Weizenbaum
	  <nex342 at gmail.com>.   [ruby-core:18424]

	* misc/ruby-mode.el: improve here-doc performance.

	* misc/ruby-mode.el: don't crash the whole mode if the Subversion
	  $ keyword isn't interpolated.

	* misc/ruby-mode.el: don't highlight keywords when they're the
	  beginning of non-keyword symbols.

	* misc/ruby-mode.el, misc/ruby-electric.el: use regexp-opt where
	  possible for more efficient regexps.

	* misc/*.el: untabify, for internal consistency and consistency
	  with standard Emacs elisp files.

	* misc/ruby-mode.el: fix a variable-name error.

	* misc/emacs-mode.el: don't set case-fold-search globally to nil;
	  instead just set it when we need it.

Sun Sep  7 06:31:51 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (file_expand_path): applied a patch from Nobuhiro Tachino
	  in [ruby-dev:35948].  fix #491

Sun Sep  7 03:37:05 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_block_optarg): allow default for block parameters as
	  long as the value is primary.  a patch from Eric Mahurin
	  <eric.mahurin at gmail.com> in [ruby-core:16880].

Sun Sep  7 01:07:10 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (yylex): "1.upto 2 {|i| p i }" should be syntax error.
	  [ruby-dev:36008]

	* test/ruby/test_parse.rb (TestParse): update a test not to use
	  recently fixed inconsistent syntax.

Sun Sep  7 00:37:25 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_ERROR_HANDLER_MASK): defined.
	  (ECONV_DECODER_MASK): defined.
	  (ECONV_ENCODER_MASK): defined.

	* io.c (make_writeconv): restrict ecflags for writeconv with
	  ECONV_ERROR_HANDLER_MASK.

Sat Sep  6 23:03:41 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_XML_TEXT_ENCODER): renamed from
	  ECONV_HTML_TEXT_ENCODER.
	  (ECONV_XML_ATTR_ENCODER): renamed from ECONV_HTML_ATTR_ENCODER.

	* enc/trans/escape.trans: follow the renaming.

	* transcode.c: ditto.

Sat Sep  6 21:35:52 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/mkconstants.rb: add some IPV6 constants. [ruby-dev:36175]

Sat Sep  6 20:10:48 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_description): show ECONV_HTML_TEXT_ENCODER and
	  ECONV_HTML_ATTR_ENCODER.

Sat Sep  6 20:06:09 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_binmode): check actual transcoders.

Sat Sep  6 19:54:25 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): fix last_tc.

Sat Sep  6 19:36:34 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_binmode): clear newline flags in writeconv_pre_ecflags.

Sat Sep  6 18:47:40 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (str_transcode0): check ECONV_HTML_TEXT_ENCODER and
	  ECONV_HTML_ATTR_ENCODER.

Sat Sep  6 18:38:47 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (allocate_converted_string): fix overflow condition.

Sat Sep  6 15:06:21 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (sym_html): new variable.
	  (sym_text): ditto.
	  (sym_attr): ditto.
	  (econv_opts): check :html=>:text and :html=>:attr.
	  (Init_transcode): initialize the above variables.

Sat Sep  6 14:46:12 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_HTML_TEXT_ENCODER): new constant.
	  (ECONV_HTML_ATTR_ENCODER): ditto.

	* transcode.c (rb_econv_open): check ECONV_HTML_TEXT_ENCODER and
	  ECONV_HTML_ATTR_ENCODER.
	  (Init_transcode): Encoding::Converter::HTML_TEXT_ENCODER and
	  Encoding::Converter::HTML_ATTR_ENCODER defined.

Sat Sep  6 14:15:25 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (struct trans_open_t): defined to pass num_additional.
	  (trans_open_i): use struct trans_open_t.
	  (rb_econv_open): ditto.

Sat Sep  6 13:43:20 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/escape.trans (fun_so_escape_html_attr): fix return type.

Sat Sep  6 12:43:55 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): needless branch removed.

Sat Sep  6 12:38:34 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): test condition simplified.

Sat Sep  6 12:25:31 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (stateless_encoding_i): ignore supplemental conversions.
	  Encoding::Converter.stateless_encoding("html-attr-escaped") should be
	  nil.

Sat Sep  6 12:19:36 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/escape.trans (escape_html_attr_init): new function.
	  (fun_so_escape_html_attr): new function.
	  (escape_html_attr_finish): new function.
	  (rb_escape_html_attr): use them to quote the converted result.

Sat Sep  6 07:54:36 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: uses f_real_p macro.

Sat Sep  6 07:27:00 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): fail for ASCII incompatible with
	  newline conversion.

Sat Sep  6 07:24:49 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_extract_modeenc): raise an error for ASCII incompatible
	  encoding without binmode.

Sat Sep  6 07:12:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigdivrem1): optimization by skipping zeros at the
	  tail of digits.  a patch from TOYOFUKU Chikanobu
	  <nobu_toyofuku at nifty.com> in [ruby-dev:36169].

Sat Sep  6 06:28:46 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/escape.trans: new file.

Sat Sep  6 06:23:27 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (StrSet.parse): accept upper case
	  hexadecimal digits.

Sat Sep  6 05:37:08 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (output_hex_charref): upcase hexadecimal digits.

Sat Sep  6 05:22:29 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_UNDEF_HEX_CHARREF): defined.

	* transcode.c (output_hex_charref): new function.
	  (rb_econv_convert): call output_hex_charref if
	  ECONV_UNDEF_HEX_CHARREF.
	  (Init_transcode): Encoding::Converter::UNDEF_HEX_CHARREF added.

Sat Sep  6 03:52:47 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_convert): use ECONV_INVALID_MASK and
	  ECONV_UNDEF_MASK.

Sat Sep  6 06:05:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/ruby.h (DBL2NUM): renamed from DOUBLE2NUM.
	  a patch from Tadashi Saito <shiba at mail2.accsnet.ne.jp>
	  in [ruby-dev:36102].

Sat Sep  6 04:44:06 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (Init_Proc): add '===' operator to use procs in when
	  clause of the case statement.  inspired by <http://www.aimred.com/news/developers/2008/08/14/unlocking_the_power_of_case_equality_proc/>.

Sat Sep  6 03:18:17 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (allocate_converted_string): add arguments for a buffer
	  allocated by caller.
	  (rb_econv_insert_output): provide caller allocated buffer to
	  allocate_converted_string.

Sat Sep  6 02:58:53 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (str_transcode_enc_args): local variables renamed.
	  (str_transcode0): ditto.

Sat Sep  6 02:23:18 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_s_stateless_encoding): new method.

Sat Sep  6 02:01:59 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (enc_arg): extracted from str_transcode_enc_args.
	  (str_transcode_enc_args): use enc_arg.

Fri Sep  5 20:27:17 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_modestr_fmode): renamed from
	  rb_io_mode_flags.
	  (rb_io_modestr_oflags): renamed from rb_io_mode_modenum.
	  (rb_io_oflags_fmode): renamed from rb_io_modenum_flags.
	  (rb_io_mode_flags): defined as a macro.
	  (rb_io_modenum_flags): ditto.

	* io.c: follow the renaming with consistency.

	* process.c (check_exec_redirect): call rb_io_modestr_oflags.

	* ext/pty/depend: pty.o depends on io.h.

Fri Sep  5 20:12:23 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/newline.trans (universal_newline_finish): new function.

Fri Sep  5 20:07:37 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_mode_modenum): moved from
	  include/ruby/intern.h.

Fri Sep  5 19:59:26 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (MODENUM_MAX): removed.

Fri Sep  5 18:37:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (copy_stream_fallback_body): use read method unless readpartial
	  is available.  [ruby-dev:36124]

Fri Sep  5 18:16:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_create): strips glibc style option before
	  charset mapping.  retries without options if they seemed causing
	  error, and warns.  [ruby-dev:36147]

Fri Sep  5 03:09:48 2008  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_data_to_ary): make it static.

	* thread.c (thgroup_enclose): ditto.

Fri Sep  5 02:56:37 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c (thread_recycle_stack_slot, thread_recycle_stack_count):
	  make it static.

Fri Sep  5 02:40:38 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_critical): removed.

Fri Sep  5 01:22:23 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (argf_mark): mark p->encs.ecopts.

Fri Sep  5 00:45:07 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoder): rename fields:
	  from_encoding -> src_encoding, to_encoding -> dst_encoding.

	* transcode.c: follow the renaming.

Fri Sep  5 00:22:34 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c: variables renamed for consistency.

Fri Sep  5 00:05:27 2008  Tanaka Akira  <akr@fsij.org>

	* pack.c (encodes): make buff fixed length to avoid SEGV by
	  ruby -e '["a"*10000000].pack("m1000000000")'

Thu Sep  4 23:47:05 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode): set exception mode
	  correctly.  In spite of BigDecimal.mode(BigDecimal::EXCEPTION_ALL,
	  true), BigDecimal.new("NaN") did not raise an exception previously.

Thu Sep  4 23:42:42 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_file_open_str): declared.

	* io.c (rb_file_open_str): defined.

	* ext/zlib/zlib.c (gzfile_s_open): use rb_file_open_str instead of
	  rb_file_open.

Thu Sep  4 23:18:55 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/newline.trans: record newline types met in universal
	  newline decoder.

Thu Sep  4 23:05:54 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/prime.rb (Prime::OldCompatibility#each): added compatibility to
	    Ruby 1.8.7.
	  (Prime#each): added more rdocs.
	  (Prime#each): remembers the last value of the given block.

Thu Sep  4 21:53:58 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_init): accept an integer as 3rd argument as well.

Thu Sep  4 21:46:21 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (sym_partial_input): new variable.
	  (econv_primitive_convert): accept a hash as 5th argument as well.

Thu Sep  4 21:04:27 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (sym_universal_newline_decoder): new variable.
	  (sym_crlf_newline_encoder): ditto.
	  (sym_cr_newline_encoder): ditto.
	  (econv_opts): check newline converter options.
	  (econv_init): make 3rd argument hash/nil only.

Thu Sep  4 21:03:28 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c: rename some debug functions.

Thu Sep  4 20:57:54 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_check_trap_pending): added for compatibility.

	* ext/tk/tcltklib.c, ext/tk/tkutil/tkutil.c: remove ruby/signal.h
	  dependency.

Thu Sep  4 20:30:24 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (PType): defined unconditionally.

	* transcode.c (PType): don't define here.

Thu Sep  4 20:19:36 2008  Tanaka Akira  <akr@fsij.org>

	* io.c: variables renamed for consistency.

Thu Sep  4 19:40:50 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (gc_profile_record_get): to static function.
	  (gc_profile_result): ditto.
	  (gc_profile_report): ditto.

Thu Sep  4 19:20:24 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_enc_t): rename flags to ecflags.
	  (rb_io_t): rename writeconv_pre_flags to writeconv_pre_ecflags.
	  (MakeOpenFile): follow the renaming.

	* io.c: follow the renaming.

Thu Sep  4 19:10:27 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_INVALID_IGNORE): removed because
	  it tend to cause security problem.  If the behaviour is really
	  required, ECONV_INVALID_REPLACE with empty string can be used.
	  For example, CVE-2006-2313, CVE-2008-1036, [ruby-core:15645],
	  http://unicode.org/reports/tr36/
	  (ECONV_UNDEF_IGNORE): ditto.

	* transcode.c (rb_econv_convert): follow the above change.
	  (econv_opts): ditto.
	  (Init_transcode): ditto.

Thu Sep  4 13:22:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (struct rb_vm_struct): replaced signal staff with trap
	  staff.

	* signal.c (signal_buff): per process resource now.

	* signal.c (trap_list): moved to VM.

	* signal.c (rb_get_next_signal): reverted.

	* signal.c (rb_trap_exit): trap_pending_list was no longer used.

	* thread.c (timer_thread_function): delivers buffered per-process
	  signals to each VMs.

	* vm.c (rb_vm_mark): marks trap_list.

Thu Sep  4 13:01:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (struct sysopen_struct, rb_sysopen_internal, rb_sysopen):
	  constified.

	* io.c: expanded ARGF members macros.

Thu Sep  4 10:43:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/transcode-tblgen.rb (citrus_decode_mapsrc): support older 1.8.

Thu Sep  4 10:33:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_next_argv, argf_set_encoding): copy struct wise.

Thu Sep  4 09:46:18 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_scan_open_args): follow rb_str_transcode change.

Thu Sep  4 08:59:29 2008  Tanaka Akira  <akr@fsij.org>

	* file.c (rb_find_file): fix GC problem on Debian GNU/Linux (IA64)
	  with gcc (GCC) 4.1.2 20061115 (prerelease) (Debian 4.1.1-21).
	  There is no register/memory to contain load_path.  A register (r35)
	  contains &RARRAY_PTR(load_path), (char*)load_path + 32.

Thu Sep  4 03:10:05 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): new fields: encs.ecopts and
	  writeconv_pre_ecopts.
	  (MakeOpenFile): initialize them.

	* include/ruby/encoding.h (rb_str_transcode): take ecopts argument.
	  (rb_econv_flags): removed.
	  (rb_econv_prepare_opts): declared.
	  (rb_econv_open_opts): declared.

	* io.c (make_writeconv): use rb_econv_open_opts.
	  (make_readconv): ditto.
	  (io_fwrite): follow rb_str_transcode change.
	  (rb_io_extract_modeenc): use rb_econv_prepare_opts.
	  (rb_file_open_generic): initialize encs.ecopts.
	  (rb_file_open_internal): ditto.
	  (rb_io_reopen): ditto.
	  (argf_ecopts): defined.
	  (argf_next_argv): set encs.ecopts.
	  (io_encoding_set): use rb_econv_prepare_opts.
	  (argf_set_encoding): set argf_ecopts.

	* gc.c (gc_mark_children): mark encs.ecopts and writeconv_pre_ecopts
	  in T_FILE.

	* transcode.c (transcode_loop): take ecopts argument. use
	  rb_econv_open_opts.
	  (rb_econv_flags): removed.
	  (rb_econv_prepare_opts): defined.
	  (rb_econv_open_opts): defined.
	  (str_transcode0): take ecopts.
	  (str_transcode): use rb_econv_prepare_opts.
	  (rb_str_transcode): take ecopts.
	  (econv_init): accept hash argument.
	  (econv_insert_output): follow rb_str_transcode change.

Thu Sep  4 01:30:26 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_set_replacemenet): declared.

	* transcode.c (rb_econv_t): new fields: replacement_str,
	  replacement_len, replacement_enc and replacement_allocated.
	  (get_replacement_character): make len as size_t.
	  (rb_econv_open_by_transcoder_entries): initialize the new fields.
	  (rb_econv_close): deallocate replacement_str if it allocated.
	  (make_replacement): new function.
	  (output_replacement_character): use make_replacement.
	  (rb_econv_set_replacemenet): defined.
	  (econv_get_replacement): new method.
	  (econv_set_replacement): new method.

Thu Sep  4 01:12:03 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (filetime_to_timeval): new function, split from
	  gettimeofday().

	* win32/win32.c (gettimeofday): use above function.

	* win32/win32.c (filetime_to_unixtime): ditto. [ruby-dev:36135]

Thu Sep  4 01:00:57 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* transcode.c (transcode_restartable0): avoid VC++6's bug.

Thu Sep  4 00:26:27 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (make_writeconv): follow akr's previous commit.

Thu Sep  4 00:09:05 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_option_t): removed.  Since
	  rb_econv_option_t has only one field, int flags, rb_econv_option_t is
	  replaced by int.

	* include/ruby/io.h: follow the above change.

	* io.c: ditto.

	* transcode.c: ditto.

Thu Sep  4 00:04:59 2008  Koichi Sasada  <ko1@atdot.net>

	* win32/win32.c: fix ruby/signal.h depending codes.

Thu Sep  4 00:01:45 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/etc/test_etc.rb (test_getpwuid, test_getgrgid): use
	  Process.euid and egid instead of Etc.getlogin to identify current
	  user which may be different from a login one (e.g., su command).

Wed Sep  3 23:52:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/etc/test_etc.rb: check only typical use of
	  setpwent/getpwent/endpwent and setgrent/getgrent/endgrent.

Wed Sep  3 23:33:09 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_transcoding): moved from transcode_data.h.
	  (TRANSCODING_READBUF): ditto.
	  (TRANSCODING_WRITEBUF): ditto.
	  (TRANSCODING_STATE_EMBED_MAX): ditto.
	  (TRANSCODING_STATE): ditto.

Wed Sep  3 23:03:37 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): remove stateful field.
	  add state field.
	  (TRANSCODING_STATE): defined.
	  (rb_transcoder): add fields: state_size, state_init_func,
	  state_fini_func.
	  change rb_transcoding* argument to void*.

	* transcode.c (transcode_restartable0): use TRANSCODING_STATE for
	  first arguments of transcoder functions.
	  (rb_transcoding_open_by_transcoder): initialize state field.
	  (rb_transcoding_close): finalize state field.

	* tool/transcode-tblgen.rb: provide state size/init/fini.

	* enc/trans/newline.trans (universal_newline_init): defined.
	  (fun_so_universal_newline): take void* as a state pointer.
	  (rb_universal_newline): provide state size/init/fini.
	  (rb_crlf_newline): ditto.
	  (rb_cr_newline): ditto.

	* enc/trans/iso2022.trans (iso2022jp_init): defined.
	  (fun_si_iso2022jp_to_eucjp): take void* as a state pointer.
	  (fun_so_iso2022jp_to_eucjp): ditto.
	  (fun_so_eucjp_to_iso2022jp): ditto.
	  (iso2022jp_reset_sequence_size): ditto.
	  (finish_eucjp_to_iso2022jp): ditto.
	  (rb_ISO_2022_JP_to_EUC_JP): provide state size/init/fini.
	  (rb_EUC_JP_to_ISO_2022_JP): ditto.

	* enc/trans/utf_16_32.trans (fun_so_from_utf_16be): take void* as a
	  state pointer.
	  (fun_so_to_utf_16be): ditto.
	  (fun_so_from_utf_16le): ditto.
	  (fun_so_to_utf_16le): ditto.
	  (fun_so_from_utf_32be): ditto.
	  (fun_so_to_utf_32be): ditto.
	  (fun_so_from_utf_32le): ditto.
	  (fun_so_to_utf_32le): ditto.
	  (rb_from_UTF_16BE): provide state size/init/fini.
	  (rb_to_UTF_16BE): ditto.
	  (rb_from_UTF_16LE): ditto.
	  (rb_to_UTF_16LE): ditto.
	  (rb_from_UTF_32BE): ditto.
	  (rb_to_UTF_32BE): ditto.
	  (rb_from_UTF_32LE): ditto.
	  (rb_to_UTF_32LE): ditto.

	* enc/trans/japanese.trans (fun_so_eucjp2sjis): take void* as a state
	  pointer.
	  (fun_so_sjis2eucjp): ditto.
	  (rb_eucjp2sjis): provide state size/init/fini.
	  (rb_sjis2eucjp): provide state size/init/fini.

Wed Sep  3 22:31:11 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mathn.rb (Integer): moved into prime.rb.
	  (Prime): ditto.

	* lib/prime.rb (Integer): moved from mathn.rb.
	  (Integer.each_prime): added.
	  (Integer#prime?): added.
	  (Prime): moved from mathn.rb.
	    Its implementation was rewritten. see [ruby-dev:35863].
	    And patched by Keiju ISHITSUKA <keiju@ishitsuka.com>,
	    see [ruby-dev:36128].
	  (Prime.new):                     obsolete.
	  (Prime.instance):                added.
	  (Prime.each):                    added.
	  (Prime.int_from_prime_division): added.
	  (Prime.prime_division):          added.
	  (Prime.prime?):                  added.
	    Patch by TOYOFUKU Chikanobu
	    <nobu_toyofuku at nifty.com> in [ruby-dev:36067].
	  (Prime.cache):                   removed.
	  (Prime.primes):                  removed.
	  (Prime.primes_so_far):           removed.
	  (Prime#int_from_prime_division): added.
	  (Prime#prime_division):          added.
	  (Prime#prime?):                  added.
	  (Prime#primes):                  removed.
	  (Prime#primes_so_far):           removed.
	  (Prime::PseudoPrmeGenerator):    added.
	  (Prime::EratosthenesGenerator):  added.
	  (Prime::TrialDivisionGenerator): added.
	  (Prime::Generator23):            added.
	  (Prime::TrialDivision):          added.
	    Extracted from the previous implementation of Prime
	    by Keiju ISHITSUKA.
	  (Prime::EratosthenesSieve):      added.

	* lib/.document (prime.rb): added

	* lib/README (prime.rb): added

	* test/test_prime.rb: added.

Wed Sep  3 21:49:00 2008  David A. Black  <dblack@rubypal.com>

	* lib/scanf.rb: fixed bug involving matching literal '['

	* test/scanf/test_scanf.rb: added test for scanf.rb fix

Wed Sep  3 21:31:59 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (WORDINDEX_SHIFT_BITS): defined.
	  (WORDINDEX2INFO): defined.
	  (INFO2WORDINDEX): defined.

	* tool/transcode-tblgen.rb: use WORDINDEX2INFO.

	* transcode.c: use INFO2WORDINDEX.

Wed Sep  3 21:19:51 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* golf_prelude.rb: suppress warnings when goruby -v.

Wed Sep  3 21:07:30 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (BL_MIN_BYTE): defined.
	  (BL_MAX_BYTE): defined.
	  (BL_OFFSET): defined.
	  (BL_ACTION): defined.
	  (transcode_restartable0): use BL_MIN_BYTE, BL_MAX_BYTE and
	  BL_ACTION.

Wed Sep  3 20:58:30 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (BYTE_ADDR): defined.
	  (WORD_ADDR): ditto.
	  (BL_BASE): use BYTE_ADDR and WORD_ADDR.
	  (BL_INFO): use WORD_ADDR.

Wed Sep  3 20:47:31 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoder): new field: byte_array_length and
	  word_array_length.

	* tool/transcode-tblgen.rb (transcode_generated_code): generate
	  byte_array_length and word_array_length.

Wed Sep  3 20:34:10 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (ArrayCode): new class.
	  (ActionMap#gen_array_code): moved to ArrayCode.
	  (ActionMap#numelt_array_code): ditto.
	  (ActionMap#array_code_insert_at_last): ditto.
	  (TRANSCODE_GENERATED_BYTES_CODE): use ArrayCode.
	  (TRANSCODE_GENERATED_WORDS_CODE): ditto.

Wed Sep  3 20:08:35 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/japanese.trans: new file.

Wed Sep  3 20:04:33 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (ActionMap#gen_array_code): extracted from
	  generate_lookup_node.
	  (ActionMap#numelt_array_code): ditto.
	  (ActionMap#array_code_insert_at_last): ditto.

Wed Sep  3 20:01:01 2008  Tanaka Akira  <akr@fsij.org>

	* parse.y (parser_encoding_name): defined.
	  (parser_tokadd_mbchar): show encoding in the message of
	  "invalid multibyte char" error.

Wed Sep  3 19:28:04 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_insnhelper.c (vm_method_missing): C99.

Wed Sep  3 19:18:12 2008  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_thread.rb: fix test.
	   [ruby-dev:35960]

Wed Sep  3 17:48:32 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/make_transdb.rb: check $(srcdir)/enc/trans before
	  enc/trans.

	* enc/trans/make_transdb.rb: keep names_t.

Wed Sep  3 16:54:46 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/signal.h: removed.

	* common.mk, class.c, eval.c, eval_intern.h, file.c, gc.c, hash.c,
	  io.c, process.c, signal.c: vm_core.h: ditto.
	  Some unused external global variables are also removed.
	 (rb_prohibit_interrupt, rb_trap_immediate, rb_trap_pending,
	  rb_thread_critical)

	* ext/openssl/ossl_ssl.c, ext/openssl/ossl_x509store.c,
	  ext/readline/readline.c, ext/socket/depend,
	  ext/socket/socket.c: ditto.

Wed Sep  3 00:23:25 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_method_missing): copy arguments to allocated
	  memory from machine stack.  [ruby-dev:36064]

Tue Sep  2 22:20:26 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (base_element): removed.
	  (BYTE_LOOKUP): removed.
	  (BYTE_LOOKUP_BASE): don't cast.
	  (BYTE_LOOKUP_INFO): ditto.
	  (PType): unsigned int, instead of uintptr_t.
	  (rb_transcoding): change type of next_field, conv_tree_start and
	  word_array.

	* tool/transcode-tblgen.rb: generate word_array as array of unsigned
	  int.

	* transcode.c (transcode_restartable0): follow the above type change.

Tue Sep  2 21:22:22 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: add prefix for byte_array and word_array.

Tue Sep  2 20:57:14 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/make_transdb.rb: check foo.c only if foo.trans exists.

Tue Sep  2 19:19:55 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/make_transdb.rb: error message improved.

Tue Sep  2 14:05:50 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/trans/utf_16_32.trans (from_UTF_8): rename from to_UTF_16BE
	  because it was not collect.

Tue Sep  2 14:00:54 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* enc/emacs_mule.c (svn:executable): dropped executable bit.

	* enc/make_encdb.rb (svn:executable): ditto.

Tue Sep  2 12:58:58 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (COMPILERFLAG): new compiler flag to compile
	  enc/trans/japanese*.c.

Tue Sep  2 12:37:10 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/japanese_euc.trans: splitted from japanese.trans to avoid
	  compiler limitation.  reported by usa.

	* enc/trans/japanese_sjis.trans: ditto.

Tue Sep  2 12:31:24 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (miniruby): new target.

Tue Sep  2 11:47:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (struct load_arg): data is now st_table.

	* marshal.c (mark_load_arg): marks data and compat_tbl.

	* marshal.c (r_object0): no need to check if reentered.

	* marshal.c (marshal_load): make the wrapper with mark_load_arg.

Tue Sep  2 10:49:18 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (gettimeofday): easier calculation. use the definition
	  of the Gregorian calendar.

Tue Sep  2 10:33:12 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (distclean-golf): moved golf_prelude.c here from
	    distclean-local.
	  (GOLFPRELUDE): added.
	  (distclean-local): moved golf_prelude.c into distclean-golf.

Tue Sep  2 10:09:17 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (gettimeofday): calc tv_sec and tv_usec from system
	  time by myself. [ruby-dev:36084]

Tue Sep  2 04:00:37 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (o3): prevent sign extension on 64bit environment.
	  (o4): ditto.

Tue Sep  2 03:26:24 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: comment removed in generated code.

Tue Sep  2 03:16:42 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: define TRANSCODE_TABLE_INFO in generated
	  code.  use it in rb_transcoder.

	* enc/trans/newline.trans: use TRANSCODE_TABLE_INFO.

	* enc/trans/iso2022.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

Tue Sep  2 03:04:33 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: record infos and BYTE_LOOKUPs as index of
	  word_array to avoid relocation.

	* transcode.c (transcode_restartable0): add word_array to get infos
	  and BYTE_LOOKUPs.

	* transcode_data.h (BYTE_LOOKUP_INFO): change return type to
	  uintptr_t.

Tue Sep  2 02:48:30 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: don't need to cast offsets array.

Tue Sep  2 02:36:20 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: record offsets array as index of
	  byte_array to avoid relocation.

	* transcode.c (transcode_restartable0): add byte_array to get offsets
	  array.

	* transcode_data.h (BYTE_LOOKUP_BASE): change return type to
	  uintptr_t.
	  (rb_transcoder): add fields: byte_array, word_array and word_size.

	* enc/trans/newline.trans: follow rb_transcoder change.

	* enc/trans/iso2022.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

Tue Sep  2 02:05:14 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: make infos arrays and BYTE_LOOKUPs into
	  single array.

Tue Sep  2 01:47:44 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (clean-golf): added.
	  (distclean-golf): added.
	  (realclean-golf): added.
	  (clean): added clean-golf.
	  (distclean): added distclean-golf.
	  (realclean): added realclean-golf.

Tue Sep  2 01:31:45 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (realclean-local): added newline.c.

Tue Sep  2 01:19:15 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (BYTE_LOOKUP): change to uintptr_t array.
	  (BYTE_LOOKUP_BASE): follow the type change.
	  (BYTE_LOOKUP_INFO): ditto.
	  (PType): ditto.
	  (rb_transcoding): ditto.

	* tool/transcode-tblgen.rb: follow the type change.

	* transcode.c: ditto.

	* enc/trans/newline.trans: ditto.

	* enc/trans/iso2022.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

Mon Sep  1 23:32:46 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (BYTE_LOOKUP_BASE): abstract accessor for
	  BYTE_LOOKUP.
	  (BYTE_LOOKUP_INFO): ditto.

	* transcode.c (transcode_restartable0): use BYTE_LOOKUP_BASE and
	  BYTE_LOOKUP_INFO.

Mon Sep  1 23:14:25 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: gather infos arrays and BYTE_LOOKUPs.

Mon Sep  1 22:42:54 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mkmf.rb (distclean): added RM_RF conftest.dSYM.
	  Fixes distclean-ext problem on Mac OS X.
	  (RM_RF): added.

Mon Sep  1 22:37:06 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/rexml/document.rb: limit entity expansion.  Thanks, Luka
	  Treiber, Mitja Kolsek, and Michael Koziarski.

	* lib/rexml/entity.rb: ditto.

	* test/rexml/test_document.rb: ditto.

Mon Sep  1 22:20:22 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: make offsets arrays into single array.

Mon Sep  1 21:46:18 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: gather offsets arrays at top.

Mon Sep  1 21:09:04 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ./: removed rubyspec from svn:ignore subversion property.
	  rubyspec directory is no longer used.

	* spec: added mspec and rubyspec to svn:ignore.

Mon Sep  1 19:37:19 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: ValidEncoding['eucJP-ms'] defined.
	  "\xA2\xAF".encode("utf-8", "eucJP-ms") should raise
	  Encoding::ConversionUndefined, not Encoding::InvalidByteSequence.

Mon Sep  1 18:27:51 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (gettimeofday): shouldn't use mktime(3) because it's
	  buggy about handling summer time.
	  reported by Yoshikawa <yoshixool AT gmail.com> at [ruby-dev:36071]

Mon Sep  1 17:07:23 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/euc_jp.c (euc-jp-ms): euc-jp-ms is not an alias of EUC-JP
	  but eucJP-ms.

	* enc/trans/japanese.trans (eucJP-ms): eucJP-ms is the correct
	  name of the encoding in Ruby. [ruby-dev:36070]

Mon Sep  1 16:48:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/digest/md5/md5init.c (md5), ext/digest/rmd160/rmd160init.c
	  (rmd160) ext/digest/sha1/sha1init.c (sha1),
	  ext/digest/sha2/sha2init.c (sha256, sha384, sha512): constified.

Mon Sep  1 15:15:40 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.trans: fix mapping priority.
	  IBM extended is prior than NEC selected IBM.

Mon Sep  1 14:44:22 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/transcode-tblgen.rb (transcode_compile_tree): use the first
	  mapping when some mappings are given for a character.
	  [ruby-dev:36068]

	* tool/transcode-tblgen.rb: expandtab.

Mon Sep  1 14:40:18 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* README.EXT (Appendix A): fixed the name of class
	  Enumerator. Enumerable::Enumerator was renamed just
	  Enumerator at revision 18564.

	* README.EXT (Appendix A): ditto.

Mon Sep  1 14:37:58 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/transcode-tblgen.rb: set ERB source filename for error message.

Mon Sep  1 14:37:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend: transdb.c may not present.

Mon Sep  1 14:25:26 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.trans: fix Ruby 1.8 compatibility.

	* enc/trans/japanese.trans: fix mapping priority. [ruby-dev:36068]

Mon Sep  1 14:24:14 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_transcode.rb (test_windows_31j): added.

Mon Sep  1 14:00:04 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* README.EXT (Data-types): fixed for current status.
	  (Manipulating Ruby data): mentioned some more functions.
	  (Class/module definition): ditto.
	  (Global variables shared between C and Ruby):
	    fixed prototypes for the getter/setter's of global variables.
	  (Appendix A): mentioned some more files.

	* README.EXT.ja: ditto.

Mon Sep  1 11:31:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (copy_stream, fu_copy_stream0, copy_file): use
	  IO.copy_stream to get rid of extraneous conversion.

Mon Sep  1 02:55:15 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* strftime.c (rb_strftime): calc timezone offset by myself if system
	  doesn't provide timezone info.

Mon Sep  1 02:48:28 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: change "illegal" to "invalid".

Mon Sep  1 02:31:16 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (transcode_generated_code): defined for
	  generating table at once.
	  (transcode_tblgen): returns an empty string.
	  (transcode_generate_node): ditto.

	* enc/trans/newline.trans: use transcode_generated_code.

	* enc/trans/iso2022.trans: ditto.

	* enc/trans/single_byte.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

	* enc/trans/japanese.trans: ditto.

	* enc/trans/korean.trans: ditto.

Mon Sep  1 02:10:03 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (citrus_decode_mapsrc): print logging
	  message on STDERR.

Mon Sep  1 01:24:09 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/eucjp-tbl.rb: replace by previous Citrus maps.

	* enc/trans/sjis-tbl.rb: ditto.

Mon Sep  1 01:18:26 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/transcode-tblgen.rb: add table generator from Citrus maps.

	* enc/trans/japanese.trans: use Citrus maps.

	* enc/trans/CP: add maps from Citrus.

	* enc/trans/JIS: ditto.

	* test/ruby/test_transcode.rb: Shift_JIS and EUC-JP doesn't support
	  IBM extended characters.

Mon Sep  1 00:19:45 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (docs): removed a useless make target.
	  tool/makedoc.rb was removed at revision 13919.

Sun Aug 31 20:49:42 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (numeric_abs2): new.

Sun Aug 31 18:22:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_devel?): checks if the compiler works.

Sun Aug 31 18:02:41 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* Temporarily uses git://github.com/yugui/rubyspec.git
	  until specs for 1.9 is merged into
	  git://github.com/rubyspec/rubyspec.git.

Sun Aug 31 18:06:49 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode.c): set source_encoding and
	  destination_encoding as encoding object.
	  (ecerr_source_encoding): new method.
	  (ecerr_destination_encoding): ditto.

Sun Aug 31 17:58:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (Logging.log_open): opens in binary mode to get rid of
	  extra CR.

	* lib/mkmf.rb (try_func, try_var, have_struct_member),
	  (scalar_ptr_type?, scalar_type?): use MAIN_DOES_NOTHING.

	* lib/mkmf.rb (MAIN_DOES_NOTHING): defaults to ordinary main.

	* win32/Makefile.sub (config): for MAIN_DOES_NOTHING for wince.

Sun Aug 31 17:30:35 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/README (How to run): added.

Sun Aug 31 17:28:25 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* spec/default.mspec (config): added.

	* spec/default.mspec (target): replaced the built ruby
	  to runruby.rb.
	  Improved $LOAD_PATH on running specs.

	* spec/default.mspec (flags): ditto.

Sun Aug 31 17:16:07 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_econv_exception): rename instance variable names
	  for storing encoding names.
	  (ecerr_source_encoding_name): method renamed.
	  (ecerr_destination_encoding_name): ditto.

Sun Aug 31 16:57:36 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_putback): associate encoding to the result.

Sun Aug 31 16:43:56 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/intern.h: rename RB_UBF_DFL to
	  RUBY_UBF_IO and RUBY_UBF_PROCESS.
	  Because there is no default (universal) unblocking function.

	* ext/socket/socket.c, file.c, io.c, process.c, thread.c: ditto.

Sun Aug 31 16:42:23 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_insert_output): raise ArgumentError on failure.

Sun Aug 31 16:39:17 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_thread.rb: add a test.

Sun Aug 31 16:34:41 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/single_byte.trans (us_ascii_map): don't define 8bit bytes.

Sun Aug 31 14:27:27 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_last_error): new method.

Sun Aug 31 14:17:34 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_convert): make two arguments,
	  destination_byteoffset and destination_bytesize, optional.

Sun Aug 31 14:12:06 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_econv_exception): error message simplified.

Sun Aug 31 13:47:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/coverage/coverage.c (rb_mCoverage): removed unneeded static variable.

	* ext/socket/socket.c (unix_recv_io): ditto.

	* ext/socket/socket.c (mConst): ditto.

Sun Aug 31 13:45:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_ocsp.c (ossl_ocspres_initialize): fix for
	  initialization of r18168.

Sun Aug 31 13:42:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/eventids2.c (ripper_init_eventids2): use rb_intern_const.

	* ext/ripper/tools/generate.rb (generate_eventids1): ditto.

	* ext/ripper/tools/generate.rb (generate_eventids2_table): ditto.

Sun Aug 31 12:56:00 2008  Tanaka Akira  <akr@fsij.org>

	* ext/dl/mkcallback.rb (rb_dl_init_callbacks): fix indent.

Sun Aug 31 11:39:21 2008  Tanaka Akira  <akr@fsij.org>

	* ext/strscan/strscan.c (strscan_do_scan): fix usecnt decrement.

Sun Aug 31 04:38:47 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_putback): make max argument optional.

Sun Aug 31 04:35:21 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_putback): putback from last byte.

Sun Aug 31 04:27:04 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_putback): renamed from econv_primitive_putback.

Sun Aug 31 04:22:51 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_insert_output): renamed from
	  econv_primitive_insert_output.

Sun Aug 31 04:20:46 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_econv.rb: follow econv_primitive_errinfo change.

Sun Aug 31 03:44:24 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_errinfo): 5th element (partial_input)
	  removed from result.

Sun Aug 31 01:53:31 2008  Tanaka Akira  <akr@fsij.org>

	* ext/dl/mkcallback.rb: split callback.h to callback-[0-9].c to reduce
	  memory consumption on compilation.  [ruby-dev:31898]

	* ext/dl/depend: add dependency for callback-[0-9].[co].

Sun Aug 31 01:27:46 2008  Tanaka Akira  <akr@fsij.org>

	* ext/dl/mkcallback.rb (foreach_proc_entry): extracted.
	  (gencallback): ditto.
	  (gen_push_proc_ary): ditto.
	  (gen_push_addr_ary): ditto.

Sat Aug 30 23:51:01 2008  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_tuplebag.rb (test_has_expires_eh): fix failures
	  [ruby-dev:35937].

Sat Aug 30 23:38:00 2008  Tanaka Akira  <akr@fsij.org>

	* ext/dl/test/test_import.rb: fix character code.

	* ext/dl/test/test_func.rb: ditto.

Sat Aug 30 22:23:31 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: added a static variable for nurat_to_f.

Sat Aug 30 20:05:41 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_open, rb_w32_read, rb_w32_write): fallback to
	  MSVCRT if text mode is specified. this case will not be used from
	  ruby itself.

Sat Aug 30 19:49:38 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): EOF is not error.
	  ref [ruby-dev:36050]

Sat Aug 30 18:17:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (struct token_info): constified.

	* parse.y (token_info_get_column, token_info_has_nonspaces),
	  (token_info_push, token_info_pop): constified.

Sat Aug 30 15:43:03 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/openssl/ossl_config.c (Init_ossl_config): memory leak fixed.
	  a patch <shinichiro.hamaji at gmail.com> in [ruby-dev:35880].

	* ext/openssl/ossl_x509ext.c (ossl_x509ext_set_value): ditto.

	* ext/strscan/strscan.c (strscan_do_scan): ditto.

Sat Aug 30 14:58:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_x509ext.c (ossl_x509ext_initialize): fix for
	  initialization of r18168.

Sat Aug 30 14:47:30 2008  Tanaka Akira  <akr@fsij.org>

	* ext/dl/mkcallback.rb: fix continuation line detection.

Sat Aug 30 14:39:51 2008  Tanaka Akira  <akr@fsij.org>

	* ext/dl/mkcallback.rb (rb_dl_init_callbacks): avoid GC problem which
	  is caused by 'GC.stress=true; require "dl"'.

Sat Aug 30 11:54:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (token_info_push): -w warns indentation level mismatch.
	  based on a patch from Yukina Yamano presented at RubyKaigi'07.
	  See <http://jp.rubyist.net/RubyKaigi2007/Log0609-LT06.html> and
	  <http://www.logic-junction.com/products/rubyend.html> (Japanese).

Sat Aug 30 10:46:44 2008  Koichi Sasada  <ko1@atdot.net>

	* ext/iconv/iconv.c: remove include pragma for "ruby/intern.h".

Sat Aug 30 10:43:03 2008  Koichi Sasada  <ko1@atdot.net>

	* parse.y: remove include pragma for "ruby/intern.h".

Sat Aug 30 10:41:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake.rb (Rake::Application#help): fix for OPTIONAL_ARGUMENT and
	  multiple short options.  [ruby-dev:36051]

Sat Aug 30 08:59:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_file_s_absolute_path),
	  (rb_file_absolute_path): prototyped.

Sat Aug 30 08:09:36 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_compatible_p): use TYPE not BUILTIN_TYPE.
	  [ruby-dev:36048]

Sat Aug 30 07:48:48 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_compatible_p): add SPECIAL_CONST_P check.
	  [ruby-dev:36048]

	* test/ruby/test_m17n.rb (test_compatible): fix test.

Sat Aug 30 02:48:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_freeze): update rdoc to mention RuntimeError
	  (not TypeError any longer) would be raised.  [ruby-dev:35982]

Sat Aug 30 01:55:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigdivmod): remove redundant code.  a patch from
	  TOYOFUKU Chikanobu <nobu_toyofuku at nifty.com> in [ruby-dev:36044].

Sat Aug 30 01:37:20 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI#initialize): remove unused constants.  a patch
	  from Takeyuki Fujioka in [ruby-dev:36046].

Fri Aug 29 22:29:41 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c ({nucomp,numeric}_rect): new.

	* complex.c: added some aliases
	  (::rectangular, ::rect, #rectangular, #rect, #phase,
	  #magnitude).

	* complex.c (string_to_c_internal): should not strip any null
	  bytes.

	* rational.c (string_to_r_internal): ditto.

	* rational.c (i_gcd): reverted to nurat 0.0.2's one.

	* numeric.c: added an alias (#magnitude).

	* bignum.c: ditto.

	* test/ruby/test_complex.rb: added assertions.

	* test/ruby/test_rational.rb: ditto.

Fri Aug 29 19:46:02 2008  Koichi Sasada  <ko1@atdot.net>

	* gc.c, include/ruby/ruby.h: rename T_DEFERRED to T_ZOMBIE.

Fri Aug 29 18:22:27 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_compatible_p): raise TypeError when argument is not
	  String nor Regexp.

Fri Aug 29 18:20:56 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_index_m): only regexp uses byte offset.

	* string.c (rb_str_rindex_m): ditto.

Fri Aug 29 16:48:34 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_call_method): copy arguments to allocated
	  memory from machine stack.  [ruby-dev:36028]

	* KNOWNBUGS.rb, bootstraptest/test_method.rb: move fixed test.

Fri Aug 29 12:19:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_x509attr.c (ossl_x509attr_initialize): fix for
	  initialization of r18168.

	* ext/openssl/ossl_ocsp.c (ossl_ocspreq_initialize): ditto.

	* ext/openssl/ossl_x509name.c (ossl_x509name_initialize): ditto.

Fri Aug 29 11:04:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): ASCII compatible string and US-ASCII
	  regexp is compatible. [ruby-dev:36033]

	* string.c (rb_str_index_m): second argument is position of character.
	  by usa. [ruby-dev:36033]

	* string.c (rb_str_rindex_m): ditto.

Fri Aug 29 04:47:49 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read, rb_w32_write): more accurate handling
	  of wait result.

Fri Aug 29 02:59:35 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_finish): new method.

Fri Aug 29 02:45:29 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_convert): new method.

Fri Aug 29 02:38:14 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_convert): accept nil as
	  destination_bytesize for unlimited destination size.

Fri Aug 29 02:11:46 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_convert): accept nil as input for empty
	  input.

Fri Aug 29 02:03:56 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): supported %s and %P.

	* time.c (time_strftime): ditto.

	* test/ruby/test_time.rb (test_strftime): ditto.

Fri Aug 29 01:57:58 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (sym_invalid_byte_sequence): new variable.
	  (sym_undefined_conversion): ditto.
	  (sym_destination_buffer_full): ditto.
	  (sym_source_buffer_empty): ditto.
	  (sym_finished): ditto.
	  (sym_output_followed_by_input): ditto.
	  (sym_incomplete_input): ditto.
	  (econv_result_to_symbol): use above variables.
	  (Init_transcode): initialize above variables.

Fri Aug 29 00:53:40 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): fixed a bug of padding.

	* test/ruby/test_time.rb: ditto.

Fri Aug 29 00:19:54 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (set_pioinfo_extra): use MSVCRT's open() and close().

Fri Aug 29 00:03:13 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* file.c (file_expand_path): check invalid access.

Thu Aug 28 23:55:50 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): Time.mktime(2000).strftime("%-S") should
	  return "0", not "".

	* test/ruby/test_time.rb: ditto.

Thu Aug 28 23:55:22 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_time.rb: suppress warning during test.

Thu Aug 28 23:50:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_time.rb (test_strftime): make test for %a independent
	  from local timezone.  [ruby-dev:35992]

Thu Aug 28 23:39:49 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (rb_str_shared_replace): remove corrupt noembed string
	  which causes SEGV.  [ruby-dev:35989]

Thu Aug 28 23:36:15 2008  Tanaka Akira  <akr@fsij.org>

	* common.mk: dependency updated.

Thu Aug 28 23:28:57 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* KNOWNBUGS.rb: add a test.  see [ruby-dev:36028]

Thu Aug 28 21:43:05 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (rb_w32_open): overlapped file
	  I/O support.

	* win32/win32.c, include/ruby/win32.h (rb_w32_pipe): overlapped pipe
	  I/O support.

	* win32/win32.c (rb_w32_read, rb_w32_write): overlapped I/O support to
	  enable canceling I/O.

	* thread_win32.c (ubf_handle): remove workaround.

Thu Aug 28 20:22:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_insnhelper.c (vm_yield_setup_args): object with to_ary should
	  behave like array.  a patch from Yusuke Endoh  <mame at tsg.ne.jp>
	  in [ruby-dev:35988].  [ruby-dev:35977]

	* object.c (convert_type): call less rb_intern() less frequently
	  by using cache structure.

	* vm_method.c (rb_method_node): fail earlier if no method found.

Thu Aug 28 19:04:50 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bootstraptest/test_io.rb: no need to create real file.

Thu Aug 28 09:26:53 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/cgi/test_cgi_multipart.rb: add test for multipart.
	  Patch by Takeyuki Fujioka. [ruby-dev:36014]
	  From CGIAlt http://cgialt.rubyforge.org/

Thu Aug 28 09:22:01 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/cgi/test_cgi_modruby.rb: add test for mod_ruby adaptor.
	  Patch by Takeyuki Fujioka. [ruby-dev:36013]
	  From CGIAlt http://cgialt.rubyforge.org/

Thu Aug 28 09:17:10 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/cgi/test_cgi_header.rb: add test for CGI::Header.
	  Patch by Takeyuki Fujioka. [ruby-dev:36010] [ruby-dev:36011]
	  From CGIAlt http://cgialt.rubyforge.org/

Thu Aug 28 02:16:49 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): refcnt field removed.
	  (MakeOpenFile): refcnt initialization removed.

	* io.c (rb_io_fptr_finalize): don't check refcnt.
	  (rb_io_close_read): don't use refcnt.

Thu Aug 28 00:07:59 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_initialize): don't accept IO object.  [ruby-dev:35895]

Wed Aug 27 23:28:51 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_invoke): WIN32OLE#[] and WIN32OLE#[]=
	  accepts number argument.

	* test/win32ole/test_win32ole.rb: ditto.

Wed Aug 27 14:45:34 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/cgi/test_cgi_core.rb: add core test.
	  Patch by Takeyuki Fujioka. [ruby-dev:36001] [ruby-dev:36002]
	  From CGIAlt http://cgialt.rubyforge.org/

Wed Aug 27 10:34:42 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/cgi.rb (CGI::Cookie): remove delegate.
	  Patch by Takeyuki Fujioka. [ruby-dev:35995]

	* test/cgi/test_cgi_cookie.rb: added for above.
	  Patch by Takeyuki Fujioka. [ruby-dev:35996]
	  From CGIAlt http://cgialt.rubyforge.org/

Wed Aug 27 01:13:54 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_loop): simplified.

Wed Aug 27 01:03:23 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_result_t): enumeration constant:
	  econv_incomplete_input.

	* io.c (finish_writeconv): check econv_incomplete_input.

	* transcode.c (transcode_restartable0): return econv_incomplete_input
	  for unexpected end of source buffer.
	  (trans_sweep): check econv_incomplete_input.
	  (rb_trans_conv): ditto.
	  (rb_econv_convert0): ditto.
	  (rb_econv_convert): ditto.
	  (transcode_loop): ditto.
	  (make_econv_exception): change message for econv_incomplete_input.
	  (econv_result_to_symbol): return :incomplete_input for
	  econv_incomplete_input.
	  (ecerr_incomplete_input): new method.

Wed Aug 27 00:05:55 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): rename crbuf to cbuf.

	* io.c: follow the renaming.

Tue Aug 26 23:52:24 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_elem_t): move to transcode.c
	  (rb_econv_t): defined as an incomplete type.

	* transcode.c (rb_econv_elem_t): moved from encoding.h.
	  (rb_econv_t): complete type defined.

Tue Aug 26 22:44:12 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* time.c (time_asctime): workaround for MSVCRT's bug.
	  based on a patch from wanabe <s.wanabe AT gmail.com> at
	  [ruby-dev:35831] and a suggestion by KIMURA Koichi
	  <kbk AT kt.rim.or.jp> at [ruby-dev:35832]
	  fixed [ruby-dev:35555]

Tue Aug 26 21:53:56 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): disable newline conversion for ASCII
	  incompatible encodings.
	  (str_transcode0): don't need disable newline conversion here.

Tue Aug 26 21:44:39 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_binmode): binmode is effective only once.

Tue Aug 26 19:43:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_file_s_expand_path): new class method for class File.

	* file.c (file_expand_path): add absolute_path handling (no ~user
	  expansion).  [ruby-core:18319]

Tue Aug 26 19:27:54 2008  Akinori MUSHA  <knu@iDaemons.org>

	* test/ruby/test_enum.rb (TestEnumerable#test_each_with_object):
	  Add a test for Enumerable#each_with_object.

Tue Aug 26 19:25:44 2008  Akinori MUSHA  <knu@iDaemons.org>

	* test/ruby/test_enumerator.rb (TestEnumerator#test_with_object):
	  Add (back) the test for Enumerator#with_object.

Tue Aug 26 16:16:43 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/cgi/test_cgi_tag_helper.rb: add more tests for html3.
	  Patch by Takeyuki Fujioka. [ruby-dev:35975]
	  From CGIAlt http://cgialt.rubyforge.org/

Tue Aug 26 14:43:10 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c: Activate Enumerator#with_object and add
	  Enumerable#each_with_object. [experimental]

Tue Aug 26 14:38:32 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_initialize),
	  test/ruby/test_enumerator.rb: Add an ability to generate an
	  enumerator from a block. [experimental] [ruby-dev:35903]

Tue Aug 26 13:25:25 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb: added test_euc_jp
	  (contributed by Yoshihiro Kambayashi)

Tue Aug 26 11:54:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/cgi/test_cgi_tag_helper.rb: added by Takeyuki Fujioka.
	  [ruby-dev:35971]

Tue Aug 26 11:33:30 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/cgi.rb (nOE_element_def): fix error when cascade methods which
	  don't have arguments. Patch by Takeyuki Fujioka. [ruby-dev:35964]

	* lib/cgi.rb (blockquote): String#collect (this depends on
	  String#each) is no longer exists.
	  Patch by Takeyuki Fujioka. [ruby-dev:35946]

	* lib/cgi.rb (blockquote): ditto.

Tue Aug 26 03:06:48 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (make_writeconv): copy invalid/undef flags.

Tue Aug 26 02:47:08 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (dist): tool/make-snapshot is executable.

	* tool/make-snapshot (package): supported release numbers 1.9.0-x.

Tue Aug 26 02:43:50 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): new field: writeconv_pre_opts.

	* io.c (make_writeconv): initialize writeconv_pre_opts.
	  (io_fwrite): use writeconv_pre_opts.

Tue Aug 26 01:48:31 2008  Tanaka Akira  <akr@fsij.org>

	* io.c: test _WIN32 for CRLF platform.  (cygwin defines O_BINARY.)

Tue Aug 26 01:29:26 2008  Tanaka Akira  <akr@fsij.org>

	* io.c: force CRLF handling if RUBY_TEST_CRLF_ENVIRONMENT is defined.
	  This is only for testing.

Tue Aug 26 01:26:31 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (str_transcode0): disable newline conversion for ASCII
	  incompatible encoding.

Tue Aug 26 00:55:46 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (str_transcode0): don't short cut for newline conversion.

Tue Aug 26 00:36:01 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_fwrite): add TEXTMODE_NEWLINE_ENCODER to option for
	  rb_str_transcode.

Tue Aug 26 00:24:23 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_econv_exception): show readagain part for invalid
	  byte sequence exception.  store the part as an instance variable.
	  (ecerr_readagain_bytes): new method to access the readagain part.

Tue Aug 26 00:02:49 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (VpMult): fix double free.

Mon Aug 25 23:59:36 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): make last_tc NULL if there are only
	  additional transcoders.
	  (econv_description): extracted from rb_econv_open_exc.
	  (rb_econv_open_exc): use econv_description.
	  (econv_inspect): use econv_description.

Mon Aug 25 23:56:42 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32.c (init_stdhandle): set binmode.

Mon Aug 25 23:38:17 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb(strftime): %[LN] can print with given
	  arbitrary precision.

	* lib/date/format.rb(strftime): optional flags and filed width
	  should also affect %[nt].

Mon Aug 25 23:01:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (defined_expr): default defined? should return
	  "expression" without evaluating the expression.  [ruby-dev:35967]

Mon Aug 25 22:46:01 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_thread.rb (test_status_and_stop_p): reduce the risk
	  of race condition.

Mon Aug 25 22:39:57 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/irb/extend-command.rb (def_extend_command): check number of
	  arguments.  [ruby-dev:35074]

	* lib/irb/ext/multi-irb.rb (search): check if a corresponding job is
	  found.  [ruby-dev:35074]

Mon Aug 25 22:29:13 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_io.rb (test_dup): fix typo.  see [ruby-dev:35958]

Mon Aug 25 22:02:35 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open_by_transcoder_entries): initialize
	  last_error.  num_trans may be zero.
	  (rb_econv_convert0): num_trans may be zero.
	  (rb_econv_putbackable): ditto.
	  (rb_econv_putback): ditto.
	  (rb_econv_convert): input_ptr and output_ptr may be NULL.

Mon Aug 25 19:05:27 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (defined_expr): should handle NODE_{AND,OR} as
	  "expression".  [ruby-dev:35951]

Mon Aug 25 17:36:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_io_ungetbyte): added prototype.

	* io.c (rb_io_gets): use rb_io_getline_1 for unget buffer.

	* ruby.c (load_file): use rb_io_ungetbyte.

	* transcode.c (rb_econv_substr_append): fix for buffer overrun.

	* win32/enc-setup.mak (BUILTIN_TRANSOBJS): added.

Mon Aug 25 14:22:21 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* parse.y (YYSTYPE): struct RVarmap has been no longer
	  defined.
	  see also r11717 by matz.

Mon Aug 25 10:42:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (rb_econv_open_exc): constified.

Mon Aug 25 07:10:21 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/emacs_mule.c: fix ctype.

Mon Aug 25 00:52:31 2008  Tanaka Akira  <akr@fsij.org>

	* configure.in (BUILTIN_TRANSSRCS): defined.
	  (BUILTIN_TRANSOBJS): defined.

	* enc/Makefile.in (BUILTIN_TRANSES): defined.

	* enc/make_encmake.rb (BUILTIN_TRANSES): defined.

	* enc/depend: don't generate rules for builtin transcoders.

	* common.mk (COMMONOBJS): add BUILTIN_TRANSOBJS.
	  (enc.mk): pass BUILTIN_TRANSOBJS.
	  (newline.c): new rule.
	  (newline.$(OBJEXT)): new rule.
	  (srcs): newline.c added.

	* Makefile.in (BUILTIN_TRANSSRCS): defined.
	  (BUILTIN_TRANSOBJS): defined.

	* transcode.c (Init_transcode): call Init_newline.

Mon Aug 25 00:11:02 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (declare_transcoder): arguments order changed.
	  (rb_declare_transcoder): call declare_transcoder just once.

Sun Aug 24 19:48:46 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_t): use rb_econv_option_t.

	* transcode.c: follow the rb_econv_t change.

Sun Aug 24 19:40:13 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_init_copy): copy encs.

Sun Aug 24 19:17:31 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_open): add an argument: vperm.
	  (open_key_args): call rb_io_open with perm.

Sun Aug 24 19:11:07 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (sym_invalid): removed.
	  (sym_undef): removed.
	  (sym_ignore): removed.
	  (sym_replace): removed.

Sun Aug 24 19:07:17 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_reopen): initialize fptr->encs.opts.

Sun Aug 24 18:37:42 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_s_pipe): accept optional hash.
	  (rb_io_set_encoding): ditto.
	  (rb_io_extract_modeenc): use rb_econv_opts to initialize
	  ecopts.
	  (rb_file_open_generic): ditto.
	  (rb_file_open_internal): ditto.
	  (io_encoding_set): new argument: opt.
	  (argf_set_encoding): copy fptr->encs.opts to argf_ecopts.

	* transcode.c (rb_econv_opts): accept Qnil for initialization.

Sun Aug 24 18:10:08 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_enc_t): add opts field.
	  (FMODE_INVALID_MASK): removed.
	  (FMODE_INVALID_IGNORE): ditto.
	  (FMODE_INVALID_REPLACE): ditto.
	  (FMODE_UNDEF_MASK): ditto.
	  (FMODE_UNDEF_IGNORE): ditto.
	  (FMODE_UNDEF_REPLACE): ditto.
	  (MakeOpenFile): initialize the opts field.

	* io.c (make_writeconv): use the opts field.
	  (io_fwrite): ditto.
	  (make_readconv): ditto.
	  (argf_ecopts): new macro.
	  (rb_io_extract_modeenc): fill the opts field.
	  (argf_next_argv): ditto.
	  (rb_file_open_generic): initialize the opts field.
	  (rb_file_open_internal): ditto.
	  (io_encoding_set): ditto.
	  (argf_set_encoding): ditto.

Sun Aug 24 18:02:14 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (struct argf): use struct rb_io_enc_t.
	  (argf_enc): follow the struct argf change.
	  (argf_enc2): ditto.

Sun Aug 24 17:36:21 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_str_transcode): make 3rd argument
	  rb_econv_option_t*.

	* transcode.c (transcode_loop): take rb_econv_option_t* as a argument.
	  (str_transcode0): ditto.
	  (str_transcode): make rb_econv_option_t and call str_transcode0 with
	  it.
	  (rb_str_transcode): take rb_econv_option_t*.

	* io.c (io_fwrite): follow the rb_str_transcode change.

Sun Aug 24 16:47:32 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): make enc and enc2 as struct
	  rb_io_enc_t;

	* io.c: follow the structure change.
	  (convconfig_t): defined by rb_io_enc_t.

Sun Aug 24 16:19:25 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_opts): declared.

	* transcode.c (rb_econv_opts): defined.

	* io.c (rb_io_extract_modeenc): use rb_econv_opts.

Sun Aug 24 16:06:30 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_option_t): defined.
	  (rb_econv_open): 3rd arg changed.
	  (rb_econv_open_exc): ditto.

	* io.c (make_writeconv): use rb_econv_option_t.
	  (make_readconv): ditto.
	  (rb_econv_open): take rb_econv_option_t for options.
	  (rb_econv_open_exc): ditto.
	  (transcode_loop): use rb_econv_option_t.
	  (econv_init): use rb_econv_option_t.

Sun Aug 24 15:43:41 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_substr_append): associate dst with destination
	  encoding when dst is created.

Sun Aug 24 15:21:28 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_str_transcode): add ecflags argument.

	* transcode.c (econv_opts): extracted from str_transcode.
	  (str_transcode_enc_args): extracted from str_transcode.
	  (str_transcode0): extracted from str_transcode.
	  (str_transcode): use econv_opts, str_transcode_enc_args,
	  str_transcode0.
	  (rb_str_transcode): call str_transcode0.
	  (econv_primitive_insert_output): give the additional argument for
	  rb_str_transcode.

	* io.c (make_writeconv): use invalid/undef flags.
	  (io_fwrite): ditto.
	  (rb_scan_open_args): give the additional argument for
	  rb_str_transcode.

Sun Aug 24 13:27:42 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (str_transcode): check last hash only if 0 < argc.

Sun Aug 24 12:22:15 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_substr_append): renamed from
	  rb_econv_string.
	  (rb_econv_str_convert): declared.
	  (rb_econv_substr_convert): declared.
	  (rb_econv_str_append): declared.

	* io.c (io_fwrite): use rb_econv_str_convert instead of
	  rb_econv_string.

	* transcode.c (rb_econv_substr_append): renamed from rb_econv_string.
	  (rb_econv_str_append): new function.
	  (rb_econv_substr_convert): ditto.
	  (rb_econv_str_convert): ditto.

Sun Aug 24 12:15:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP#urlencode): str[0] returns char in 1.9.
	  Patch by Junegunn Choi [ruby-core:18368]

Sun Aug 24 12:02:39 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): return NULL on error.

Sun Aug 24 11:40:38 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_open_exc): declared.

	* transcode.c (rb_eNoConverter): new exception.
	  (rb_econv_open_exc): new function.
	  (transcode_loop): use rb_econv_open_exc.

	* io.c (make_writeconv): use rb_econv_open_exc.
	  (make_readconv): ditto.

Sun Aug 24 11:26:54 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/cgi.rb (CGI::unescapeHTML): consider ISO-8859-1.
	  [ruby-dev:35936]

Sun Aug 24 10:55:00 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/emacs_mule.c: support Emacs/Mule internal encoding.

Sun Aug 24 08:03:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* strftime.c (daylight, timezone): not provided as dllexport on cygwin,
	  right now.

Sun Aug 24 06:39:05 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/cgi.rb (CGI::unescapeHTML): more encoding sensible unescaping.
	  [ruby-dev:35936]

Sun Aug 24 04:23:19 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_compatible_p): raise TypeError when argument is Encoding.

Sat Aug 23 23:25:47 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/cgi.rb (CGI#out): remove auto encoding conversion and set
	  LANGUAGE. [ruby-dev:35922]

Sat Aug 23 20:01:29 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_process.rb (TestProcess#test_rlimit_value):
	  add Errno::EINVAL. [ruby-dev:35900]

Sat Aug 23 18:29:29 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_scan_open_args): use pop_last_hash.

Sat Aug 23 16:59:42 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (FMODE_INVALID_MASK): defined.
	  (FMODE_INVALID_IGNORE): defined.
	  (FMODE_INVALID_REPLACE): defined.
	  (FMODE_UNDEF_MASK): defined.
	  (FMODE_UNDEF_IGNORE): defined.
	  (FMODE_UNDEF_REPLACE): defined.

	* io.c (sym_invalid): defined.
	  (sym_undef): defined.
	  (sym_ignore): defined.
	  (sym_replace): defined.
	  (make_readconv): specify ECONV_INVALID_* and ECONV_UNDEF_* if
	  FMODE_INVALID_* and FMODE_UNDEF_* is set.
	  (rb_io_extract_modeenc): check {:invalid, :undef} => {:replace,
	  :ignore} for FMODE_INVALID_* and FMODE_UNDEF_*.

Sat Aug 23 17:06:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* strftime.c (rb_strftime): support more flags.

Sat Aug 23 15:14:10 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_opts.h: enable "OPT_TRACE_INSTRUCTION" on default.

Sat Aug 23 14:59:32 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_INVALID_MASK): defined.
	  (ECONV_INVALID_IGNORE): defined.
	  (ECONV_INVALID_REPLACE): defined.
	  (ECONV_UNDEF_MASK): defined.
	  (ECONV_UNDEF_IGNORE): defined.
	  (ECONV_UNDEF_REPLACE): defined.

	* transcode.c (INVALID_IGNORE): removed.
	  (INVALID_REPLACE): removed.
	  (UNDEF_IGNORE): removed.
	  (UNDEF_REPLACE): removed.
	  (rb_econv_convert0): renamed from rb_econv_convert.
	  (rb_econv_convert): defined to call rb_econv_convert0 with
	  replace/ignore behavior moved from transcode_loop.
	  (transcode_loop): replace/ignore behavior removed.

Sat Aug 23 11:23:05 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_extract_modeenc): check :textmode and :binmode in option
	  hash.

Sat Aug 23 10:48:56 2008  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (pty_getpty): follow rb_io_t's path -> pathv change.

Sat Aug 23 10:42:52 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (check_pipe_command): extracted from rb_f_open and rb_io_open.
	  (rb_f_open): use check_pipe_command.
	  (rb_io_open): ditto.

Sat Aug 23 10:13:00 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (read_all): fptr->enc2 is 0 if no conversion.
	  (rb_io_getline_fast): ditto.
	  (io_getc): ditto.

Sat Aug 23 09:45:35 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): remove path field and add pathv field.
	  (MakeOpenFile): initialize pathv as Qnil.

	* gc.c: mark pathv field in T_FILE.

	* io.c: follow the rb_io_t field change.

	* file.c: ditto.

	* ext/socket/socket.c: ditto.

Sat Aug 23 01:42:22 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (FMODE_TEXTMODE): defined.

	* include/ruby/encoding.h (rb_econv_t): new field: flags.
	  (rb_econv_binmode): declared.

	* io.c (io_unread): text mode hack removed.
	  (NEED_NEWLINE_DECODER): defined.
	  (NEED_NEWLINE_ENCODER): defined.
	  (NEED_READCONV): defined.
	  (NEED_WRITECONV): defined.
	  (TEXTMODE_NEWLINE_ENCODER): defined for windows.
	  (make_writeconv): setup converter with TEXTMODE_NEWLINE_ENCODER for
	  text mode.
	  (io_fwrite): use NEED_WRITECONV.  character code conversion is
	  disabled if fptr->writeconv_stateless is nil.
	  (make_readconv): setup converter with
	  ECONV_UNIVERSAL_NEWLINE_DECODER for text mode.
	  (read_all): use NEED_READCONV.
	  (appendline): use NEED_READCONV.
	  (rb_io_getline_1): use NEED_READCONV.
	  (io_getc): use NEED_READCONV.
	  (rb_io_ungetc): use NEED_READCONV.
	  (rb_io_binmode): OS-level text mode test removed.  call
	  rb_econv_binmode.
	  (rb_io_binmode_m): call rb_io_binmode_m with write_io as well.
	  (rb_io_flags_mode): return mode string including "t".
	  (rb_io_mode_flags): detect "t" for text mode.
	  (rb_sysopen): always specify O_BINARY.

	* transcode.c (rb_econv_open_by_transcoder_entries): initialize flags.
	  (rb_econv_open): if source and destination encoding is
	  both empty string, open newline converter.  last_tc will be NULL in
	  this case.
	  (rb_econv_encoding_to_insert_output): last_tc may be NULL now.
	  (rb_econv_string): ditto.
	  (output_replacement_character): ditto.
	  (transcode_loop): ditto.
	  (econv_init): ditto.
	  (econv_inspect): ditto.
	  (rb_econv_binmode): new function.

Fri Aug 22 21:18:40 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_div): now behaves as quo.

	* complex.c (nucomp_s_generic_p): has been removed.

	* complex.c (nucomp_to_s): adopts new form.

	* complex.c (nucomp_inspect): ditto.

	* complex.c (string_to_c_internal): ditto and supports polar form.

	* complex.c (rb_complex_polar): new.

	* rational.c (nurat_to_s): do not canonicalize.

	* rational.c (nurat_inspect): adopts new form.

	* rational.c (string_to_r_internal): ditto.

	* include/ruby/intern.h: added a declaration.

	* lib/complex.rb: added an obsolete class method.

	* lib/cmath.rb: use scalar? instead of generic?.

Fri Aug 22 20:06:46 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/webrick/server.rb (WEBrick::GenericServer#shutdown):
	  rescue Errno::ENOTCONN and close. [ruby-dev:35896]

	* test/openssl/test_ssl.rb (OpenSSL#start_server): ditto.
	  [ruby-dev:35897]

	* lib/net/imap.rb (Net::IMAP#disconnect): ditto. [ruby-dev:35898]

Fri Aug 22 19:58:27 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: no need to require the "lib/rational.rb" any more.

Fri Aug 22 15:47:38 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/cgi.rb: use bytesize instead of size/length.

Fri Aug 22 14:28:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* strftime.c (rb_strftime): supported flags and precision for most
	  conversions.  [ruby-dev:35906]

Fri Aug 22 14:04:04 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb: test_shift_jis:
	  fixed comment strings (see r18291)

Fri Aug 22 12:41:47 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_pid): use PIDT2NUM.

Fri Aug 22 11:36:31 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (dir_enc_str_new): set US-ASCII to the path
	  when the path is 7bit string and encoding is ASCII compatible.

	* dir.c (push_glob): set file system encoding when argument encoding
	  is US-ASCII.

Fri Aug 22 11:30:38 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (dir_enc_str_new): renamed from dir_enc_str.

	* dir.c (dir_read): use dir_enc_str_new.

	* dir.c (dir_each): ditto.

	* dir.c (push_pattern): ditto.

Fri Aug 22 11:29:10 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: remove config.h dependency.

Fri Aug 22 10:52:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (gmtime_r): check if reentrant versions are available.

	* time.c (IF_HAVE_GMTIME_R, ASCTIME, GMTIME, LOCALTIME): use reentrant
	  versions if available.

Fri Aug 22 05:29:17 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (INT2NUM): just use a simple macro on LP64.
	  (UINT2NUM): ditto.

Fri Aug 22 05:10:07 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_file_open_generic): take filename as a VALUE.
	  (rb_file_open_internal): ditto.
	  (rb_io_open): ditto.
	  (rb_file_open): pass filename as a VALUE to rb_file_open_internal.
	  (rb_open_file): pass filename as a VALUE to rb_file_open_generic.
	  (open_key_args): pass filename as a VALUE to rb_io_open.

Fri Aug 22 04:33:56 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h: fix previous change for LP64.

Fri Aug 22 03:19:41 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (NUM2LONG): make it inline function to evaluate
	  the argument only once.
	  `t = Object.new; def t.*(x) p x; 0 end; p Time.at(0, t)' did print x
	  twice.
	  (NUM2INT): ditto.
	  (NUM2LL): ditto.
	  (INT2NUM): make it inline function.
	  (LONG2NUM): ditto.
	  (UINT2NUM): ditto.
	  (ULONG2NUM): ditto.

Fri Aug 22 03:03:22 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_s_sysopen): mode can be a Bignum.

Fri Aug 22 02:57:03 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_extract_modeenc): notify coerced to caller.
	  (rb_io_initialize): mode may be a Bignum.

Fri Aug 22 02:42:35 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_extract_modeenc): use rb_check_to_integer to test
	  integer.

Fri Aug 22 02:25:04 2008  Tanaka Akira  <akr@fsij.org>

	* iseq.c (iseq_inspect): don't raise on uninitialized object.
	  show real class name.

Fri Aug 22 02:08:58 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_initialize): accept hash argument.

Thu Aug 21 23:51:51 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): supported %F and %<precision>N.
	  reverted config.h to ruby.h for Windows.

	* test/ruby/test_time.rb (TestTime::test_strftime): added tests
	  for %F and %N.

	* time.c: documented %F and %N.

Thu Aug 21 20:23:26 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_m17n_comb.rb (TestM17NComb#test_str_crypt): add
	  key and salt to error message.

Thu Aug 21 19:20:25 2008  Tanaka Akira  <akr@fsij.org>

	* file.c (rb_stat_inspect): don't raise if self is not initialized.

Thu Aug 21 19:17:02 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (pst_pid): use rb_attr_get to avoid warning on
	  Process::Status.allocate.pid.
	  (pst_inspect): don't raise if self is not initialized.

Thu Aug 21 19:05:40 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_extract_encoding_option): if internal encoding is not
	  specified, enc is external encoding.

Thu Aug 21 14:22:50 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c: include ruby/config.h instead of ruby/ruby.h.

	* common.mk: removed the old rule for missing/strftime.c.

Thu Aug 21 09:29:01 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c (rb_strftime): return "UTC" instead of "GMT".

	* test/ruby/test_time.rb (test_strftime): ditto.

Thu Aug 21 07:59:04 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/iconv/test_option.rb (test_ignore_option): skip if iconv
	  doesn't have transliterate.

	* test/iconv/test_option.rb (test_translit_option): ditto.

Thu Aug 21 06:12:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/scanf.rb (Scanf::FormatSpecifier#initialize): %i should accept
	  single digit decimal.  [ruby-core:18355]

Thu Aug 21 06:02:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (range_initialize_copy): Range is now a Struct.
	  [ruby-core:18353]

	* struct.c (rb_struct_init_copy): made public.

Thu Aug 21 03:09:34 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_extract_encoding_option): enc2 is external encoding if
	  external encoding and internal encoding is given.
	  (pipe_open): add flags and convconfig argument to initialize
	  fptr->{mode,enc,enc2}.
	  (pipe_open_v): pass flags and convconfig from caller to pipe_open.
	  (pipe_open_s): ditto.
	  (pop_last_hash): new function.
	  (rb_io_s_popen): use last hash as option to specify code conversion.
	  (rb_io_open): specify flags and convconfig arguments for
	  pipe_open_s.
	  (rb_f_backquote): ditto.

Thu Aug 21 02:27:03 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (prep_io): local variable renamed.
	  (rb_io_fdopen): ditto.
	  (prep_stdio): ditto.

Thu Aug 21 01:58:59 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* configure.in: always check timezone().

	* strftime.c (rb_strftime): prefer timezone/altzone rather than
	  gettimeofday().  The second argument to gettimeofday() is ignored
	  on Solaris.

Thu Aug 21 02:03:08 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (open_key_args): simplified.

Thu Aug 21 01:57:03 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (open_key_args): IO.foreach(path, rs, limit) didn't work.

Thu Aug 21 01:31:34 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_file_sysopen_internal): unused function removed.
	  (rb_file_sysopen): ditto.

Thu Aug 21 01:09:26 2008  Tanaka Akira  <akr@fsij.org>

	* io.c: use mode_t for the 3rd argument, permission, of open(2).

Thu Aug 21 00:51:42 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* configure.in: removed strftime from AC_REPLACE_FUNCS().

	* include/ruby/missing.h: removed prototype for strftime().

	* missing/strftime.c: removed.

	* time.c (time_to_s): use rb_strftime() instead of strftime(3).
	  (time_zone): ditto.

Thu Aug 21 00:49:50 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* strftime.c: win32 support.

Thu Aug 21 00:20:05 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* strftime.c: new file.

	* common.mk (COMMONOBJS): added strftime.$(OBJEXT).

	* time.c (time_strftime): do not use strftime(3).  supported
	  %L(millisecond) and %N(nanosecond).

	* test/ruby/test_time.rb: added tests for %L and %N.

Wed Aug 20 23:53:42 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_set_encoding): removed.
	  (rb_io_open): set up encoding using new argument opt.
	  (open_key_args): call rb_io_open with opt.  don't call
	  io_set_encoding.

Wed Aug 20 22:30:33 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_file_open_internal): use rb_io_flags_modenum.
	  (rb_io_reopen): use rb_io_flags_modenum and rb_io_modenum_mode.
	  (rb_io_stdio_file): ditto.

Wed Aug 20 22:28:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (proc_new): use the given class.

	* vm.c (vm_make_proc): added an argument for the class.

Wed Aug 20 22:24:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_take): get rid of extraneous iteration.

Wed Aug 20 20:32:49 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_open_with_args): use rb_open_file instead of rb_io_open.

Wed Aug 20 20:16:17 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_scan_open_args): extracted from rb_open_file.

Wed Aug 20 19:22:32 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (convconfig_t): new type.
	  (rb_io_extract_modeenc): new function.
	  (rb_file_open_generic): new function.
	  (rb_file_open_internal): use rb_file_open_generic.
	  (rb_file_sysopen_internal): use rb_file_open_generic.
	  (rb_open_file): use rb_io_extract_modeenc and rb_file_open_generic.
	  (rb_io_open): call rb_file_open_internal instead of rb_file_open.

Wed Aug 20 19:15:35 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (Init_IO): new constants: File::DSYNC, File::RSYNC and
	  File::NOFOLLOW.

Wed Aug 20 18:41:11 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_open_file): don't lookup :mode and :perm in opt.  it is
	  useless because vmode and perm is overwritten by rb_scan_args
	  anyway.

Wed Aug 20 18:37:20 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (open_key_args): meaningless MEMCPY removed.

Wed Aug 20 18:30:58 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (prep_io) [cygwin]: use FMODE_BINMODE instead of O_BINARY.

Wed Aug 20 16:39:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sample): performance improvement for huge array.

Wed Aug 20 12:28:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sample): get rid of infinite loop.  #455

Wed Aug 20 06:09:31 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (FMODE_TRUNC): value changed because 0x100 is used
	  as FMODE_NOREVLOOKUP in socket.c

Wed Aug 20 05:19:40 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (parse_mode_enc): extracted from mode_enc.
	  (io_extract_encoding_option): extracted from io_set_encoding.

Wed Aug 20 04:17:26 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_flags_modenum): make it static.

Wed Aug 20 03:36:45 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (FMODE_TRUNC): new constant.

	* io.c (rb_io_mode_flags): set FMODE_TRUNC for "w".
	  (rb_io_modenum_flags): set FMODE_TRUNC for O_TRUNC.
	  (rb_io_flags_modenum): new function.
	  (rb_io_mode_modenum): just use rb_io_mode_flags and
	  rb_io_flags_modenum.

Wed Aug 20 02:36:21 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (fopen): macro for vms removed.  fopen is not used now.

Wed Aug 20 02:27:42 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open): fix memory leak.
	  (rb_econv_close): ditto.
	  fixed by shinichiro.h.  [ruby-dev:35880]

Tue Aug 19 21:50:43 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_fopen): declaration removed.

	* io.c (rb_fopen): unused function removed.

Tue Aug 19 21:14:22 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (FMODE_READWRITE): define as
	  FMODE_READABLE|FMODE_WRITABLE.

Tue Aug 19 21:13:08 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_flags_mode): use hexadecimal in error message.
	  (rb_io_modenum_mode): ditto.
	  (rb_io_initialize): ditto.

Tue Aug 19 18:23:40 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_flags_mode): add a prefix 0 to octal in error message.
	  (rb_io_modenum_mode): ditto.

Tue Aug 19 18:05:45 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (FMODE_*): sorted and describe the values in
	  hexadecimal.

Tue Aug 19 17:32:30 2008  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509name.c (ossl_x509name_initialize): store the
	  result of d2i_X509_NAME into DATA_PTR(self).

Tue Aug 19 04:54:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rake.rb (FileUtils#ruby): takes care of space containing path.
	  [ ruby-Bugs-21591 ]

Tue Aug 19 01:32:37 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_open_file): encoding in mode string was ignored if perm is
	  specified.

Tue Aug 19 01:02:19 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_open_file): don't access argv[-1] by
	  File.allocate.instance_eval { initialize }.

Tue Aug 19 00:56:01 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_inspect): don't raise for uninitialized Regexp.

Tue Aug 19 00:34:24 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_check_readable): side effect for STDIN removed.
	  (rb_io_external_encoding): ditto.

Mon Aug 18 23:27:07 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_ungetbyte): renamed from io_ungetc.
	  (rb_io_ungetbyte): new method.
	  (rb_io_ungetc): push back into character buffer if enc2 is set.

Mon Aug 18 22:41:46 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (id_encode): removed.

Mon Aug 18 22:30:07 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (make_writeconv): if enc and enc2 is set, convert
	  string.encoding to enc2.

	* include/ruby/io.h: comment changed.

Mon Aug 18 21:02:08 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): new fields: writeconv,
	  writeconv_stateless and writeconv_initialized.
	  (MakeOpenFile): initialize them.

	* include/ruby/encoding.h (rb_econv_stateless_encoding): declared.
	  (rb_econv_string): declared.

	* io.c (make_writeconv): new function.
	  (io_fwrite): use econv.
	  (make_readconv): fix error message.
	  (finish_writeconv): new function.
	  (fptr_finalize): call finish_writeconv.
	  (clear_writeconv): new function.
	  (clear_codeconv): new function to call both clear_readconv and
	  clear_writeconv.
	  (rb_io_fptr_finalize): call clear_codeconv instead of
	  clear_readconv.
	  (mode_enc): ditto.
	  (io_set_encoding): ditto.
	  (argf_next_argv): ditto.
	  (io_encoding_set): ditto.

	* gc.c (gc_mark_children): mark writeconv_stateless in T_FILE.

	* transcode.c (stateless_encoding_i): new function.
	  (rb_econv_stateless_encoding): ditto.
	  (rb_econv_string): ditto.

Mon Aug 18 17:23:38 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (clear_readconv): extracted from rb_io_fptr_finalize.
	  (mode_enc): call clear_readconv.
	  (io_set_encoding): ditto.
	  (argf_next_argv): ditto.
	  (io_encoding_set): ditto.

Mon Aug 18 16:54:06 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (mode_enc): modify enc and enc2 consistently.
	  (io_set_encoding): ditto.
	  (io_encoding_set): ditto.

Mon Aug 18 13:21:38 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_search_path): prevent infinite loop by
	  searching a path for self conversion.

Mon Aug 18 12:45:24 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_enc_str): code conversion removed.
	  (io_enc_str_converted): removed because it is identical to
	  io_enc_str now.

Mon Aug 18 12:12:29 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_shift_crbuf): add strp argument to append into existing
	  string.
	  (read_all): use econv if enc2 is set.
	  (io_getc): follow the io_shift_crbuf change.

Mon Aug 18 10:35:25 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_enc_str_converted): new function.
	  (make_readconv): extracted from io_getc.
	  (more_char): ditto.
	  (appendline): use econv via make_readconv and more_char for code
	  conversion.
	  (prepare_getline_args): don't convert record separator.
	  (rb_io_getline_1): don't use rb_io_getline_fast if enc2 is set.
	  (io_getc): use make_readconv and more_char.

Mon Aug 18 08:27:44 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* common.mk: fix error in uncommon.mk.

Mon Aug 18 06:10:08 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: config.h depends config.status.

Mon Aug 18 03:59:43 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (appendline): appendline cannot check character boundary.
	  (rb_io_getline_1): relax limit until character boundary.

Mon Aug 18 02:25:11 2008  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI::Socket#eof?): added lacked method.

Sun Aug 17 21:50:22 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (prepare_getline_args): io.gets(10,nil) should cause TypeError.

Sun Aug 17 15:58:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: not check config.h.

	* lib/mkmf.rb (init_mkmf): add include/ruby/backward to $INCFLAGS.

	* include/ruby/backward/{st,util}.h: added for backward compatibility.
	  [ruby-dev:35811]

Sun Aug 17 13:40:04 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_putback): new method.

Sun Aug 17 13:23:53 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_putbackable): declared.
	  (rb_econv_putback): ditto.

	* transcode.c (rb_econv_putbackable): implemented.
	  (rb_econv_putback): ditto.

	* io.c (io_getc): put back bytes if possible.

Sun Aug 17 12:00:18 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (make_econv_exception): add several instance variables
	  to exception object.
	  (ecerr_source_encoding): new method:
	  Encoding::ConversionUndefined#source_encoding and
	  Encoding::InvalidByteSequence#source_encoding.
	  (ecerr_destination_encoding): new method:
	  Encoding::ConversionUndefined#destination_encoding and
	  Encoding::InvalidByteSequence#destination_encoding.
	  (econverr_error_char): new method:
	  Encoding::ConversionUndefined#error_char.
	  (econverr_error_bytes): new method:
	  Encoding::ConversionUndefined#error_bytes.

Sun Aug 17 11:43:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (struct MT): packed Mersenne Twister staffs.

	* random.c (struct RandSeed): packed random seed staffs.

Sun Aug 17 08:38:26 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/iconv/test_option.rb (test_ignore_option): skip if iconv
	  doesn't have transliterate.

	* test/iconv/test_option.rb (test_translit_option): ditto.

Sun Aug 17 01:29:46 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): new fields: readconv, crbuf, crbuf_off,
	  crbuf_len, crbuf_capa.
	  (MakeOpenFile): initialize them.

	* io.c (io_shift_crbuf): new function.
	  (io_getc): use econv.
	  (rb_io_fptr_finalize): finalize readconv and crbuf.

Sun Aug 17 00:02:07 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_check_error): declared.

	* transcode.c (make_econv_exception): new function.
	  (transcode_loop): use make_econv_exception.
	  (rb_econv_check_error): defined.

Sat Aug 16 15:23:16 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_elem_t): fields removed: from and
	  to.
	  (rb_econv_t): new fields: source_encoding_name and
	  destination_encoding_name.

	* transcode.c (rb_econv_open_by_transcoder_entries): initialize the
	  new fields.
	  (rb_econv_open): set up the new fields.
	  (econv_inspect): use the new fields.

Sat Aug 16 14:22:04 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_t): add fields: in_buf_start,
	  in_data_start, in_data_end, in_buf_end and last_trans_index.
	  (rb_econv_output): removed.
	  (rb_econv_insert_output): declared.
	  (rb_econv_encoding_to_insert_output): declared.

	* enc/trans/newline.trans (rb_universal_newline): stateful_type
	  changed.

	* transcode.c (transcode_restartable0): initialize inchar_start,
	  tc->recognized_len and next_table at beginning of the loop.
	  (rb_econv_open_by_transcoder_entries): initialize new fields.
	  (rb_econv_open): setup last_trans_index.
	  (trans_sweep): last out_buf_start can be non-NULL now.
	  (rb_econv_convert): check last out_buf_start and in_buf_start at
	  first.
	  (rb_econv_output_with_destination_encoding): removed.
	  (econv_just_convert): removed.
	  (rb_econv_output): removed.
	  (econv_primitive_output): method removed.
	  (rb_econv_encoding_to_insert_output): new function.
	  (allocate_converted_string): new function.
	  (rb_econv_insert_output): new function.
	  (econv_primitive_insert_output): new method.
	  (output_replacement_character): use rb_econv_insert_output.  unused
	  arguments removed.

Sat Aug 16 09:20:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_intern_const): tiny optimization.

	* include/ruby/ruby.h (SSIZET2NUM, NUM2SSIZET, SSIZE_MAX, SSIZE_MIN):
	  macros for ssize_t.

Sat Aug 16 08:11:04 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoder_stateful_type_t): defined.
	  (rb_transcoder): add field: stateful_type.

	* tool/transcode-tblgen.rb: generate stateful_type field as
	  stateless_converter.

	* enc/trans/iso2022.trans: follow rb_transcoder change.

	* enc/trans/newline.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

Fri Aug 15 23:07:48 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_just_convert): extracted from rb_econv_output.
	  (rb_econv_output): use econv_just_convert.
	  (econv_primitive_output): new method.

Fri Aug 15 19:57:01 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_output): add str_encoding
	  argument.

	* transcode.c (get_replacement_character): add repl_enc_ptr argument.
	  (rb_econv_output_with_destination_encoding): renamed from
	  rb_econv_output and make it static.
	  (rb_econv_output): convert str and call
	  rb_econv_output_with_destination_encoding.
	  (output_replacement_character): follow above interface change.

Fri Aug 15 19:33:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_drop_bytes): use memmove.

Fri Aug 15 18:33:22 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_t): add error_tc in last_error.

	* transcode.c (rb_econv_convert): fill error_tc.

Fri Aug 15 18:10:49 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_t): new field: last_error.

	* transcode.c (rb_trans_conv): new argument: result_position_ptr.
	  (rb_econv_convert): fill last_error.
	  (econv_result_to_symbol): extracted from econv_primitive_convert.
	  (econv_primitive_errinfo): new method.

Fri Aug 15 17:39:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (parse.{c,h}): creates in the dependency order.

Fri Aug 15 16:59:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (exec_event_hooks): skips RubyVM::FrozenCore.

	* vm.c (Init_VM): get rid of SEGV in a trace proc.

Fri Aug 15 09:33:48 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (conv_init): check empty name.

Fri Aug 15 09:03:54 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_init): don't create dummy encoding if
	  rb_econv_open is failed.
	  (make_dummy_encoding): new function extracted from make_encoding.
	  (make_encoding): removed.

Fri Aug 15 01:07:16 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk ({$(srcdir)}.y.c): escape backslash.

Fri Aug 15 01:05:39 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_convert): set destination_buffer
	  encoding.

Fri Aug 15 00:52:40 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_output): declared.

	* transcode_data.h (rb_transcoder): add resetsize_func field.

	* enc/trans/iso2022.trans (iso2022jp_reset_sequence_size): defined.
	  (rb_EUC_JP_to_ISO_2022_JP): provide resetsize_func.

	* tool/transcode-tblgen.rb: set NULL for resetsize_func.

	* transcode.c (rb_econv_output): new function for inserting output.
	  (output_replacement_character): use rb_econv_output.
	  (transcode_loop): check return value of
	  output_replacement_character.

Thu Aug 14 23:47:21 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ECONV_UNIVERSAL_NEWLINE_DECODER): defined.
	  (ECONV_CRLF_NEWLINE_ENCODER): ditto.
	  (ECONV_CR_NEWLINE_ENCODER): ditto.
	  (ECONV_PARTIAL_INPUT): ditto.
	  (ECONV_OUTPUT_FOLLOWED_BY_INPUT): ditto.

	* transcode.c: use ECONV_* defined as above.

Thu Aug 14 23:35:21 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c: local variable renamed.

Thu Aug 14 23:22:24 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_econv_result_t): moved from
	  transcode_data.h.
	  (rb_econv_elem_t): ditto.
	  (rb_econv_t): ditto.  source_encoding and destination_encoding field
	  is added.
	  (rb_econv_open): declared.
	  (rb_econv_convert): ditto.
	  (rb_econv_close): ditto.

	* transcode.c (rb_econv_open_by_transcoder_entries): initialize
	  source_encoding and destination_encoding field as NULL.
	  (rb_econv_open): make it external linkage.
	  (rb_econv_close): ditto.
	  (rb_econv_convert): ditto.  renamed from rb_econv_conv.
	  (make_encoding): new function.
	  (econv_init): use make_encoding and store rb_encoding* in
	  rb_econv_t.
	  (econv_source_encoding): new method
	  Encoding::Converter#source_encoding.
	  (econv_destination_encoding): new method
	  Encoding::Converter#destination_encoding.

Thu Aug 14 22:44:32 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_econv_result_t): change enumeration
	  constant's prefix: transcode_ to econv_.

	* transcode.c: follow the constant prefix change.

Thu Aug 14 21:34:41 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_init): accept Encoding object as source_encoding
	  and destination_encoding.

Thu Aug 14 21:10:00 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_filesystem_encoding): use default external encoding
	  for Unix.

	* dir.c (dir_initialize): don't cache fs_encoding.

Thu Aug 14 20:58:57 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_open_by_transcoder_entries): renamed from
	  rb_trans_open_by_transcoder_entries.

Thu Aug 14 20:56:28 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_max_output): removed.

Thu Aug 14 20:52:55 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: check unexpected actions.

Thu Aug 14 20:25:52 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (transcode_invalid_byte_sequence): renamed from
	  transcode_invalid_input.
	  (transcode_destination_buffer_full): renamed from transcode_obuf_full.
	  (transcode_source_buffer_empty): renamed from transcode_ibuf_empty.
	  (rb_econv_result_t): renamed from rb_trans_result_t.
	  (rb_econv_elem_t): renamed from rb_trans_elem_t.
	  (rb_econv_t): renamed from rb_trans_t.

	* transcode.c (UNIVERSAL_NEWLINE_DECODER): renamed from
	  UNIVERSAL_NEWLINE.
	  (CRLF_NEWLINE_ENCODER): renamed from CRLF_NEWLINE.
	  (CR_NEWLINE_ENCODER): renamed from CR_NEWLINE.
	  (rb_econv_open): renamed from rb_trans_open.
	  (rb_econv_close): renamed from rb_trans_close.

Thu Aug 14 19:41:42 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (load_transcoder): unused function removed.
	  (rb_transcoding_open): ditto.

Thu Aug 14 17:57:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_ispunct): added.

	* common.mk (COMMONOBJS), inits.c (rb_call_inits): id.c is now
	  included from parse.c.

	* id.c (Init_id), id.h (ruby_method_ids): added IDs used by VM.

	* parse.y (global_symbols): added rooms for VM IDs.

	* parse.y (rb_intern3, rb_id2str): single punctuation symbol is now
	  same as char code.

Thu Aug 14 17:46:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (union tmpyystype): no longer needed, since YYSTYPE is
	  defined in parse.h now.

Thu Aug 14 17:27:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* version.c (Init_version): add RUBY_ENGINE constant.

Thu Aug 14 15:34:10 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_econv_conv): new function.  it doesn't consume
	  input too much, even for multilevel conversion.
	  (transcode_loop): use rb_econv_conv.
	  (econv_primitive_convert): ditto.

Thu Aug 14 15:27:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/defines.h (RUBY_ALIAS_FUNCTION): fallback definition.

Thu Aug 14 15:08:17 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_trans_result_t): new enumeration constant:
	  transcode_output_followed_by_input.

	* transcode.c (OUTPUT_FOLLOWED_BY_INPUT): new flag.
	  (transcode_restartable0): suspend when output followed by input if
	  OUTPUT_FOLLOWED_BY_INPUT is specified.
	  (trans_sweep): check OUTPUT_FOLLOWED_BY_INPUT.
	  (rb_trans_conv): support OUTPUT_FOLLOWED_BY_INPUT.
	  (econv_primitive_convert): return :output_followed_by_input for
	  transcode_output_followed_by_input.

Thu Aug 14 14:57:46 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (getrusage_time): should return the value.

	* thread.c (rb_thread_priority_set): get rid of C99 feature.

	* transcode.c (transcode_search_path): ditto.

	* vm.c (REWIND_CFP): get rid of statement expressions.

Thu Aug 14 14:13:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (Init_VM): hide FrozenCore.

Thu Aug 14 12:20:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (load_transcoder): suppress warning.

	* missing/vsnprintf.c (BSD_vfprintf): ditto.

Thu Aug 14 12:01:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (gnumake): check for GNU make.

	* Makefile.in (uncommon.mk): includes filtered common.mk.

	* common.mk (parse.h): workaround for nmake.

Thu Aug 14 06:09:12 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_execute_interrupts): switch event
	  should be occur only once.

Thu Aug 14 05:36:36 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: parse.h depends on parse.c.

	* common.mk: hash.o depends on $(ID_H_INCLUDES).

Thu Aug 14 02:45:16 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_file_exhaustive.rb (TestFileExhaustive#setup):
	  set group of tmpdir.  [ruby-dev:35633]

Thu Aug 14 15:50:30 2008  Giuseppe Bilotta  <giuseppe.bilotta@gmail.com>

	* hash.c (set_default): fix rdoc.  #441

Thu Aug 14 02:23:31 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_convert): add output_byteoffset
	  argument.

Thu Aug 14 00:43:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_gcc_function_alias): checks alias attribute.

	* string.c (alias_func): replaced with RUBY_ALIAS_FUNCTION.

Wed Aug 13 23:42:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (parse.h): fake rule.

Wed Aug 13 23:15:58 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* test/ruby/test_thread.rb (test_list): call Thread.pass to run t1.
	  fixed [ruby-core:18264].

Wed Aug 13 23:05:51 2008  TAKAO Kouji  <kouji@takao7.net>

	* string.c (alias_func): changed to 'weak, alias' from 'alias' for
	  Mac OSX. (closes #429)

Wed Aug 13 19:40:12 2008  Koichi Sasada  <ko1@atdot.net>

	* gc.c: count only freed object as freelist size.

Wed Aug 13 18:34:22 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* marshal.c (marshal_load): set arg.untrust properly.

Wed Aug 13 17:47:09 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_inspect): new method.

Wed Aug 13 17:35:58 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_restartable0): several local variables
	  removed.

Wed Aug 13 17:35:23 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_set_default_proc): add new method.  a patch from
	  Giuseppe Bilotta.  #419

Wed Aug 13 17:31:12 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_insnhelper.c (caller_setup_args): should ensure if the value
	  from to_proc is a real Proc.

Wed Aug 13 17:28:29 2008  Akinori MUSHA  <knu@iDaemons.org>

	* common.mk: regint.h no longer includes vm_core.h.

Wed Aug 13 17:26:44 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): add fields: writebuf_off,
	  writebuf_len and writebuf.
	  (TRANSCODING_WRITEBUF): new macro.

	* transcode.c (transcode_restartable0): output until output buffer is
	  really full.
	  (rb_transcoding_open_by_transcoder): initialize writebuf_len,
	  writebuf_off and writebuf.
	  (rb_transcoding_close): finalize writebuf.

Wed Aug 13 17:18:37 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_check_ints): added.  please note that
	  this function may cause ruby's thread switching.

	* include/ruby/intern.h: ditto.

	* regint.h: use rb_thread_check_ints() instead of
	  RUBY_CHECK_INTS() directly.

Wed Aug 13 17:01:36 2008  Akinori MUSHA  <knu@iDaemons.org>

	* golf_prelude.rb, lib/set.rb (TC_Set#test_each),
	  test/readline/test_readline_history.rb (Readline#test_each__enumerator),
	  test/ruby/test_array.rb (TestArray#test_collect),
	  test/ruby/test_enumerator.rb (TestEnumerator#test_initialize):
	  Enumerable::Enumerator is now called Enumerator.

	* lib/rinda/tuplespace.rb (Rinda::TupleBag#initialize): Use
	  enum_for instead of hardcoding Enumerable::Enumerator.

Wed Aug 13 16:40:57 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c, vm_core.h: add manual priority support
	  using time slice.  if you enable USE_NATIVE_THREAD_PRIORITY
	  macro, this mechanism is ignored.  [ruby-dev:33124]

	* thread_pthread.c, thread_win32.c: ditto.

	* test/ruby/test_thread.rb: fix test parameter.

Wed Aug 13 16:02:14 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* object.c (rb_obj_untrusted): new method Object#untrusted?.
	  (rb_obj_untrust): new method Object#untrust.
	  (rb_obj_trust): new method Object#trust.

	* array.c, debug.c, time.c, include/ruby/ruby.h, re.c, variable.c,
	  string.c, io.c, dir.c, vm_method.c, struct.c, class.c, hash.c,
	  ruby.c, marshal.c: fixes for Object#untrusted?.

	* test/ruby/test_module.rb, test/ruby/test_array.rb,
	  test/ruby/test_object.rb, test/ruby/test_string.rb,
	  test/ruby/test_marshal.rb, test/ruby/test_hash.rb: added tests for
	  Object#untrusted?.

Wed Aug 13 16:13:58 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_m17n.rb: follow EncodingCompatibilityError.

	* test/ruby/test_mixed_unicode_escapes.rb: ditto.

	* test/ruby/enc/test_utf16.rb: ditto.

Wed Aug 13 16:05:50 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_cmp): retry with right hand operand if its not a
	  time object.  [ruby-dev:35011]

Wed Aug 13 15:51:22 2008  Akinori MUSHA  <knu@iDaemons.org>

	* string.c: Apply a temporary fix to fix build on OS X.  A real
	  fix will follow later.

Wed Aug 13 15:25:09 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (Init_Enumerator): Rename Enumerable::Enumerator to
	  just Enumerator.

Wed Aug 13 15:13:57 2008  Akinori MUSHA  <knu@iDaemons.org>

	* common.mk (prelude.c, golf_prelude.c): Using $(COMPILE_PRELUDE)
	  requires $(RBCONFIG).

Wed Aug 13 15:08:04 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_init): make flags argument optional.
	  (econv_primitive_convert): ditto.

Wed Aug 13 14:55:27 2008  Akinori MUSHA  <knu@iDaemons.org>

	* common.mk (realclean-local): Remove parse.h as well.

	* common.mk: Add missing dependencies regarding vm_core.h, id.h,
	  parse.c (parse.h), etc..

Wed Aug 13 14:45:37 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/newline.trans (rb_crlf_newline): new transcoder.
	  (rb_cr_newline): new transcoder.

	* transcode.c (trans_open_i): one more extra room for input newline
	  converter.
	  (rb_trans_open): crlf newline and cr newline implemented.
	  (Init_transcode): Encoding::Converter::CRLF_NEWLINE and
	  Encoding::Converter::CR_NEWLINE defined.

Wed Aug 13 14:22:16 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/newline.trans: new file.

	* transcode_data.h (rb_trans_t): add last_tc field.

	* transcode.c (UNIVERSAL_NEWLINE): defined.
	  (CRLF_NEWLINE): defined.
	  (CR_NEWLINE): defined.
	  (rb_trans_open_by_transcoder_entries): initialize last_tc.
	  (trans_open_i): allocate one more room for output newline converter.
	  (rb_trans_open): universal newline implemented.
	  (more_output_buffer): take max_output argument instead ts.
	  (output_replacement_character): take tc argument instead of ts.
	  (transcode_loop): use last_tc field.
	  (econv_init): add flags argument for rb_trans_open.
	  (Init_transcode): Encoding::Converter::UNIVERSAL_NEWLINE defined.

Wed Aug 13 14:00:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (parse.c): generates parse.h together.

	* id.c, id.h: use constants for parser tokens.

Wed Aug 13 13:47:05 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c: rewind cfp to show proper backtrace.
	  [ruby-dev:35820]

Wed Aug 13 13:09:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: fix for clean up.

Wed Aug 13 11:45:51 2008  Akinori MUSHA  <knu@iDaemons.org>

	* vm_core.h: Declare rb_iseq_clone, which is used in class.c.

Wed Aug 13 11:39:19 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_search_path): return the length of converter
	  path.
	  (load_transcoder_entry): renamed from load_transcoder.
	  (load_transcoder): new function for loading transcoder by encoding
	  names.
	  (rb_transcoding_open_by_transcoder): extracted from
	  rb_transcoding_open.
	  (rb_transcoding_open): use load_transcoder and
	  rb_transcoding_open_by_transcoder.
	  (rb_trans_open_by_transcoder_entries): new function.
	  (trans_open_i): construct entries array.
	  (rb_trans_open): use rb_trans_open_by_transcoder_entries.

Wed Aug 13 10:45:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: try to find exported directory.

Wed Aug 13 10:16:35 2008  TAKAO Kouji  <kouji@takao7.net>

	* doc/NEWS: Mention the Readline.vi_editing_mode?,
	  Readline.emacs_editing_mode?, Readline::HISTORY[] and
	  Readline::HISTORY.clear change.

Wed Aug 13 08:03:02 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (econv_primitive_convert): add output_size argument.

Wed Aug 13 07:41:03 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_trans_conv): report last transcode_obuf_full.
	  (econv_max_output): new method Encoding::Converter#max_output.

Wed Aug 13 02:46:01 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (rb_eEncCompatError): add Exception.

	* include/ruby/ruby.h: ditto.

	* encoding.c (rb_enc_check): use rb_eEncCompatError.

	* string.c (rb_enc_cr_str_buf_cat): ditto.

	* string.c (rb_str_sub_bang): ditto.

	* string.c (rb_str_hex): ditto.

	* string.c (rb_str_oct): ditto.

Wed Aug 13 02:36:47 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (str_transcode): fix error message.

Tue Aug 12 23:42:31 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_cEncodingConverter): new class Encoding::Converter.
	  (econv_free): new function.
	  (econv_s_allocate): ditto.
	  (econv_init): ditto.
	  (check_econv): ditto.
	  (econv_primitive_convert): new method.
	  (Init_transcode): define Encoding::Converter.

Tue Aug 12 23:16:09 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_splice_0): call rb_str_drop_bytes, not rb_str_drop.

Tue Aug 12 19:11:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: fix for enc.mk.

Tue Aug 12 19:08:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_drop_bytes): new function to drop first bytes.

Tue Aug 12 18:58:48 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_insnhelper.c (vm_define_method): move
	  function place.

Tue Aug 12 18:56:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c: more descriptive aliases of rb_str_new[2-5].
	  [ruby-dev:35615]

Tue Aug 12 18:51:29 2008  TAKAO Kouji  <kouji@takao7.net>

	* gc.c (getrusage_time): Returned effective value on Windows.

Tue Aug 12 18:51:11 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_trans_open): free ts before raise.

Tue Aug 12 18:46:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimalCmp): should not ignore
	  <=> comparison.  [ruby-dev:35732]

Tue Aug 12 18:43:10 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/make_transdb.rb: *.erb.c is not used anymore.

Tue Aug 12 18:32:33 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_trans_elem_t): new field: from and to.

	* transcode.c (trans_open_i): just record from and to.
	  (rb_trans_open): load transcodings.

Tue Aug 12 18:32:03 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/syslog/syslog.c (mSyslog_open): Use of Check_SafeStr() is
	  deprecated.
	  (mSyslogConstants_LOG_MASK, mSyslogConstants_LOG_UPTO): Use
	  NUM2INT() instead of FIX2INT() when the type of an given object
	  is not determined.

Tue Aug 12 18:14:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* tool/transcode-tblgen.rb (#transcode_tblgen): slight message
	  improvement.

Tue Aug 12 17:16:58 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (trans_open_i): check the result of rb_transcoding_open.

Tue Aug 12 16:23:32 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (gc_profile_result): use rb_str_catf.

Tue Aug 12 16:13:45 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (TRANSCODE_ERROR): removed.

	* tool/transcode-tblgen.rb: 8bit byte of ASCII-8BIT is a valid
	  (but unique to ASCII-8BIT) character.

	* transcode.c (rb_eConversionUndefined): new error.
	  (rb_eInvalidByteSequence): ditto.

Tue Aug 12 16:08:51 2008  Minero Aoki  <aamine@loveruby.net>

	* lib/net/pop.rb: POP3Command should export @socket since POP
	  calls #socket.

Tue Aug 12 16:06:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c, util.c (quorem, nrv_alloc, dtoa): enabled floating point
	  support.

Tue Aug 12 15:52:45 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (gc_profile_result): use sprintf.

Tue Aug 12 15:37:40 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_intern): should check symbol table overflow.

Tue Aug 12 15:31:04 2008  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (send_request_with_body): Content-Length should
	  be byte length of string. (closes #203)

Tue Aug 12 15:17:06 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/depend: (transvpath_prefix): prefix has no extension, so replace
	  %s with "".

Tue Aug 12 15:03:43 2008  TAKAO Kouji  <kouji@takao7.net>

	* test/readline/test_readline.rb (TestReadline#test_safe_level_4):
	  tested Readline.vi_editing_mode? and Readline.emacs_editing_mode?.

Tue Aug 12 14:25:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/Makefile.in (.SUFFIXES): renamed to .trans.

	* enc/make_encmake.rb: added --encs and --no-encs options.

	* enc/depend (TRANSVPATH): fix for nmake.

Tue Aug 12 14:19:53 2008  Minero Aoki  <aamine@loveruby.net>

	* lib/net/https.rb: suppress syntax warning.

Tue Aug 12 14:15:51 2008  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (Net::HTTP#initialize): initialize net/https
	  variables to suppress syntax warning.

Tue Aug 12 14:15:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cptr.c (rb_dlptr_s_to_ptr): fixed shadowing variable.

Tue Aug 12 10:25:14 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_delete): Array#delete to return deleted element.

Tue Aug 12 10:18:01 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/win32ole/test_err_in_callback.rb: do not require 'mkmf'
	  unless WIN32OLE is defined.

Tue Aug 12 07:41:13 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoder): add resetstate_func field for
	  resetting a state of stateful encoding.

	* enc/trans/iso2022.trans (rb_EUC_JP_to_ISO_2022_JP): specify
	  finish_eucjp_to_iso2022jp for resetstate_func.

	* tool/transcode-tblgen.rb: specify NULL for resetstate_func.

	* transcode.c (output_replacement_character): call resetstate_func
	  before appending the replacement character.

Tue Aug 12 07:19:24 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (get_replacement_character): extracted from
	  output_replacement_character.

Tue Aug 12 07:00:02 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoder): typedef at first.

Tue Aug 12 06:48:35 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (rb_trans_conv): find second last error.

Tue Aug 12 00:43:44 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_trans_result_t): new type.
	  (rb_trans_elem_t): new type.
	  (rb_trans_t): new type.

	* transcode.c (transcode_dispatch_cb): removed.
	  (transcode_dispatch): removed.
	  (rb_transcoding_result_t): moved to rb_trans_result_t in
	  transcode_data.h.
	  (transcode_restartable0): goto follow_info when FUNsi.
	  (rb_transcoding_open): use get_transcoder_entry.
	  (rb_trans_open): new function.
	  (rb_trans_conv): ditto.
	  (rb_trans_close): ditto.
	  (trans_open_i): ditto.
	  (trans_sweep): ditto.
	  (more_output_buffer): take rb_trans_t instead of rb_transcoding as
	  an argument.
	  (transcode_loop): take from_encoding and to_encoding instead of tr
	  as arguments.  use rb_trans_open/rb_trans_conv/rb_trans_close.
	  (str_transcode): don't use transcode_dispatch.

Mon Aug 11 20:37:05 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* iseq.c (rb_iseq_clone): should preserve cref_stack link.

Mon Aug 11 20:27:12 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): add taint check.

	* ext/dl/dl.c (rb_dl_malloc): add rb_secure(2).

	* ext/dl/dl.c (rb_dl_realloc): ditto.

	* ext/dl/dl.c (rb_dl_free): ditto.

	* ext/dl/dl.c (rb_dl_ptr2value): ditto.

Mon Aug 11 20:11:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (getrusage_time): works only if RUSAGE_SELF is defined right
	  now.

	* gc.c (gc_profile_result): C99.

Mon Aug 11 18:57:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_sample): rename #choice to #sample.  in
	  addition, sample takes optional argument, a la #first.

Mon Aug 11 18:28:02 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c: added GC::Profiler.

Mon Aug 11 17:26:16 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/README.ja: added API document for
	  Readline.vi_editing_mode? and Readline.emacs_editing_mode?.

	* ext/readline/extconf.rb: checked rl_editing_mode variable in
	  Readline library.

	* ext/readline/readline.c (readline_s_emacs_editing_mode_p): added
	  Readline.emacs_editing_mode? method.
	  (readline_s_vi_editing_mode_p): added Readline.vi_editing_mode?
	  method.
	  (Init_readline): ditto.

Mon Aug 11 16:56:40 2008  TAKAO Kouji  <kouji@takao7.net>

	* test/readline/test_readline.rb: added test for Readline's class
	  methods.

Mon Aug 11 16:39:23 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (clone_method): should copy cbase in cref as well.
	  [ruby-dev:35116]

	* iseq.c (iseq_mark): mark original iseq object.

	* iseq.c (iseq_free): do not free internal data if they have
	  original iseq to belong.

	* iseq.c (rb_iseq_clone): a new function to clone iseq value.

Mon Aug 11 16:34:48 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/iso2022.trans: renamed from iso2022.erb.c.

	* enc/trans/single_byte.trans: ditto.

	* enc/trans/utf_16_32.trans: ditto.

	* enc/trans/korean.trans: ditto.

	* enc/trans/japanese.trans: ditto.

	* enc/depend: follow the renaming.

	* tool/build-transcode: ditto.

Mon Aug 11 15:09:23 2008  Tanaka Akira  <akr@fsij.org>

	* configure.in (rb_cv_broken_glibc_ia64_erfc): renamed from
	  rb_broken_glibc_ia64_erfc.
	  [ruby-core:18228]

Mon Aug 11 10:04:34 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): rename fields.
	  readlen -> recognized_len.
	  feedlen -> readagain_len.

	* transcode.c: follow the field renaming.

Sun Aug 10 22:34:55 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_restartable0): invalid handling simplified.
	  (transcode_restartable): use PARTIAL_INPUT for converting buffered
	  input.

Sun Aug 10 22:24:24 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* encoding.c: include util.h.  [ruby-dev:35715]

	* common.mk: ditto.

Sun Aug 10 20:59:54 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): new field: flags.

	* transcode.c (load_transcoder): extracted from transcode_dispatch_cb.
	  (rb_transcoding_result_t): renamed from transcode_result_t.
	  (rb_transcoding_open): new function.
	  (rb_transcoding_convert): ditto.
	  (rb_transcoding_close): ditto.
	  (transcode_loop): use rb_transcoding_open, rb_transcoding_convert
	  and rb_transcoding_close.
	  (str_transcode): don't need rb_transcoding.

Sun Aug 10 18:09:16 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: record checksum of
	  transcode-tblgen.rb itself.

Sun Aug 10 12:34:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* config.guess ({powerpc-apple,i586-pc}-haiku): re-applied r18403.
	  [ruby-core:18110]

	* config.{guess,sub}: updated to automake-1.10.1.

Sun Aug 10 11:45:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/Makefile.in (make-workdir): use MAKEDIRS.

	* enc/depend: makes target directory before compile/link.

	* tool/transcode-tblgen.rb: creates target directory.

Sun Aug 10 11:30:48 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c: rename my_transcoding to tc and my_transcoder to tr.

Sun Aug 10 11:15:55 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): add feedlen field.

	* transcode.c (transcode_restartable0): renamed from
	  transcode_restartable.
	  save input buffer into feed buffer if next character is started the
	  point before input buffer.  for example, "\x00\xd8\x01" then "\x02"
	  in UTF-16LE.  \x02 causes invalid and next character is started from
	  \x01.
	  (transcode_restartable): new function to call
	  transcode_restartable0.  if feed buffer is not empty, convert it at
	  first.

Sun Aug 10 11:02:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (extconf): use MAKEDIRS.

Sun Aug 10 09:35:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb.rb (IRB::Irb#inspect): instance_variables returns symbols
	  instead of strings now.  [ruby-dev:34930]

Sun Aug 10 09:22:14 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_char_start): refactored to remove readlen
	  argument.
	  (transcode_restartable): refactored to remove readlen variable.

Sun Aug 10 08:56:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (STACK_LEVEL_MAX, ruby_stack_length): returns size_t.
	  [ruby-core:18207]

	* configure.in (rb_cv_missing__dtos18, rb_cv_missing_fconvert),
	  ext/digest/md5/md5.c, ext/openssl/ossl.c (main),
	  ext/socket/extconf.rb (ipv6, wide-getaddrinfo): main should be int.

	* main.c (main), win32/winmain.c, wince/wincemain.c (WinMain): envp is
	  no longer used so long time.  based on a patch from Peter Bowen at
	  [ruby-core:18208]

Sat Aug  9 22:05:29 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_loop): take destination and resize function
	  as parameters.
	  (more_output_buffer): ditto.
	  (str_transcoding_resize): argument changed from rb_transcoding* to
	  VALUE.
	  (str_transcode): call transcode_loop with destination string and its
	  resize function.

	* transcode_data.h (rb_transcoding): move ruby_string_dest and
	  flush_func to transcode_loop parameters.

Sat Aug  9 21:29:45 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: encs depend on transdb.h

Sat Aug  9 21:10:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_rshift_sign, rb_cv_binary_elf): get rid of
	  AC_TRY_RUN.

Sat Aug  9 16:33:21 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): new fields: next_info and next_byte.

	* transcode.c (transcode_restartable): save/restore next_info and
	  next_byte.
	  sync readlen and in_p when invalid.

Sat Aug  9 15:10:15 2008  Tanaka Akira  <akr@fsij.org>

	* transcode.c (transcode_restartable): my_transcoder argument removed.
	  (transcode_loop): my_transcoder argument removed.

Sat Aug  9 14:39:34 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): add fields for restartable
	  transcoding.
	  (rb_transcoder): add max_input field.
	  from_unit_length field is renamed to input_unit_length.

	* tool/transcode-tblgen.rb: generate max_input field.

	* enc/trans/iso2022.erb.c: follow rb_transcoder change.

	* enc/trans/utf_16_32.erb.c: ditto.

	* transcode.c (PARTIAL_INPUT): new constant.
	  (transcode_char_start): new function.
	  (transcode_result_t): new type.
	  (transcode_restartable): new function.
	  (more_output_buffer): new function.
	  (transcode_loop): use transcode_restartable.

Sat Aug  9 13:35:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* stable/ext/socket/socket.c (NI_MAXHOST, NI_MAXSERV): fixed invalid
	  preprocessor directives.  a patch from Peter Bowen at
	  [ruby-core:18211].

Sat Aug  9 06:37:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/make_encdb.rb, enc/trans/make_transdb.rb: skip nonexistent
	  directory.  [ruby-dev:35802]

Sat Aug  9 01:07:51 2008  Tanaka Akira  <akr@fsij.org>

	* enc/trans/utf_16_32.erb.c (fun_so_from_utf_32le): implemented.
	  (fun_so_to_utf_32le): implemented.
	  [ruby-dev:35777]

Sat Aug  9 00:42:33 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoder): from_unit_length field added.
	  from_utf8 field removed.

	* tool/transcode-tblgen.rb: generate offsets range.
	  follow rb_transcoder change.

	* transcode.c (transcode_loop): don't use from_utf8.
	  make invalid region from_unit_length wise.

	* enc/trans/iso2022.erb.c: follow rb_transcoder and
	  transcode_generate_node change.

	* enc/trans/utf_16_32.erb.c: follow rb_transcoder and
	  transcode_generate_node change.
	  explicit :invalid map removed.

Fri Aug  8 23:29:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend (TRANSCSRCS): needs rule_subst to apply.

	* io.c (shutdown): not define if defined already.

Fri Aug  8 22:47:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (opt_eq_func): large function to make inline.

	* bcc32/Makefile.sub (config.h): cannot compile a big inline function.

Fri Aug  8 21:09:10 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (enk.mk): give not RUBY but MINIRUBY.

Fri Aug  8 17:03:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (shutdown, sched_yield, pthread_attr_setinheritsched):
	  check for Haiku.

	* eval_intern.h, io.c, thread_pthread.c: use autoconfisticated results.

Fri Aug  8 16:52:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (enc.mk): mkmf.rb requires rbconfig.rb.

	* common.mk (srcs-enc): renamed from transcodes.

	* enc/Makefile.in (make-workdir): creates object directories.

	* common.mk (encdb.h): see both $(srcdir)/enc and enc.

	* enc/make_encdb.rb: ditto.

	* enc/trans/make_transdb.rb: fix for the case no transdirs are given.

	* enc/trans/make_transdb.rb: converts only one transcoders for each
	  basename.

Fri Aug  8 10:53:52 2008  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: randomize source port and transaction id.
	  CVE-2008-1447.

	* lib/resolv-replace.rb (UDPSocket#bind): don't resolv host if host is
	  "".

Fri Aug  8 04:20:14 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: see both $(srcdir)/enc/trans and enc/trans.

	* enc/trans/make_transdb.rb: ditto.

Fri Aug  8 00:05:02 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/.document: added readline/readline.c.

	* ext/readline/readline.c: changed Copyright. added RDoc.

	* ext/readline/README.ja: fixed typo.

	* ext/readline/README: contents was moved RDoc.

Thu Aug  7 23:43:11 2008  Tanaka Akira  <akr@fsij.org>

	* transcode_data.h (rb_transcoding): new field "stateful".
	  (rb_transcoder): preprocessor and postprocessor field removed.
	  change arguments of func_ii, func_si, func_io and func_so.
	  new field "finish_func".

	* tool/transcode-tblgen.rb: make FUNii, FUNsi and FUNio
	  generatable.

	* transcode.c (transcoder_lib_table): removed.
	  (transcoder_table): change structure.
	  (transcoder_key): removed because the above structure change.
	  (make_transcoder_entry): new function.
	  (get_transcoder_entry): ditto.
	  (rb_register_transcoder): follow the structure change.
	  (declare_transcoder): ditto.
	  (transcode_search_path): new function for breadth first search to
	  find a list of converters.
	  (transcode_search_path_i): new function.
	  (transcode_dispatch_cb): ditto.
	  (transcode_dispatch): use transcode_search_path.
	  (transcode_loop): follow the argument change.
	  (str_transcode): preprocessor and postprocessor stuff removed.

	* enc/trans/iso2022.erb.c: new file.  ISO-2022-JP conversion
	  re-implemented.

	* enc/trans/japanese.erb.c: ISO-2022-JP stuff removed.

	* enc/trans/utf_16_32.erb.c: follow argument change of FUNso.

	[ruby-dev:35798]

Thu Aug  7 22:55:44 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/README.ja: updated API document for Readline module.

Thu Aug  7 20:52:08 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (login): raise FTPReplyError if passwd or acct
	  is not supplied.  fixed [ruby-core:18058].

Thu Aug  7 18:01:44 2008  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-mode.el (ruby-imenu-create-index-in-block): Fix the
	  regexp to only pick definition lines properly.  `module_function'
	  is not a definition of a module named `_function'.

Thu Aug  7 17:47:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend: add transdb.c.

Thu Aug  7 16:28:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.mk, {bcc,win}32/Makefile.sub (clean-ext): do not
	  use miniruby.

Thu Aug  7 14:17:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend: removed needless explicit commands.

	* lib/mkmf.rb, {bcc32,win32}/Makefile.sub (CLEANLIBS, CLEANOBJS):
	  moved clean targets to platform makefiles.

Thu Aug  7 13:12:30 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/getaddrinfo.c (gai_strerror): ignore only on Haiku.
	  a patch from <zn at mbf.nifty.com>, [ruby-dev:35796].

Thu Aug  7 06:31:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/process.rb (test_popen_fork): skip a test which is
	  freeze in FreeBSD.

Thu Aug  7 06:05:48 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* config.guess: add powerpc-apple-haiku, i586-pc-haiku.
	  see [ruby-core:18110]

Thu Aug  7 05:51:05 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* eval_intern.h: Add support to Haiku. see [ruby-core:18110]

	* include/ruby/defines.h: ditto.

	* configure.in: ditto.

	* thread_pthread.c: ditto.

	* io.c: ditto.

	* lib/mkmf.rb: ditto.

	* ext/socket/getaddrinfo.c: ditto.

	* ext/socket/extconf.rb: ditto.

	* ext/socket/socket.c: ditto.

	* ext/socket/addrinfo.h: ditto.

	* ext/socket/getnameinfo.c: ditto.

Thu Aug  7 05:43:32 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: mkdir enc/trans before build tables.

Thu Aug  7 05:18:30 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/depend: enc/*.c is source but enc/trans/*.c is generated.

Thu Aug  7 05:14:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* regenc.c (code_to_mbc): raise RangeError Integer#chr
	  when more than 255 is given with single byte encoding.
	  [ruby-dev:35789]

Thu Aug  7 05:06:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (run_final): runs finalizers with the object terminated.

	* gc.c (rb_gc_call_finalizer_at_exit): keeps finalized objects from
	  linking to freelist.

Thu Aug  7 04:43:14 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/depend: for build in other than srcdir.

Wed Aug  6 22:40:48 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (transcode_generate_node): code
	  argument removed.

Wed Aug  6 21:25:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (chain_finalized_object): deletes finalizers to be invoked from
	  finalizer_table.

	* gc.c (rb_gc_call_finalizer_at_exit): warns when could not invoke
	  finalizers.

Wed Aug  6 20:56:43 2008  Tanaka Akira  <akr@fsij.org>

	* enc/depend: transcode table generation depends on
	  tool/transcode-tblgen.rb.

Wed Aug  6 20:48:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_gc_call_finalizer_at_exit): self-referencing finalizers
	  cannot be invoked.  [ruby-dev:35681]

Wed Aug  6 20:44:41 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: distinguish UNDEF and INVALID.
	  [ruby-dev:35709]

	* transcode.c (transcode_loop): don't need rb_enc_mbclen now.

Wed Aug  6 14:40:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (transdb.h): requires transcoders.

	* enc/depend (srcs): target for transcoders.

Wed Aug  6 14:04:08 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/depend: replace not only $(<:...) but also $<.

Wed Aug  6 13:54:30 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.status): export BASERUBY.

	* enc/depend: avoid GNU make'ism.

Wed Aug  6 07:59:02 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb (ActionMap#eql?): use == to compare @map.

Wed Aug  6 07:45:26 2008  Tanaka Akira  <akr@fsij.org>

	* tool/transcode-tblgen.rb: show generating tables in verbose mode.
	  (transcode_generate_node): call ActionMap#generate_node with showing
	  table name.

	* enc/trans/utf_16_32.erb.c: use transcode_generate_node.

Wed Aug  6 06:55:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): propagates fatal error and system
	  exit to the main thread.

Wed Aug  6 05:31:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_to_encoding_index, rb_to_encoding): check if the name
	  is ascii compatible as well as Encoding.find.

	* transcode.c (str_encode): no need to duplicate first.

Wed Aug  6 05:08:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sort_bang): reset to real class.

	* file.c (rb_find_file_ext, rb_find_file): ditto.

	* io.c (io_reopen): ditto.

Wed Aug  6 03:56:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (transcodes), tool/build-transcode: generates transcode
	  sources.

	* enc/trans/{japanese,korean,single_byte,utf_16_32}.c: to be
	  autogenerated now.

	* enc/depend: added rules for .c from .erb.c.

Tue Aug  5 20:46:20 2008  Tanaka Akira  <akr@fsij.org>

	* tool/build-transcode: new file.

	* tool/transcode-tblgen.rb: new file.

	* enc/trans/make_transdb.rb: exclude *.erb.c.

	* enc/depend: exclude *.erb.c.

	* enc/trans/utf_16_32.erb.c: new file.

	* enc/trans/single_byte.erb.c: new file.

	* enc/trans/japanese.erb.c: new file.

	* enc/trans/korean.erb.c: new file.

	* enc/trans/iso-8859-2-tbl.rb: new file.

	* enc/trans/iso-8859-3-tbl.rb: new file.

	* enc/trans/iso-8859-4-tbl.rb: new file.

	* enc/trans/iso-8859-5-tbl.rb: new file.

	* enc/trans/iso-8859-6-tbl.rb: new file.

	* enc/trans/iso-8859-7-tbl.rb: new file.

	* enc/trans/iso-8859-8-tbl.rb: new file.

	* enc/trans/iso-8859-9-tbl.rb: new file.

	* enc/trans/iso-8859-10-tbl.rb: new file.

	* enc/trans/iso-8859-11-tbl.rb: new file.

	* enc/trans/iso-8859-13-tbl.rb: new file.

	* enc/trans/iso-8859-14-tbl.rb: new file.

	* enc/trans/iso-8859-15-tbl.rb: new file.

	* enc/trans/eucjp-tbl.rb: new file.

	* enc/trans/sjis-tbl.rb: new file.

	* enc/trans/euckr-tbl.rb: new file.

	* enc/trans/utf_16_32.c: regenerated.

	* enc/trans/single_byte.c: regenerated.

	* enc/trans/japanese.c: regenerated.

	* enc/trans/korean.c: regenerated.

	[ruby-dev:35730]

Tue Aug  5 18:02:53 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/io/nonblock/test_flush.rb (TestIONonblock#test_flush):
	  rescue some exceptions. [ruby-dev:35638]

Tue Aug  5 16:40:06 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (chdir): handle 5xx errors correctly.
	  fixed [ruby-core:18057].

Tue Aug  5 16:38:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h, bcc32/Makefile.sub (config.h): bcc 5.8 has
	  stdint.h.

Tue Aug  5 16:13:05 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (disconnect): do not refer to SSL::SSLSocket for
	  environments without OpenSSL. fixed [ruby-dev:35755].

Tue Aug  5 14:19:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_stat_mode): generalized st_mode mask.

Tue Aug  5 12:43:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (retry_sendfile, retry_read): ENOSYS and EWOULDBLOCK are not
	  defined on every platforms.

Tue Aug  5 12:34:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode_data.h (TRANSCODE_ERROR): common transcode failure
	  exception, would be changed later.

	* enc/trans/japanese.c (UNSUPPORTED_MODE): unsupported mode transition
	  exception.

Tue Aug  5 03:29:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sort_bang): respect overridden <=> for String and
	  Fixnum.  [ruby-core:17708]

	* include/ruby/node.h (NOEX_BASIC): basic definition method flag.

	* include/ruby/intern.h, vm_method.c (rb_method_basic_definition_p):
	  new function to check if the method is not redefined after the
	  initialization.

	* vm_method.c (rb_obj_respond_to): use rb_method_basic_definition_p.

Mon Aug  4 20:39:06 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* Makefile.in (update-rubyspec): renamed the rubyspec directory
	  "spec". Changed directory structure.

	* Makefile.in (test-rubyspec): ditto.

	* spec/README: described the structure of "spec" directory.

	* spec/default.mspec: configured for Matz's Ruby Implementation.

Mon Aug  4 19:21:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_tmp_new): added.

	* vm_eval.c (vm_call_super): fixed typo, and get rid of too large
	  alloca.  [ruby-core:17922]

Mon Aug  4 16:48:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (deferred_nodes, compstmt, arg, fixup_nodes, range_op): fix
	  up fixnum range literal in conditional as automagical line number
	  comparison.  [ruby-core:12124], [ruby-dev:35731]

Mon Aug  4 14:41:25 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* lib/net/smtp.rb (Net::SMTP::rcptto): fix a typo. a patch from
	  Masao Takaku <masao at nii.ac.jp>
	  fix [ruby-dev:35489].

Mon Aug  4 14:08:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (dump_ensure), process.c (run_exec_dup2),
	  string.c (rb_str_replace), transcode.c (transcode_dispatch): fixed
	  memory leaks.  based on patches from shinichiro.h <shinichiro.hamaji
	  AT gmail.com> at [ruby-dev:35751].

Sun Aug  3 19:32:52 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (hash2named_arg): refactoring.

	* ext/win32ole/win32ole.c (ole_invoke, fole_respond_to, ev_on_event,
	  fev_off_event): accepts Symbol argument.

	* test/win32ole/test_win32ole.rb: ditto.

	* test/win32ole/test_win32ole_event.rb: ditto.

Sun Aug  3 10:41:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_shared_replace): fixed memory leak.  a patch from
	  shinichiro.h <shinichiro.hamaji AT gmail.com> at [ruby-dev:35742]

Sat Aug  2 22:55:41 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_err_in_callback.rb: remove temporary files.
	  some refactoring.

Sat Aug  2 15:51:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (yylex): 8 and 9 in octal integer should cause compile
	  error.  [ruby-dev:35729]

Sat Aug  2 01:06:10 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.c: add U+FF5E to EUC-JP.
	  [ruby-dev:35720] [ruby-dev:35722]

Fri Aug  1 23:49:44 2008  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: checked to have clear_history in
	  readline library.
	* ext/readline/readline.c (hist_get, hist_each, Init_readline):
	  The offset specified for the argument of history_get() might be
	  different in GNU Readline and libedit. If use libedit, it was
	  corrected that the computational method of the offset specified
	  for the argument of history_get() when the Readline module was
	  initialized was decided.
	  (hist_get, hist_set): If use libedit, accesses first an input
	  content in history when specifies the negative offset for the
	  argument of history_get() or replace_history_entry(). Then
	  checks the offset is negative in ruby.
	  (rb_remove_history): When compiling, it corrects it to warning
	  when libedit is used.
	  (hist_clear, Init_readline): added Readline::HISTORY.clear
	  method. [ruby-dev:35551]
	* test/readline/test_readline_history.rb: added unit test for
	  Readline::HISTORY.

Fri Aug  1 23:26:45 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (transcode_loop): undefined character is replaced with
	  only one character. [ruby-dev:35709]

Fri Aug  1 23:26:22 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	Merged r16430(akr), r16431(akr), r16433(akr), r16469(nobu), and
	r17874(akr) from ruby_1_8.

	* Makefile.in (update-rubyspec): added

	* Makefile.in (test-rubyspec): added

Fri Aug  1 23:16:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.c: add support for CP51932,

Fri Aug  1 22:59:40 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.c: add U+FF0C,

Fri Aug  1 21:49:41 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/sdbm/test_sdbm.rb: add some tests.

Fri Aug  1 21:36:00 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (allocate_heaps, assign_heap_slot, rb_newobj_from_heap):
	  reset during_gc before raising NoMemoryError.

Fri Aug  1 21:29:56 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (Init_BareVM): check failure of malloc().

Fri Aug  1 20:55:27 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.c (to_SHIFT_JIS_EF_BF_offsets): add U+FFF3,
	  U+FFF4, U+FFF5.

	* enc/trans/japanese.c (to_SHIFT_JIS_EF_BF_infos): ditto.

	* enc/trans/japanese.c (to_EUC_JP_EF_BF_infos): added.

	* enc/trans/japanese.c (to_EUC_JP_EF_BF): added.

	* enc/trans/japanese.c (to_EUC_JP_EF_infos): change size.
	  [ruby-dev:35714]

Fri Aug  1 18:27:15 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* parse.y (parser_yylex): removed an useless conditional, and magic
	  comment are ignored unless at the first of line.

	* test/ruby/test_m17n.rb (test_magic_comment_vim): added.

	* test/ruby/test_m17n.rb (test_magic_comment_at_various_positions):
	  added.

Fri Aug  1 14:54:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_seekdir): no need to rewind to seek forward.

Fri Aug  1 05:31:08 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (output_replacement_character):
	  rename from _get_replacement_character.

	* transcode.c (output_replacement_character):
	  fix replacement on UTF-32{BE,LE}. [ruby-dev:35705]

	* transcode.c (transcode_loop): ditto.

	* test/ruby/test_transcode.rb (test_invalid_replace):
	  add for above.

Fri Aug  1 01:01:49 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (rb_proc_call_with_block): reduce comparison.

Thu Jul 31 22:17:35 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (VpMult): prevent memory leak.

Thu Jul 31 20:05:56 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_transcode.rb (test_unicode_public_review_issue_121):
	  fix option1 and 3.

Thu Jul 31 19:54:57 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (get_replacement_character): use U+FFFD as replacement
	  character when convert to Unicode.

	* test/ruby/test_transcode.rb (test_unicode_public_review_issue_121):
	  rename from test_public_review_issue_121.

	* test/ruby/test_transcode.rb (test_unicode_public_review_issue_121):
	  enable option2.

Thu Jul 31 17:00:10 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (get_replacement_character): fix: invalid byte sequence
	  is always replaced "\x00?".

Thu Jul 31 16:37:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rubygems/test_gem_ext_configure_builder.rb
	  (test_self_build_fail): remove extra newline. [ruby-dev:35704]

Thu Jul 31 15:11:11 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb: added test_shift_jis
	  (contributed by Yoshihiro Kambayashi) and
	  test_public_review_issue_121
	  (see http://www.unicode.org/review/pr-121.html)

Thu Jul 31 13:18:30 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* include/ruby/ruby.h (struct RString): size of ary must be
	  RSTRING_EMBED_LEN_MAX + 1.

Thu Jul 31 12:23:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_unpack): upper half of hexdigits has never been used.

Thu Jul 31 11:31:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/syck.h (ASSERT): fix typo at r18176.

	* ext/syck/rubyext.c (rb_syck_compile): expression in ASSERT() has no
	  effect unless debug mode.

Thu Jul 31 10:51:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (ruby_iseq_disasm_insn): suppress warnings on platforms which
	  int size differs from pointer size.

	* ext/openssl/ossl_asn1.c (ossl_asn1_get_asn1type): ditto

	* ext/syck/rubyext.c (rb_syck_err_handler),
	  (syck_default_error_handler): ditto.

Thu Jul 31 02:21:39 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/syck/rubyext.c (rb_syck_compile): remove meaningless branch
	  that misleads into thinking that the variable sav may be
	  uninitialized.

Thu Jul 31 01:25:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_mutex_unlock_all): mutex is no longer a ruby object.

Thu Jul 31 01:18:07 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (magic_comment_encoding): remove meaningless null check.

Thu Jul 31 01:09:28 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (VpIsRoundMode): fix tautology
	  condition.

Thu Jul 31 00:58:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_unpack): reduced static variables.

Thu Jul 31 00:10:20 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (rb_proc_call_with_block): prevent null reference.

Wed Jul 30 22:19:13 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (vtable_free): remove meaningless null check.

Wed Jul 30 22:08:25 2008  Tanaka Akira  <akr@fsij.org>

	* dir.c (struct dir_data): change path field char * to VALUE.
	  (mark_dir): new function for mark path field.
	  (free_dir): follow the path field change.
	  (dir_s_alloc): ditto.
	  (dir_initialize): ditto.
	  (dir_s_open): ditto.
	  (dir_inspect): ditto.
	  (dir_path): return (duplicate of) the path field to preserve
	  encoding.  [ruby-dev:35685]

Wed Jul 30 22:06:56 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (sym_inspect): remove dead code.

Wed Jul 30 21:32:52 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ChangeLog: fix wrong method name and add reference.

Wed Jul 30 21:30:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* regparse.c (name_add): fix memory leak.

Wed Jul 30 21:08:06 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/syck/syck.c (syck_free_parser): fix memory leak by
	  YAML::Syck.compile.

	* regparse.c (parse_exp): fix memory leak at Regexp.new("x{1,1}").

Wed Jul 30 17:48:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_select): recalc the rest of timeout for each
	  iterations.  [ruby-core:18015]

Tue Jul 29 23:37:37 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (io_ungetc): raise NotImplementedError when ungetc is called
	  against dummy encoding IO.  [ruby-dev:35686]

	* io.c (rb_io_getline_1): ditto when gets with delimiter is called.

	* io.c (io_getc): ditto when getc is called.

	* test/ruby/test_io_m17n.rb (test_terminator_stateful_conversion,
	  test_getc_stateful_conversion, test_ungetc_stateful_conversion):
	  these tests should raise NotImplementedError.

Tue Jul 29 22:55:34 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_io.rb (pipe): run reader thread and writer thread.

Tue Jul 29 21:38:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal): fix typo.

Tue Jul 29 21:35:59 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/etc/test_etc.rb (test_passwd): age field may be string under
	  some environments.

Tue Jul 29 17:54:35 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (char_casecmp): fix: return 0 if either of characters is NUL.

Tue Jul 29 13:17:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/etc/test_etc.rb (test_getpwuid): fix for users whose uid is
	  shared.

Tue Jul 29 05:37:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_find_file_ext, rb_find_file): explicit relative path
	  which starts with "./" or "../" should be searched from cwd
	  instead of load path.  [ruby-dev:35673]

Tue Jul 29 02:39:46 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* math.c (math_atanh): raise EDOM on FreeBSD when atanh(1).

	* math.c (math_log): ditto.

	* math.c (math_log2): ditto.

	* math.c (math_log10): ditto.

	* test/ruby/test_math.rb: test for above.

Tue Jul 29 01:41:15 2008  Tanaka Akira  <akr@fsij.org>

	* dir.c (struct dir_data): intenc field removed.
	  (dir_s_alloc): intenc initialization removed.
	  (dir_initialize): :internal_encoding option removed.  dirname code
	  conversion removed.
	  (dir_enc_str): code conversion removed.
	  [ruby-dev:35661]

Mon Jul 28 21:32:17 2008  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/: use PNG instead of zlib as binary data.

Mon Jul 28 21:24:33 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.[ch] (cond_every_entry, rb_thread_cond_struct): reverted
	  r18239 because r18245 made the changes unnecessary.

	* thread.c (rb_mutex_struct): define after including thread_{pthread,
	  win32}.c.

Mon Jul 28 21:00:10 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_require.rb (test_require_too_long_filename):
	  Kernel#require does not use dln_find_file_r (at r18242).

Mon Jul 28 20:17:03 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_core.h: move the definition of struct rb_mutex_struct.

	* thread.c: ditto.

Mon Jul 28 18:58:46 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (mutex_unlock): fix typo.

Mon Jul 28 18:15:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_find_file_ext, rb_find_file): not to split load path with
	  path separator.  [ruby-Bugs-21356]

Mon Jul 28 18:14:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (overlapped_socket_io, fcntl, rb_w32_close): must not
	  pass a pointer to int which is smaller than st_data_t on mswin64.

Mon Jul 28 16:49:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (CreateChild, overlapped_socket_io): suppress
	  warnings.

Mon Jul 28 16:06:36 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (MAXPATHLEN): define before use.

Mon Jul 28 16:01:12 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.[ch] (cond_every_entry, rb_thread_cond_struct): moved
	  the definitions from .c to .h because rb_thread_cond_struct is used
	  in vm_core.h.

Mon Jul 28 14:29:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (load_lib): use dln_find_file_r instead of dln_find_file.

Mon Jul 28 00:18:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_core.h, thread.c: It is now prohibited to use Data_Get_Struct in
	  *_free against an object that is going to be free'ed.  So, change type
	  of thread_t#keeping_mutexes from VALUE to mutex_t.

	* vm.c: remove mark to keeping_mutexes.

Sun Jul 27 23:32:42 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/openssl/test_ssl.rb (server_loop): rescue Errno::EINVAL and
	  Errno::ECONNABORTED.

Sun Jul 27 22:11:57 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* bootstraptests/method.rb: increase RLIMIT_STACK size to 4M+8Kbytes
	  because FreeBSD fails this less than that.

Sun Jul 27 21:45:59 2008  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_mark_children, obj_free): T_DEFERRED should not be appear.

	* gc.c (gc_sweep, finalize_list): fix to decrement heap_slot#limit
	  after executing finalizer.

Sun Jul 27 14:48:37 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: add a type T_DEFERRED.

	* gc.c: fix deferred finalizer system.  finalize processes of
	  T_DATA and T_FILE are executed after gc process.
	  And fix to use BUILTIN_TYPE() instead of seeing flag.

	* thread.c, vm_core.h: add RUBY_VM_SET_FINALIZER_INTERRUPT()
	  and check interrupt_flag at rb_thread_execute_interrupts().

	* thread.c (mutex_mark): fix to mark next_mutex.

	* vm.c (rb_thread_mark): fix to mark keeping_mutexes.

Sun Jul 27 09:15:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.h (dln_find_exe, dln_find_file): deprecated, use reentrant
	  versions instead.

Sun Jul 27 09:02:32 2008  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/tuplespace.rb: merged from 1.8.

	* test/rinda/test_rinda.rb: merged from 1.8.

Sat Jul 26 22:45:18 2008  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* sample/exyacc.rb: fixed NoMethodError(Kernel#sub!).
	  replaced use of special variables with explicit IO
	  operations.

Sat Jul 26 21:17:18 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (Init_win32ole): add
	  WIN32OLE_EVENT#handler=, WIN32OLE_EVENT#handler

	* test/win32ole/test_win32ole_event.rb: ditto.

Sat Jul 26 07:44:14 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (add_event_call_back): remove unused
	  variable.

Fri Jul 25 23:48:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (gc_sweep, obj_free, run_final): defer finalizers of IO and
	  Data.  [ruby-dev:35578]

Fri Jul 25 23:35:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils#split_header_value):
	  reduce backtrack.  based on a fix by Christian Neukirchen
	  <chneukirchen AT gmail.com>.

Fri Jul 25 21:55:38 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/enc/test_koi8.rb: move from test/ruby/test_koi8.rb.

Fri Jul 25 21:09:32 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_invoke, add_event_callback,
	  rescue_callback): refactoring.

Fri Jul 25 20:52:44 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/err_in_callback.rb: add test of raising
	  exception in WIN32OLE_EVENT callback.

	* test/win32ole/test_err_in_callback.rb: ditto.

Fri Jul 25 20:43:57 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (Init_win32ole): add
	  WIN32OLE_EVENT#off_event.

	* test/win32ole/test_win32ole_event.rb: ditto.

	* test/win32ole/test_win32ole_event.rb: some refactoring.

Fri Jul 25 19:50:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regint.c (xmalloc, xrealloc, xfree): not to use ruby managed memory.

Fri Jul 25 15:52:40 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c (vm_invoke_proc): skip setting safe_level if
	  it from bmethod.  This change makes test/ruby/test_proc.rb pass.

Fri Jul 25 10:00:00 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb: refactoring/cleanup of
	  test_iso_2022_jp(_1)

Fri Jul 25 04:12:57 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf.c (rb_nkf_convert): output of mime encode is US-ASCII.
	  [ruby-list:45257]

Fri Jul 25 02:43:11 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* sample/coverage.rb: move from lib/coverage.rb because this remains in
	  an early phase of development.

Fri Jul 25 00:10:23 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_find_file_ext, rb_find_file): converts Windows style path
	  to Cygwin path.  [ruby-dev:35647]

Thu Jul 24 16:30:21 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (exit_handler): use st_free_table() to free socklist.

	* win32/win32.c (rb_w32_pipe_exec, rb_w32_accept, rb_w32_socket,
	  rb_w32_socketpair): should check and release fd and sockets/handles
	  if an error occurs in rb_w32_open_osfhandle().

Thu Jul 24 16:05:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (overlapped_socket_io): avoid warnings.

	* thread_win32.c (ubf_handle): refactoring.

Thu Jul 24 07:01:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/win32ole/win32ole.c: got rid of improper casts.

Wed Jul 23 23:19:15 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/socket/test_tcp.rb (test_recvfrom): replace an irrelevant test
	  for old behavior.

Wed Jul 23 21:38:16 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_marshal.rb: suppress warning during test.

Wed Jul 23 21:35:53 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_dir.rb: suppress warning during test.

Wed Jul 23 18:27:46 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/{stubs,tcltklib}.c, ext/tk/tkutil/tkutil.c: fix warnings
	  about constness and signedness.

Wed Jul 23 17:04:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/openssl_missing.h (d2i_of_void): define for older
	  versions.  [ruby-dev:35637]

Wed Jul 23 13:53:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/curses/extconf.rb: use try_static_assert.

Wed Jul 23 10:06:19 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/zlib/test_zlib.rb (TestZlibDeflate#test_params): suppress a
	  finalizer warning.

Wed Jul 23 06:25:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck: suppress warnings more.

Wed Jul 23 03:19:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (struct input_code.name, input_codename):
	  constified.

Wed Jul 23 03:02:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck: suppress warnings.

Wed Jul 23 00:34:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl: suppress warnings.

Tue Jul 22 23:01:34 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/syck/rubyext.c, ext/syck/yaml2byte.c, ext/syck/emitter.c,
	  ext/syck/syck.c, ext/syck/handler.c, ext/syck/syck.h: suppress GCC
	  warning.

Tue Jul 22 20:42:24 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimalCmp): BigDecimal#<=> should
	  return nil if an argument can't be coerced into BigDecimal.

	* ext/bigdecimal/bigdecimal.h, ext/bigdecimal/bigdecimal.c
	  (VpIsNegDoubleZero, VpItoV): comment out unused functions.

Tue Jul 22 20:33:54 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/rdoc/test_rdoc_parser_ruby.rb (teardown): close tempfile.

Tue Jul 22 19:38:38 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb: added two comments

Tue Jul 22 18:08:34 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* README.EXT, README.EXT.ja: mention about FIX2LONG and NUM2LONG.
	  see [ruby-dev:35197]

Tue Jul 22 17:53:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (insn_data_to_s_detail), file.c (rb_stat_inspect),
	  iseq.c (ruby_iseq_disasm_insn, ruby_iseq_disasm),
	  process.c (pst_message), re.c (match_inspect): use rb_str_catf.

	* dir.c (dir_inspect), iseq.c (iseq_inspect, insn_operand_intern): use
	  rb_sprintf.

	* error.c (rb_name_error, rb_raise, rb_loaderror, rb_fatal): use
	  rb_vsprintf.

Tue Jul 22 17:20:25 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (init_func): new function to get API's address which
	  is often used and not supported on all Windows.

	* win32/win32.c (overlapped_socket_io): shouldn't use overlapped I/O if
	  CancelIo() is not supported.

Tue Jul 22 16:47:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h, sprintf.c (rb_str_catf, rb_str_vcatf): new
	  functions.  [ruby-dev:35597]

	* string.c (rb_str_capacity): new function to return the capacity.

Tue Jul 22 16:08:58 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (connect_blocking, socks_connect_blocking,
	  ruby_connect): cast.

Tue Jul 22 11:05:08 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_dir.rb: use realpath of tmpdir. [ruby-dev:35481]

	* test/ruby/test_process.rb: ditto.

Tue Jul 22 09:51:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el: fix here-doc strings with inner quotes.  patches
	  by Nathan Weizenbaum <nex342 AT gmail.com> from [ruby-core:17615]
	  through [ruby-core:17910].

Tue Jul 22 04:26:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_str_buf_new2): optimization for literals.

	* string.c (str_buf_cat): returns VALUE.

Tue Jul 22 03:34:01 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc*: Update to RDoc 2.1.0 r112.

Tue Jul 22 02:51:46 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_str_buf_cat2, rb_str_cat2): optimization
	  for literals.

Tue Jul 22 02:50:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja (1.5 Manipulating Ruby data): fix the
	  prototype of rb_vsprintf, and added rb_str_cat2.  [ruby-dev:35622]

Mon Jul 21 17:15:38 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_filesystem_encoding): use locale encoding on Unix.
	  [ruby-dev:35617]

Mon Jul 21 15:29:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/vsnprintf.c (struct __sbuf, FILE): use size_t.

	* sprintf.c (ruby__sfvwrite): ditto.

Mon Jul 21 13:55:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja (1.5 Manipulating Ruby data): mentioned
	  rb_sprintf and rb_vsprintf.  [ruby-dev:35611]

Mon Jul 21 10:25:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (prepare_getline_args): check if rs is a string when non-nil
	  lim is given.  [ruby-dev:35610]

Mon Jul 21 04:55:20 2008  Tanaka Akira  <akr@fsij.org>

	* dir.c (dir_initialize): use rb_convert_type instead of
	  rb_check_convert_type to prevent SEGV by Dir.new(".", true).
	  (dir_initialize): use FilePathValue before rb_enc_get(dirname) to
	  prevent SEGV by Dir.new(0).

Mon Jul 21 04:42:15 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_s_union): useless rb_enc_get call removed to prevent
	  SEGV by Regexp.union("", nil).

Sun Jul 20 22:50:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): NODE_POSTEXE should set each end
	  procs only once.  [ruby-dev:35596]

Sun Jul 20 16:00:37 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (EVENTSINK_Invoke): use rb_protect
	  instead of rb_rescue2. [ruby-dev:35595]

Sun Jul 20 01:23:24 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (EVENTSINK_Invoke): little refactoring.

	* ext/win32ole/win32ole.c (EVENTSINK_GetIDsOfNames): return
	  ITypeInfo::GetIDsOfNames().

Sat Jul 19 09:31:35 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (EVENTSINK_Invoke): little refactoring.

	* ext/win32ole/win32ole.c: add document of inspect methods.

Sat Jul 19 06:08:43 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc*: Import RDoc r104.  Various make test-all fixes.

Sat Jul 19 00:27:58 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (check_uint, rb_num2uint, rb_fix2uint): fixed wrong check
	  about 64bit positive value.

Fri Jul 18 23:23:37 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (EVENTSINK_Invoke): avoid cfp consistency
	  error when exception raised in event callback.

Fri Jul 18 14:52:14 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (socklist): table for registering socket options
	  (currently only O_NONBLOCK).

	* win32/win32.c (StartSockets, exit_handler): alloc/free socklist.

	* win32/win32.c (is_socket): use socklist.

	* win32/win32.c (rb_w32_accept, rb_w32_socket, rb_w32_socketpair):
	  register new socket to socklist.

	* win32/win32.c (rb_w32_close): remove closing socket from socklist.

	* win32/win32.c (fcntl): register socket options.

	* win32/win32.c (overlapped_socket_io): send to/recv from socket with
	  overlapped operation if the socket is not nonblocking mode.
	  [experimental]

	* win32/win32.c (rb_w32_send, rb_w32_sendto, rb_w32_recv,
	  rb_w32_recvfrom): use overlapped_socket_io().

	* win32/win32.c (open_ifs_socket): set overlapped mode. this is the
	  default mode of winsock's socket(), so lacking it is an old bug.

Fri Jul 18 09:44:30 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/*: Import RDoc r101.

Thu Jul 17 23:45:55 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/rdoc/test_rdoc_c_parser.rb (teardown): close tempfile.

Thu Jul 17 21:08:49 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_process.rb (test_getpriority, test_setpriority): use
	  PRIO_PROCESS instead of PRIO_USER.

Thu Jul 17 20:41:42 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* pack.c (pack_unpack): fix v and V with big endian.
	  [1].pack("V").unpack("V") was [4294967296].

Thu Jul 17 20:35:03 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* pack.c (pack_pack): fix i! with big endian.  [1].pack("i!") was
	  "\0\0\0\0".

Thu Jul 17 16:48:40 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (ruby_connect): select() for connect() has
	  mean only when the socket is non-blocking.

Thu Jul 17 10:55:24 2008  Eric Hodel  <drbrain@segment7.net>

	* mkconfig.rb: Simplify expression for RDoc.

Thu Jul 17 10:21:15 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (check_uint, rb_num2uint, rb_fix2uint): strict check.
	  fixed [ruby-dev:33683]

Thu Jul 17 04:19:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): wake up joining threads.

	* thread.c (sleep_forever, sleep_timeval): return when interrupted.
	  [ruby-dev:35542]

	* thread.c (timer_thread_function): restore main thread status.
	  [ruby-core:17270]

Thu Jul 17 01:27:38 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (appendline): remove invalid access.

Wed Jul 16 18:04:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (signal_exec, trap_handler): trap accepts a string as
	  command.  [ruby-dev:35533]

Wed Jul 16 00:04:30 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/envutil.rb (Test::Unit::Assertions#assert_in_out_err): new
	  method.

	* test/ruby/test_argf.rb: use assert_in_out_err instead of
	  EnvUtil.rubyexec.

	* test/ruby/test_module.rb: ditto.

	* test/ruby/test_require.rb: ditto.

	* test/ruby/test_objectspace.rb: ditto.

	* test/ruby/test_object.rb: ditto.

	* test/ruby/test_string.rb: ditto.

	* test/ruby/test_method.rb: ditto.

	* test/ruby/test_variable.rb: ditto.

	* test/ruby/test_io.rb: ditto.

	* test/ruby/test_rubyoptions.rb: ditto.

	* test/ruby/test_exception.rb: ditto.

	* test/ruby/test_class.rb: ditto.

	* test/ruby/test_thread.rb: ditto.

Tue Jul 15 22:34:03 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (ruby_version): follow changes in configure.in.

Tue Jul 15 21:58:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/{,tkutil/}extconf.rb: ruby/ruby.h no longer needs to be
	  checked.

	* ext/tk/{tcltklib.c,tkutil/tkutil.c}: check macros for each headers.

Tue Jul 15 21:45:41 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/tk/extconf.rb, ext/tk/tcltklib.c, ext/tk/tkutil/tkutil.c: Do
	  not test ruby/ruby.h, which makes OS X's gcc pick the wrong
	  header file from Ruby.framework.

Tue Jul 15 21:31:26 2008  Akinori MUSHA  <knu@iDaemons.org>

	* configure.in (--with-ruby-version): Add a new option to specify
	  the ruby version string for version specific directories.
	  [ruby-dev:35490]

	* mkconfig.rb: Definition of ruby_version is now determined by the
	  configure script.

Tue Jul 15 18:14:20 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (ruby_connect, s_accept): check before readable/
	  writable by select() instead of wrapping in blocking region.

	* ext/socket/socket.c (bsock_send, s_recvfrom, udp_send, unix_send_io,
	  unix_recv_io): should check readable/writable before calling blocking
	  functions.
	  see [ruby-dev:35446]

Tue Jul 15 18:12:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (ubf_handle): cancel blocking IO if it can (only
	  Vista). see [ruby-dev:35446]

	* win32/win32.c (errmap): add ERROR_OPERATION_ABORTED as EINTR.

Mon Jul 14 20:35:21 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_event.rb (teardown): fix typo.

Mon Jul 14 18:47:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_loop): constified.

	* transcode.c (str_transcode): rb_str_set_len() sets a delimiter.

	* transcode_data.h (rb_transcoder): constified preprocessor and
	  postprocessor input.

	* enc/trans/japanese.c: ditto.

Sun Jul 13 05:37:50 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (PRI_PTRDIFF_PREFIX, PRI_SIZE_PREFIX): typo.

	* {bcc32,win32}/Makefile.sub: (SIZEOF_SIZE_T, SIZEOF_PTRDIFF_T): added.

Sat Jul 12 23:54:55 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (LIBRUBY_DLDFLAGS): import library which created
	  with DLL is broken. save import library which created by lib.exe and
	  install it.
	  fixed the problem mentioned at the postscript of [ruby-dev:35448]

Sat Jul 12 23:24:21 2008  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c: use PRIuSIZE.

Sat Jul 12 22:41:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (PRI_PTRDIFF_PREFIX, PRI_SIZE_PREFIX): fixed typo.

Sat Jul 12 22:30:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (HAVE_RUBY_RUBY_H): defines macros so that
	  extconf.rb do not need to check if headers exist under separated
	  directory.  [ruby-dev:35437]

	* include/{ruby,rubyio,rubysig}.h, include/ruby/intern.h: use
	  "ruby/..." instead of <ruby/...>.

Sat Jul 12 22:17:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (sizeof ptrdiff_t): check for size of ptrdiff_t.

	* include/ruby/ruby.h (PRI?PTRDIFF, PRI?SIZE): printf conversion
	  specifiers for ptrdiff_t and size_t/ssize_t.

	* insns.def (leave), marshal.c (long_toobig), transcode.c
	  (str_transcode), vm_dump.c (control_frame_dump, stack_dump_each),
	  (debug_print_register, debug_print_pre): t and z length modifiers
	  are C99.

Sat Jul 12 16:02:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client#do_rpc): requires
	  webrick/cookie.  [ ruby-Bugs-21139 ]

Sat Jul 12 09:25:07 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_event.rb: add test
	  for WIN32OLE_EVENT#on_event_with_outargs

	* test/win32ole/test_win32ole_event.rb(teardown): calling
	  WIN32OLE_EVENT.message_loop

Sat Jul 12 01:54:13 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_select): shouldn't pass non-socket handle to
	  original select().

Fri Jul 11 23:05:40 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/zlib/test_zlib.rb: add a test for Zlib::Deflate#params.

Fri Jul 11 22:58:28 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/zlib/zlib.c (rb_deflate_params): flush before deflateParams.
	  [ruby-core:17675]

Fri Jul 11 22:09:01 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.rb, win32/Makefile.sub (PLATFORM): use $(PLATFORM)
	  instead of $(OS) because ENV["OS"] is used in test-all (drb).

Fri Jul 11 20:51:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_wait_readable, rb_io_wait_writable): check if the file
	  descriptor is closed.

	* thread.c (rb_thread_wait_fd_rw): ditto.

Fri Jul 11 16:16:43 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_accept, rb_w32_socket, rb_w32_socketpair):
	  prohibit inheritance of sockets, too. [experimental]

Fri Jul 11 14:39:49 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): the measures for Vista is no longer
	  unnecessary.

Fri Jul 11 06:16:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (process.o): depends on util.h.

Fri Jul 11 05:07:46 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (pipe): prohibit inheritance.
	  fixed: [ruby-dev:35421]

Fri Jul 11 00:56:46 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c (thread_create_core): fix GC problem.
	  [ruby-core:17669]

Thu Jul 10 22:06:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pstore.rb (PStore#transaction): return the result from the
	  block.  [ruby-core:17718]

Thu Jul 10 21:15:49 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_typelib.rb: add some illegal argument
	  test.

	* test/win32ole/test_win32ole_type.rb: ditto.

	* test/win32ole/test_win32ole_event.rb: ditto.

	* test/win32ole/test_win32ole_param.rb: ditto.

	* test/win32ole/test_win32ole_method.rb: ditto.

Thu Jul 10 19:38:35 2008  wanabe  <s.wanabe@gmail.com>

	* test/ruby/envutil.rb (assert_normal_exit): r17993 revert.

Thu Jul 10 18:29:41 2008  wanabe  <s.wanabe@gmail.com>

	* test/ruby/envutil.rb (assert_normal_exit): finish writing script
	  before spawn("ruby") to avoid blocking in win32.

Thu Jul 10 17:20:50 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (insert): follow recent changes of globbing.

Thu Jul 10 14:09:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/coverage/coverage.c (rb_coverage_start): return nil.

Thu Jul 10 12:41:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_wait_for): fixed variable name.

Thu Jul 10 12:09:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_thread_t), vm.c (rb_thread_mark), process.c
	  (rb_last_status_get, rb_last_status_set, rb_last_status_clear):
	  moved last_status from rb_vm_t.  [ruby-dev:35414]

	* vm.c (th_init2): initialize last_status with nil.

Thu Jul 10 12:09:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_wait_for): wait until timed out only when
	  sleeping with timeout.

Wed Jul  9 22:41:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (sleep_timeval): wait until timed out.  [ruby-core:17270]

Wed Jul  9 20:58:16 2008  Tanaka Akira  <akr@fsij.org>

	* array.c (rb_ary_fill): don't raise even if length is negative.
	  [ruby-core:17483], [ruby-core:17661]

Wed Jul  9 20:18:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_va_args_macro): check for __VA_ARGS__.

	* thread.c (thread_debug): show source name and line if possible.

	* thread_{pthread,win32}.c (rb_thread_create_timer_thread): needs more
	  stack for debug.

Wed Jul  9 11:13:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/profiler.rb (Profiler__#print_profile): sort in the descending
	  order of cumulative time.

Wed Jul  9 11:11:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (struct glob_args, rb_glob_caller, rb_glob2, push_pattern),
	  (glob_brace): make consistent prototypes.

	* dir.c (push_glob): set enc in the caller of rb_glob_caller as well
	  as rb_glob2.

Wed Jul  9 09:12:11 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (options): use input_endian.

Wed Jul  9 01:38:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_succ): alphabets or numerics mutually enclosing
	  non-alphanumeric characters can carry up.  e.g., "1.999".succ should
	  be "2.000".

Wed Jul  9 00:12:31 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (rb_set_coverages, rb_reset_coverages): enable and disable
	  coverage measurement.

	* thread.c (rb_get_coverages): rename and move from vm.c.

	* vm.c (rb_vm_get_coverages): ditto.

	* iseq.c (prepare_iseq_build): ditto.

	* thread.c (clear_coverage): ditto.

	* parse.y (coverage): ditto.

	* ext/coverage/coverage.c: use above functions, add new method
	  Coverage.start and fix rdoc .

Tue Jul  8 23:02:35 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (find_default_source): bug fix when
	  OLE object does not have default source interface.

	* test/win32ole/test_win32ole_event.rb: ditto.

Tue Jul  8 22:56:23 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (rb_enable_coverages): hide coverage array by setting 0 to
	  klass during measurement.

	* parse.y (coverage, yycompile0): ditto.

	* iseq.c (prepare_iseq_build): use rb_hash_lookup instead of
	  rb_hash_aref.

	* thread.c (rb_coverage_result): restore klass of coverage array
	  and return it.

	* thread.c (update_coverage): check whether its klass is 0.

Tue Jul  8 22:28:25 2008  Koichi Sasada  <ko1@atdot.net>

	* lib/debug.rb, lib/profile.rb: fix to use RubyVM.

	* lib/rdoc/parsers/parse_c.rb: ditto.

Tue Jul  8 21:45:22 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (rb_vm_mark): mark the last element of special_exceptions.

Tue Jul  8 19:55:40 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (find_default_source): try to
	  find COCLASS when WIN32OLE object is not COCLASS.

	* test/win32ole/test_win32ole_event.rb: ditto

Tue Jul  8 13:38:22 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.h: fix to skip inserting a trace insn.

Tue Jul  8 11:41:17 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* dir.c: shouldn't use ruby object in globbing, because glob service
	  routines are called before initializing ruby on some platforms (ex.
	  windows).

Tue Jul  8 10:08:40 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (Next): use rb_enc_mbclen. [ruby-dev:35390]

Tue Jul  8 07:59:40 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (Next): use rb_enc_precise_mbclen.

Tue Jul  8 02:27:23 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c: preserve encoding of strings in glob and fnmatch.

	* include/ruby/ruby.h: related changes.

Tue Jul  8 00:22:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_succ): limit carrying in an alphanumeric region if
	  exists.  [ruby-dev:35094]

Mon Jul  7 20:39:28 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c(Init_win32ole): add
	  WIN32OLE_TYPE#source_ole_types, WIN32OLE_TYPE#default_ole_types,
	  WIN32OLE_TYPE#default_event_sources.

	* test/win32ole/test_win32ole_type.rb: ditto.

Mon Jul  7 19:45:22 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_dir.rb (test_chroot_nodir): add Errno::EPERM.

Mon Jul  7 17:12:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ipaddr.rb (IPAddr#initialize): get rid of ArgumentError in
	  IPAddr#to_range.  a patch from okkez <okkez000 AT gmail.com> in
	  [ruby-dev:35091].

Mon Jul  7 01:24:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_extname): fix for file name with spaces.
	  [ruby-talk:307404]

Mon Jul  7 00:59:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (ruby_init_stack): prior STACK_END_ADDRESS if
	  found.  [ruby-core:17624]

Sun Jul  6 23:48:06 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (bsock_send, s_recvfrom, ruby_connect, s_accept),
	  (udp_send, unix_send_io, unix_recv_io): blocking region support.

Sun Jul  6 18:34:35 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_type.rb (test_initialize): add
	  more assertions.

Sun Jul  6 10:12:21 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/test/unit/collector/objectspace.rb
	  (Test::Unit::Collector::ObjectSpace::NAME): fix a typo.

Sun Jul  6 00:56:51 2008  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (host_str): fix type mismatch in rb_raise
	  format and argument.
	  (port_str): ditto.
	  (unix_recv_io): ditto.
	  (sock_s_unpack_sockaddr_un): ditto.

Sat Jul  5 23:42:23 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (NUM2INT): cast to int.
	  (FIX2INT): ditto.
	  (NUM2UINT): cast to unsigned int.
	  (FIX2UINT): ditto.

Sat Jul  5 23:10:41 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_pipe): new function for handling EMFILE and ENFILE
	  error of pipe().
	  (UPDATE_MAXFD_PIPE): removed.
	  (pipe_open): use rb_pipe.
	  (rb_io_s_pipe): ditto.

	* process.c (pipe_nocrash): use rb_pipe.

	* include/ruby/intern.h (rb_pipe): declared.

Sat Jul  5 22:22:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_initialize): NUM2INT() returns int.

	* thread.c (timer_thread_function), thread_pthread.c (thread_timer),
	  thread_win32.c (timer_thread_func), thread_{pthread,win32}.c
	  (rb_thread_create_timer_thread): passing VM.

Sat Jul  5 20:53:18 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_word.rb: check word installed.

Sat Jul  5 16:12:54 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c: revert. before lazy sweep.

Sat Jul  5 09:55:44 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE#ole_respond_to?

	* test/win32ole/test_win32ole.rb: ditto.

Sat Jul  5 08:48:05 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (unescape_nonascii): add has_property argument not to
	  raise error by /\p{Hiragana}\u{3042}/ in EUC-JP script.
	  (rb_reg_preprocess): use has_property argument to make regexp
	  encoding fixed.

Sat Jul  5 08:29:47 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (unescape_nonascii): make regexp fixed_encoding if \p is used.
	  fixed [ruby-core:17279].

Fri Jul  4 23:12:53 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (d2time): fix the bug of VT_DATE
	  to String conversion when negative value.

	* test/win32ole/test_win32ole_variant.rb: ditto.

Fri Jul  4 22:15:29 2008  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit/testcase.rb: collect descendants of
	  Test::Unit::TestCase using inherited.

	* lib/test/unit/autorunner.rb: don't use ObjectSpace.each_object.

	* lib/test/unit/collector/dir.rb: ditto.

	* lib/test/unit/collector/objectspace.rb: ditto.

	[ruby-core:17126]

Fri Jul  4 20:43:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/oniguruma.h (OnigEncoding): removed auxiliary_data.

	* include/ruby/encoding.h (ENC_DUMMY_P): moved dummy encoding flag to
	  rb_encoding from Encoding instance.

	* encoding.c (rb_encoding_list): list of Encoding instances.

	* encoding.c (struct rb_encoding_entry): moved base encoding from
	  instance variable.

Fri Jul  4 17:51:07 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (check_uint, rb_num2uint, rb_fix2uint): proper check.

Fri Jul  4 14:17:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/net/ftp.rb (Net::FTP#sendport): use divmod.  [ruby-core:17557]

Fri Jul  4 11:08:37 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (garbage_collect_force): sweep is completely ended.

	* gc.c (os_obj_of): invoke garbage_collect_force() when freelist none.

Fri Jul  4 05:01:26 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (rb_num2uint, rb_fix2uint): typo.

Fri Jul  4 02:21:06 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (check_uint, rb_num2uint, rb_fix2uint): also needs checking
	  negative value. see [ruby-dev:33683]

Thu Jul  3 23:26:36 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* include/ruby/intern.h: remove prototypes about coverage.

	* iseq.c (prepare_iseq_build): add prototype.

	* parse.y (coverage): ditto.

	* thread.c (clear_coverage): ditto.

	* thread.c (update_coverage): use rb_sourceline.

	* thread.c (rb_get_coverages): rename and move to vm.c.

	* vm.c (rb_vm_get_coverages): ditto.

	* ext/coverage/coverage.c: add rdoc.

Thu Jul  3 21:51:21 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/coverage/coverage.c, ext/coverage/extconf.rb: eliminate
	  COVERAGE__ and introduce coverage.so instead.  How to measure
	  coverage: (1) require "coverage.so", (2) require or load Ruby source
	  file, and (3) Coverage.result will return the same hash as COVERAGE__.
	  [ruby-dev:35324]

	* thread.c (rb_enable_coverages): start coverage measurement by using
	  rb_add_event_hook.

	* thread.c (rb_get_coverages): returns current results of coverage
	  measurement.

	* include/ruby/intern.h: add prototype for above two functions.

	* vm_core.h, vm.c: add field of coverages to rb_vm_t.

	* insns.def (trace): remove special handling for COVERAGE__.

	* iseq.c (prepare_iseq_build): switch COVERAGE__ to
	  rb_get_coverages().

	* parse.y (coverage): ditto.

	* thread.c (clear_coverage): ditto.

	* lib/coverage.rb: use coverage.so instead of COVERAGE__.

Thu Jul  3 21:20:45 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (thread_initialize): NUM2INT returns long.

Thu Jul  3 21:06:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (Init_eval): typo fixed in r17833.

Thu Jul  3 19:44:44 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (Init_win32ole): remove duplicate line.

Thu Jul  3 16:08:36 2008  Tanaka Akira  <akr@fsij.org>

	* configure.in (erfc): erfc of glibc comes with Debian GNU/Linux Etch
	  on IA64 is broken.  erfc(10000.0) aborts.
	  use missing/erf.c instead.
	  http://sources.redhat.com/ml/libc-hacker/2005-08/msg00008.html

Thu Jul  3 12:49:39 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/smtp.rb (Net::SMTP::start): use 'localhost' instead of
	  'localhost.localdomain'.  [ruby-dev:35333]

	* lib/net/smtp.rb (Net::SMTP::SMTP.start): ditto.

Thu Jul  3 07:06:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (SET_LC_MESSAGES): LC_MESSAGES must be C.

Thu Jul  3 07:02:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (Init_eval), gc.c (Init_GC), proc.c (Init_Proc): freeze
	  messages of preallocated special exceptions also.

Thu Jul  3 04:39:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_during_gc): VALUE cache is irrelevant.

Thu Jul  3 01:44:01 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* regint.h (GET_ALIGNMENT_PAD_SIZE, ALIGNMENT_RIGHT): cast pointer to
	  uintptr_t instead of unsigned int.

Thu Jul  3 01:23:13 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* sprintf.c: include ieeefp.h to refer to isinf.

	* ext/bigdecimal/bigdecimal.c: ditto.

	* ext/json/ext/generator/generator.c: ditto.

	* rational.c: ditto.

Thu Jul  3 01:01:57 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* missing/tgamma.c (tgamma): remove unused variable.

Thu Jul  3 00:18:00 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: avoid creating Ruby object during
	  GC. thanks to arton <artonx AT yahoo.co.jp>. [ruby-dev:35313]

	* test/win32ole/test_win32ole_event.rb: ditto.

Thu Jul  3 00:09:31 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* gc.c: add rb_during_gc(). based on a patch from arton <artonx AT
	  yahoo.co.jp> at [ruby-dev:35313].

	* include/ruby/intern.h: ditto.

Wed Jul  2 09:49:10 2008  Narihiro Nakamura  <authorNari@gmail.com>

	* gc.c (gc_lazy_sweep): use lazy sweep algorithm for response
	  performance gain.

	* gc.c (garbage_collect_force): mark and lazysweep invoke, after
	  erasing all mark.

	* gc.c (GC_NOT_LAZY_SWEEP): not lazy sweep flag. for debug.

Wed Jul  2 03:42:44 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_settracefunc.rb: fix expected traces for
	  RubyVM::FrozenCore's event and r17744.

Wed Jul  2 03:10:41 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.h, insns.def: reduce insn operand of "trace".

	* include/ruby/ruby.h: add RUBY_EVENT_COVERAGE event.

Wed Jul  2 02:02:34 2008  Koichi Sasada  <ko1@atdot.net>

	* proc.c, vm.c: fix to refer to next ruby level cfp to make binding.

Wed Jul  2 01:58:19 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* insns.def (trace): C99ism.

Wed Jul  2 01:53:40 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* Add coverage measurement constant COVERAGE__.  This constant is not
	  for casual use.  Usage: (1) assign {} to COVERAGE__, (2) require or
	  load Ruby source file, and (3) COVERAGE__["sourcefilepath"] will
	  return an array whose elements represent number of executions per
	  line of source code.

	* vm_core.h: add field of coverage array to iseq.

	* iseq.c (prepare_iseq_build): ditto.

	* insns.def (trace): update coverage array.

	* parse.y (coverage): create and initialize coverage array.

	* compile.h (ADD_TRACE): add trace instruction to update coverage
	  array.

	* thread.c (clear_coverage): delete coverage array when forking.
	  Otherwise, double count of coverage may occur.

	* lib/coverage.rb: sample coverage measurement tool.

	* error.c: distinguish explicitly between parse_in_eval and
	  mild_compile_error.

	* load.c: ditto.

	* vm_eval.c: ditto.

Tue Jul  1 21:32:43 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/test/unit/ui/console/testrunner.rb: prevent destructive
	  modification to $0.

	* test/rubygems/gemutilities.rb (build_rake_in): move from
	  test_gem_ext_rake_builder.rb.

	* test/rubygems/test_gem_ext_rake_builder.rb: ditto.

	* test/rubygems/test_gem_installer.rb: override Gem.ruby and
	  ENV["rake"].

	* test/rubygems/test_gem_uninstaller.rb: ditto.

Tue Jul  1 21:13:17 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.c, vm.c, insns.def: call FrozenCore.set_postexe method
	  instead to use "postexe" insn.

	* id.c, id.h: add a prepared id for above.

Tue Jul  1 21:09:58 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* lib/mkmf.rb (create_tmpsrc): we need to include COMMON_HEADERS,
	  namely inclusion of ruby.h, because _GNU_SOURCE is now defined
	  there (if any) and socket.so requires it on Linux systems.

Tue Jul  1 20:55:07 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* eval.c (rb_interrupt): trick to suppress GCC warning.

	* sprintf.c (rb_str_format): ditto.

Tue Jul  1 20:44:36 2008  Koichi Sasada  <ko1@atdot.net>

	* tool/instruction.rb: RubyVM is not module.

Tue Jul  1 19:31:24 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/digest/digest.c (rb_digest_instance_inspect): constified.

	* variable.c (rb_path2class): field precision should have type int.

Tue Jul  1 19:01:00 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c (code_is_ctype): HALF WIDTH KATAKANA is
	  a character.

Tue Jul  1 17:56:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/vsnprintf.c (BSD__uqtoa): constified.

Tue Jul  1 17:50:44 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/make_encdb.h: always add ';' at the end of line.

Tue Jul  1 17:44:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (COMPILE_OPTION_FALSE), time.c (timegm_noleapsecond),
	  thread.c (eKillSignal, eTerminateSignal),
	  missing/vsnprintf.c (BSD_vfprintf): constified.

Tue Jul  1 17:37:43 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* enc/ascii.c: ISO C does not allow extra ';' outside of a
	  function

	* enc/us_ascii.c: ditto.

	* enc/utf_8.c: ditto.

	* enc/big5.c: ditto.

	* enc/euc_jp.c: ditto.

	* enc/euc_kr.c: ditto.

	* enc/euc_tw.c: ditto.

	* enc/gb2312.c: ditto.

	* enc/gbk.c: ditto.

	* enc/iso_8859_1.c: ditto.

	* enc/iso_8859_2.c: ditto.

	* enc/iso_8859_3.c: ditto.

	* enc/iso_8859_4.c: ditto.

	* enc/iso_8859_5.c: ditto.

	* enc/iso_8859_6.c: ditto.

	* enc/iso_8859_7.c: ditto.

	* enc/iso_8859_8.c: ditto.

	* enc/iso_8859_9.c: ditto.

	* enc/iso_8859_10.c: ditto.

	* enc/iso_8859_11.c: ditto.

	* enc/iso_8859_13.c: ditto.

	* enc/iso_8859_14.c: ditto.

	* enc/iso_8859_15.c: ditto.

	* enc/iso_8859_16.c: ditto.

	* enc/koi8_r.c: ditto.

	* enc/shift_jis.c: ditto.

	* enc/utf_16be.c: ditto.

	* enc/utf_32be.c: ditto.

	* enc/utf_32le.c: ditto.

	* enc/windows_1251.c: ditto.

	* process.c (run_exec_rlimit): ISO C90 forbids mixed declarations
	  and code

	* include/ruby/ruby.h (enum ruby_special_consts): ISO C forbids
	  comma at end of enumerator list

	* include/ruby/ruby.h (enum ruby_value_type): ditto.

	* eval_intern.h (enum): ditto.

	* vm_core.h (enum rb_thread_status): ditto.

	* parse.y (enum lex_state_e): ditto.

	* parse.y (enum string_type): ditto.

	* process.c (enum): ditto.

	* ruby.c (enum dump_flag_bits): ditto.

	* ruby.c (enum disable_flag_bits): ditto.

	* enc/gb18030.c (enum): ditto.

Tue Jul  1 17:21:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regexec.c (stack_double): use MatchStackLimitSize atomically.

	* regparse.c (onig_free_shared_cclass_table): OnigTypeCClassTable
	  needs atomicity

	* regsyntax.c: constified all predefined OnigSyntaxTypes.

Tue Jul  1 16:57:44 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* include/ruby/st.h (struct st_table): type of bit-field
	  'num_entries' is a GCC extension

	* include/ruby/ruby.h (rb_intern): prefix __extension__ for
	  braced-groups within expressions.

	* include/ruby/intern.h (rb_usascii_str_new2): ditto.

	* include/ruby/intern.h (rb_tainted_str_new2): ditto.

	* include/ruby/intern.h (rb_str_new2): ditto.

Tue Jul  1 15:01:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/ext/builder.rb (Gem::Ext::Builder.make),
	  (Gem::Ext::Builder.run): EXIT_SUCCESS may be 0 or may not.

	* test/rubygems/test_gem_ext_rake_builder.rb (build_rake_in): override
	  Gem.ruby and ENV["rake"].

	* runruby.rb: bin/rake does not exist in archdir where architecture
	  depend script (i.e. rbconfig.rb) exists.

Tue Jul  1 13:19:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_fill): check if beg is too big.

Tue Jul  1 12:01:16 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.c, insns.def, vm.c, vm_core.h: remove some insns
	  (undef, alias, definemethod).
	  Call RubyVM::FrozenCore's singleton method instead.
	  Add "putiseq" and "putspecialobject" instructions.

	* id.c, id.h: add ids for above.

	* tool/parse.rb: "VM" no longer exists.  Use RubyVM instead.

Tue Jul  1 03:28:16 2008  Eric Hodel  <drbrain@segment7.net>

	* test/rubygems/test_ext_configure_builder.rb:  Apply locale-free
	  patch by Yusuke ENDOH.  [ruby-core:17444].

	* runruby.rb: Set ENV['rake'].  Patch by Yusuke ENDOH
	  [ruby-core:17442].

Tue Jul  1 01:07:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension.read_multipart): blanks inside
	  double quotes are allowed.  [ruby-list:45140]

Tue Jul  1 00:59:43 2008  Tanaka Akira  <akr@fsij.org>

	* numeric.c (num_coerce): call rb_Float(x) first.  don't depend on
	  evaluation order of function arguments.

Tue Jul  1 00:49:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_newobj): abort GC phase before rb_bug.

Mon Jun 30 23:15:07 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/openssl/test_ssl.rb (start_server): shutdown TCPServer before
	  close.

Mon Jun 30 23:01:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RUBY_H_INCLUDES): common headers which are included with
	  ruby.h together.

Mon Jun 30 22:57:50 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_settracefunc.rb (test_raise): reveal an exception
	  hided by rescue modifier.

Mon Jun 30 22:49:32 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb (test_aset): access with too big index
	  raises not ArgumentError but IndexError now.

Mon Jun 30 22:30:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/collector/dir.rb (recursive_collect): r15662 reverted.

Mon Jun 30 22:27:39 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/stringio/stringio.c (strio_getline): fix for nil and "" as
	  separator.  [ruby-dev:34591]

Mon Jun 30 22:21:30 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (argf_each_line): pass args to each_line. [ruby-dev:34958]

Mon Jun 30 22:12:46 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (chain_finalized_object): should not delete from finalizer
	  table until run.

	* gc.c (rb_gc_call_finalizer_at_exit): deferred_final_list may be
	  empty first.

Mon Jun 30 18:57:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (gc_finalize_deferred): allow object allocation in finalizers.

	* gc.c (rb_gc_call_finalizer_at_exit): ditto.

Mon Jun 30 14:41:36 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (rb_newobj): prohibit call of rb_newobj() during gc when
	  USE_VALUE_CACHE is not defined (normal case).

Mon Jun 30 10:28:33 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syslog/syslog.c (syslog_write): syslog operations should be
	  protected from $SAFE level 4.  a patch from Keita Yamaguchi
	  <keita.yamaguchi at gmail.com>.

	* ext/syslog/syslog.c (mSyslog_close): ditto.

	* ext/syslog/syslog.c (mSyslog_set_mask): ditto.

Mon Jun 30 03:01:35 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/net/http/test_http.rb (_test_request__file): specify encoding
	  explicitly.

	* test/net/http/utils.rb: ditto.

Mon Jun 30 02:31:07 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_utf8_encindex): defined.

	* include/ruby/encoding.h (rb_utf8_encindex): ditto.

Mon Jun 30 02:14:34 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_core.h,vm_core.h, vm_dump.c, iseq.c: rename class name
	  VM -> RubyVM, and rename rb_cVM -> rb_cRubyVM.
	  "VM" is too short name for class.

	* test/ruby/test_method.rb, test/ruby/test_settracefunc.rb: ditto.

	* include/ruby/ruby.h: rb_cRubyVM, rb_cEnv, rb_cISeq should not be
	  exposed.

Mon Jun 30 02:10:32 2008  Koichi Sasada  <ko1@atdot.net>

	* process.c (Init_process): fix to avoid a warning.

Mon Jun 30 01:52:05 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_parse.rb: remove tests for open_args.

Sun Jun 29 23:01:54 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_format_m): make tmp volatile to avoid possible GC
	  problem.

Sun Jun 29 18:01:30 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb, lib/rss/utils.rb: merge documents from ruby_1_8.

Sun Jun 29 17:44:23 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb (RSS::ListenerMixin#known_class): define to
	  work with ruby 1.8.x too.

Sun Jun 29 17:41:42 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb (RSS::Maker::RSSBase#to_feed): raise
	  exception not return nil if RSS::Maker.make can't get required
	  information.

	* test/rss/rss-assertions.rb: follow the above change.

Sun Jun 29 17:37:23 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb (RSS::Maker::RSSBase#make): require block.

	* test/rss/test_maker_{0.9,1.0,2.0}.rb: follow the above change.

Sun Jun 29 17:33:34 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb, lib/rss/maker/itunes.rb: don't use
	  instance_eval to initialize variables. (speed up)

Sun Jun 29 17:31:15 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb, test/rss/test_version.rb (RSS::VERSION):
	  0.2.4 -> 0.2.5.

Sun Jun 29 11:36:20 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* dir.rb: fix resource leak.

Sun Jun 29 09:43:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tmpdir.rb (@@systmpdir): prior LOCAL_APPDATA if possible, and
	  should be clean.  based on a patch from arton <artonx AT
	  yahoo.co.jp> at [ruby-dev:35269]

Sun Jun 29 07:53:08 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (date2time_str): fix the overflow in
	  some situation. [ruby-bugs-20793]

Sat Jun 28 21:25:08 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (struct RRegexp): new field usecnt.  replace
	  str and len by src.

	* gc.c (gc_mark_children): mark src field of regexp.
	  (obj_free): don't free str field.

	* re.c (REG_BUSY): removed.
	  (rb_reg_initialize): prohibit re-initialize regexp.
	  (rb_reg_search): use usecnt to prevent freeing regexp currently
	  using.  this prevents SEGV by:
	    r = /\A((a.)*(a.)*)*b/
	    r =~ "ab" + "\xc2\xa1".force_encoding("euc-jp")
	    t = Thread.new { r =~ "ab"*8 + "\xc2\xa1".force_encoding("utf-8")}
	    sleep 0.2
	    r =~ "ab"*8 + "\xc2\xa1".force_encoding("euc-jp")

Sat Jun 28 21:15:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_str_new2, rb_tainted_str_new2,
	  rb_usascii_str_new2): use inline versions only for constant
	  literals.

Sat Jun 28 13:12:06 2008  Tanaka Akira  <akr@fsij.org>

	* test/rubygems/test_gem.rb (test_self_path_APPLE_GEM_HOME): don't use
	  fixed /tmp/apple_gem_home directory.

Sat Jun 28 08:40:18 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: check String encoding when
	  converting String to VT_BSTR in OLE.

	* test/win32ole/test_win32ole.rb: ditto.

Sat Jun 28 01:08:42 2008  Tanaka Akira  <akr@fsij.org>

	* time.c (time_timespec): fix rounding negative float.

Fri Jun 27 21:38:57 2008  Tanaka Akira  <akr@fsij.org>

	* struct.c: __size__ removed.  use the length of __members__ instead.
	  (num_members): new function.

Fri Jun 27 21:19:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/inlinetest.rb (InlineTest.in_progname): workaround for frozen
	  $0.  [ruby-dev:35261]

	* lib/test/unit/ui/console/testrunner.rb (TestRunner#finished): ditto.

Fri Jun 27 17:45:17 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/erb.rb: adjust line number for magic comment.

	* test/erb/test_erb.rb: add tests for def_method.

Fri Jun 27 14:29:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (primary): empty not should call '!' on nil.
	  cf [ruby-dev:35227]

Fri Jun 27 14:25:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_eval_body): if thrown exception is frozen, reraise it to
	  create a new instance.

Fri Jun 27 13:29:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_str_new2, rb_tainted_str_new2,
	  rb_usascii_str_new2): use with-length versions with strlen to
	  optimize strlen, if optimized.

Fri Jun 27 12:28:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/un.rb (mkmf): new command to create makefile.

Fri Jun 27 11:06:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/un.rb (wait_writable): added help message.

Fri Jun 27 06:52:54 2008  Koichi Sasada  <ko1@atdot.net>

	* configure.in: need a ",".

	* process.c (rb_fork): check CANNOT_FORK_WITH_PTHREAD macro.

Fri Jun 27 06:50:56 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_eval.c (vm_call_super): fix to call method_missing.
	  [ruby-core:15719], [ruby-core:17340]

Fri Jun 27 00:00:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (set_arg0, ruby_prog_init): freeze $0.  a patch from Keita
	  Yamaguchi <keita.yamaguchi at gmail.com>.

Thu Jun 26 23:58:29 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (rb_str_index_m, rb_str_rindex_m, rb_str_include): fix
	  rdoc.

Thu Jun 26 17:43:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_f_trace_var): should not be allowed at safe level 4.
	  a patch from Keita Yamaguchi <keita.yamaguchi at gmail.com>.

Thu Jun 26 11:04:30 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems: Update to RubyGems 1.2.0 r1824.  Incorporates patch by
	  Yusuke ENDOH [ruby-core:17353].

Thu Jun 26 00:48:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (primary): not operand might be empty.  [ruby-dev:35227]

Wed Jun 25 21:54:34 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (primary): make functional-style not operator to act
	  like function.  see <http://d.hatena.ne.jp/ku-ma-me/20080624/p1>.

Wed Jun 25 15:28:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_fill): not depend on unspecified behavior at integer
	  overflow.  reported by Vincenzo Iozzo <snagg AT openssl.it>.

Wed Jun 25 13:42:44 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/erb.rb (ERB::Compiler:Buffer#new): push magic comment first.

	* lib/erb.rb (ERB::Compiler#compile): fix for broken input.

Wed Jun 25 12:10:01 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/erb.rb (ERB::Compiler#compile): magic comment needs LF.

Wed Jun 25 09:31:11 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/erb.rb (ERB::Compiler#compile): output magic comment.

Tue Jun 24 22:14:36 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (eval_string_with_cref): preserve parse_in_eval even if
	  exception raised.

Tue Jun 24 22:09:18 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c(ole_invoke): fix memory leak.
	  [ruby-bugs-20792]

Tue Jun 24 17:20:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_fork_with_pthread): check after check for
	  pthread library, and define the macro when checked only.

Tue Jun 24 17:04:39 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/io/wait/extconf.rb: check sys/socket.h for cygwin.

Tue Jun 24 16:51:51 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_reopen): remove cygwin handling because it seems to be for
	  C's stdio.
	  fixed [ruby-dev:35183]

Tue Jun 24 11:12:33 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h, win32/win32.c (rb_w32_getppid): now support
	  getppid() on win32 (but only Win2k or later).

	* process.c (get_ppid): remove win32 special logic.

Tue Jun 24 09:40:47 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (init_sock): socket is binmode on platforms
	  which support binmode.

Tue Jun 24 00:21:53 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_build_from_ary): initialize arg_opts, a patch from
	  Adam Strzelecki <ono at java.pl> in [ruby-core:17220].

Tue Jun 24 00:10:53 2008  wanabe  <s.wanabe@gmail.com>

	* compile.c (iseq_build_from_ary): fix expression to obtain
	  iseq->local_size and iseq->local_table_size.  [ruby-dev:35205]

Mon Jun 23 11:31:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mathn.rb (Rational::power2): removed incomplete method.
	  see [ruby-dev:35195].   [ruby-core:17293]

Sun Jun 22 14:16:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/extconf.rb (have_readline_func): readline on Mac OS X
	  needs headers to detect some functions.

Sun Jun 22 09:51:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_class_superclass): rdoc improvement, a patch from
	  Gaston Ramos <ramos.gaston AT gmail.com> in [ruby-core:17371].

Sun Jun 22 09:22:32 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* README.EXT: translated README.EXT.ja

Sun Jun 22 00:42:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_osid, rb_w32_osver, CreateChild): XP is
	  is different from Vista about pipe handle inheritance.
	  fixed [ruby-core:17367], reported by Lars Christensen <larsch at
	  belunktum.dk>

Sun Jun 22 00:38:45 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* README.EXT.ja: add note about mark and free.

Sun Jun 22 00:01:36 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_binmode_p, argf_binmode_p, Init_IO): new method
	  IO#binmode? and ARGF.binmode?  [ruby-dev:35148]

Sat Jun 21 17:33:50 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn): no longer support P_WAIT.

Sat Jun 21 16:46:09 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (native_sleep): must block reentrance when accessing
	  th->unblock.
	  fixed [ruby-core:17341], reported by Bill Kelly <billk at cts.com>

Sat Jun 21 16:29:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (call_args2, open_args): removed.

	* parse.y (parser_yylex): unified warnings at space between method
	  name and argument parenthesis.  [ruby-dev:33943]

Sat Jun 21 16:21:07 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): get rid of overflow.

Sat Jun 21 15:57:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parsers/parse_rb.rb (RDoc#collect_first_comment): skip
	  magic comment.

Sat Jun 21 15:54:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check if fork works with pthread.

Sat Jun 21 15:31:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: ported to ruby.

	* tool/make-snapshot: fixed digests.

Sat Jun 21 04:36:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/jacobian.rb (Jacobian::dfdxi):
	  typo fixed (raize -> raise).  [ruby-list:45101]

	* enumerator.c (enum_each_cons): typo in RDoc fixed.

Sat Jun 21 00:45:34 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* tool/make-snapshot: do not use sha256sum; use BASERUBY instead

	* common.mk (dist): use tool/make-snapshot instead

Fri Jun 20 16:34:14 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (Init_process): Process::Status#to_int removed.
	  (PST2INT): defined.
	  (pst_to_s): use PST2INT.
	  (pst_inspect): ditto.
	  (pst_equal): ditto.
	  (pst_bitand): ditto.
	  (pst_rshift): ditto.
	  (pst_wifstopped): ditto.
	  (pst_wstopsig): ditto.
	  (pst_wifsignaled): ditto.
	  (pst_wtermsig): ditto.
	  (pst_wifexited): ditto.
	  (pst_wexitstatus): ditto.
	  (pst_success_p): ditto.
	  (pst_wcoredump): ditto.
	  (rb_f_system): ditto.

Fri Jun 20 15:40:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_store, rb_ary_splice): not depend on unspecified
	  behavior at integer overflow.

	* string.c (str_buf_cat): ditto.

Fri Jun 20 12:39:55 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_detach_process): store detached process ID in the
	  thread local storage.  moved from lib/open3.rb.

Fri Jun 20 11:57:46 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_sub_bang): should preserve replacement points
	  since they may be altered in the yielded block.

Fri Jun 20 11:07:56 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_memhash): randomize hash to avoid algorithmic
	  complexity attacks.
	  (rb_str_hash): use rb_memhash.

	* include/ruby/intern.h (rb_reset_random_seed): declared.

	* thread.c (rb_thread_atfork): call rb_reset_random_seed.

	* inits.c (rb_call_inits): call Init_RandomSeed at first.

	* random.c (seed_initialized): defined.
	  (fill_random_seed): extracted from random_seed.
	  (make_seed_value): extracted from random_seed.
	  (rb_f_rand): initialize random seed at first.
	  (initial_seed): defined.
	  (Init_RandomSeed): defined.
	  (Init_RandomSeed2): defined.
	  (rb_reset_random_seed): defined.
	  (Init_Random): call Init_RandomSeed2.

Wed Jun 18 21:52:38 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* array.c (ary_new, rb_ary_initialize, rb_ary_store,
	  rb_ary_splice, rb_ary_times): integer overflows should be
	  checked. based on patches from Drew Yao <ayao at apple.com>
	  fixed CVE-2008-2726

	* string.c (rb_enc_cr_str_buf_cat): fixed unsafe use of alloca,
	  which led memory corruption. based on a patch from Drew Yao
	  <ayao at apple.com> fixed CVE-2008-2726

Fri Jun 20 03:26:00 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (rb_f_fork): NetBSD 4.0 or later can fork.

Fri Jun 20 03:19:39 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/testunit/collector/test_dir.rb: r15825 made it unnecessary to
	  change String to Symbol.

	* test/testunit/collector/test_objectspace.rb: ditto.

Fri Jun 20 03:14:31 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*, test/rubygems/*:  Update to RubyGems 1.1.1 r1784 (pre
	  1.2).

Fri Jun 20 03:01:59 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c: try to remove false positive of deadlock detection (second
	  trial).

Fri Jun 20 02:16:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mathn.rb (Rational::power2): typo fixed.  [ruby-core:17293]

Fri Jun 20 02:11:01 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): should preserve last successful match
	  data.  [ruby-dev:35182]

Fri Jun 20 01:07:28 2008  Koichi Sasada  <ko1@atdot.net>

	* KNOWNBUGS.rb, bootstraptest/pending.rb: move a bug (?) to pending.

Fri Jun 20 00:40:08 2008  Koichi Sasada  <ko1@atdot.net>

	* proc.c (proc_new): fix to return Proc object if block is already
	  in heap.  [ruby-core:15711]

	* bootstraptest/test_proc.rb: add a test.

Fri Jun 20 00:18:04 2008  Koichi Sasada  <ko1@atdot.net>

	* thread_win32.c (native_sleep): fix to decrement sleeper count.

Thu Jun 19 23:48:45 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/net/http/test_http.rb: compare encodings of two strings before
	  comparing themself, which suppress too big error output.

Thu Jun 19 23:46:35 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/json/ext/parser/parser.rl, ext/json/ext/parser/parser.c: JSON
	  text SHALL be encoded in Unicode.

Thu Jun 19 23:17:56 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c, thread_win32.c, vm_core.h: try to remove false positive of
	  deadlock detection.

Thu Jun 19 21:38:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): check if compile before showing message.

Thu Jun 19 21:35:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: supported multiple snapshots.

Thu Jun 19 20:37:00 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/net/pop.rb (Net::POP3#set_all_uids): speed
	  up. a patch from <m-sumi AT techfirm.co.jp> [ruby-list:45047]

Thu Jun 19 17:44:15 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/etc/etc.c (Init_etc): define constant aliases Etc::Passwd
	  and Etc::Group.  [ruby-dev:35150]

Thu Jun 19 17:37:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_alloc): specify 'inline' modifier.

	* string.c (str_alloc): remove cSymbol hack that no longer
	  necessary.

	* string.c (scan_once): avoid retrieving encoding info unless
	  necessary.

Thu Jun 19 17:19:14 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_scan): String#scan should preserve last
	  successful match data.  [ruby-dev:35106]

Thu Jun 19 16:49:36 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* missing/acosh.c (atanh): should set ERANGE to errno if parameter
	  is the boundary case. fixed [ruby-dev:35155]

Thu Jun 19 16:06:01 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkextlib/tile/treeview.rb: cannot configure tags.

Thu Jun 19 11:48:33 2008  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_enumerator.rb: fix to skip "with_memo" test.

Thu Jun 19 11:40:55 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_throw): fix "return" process from "lambda".

	* bootstraptest/test_proc.rb: add a test.

	* bootstraptest/pending.rb: add a pending bug.

Thu Jun 19 00:33:40 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/etc/test_etc.rb: avoid infinite loop.  [ruby-dev:35158]

Wed Jun 18 23:07:19 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* gc.c (rb_newobj): prohibit call of rb_newobj() during gc.
	  a patch from Sylvain Joyeux in [ruby-core:12099].

Wed Jun 18 21:08:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (verbose_setter, opt_W_getter): fixed prototypes.

Wed Jun 18 19:20:00 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (opt_W_getter): use ruby_verbose directly instead of parameter
	  because ruby_verbose is not a real variable, so the address of
	  parameter is not collect.

Wed Jun 18 18:31:03 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (errmap): add some pipe errors.

	* win32/win32.c (rb_w32_write): set errno when CRT's errno is EINVAL
	  for pipe errors.

Wed Jun 18 18:09:08 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (poll_child_status): set EINVAL to errno when
	  GetExitCodeProcess() fails with ERROR_INVALID_HANDLE.

Wed Jun 18 15:01:18 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_open_file): fs_encoding and fname_encoding is
	  rb_encoding *.
	  fixed [ruby-dev:35151]

Wed Jun 18 14:30:06 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_open_file): not rb_enc_get_index but rb_enc_get.

Wed Jun 18 13:49:58 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (pipe): now pipe is textmode. although this
	  change is experimental, it will be spec if no compatibility problem
	  is reported.

Wed Jun 18 12:05:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object, marshal_dump, r_object0, marshal_load): search
	  public methods only.  [ruby-core:17283]

	* object.c (convert_type): ditto.

	* lib/singleton.rb (Singleton#_dump): conversion method should be
	  public.

Wed Jun 18 10:18:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_passwd, etc_group): fixed rdoc.  a patch from
	  okkez <okkez000 AT gmail.com> in [ruby-dev:35141].

Wed Jun 18 08:58:16 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/*:  Fix errors for 1.9.

	* gem_prelude.rb:  Only remove methods from gem_prelude.rb when
	  loading real RubyGems.

Wed Jun 18 07:03:30 2008  Eric Hodel  <drbrain@egment7.net>

	* lib/rubygems/*:  Update to RubyGems r1778 (pre 1.2).

Wed Jun 18 04:27:58 2008  Koichi Sasada  <ko1@atdot.net>

	* KNOWNBUGS.rb, bootstraptest/pending.rb: move pending bug.

Wed Jun 18 04:24:20 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_insnhelper.c: fix escape process with "break" and "return"
	  syntax in "lambda".  [ ruby-Bugs-19304 ], [ruby-core:17164]

	* KNOWNBUGS.rb, bootstraptest/test_proc.rb: add/move solved test.

Wed Jun 18 01:51:10 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: cannot access class variable from
	  singleton method.

Wed Jun 18 00:03:33 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* dir.c (Init_Dir): dir_foreach() takes variable argument.

Tue Jun 17 23:04:24 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/net/telnet.rb:  Fixing Telnet#wairfor() which was broken by
	  changes to the Kernel::Integer() method.  [ruby-core:17272]

Tue Jun 17 23:02:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (opt_W_getter): made a hooked variable.

Tue Jun 17 22:04:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* enc/euc_jp.c (property_name_to_ctype): core dumped when sizeof(int)
	  differs from sizeof(long).  [ruby-dev:35131]

	* enc/shift_jis.c (property_name_to_ctype): ditto.

	* enc/unicode.c (onigenc_unicode_property_name_to_ctype): ditto.

Tue Jun 17 20:32:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (miniruby$(EXEEXT)): $(PREP) isn't always same as
	  miniruby, and tests, debug, etc have no meaning when
	  cross-compiling.

Tue Jun 17 18:39:11 2008  Ryan Davis  <ryand-ruby@zenspider.com>

	* common.mk: fixed dependencies on miniruby.

Tue Jun 17 18:11:01 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (pipe): expand pipe buffer size.

Tue Jun 17 17:07:35 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): no need to inherit handles here because
	  spawn'ed child cannot detect that STDIN is closed.

Tue Jun 17 06:32:55 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (dir_data): add intenc and extenc.

	* dir.c (dir_s_alloc): ditto.

	* dir.c (dir_initialize): now accept internal_encoding and
	  external_encoding.

	* dir.c (dir_s_open): changed for dir_initialize.

	* dir.c (dir_open_dir): ditto.

	* dir.c (dir_foreach): changed for dir_open_dir.

	* dir.c (dir_entries): changed for dir_open_dir.

	* dir.c (dir_enc_str): defined.

	* dir.c (dir_path): use dir_enc_str.

	* dir.c (dir_read): ditto.

	* dir.c (dir_each): ditto.

Tue Jun 17 06:28:57 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_set_encoding): defined.

	* io.c (rb_open_file): convert path on Windows and Mac OS X.

	* io.c (open_key_args): use io_set_encoding and now accept
	  internal_encoding and external_encoding.

Tue Jun 17 06:26:28 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_filesystem_encoding): defined.

	* include/ruby/encoding.h (rb_filesystem_encoding): added.

Tue Jun 17 06:24:28 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/syck/rubyext.c: add encoding header.

Tue Jun 17 01:52:50 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: SEGV when exit.

	* ext/tk/lib/tk.rb: add a check for safety to Tk.exit.

	* ext/tk/sample/irbtkw.rbw: freezes when receives SIGINT.

Mon Jun 16 21:58:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_each, strio_readlines): IO#each and
	  IO#readlines do not affect $_.  [ruby-core:17277]

Mon Jun 16 18:52:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/thwait.rb (ThreadsWait): Exception2MessageMapper no longer has
	  extend_to method.  [ruby-core:17267]

Mon Jun 16 14:46:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/e2mmap.rb (E2MM.def_e2message): typo.

Mon Jun 16 09:43:27 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_with_object, Init_Enumerator):
	  Temporarily back out with_memo, for which we need a better name.

Mon Jun 16 07:14:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_readline, strio_each)
	  (strio_readlines): set lastline.  [ruby-core:17257]

Mon Jun 16 01:49:39 2008  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_f_block_given_p): fix to skip class frame.
	  [ruby-core:14813]

	* KNOWNBUGS.rb, bootstraptest/test_method.rb: move solved test.

Mon Jun 16 01:48:08 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c (vm_stack_dump_raw): disable verbose debug output.

Mon Jun 16 01:33:08 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h, thread.c: rename global_interpreter_lock to
	  global_vm_lock.

Sun Jun 15 18:40:35 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/syck/rubyext.c (yaml_org_handler): associate encoding.

	* ext/syck/rubyext.c (syck_genericresolver_node_import): ditto.

Sun Jun 15 18:17:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_vm_t), vm.c (rb_vm_mark): moved preallocated special
	  exceptions.

	* eval.c (Init_eval), gc.c (Init_GC), proc.c (Init_Proc): freeze
	  preallocated special exceptions.

	* eval.c (rb_longjmp): duplicate the thrown exception to set backtrace
	  if it was frozen.

	* gc.c (rb_memerror): raise nomem_error without backtrace if failed to
	  make backtrace.

Sat Jun 14 22:52:35 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_sysread): should not raise at empty
	  read.  a patch from Arthur Schreiber at [ruby-core:17245].

Sat Jun 14 16:55:46 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): no need to expand root path which has no
	  short file name.  [ruby-dev:35095]

Sat Jun 14 11:59:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.h (STACK_UPPER): moved from gc.c

	* thread.c, thread_{pthread,win32}.c (ruby_init_stack,
	  ruby_thread_init_stack): moved stack initialization from gc.c.

Sat Jun 14 11:57:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.h (STACK_UPPER): moved from gc.c

	* thread.c, thread_{pthread,win32}.c (ruby_init_stack,
	  ruby_thread_init_stack): moved stack initialization from gc.c.

Sat Jun 14 07:52:53 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (ruby_initial_gc_stress): defined.
	  (ruby_initial_gc_stress_ptr): defined.

	* debug.c (set_debug_option): use ruby_initial_gc_stress_ptr for
	  gc_stress option.

Sat Jun 14 00:09:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (ruby_gc_stress): moved to rb_objspace_t.

	* gc.c (gc_stress_get, gc_stress_set): VM local attribute.

	* signal.c (sigsegv): ditto.

Fri Jun 13 21:55:48 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_equal_p): Rational(0,x) and 0 are equivalent,
	  anyway.

Fri Jun 13 21:26:39 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (string_to_c, nucomp_s_convert): preserve the current
	  backref.

	* rational.c (string_to_r, nurat_s_convert): ditto.

	* include/ruby/intern.h (rb_match_busy): added a declaration.

Fri Jun 13 18:08:10 2008  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time.xmlschema): don't accept decimal dot without
	  fractional digits.  fractional digits handling simplified.

Fri Jun 13 17:20:40 2008  wanabe  <s.wanabe@gmail.com>

	* complex.c (string_to_c_internal): save and restore backref.
	  fixed [ruby-dev:34991]

Fri Jun 13 17:06:20 2008  wanabe  <s.wanabe@gmail.com>

	* rational.c (string_to_r_internal): save and restore backref.
	  fixed [ruby-dev:34990]

Fri Jun 13 14:41:26 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* README.EXT.ja: update about Fixnum. reported in
	   <http://www.tmtm.org/ja/tdiary/?date=20080611#p01>

	* README.EXT.ja: describe about StringValueCStr().

	* README.EXT: ditto.

Fri Jun 13 14:24:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_memerror): exit with EXIT_FAILURE instead of magic number.

	* gc.c (ruby_stack_check): STACK_LENGTH should be less than
	  STACK_LEVEL_MAX.

Fri Jun 13 12:55:37 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (sort_by_i): use NODE_DOT2 instead of NODE_MEMO to avoid
	  extra calls to is_pointer_to_heap() in GC.

	* enum.c (enum_zip): ditto.

Fri Jun 13 00:41:58 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_thread.rb: add a test.

Thu Jun 12 23:30:11 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (mutex_unlock): fix cond_notified consistency.

Thu Jun 12 22:19:45 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (native_sleep): fixed previous commit.

Thu Jun 12 21:59:17 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c, vm_core.h, vm.c, thread_pthread.c, thread_win32.c: add
	  deadlock detection.  [ruby-dev:35044]

	* bootstraptest/test_thread.rb: add tests for above.

Thu Jun 12 21:39:55 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: refactoring.

	* rational.c: ditto.

Thu Jun 12 17:11:24 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regint.h: undefine USE_CAPTURE_HISTORY which is mentioned as
	  unsupported in the Onigiruma document.

Thu Jun 12 13:36:54 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (rb_intern): use rb_intern2 with strlen for
	  constant symbols to optimize strlen.

Thu Jun 12 08:47:51 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (read_all): should use io_read_encoding(), not
	  io_input_encoding().

	* io.c (rb_io_getline_1): reduce calling of io_read_encoding().

	* string.c (rb_str_scan): need not to restore $~ value, so avoid
	  pinning match object.

Thu Jun 12 02:49:40 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/stringio/stringio.c (strio_init): rewind when reopened.

Thu Jun 12 02:43:27 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (rb_ary_zip): ANSI style.

Thu Jun 12 02:25:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_reopen): clear read buffer.

Thu Jun 12 00:56:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk: check proper conditions.  [ruby-dev:35047]

Wed Jun 11 23:33:13 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_fread): bypass buffered read if reading buffer is empty.

	* io.c (remain_size): do not add extra one byte.

Wed Jun 11 12:15:17 2008  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_normal_exit): hide stderr output
	  when success.

Wed Jun 11 09:26:43 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (encs): need to pass miniruby path for windows.

Wed Jun 11 05:53:20 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c, eval_intern.h (PASS_PASSED_BLOCK):
	  set a VM_FRAME_FLAG_PASSED flag to skip this frame when
	  searching ruby-level-cfp.

	* eval.c, eval_intern.h, proc.c: fix to check cfp.  if there is
	  no valid ruby-level-cfp, cause RuntimeError exception.
	  [ruby-dev:34128]

	* vm_core.h, vm_evalbody.c, vm.c, vm_dump.c, vm_insnhelper.c,
	  insns.def: rename FRAME_MAGIC_* to VM_FRAME_MAGIC_*.

	* KNOWNBUGS.rb, bootstraptest/test*.rb: move solved bugs.

Wed Jun 11 05:55:31 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: SEGV when tcltk-stubs is enabled.

	* ext/tk/tcltklib.c: avoid error on a shared object.

	* ext/tk/extconf.rb: support --with-tcltkversion

	* ext/tk/README.tcltklib: add document about --with-tcltkversion

	* ext/tk/lib/tk.rb, ext/tk/lib/multi-tk.rb, ext/tk/lib/remote-tk.rb:
	  not work on $SAFE==4

	* ext/tk/lib/multi-tk.rb: Object#methods returns Symbols on Ruby1.9.

	* ext/tk/lib/tk/timer.rb: add TkTimer#at_end(proc) to register the
	  procedure which called at end of the timer.

	* ext/tk/lib/tk.rb, ext/tk/lib/tk/itemfont.rb, ext/tk/lib/font.rb:
	  support __IGNORE_UNKNOWN_CONFIGURE_OPTION__ about font options.

	* ext/tk/lib/*: treat __IGNORE_UNKNOWN_CONFIGURE_OPTION__

	* ext/tk/lib/tkextlib/iwidgets/scrolledcanvas.rb,
	  ext/tk/lib/tkextlib/iwidgets/scrolledlistbox.rb,
	  ext/tk/lib/tkextlib/iwidgets/scrolledtext.rb: bug fix.

	* ext/tk/lib/tk/text.rb: typo. call a wrong method.

	* ext/tk/lib/tk/itemconfig.rb: ditto.

	* ext/tk/lib/tk.rb, ext/tk/lib/tk/itemconfig.rb,
	  ext/tk/lib/tk/canvas.rb: support alias names of option keys.

	* ext/tk/lib/tk/grid.rb: lack of module-method definitions.

	* ext/tk/lib/tk/pack.rb, ext/tk/lib/tk/grid.rb: increase supported
	  parameter patterns of configure method.

	* ext/tk/lib/tk.rb: add TkWindow#grid_anchor, grid_column, grid_row.

	* ext/tk/lib/tk/wm.rb: methods of Tk::Wm_for_General module cannot
	  pass the given block to methods of Tk::Wm module.

	* ext/tk/lib/tk/wm.rb: Wm#overrideredirect overwrites argument to
	  an invalid value.

	* ext/tk/lib/tk.rb: fix memory (object) leak bug.

	* ext/tk/tcltklib.c, ext/tk/tkutil/tkutil.c: fix memory leak.

	* ext/tk/sample/demos-jp/aniwave.rb, ext/tk/sample/demos-en/aniwave.rb:
	  bug fix.

	* ext/tk/lib/tkextlib/blt/component.rb,
	  ext/tk/lib/tkextlib/tile/tentry.rb,
	  ext/tk/lib/tkextlib/tile/treeview.rb: ditto.

	* ext/tk/lib/tkextlib/tile/tpaned.rb: improve TPaned#add.

	* ext/tk/sample/demos-jp/widget, ext/tk/sample/demos-en/widget,
	  ext/tk/sample/demos-jp/style.rb, ext/tk/sample/demos-en/style.rb,
	  ext/tk/sample/demos-jp/bind.rb, ext/tk/sample/demos-en/bind.rb:
	  bug fix.

	* ext/tk/sample/ttk_wrapper.rb: ditto.

	* ext/tk/sample/ttk_wrapper.rb: support "if __FILE__ == $0" idiom.

	* ext/tk/sample/tktextio.rb: add binding for 'Ctrl-u' at console mode.

	* ext/tk/lib/tkextlib/tile.rb, ext/tk/lib/tkextlib/tile/style.rb,
	  ext/tk/sample/ttk_wrapper.rb: improve treating and control themes.
	  add Tk::Tile.themes and Tk::Tile.set_theme(theme).

	* ext/tk/lib/tkextlib/tile.rb: lack of autoload definitions.

	* ext/tk/lib/tkextlib/tile/tnotebook.rb: cannot use kanji (not UTF-8)
	  characters for headings.

	* ext/tk/lib/tkextlib/tkDND/shape.rb: wrong package name.

	* ext/tk/tkutil/tkutil.c: improve handling callback-subst-keys.
	  Now, support longnam-keys (e.g. '%CTT' on tkdnd-2.0; however, still
	  not support tkdnd-2.0 on tkextlib), and symbols of parameters (e.g.
	  :widget=>'%W', :keycode=>'%k', '%x'=>:x, '%X'=>:root_x, and so on;
	  those are attributes of event object). It means that Ruby/Tk accepts
	  not only "widget.bind(ev, '%W', '%k', ...){|w, k, ...| ... }", but
	  also "widget.bind(ev, :widget, :keycode, ...){|w, k, ...| ... }".
	  It is potentially incompatible, when user passes symbols to the
	  arguments of the callback block (the block receives the symbols as
	  strings). I think that is very rare case (probably, used by Ruby/Tk
	  experts only). When causes such trouble, please give strings instead
	  of such symbol parameters (e.g. call Symbol#to_s method).

	* ext/tk/lib/tk/event.rb, ext/tk/lib/tk/validation.rb,
	  ext/tk/lib/tkextlib/blt/treeview.rb,
	  ext/tk/lib/tkextlib/winico/winico.rb: ditto.

	* ext/tk/tkutil/tkutil.c: strings are available on subst_tables on
	  TkUtil::CallbackSubst class (it is useful on Ruby 1.9).

	* ext/tk/lib/tk/spinbox.rb, ext/tk/lib/tkextlib/iwidgets/hierarchy.rb,
	  ext/tk/lib/tkextlib/iwidgets/spinner.rb,
	  ext/tk/lib/tkextlib/iwidgets/entryfield.rb,
	  ext/tk/lib/tkextlib/iwidgets/calendar.rb,
	  ext/tk/lib/tkextlib/blt/dragdrop.rb,
	  ext/tk/lib/tkextlib/tkDND/tkdnd.rb,
	  ext/tk/lib/tkextlib/treectrl/tktreectrl.rb,
	  ext/tk/lib/tkextlib/tktable/tktable.rb: disable code piece became
	  unnecessary by reason of the changes of ext/tk/tkutil/tkutil.c.

	* ext/tk/lib/tk.rb, ext/tk/lib/multi-tk.rb: change strategy to define
	  the constant WITH_ENCODING.

	* ext/tk/lib/tk.rb: fix bug on Tk::Encoding.tk_encoding_names.

Wed Jun 11 03:40:37 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/find.rb (Find#find): Return an enumerator if no block is
	  given.

Wed Jun 11 01:28:12 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/intern.h, proc.c: revert rb_proc_call() and
	  create rb_proc_call_with_block() instead.

	* include/ruby/ruby.h, eval_jump.c, thread.c, vm_insnhelper.c:
	  rb_blockptr should not be exposed.

Tue Jun 10 21:07:19 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_float.rb: add tests. [ruby-dev:35009]

Tue Jun 10 20:55:57 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_s_convert): need not to initialize optional
	  argument for rb_scan_args().

Tue Jun 10 20:13:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: negate default of --without-ext if --with-ext is
	  given.

	* ext/extmk.rb: negate default of --without-ext.

Tue Jun 10 17:43:35 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): update RDoc.  [ruby-dev:35034]

Tue Jun 10 17:30:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_obj_instance_exec, rb_mod_module_exec):
	  added prototypes.

Tue Jun 10 17:00:29 2008  wanabe  <s.wanabe@gmail.com>

	* util.c (ruby_strtod): ruby_strtod don't allow a trailing
	  decimal point like "7.". [ruby-dev:34835] [ruby-dev:35009]

Tue Jun 10 13:48:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* rational.c (nurat_s_convert): need not to initialize optional
	  argument for rb_scan_args().

Tue Jun 10 12:58:07 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/wait/wait.c (FIONREAD_POSSIBLE_P): suppress warnings.

Tue Jun 10 12:43:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (CONST_ID_CACHE): fixed statement expression.

Tue Jun 10 11:25:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (rb_argv0): revised for ext/tk.

	* include/ruby/encoding.h: not to use varargs.h since requiring C89.

Tue Jun 10 00:50:51 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* include/ruby/ruby.h, vm_core.h: add a type rb_blockptr.

	* vm_insnhelper.c (vm_yield_with_cfunc): vm_yield_with_cfunc receives
	  blockptr and passes it to iterating block.

	* proc.c (rb_proc_call), include/ruby/intern.h: rb_proc_call receives
	  blockptr.  "rb_proc_call(self, args, blockptr)" in C corresponds to
	  "self.call(*args, &block)" in Ruby.

	* proc.c (proc_call): pass blockptr to block that is written in C.

	* proc.c (curry): receive blockptr and pass it to original proc.
	  [ruby-core:15551]

	* vm.c (invoke_block_from_c): fix for change of vm_yield_with_cfunc.

	* thread.c (call_trace_proc), eval_jump.c (rb_call_end_proc): fix for
	  change of rb_proc_call.

Tue Jun 10 00:10:49 2008  Tanaka Akira  <akr@fsij.org>

	* common.mk (test-knownbug): give $(OPTS) for bootstraptest/runner.rb.

Mon Jun  9 23:10:50 2008  Tanaka Akira  <akr@fsij.org>

	* eval.c (Init_stack): don't declare.  it is a macro now.

Mon Jun  9 22:46:47 2008  wanabe  <s.wanabe@gmail.com>

	* compile.c : treat []&&= in virtually the same way as []||=.
	  [ruby-dev:34679]

Mon Jun  9 21:17:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend (clean): remove build directories.

	* test_knownbug.rb -> KNOWNBUGS.rb: renamed.

	* common.mk: apply above change.

Mon Jun  9 21:14:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): set flags.

Mon Jun  9 21:09:02 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb -> ./test_knownbug.rb: moved.

	* common.mk: add a rule "test-knownbug".

Mon Jun  9 21:00:32 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_s_convert): can accept Complex('i').
	  [ruby-dev:34991]

Mon Jun  9 18:25:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (CONST_ID): constant ID cache for non-gcc.

	* *.c: no cache in init functions.

Mon Jun  9 17:56:30 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#delete_if): Call to_a.
	  (SortedSet#delete_if, TC_SortedSet#test_sortedset): Use super to
	  yield elements in sorted order; [ruby-core:17144] by Arthur
	  Schreiber.
	  (SortedSet#each, SortedSet#each, TC_Set#test_each)
	  (TC_SortedSet#test_sortedset): Return self; [ruby-dev:35002] by
	  Arthur Schreiber.

Mon Jun  9 17:47:09 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (fptr_finalize): close IO object if fd is already closed.
	  (rb_p): call rb_io_write just once.

Mon Jun  9 15:37:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (require_libraries): req_list may be NULL.  [ruby-dev:35008]

Mon Jun  9 14:18:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (struct rb_vm_struct): moved src_encoding_index,
	  ruby_debug, ruby_verbose, and rb_progname.

	* ruby.c (rb_argv0): no longer used.

	* ruby.c (struct cmdline_options): moved setids and req_list, and the
	  latter is now an array, to prevent memory leak.

	* ruby.c (cmdline_options_init): added.

	* ruby.c (add_modules, require_libraries, init_ids, forbid_setid): use
	  struct cmdline_options.

	* vm.c (vm_init2): initialize src_encoding_index.

	* vm.c: getters/setters for ruby_{debug,verbose}.

Mon Jun  9 09:54:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (Init_stack): make to call ruby_init_stack.

Mon Jun  9 08:12:40 2008  wanabe  <s.wanabe@gmail.com>

	* vm_insnhelper.c, vm.c, proc.c : revert r17021. [ruby-dev:34997]

Mon Jun  9 03:12:23 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/pending.rb: move/remove solved issues.

	* bootstraptest/test_class.rb: ditto.

Mon Jun  9 02:32:58 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/zlib/zlib.c (rb_deflate_init_copy): Copy buffers as well.
	  [ruby-list:45018]

Sun Jun  8 22:22:20 2008  wanabe  <s.wanabe@gmail.com>

	* vm_insnhelper.c, vm.c, proc.c (proc_call): allow call method with
	  block that both is written in C. [ruby-dev:34273] [ruby-core:15551]

	*  proc.c (curry): use proc_call instead of rb_proc_call.
	  [ruby-dev:34273] [ruby-core:15551]

Sun Jun  8 21:50:27 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/zlib/test_zlib.rb: add tests to achieve over 90% test coverage
	  of zlib.

Sun Jun  8 20:12:47 2008  wanabe  <s.wanabe@gmail.com>

	* vm_insnhelper.c (vm_throw): regard break as return in lambda.
	  [ruby-dev:34646]

Sun Jun  8 19:17:59 2008  Koichi Sasada  <ko1@atdot.net>

	* gc.c: add a build option "CALC_EXACT_MALLOC_SIZE".
	  This option enables to calculate exact size of current
	  allocated size by malloc().  You can access these information
	  with GC.malloc_allocated_size and GC.malloc_allocations.
	  This option consume additional memory as a header of each memory
	  object.  This option also helps to find out xmalloc()/xfree()
	  consistency.  If you get trouble with this option, some extension
	  using "free()" instead of "xfree()".
	  This options is disabled by default.

Sun Jun  8 18:15:38 2008  Koichi Sasada  <ko1@atdot.net>

	* array.c, bignum.c, cont.c, dir.c, dln.c, encoding.c, enumerator.c,
	  enumerator.c (enumerator_allocate), eval_jump.c, file.c, hash.c,
	  io.c, load.c, pack.c, proc.c, random.c, re.c, ruby.c, st.c,
	  string.c, thread.c, thread_pthread.c, time.c, util.c, variable.c,
	  vm.c, gc.c:
	  allocated memory objects by xmalloc (ruby_xmalloc) should be
	  freed by xfree (ruby_xfree).

	* ext/curses/curses.c, ext/dbm/dbm.c, ext/digest/digest.c,
	  ext/gdbm/gdbm.c, ext/json/ext/parser/parser.c,
	  ext/json/ext/parser/unicode.c, ext/openssl/ossl_cipher.c,
	  ext/openssl/ossl_hmac.c, ext/openssl/ossl_pkey_ec.c,
	  ext/sdbm/init.c, ext/strscan/strscan.c, ext/zlib/zlib.c:
	  ditto.

Sun Jun  8 01:15:11 2008  Tanaka Akira  <akr@fsij.org>

	* hash.c (hash_i): make Hash#hash order insensitive.
	  (rb_hash_dup): use DUPSETUP.

Sat Jun  7 23:47:35 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/zlib/zlib.c (rb_deflate_initialize, Init_zlib): Fix up
	  initialize_copy; [ruby-list:45016].

Sat Jun  7 22:15:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (VENDOR_DIR): use LIBDIR instead of PREFIX as well as
	  SITE_DIR.  a patch from Richard Brown <rbrown AT exherbo.org> in
	  [ruby-core:17129].

Sat Jun  7 21:37:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_f_open), re.c (rb_reg_search), transcode.c (str_transcode):
	  suppress warnings.

	* util.c (quorem, rv_alloc, nrv_alloc): only used in dtoa().

Sat Jun  7 16:06:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (CFLAGS, CXXFLAGS): append default flags.

Sat Jun  7 01:23:59 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_open_file, rb_io_s_sysopen): fmode should be unsigned int.
	  fixed [ruby-dev:34979]

Fri Jun  6 23:46:19 2008  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_callee_setup_arg): check simple flag before
	  calling setup_arg function().  this change reduce function call.

Fri Jun  6 21:51:46 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (COMMON_HEADERS): include ws2tcpip.h.

	* ext/socket/addrinfo.h (addrinfo, getaddrinfo, getnameinfo,
	  freehostent, freeaddrinfo): undef before define because these are
	  macros in some versions of Windows SDK.

	  merged from ruby_1_8.

Fri Jun  6 18:25:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/iconv/utils.rb (default_test): override not to croak.

Fri Jun  6 16:41:45 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: include ws2tcpip.h. fixed [ruby-Bugs-20528]

Fri Jun  6 15:05:02 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (count_objects): clear hash after counting objects.

Fri Jun  6 12:43:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_dir.rb (TestDir::test_glob): glob file names not sorted.

Fri Jun  6 00:05:33 2008  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time.xmlschema): don't use float.  fix
	  http://rubyforge.org/tracker/index.php?func=detail&group_id=426&atid=1698&aid=20504

Thu Jun  5 23:56:18 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_gc.rb: add tests to achieve over 90% test coverage of
	  gc.c.

	* test/ruby/test_objectspace.rb: ditto.

	* test/ruby/test_marshal.rb: ditto.

Thu Jun  5 23:40:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (rb_objspace_alloc): this function is needed only when
	  ENABLE_VM_OBJSPACE macro is defined.

	* vm.c: ditto.

Thu Jun  5 23:31:21 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/stringio/test_stringio.rb: add tests to achieve over 95% test
	  coverage of stringio.

	* test/strscan/test_stringscanner.rb: ditto for strscan.

Thu Jun  5 23:25:34 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval.c (ruby_finalize_0): clear trace_func after executing END
	  procs.

	* thread.c: fix typo.

Thu Jun  5 22:50:50 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (os_obj_of): heaps may be modified in yield.

Thu Jun  5 21:46:50 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* st.c (st_reverse_foreach): comment out unused function.

	* util.c (dtoa): ditto.

Thu Jun  5 20:30:46 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_initialize):
	  Add a null check for ssl; submitted by akira yamada
	  in [ruby-dev:34950].

	* ext/openssl/ossl_ssl.c (Init_ossl_ssl): Define OP_NO_TICKET if
	  SSL_OP_NO_TICKET is present; submitted by akira yamada
	  in [ruby-dev:34944].

	* test/openssl/test_ssl.rb (OpenSSL#test_server_session): Add a
	  workaround for the case where OpenSSL is configured with
	  --enable-tlsext; submitted by akira yamada in [ruby-dev:34944].

Thu Jun  5 20:24:15 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (thread_set_trace_func_m): fix check for proc argument.

Thu Jun  5 20:17:29 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* lib/rexml/document.rb (REXML::Document:write): leaky modification
	  trans -> transitive.  [ruby-dev:32040], r13686

	* lib/rexml/text.rb (Text.check): fix check for illegal character.

Thu Jun  5 14:03:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_create): find encoding without options.

Thu Jun  5 07:48:32 2008  Koichi Sasada  <ko1@atdot.net>

	* string.c (hash): should be "static".

Thu Jun  5 01:47:18 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_transcode.rb: add tests for iso-2022-jp.

Thu Jun  5 01:27:42 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_process.rb: add tests.

Wed Jun  4 23:10:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/zlib/zlib.c (rb_gzfile_set_mtime): fix typo.

Wed Jun  4 18:53:39 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_alloc): RDoc updated.  a patch from Gaston
	  Ramos <ramos.gaston at gmail.com> in [ruby-core:17073].

Wed Jun  4 18:36:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rdoc.rb: massive spelling correction patch from Evan Farrar
	  <evanfarrar at gmail.com> in [ruby-doc:1382] applied.

Wed Jun  4 17:52:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_iconv): fix for length argument and now
	  allows range.  [ruby-core:17092]

Wed Jun  4 15:45:41 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_with_index, enumerator_with_memo): Fix
	  grammo in rdoc.

Wed Jun  4 13:06:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (CFLAGS, CXXFLAGS): include additional flags to
	  CFLAGS and CXXFLAGS while configuration.

Tue Jun  3 23:06:35 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/strscan/strscan.c (strscan_scan_full, strscan_search_full): fix
	  document.

Tue Jun  3 22:37:26 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/strscan/strscan.c (strscan_exist_p): fix document.

Tue Jun  3 22:33:29 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_dir.rb: add tests to achieve over 90% test coverage
	  of dir.c.

	* test/ruby/test_encoding.rb: add tests for dummy?, name_list and
	  aliases.

	* test/ruby/test_marshal.rb: add some tests.

Tue Jun  3 22:25:51 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/etc/test_etc.rb: new tests for etc.

Tue Jun  3 19:35:02 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_with_memo): New method: with_memo().

Tue Jun  3 20:04:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (miniruby$(EXEEXT)): miniruby cannot be
	  written by miniruby itself.

Tue Jun  3 19:33:22 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_init_copy): Take care of
	  initialize_copy as well as initialize.

Tue Jun  3 16:06:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): fix for non-existent files and SFN of
	  symlinks.  [ruby-talk:303736]

Tue Jun  3 15:12:01 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#classify): Back out the `group_by' alias.
	  Better think twice.

Tue Jun  3 15:00:22 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#collect, Set#select): Back out.  I thought it
	  was consistent but turned out to be wrong.

Tue Jun  3 13:41:08 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#collect, Set#select): Override Enumerable
	  methods and make them return a set. [ruby-core:17055]
	  (Set#delete_if, Set#collect!, Set#reject!, Set#classify)
	  (Set#divide, Set#delete_if): Return an enumerator if no block is
	  given.
	  (Set#classify): Define an alias `group_by' to override that of
	  Enumerable.

Tue Jun  3 13:35:40 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (run_exec_pgroup): C99 ism.

Tue Jun  3 12:51:57 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_allocate, enumerator_ptr): Properly
	  detect if the object is initialized and raise error when
	  appropriate.
	  (enumerator_initialize): Fix a typo in rdoc. [ruby-core:17052]

Tue Jun  3 01:21:51 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_method.rb: add a test.

Tue Jun  3 00:26:48 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* marshal.c (w_object): add a check for modification of array during
	  its dump.

Mon Jun  2 22:27:57 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* enc/iso_8859_5.c: Large omicron should lowercase to small omicron.

	* test/ruby/test_big5.rb, test/ruby/test_cp949.rb,
	  test/ruby/test_euc_jp.rb, test/ruby/test_euc_kr.rb,
	  test/ruby/test_euc_tw.rb, test/ruby/test_gb18030.rb,
	  test/ruby/test_gbk.rb, test/ruby/test_iso_8859.rb,
	  test/ruby/test_koi8.rb, test/ruby/test_shift_jis.rb,
	  test/ruby/test_windows_1251.rb: new tests for encoding.

	* test/ruby/test_utf16.rb, test/ruby/test_utf32.rb,
	  test/ruby/test_regexp.rb: add tests.

Mon Jun  2 21:56:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_file.rb: add tests for uninitialized object.

	* test/ruby/test_class.rb: ditto.

	* test/ruby/test_thread.rb: ditto.

Mon Jun  2 21:44:15 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* re.c: fix SEGV by Regexp.allocate.names, Match.allocate.names, etc.

	* test/ruby/test_regexp.rb: add tests for above.

	* io.c: fix SEGV by IO.allocate.print, etc.

	* test/ruby/test_io.rb: add tests for above.

Mon Jun  2 19:17:47 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_argf.rb (teardown): remove renamed temporary files.

Mon Jun  2 18:51:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/un.rb (wait_writable): wait until target files can be
	  written actually.

	* win32/Makefile.sub (LDSHARED_0, LINK_SO): get rid of failure of
	  mt.exe.

Mon Jun  2 16:26:17 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/delegate.rb (Delegator::MethodDelegation#respond_to):
	  respond_to? should now take optional second argument; submitted
	  by Jeremy Kemper <jeremy at bitsweat.net> in [ruby-core:17045].

Mon Jun  2 16:14:18 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/erb.rb (ERB::Compiler::TrimScanner#scan_line): Oops.  This
	  change did not apply to trunk.  Backed out.

Mon Jun  2 16:08:24 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/erb.rb (ERB::Compiler::TrimScanner#scan_line): Fix a bug
	  where tokens are not yielded one by one.

	* test/erb/test_erb.rb (TestERBCore#_test_01)
	  (TestERBCore#test_02_safe_04): The expected value should come
	  first for assert_equal().

Mon Jun  2 13:06:38 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* mkconfig.rb: hide build path from rbconfig.rb.

Mon Jun  2 08:46:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strtod, dtoa): initialize more variables for error
	  handling.

Mon Jun  2 04:55:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* suppress warnings on cygwin, mingw and mswin.

Mon Jun  2 04:35:32 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/gb18030.c (gb18030_code_to_mbc): add 0x80000000
	  for 4bytes character.

Mon Jun  2 03:52:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (set_arg0): reverted used variable definition.

Mon Jun  2 03:23:25 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/gb18030.c (gb18030_mbc_to_code): mask by 0x7FFFFFFF
	  because OnigCodePoint will be used as 32bit signed int.
	  Masking by 0x7FFFFFFF is ok on GB18030;
	  Minimum 4bytes character is 0x81308130.

Sun Jun  1 22:29:35 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* rational.c (string_to_r_internal): use rb_isdigit.

	* marshal.c (long_toobig): use %zd.

	* ruby.c (set_arg0): move unused variable definition.

Sun Jun  1 12:18:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* insns.def (DEFINE_INSN): subtract of pointers is ptrdiff_t.
	  this is not int on 64bit system.

	* vm_dump.c (control_frame_dump): ditto.

	* vm_dump.c (stack_dump_each): ditto.

	* vm_dump.c (debug_print_register): ditto.

	* vm_dump.c (debug_print_pre): ditto.

	* transcode.c (str_transcode): ditto.

Sun Jun  1 10:32:18 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (assert_normal_exit): show coredump status.

Sat May 31 23:33:34 2008  Akinori MUSHA  <knu@iDaemons.org>

	* README, README.ja: Add a note about default C flags.

Sat May 31 23:02:00 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (count_objects): clear given hash.

Sat May 31 20:28:10 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_regexp.rb: add tests.

Sat May 31 19:11:39 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_16{be,le}.c (utf16{be,le}_code_to_mbc):
	  fix codepoint to bytes.

Sat May 31 18:28:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* suppress warnings with -Wwrite-string.

Sat May 31 18:26:33 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_delete_if): should return enumerator if no block
	  is given.  [ruby-dev:34901]

Sat May 31 15:58:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, configure.in (warnflags): defaulted to -Wall
	  -Wno-parentheses with gcc.  [ruby-dev:34810]

Sat May 31 15:17:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/mvm.h: new header file for MVM, and moved rb_vm_t and
	  rb_thread_t from vm_core.h.

Sat May 31 12:02:23 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (assert_normal_exit): show pid when fail.

Fri May 30 23:55:56 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_rubyoptions.rb: add a test of RUBY_DESCRIPTION.

Fri May 30 22:47:17 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_regexp.rb: add tests.

Fri May 30 22:40:53 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_signal.rb: add tests to achieve over 80% test
	  coverage of signal.c.

Fri May 30 22:28:03 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* signal.c (esignal_signo): fix SignalException#signo which returned
	  nil absolutely.

	* signal.c (esignal_init): always prepend "SIG" to a string that is
	  returned by SignalException#signm.

Fri May 30 22:17:39 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_argf.rb: rename a conflicting method name.

	* test/ruby/test_string.rb: ditto.

	* test/ruby/test_io.rb: ditto.

Fri May 30 22:14:37 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (defined_expr): fix SEGV by defined?([1]).

Fri May 30 12:18:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (prelude.c): simply depends on PREP.  [ruby-dev:34877]

	* enc/make_encdb.rb, enc/trans/make_transdb.rb: ditto.

Fri May 30 10:55:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (struct rb_unblock_callback), thread.c
	  (set_unblock_function), thread_{pthread,win32}.c (native_sleep):
	  extracted from struct rb_thread_struct.

	* thread.c (reset_unblock_function): not check interrupts at leaving
	  blocking region.  [ruby-dev:34874]

Fri May 30 06:09:31 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_8.c: add UTF8-MAC (UTF-8-MAC).

Fri May 30 04:17:13 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enum.c (enum_count, count_all_i, Init_Enumerable),
	  array.c (rb_ary_count): If no argument or block is given, count
	  the number of all elements.

Fri May 30 03:12:18 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/openssl/ossl_bn.c (ossl_bn_s_rand, ossl_bn_s_pseudo_rand):
	  Int should be enough here.

Fri May 30 02:35:00 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/openssl/ossl_bn.c (ossl_bn_s_rand, ossl_bn_s_pseudo_rand),
	  ext/openssl/ossl_pkey_dh.c (ossl_dh_s_generate)
	  (ossl_dh_initialize),
	  ext/openssl/ossl_pkey_dsa.c (ossl_dsa_s_generate),
	  ext/openssl/ossl_rand.c (ossl_rand_bytes)
	  (ossl_rand_pseudo_bytes, ossl_rand_egd_bytes),
	  ext/openssl/ossl_x509store.c (ossl_x509stctx_set_error): Do not
	  use FIX2INT() without checking the value type.  Use NUM2INT()
	  instead; found by akr in [ruby-dev:34890].

Fri May 30 02:08:20 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* signal.c (esignal_init): handle a non-integer argument correctly,
	  allowing SignalException.new(:INT).

Fri May 30 00:59:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_regexp.rb: add tests.

Thu May 29 22:51:05 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_require.rb: add a test for load with wrap flag, to
	  achieve 100% test coverage of eval_jump.c.

Thu May 29 22:47:53 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_argf.rb: new tests for ARGF, to achieve over 85% test
	  coverage of file.c.

	* test/ruby/test_io.rb: add tests.

Thu May 29 22:41:48 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (argf_readchar): raise EOFError, synchronizing IO#readchar.

Thu May 29 22:29:39 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* io.c (argf_external_encoding, argf_internal_encoding): fix SEGV by
	  ARGF.external_encoding.

Thu May 29 17:52:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/extconf.rb: search zlib1, and regard mswin32 later than VC6
	  as WIN32.  [ruby-core:16984]

Wed May 28 18:05:28 2008  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_nitems, Init_Array): Axe Array#nitems().
	  cf. [ruby-dev:34676]-[ruby-dev:34713]

Wed May 28 17:50:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/mkexports.rb (Exports#objdump, Exports#each_line): extracted.

Wed May 28 17:41:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (MKPREP): appended $(RBCONFIG).

	* common.mk (enc.mk, prelude.c): not depend on $(RBCONFIG) on mswin32
	  to get of compiling twice each time.

	* win32/Makefile.sub (prelude.c): not depend on $(PREP).

Wed May 28 17:37:07 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/mkexports.rb (Exports::Mswin#each_export): speed up.

Wed May 28 16:41:59 2008  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_slice_bang): Call rb_ary_modify_check() at the
	  beginning. [rubyspec]

Wed May 28 16:12:44 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/webrick/httpservlet/cgihandler.rb (WEBrick::HTTPServlet::CGIHandler#do_GET):
	  Set the HTTP status code to 302 if a Location header field is
	  present and the status code is not valid as a client
	  redirection.  cf. RFC 3875 6.2.3, 6.2.4.

Wed May 28 15:53:52 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/trans/japanese.c (to_SHIFT_JIS_EF_infos): typo.

Wed May 28 15:18:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/singleton.rb (SingletonClassMethods): _load should be public.

Wed May 28 13:30:43 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.c: add workaround for Unicode to CP932.
	  U+2015->0x815C, U+2225->0x8161, U+FF0D->0x817C, U+FF3C->0x815F,
	  U+FF5E->0x8160, U+FFE0->0x8191, U+FFE1->0x8192, U+FFE2->0x81CA

Wed May 28 12:52:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object, marshal_dump, r_object0, marshal_load): search
	  private methods too.  [ruby-dev:34671]

	* object.c (convert_type): ditto.

Wed May 28 08:42:51 2008  Tanaka Akira  <akr@fsij.org>

	* numeric.c: "%" is required before PRI?VALUE.

Tue May 27 22:10:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.c (error_handle): SystemExit and SignalException throws
	  TAG_RAISE but not TAG_FATAL.

	* thread.c (rb_thread_execute_interrupts): delay interrupts during
	  raising exceptions.  [ruby-dev:34855]

Tue May 27 20:18:30 2008  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_slice_bang): Return an empty array instead of
	  nil when pos is valid and len is adjusted from a valid value to
	  zero; caught by RubySpec.

Tue May 27 19:12:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (MKPREP), common.mk, win32/Makefile.sub (prelude.c): get
	  rid of depending PREP with nmake.

	* common.mk (encs): depends on libruby.

Tue May 27 19:00:22 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/stringio/stringio.c (strio_each_char, Init_stringio): Add
	  StringIO#{each_char,chars}.
	  (Init_stringio): Fix StringIO#bytes.

Tue May 27 17:54:35 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/stringio/stringio.c (strio_each_byte): Return self instead
	  of nil as the rdoc says.

Tue May 27 15:36:27 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (check_int): use PRIxVALUE format specifier.

	* numeric.c (check_uint, rb_num2fix, int_chr): ditto.

	* numeric.c (num_fdiv): fallback to_f should always return float
	  result.  should not use #quo that may return rational.

	* numeric.c (num_div): should raise ZeroDivisionError.

	* numeric.c (fix_divide): ditto.

	* test/ruby/test_numeric.rb (TestNumeric::test_divmod): avoid
	  ZeroDivisionError in tests.

Tue May 27 13:14:53 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enum.c (enum_to_a): Pass arguments through to #each().
	  (enum_sort): Follow the enum_to_a signature change.
	  (enum_reverse_each): Add #reverse_each().

Tue May 27 13:12:37 2008  Akinori MUSHA  <knu@iDaemons.org>

	* io.c (Init_IO): Define ARGF.{lines,bytes,chars}.

Tue May 27 12:06:37 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (BUFCHECK): wrong condition. [ruby-core:16921]

	* file.c (file_expand_buf): shouldn't use buflen for length of string.

Mon May 26 18:24:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (BUFCHECK): no resize if enough room.

	* file.c (file_expand_path): use BUFCHECK.

Mon May 26 17:48:42 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (struct enumerator, enumerator_init)
	  (enumerator_init_copy, enumerator_each): Eliminate iter.
	  (enumerator_ptr): Do not hardcode the class name.
	  (enumerator_with_index): Delay variable initialization after
	  RETURN_ENUMERATOR().

Mon May 26 17:23:49 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (file_expand_path): add more space for '/'.

	* file.c (file_expand_path): should reset address of p after calling
	  rb_str_resize(). [ruby-dev:34800]

Mon May 26 16:49:55 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode): use run-hooks if run-mode-hook is
	  not available.  a patch from Kazuhiro NISHIYAMA <zn at mbf.nifty.com>
	  in [ruby-dev:34853].

Mon May 26 16:41:35 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (ntfs_tail): filename which starts with '.' is valid.

	* file.c (file_expand_path): cygwin symlink support.

Mon May 26 07:15:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): rb_make_backtrace has no arguments.

Mon May 26 01:17:54 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (assert_normal_exit): signal description
	  refined.

Mon May 26 00:52:52 2008  Akinori MUSHA  <knu@iDaemons.org>

	* hash.c (env_each_key, env_each_value, env_reject_bang)
	  (rb_env_clear, env_replace): Omit duplicated secure level check.

Mon May 26 00:37:16 2008  Akinori MUSHA  <knu@iDaemons.org>

	* hash.c (env_each_value): Do not call env_values() twice.

Sun May 25 17:54:36 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_compile): set local_table for
	  ISEQ_TYPE_DEFINED_GUARD.

Sun May 25 17:52:25 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_build_body): remove side effect from
	  VM::InstructionSequence.load.

Sun May 25 04:30:45 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_module.rb (remove_json_mixins): change judgment
	  condition.

Sun May 25 03:54:39 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_module.rb (test_ancestors, test_included_modules):
	  ignore json mixins.

Sun May 25 02:37:25 2008  Koichi Sasada  <ko1@atdot.net>

	* eval_method.c: renamed from vm_method.c.  "vm_method.c" is included
	  by "vm.c".

	* vm_eval.c: added.  Some codes are moved from "eval.c"

	* common.mk: fix for above changes.

	* compile.c: make a vm_eval(0)

	* eval.c, eval_error.c, eval_intern.h, eval_jump.c, proc.c, vm.c,
	  id.c, id.h, vm_core.h, vm_dump.c, vm_evalbody.c, vm_insnhelper.c,
	  blockinlining.c: fix for above changes.  and do some refactoring.
	  this changes improve rb_yield() performance.

Sat May 24 22:32:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* util.c (ruby_strtod): clear errno at the top of our own
	  implementation of strtod(3).  [ruby-dev:34834] [ruby-dev:34839]

Sat May 24 15:26:16 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_set_exception_table, NODE_WHILE, NODE_NEXT): remove
	  special handling that decrements sp in CATCH_TYPE_NEXT for NODE_WHILE.

	* vm.c (vm_eval_body), vm_insnhelper.c (vm_throw): remove unused code.

Sat May 24 08:13:34 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (rb_str_transcode): argc is 1, and argv is &to.

Fri May 23 17:55:11 2008  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_slice_bang): Be consistent with Array#slice()
	  and String#slice!().  Just return nil when a negative length or
	  out of boundary index is given instead of raising an exception
	  via internal functions.

Fri May 23 16:44:34 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (Init_Enumerator): Override
	  Enumerable::Enumerator#each_with_index with #with_index.

Fri May 23 12:23:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_num_t): moved form vm.h.

	* tool/instruction.rb (RubyVM::Instruction#sp_increase_c_expr),
	  tool/instruction.rb (RubyVM::VmBodyGenerator#make_header_operands):
	  omit unused variables.

Fri May 23 08:47:02 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (exc_equal): == operator should be transitional.
	  [ruby-dev:34808]

	* error.c (syserr_eqq): === should be able to handle delegated
	  objects as well.

Fri May 23 06:15:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (rb_iseq_compile_with_option): get rid of segv.

Fri May 23 02:29:14 2008  Koichi Sasada  <ko1@atdot.net>

	* insns.def (opt_gt|ge|lt|le): use values directly to compare.

Fri May 23 01:15:09 2008  Koichi Sasada  <ko1@atdot.net>

	* eval.c, eval_intern.h, include/ruby/intern.h, include/ruby/ruby.h,
	  vm.c, vm_core.h, vm_insnhelper.c: remove pointless "const".

Thu May 22 23:45:17 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (get_destination_insn, get_next_insn, get_prev_insn):
	  peephole optimization should not ignore ISEQ_ELEMENT_ADJUST.

Thu May 22 20:20:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (check_dump_arg, check_load_arg): check if reentered.
	  [ruby-dev:34802]

Thu May 22 20:14:28 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* iseq.c (iseq_load, iseq_data_to_ary): support
	  ISEQ_TYPE_DEFINED_GUARD.

Thu May 22 19:01:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_get_ruby_level_cfp): moved from eval_intern.h.

	* vm.c (sdr, nsdr): define methods only if VMDEBUG is defined.

Thu May 22 17:18:35 2008  Tanaka Akira  <akr@fsij.org>

	* array.c (rb_ary_compact_bang): fix reallocation size.

Thu May 22 15:20:20 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval_intern.h, vm_core.h, include/ruby/intern.h, include/ruby/ruby.h,
	  vm.c: need to add const to prototypes, of course.

Thu May 22 13:24:43 2008  Koichi Sasada  <ko1@atdot.net>

	* eval.c, vm.c, vm_core.h, vm_insnhelper.c: specify "const".

	* vm_opts.h: add a OPT_TOKEN_THREADED_CODE macro.

Thu May 22 12:51:41 2008  Tanaka Akira  <akr@fsij.org>

	* insns.def (newhash): fix a variable definition: "const k".

Thu May 22 12:40:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (flatten): check if reentered.  [ruby-dev:34798]

Thu May 22 11:39:59 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (assert_normal_exit): capture stdout and stderr
	  of the child process.

Thu May 22 08:28:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (flatten): free memo hash table before raising exception.
	  [ruby-dev:34789]

Thu May 22 06:30:10 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* array.c (flatten): fix memory leak.

Thu May 22 06:21:34 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (nkf_str_caseeql): added.

	* ext/nkf/nkf-utf8/nkf.c (nkf_enc_find_index): use nkf_str_caseeql.

Thu May 22 05:45:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (proc_dup): should copy safe_level from src proc
	  properly.  a patch from Keita Yamaguchi
	  <keita.yamaguchi at gmail.com>

Thu May 22 02:46:08 2008  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: do not use Thread#raise. [ruby-dev:34739]

Thu May 22 00:30:06 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_require.rb: new tests for library requiring, to
	  achieve over 90% test coverage of dln.c.

	* test/ruby/test_class.rb: add tests to achieve over 90% test coverage
	  of class.c.

	* test/ruby/test_module.rb: ditto.

Thu May 22 00:15:44 2008  Koichi Sasada  <ko1@atdot.net>

	* insns.def, vm_insnhelper.c: specify "const".

Wed May 21 23:20:21 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_eval.rb: fix syntax.

Wed May 21 17:46:17 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (nkf_enc_find_index):
	  use strcasecmp. [ruby-dev:34787]

Wed May 21 16:48:22 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_compact_bang): avoid forceful realloc.

Wed May 21 07:42:28 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_usascii_str_new): use rb_str_new.

	* string.c (rb_enc_str_new): ditto.

	* string.c (rb_usascii_str_new2): use rb_str_new2.

Wed May 21 07:22:01 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c, include/ruby/encoding.h
	  (rb_enc_associate, rb_enc_associate_index):
	  returns obj. [ruby-dev:34778]

Wed May 21 04:20:20 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_ascii8bit_encoding): use ENCINDEX_ASCII.

	* encoding.c, include/ruby/encoding.h (rb_ascii8bit_encindex):
	  added.

	* encoding.c (rb_locale_encoding): use rb_usascii_encoding().

Wed May 21 01:45:58 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_file_exhaustive.rb (setup): workaround for Windows
	  Vista.

	* test/ruby/envutil.rb (rubyexec): now Open3.open3 is supported on
	  Windows.

	* test/ruby/test_process.rb: use ``||'' instead of ``;'' because
	  cmd.exe not support it.

Wed May 21 01:28:47 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c, include/ruby/encoding.h (rb_str_transcode):
	  C API of encoding conversion for Ruby object.
	  VALUE rb_str_transcode(VALUE str, VALUE to).

	* transcode.c (str_encode, str_encode_bang):
	  rename from rb_tr_transcode or rb_str_transcode_bang.

Tue May 20 23:26:05 2008  Yusuke Endoh	<mame@tsg.ne.jp>

	* test/ruby/test_array.rb: fix tests for 64bit CPU.

Tue May 20 20:59:56 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (rb_nkf_convert) (nkf_enc_without_bom):
	  reverted. nkf-utf8/nkf.c should be independent of ruby.

	* ext/nkf/nkf.c (options):
	  moved from nkf-utf8/nkf.c.
	  override nkf's original settings for Unicode BOM.

Tue May 20 13:20:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/nkf/nkf.c (rb_nkf_convert), ext/nkf/nkf-utf8/nkf.c
	  (nkf_enc_without_bom): BOM is not a part of encodings.

	* ext/nkf/nkf.c (Init_nkf), ext/nkf/nkf-utf8/nkf.c (options):
	  UTF-{16,32} without endian have no sense.

Tue May 20 12:13:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options, process_options): --dump option.

Tue May 20 11:36:06 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (PRI[diouxX]VALUE): printf format for VALUE.

	* gc.c (assign_heap_slot): suppress a warning.

Tue May 20 03:42:43 2008  Koichi Sasada  <ko1@atdot.net>

	* eval.c, vm_insnhelper.c: fix cref in instance_eval
	  and cvar_base search protocol.

	* bootstraptest/test_knownbug.rb, test_eval.rb: move solved test
	  and add new tests.

	* test/ruby/test_eval.rb: fix tests for spec.

Tue May 20 01:43:44 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: fix a test.
	  "block_given?" returns true if "yield" can be used.

Tue May 20 01:07:19 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (assignable_gen): when "self = 1" was evaluated, unnecessary
	  error message was output, which might cause null pointer access.

Tue May 20 08:38:56 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_enc_strlen_cr): need to set ENC_CODERANGE_7BIT if
	  search_nonascii() fails.    [ruby-dev:34751]

	* string.c (rb_str_reverse): preserve coderange info if the
	  receiver is 7bit string.

	* string.c (rb_str_reverse_bang): ditto.

	* string.c (rb_str_reverse_bang): should have called
	  single_byte_optimizable before rb_str_modify() that clears
	  coderange info.

	* string.c (tr_trans): handle single bytes more eagerly.

Mon May 19 23:32:12 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c (invoke_block_from_c): fix call flow.

Mon May 19 23:19:35 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* regexec.c (slow_search): check the case when the length is 1.
	  The behavior of memcmp is undefined if the third argument is 0.

Mon May 19 21:07:48 2008  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_thread_apply_priority):
	  fix argument range check.  [ruby-dev:33124]

Mon May 19 18:22:35 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/openssl/ossl_pkcs5.c (ossl_pkcs5_pbkdf2_hmac): Fix the type
	  of md; pointed out by Takahiro Kambe <taca at back-street.net>
	  in [ruby-dev:34748].

Mon May 19 17:23:55 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regparse.c (PINC): use optimized enclen() instead of
	  ONIGENC_MBC_ENC_LEN().

	* regparse.c (PFETCH): ditto.

	* regparse.c (PFETCH): small optimization.

	* regexec.c (slow_search): single byte encoding optimization.

	* regenc.h (enclen): avoid calling function when encoding's
	  min_len == max_len.

	* re.c (rb_reg_regsub): rb_enc_ascget() optimization for single
	  byte encoding.

	* re.c (rb_reg_search): avoid allocating new re_registers if we
	  already have MatchData.

	* re.c (match_init_copy): avoid unnecessary onig_region_free()
	  before onig_region_copy.

	* encoding.c (rb_enc_get_index): remove implicit enc_capable check
	  each time.

	* encoding.c (rb_enc_set_index): ditto.

	* encoding.c (enc_compatible_p): small refactoring.

	* include/ruby/encoding.h (rb_enc_dummy_p): inline
	  rb_enc_dummy_p() and export related code.

Mon May 19 14:32:03 2008  Koichi Sasada  <ko1@atdot.net>

	* version.h: fix strange change by version.h update tool.

Mon May 19 14:18:13 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: move solved tests.

	* bootstraptest/test_eval.rb, test_literal.rb, test_syntax.rb,
	  test_thread.rb: ditto.

	* test/ruby/test_m17n.rb, test_proc.rb, test_sprintf.rb,
	  test_string.rb, test/ruby/test_struct.rb: ditto.

Mon May 19 13:23:03 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (rb_spawn_internal): set last_status when status == -1
	  because there is no path to set it on win32. this patch is derived
	  from [ruby-core:16787], submitted by Luis Lavena <luislavena at
	  gmail.com>

Mon May 19 11:32:47 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.c, insns.def, eval.c, vm_insnhelper.c: fix CREF handling.
	  VM value stack frame of block contains cref information.
	 (dfp[-1] points CREF)

	* compile.c, eval_intern.h, eval_method.c, load.c, proc.c,
	  vm_dump.h, vm_core.h: ditto.

	* include/ruby/ruby.h, gc.c: remove T_VALUES because of above
	  changes.

	* bootstraptest/test_eval.rb, test_knownbug.rb: move solved test.

Sun May 18 22:26:51 2008  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservlet/filehandler.rb: should normalize path
	  name in path_info to prevent script disclosure vulnerability on
	  DOSISH filesystems. (fix: CVE-2008-1891)
	  Note: NTFS/FAT filesystem should not be published by the platforms
	  other than Windows. Pathname interpretation (including short
	  filename) is less than perfect.

	* lib/webrick/httpservlet/abstract.rb
	  (WEBrick::HTTPServlet::AbstractServlet#redirect_to_directory_uri):
	  should escape the value of Location: header.

	* lib/webrick/httpservlet/cgi_runner.rb: accept interpreter
	  command line arguments.

Sun May 18 02:54:46 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* pack.c (pack_pack): check errno to detect error of ruby_strtoul.

	* pack.c (pack_unpack): ditto.

	* test/ruby/test_pack.rb: add a test for above.

Sat May 17 23:53:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): fix for short file name on Cygwin.

Sat May 17 18:03:52 2008  Yuki Sonoda (Yugui) <yugui@yugui.jp>

	* vm.c (Init_VM): removed the definition of Thread#initialize,
	  which is overwritten in Init_Thread and is never used.

Sat May 17 14:01:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sort_bang): should not free shared pointer, and set
	  shared.  [ruby-dev:34732]

Sat May 17 12:34:54 2008  Yuki Sonoda (Yugui) <yugui@yugui.jp>

	* thread_pthread.c (Init_native_thread): Kernel#.sleep used never to
	  sleep on Mac OS X. Reported by arton <artonx AT yahoo.co.jp>.

	* thread_pthread.c (native_sleep): added error checks.

Sat May 17 11:29:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_extname): first dot is not an extension name.

Sat May 17 03:21:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_sort_bang): stop memory leak.  [ruby-dev:34726]

	* re.c (rb_reg_search): need to free allocated buffer in re_register.

	* regexec.c (onig_region_new): more pedantic malloc check.

	* regexec.c (onig_region_resize): ditto.

	* regexec.c (STATE_CHECK_BUFF_INIT): ditto.

	* regexec.c (onig_region_copy): use onig_region_resize.

Fri May 16 12:48:33 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* math.c (to_flo): rb_Float() accepts even strings for input.

	* complex.c (nucomp_to_f): fix wrong message.

	* complex.c (nucomp_to_r): ditto.

	* object.c (rb_Float): do not check NaN for error.  NaN is a part
	  of valid float values.

Thu May 15 23:36:09 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_string.rb: add tests to achieve over 90% test
	  coverage of string.c.

	* test/ruby/test_m17n.rb: ditto.

	* test/ruby/test_symbol.rb: ditto.

	* test/ruby/test_pack.rb: ditto.

Thu May 15 23:01:06 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* string.c (tr_find): String#delete returned wrong result when multiple
	  utf-8 arguments are passed.

	* test/ruby/test_m17n.rb (test_delete): add a test for above.

Thu May 15 22:37:56 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (ripper_warningS): now used.

Thu May 15 15:33:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): support for alternative data stream
	  and ignored trailing garbage of NTFS.

	* file.c (rb_file_s_basename): ditto.

	* file.c (rb_file_s_extname): ditto.

Thu May 15 13:43:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): no need for forceful warning when
	  converting to float.  overflow is a nature of float values.

	* parse.y (parser_yylex): ditto.

Thu May 15 13:23:20 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_prepare_enc): error condition was updated for non
	  ASCII compatible strings.

Thu May 15 12:19:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/openssl/openssl_missing.c (HMAC_CTX_copy): adopted
	  prototype change in openssl bundled with newer OpenBSD.
	  a patch from Takahiro Kambe <taca at back-street.net> in
	  [ruby-dev:34691].

Wed May 14 22:09:25 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* ChangeLog: fix typo.

Wed May 14 21:49:14 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_object.rb: new tests to achieve over 90% test
	  coverage of object.c, eval.c and eval_method.c.

	* test/ruby/test_module.rb: ditto.

	* test/ruby/test_trace.rb: ditto.

	* test/ruby/test_integer.rb: ditto.

	* test/ruby/test_float.rb: ditto.

	* test/ruby/test_method.rb: ditto.

	* test/ruby/test_variable.rb: ditto.

	* test/ruby/test_eval.rb: ditto.

	* test/ruby/test_exception.rb: ditto.

	* test/ruby/test_class.rb: ditto.

Wed May 14 12:46:37 2008  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (insn_operand_intern): remove Qundef related code.

Wed May 14 12:42:36 2008  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_count): Override Enumerable#count for better
	  performance.

Wed May 14 11:29:06 2008  Koichi Sasada  <ko1@atdot.net>

	* insns.def: add a "putcbase" instruction.

	* compile.c, insns.def: fix to use putcbase instruction for
	  class search.  Qundef should not be used.

Wed May 14 07:49:35 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): defer calling of rb_frame_self() until it
	  become really necessary.

	* eval.c (rb_call): ditto.

Wed May 14 00:55:56 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_io_m17n.rb: remove a duplicative method.

	* test/ruby/test_utf16.rb: rename a conflicting method name.

	* test/ruby/test_array.rb: ditto.

	* test/ruby/test_file_exhaustive.rb: ditto.

	* test/ruby/test_hash.rb: ditto.

	* test/ruby/test_env.rb: ditto.

	* test/ruby/test_fixnum.rb: ditto.

	* test/ruby/test_rational.rb: ditto.

Wed May 14 00:45:58 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval_method.c (rb_add_method): fix check for warning when
	  Object#initialize is redefined. (same as 1.8)

Tue May 13 23:32:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_yield): use rb_yield_values2.

	* enum.c (DEFINE_ENUMFUNCS): macro to define enumerator and yielding
	  functions.

	* enum.c (enum_all_func, enum_any_func, enum_one_func,
	  enum_none_func): reduced duplicate code.

Tue May 13 15:09:38 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c: Update rdoc.
	  (enumerator_initialize): Discourage the use.
	  (enum_each_slice, enum_each_cons, enumerator_each)
	  (enumerator_with_index): Add a note about a call without a block.

Tue May 13 08:25:31 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_f_gets): re-enable rdoc.
	  (rb_f_readline): ditto.
	  (rb_f_readlines): ditto.

Tue May 13 07:56:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_cat): fixed buffer overrun reported by
	  Christopher Thompson <cthompson at nexopia.com> in [ruby-core:16746]

Mon May 12 23:37:57 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (collect_local_variables_in_env): remove unnecessary check
	  which causes: x=1;proc{local_variables}.call #=> []

	* test/ruby/test_variable.rb: add a test for above.

Mon May 12 23:05:24 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c, include/ruby/intern.h (rb_run_exec_options): externed.

	* process.c (save_redirect_fd, save_env_i, save_env, run_exec_dup2,
	  run_exec_open, run_exec_pgroup, run_exec_rlimit, rb_run_exec_options):
	  save parent's process environments.

	* process.c (rb_spawn_internal): remove calling run_exec_options()
	  because cannot restore after spawn.

	* io.c (pipe_open): ditto.

	* test/ruby/test_process.rb (test_execopts_env): upcase environment
	  variable name for case insensitive platforms.

	* win32/win32.c (init_env): set USER environment variable only when
	  USERNAME is available.

Mon May 12 22:23:01 2008  Tanaka Akira  <akr@fsij.org>

	* lib/date.rb (once): use Object#object_id instead of Symbol#to_i.

Mon May 12 21:34:46 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/envutil.rb (rubybin): return expanded rubyexe instead of
	  expanded ruby if available.

Mon May 12 20:19:55 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enum.c (grep_i): Be aware of multiple values;
	  fix [ruby-dev:34653].
	  (grep_iter_i): Ditto.
	  (count_i): Ditto.
	  (find_i): Ditto.
	  (find_index_i): Ditto.
	  (find_all_i): Ditto.
	  (reject_i): Ditto.
	  (inject_i): Ditto.
	  (inject_op_i): Ditto.
	  (partition_i): Ditto.
	  (group_by_i): Ditto.
	  (first_i): Ditto.
	  (sort_by_i): Ditto.
	  (all_i): Ditto.
	  (all_iter_i): Ditto.
	  (any_i): Ditto.
	  (any_iter_i): Ditto.
	  (one_i): Ditto.
	  (one_iter_i): Ditto.
	  (none_i): Ditto.
	  (none_iter_i): Ditto.
	  (min_i): Ditto.
	  (min_ii): Ditto.
	  (max_i): Ditto.
	  (max_ii): Ditto.
	  (minmax_i): Ditto.
	  (minmax_ii): Ditto.
	  (min_by_i): Ditto.
	  (max_by_i): Ditto.
	  (minmax_by_i): Ditto.
	  (member_i): Ditto.
	  (take_i): Ditto.
	  (take_while_i): Ditto.
	  (drop_i): Ditto.
	  (drop_while_i): Ditto.
	  (cycle_i): Ditto.

	* enum.c (each_with_index): Update rdoc.  each_with_index() takes
	  arguments that are passed through to each(), and a hash preserves
	  key order.

Mon May 12 19:05:24 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (rb_spawn_internal): remove calling run_exec_options()
	  because cannot restore after spawn. we'll fix this later.

Mon May 12 18:16:44 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (rb_spawn_internal): need to call run_exec_options() before
	  spawn if the platform doesn't have fork. [ruby-dev:34647]

Mon May 12 15:20:02 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (ruby_vm_xmalloc): increase malloc_increase only if malloc
	  succeeds.  failed malloc size can be huge.  it may increase
	  malloc_limit too big which cause less GC and memory full.
	  (ruby_vm_xrealloc): ditto.
	  (rb_objspace): make params.limit and params.increase size_t.

Mon May 12 15:04:58 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_prepare_re): made non static with small refactoring.

	* ext/strscan/strscan.c (strscan_do_scan): should adjust encoding
	  before regex searching.

Mon May 12 13:57:19 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (is_defined): add NODE_OP_ASGN_{OR,AND}.  "defined?(a||=1)"
	  should not operate assignment.  [ruby-dev:34645]

Mon May 12 13:29:26 2008  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigzero_p): check from MSB to LSB.  [ruby-dev:34649]

Mon May 12 12:32:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RUBYOPT): affected BASERUBY too.  [ruby-talk:301514]

Mon May 12 12:27:55 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (assign_heap_slot): fix condition for number of objects in
	  a heap.

Mon May 12 12:24:48 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_to_i): really removed.  [ruby-dev:34641]

Mon May 12 11:15:55 2008  Yuki Sonoda (Yugui) <yugui@yugui.jp>

	* gc.c (assign_heap_slot):  put the binary search routine in order.

Mon May 12 10:52:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_gems), gem_prelude.rb: check if Gem is defined
	  instead of Gem::Enable.

	* gem_prelude.rb (load_full_rubygems_library, const_missing): prevent
	  infinite recursion.  [ruby-dev:34539]

Sun May 11 23:19:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (all_iter_i, any_iter_i): reduced duplicated code.

Sun May 11 22:54:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/runner.rb (main): leave -I options for purelib.rb
	  untouched.

	* bootstraptest/runner.rb (main): handle relative path -r options.

Sun May 11 19:04:06 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_thread.rb: kill and join temporal threads that are
	  created in each test.

Sun May 11 17:58:45 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_process.rb (TestProcess#with_stdin): defined.
	  (TestProcess#test_argv0_noarg): don't use redirect_fds.
	  [ruby-dev:34647]

Sun May 11 17:57:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (MINIRUBY): should not include extension library path.

Sun May 11 14:40:36 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (SIZET2NUM): new macro.
	  (NUM2SIZET): new macro.

	* gc.c (struct rb_objspace): use size_t for increment, length and
	  used for 64bit.
	  (allocate_heaps): ditto.
	  (assign_heap_slot): ditto.
	  (set_heaps_increment): ditto.
	  (gc_mark_all): ditto.
	  (is_pointer_to_heap): ditto.
	  (free_unused_heaps): ditto.
	  (gc_sweep): ditto.
	  (os_obj_of): ditto.
	  (rb_gc_call_finalizer_at_exit): ditto.
	  (count_objects): ditto.

Sun May 11 13:14:09 2008  Tanaka Akira  <akr@fsij.org>

	* thread.c (thread_cleanup_func_before_exec): extracted from
	  thread_cleanup_func not to touch pthread data.
	  pthread_cond_destroy in forked process may cause deadlock on
	  Debian GNU/Linux Etch on x86, x86-64 and IA64.
	  this doesn't cause resource leak because the process will exec soon.
	  (terminate_atfork_before_exec_i): defined.
	  (rb_thread_atfork_before_exec): defined.

	* include/ruby/intern.h (rb_thread_atfork_before_exec): declared.

	* process.c (rb_exec_atfork): call rb_thread_atfork_before_exec
	  instead of rb_thread_atfork.

	* io.c (popen_exec): call rb_thread_atfork_before_exec instead of
	  rb_thread_atfork.

Sat May 10 22:14:03 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (tr_trans): single '^' does not mean negation.
	  [ruby-dev:34632]

	* string.c (tr_trans): should check src size, not str size.
	  [ruby-dev:34637]

	* string.c (tr_trans): should not turn on modify flag if no
	  modification happens.  [ruby-dev:34631]

Sat May 10 18:11:18 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_each_line): zero length record separator should
	  split a string into paragraphs.  [ruby-dev:34586]

	* string.c (rb_str_each_line): RDoc updated.

Sat May 10 11:36:20 2008  Tanaka Akira  <akr@fsij.org>

	* vm.c (env_mark): mark env->block.self.  prevent SEGV when GC occur
	  in prepare_iseq_build with gcc version 3.4.6 [FreeBSD] 20060305 on
	  FreeBSD/amd64.

Fri May  9 19:16:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (timeofday): use monotonic clock.  based on a patch
	  from zimbatm <zimbatm at oree.ch> in [ruby-core:16627].

Fri May  9 07:47:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* cont.c (cont_restore_0): dynamic stack direction code should be
	  consistent with static one.  [ruby-talk:301152]

Fri May  9 00:03:50 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (arg): operator assignment "a += b rescue c" should be
	  parsed as "a += (b rescue c)" just like normal assignment.
	  [ruby-talk:301000]

Thu May  8 18:14:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_and): bit-wise operation should not take float
	  values.  [ruby-dev:34612]

	* bignum.c (rb_big_or): ditto.

	* bignum.c (rb_big_xor): ditto.

Thu May  8 17:44:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk, ext/extmk.rb, lib/mkmf.rb: use absolute path for RUBYOPT.

	* file.c (rb_find_file_ext): guard load_path from GC.
	  gcc version 4.1.2 20061115 (prerelease) (Debian 4.1.1-21) optimizes
	  load_path by holding only RARRAY_LEN(load_path) and
	  RARRAY_PTR(load_path) in registers on IA64 GNU/Linux Etch.

Thu May  8 16:41:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (MINIRUBY), common.mk (RUBYOPT): add purelib.rb.
	  [ruby-core:16642]

Thu May  8 16:00:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): ! and ? at the bottom are no longer part
	  of valid symbol names.  [ruby-dev:34590]

Thu May  8 15:36:11 2008  Tanaka Akira  <akr@fsij.org>

	* thread.c (rb_gc_save_machine_context): call FLUSH_REGISTER_WINDOWS
	  to mark the register stack from GC on another thread.

Thu May  8 15:14:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sort_bang): freeze temporary array.

Thu May  8 13:19:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_mark): mark stat_insn_usage only when ptr is not
	  null.

Thu May  8 10:44:04 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (sort_reentered): reentered check may be called from
	  Array#sort.

Thu May  8 09:51:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (sort_1, sort_2): check for reentered and if elements are
	  accessible.  [ruby-core:16679]

Thu May  8 06:43:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_find_exe_r, dln_find_file_r): reentrant versions.

	* file.c (rb_find_file_ext, rb_find_file), process.c (proc_exec_v),
	  (rb_proc_exec, proc_spawn_v, proc_spawn), ruby.c (process_options):
	  use reentrant versions.

Thu May  8 06:27:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_key_p): thread local storage stores ID.

Thu May  8 01:10:03 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (tr_trans): should squeeze properly.  [ruby-dev:34587]

	* string.c (tr_trans): had a bug in treating multi-byte character
	  replacement.

	* string.c (rb_str_delete_bang): need not to do anything for empty
	  strings.

	* test/ruby/test_m17n_comb.rb (TestM17NComb::test_str_delete): add
	  test for empty receiver.

Wed May  7 20:19:18 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (process_options, ruby_set_argv): set encoding of rb_argv
	  after Init_prelude() because cannot load encoding extensions before
	  it.

Wed May  7 20:00:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (bit_coerce): float should not be a valid operand of
	  bitwise operations.  [ruby-dev:34583]

Wed May  7 19:35:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (rb_thread_key_p): should always convert symbol to ID.
	  [ruby-dev:34588]

Wed May  7 19:30:34 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_divide): float division should floor() before
	  rounding into integer.  [ruby-dev:34584]

Wed May  7 18:02:01 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_to_i): remove obsolete method.  preparation for
	  symbol GC.

	* numeric.c (fix_to_sym): ditto.

	* numeric.c (fix_id2name): ditto.

Wed May  7 17:43:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_puts_ary): check recursion first.  [ruby-dev:34580]

Wed May  7 17:41:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_eval_body): initialize retval.  [ruby-dev:34576]

Wed May  7 13:02:56 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_fdiv): flo.fdiv(NaN) should result NaN.

	* numeric.c (num_quo): renamed and moved from bignum.c.
	  [ruby-dev:34582]

	* bignum.c (rb_big_fdiv): update RDoc description

	* rational.c (nurat_s_new_m): small refactoring.

	* bignum.c (rb_big2dbl): no need for forceful warning when
	  converting to float.  overflow is a nature of float values.

Wed May  7 00:54:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/zlib/zlib.c (gzreader_gets): may cause infinite loop.
	  a patch from Kouya <kouyataifu4 at gmail.com> in
	  [ruby-reference-manual:762].

Tue May  6 02:08:18 2008  Tanaka Akira  <akr@fsij.org>

	* test/io/nonblock/test_flush.rb: don't set Thread.abort_on_exception.

	* test/net/imap/test_imap.rb: ensure disconnecting imap to terminate
	  receiver thread.

Tue May  6 00:29:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* iseq.c (insn_operand_intern): should handle Qundef embedded in
	  operand.  [ruby-core:16656]

Tue May  6 00:00:02 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (iseq_compile_each): should call compile_cpath() for
	  modules as well.  [ruby-dev:34585]

	* insns.def (defineclass): add undef handling.

Mon May  5 23:49:40 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (defineclass): was using wrong variable.  [ruby-dev:34592]

Mon May  5 20:07:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_fflush): IO#flush problem within threads.  a patch from
	  <s.wanabe at gmail.com> in [ruby-dev:34595].

Mon May  5 19:58:44 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (defined_expr): protect some expression from
	  segmentation fault.  a patch from wanabe <s.wanabe at gmail.com>
	  in [ruby-dev:34593].

Mon May  5 19:49:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_s_def): Struct.new(0) should not SEGV.
	  based on the patch from wanabe <s.wanabe at gmail.com> in
	  [ruby-dev:34594].

	* struct.c (make_struct): call to_str on name object.

Mon May  5 17:17:40 2008  Tanaka Akira  <akr@fsij.org>

	* eval.c (ruby_cleanup): wrap ruby_finalize_0 by SAVE_ROOT_JMPBUF to
	  avoid SEGV by at_exit { Fiber.new{}.resume } on IA64.

Mon May  5 12:12:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_slice_bang): should adjust length before making
	  sub-array.

Mon May  5 11:36:14 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_dup): should dupe corresponding information.
	  [ruby-dev:34581]

Mon May  5 11:13:50 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (compile_cpath): use Qundef to denote cbase lookup.

	* insns.def (defineclass): Qundef is passed for cbase.

	* insns.def (setconstant): ditto.

	* vm_insnhelper.c (vm_check_if_namespace): use rb_inspect()
	  instead of rb_obj_as_string() for better description.

Mon May  5 02:10:23 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (set_heaps_increment): fix memory allocation strategy by
	  determining heaps_inc from heaps_used, not objects_delta.
	  (struct rb_objspace): delta removed.  change increment, length and
	  used to long for LP64.
	  (objects_delta): removed.
	  (allocate_heaps): add next_heaps_length argument.
	  (init_heap): renamed from add_heap.
	  (garbage_collect): use heaps_increment in dont_gc.

Sun May  4 21:09:32 2008  Tanaka Akira  <akr@fsij.org>

	* lib/getoptlong.rb: use $stderr instead of $deferr.

Sun May  4 16:04:28 2008  Tanaka Akira  <akr@fsij.org>

	* time.c (obj2nsec): fix string argument.

Sun May  4 14:29:14 2008  Tanaka Akira  <akr@fsij.org>

	* eval.c (rb_obj_respond_to): check the result of respond_to? method
	  by RTEST.

Sun May  4 12:57:58 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_each_line): return original string.

Sat May  3 20:57:06 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/envutil.rb (Test::Unit::Assertions#assert_normal_exit):
	  new method.

Sat May  3 18:10:54 2008  Tanaka Akira  <akr@fsij.org>

	* time.c (time_timespec): raise TypeError for nil and other objects
	  which has no divmod method.

Fri May  2 23:59:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (internal_read_func, internal_write_func): split from
	  internal_io_func.

Fri May  2 23:55:15 2008  Tanaka Akira  <akr@fsij.org>

	* variable.c (rb_define_hooked_variable): guard *var from GC to
	  prevent collecting argf under RUBY_DEBUG=gc_stress.

Fri May  2 17:29:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_step): call to_int if step is not a numeric
	  value.  [ruby-dev:34575]

Fri May  2 16:10:57 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_step): do not forcefully convert steps into
	  integers.  [ruby-dev:34571]

Fri May  2 14:52:33 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el: move fontifying code from hook.  a patch from
	  Phil Hagelberg <phil at hagelb.org> in [ruby-core:16636].

Fri May  2 14:10:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_step): step may be bignum.

Fri May  2 13:52:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (Init_Regexp): remove MatchData#select.  [ruby-dev:34563]

Thu May  1 23:59:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_divide), numeric.c (fix_divide): check for result
	  domain.  [ruby-dev:34559]

Thu May  1 23:57:06 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/net/telnet.rb:  This patch from Brian Candler adds a FailEOF mode which
	  can be activated to have net/telnet raise EOFError exceptions when the
	  remote connection is closed.  The default behavior remains unchanged though.

Thu May  1 23:43:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (range_step): check if step can be converted to an integer.
	  [ruby-dev:34558]

	* range.c (range_step): allow float step bigger than zero but less
	  than one.  [ruby-dev:34557]

Thu May  1 23:20:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_divide): return an integer for idiv.
	  [ruby-dev:34553]

Thu May  1 20:47:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_s_create): should access converted hash value.
	  [ruby-dev:34555]

Thu May  1 20:31:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_parse.rb (TestParse::test_void_expr_stmts_value):
	  shut up warning.

	* rational.c (nurat_to_f): no need for forceful warning when
	  converting to float.  overflow is a nature of float values.

Thu May  1 16:10:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (env_delete_if): return enumerator if no block given.
	  [ruby-dev:34554]

Wed Apr 30 21:36:40 2008  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/erb.rb (url_encode): [ruby-dev:34497] ERB::Util#url_encode
	  bug fix. Reported by rubikitch.

	* test/erb/test_erb.rb: ditto

Wed Apr 30 20:11:36 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/net/telnet.rb: Fixing a bug where line endings would not be properly
	  escaped when the two character ending was broken up into separate TCP
	  packets.  Issue reported and patched by Brian Candler.

Wed Apr 30 18:03:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_load_path), vm_core.h (rb_vm_t): moved to VM.

	* load.c (rb_get_load_path): returns absolute load path.

	* load.c (load_path_getter): $LOAD_PATH getter.

	* file.c (rb_find_file_ext, rb_find_file), ruby.c (push_include,
	  ruby_init_loadpath): use the accessor.

	* vm.c (rb_vm_mark): mark load_path.

Wed Apr 30 17:47:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_search): use local variable.  a patch from wanabe
	  <s.wanabe AT gmail.com> in [ruby-dev:34537].  [ruby-dev:34492]

Wed Apr 30 16:10:18 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval_intern.h: specify the values of the enumeration constants
	  explicitly.  [ruby-dev:34489]

Wed Apr 30 12:32:39 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (check_exec_redirect_fd): prohibit duplex IO.
	  (check_exec_fds): record maxhint even if close_others is not
	  specified.
	  (rb_exec_arg_fixup): renamed from rb_exec_arg_fix.

Mon Apr 28 20:24:27 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_marshal_load): checks the given
	  denominator. [ruby-dev:34536]

Mon Apr 28 14:21:18 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (POSFIXABLE): use FIXNUM_MAX+1 instead of
	  FIXNUM_MAX to make it possible to convert to double accurately on
	  environments with 64bit VALUE and 64bit double.
	  It assumes FLT_RADIX is 2.
	  fix RubyForge bug #14102.

Mon Apr 28 12:48:57 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (rb_exec_arg_addopt, rb_exec_arg_addopt): now can specify
	  close_exec on having no fork environment (but still meaningless).

Mon Apr 28 11:11:29 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (run_exec_options): don't call FIX2INT for nil.

Mon Apr 28 11:11:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (method_name): should return symbols instead of strings.
	  [ruby-dev:34531]

Mon Apr 28 09:02:43 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_exec_arg_init): declared.
	  (rb_exec_arg_addopt): declared.
	  (rb_exec_arg_fix): declared.
	  (rb_exec_initarg): removed.
	  (rb_exec_getargs): removed.
	  (rb_exec_initarg2): removed.

	* io.c (struct popen_arg): make execarg as a pointer.
	  (popen_exec): follow popen_arg change.
	  (pipe_open): add eargp argument.  extract argc and argv from eargp.
	  use rb_exec_arg_addopt to add redirect options.
	  (pipe_open_v): set up struct rb_exec_arg.
	  (pipe_open_s): set up struct rb_exec_arg.

	* process.c (rb_exec_arg_addopt): new function extracted from
	  check_exec_options_i.
	  (check_exec_options_i): use rb_exec_arg_addopt.
	  (rb_check_exec_options): opthash is always a hash now.
	  (rb_exec_getargs): make it static.
	  (rb_exec_fillarg): renamed from rb_exec_initarg2.  don't set up
	  redirect_fds.
	  (rb_exec_arg_init): new function.
	  (rb_exec_arg_fix): new function.
	  (rb_f_exec): use rb_exec_arg_init and rb_exec_arg_fix.  use
	  rb_exec_arg_addopt to set close_others option.
	  (run_exec_options): make close_others by default.
	  (rb_spawn_internal): use rb_exec_arg_init and rb_exec_arg_fix.  use
	  rb_exec_arg_addopt to set close_others option.

Sun Apr 27 18:59:04 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_expt): use f_rational_new2. [ruby-dev:34524]

Sun Apr 27 15:23:40 2008  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_count): add a GC.count method.  This method returns
	  a GC invoking count.

Sun Apr 27 12:20:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_vm_t), gc.c (rb_objspace, rb_newobj), vm.c
	  (Init_BareVM): per-VM object space support, which is disabled now.

	* gc.c (rb_objspace_alloc), vm.c (Init_BareVM): should not use ruby
	  malloc here.

	* gc.c (garbage_collect, etc): performance improvement by passing the
	  reference instead of referring the global variable in each functions.

Sun Apr 27 08:06:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (ruby_set_argv): ARGV should be locale encoding.
	  [ruby-list:44861]

Sun Apr 27 01:46:29 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb (Open3.popen3w): removed.
	  (Open3.popen3): notice wait_thr.

Sun Apr 27 01:13:05 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc, test/rdoc:  Update to RDoc 2.0.0 r56.

Sat Apr 26 21:30:40 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_hash_dup): declared.

	* hash.c (rb_hash_dup): new function.

	* process.c (rb_spawn_internal): don't modify option hash.

Sat Apr 26 18:36:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c, signal.c, thread.c, thread_win32.c, include/ruby/intern.h:
	  suppress warnings.

Sat Apr 26 17:42:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (builtin_types), gc.c (count_objects): added Complex and
	  Rational.

Sat Apr 26 17:35:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_eNOERROR): renamed.

Sat Apr 26 17:30:11 2008  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h, gc.c: remove T_BLOCK.

	* include/ruby/ruby.h: re-number T_xxx.

Sat Apr 26 17:31:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_cProcessTms, rb_cProcessStatus): renamed.

	* error.c (builtin_types), signal.c (siglist), st.c (primes),
	  struct.c (ref_func), time.c (months): constified.

Sat Apr 26 13:00:41 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open3.rb: double fork is replaced by spawn with Process.detach.
	  (Open3.popen3w): new method to access the thread returned by
	  Process.detach.

Sat Apr 26 00:47:43 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (rb_spawn_internal): new function to specify
	  default_close_others.
	  (rb_spawn): specify default_close_others true.
	  (rb_f_system): call rb_spawn_internal with default_close_others as
	  false.

Sat Apr 26 12:26:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_each): use INT2FIX() for fixnum values.

Fri Apr 25 17:56:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (free_unused_heaps): preserve last used heap segment to
	  reduce malloc() call.

Fri Apr 25 17:54:10 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (HEAP_SIZE): use smaller heap segment (2K) for more chance
	  to be freed.  based on patch from authorNari <authornari at gmail.com>.

	* gc.c (rb_newobj_from_heap): eventually allocate heap segments.

Fri Apr 25 15:35:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_spawn): rb_exec_initarg() returns new argc and argv in
	  earg.

Fri Apr 25 12:37:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (flatten): returns an instance of same class.
	  [ruby-core:16554]

Fri Apr 25 10:52:27 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: define mode_t for umask.

	* process.c (check_exec_options_i, check_exec_fds, run_exec_options):
	  support "close_others" only when fork(2) is available.

Fri Apr 25 00:16:11 2008  Tanaka Akira  <akr@fsij.org>

	* process.c: include sys/stat.h for umask.

Thu Apr 24 23:25:17 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_env_clear): declared.
	  (rb_io_mode_modenum): declared.
	  (rb_close_before_exec): declared.
	  (struct rb_exec_arg): add options and redirect_fds field.
	  (rb_check_argv): removed.
	  (rb_exec_initarg): declared.
	  (rb_exec_getargs): declared.
	  (rb_exec_initarg2): declared.
	  (rb_fork): add third argument: fds.

	* io.c (max_file_descriptor): new static variable to record maximum
	  file descriptor ruby used.
	  (UPDATE_MAXFD): new macro.
	  (UPDATE_MAXFD_PIPE): new macro.
	  (rb_io_mode_modenum): externed.
	  (rb_sysopen): update max_file_descriptor.
	  (rb_close_before_exec): new function.
	  (popen_exec): redirection removed because it is done by extended
	  spawn mechanism.
	  (pipe_open): generate a hash for spawn options to specify
	  redirections.
	  (pipe_open_v): use rb_exec_getargs.
	  (pipe_open_s): use rb_exec_getargs.
	  (rb_io_initialize): update max_file_descriptor.

	* process.c (hide_obj): new function.
	  (check_exec_redirect_fd): new function.
	  (check_exec_redirect): new function.
	  (check_exec_options_i): new function.
	  (check_exec_fds): new function.
	  (rb_check_exec_options): new function.
	  (check_exec_env_i): new function.
	  (rb_check_exec_env): new function.
	  (rb_exec_getargs): new function.
	  (rb_exec_initarg2): new function.
	  (rb_exec_initarg): new function.
	  (rb_f_exec): use rb_exec_initarg.
	  (intcmp): new function.
	  (run_exec_dup2): new function.
	  (run_exec_close): new function.
	  (run_exec_open): new function.
	  (run_exec_pgroup): new function.
	  (run_exec_rlimit): new function.
	  (run_exec_options): new function.
	  (rb_exec): call run_exec_options.
	  (move_fds_to_avoid_crash): new function.
	  (pipe_nocrash): new function.
	  (rb_fork): use pipe_nocrash to avoid file descriptor conflicts.
	  (rb_spawn): use rb_exec_initarg.
	  (rlimit_resource_name2int): extracted from rlimit_resource_type.
	  (rlimit_type_by_hname): new function.
	  (rlimit_type_by_lname): new function.
	  (rlimit_resource_type): use rlimit_type_by_hname.
	  (proc_daemon): add fds argument for rb_fork.

	* hash.c (rb_env_clear): renamed from env_clear and externed.

	[ruby-dev:34086]

Thu Apr 24 23:00:58 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_thread.rb: fix typos.

	* test/ruby/envutil.rb (rubyexec): move Open3.popen3 call into timeout
	  block.

Thu Apr 24 22:34:52 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_comparable.rb: new tests for Comparable, to achieve
	  100% test coverage of compar.c.

Thu Apr 24 17:19:01 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (process_options): set safe_level before loading script.
	  [ruby-dev:34421]

Thu Apr 24 14:15:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_find_1): prior files with extensions to files sans
	  extensions.  [ruby-core:16517]

Thu Apr 24 00:26:06 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/ri/descriptions.rb: fixed wrong class nestings.

Thu Apr 24 00:20:01 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_settracefunc.rb: add a test for set_trace_func.

	* test/ruby/envutil.rb: move "rubyexec" method from test_rubyoptions.rb.

	* test/ruby/test_rubyoptions.rb: use rubyexec in envutil.rb.

	* test/ruby/test_thread.rb: add tests to achieve over 90% test coverage
	  of thread.c.

Wed Apr 23 15:28:52 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_no_create): failed
	  notice moved from comment to assertion message. [ruby-dev:29127]

Wed Apr 23 11:49:54 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#each, SortedSet#each, TC_Set#test_each): Return
	  an enumerator if no block is given.

Wed Apr 23 00:36:03 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/openssl/test_ssl.rb (start_server): add timeout to server.join.

Wed Apr 23 00:18:45 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_symbol.rb (TestSymbol#test_to_proc): Improve
	  tests of Symbol#to_proc.

Tue Apr 22 22:40:57 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/drb/drb.rb (DRb::DRbServer::check_insecure_method): should
	  check method names by symbols, not by strings.  a patch from
	  Kazuhiro NISHIYAMA <zn at mbf.nifty.com> in [ruby-dev:34487].

Tue Apr 22 22:15:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el (ruby-style-{case,label}-indent): up list from
	  indentation point.

Tue Apr 22 21:09:05 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (score_table_A0, score_table_F0):
	  type of content is unsigned char.

	* ext/nkf/nkf-utf8/nkf.c (push_broken_buf): 'c' is nkf_char.

	* ext/nkf/nkf-utf8/nkf.c (push_broken_buf): enc is 0 or pointer.

	* ext/nkf//nkf.c (options): type of option is unsigned char.

Tue Apr 22 20:51:58 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (z_conv): characters must be nkf_char.

Tue Apr 22 19:23:05 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c (enumerator_initialize): Remove an undocumented
	  feature (passing a block to the constructor) that's broken.
	  This is not what I intended.

Tue Apr 22 17:54:05 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm_core.h (exec_event_hooks): ``inline'' is a type modifier, not
	  a type itself.

Tue Apr 22 16:24:27 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): do not use C++ comments.

Tue Apr 22 16:23:53 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in: use AC_USE_SYSTEM_EXTENSIONS.

Tue Apr 22 16:23:16 2008  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm_evalbody.c (DECL_SC_REG): use __asm__ instead.

Tue Apr 22 16:18:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_evalbody.c (DECL_SC_REG): typo fixed.

Tue Apr 22 15:25:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (struct timespec): needs time.h according to POSIX.

Tue Apr 22 13:19:48 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (rb_thread_stop_timer_thread): should clear
	  timer_thread_id after stopping it.

Tue Apr 22 13:12:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_join): remove the current thread from the join list
	  of the target thread.

Tue Apr 22 12:03:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): search from the base klass if it
	  is given.

Tue Apr 22 09:58:13 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/win32ole/win32ole.c: avoid warnings.

Tue Apr 22 09:56:51 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (eaccess): workaround for recent msvcrt's behavior.
	  [ruby-core:16460]

Mon Apr 21 19:08:32 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_body): call rb_io_check_readable and
	  rb_io_check_writable.

Mon Apr 21 17:45:27 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ext/dbm/dbm.c (fdbm_each_value, fdbm_each_key, fdbm_each_pair):
	  GDBM#{each,each_pair,each_key,each_value}: Return an enumerator
	  if no block is given.

	* ext/gdbm/gdbm.c (fgdbm_each_value, fgdbm_each_key,
	  fgdbm_each_pair): GDBM#{each,each_pair,each_key,each_value}:
	  Return an enumerator if no block is given.

	* ext/openssl/ossl_config.c (ossl_config_each):
	  OpenSSL::Config#each: Return an enumerator if no block is given.

	* ext/readline/readline.c (hist_each): Readline::HISTORY#each:
	  Return an enumerator if no block is given.

	* ext/sdbm/init.c (fsdbm_each_value, fsdbm_each_key,
	  fsdbm_each_pair): SDBM#{each,each_pair,each_key,each_value}:
	  Return an enumerator if no block is given.

	* ext/stringio/stringio.c (strio_each_byte, strio_each):
	  StringIO#{each,each_line,each_byte}: Return an enumerator if no
	  block is given.

	* ext/stringio/stringio.c (Init_stringio): Add #lines and #bytes,
	  which are aliases to #each_line and #each_byte, respectively.

	* ext/win32ole/win32ole.c (fole_each): WIN32OLE#each: Return an
	  enumerator if no block is given.

	* ext/zlib/zlib.c (rb_gzreader_each_byte, rb_gzreader_each):
	  Zlib::GzipReader#{each,each_line,each_byte}: Return an
	  enumerator if no block is given.

	* ext/zlib/zlib.c (Init_zlib): Add Zlib::GzipReader#lines and
	  #bytes, which are aliases to #each_line and #each_byte,
	  respectively.

Mon Apr 21 17:01:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (rb_iseq_compile_with_option): check if src is a string.
	  [ruby-core:16453]

Mon Apr 21 16:06:47 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_init): preserve the method name in ID.

	* enumerator.c (enumerator_each): need not to call rb_to_id().

	* enumerator.c (enumerator_with_index): ditto.

Mon Apr 21 11:00:27 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (defined_expr): capture exception during defined?
	  evaluation.  a patch from wanabe <s.wanabe at gmail.com> in
	  [ruby-dev:34461].  [ruby-core:16010]

Mon Apr 21 10:06:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c: should include <errno.h> to refer to errno.

Mon Apr 21 09:58:04 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* time.c (rb_strftime): check errno to detect strftime(3)'s error.
	  this is workaround for recent version of MSVCRT.
	  [ruby-dev:34456]

Mon Apr 21 08:54:30 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (ruby_xmalloc): use size_t for malloc argument instead of long.

Sun Apr 20 21:00:21 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c, include/ruby/ruby.h: Export rb_cEnumerator.

Sun Apr 20 20:47:50 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enumerator.c: Resolve the method every time an enumeration
	  method is run, not once when the enumerator is initialized as it
	  was before, so that method_missing() and method (re)definition
	  afterwards are both in effect; pointed out in: [ruby-core:16441]

Sun Apr 20 15:11:00 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_rbuf_to_dst): removed.
	  (copy_stream_fallback_body): don't bypass write method.
	  (copy_stream_body): simplified.

Sun Apr 20 15:01:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (struct iseq_compile_data): moved label_no from
	  new_label_body().

	* compile.c (iseq_set_exception_table): allocates catch_table only
	  when entries exist.

	* compile.c (struct iseq_link_element, struct iseq_insn_data): made
	  enum for debuggers.

Sun Apr 20 14:44:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): fix for splat in when and rescue.
	  a patch from wanabe <s.wanabe AT gmail.com> in [ruby-dev:34429].
	  [ruby-core:14537]

Sun Apr 20 13:55:37 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_fallback): write directly (bypassing write method)
	  if possible.

Sun Apr 20 12:49:03 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_fallback): read directly (bypassing readpartial
	  method) if possible.

Sun Apr 20 04:45:13 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_body): use readpartial and write method for
	  non-IOs such as StringIO and ARGF.

Fri Apr 18 20:57:33 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_array.rb: add tests to achieve over 95% test coverage
	  of array.c.

Fri Apr 18 17:37:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_gc_mark_locations): get rid of underflow.

	* gc.c (mark_current_machine_context): check if the main thread stack
	  position may shrink under the initialized position.  [ruby-core:16436]

Thu Apr 17 22:20:52 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* enc/trans/utf_16_32.c (fun_so_to_utf_16be, fun_so_to_utf_16le): add
	  parentheses to remove warnings of gcc.

	* io.c (rb_io_getc): remove unused variables.

	* compile.c (NODE_NEXT, NODE_REDO): remove unused labels.

	* ext/nkf/nkf.c (rb_nkf_convert): remove unused variables.

	* ext/syck/rubyext.c (syck_resolver_initialize,
	  syck_resolver_detect_implicit, syck_emitter_emit): remove unused
	  variables.

Thu Apr 17 20:12:47 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rubyoptions.rb (test_search): enable some assertions.

	* test/ruby/test_rubyoptions.rb: flunk message in win32.

Thu Apr 17 16:07:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (ruby): run in C locale.

	* test/ruby/test_rubyoptions.rb (test_encoding): --encoding does not
	  affect source code.

Thu Apr 17 00:45:41 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_process.rb (test_rlimit_nofile): reset RLIMIT_NOFILE
	  before exit (for gcov).

	* test/ruby/test_rubyoptions.rb: new tests for option of ruby
	  interpreter, to achieve over 95% test coverage of ruby.c.

Wed Apr 16 02:40:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): preludes and parser need to run in safe
	  level 0.  [ruby-dev:34407]

Wed Apr 16 02:26:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): dln_find_file returns the pointer to a
	  static buffer, so should copy it.  [ruby-dev:34409]

Tue Apr 15 23:08:46 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/xmlrpc/client.rb: fix cookie handling. [ruby-dev:34403]

	* test/xmlrpc/test_cookie.rb: add a test for the above fix.

Tue Apr 15 19:20:14 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c: #undef rb_argv moved before #define.

Tue Apr 15 18:02:17 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_argv): replaced with rb_get_argv().
	  [ruby-Bugs-19514]

Tue Apr 15 17:10:59 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/net/http.rb, lib/net/smtp.rb, lib/net/pop.rb: update
	  URLs of Japanese documents.

Tue Apr 15 16:45:14 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_symbol.rb (TestSymbol#test_to_proc): add tests.

Tue Apr 15 15:38:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-encoding-map): added shift-jis for older
	  versions.

	* misc/ruby-mode.el (ruby-mode-set-encoding):
	  coding-system-to-mime-charset is not a standard function.
	  [carbon-emacs:795]
	  fix for the case that magic comment exists but coding system is
	  absent.

	* misc/ruby-mode.el (ruby-mode): use write-contents-functions or
	  write-contents-hooks for older versions.

Tue Apr 15 07:21:21 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_div): [ruby-dev:34357]

	* complex.c (nucomp_abs): use hypot.

	* complex.c (nucomp_quo): do not force conversion.

	* test/ruby/test_complex.rb: omitted some meaningless tests.

Mon Apr 14 23:25:50 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_objectspace.rb: add a test for
	  ObjectSpace.count_objects.

Mon Apr 14 22:44:24 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (SET_EXTERNAL_ENCODING): avoid call rb_enc_check() on
	  half-baked result string.

	* re.c (rb_reg_search): make search reentrant.  [ruby-dev:34223]

	* test/ruby/test_parse.rb (TestParse::test_global_variable):
	  should preserve $& variable.

Mon Apr 14 17:23:27 2008  Akinori MUSHA  <knu@iDaemons.org>

	* hash.c (rb_hash_delete_if, rb_hash_reject_bang, env_delete_if,
	  env_reject_bang): Return an enumerator if no block is given.

Mon Apr 14 14:33:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c, compile.h (compile_debug): made runtime option.

	* debug.c (ruby_debug_print_indent): returns if debug_level exceeds
	  the threshold.

	* debug.c (ruby_debug_printf): printf to stderr.

	* iseq.c (make_compile_option, make_compile_option_value): added
	  debug_level option.

	* vm_core.h (rb_compile_option_t): added debug_level.

	* vm_core.h (struct iseq_compile_data): added node_level.

Mon Apr 14 12:52:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (Init_stack): use ruby_init_stack.  [ruby-dev:34350]

	* gc.c (rb_objspace_t): packed globals.  [ruby-dev:34348]

	* gc.c (finalizers): removed.  [ruby-dev:34349]

Mon Apr 14 11:30:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (ary_new): new integer overflow check condition.
	  suggested by TOYOFUKU Chikanobu <nobu_toyofuku at nifty.com> in
	  [ruby-dev:34156].

	* array.c (rb_ary_initialize): ditto.

Mon Apr 14 00:51:40 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_parse.rb: add tests to achieve over 95% test coverage
	  of parse.y.

Sun Apr 13 23:53:58 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enum.c (enum_cycle): Make Enumerable#cycle do a finite loop when
	  the number of cycles is specified.

	* array.c (rb_ary_cycle): Ditto for Array#cycle.

Sun Apr 13 18:52:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (lock_func): should not check interrupts in
	  blocking region.  [ruby-dev:34378]

Sat Apr 12 12:41:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_exec_node, ruby_run_node), ruby.c (process_options):
	  use iseq instead of NODE.

	* gc.c (source_filenames): removed.

	* include/ruby/intern.h, parse.y (yycompile, parser_mark, parser_free,
	  ripper_initialize): rb_source_filename() is no longer used.

	* compile.c, compile.h (ERROR_ARGS), parse.y (node_newnode, fixpos,
	  parser_warn, e_option_supplied, warn_unless_e_option, range_op,
	  cond0): nd_file is no longer used.

Sat Apr 12 12:17:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* prelude.rb (require_relative): move require_relative from
	  lib/require_relative.rb.  [ruby-core:16356]

	* lib/require_relative.rb: removed.

Sat Apr 12 05:55:57 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*, test/rubygems*:  Update to RubyGems 1.1.1 r1701.

Sat Apr 12 03:13:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): set external encoding.

	* file.c (rb_file_s_basename, rb_file_s_dirname, rb_file_s_extname):
	  copy encoding.

Fri Apr 11 17:35:06 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (count_i): modified to shut warning up.

Fri Apr 11 17:25:09 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enum.c (count_i, count_iter_i, enum_count, enum_find_index):
	  Reduce code.

Fri Apr 11 17:06:01 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (find_index_i): modified to shut warning up.

	* enum.c (find_index_iter_i): ditto.

Fri Apr 11 16:44:43 2008  Akinori MUSHA  <knu@iDaemons.org>

	* enum.c (enum_find_index): Add support for find_index(obj);
	  [ruby-dev:34313].

	* array.c (rb_ary_index): Define find_index as an alias to index.

Fri Apr 11 16:42:33 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/yaml/store.rb (YAML::load): modified to support empty
	  database.

Fri Apr 11 08:05:12 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_object): add volatile to avoid potential GC bug.  a
	  patch from Tomoyuki Chikanaga <chikanag at nippon-control-system.co.jp>
	  in [ruby-dev:34312].

Thu Apr 10 23:08:52 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/pstore.rb (PStore::dump, PStore::load): allow subclass
	  overriding.  [ruby-dev:34305]

	* lib/yaml/store.rb (YAML::Store::marshal_dump_supports_canonical_option?):
	  add a method to support faster PStore.

Thu Apr 10 20:36:45 2008  Akinori MUSHA  <knu@iDaemons.org>

	* misc/rdebug.el, misc/README: Remove rdebug.el as per request
	  from the maintainer and mention the ruby-debug project at
	  RubyForge in README; bug#19043.

Thu Apr 10 19:41:00 2008  Akinori MUSHA  <knu@iDaemons.org>

	* eval.c (rb_f_loop): Mention StopIteration in the document.

Thu Apr 10 19:23:55 2008  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_pop_m, rb_ary_shift_m): Update documents for
	  #pop() and #shift().

	* array.c (rb_ary_slice_bang): Update document.  Assigning
	  array[*args]= nil no longer removes elements.

Thu Apr 10 16:58:44 2008  Tanaka Akira  <akr@fsij.org>

	* marshal.c (w_object): TYPE_USERDEF assigns id for ivars first.
	  [ruby-dev:34159] by nagachika.

Thu Apr 10 15:03:47 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/generator.rb: removed obsolete library.  [ruby-core:16233]

	* test/test_generator.rb: removed as well.  [ruby-dev:34306]

	* lib/pstore.rb: replaced by Hongli Lai's faster version.

Thu Apr 10 10:27:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (native_sleep): sleep_cond is initialized at
	  creation.  [ruby-Patches-19361].

Wed Apr  9 14:43:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (lock_func): optimized and checks for interrupt_flag.
	  based on a patch from Sylvain Joyeux in [ruby-Patches-19361] and
	  [ruby-Patches-19362].

Wed Apr  9 12:12:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_thread.rb: new tests from Sylvain Joyeux in
	  [ruby-Patches-19361].

Tue Apr  8 21:36:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_mutex_sleep): ensures to re-acquire at waking up.
	  [ruby-Patches-19361]

Tue Apr  8 11:00:14 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/complex.rb: remove Math first before overwriting by CMath.

Tue Apr  8 10:34:10 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* load.c (rb_require_safe): should check fname path after $SAFE is
	  properly set.  [ruby-dev:34268]

	* re.c (rb_reg_quote): should always copy the quoting string.
	  [ruby-core:16235]

Tue Apr  8 10:30:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (prelude.c): depends on enc/prelude.rb.

	* enc/prelude.rb: fixed initial library names.

Tue Apr  8 03:39:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_provided): check expanded path for relative path
	  features, loading or loaded features are already expanded in 1.9.

	* variable.c (rb_autoload_load): no needs to check if provided before
	  rb_require_safe.  [ruby-dev:34266]

Mon Apr  7 22:41:21 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* numeric.c: cancelled recent changes (except to remove rdiv).

	* bignum.c: ditto.

	* bignum.c: added rb_big_idiv.

Mon Apr  7 15:51:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_init_db): moved to enc/encdb.c.

	* transcode.c (init_transcoder_table): moved to enc/trans/transdb.c.

	* enc/depend (enc/encdb.o enc/trans/transdb.o): depend on
	  corresponding headers.

	* common.mk (COMMONOBJS): moved transcode.o from OBJS

Mon Apr  7 12:26:32 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: add a known-bug.

Mon Apr  7 12:15:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (range_each_func): should not leave a variable
	  uninitialized, which could cause SEGV.

	* range.c (range_step): removed duplicated and unreachable code.

Mon Apr  7 02:12:27 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_intern): need not to check if tainted.
	  [ruby-dev:34219]

Sun Apr  6 09:45:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_tell): check if closed.  [ruby-core:16223]

Sat Apr  5 23:17:20 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb: new.

	* lib/complex.rb: depends lib/cmath.rb.

	* lib/rational.rb: added rdiv.

	* complex.c: removed some math functions.

Sat Apr  5 05:50:57 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/parse_rb.rb: Fix uninitialized variable warnings.

	* lib/rdoc/generator/html.rb: ditto.

	* lib/rdoc/options.rb: Fix shadowed variable warning.

	* lib/webrick/httprequest.rb: Fix redefined method warning.

Sat Apr  5 02:13:52 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_cmpint): moved from compar.c, to check bignum
	  zero.

Fri Apr  4 23:24:06 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_memsearch_qs): wrong boundary condition.

	* re.c (rb_memsearch_qs_utf8): ditto.

Fri Apr  4 14:11:36 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_memsearch_qs): wrong boundary condition.  a patch from
	  wanabe <s.wanabe AT gmail.com> in [ruby-dev:34248].

Fri Apr  4 05:57:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/pop.rb (Net::POP3::do_finish): clear @n_mails and
	  @n_bytes as well.  [ruby-core:16144]

Fri Apr  4 01:59:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_step): add step for each iteration if begin and
	  end are numeric.  [ruby-core:15990]

Fri Apr  4 00:42:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (Init_Bignum): rdiv method removed.  [ruby-dev:34242]

	* complex.c (nucomp_quo): ditto.

	* numeric.c (num_rdiv): ditto.

	* rational.c (nurat_div): ditto.

	* complex.c (nucomp_fdiv): fdiv implementation restored.

	* numeric.c (num_quo): RDoc updated.

Thu Apr  3 21:51:45 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (nucomp_int_check): function for DRY real check.

	* complex.c (nucomp_{add,sub,mul,div,expt}): use rb_num_coerce_bin().

Thu Apr  3 19:59:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defineclass): check if cbase is a class or a module.
	  [ruby-core:16118]

Thu Apr  3 14:42:11 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (INSNS): add insns_info.inc.

	* common.mk (INSNS): make incs separately for nmake.

Thu Apr  3 13:20:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (endb.h, transdb.h, prelude.c): depend on $(PREP) and
	  check if really changed.  [ruby-core:16102]

	* Makefile.in, common.mk, configure.in, {win32,bcc32}/Makefile.sub
	  (MINIOBJS, ARCHMINIOBJS): separated.

Thu Apr  3 09:00:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_sequence, iseq_insns_unification,
	  insn_data_to_s_detail): constified.

	* iseq.c (insn_operand_intern, ruby_iseq_disasm_insn): ditto.

	* template/{insns_info,opt_sc,optunifs}.inc.tmpl: ditto.

	* tool/instruction.rb (OptUnifsIncGenerator): ditto.

Thu Apr  3 08:46:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_include): add RDoc to describe that comparison
	  for numeric is done according magnitude of values.
	  [ruby-core:15907]

Wed Apr  2 22:29:35 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* rational.c (nurat_int_check): function for DRY integer check.

	* numeric.c (num_rdiv): should always return rational number.

	* rational.c (nurat_add, nurat_sub, nurat_mul, nurat_fdiv,
	  nurat_cmp): use rb_num_coerce_bin().

	* rational.c (nurat_division): does / and rdiv.

	* .gdbinit (rp): no longer use rb_p().

Wed Apr  2 06:52:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* .gdbinit (rp): supports rational and complex numbers.  it's
	  cheating since it uses rb_p().

Wed Apr  2 06:24:06 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/node.h: add new constants for rb_call()'s scope.

	* eval.c (iterate_method): use CALL_* scope constant to specify
	  proper scope value.

	* eval.c (rb_each, rb_apply, rb_funcall, rb_funcall2, rb_funcall3):
	  ditto.

Tue Apr  1 21:19:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* rational.c: need to include <float.h> just once.

Tue Apr  1 16:40:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (big2dbl): more precise conversion at edge cases.
	  [ruby-dev:34195]

Tue Apr  1 14:43:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: get rid of empty expansion.

	* configure.in: _setjmp is available but _longjmp is not on mingw.

Tue Apr  1 09:41:22 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc,win}32/Makefile (config.h): need to define RUBY_SETJMP, etc.

Tue Apr  1 07:31:58 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems* test/rubygems*: Import RubyGems 1.1.0.

Tue Apr  1 03:20:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_SETJMP, RUBY_LONGJMP, RUBY_JMP_BUF): prefers
	  _setjmp over setjmp and sigsetjmp.  [ruby-core:16023]
	  __builtin_setjmp cannot handle a variable.

	* configure.in (--with-setjmp-type): new option to override the
	  default rule in the above.

	* eval_intern.h (ruby_setjmp, ruby_longjmp), gc.c (rb_setjmp),
	  vm_core.h (rb_jmpbuf_t): use RUBY_SETJMP, RUBY_LONGJMP and
	  RUBY_JMP_BUF.

Tue Apr  1 01:55:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/resolv.rb (Resolv::Config.default_config_hash): requires
	  win32/resolv to use Win32::Resolv.  [ruby-dev:34138]

Tue Apr  1 01:40:58 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: adopted the ruby's style.

	* rational.c: ditto.

Tue Apr  1 00:17:35 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: revert.

Mon Mar 31 18:57:36 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc,win}32/Makefile.sub (config.h): define ssize_t.

	* io.c (copy_stream_body): some platform don't have O_NOCTTY.

Mon Mar 31 18:42:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check for ssize_t.  [ruby-dev:34184]

Mon Mar 31 14:45:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (num_quo): should convert its operand to Rational.

	* rational.c (string_to_r_strict): should raise TypeError.

	* bignum.c (Init_Bignum): should not redefine Bignum#div.
	  Numeric#div will do.  [ruby-dev:34066]

Mon Mar 31 04:05:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_getc): set coderange while getting characters.

Sun Mar 30 23:16:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (proc_dup): should copy is_lambda attribute as well.
	  [ruby-talk:296244]

Sun Mar 30 15:33:29 2008  Tanaka Akira  <akr@fsij.org>

	* io.c: IO.copy_stream implemented.  [ruby-dev:33843]

	* thread.c (rb_fd_select): new function.

	* configure.in (sys/sendfile.h): check the header file.
	  (sendfile): check the function.
	  (pread): check the function.

Sat Mar 29 14:18:41 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/*: full update Ruby/Tk to support Ruby(1.9|1.8) and Tc/Tk8.5.

	* ext/tk/lib/tkextlib/tile.rb: [incompatible] remove TileWidgets'
	  instate/state/identify method to avoid the conflict with standard
	  widget options. Those methods are renamed to ttk_instate/ttk_state/
	  ttk_identify (tile_instate/tile_state/tile_identify are available
	  too). Although I don't recommend, if you really need old methods,
	  please define "Tk::USE_OBSOLETE_TILE_STATE_METHOD = true" before
	  "require 'tkextlib/tile'".

	* ext/tk/lib/tkextlib/tile.rb: "Tk::Tile::__Import_Tile_Widgets__!"
	  is obsolete. It outputs warning. To control default widget set,
	  use "Tk.default_widget_set = :Ttk".

	* ext/tk/lib/tk.rb: __IGNORE_UNKNOWN_CONFIGURE_OPTION__ method and
	  __set_IGNORE_UNKNOWN_CONFIGURE_OPTION__!(mode) method are defined
	  as module methods of TkConfigMethod. It may help users to wrap old
	  Ruby/Tk scripts (use standard widgets) to force to use Ttk widgets.
	  Ttk widgets don't have some options of standard widgets which are
	  control the view of widgets. When set ignore-mode true, configure
	  method tries to ignore such unknown options with no exception.
	  Of course, it may raise other troubles on the GUI design.
	  So, those are a little danger methods.

	* ext/tk/lib/tk/itemconfig.rb: __IGNORE_UNKNOWN_CONFIGURE_OPTION__
	  method and __set_IGNORE_UNKNOWN_CONFIGURE_OPTION__!(mode) method
	  are defined as module methods of TkItemConfigMethod as the same
	  purpose as TkConfigMethod's ones.

	* ext/tk/sample/ttk_wrapper.rb: A new example. This is a tool for
	  wrapping old Ruby/Tk scripts (which use standard widgets) to use
	  Ttk (Tile) widgets as default.

	* ext/tk/sample/tkextlib/tile/demo.rb: use ttk_instate/ttk_state
	  method instead of instate/state method.

	* ext/tk/lib/tk/root, ext/tk/lib/tk/namespace.rb,
	  ext/tk/lib/tk/text.rb, ext/tk/lib/tkextlib/*: some 'instance_eval's
	  are replaced to "instance_exec(self)".

	* ext/tk/lib/tk/event.rb: bug fix on KEY_TBL and PROC_TBL (?x is not
	  a character code on Ruby1.9).

	* ext/tk/lib/tk/variable.rb: support new style of operation argument
	  on Tcl/Tk's 'trace' command for variables.

	* ext/tk/sample/demos-jp/widget, ext/tk/sample/demos-en/widget: bug fix

	* ext/tk/sample/demos-jp/textpeer.rb,
	  ext/tk/sample/demos-en/textpeer.rb: new widget demo.

	* ext/tk/tcltklib.c: decrease SEGV troubles (probably)

	* ext/tk/lib/tk.rb: remove Thread.critical access if Ruby1.9

	* ext/tk/lib/tk/multi-tk.rb: support Ruby1.9 (probably)

	* ext/tk/lib/tkextlib/tile.rb: add method to define Tcl/Tk command
	  to make Tcl/Tk theme sources (based on different version of Tile
	  extension) available.
	  (Tk::Tile::__define_LoadImages_proc_for_compatibility__)

	* ext/tk/lib/tk.rb, ext/tk/lib/tk/wm.rb: support dockable frames
	  (Tcl/Tk8.5 feature). 'wm' command can treat many kinds of widgets
	  as toplevel widgets.

	* ext/tk/lib/tkextlib/tile/style.rb: ditto.
	  (Tk::Tile::Style.__define_wrapper_proc_for_compatibility__)

	* ext/tk/lib/tk/font.rb: add actual_hash and metrics_hash to get
	  properties as a hash. metrics_hash method returns a boolean value
	  for 'fixed' option. But metrics method returns numeric value
	  (0 or 1) for 'fixed' option, because of backward compatibility.

	* ext/tk/lib/tk/timer.rb: sometimes fail to set callback procedure.

	* ext/tk/lib/tk.rb: add Tk.sleep and Tk.wakeup method. Tk.sleep
	  doesn't block the eventloop. It will be better to use the method
	  in event callbacks.

	* ext/tk/sample/tksleep_sample.rb: sample script about Tk.sleep.

Thu Mar 27 20:44:22 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (f_lcm): removed.

	* rational.c (rb_lcm, rb_gcdlcm): added.

	* lib/complex.rb (gcd, lcm, gcdlcm): removed.

	* lib/rational.rb (gcd, lcm, gcdlcm): ditto.

Wed Mar 26 18:11:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_mod_constants): rdoc updated.  a patch from
	  Florian Gilcher <flo AT andersground.net> in [ruby-core:16009].

Wed Mar 26 00:55:28 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rand.rb: add tests to achieve over 95% test coverage
	  of random.c.

Wed Mar 26 00:28:55 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_rational.rb: add tests to achieve over 90% test
	  coverage of rational.c.

	* test/ruby/test_complex.rb: ditto for complex.c.

Tue Mar 25 19:34:05 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bootstraptest/test_knownbug.rb: add tests.  [ruby-dev:34128]

Tue Mar 25 19:09:04 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (ary_new): fix size check.  [ruby-dev:34123]

	* array.c (rb_ary_take, rb_ary_drop): check negative size and use
	  NUM2LONG instead of FIX2LONG.  [ruby-dev:34123]

	* enum.c (enum_take, enum_drop): check negative size.

	* test/ruby/test_array.rb: add tests for above.

Tue Mar 25 16:32:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): checks if the word is empty.

	* ruby.c (process_options): typo fixed.  [ruby-dev:34122]

Tue Mar 25 15:26:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (defined_expr): false short-circuit destination label may
	  be needed.  [ruby-talk:295296]

	* compile.c (iseq_compile_each): put nil if false short-circuit is
	  created.

	* compile.c (compile_massign_opt): no need to use alloca.

Mon Mar 24 19:23:52 2008  Akinori MUSHA  <knu@iDaemons.org>

	* parse.y (debug_lines): Always prepare a new array for each
	  file's SCRIPT_LINES__ storage, instead of appending source lines
	  every time a file is re-loaded; submitted by Rocky Bernstein in
	  #18517.

Mon Mar 24 10:25:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: sitearch should use target_cpu.  [ruby-core:15986]

Sun Mar 23 02:51:57 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_value): use NUM2RLIM.

Sun Mar 23 02:28:01 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: fixed. [ruby-dev:34109]

	* rational.c: ditto.

Fri Mar 21 21:32:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_f_gets, rb_f_readline, rb_f_readlines): delegates to ARGF
	  as well as puts and putc.  [ruby-dev:34100]

Fri Mar 21 21:26:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/resolv.rb (Resolv::Hosts): should not use win32/resolv on cygwin.
	  [ruby-dev:29945], [ruby-dev:34095]

	* lib/win32/registry.rb (Win32::Registry.expand_environ): try upcased
	  name too for cygwin.  [ruby-dev:29945]

	* lib/win32/resolv.rb (Win32::Resolv.get_hosts_path): use expand_path.

Fri Mar 21 21:10:00 2008  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb: Say that I am the current maintainer.

	* lib/set.rb: Ditto.

	* lib/shellwords.rb: Ditto.

	* ext/syslog/syslog.txt: Ditto.

Fri Mar 21 09:24:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (open_for_install): write block result and rewrite only
	  if changed from existing file.

Fri Mar 21 08:29:33 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (nurat_to_f): rearrangement.

Fri Mar 21 06:44:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* rational.c (nurat_to_f): C99.

Fri Mar 21 01:40:27 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* complex.c (nucomp_sub, nucomp_expt): call corresponding functions.

Fri Mar 21 01:21:43 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* missing/tgamma.c: include config.h before math.h.  [ruby-dev:34075]

Thu Mar 20 21:46:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_getline): use receiver.

Thu Mar 20 21:20:19 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: some improvements (include Shin-ichiro HARA's
	  effort).

	* complex.c: some improvements.

	* test/ruby/test_rational2.rb: new.

Thu Mar 20 00:21:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_initialize_copy): get rid of segfault.

	* io.c (argf_tell, argf_seek_m, argf_set_pos, argf_rewind,
	  argf_fileno, argf_to_io, argf_eofl, argf_getc, argf_getbyte,
	  argf_readchar, argf_readbyte, argf_each_line): use receiver.

Wed Mar 19 23:52:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_putc, rb_io_puts): output directly if the receiver is
	  rb_stdout to get rid of infinite recursion.  [ruby-dev:34059]

Wed Mar 19 22:27:41 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c: added rb_gcd.

	* complex.c: use rb_gcd.

Wed Mar 19 18:37:00 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: revert.

	* rational.c: revert.

Wed Mar 19 17:31:20 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_intern.h (TH_EXEC_TAG): need not to FLUSH_REGISTER_WINDOWS.
	  [ruby-core:15871], [ruby-dev:34088]

Wed Mar 19 14:53:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c (nucomp_to_s, nucomp_inspect): get rid of making
	  unnecessary intermediate objects.

	* complex.c (make_patterns, string_to_c): do not treat successive
	  underscores as a part of numeric like as literals.  [ruby-dev:34085]

	* rational.c (make_patterns, string_to_r): ditto.

Wed Mar 19 14:36:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_cstr_to_inum): treat successive underscores as
	  nondigit.  [ruby-dev:34089]

Wed Mar 19 14:08:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_check_encoding): should not load autoloaded encoding
	  directly, instead use rb_enc_find_index() which deal with alias and
	  replica.  [ruby-core:15957]

Wed Mar 19 11:49:47 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* regint.h (include): include ruby.h instead of defines.h and config.h.

Wed Mar 19 10:17:12 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regint.h (CHECK_INTERRUPT_IN_MATCH_AT): add interrupt check
	  during match.  [ruby-talk:295002]

Tue Mar 18 16:24:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (literal_concat_gen): bail out at different encoding.

Tue Mar 18 04:00:27 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_memsearch_ss): simple shift search.

	* re.c (rb_memsearch_qs): quick search.

	* re.c (rb_memsearch_qs_utf8): quick search for UTF-8 string.

	* re.c (rb_memsearch_qs_utf8_hash): hash functions for above.

	* re.c (rb_memsearch): use above functions.

	* string.c (rb_str_index): give enc to rb_memsearch.

	* include/ruby/intern.h (rb_memsearch): move to encoding.h.

	* include/ruby/encoding.h (rb_memsearch): move from intern.h.

	* common.mk (PREP): add dependency.

Mon Mar 17 22:23:54 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* array.c (rb_ary_take, rb_ary_take_while, rb_ary_drop,
	  rb_ary_drop_while): new methods. [ruby-dev:34067]

	* test/ruby/test_array.rb: add tests for above.

Mon Mar 17 17:11:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode): should use `run-mode-hooks' instead
	  of calling `run-hooks' directly to run the mode hook.  patch from
	  Chiyuan Zhang <pluskid AT gmail.com> in [ruby-core:15915]

Mon Mar 17 16:41:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: unset GREP_OPTIONS.  [ruby-core:15918]

Sun Mar 16 18:07:07 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/utf_16_32.c: bug fix (some invalid UTF-8 sequences
	  were legal)

	* test/ruby/test_transcode.rb: test for above bug

Sun Mar 16 17:28:07 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (LIBRUBY_SO): add dependency to $(BUILTIN_ENCOBJS).

Sun Mar 16 08:51:41 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* include/ruby/intern.h: added some declarations.

	* include/ruby/ruby.h: ditto.

	* common.mk: added some entries.

	* configure.in: added a check for signbit.

	* lib/complex.rb: nearly all of core definitions have been removed.

	* lib/rational.rb: ditto.

	* lib/mathn.rb: some trivial adjustments.

	* complex.c: new.

	* rational.c: ditto.

	* numeric.c (flo_{quo,rdiv}, fix_fdiv): added.

	* numeric.c ({num,int}_{numerator,denominator}): ditto.

	* bignum.c (rb_big_fdiv): ditto.

	* numeric.c (fix_{quo,pow}): now may yield rational number.

	* bignum.c (rb_big_{quo,pow}): ditto.

	* numeric.c (rb_{int,flo}_induced_from): now can accept rational.

	* gc.c (gc_mark_children, obj_free): now detects complex and rational.

	* inits.c (rb_call_inits): now calls Init_{Complex,Rational}.

	* test/ruby/test_complex.rb: new.

	* test/ruby/test_rational.rb: ditto.

Sat Mar 15 17:48:48 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_associate_index): pass unnecessary enc_capable().

	* string.c (rb_str_cmp): reduce invocation of rb_enc_compatible().

Fri Mar 14 17:04:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (inttypes.h): includes always if available.

	* string.c, ext/digest/defs.h: moved inttypes.h to ruby.h.

Fri Mar 14 16:59:23 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_LIB_PREFIX): fix for prefix.

Fri Mar 14 16:35:11 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::Cookie::initialize): performance patch from
	  Makoto Kuwata <kwa@kuwata-lab.com> in [ruby-dev:34048].

Fri Mar 14 15:49:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_LIB_PREFIX): use libdir.

Fri Mar 14 14:24:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/digest/defs.h: inttypes.h is still needed.

Fri Mar 14 11:34:12 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc,win}32/Makefile.sub: follow below changes.

Fri Mar 14 11:24:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-encoding-map, ruby-use-encoding-map): added
	  to customize.

Fri Mar 14 10:37:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in (int8_t, uint8_t,  int16_t,  uint16_t int32_t,
	  uint32_t int64_t, uint64_t, int128_t, uint128_t,
	  intptr_t, uintptr_t): check if defined.

	* win32/Makefile.sub: follow configure.in.

	* ext/digest/defs.h: remove checks for uint8_t, uint32_t and uint64_t.

Fri Mar 14 10:12:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_VARTYPE): should not indent preprocessor
	  directives.

Fri Mar 14 10:03:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (UNALIGNED_WORD_ACCESS): IA64 cannot access unaligned word.

Thu Mar 13 21:00:50 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_slice_bang): should not use rb_ary_subseq()
	  which shares internal pointer.  splice modifies the receiver
	  right after subseq.  [ruby-dev:34005]

	* bootstraptest/test_struct.rb: some test moved from test to shut
	  warning up.

Thu Mar 13 19:42:43 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc,win}32/Makefile.sub (config.h): define uint32_t.

Thu Mar 13 14:14:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* trunk/configure.in (AC_CHECK_HEADERS): stdint.h is not needed to
	  check.

	* trunk/configure.in (rb_cv_type_uint32_t): unquoted.  [ruby-dev:34030]

	* trunk/string.c (hash): use inttypes.h instead of stdint.h.

Thu Mar 13 10:42:46 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_divmod): should return integer division.  [ruby-dev:34006]

	* enum.c (zip_ary): wrong boundary condition.

	* test/ruby/test_numeric.rb (TestNumeric::test_num2long): bit-and
	  should not raise RangeError.

Thu Mar 13 03:12:48 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/cmd/help.rb: should be updated for new ri structure.
	  [ruby-core:15825]

	* lib/rdoc/ri/driver.rb (RDoc::initialize): allow options to be optional.

	* lib/rdoc/ri/driver.rb (RDoc::class_cache): map_dirs may be
	  empty.

	* lib/rdoc/ri/driver.rb (RDoc::get_info_for): revive get_info_for
	  method.  maybe broken.

	* lib/rdoc/ri/util.rb (RDoc::initialize): should not use RiError
	  no more.

Thu Mar 13 01:45:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (stdint.h): check if presence.

	* configure.in (uint32_t): check if defined.

	* string.c (hash): fix for portability.  [ruby-dev:34020]

Wed Mar 12 17:33:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): fix for a mere underscore.

Wed Mar 12 14:47:07 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_intern.h (rb_thread_raised_set): use generic flags.

	* eval.c (rb_longjmp): clear all raised flags.

	* eval.c (stack_check): leave clearing flag to rb_longjmp.

	* gc.c (rb_memerror): use thread raised flag instead of static flag.

Tue Mar 11 23:38:39 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_combination): argument check before creating
	  Enumerator.

	* array.c (rb_ary_permutation): ditto.

	* enum.c (enum_zip): optimize if all arguments are arrays.

Tue Mar 11 19:48:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (fix_coerce): try conversion before type check.
	  [ruby-core:15838]

Tue Mar 11 12:39:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (clean-local): WINMAINOBJ is Windows specific.

Tue Mar 11 10:19:10 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (hash): replaced by MurmurHash described in
	  <http://murmurhash.googlepages.com/>.

Tue Mar 11 09:52:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_comparable): empty strings in any encoding are
	  compatible each other.

Tue Mar 11 00:46:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (usage): remove some unimportant lines to fit -h message
	  in a page.  [ruby-dev:34018]

Mon Mar 10 17:11:00 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_local_variables): local_variables should return an
	  array of symbols.  [ruby-dev:34008]

	* vm.c (collect_local_variables_in_env): ditto.

Mon Mar 10 15:53:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* version.c (MKSTR): make US-ASCII.  [ruby-dev:34010]

Mon Mar 10 02:08:21 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_index): if t == s + pos, the character beginning
	  from s + pos is valid.

Sun Mar  9 13:51:21 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/generator.rb: Restore missing line to #params.  Patch by
	  Lincoln Stoll <lstoll at lstoll.net>

Sun Mar  9 09:52:00 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/code_objects.rb: Remove debugging Kernel#p.  Patch by
	  Lincoln Stoll <lstoll at lstoll.net>
	* lib/rdoc/generator/html.rb: Fully qualify AllReferences.  Patch by
	  Lincoln Stoll <lstoll at lstoll.net>
	* lib/rdoc/ri/writer.rb: Fix 1.8 backwards compatibility.

Sat Mar  8 18:50:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (isdirsep): backslash is valid path separator on cygwin too.

Sat Mar  8 06:53:48 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (search_nonascii): Use VALUE instead of unsigned long
	  because VALUE can be the fastest unsigned integer type.
	  On LLP64 unsigned long isn't the fastest.
	* string.c (str_strlen): ditto.
	* string.c (str_utf8_nth): ditto.
	* string.c (count_utf8_lead_bytes_with_ulong): ditto.

	* string.c (count_utf8_lead_bytes_with_word): renamed.

Fri Mar  7 21:27:43 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c: fix indent.

Fri Mar  7 21:12:19 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (power_cache_init, power_cache_get_power0, Init_Bignum):
	  delayed initializing power cache per base.  [ruby-dev:34003]

Fri Mar  7 20:30:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c (cont_restore_0): fixed typo.  [ruby-core:15821]

Fri Mar  7 19:56:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: rdoc added.  [ruby-Patches-9762]

Thu Mar  6 17:26:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): space flag is in effect for Inf/NaN too.
	  [ruby-dev:34002]

Thu Mar  6 15:44:20 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* sprintf.c (rb_str_format): casting double to long is undefined
	  if the integer part of double is out of the range of long.

Thu Mar  6 15:11:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): ignore 0 flag for NaN and Inf.
	  [ruby-dev:33994]

Thu Mar  6 15:05:25 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32}/Makefile.sub (RUNRUBY): use $(PROGRAM) instead of
	  ruby$(EXEEXT).
	  suggested by KIMURA Koichi <kimura.koichi at canon.co.jp>.
	  [ruby-dev:34000]

Thu Mar  6 14:46:08 2008  Tanaka Akira  <akr@fsij.org>

	* missing/lgamma_r.c (loggamma): return 0 for 1 and 2.

	* test/ruby/test_math.rb: accept errors by functions under missing/.

Thu Mar  6 14:29:44 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* transcode.c (rb_str_transcode_bang): set coderange.

	* transcode.c (rb_str_transcode): use rb_str_transcode_bang.

Thu Mar  6 14:00:10 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/missing.h (cbrt): add declaration.

Thu Mar  6 11:14:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-add-log-current-method): use ruby style
	  method name format.

Thu Mar  6 11:12:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): no need of loop.

Thu Mar  6 08:30:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_mod_freeze): call rb_class_name() directly.
	  [ruby-core:15802]

Thu Mar  6 04:32:06 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (count_utf8_lead_bytes_with_ulong): fix shift size.
	  [ruby-dev:33993]

	* string.c (str_utf8_nth) fix wrong counting.

Thu Mar  6 00:34:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): size_t returned from strlen() can be
	  unsigned.

Thu Mar  6 00:31:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* struct.c (make_struct): preserve encoding of struct name.

Wed Mar  5 22:49:20 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (is_utf8_lead_byte, count_utf8_lead_bytes_with_ulong):
	  defined for UTF-8 optimization.

	* string.c (str_strlen): use is_utf8_lead_byte and
	  count_utf8_lead_bytes_with_ulong.

	* string.c (str_utf8_nth) ditto.

Wed Mar  5 17:53:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_flock): returns false on EAGAIN if non-blocking.
	  [ruby-core:15795]

Wed Mar  5 17:43:43 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c (transcode_loop): Adjusted detection of invalid
	  (ill-formed) UTF-8 sequences. Fixing potential security issue, see
	  http://www.unicode.org/versions/Unicode5.1.0/#Notable_Changes.

	* test/ruby/test_transcode.rb: Added two tests for above fix.

Wed Mar  5 14:00:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_to_s): avoid rb_scan_args() when no argument
	  given.
	* bignum.c (rb_big_to_s): ditto.
	* enum.c (enum_first): ditto.
	* eval_jump.c (rb_f_catch): ditto.
	* io.c (rb_obj_display): ditto.
	* class.c (rb_obj_singleton_methods): ditto.
	* object.c (rb_class_initialize): ditto.
	* random.c (rb_f_srand): ditto.
	* range.c (range_step): ditto.
	* re.c (rb_reg_s_last_match): ditto.
	* string.c (rb_str_to_i): ditto.
	* string.c (rb_str_each_line): ditto.
	* string.c (rb_str_chomp_bang): ditto.
	* string.c (rb_str_sum): ditto.

	* string.c (str_modifiable): declare inline.
	* string.c (str_independent): ditto.

Wed Mar  5 11:50:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/debug.rb: require 'continuation' to implement "restart"
	  command.  [ruby-dev:33992]

	* lib/debug.rb (Context::debug_command): remove local variable
	  shadowing to shut up warnings.  [ruby-dev:33992]

	* lib/debug.rb (Context::display_list): ditto.

	* lib/debug.rb (Context::resume): ditto.

	* lib/debug.rb (Context::get_thread): no longer use #index for Hash.

Tue Mar  4 21:35:59 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb.rb (IRB::Irb::eval_input): SyntaxError should not be
	  considered as IRB bug.  [ruby-dev:33991]

	* lib/irb/workspace.rb (IRB::WorkSpace::filter_backtrace): should
	  filter 'irb.rb' as well for context mode 2 and 3.

Tue Mar  4 19:10:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_aset): should not copy key string when
	  compare_by_identity is set.  [ruby-dev:33604]

	* hash.c (hash_equal): two hash tables are different when internal
	  comparison table differ.  [ruby-dev:33989]

Tue Mar  4 16:29:06 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): disallow non digits '0o' expression.

Tue Mar  4 14:35:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (open_key_args): use rb_io_open_with_args instead of rb_f_open.
	  [ruby-core:15763]

Tue Mar  4 13:41:46 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (add_heap): fix previous change.  [ruby-dev:33988]

Tue Mar  4 10:21:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (add_heap): use binary search to find the place to insert the
	  new heap slot.  [ruby-dev:33983]

Tue Mar  4 05:30:31 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (open_key_args): use rb_io_open instead of rb_f_open.
	  [ruby-core:15746]

Mon Mar  3 23:28:37 2008  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservlet/filehandler.rb: should normalize path
	  separators in path_info to prevent directory traversal
	  attacks on DOSISH platforms.
	  reported by Digital Security Research Group [DSECRG-08-026].

	* lib/webrick/httpservlet/filehandler.rb: pathnames which have
	  not to be published should be checked case-insensitively.

Mon Mar  3 17:25:45 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (add_heap): sort heaps array in ascending order to use
	  binary search.

	* gc.c (is_pointer_to_heap): use binary search to identify object
	  in heaps.  works better when number of heap segments grow big.

Mon Mar  3 17:15:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_regsub): remove too strict encoding check.
	  [ruby-dev:33966]

Mon Mar  3 16:14:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_any_hash): shrinks all results in Fixnum range.
	  [ruby-core:15713]

Sun Mar  2 23:03:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_ungetc): reduce redundant call.

Sun Mar  2 10:13:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file): parse shebang in us-ascii.  a patch from
	  sheepman <sheepman AT sheepman.sakura.ne.jp> in [ruby-dev:33955]

Sun Mar  2 00:08:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): check for successive underscores.
	  [ruby-dev:33952]

Sat Mar  1 17:59:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (struct argf): packed ARGF stuffs.

	* ruby.c (proc_options): use ruby_set_inplace_mode().

Sat Mar  1 17:51:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/collector/dir.rb (recursive_collect): do not always
	  include all test_*.rb.

Sat Mar  1 14:14:17 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* development snapshot 1.9.0-1 released.

Sat Mar  1 13:46:26 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* tool/make-snapshot: make prereq uses MINIRUBY.

	* tool/make-snapshot: allow packaging like 1.9.0-1 by second
	  command-line argument.

Sat Mar  1 13:11:03 2008  Tanaka Akira  <akr@fsij.org>

	* test/ruby/allpairs.rb: new file for all pairs method.

	* test/ruby/test_m17n_comb.rb: use allpairs.rb to reduce test cases.

	* test/ruby/test_sprintf_comb.rb: ditto.

Sat Mar  1 12:34:21 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_inspect): use rb_str_inspect() instead of
	  rb_str_dump().  [ruby-dev:33946]

Sat Mar  1 12:15:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_method.c (rb_get_method_body): ent->method may be freed by
	  GC.  [ruby-dev:31819]

	* thread.c (remove_event_hook): should not access freed memory.
	  [ruby-dev:31820]

Sat Mar  1 10:31:19 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (read_all, rb_io_getline_fast): encoding is io_input_encoding.

Sat Mar  1 10:09:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (tr_setup_table, rb_str_split_m, rb_str_chomp_bang):
	  simplified with rb_enc_ascget().  [ruby-dev:33944]

Sat Mar  1 10:01:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_coderange_scan_restartable): should not return
	  offset in the middle of a character.

	* string.c (rb_str_coderange_scan_restartable): should not return
	  invalid cr value.

Sat Mar  1 09:36:08 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): "%#.0o" should keep prefix where
	  "%#.0x" should not.

Sat Mar  1 02:35:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (big2str_find_n1): check integer overflow.

Sat Mar  1 00:29:07 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_dummy_p): bootstrap encodings can not be dummy.

	* encoding.c (rb_enc_ascget): no needs to call rb_enc_precise_mbclen()
	  twice.

Fri Feb 29 23:14:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_m17n_comb.rb (TestM17NComb::test_str_chomp): test
	  updated.

Fri Feb 29 20:58:09 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_iterator.rb (TestIterator::test_enumerator):
	  adjust test for zip behavior reversion.

Fri Feb 29 20:25:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_chomp_bang): now works on UTF-16.

	* string.c (tr_setup_table): negation should work on non ASCII
	  compatible strings as well.

	* string.c (rb_str_split_m): awk split should work on non ASCII
	  compatible strings as well.

Fri Feb 29 18:08:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_strftime): format should be ascii compatible.

	* parse.y (rb_intern3): non ASCII compatible symbols.

	* re.c (rb_reg_regsub): add encoding check.

	* string.c (rb_str_chomp_bang): ditto.

	* test/ruby/test_utf16.rb (TestUTF16::test_chomp): raises exception.

Fri Feb 29 15:16:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_rpartition): calculation was done in byte indexing.

	* test/ruby/test_m17n_comb.rb (TestM17NComb::test_str_start_with):
	  allow start_with? matching on broken strings.

Fri Feb 29 15:12:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (opt_block_param): command can start just after block param
	  definition.  [ruby-list:44479]

Fri Feb 29 03:22:19 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_time.rb (test_readers): fix typo.
	  (test_strftime): "UTC" is also ok for time.gmtime.strftime("%Z").

Fri Feb 29 02:50:07 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_new): remove encoding assumption of empty string.

	* hash.c ( rb_f_getenv, env_fetch, env_inspect): result of ENV should
	  be always ASCII-8BIT.

	* object.c (nil_to_s): nil.to_s should be US-ASCII.

Fri Feb 29 02:24:22 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: forgot to update RELEASE_DATE

	* ext/tk/lib/tk.rb, ext/tk/lib/tk/text.rb,
	  ext/tk/lib/tkextlib/iwidgets/scrolledtext.rb: remove adhoc check
	  of Ruby's features (use existence of some classes instead of
	  comparing with RUBY_VERSION)

	* ext/tk/lib/tk/root.rb, ext/tk/lib/tk/autoload.rb: make TkRoot
	  (Tk::Root) unswitchable

	* ext/tk/lib/multi-tk.rb: partial bug fix (still not work!!)

Thu Feb 28 23:37:12 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI::Meta#meta_setup_encoding): use ASCII-8BIT
	  for charset unspecified non-text data.

Thu Feb 28 22:19:14 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_capable): IMMEDIATE_P doesn't include Qnil and Qfalse.
	  use SPECIAL_CONST_P.

Thu Feb 28 19:45:52 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_find): check type of argument and convert to String
	  if it is StringValue. [ruby-cvs:22866]

Thu Feb 28 18:07:52 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI::Meta#meta_setup_encoding): setup encoding
	  by charset.
	  (OpenURI::Meta#meta_add_field): call meta_setup_encoding when
	  content-type.

Thu Feb 28 15:29:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_getline_fast): scan coderange.

Thu Feb 28 14:36:46 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_str_copy): removed.

Thu Feb 28 13:51:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (stack_check): made flag per threads.

	* thread.c (rb_thread_set_raised, rb_thread_reset_raised): prefixed.

Thu Feb 28 11:43:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_flock): immediately returns on EAGAIN if
	  non-blocking.  [ruby-core:15672]

Thu Feb 28 11:23:50 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_getline_1): get rid of segfault.  [ruby-dev:33938]

Thu Feb 28 11:19:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_reverse_bang): removed unused variables.

	* include/ruby/encoding.h (rb_str_coderange_scan_restartable): added
	  prototype.

	* string.c (rb_str_coderange_scan_restartable, rb_str_times): removed
	  unused variables.

	* string.c (rb_str_reverse_bang): ditto

	* string.c (rb_enc_str_copy): unused now.  may be used in future?

Thu Feb 28 03:03:32 2008  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb, ext/tk/lib/*: make default widget set
	  switchable between Tk (standard Tcl/Tk widget set) and
	  Ttk (Tile). Initial default widget set is Tk. Now, toplevel
	  widget classes are removed and defined as aliases.
	  For example, "TkButton" is an alias of the "Tk::Button" class.
	  Those aliases are replaced when switching default widget set.
	  "Tk.default_widget_set=" is the method for switching default
	  widget set. "Tk.default_widget_set = :Ttk" defines Ttk (Tile)
	  widget set as default. It means that "TkButton" denotes
	  "Tk::Tile::Button" class. And then, "TkButton.new" creates
	  a Tk::Tile::Button widget. Of course, you can back to use
	  standard Tk widgets as the default widget set by calling
	  "Tk.default_widget_set = :Tk", whenever you want. Based on
	  the feature, you can use Ttk widget styling engine on your
	  old Ruby/Tk application without modifying its source, if you
	  don't use widget options unsupported on Ttk widgets (At first,
	  call "Tk.default_widget_set = :Ttk", and next load and run
	  your application).
	  This is one step for supporting Tcl/Tk8.5 features.

Wed Feb 27 22:55:42 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_coderange_scan_restartable): coderange scanning
	  for partial read.

	* io.c (read_all): set coderange when not convert encoding.

Wed Feb 27 03:55:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb, enc/make_encmake.rb: load current mkmf.rb even if
	  cross-compiling.

	* ext/extmk.rb, enc/make_encmake.rb, lib/mkmf.rb: need to be 1.8
	  compatible for cross-compiling.

Tue Feb 26 16:53:13 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-calculate-indent): should distinguish
	  comment and # in strings.  [ruby-dev:33874]

Tue Feb 26 16:41:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (combi_len, rb_ary_product): check for overflow.
	  [ruby-Bugs-18355]

Tue Feb 26 16:38:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (recursive_cmp): compare minimal length parts.

Tue Feb 26 16:06:00 2008  Technorama Ltd.  <oss-ruby@technorama.net>

	* ext/openssl/ossl_{ec,dh,dsa,rsa}.c: Remove useless warnings.

	* ext/openssl/ossl_asn1.c: Simplify code.

	* ext/openssl/ossl_ssl_session.c Fix compiler warnings.
	  Undefine #id if SSL_SESSION_get_id is not supported.

Tue Feb 26 15:50:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (value_expr_gen): removed inappropriate warning.
	  [ruby-core:15660]

Tue Feb 26 15:43:42 2008  Tanaka Akira  <akr@fsij.org>

	* parse.y (tokadd_escape): refactored.  [ruby-core:15657]

Tue Feb 26 15:30:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_eql, rb_ary_cmp): get rid of stack overflow with
	  self-recursive constructs.  [ruby-Bugs-18356]

Tue Feb 26 01:16:01 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (ROBJECT_NUMIV): renamed from ROBJECT_LEN.
	  (ROBJECT_IVPTR): renamed from ROBJECT_PTR.

	* variable.c: follow the above renaming.

	* object.c: ditto.

	* gc.c: ditto.

	* marshal.c: ditto.

Mon Feb 25 17:30:29 2008  Technorama Ltd.  <oss-ruby@technorama.net>

	* ext/openssl/digest.c ext/openssl/lib/openssl/digest.rb:
	  Commit patch #9280 from Akinori MUSHA.
	  Simplify the OpenSSL::Digest class and make use of the
	  existing Digest framework.
	  Enhance performance.

Mon Feb 25 15:33:29 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (big2str_karatsuba): initialize cache if not initialized.

	* bignum.c (Init_Bignum): delayed initializing cache.
	  [ruby-dev:33930]

Mon Feb 25 13:40:03 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (Init_process): share bignum objects for RLIM_INFINITY,
	  RLIM_SAVED_MAX and RLIM_SAVED_CUR if they are equal.

Mon Feb 25 10:41:41 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* encoding.c (Encoding#dummy): minor grammatical fixes
	  in rdoc documentation.

Mon Feb 25 00:01:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (clean-local): should be double-colon.

Sun Feb 24 23:39:59 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk, {bcc,win}32/Makefile.sub (clean-local): remove
	  intermediate files.

	* cygwin/GNUmakefile.in (clean-local): remove def file.

Sun Feb 24 06:49:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c (ruby_set_debug_option): separated ruby_each_words().

	* util.c (ruby_each_words): extracted from ruby_set_debug_option().

	* ruby.c (enable_option, disable_option): allow all for all known
	  features.

	* ruby.c (proc_options): generalized enable/disable options.

	* ruby.c (ruby_init_gems): take enabled flag.  [ruby-core:14840]

	* ruby.c (process_options): added --disable-rubyopt flag.

	* include/ruby/util.h (ruby_each_words): prototype.

Sun Feb 24 05:25:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): check if argument for -E exists.

Sun Feb 24 05:09:43 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el (ruby-style-label-indent): fix for labels inside
	  blocks in switch.

Sun Feb 24 03:52:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (valid_filename): use O_EXCL to get rid of clobbering
	  existing files in race conditions.

Sat Feb 23 21:36:13 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/win32ole/win32ole.c (ole_init_cp): should return value.

Sat Feb 23 20:16:05 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_sublen): removed.

	* string.c (rb_str_reverse, rb_str_reverse_bang): use
	  single_byte_optimizable.

Sat Feb 23 19:25:18 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_cr_str_copy_for_substr): renamed from
	  rb_enc_cr_str_copy.

	* string.c: use rb_enc_cr_str_copy_for_substr and keep coderange.

Sat Feb 23 18:50:17 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_encoding2cp): remove US-ASCII
	  mapping.

Sat Feb 23 01:09:47 2008  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_type): new function.
	  (rlimit_resource_value): new function.
	  (proc_getrlimit): use rlimit_resource_type to accept
	  symbol and string as resource type.
	  (proc_setrlimit): use rlimit_resource_type and rlimit_resource_value
	  to accept symbol and string as resource type and values.

Fri Feb 22 21:12:42 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_cr_str_copy): check string's coderange is 7bit or
	  valid.

Fri Feb 22 19:50:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (BIGZEROP): fix for longer Bignum zeros.  [ruby-Bugs-17454]

Fri Feb 22 15:47:36 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_mbclen): return minlen instead of 1 when
	  a character is not found properly.

	* string.c (rb_enc_strlen): round up string length with fixed
	  multibyte encoding such as UTF-32.
	  (rb_enc_strlen_cr): ditto.
	  (rb_str_substr): fix substring with fixed multibyte encoding.
	  (rb_str_justify): check number of characters.

Fri Feb 22 12:11:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): string of ascii incompatible encoding
	  should be escaped and returned as US-ASCII encoding.

Fri Feb 22 11:16:55 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_substr): copy encoding although empty string.

Fri Feb 22 04:48:22 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_times): empty string's coderange is CODERANGE_7BIT.

	* string.c (rb_str_substr): ditto.

	* encoding.c (rb_enc_compatible): empty string is compatible with not
	  only nonasciicompatible strings. [ruby-dev:33895]

Thu Feb 21 17:15:15 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c: Added basic support for passing options to String#encode
	  via a hash. Currently only one option, with one value, is supported:
	  invalid: :ignore (dropping invalid byte sequences instead of
	  producing an error). Option naming is not yet stable!

	* test/ruby/test_transcode.rb: Added a single test for invalid: :ignore
	  option. Not more tests because most data does not yet distinguish
	  between INVALID and UNKNOWN.

Thu Feb 21 16:35:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_unshift_m): expands enough for argc.  [ruby-dev:33880]

Thu Feb 21 14:49:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_set_encoding): uses current_file after check if next
	  input is available.

Thu Feb 21 14:13:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_putc): invoke stdout method so that redefining putc
	  may take effect.   [ruby-talk:291844]

	* io.c (rb_f_puts): ditto.

Thu Feb 21 11:10:49 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c: replace rb_enc_copy by rb_enc_cr_str_copy or
	  rb_enc_cr_str_exact_copy.

Thu Feb 21 10:35:04 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_asciicompat): dummy encoding is not
	  ascii compatible. [ruby-dev:33878]

Thu Feb 21 00:01:34 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RPATHFLAG): -R option of HP-UX ld is not for runtime
	  load path.  [ruby-list:44600]

Wed Feb 20 23:55:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_map_errno): exported.

Wed Feb 20 23:28:43 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/readline/extconf.rb (rl_event_hook): workaround for native
	  windows.

Wed Feb 20 19:42:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_associate_index): doesn't clear coderange
	  when new encoding equals to old one.

Wed Feb 20 19:15:38 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_str_copy): added for wrapper for rb_enc_copy.
	  this also copy coderange when ptr and len is equal.

	* string.c (rb_enc_cr_str_copy): added for wrapper for rb_enc_copy.
	  this always copy coderange.

	* string.c (str_replace_shared): use rb_enc_str_copy.

	* string.c (str_new3): don't rb_enc_copy because encoding is copied
	  at str_replace_shared.

Wed Feb 20 13:08:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (parse_args): added --dir-mode, --script-mode and
	  --cmd-type options.  [ruby-dev:33816]

	* instruby.rb (parse_args): added bin-arch and bin-comm to install
	  type, for compiled files and script files.

	* instruby.rb (parse_args): deal with make style command line macros,
	  and count as long style options if prefixed with INSTALL_.

	* instruby.rb (makedirs): use $dir_mode.  [ruby-dev:33805]

	* instruby.rb (open_for_install): set file mode, which is now
	  permission mode instead of access mode.

	* instruby.rb (bin-comm): installs scripts with replacing shebang
	  lines.

Wed Feb 20 10:04:22 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (open_key_args): set arg->io even if no options passed.
	  [ruby-dev:33072]

Tue Feb 19 21:11:49 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_strlen_cr): get length with coderange scan.

	* string.c (str_strlen): use rb_enc_strlen_cr. [ruby-dev:33849]

Tue Feb 19 20:49:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_raise_jump): moved adjustment for control frame.

Tue Feb 19 18:34:32 2008  Tanaka Akira  <akr@fsij.org>

	* gc.c (STACK_LENGTH) [SPARC] : 0x80 offset removed.  [ruby-dev:33857]

Tue Feb 19 14:27:32 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_event): prevent polling.  based on
	  a patch from error errorsson in [ruby-Bugs-17675].

Tue Feb 19 11:14:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_exec_node): no thread starts inside iseq compilation.

	* eval.c (rb_f_raise): skip current control frame.  [ruby-core:15589]

	* insns.def (opt_div): raise as the ordinary method. [ruby-core:15589]

Mon Feb 18 15:16:30 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_each_line): fix newline size.

Mon Feb 18 13:06:37 2008  Tanaka Akira  <akr@fsij.org>

	* lib/irb/locale.rb (IRB::Locale#lc2kconv): check ja_JP.EUC-JP as well.

Mon Feb 18 11:51:19 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (re_warn): defined to restore warnings for /[a-c-e]/, etc.

Mon Feb 18 10:17:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/lib/expect.rb (IO#expect): check if peer is closed.
	  [ruby-Bugs-17940]

Mon Feb 18 00:33:03 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_regsub): don't repeat repl twice with
	  "X".sub!(/./, sprintf("\\%c", 255)).

Sun Feb 17 23:06:55 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/cgi.rb (CGI::escapeHTML): use gsub with Hash. [ruby-dev:33828]

Sun Feb 17 21:38:21 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (ENC_CODERANGE_AND): fix broken case. [ruby-dev:33826]

	* string.c (rb_str_times): fix broken case. [ruby-dev:33826]

Sun Feb 17 20:45:10 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_prepare_re): add enable_warning parameter.
	  (rb_reg_adjust_startpos): disable warning by rb_reg_prepare_re.
	  (rb_reg_search): follow rb_reg_prepare_re parameter change.

Sun Feb 17 20:12:41 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_regexp.rb: add tests to achieve over 90% test
	  coverage of re.c.

Sun Feb 17 15:25:08 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (ENC_CODERANGE_AND): added.

	* string.c (rb_str_plus, rb_str_times): keep coderange.

	* parse.y (STR_NEW0) use rb_usascii_str_new.

Sun Feb 17 14:07:24 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (str_strlen): rb_enc_strlen doesn't fail.

Sun Feb 17 13:03:48 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (str_sublen): use rb_enc_strlen.

Sun Feb 17 12:17:52 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/{euc_jp.c,gbk.c,iso_8859_1.c,iso_8859_11.c,iso_8859_13.c,
	  iso_8859_2.c,iso_8859_6.c,iso_8859_7.c,iso_8859_8.c,iso_8859_9.c,
	  shift_jis.c,windows_1251.c}: add document about encodings.

	* enc/cp949.c: divided into new file.

Sun Feb 17 10:59:04 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_quote): return US-ASCII string consistently.

Sun Feb 17 09:17:08 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_times): reduce loop overhead.

Sun Feb 17 03:37:01 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/re.h (struct rmatch_offset): new struct for character
	  offsets.
	  (struct rmatch): new struct.
	  (struct RMatch): reference struct rmatch.
	  (RMATCH_REGS): new macro.

	* re.c (match_alloc): initialize struct rmatch.
	  (pair_byte_cmp): new function.
	  (update_char_offset): update character offsets.
	  (match_init_copy): copy regexp and character offsets.
	  (match_sublen): removed.
	  (match_offset): use update_char_offset.
	  (match_begin): ditto.
	  (match_end): ditto.
	  (rb_reg_search): make character offset updated flag false.
	  (match_size): use RMATCH_REGS.
	  (match_backref_number): ditto.
	  (rb_reg_nth_defined): ditto.
	  (rb_reg_nth_match): ditto.
	  (rb_reg_match_pre): ditto.
	  (rb_reg_match_post): ditto.
	  (rb_reg_match_last): ditto.
	  (match_array): ditto.
	  (match_aref): ditto.
	  (match_values_at): ditto.
	  (match_inspect): ditto.

	* string.c (rb_str_subpat_set): use RMATCH_REGS.
	  (rb_str_sub_bang): ditto.
	  (str_gsub): ditto.
	  (rb_str_split_m): ditto.
	  (scan_once): ditto.

	* gc.c (obj_free): free character offsets.

Sun Feb 17 03:13:40 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/resource.rb: made version infos confirm to OS spec.

	* {bcc32,win32}/Makefile.sub (*.rc): add dependency.

Sat Feb 16 20:49:34 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_substr): optimized for UTF-8.

Sat Feb 16 18:13:53 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_compatible): check encoding incapable arguments.

Sat Feb 16 20:12:47 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (match_inspect): avoid SEGV with MatchData.allocate.inspect.

Sat Feb 16 19:04:17 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_strlen): revert r15507. [ruby-dev:33810]

Sat Feb 16 18:25:14 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_strlen): little more optimization.
	  (rb_enc_nth): remove needless variable 'c'.

Sat Feb 16 18:00:13 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_compatible): empty strings are always compatible.

	* string.c (rb_enc_cr_str_buf_cat): ditto.

Sat Feb 16 16:14:35 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_enc_strlen): UTF-8 character count moved to str_strlen.
	  (str_strlen): UTF-8 character count is only applicable for valid
	  UTF-8 string.  [ruby-dev:33807]

Sat Feb 16 13:16:49 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_sub_bang): stringize replacing hash values.
	  (str_gsub): ditto.

Sat Feb 16 13:01:33 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_strlen): add search_nonascii like character
	  counter for UTF-8.

Sat Feb 16 11:53:35 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_strlen): moved to string.c.

	* string.c (rb_enc_strlen): use search_nonascii.
	  (str_strlen): don't use search_nonascii.

Sat Feb 16 11:45:31 2008  Tanaka Akira  <akr@fsij.org>

	* lib/require_relative.rb: check require_relative call in eval.

Sat Feb 16 08:00:01 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (process_options): set default_external before loading
	  libraries. [ruby-dev:33801]

Sat Feb 16 05:49:54 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/iso_8859_{4,13}.c: Windows-1257 is replica of ISO-8859-13.

	* string.c (single_byte_optimizable): rb_enc_mbminlen must be 1
	  when rb_enc_mbmaxlen is 1.

Sat Feb 16 03:43:18 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_nth): moved to string.c.

	* string.c (rb_enc_nth): moved from string.c.  use search_nonascii
	  for ASCII compatible string.
	  (str_nth): wrong optimization removed to fix
	  "a".force_encoding("EUC-JP").slice!(0,10) returns
	  "a\x00\x00\x00\x00\x00\x00\x00\x00\x00"

Sat Feb 16 00:21:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (rb_range_beg_len): check if responds to "begin" and "end"
	  methods for non-Range object.

Fri Feb 15 20:29:42 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_init_cp): initialize WIN32OLE.codepage
	  according to Encoding.default_external.

	* test/win32ole/test_win32ole.rb: ditto.

Fri Feb 15 19:31:23 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/node.h (NODE_FL_NEWLINE): renamed from NODE_NEWLINE
	  to denote its a flag.  [ruby-core:15529]

Fri Feb 15 18:23:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_sub_bang, str_gsub): allows hash for replacement.

Fri Feb 15 17:12:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_strlen): use search_nonascii() for performance.

	* string.c (str_nth): ditto.

Fri Feb 15 16:22:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (open_key_args): allow specifying both :mode and :encoding.

Fri Feb 15 15:34:47 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_getbyte): new method.
	  (rb_str_setbyte): new method.

Fri Feb 15 15:29:03 2008  Tanaka Akira  <akr@fsij.org>

	* lib/require_relative.rb: new file.

Fri Feb 15 15:23:12 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_convert): check upper bound.  a patch from
	  Daniel Luz at [ruby-Bugs-17910].

Fri Feb 15 10:35:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_quote): set US-ASCII for ASCII-only string.
	  [ruby-dev:33785]

Fri Feb 15 10:27:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {win,bcc}32/Makefile.sub (config.h): added HAVE_FTRUNCATE.
	  [ruby-dev:33786]

Fri Feb 15 09:44:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (reg_compile_gen): reg_fragment_setenc might not raise an
	  exception before rb_reg_compile.

Fri Feb 15 07:37:40 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/ri/paths.rb: Preserve compatibility with 1.8.

Fri Feb 15 02:42:25 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ftruncate): check if available.

	* file.c (rb_file_truncate): check if ftruncate instead of truncate.

Fri Feb 15 02:40:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (sigsetmask): check when signal semantics is not POSIX.

	* signal.c (USE_TRAP_MASK): set true if sigprocmask or sigsetmask is
	  available.

Thu Feb 14 23:56:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.c (error_print): append a newline to rest lines.

	* parse.y (reg_compile_gen): appends error message from
	  rb_reg_compile() to one from reg_fragment_setenc().

Thu Feb 14 21:00:14 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_reopen): check STDIN, STDOUT and STDERR mode according to
	  stdio streams.

Thu Feb 14 16:07:40 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_math.rb: actual-expected argument ordering for
	  test_math.rb fixed.  a patch from Tadashi Saito
	  <shiba AT mail2.accsnet.ne.jp> in [ruby-dev:33770].

Thu Feb 14 16:02:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_utime): inhibits with secure level 2 or higher.

Thu Feb 14 12:30:02 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_preprocess_dregexp): use non-preprocessed regexp source
	  for result.

Thu Feb 14 01:43:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/timeout.rb (Timeout::timeout): made sensitive to location on the
	  stack.  [ruby-core:15458]

Thu Feb 14 00:49:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (INSTRUBY_ARGS): pass mode to install.  [ruby-dev:33766]

	* instruby.rb (parse_args): added --data-mode and --prog-mode options.

Thu Feb 14 00:02:19 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval.c (eval): allow to eval in a binding that has a singleton method.
	  [ruby-dev:33763]

	* test/ruby/test_proc.rb: add tests to achieve over 70% test coverage
	  of proc.c.

	* test/ruby/test_method.rb: ditto.

Wed Feb 13 22:46:36 2008  Tanaka Akira  <akr@fsij.org>

	* lib/pathname.rb (Pathname#sub_ext): new method.  [ruby-list:44608]

Wed Feb 13 21:50:32 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (proc_curry): new method. [ruby-dev:33676]

	* test/ruby/test_proc.rb: add tests for above.

Wed Feb 13 20:48:50 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (RObject): add iv_index_tbl for shortcut of
	  RCLASS_IV_INDEX_TBL(rb_obj_class(obj)).
	  (ROBJECT_IV_INDEX_TBL): defined.

	* object.c (init_copy): initialize iv_index_tbl in struct RObject.

	* variable.c (ivar_get): use ROBJECT_IV_INDEX_TBL.
	  (rb_ivar_defined): ditto.
	  (obj_ivar_each): ditto.
	  (rb_obj_remove_instance_variable): ditto.
	  (rb_ivar_set): update iv_index_tbl in struct RObject.

Wed Feb 13 16:21:48 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/generic.rb: revert r15442. 2nd argument of String#sub parse
	  escapes. [ruby-dev:33726]

	* bootstraptest/test_method.rb, enc/depend, instruby.rb, lib/mkmf.rb,
	  mkconfig.rb: revert r15443. ditto.

Wed Feb 13 11:20:26 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/depend: fix typo.

	* lib/mkmf.rb: revert r15443. "\\1#{sep}\\2" is wrong if sep is ended
	  with "\\".

Wed Feb 13 08:57:21 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup/inline.rb:  Allow inline markup to have a leading
	  '#' or '\', or trailing punctuation.  i.e. *#freeze?*, *\foo?*.

Wed Feb 13 07:21:23 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/to_html_hyperlink.rb:  Moved linking to to_html.rb, move
	  crossref to to_html_crossref.rb

Wed Feb 13 04:15:44 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (arg_concat_gen, arg_append_gen): optimize for array push.

	* parse.y (arg_concat_gen): optimize for array concat.

	* parse.y (arg_add_gen): removed since identical to arg_append_gen.

Tue Feb 12 21:04:51 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (exc_list): should use mrhs if non array.

Tue Feb 12 20:32:50 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/rational.rb (floor, ceil, truncate, round): do not use
	  definitions of Numeric.

	* lib/rational.rb (to_i): should returns truncated self.

	* lib/complex.rb (numerator): requires
	  Integer#{numerator,denominator}.

	* lib/complex.rb (quo): do not use definition of Numeric.

	* lib/complex.rb (>, >=, <, <=, between?, div, divmod, modulo,
	  floor, ceil, truncate, round): undef'ed.

	* lib/mathn.rb (Rational#inspect): removed.

Tue Feb 12 16:48:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (args, mrhs): flattens literal array splats.

	* parse.y (exc_list): splat literal array.

Tue Feb 12 15:27:19 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* bootstraptest/runner.rb, bootstraptest/test_method.rb, enc/depend,
	  instruby.rb, lib/mkmf.rb, lib/test/unit/util/procwrapper.rb,
	  mkconfig.rb, sample/test.rb, template/vm.inc.tmpl,
	  test/ruby/test_stringchar.rb: fixes around String#gsub.

Tue Feb 12 15:11:47 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/pure/generator.rb,
	  ext/json/lib/json/pure/parser.rb, ext/openssl/lib/openssl/x509.rb,
	  ext/win32ole/sample/olegen.rb, lib/date/format.rb, lib/irb/context.rb,
	  lib/irb/workspace.rb, lib/net/http.rb, lib/net/imap.rb,
	  lib/rdoc/generator.rb, lib/rdoc/markup/to_html.rb,
	  lib/rdoc/markup/to_latex.rb, lib/rdoc/parsers/parse_c.rb,
	  lib/rdoc/ri/formatter.rb, lib/rexml/parsers/baseparser.rb,
	  lib/rexml/quickpath.rb, lib/rexml/text.rb, lib/rss/parser.rb,
	  lib/uri/common.rb, lib/uri/generic.rb, lib/webrick/httpresponse.rb,
	  lib/webrick/httpservlet/filehandler.rb, lib/yaml/baseemitter.rb,
	  lib/yaml/encoding.rb: performance tuning around String#gsub.

Tue Feb 12 12:16:45 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_hash_cmp): lighter version of rb_str_cmp() for
	  hash comparison function.

	* hash.c (rb_any_cmp): use rb_str_hash_cmp().

	* string.c (rb_str_casecmp): should return nil for incompatible
	  comparison.

Tue Feb 12 12:13:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* instruby.rb: specify file mode to install.  a patch from
	  pegacorn  <subscriber.jp AT gmail.com> in [ruby-dev:33699].

Tue Feb 12 11:38:57 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (rb_num_coerce_bin): add ID argument to specify
	  caller's method name.  [ruby-dev:33663]

	* numeric.c (rb_num_coerce_cmp): ditto.

	* numeric.c (rb_num_coerce_relop): ditto.

	* ext/bigdecimal/bigdecimal.c (DoSomeOne): add function name argument.

Tue Feb 12 10:25:02 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/rdoc.rb:  Wrap parse_files' read in version check for
	  backwards compatibility.

Tue Feb 12 10:15:14 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (load_file): enc must effect source encoding.
	  [ruby-core:15496]

Tue Feb 12 10:16:47 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/ri/paths.rb:  Restore require rubygems check.

Tue Feb 12 02:42:27 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_include): specialize single character string
	  case (e.g. (?a ..?z).include(?x)) for performance.
	  [ruby-core:15481]

	* string.c (rb_str_upto): specialize single character case.

	* string.c (rb_str_hash): omit coderange scan for performance.

	* object.c (rb_check_to_integer): check Fixnum first.

	* object.c (rb_to_integer): ditto.

	* string.c (rb_str_equal): inline memcmp to avoid unnecessary
	  rb_str_comparable().

	* parse.y (rb_intern2): use US-ASCII encoding.

	* parse.y (rb_intern_str): ditto.

Mon Feb 11 17:21:18 2008  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::VERSION), test/rss/test_version.rb:
	  0.2.3 -> 0.2.4.

	* lib/rss/maker.rb, lib/rss/maker/, test/rss/test_maker_2.0.rb:
	  fixed a bug that RSS::Maker.make("0.9")'s item doesn't make some
	  elements if description is missed.
	  Reported by Michael Auzenne. Thanks!!!

	* lib/rss/maker/0.9.rb, test/rss/test_maker_0.9.rb:
	  RSS::Maker.make("0.9") generates RSS 0.92 not RSS 0.91.

Mon Feb 11 10:43:31 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (load_file): the encoding of DATA follows the source
	  file encoding. [ruby-dev:33693]

Mon Feb 11 06:50:42 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_pack.rb: fix tests for 64bit CPU.

	* test/ruby/test_bignum.rb: ditto.

	* test/ruby/test_file_exhaustive.rb: ditto.

	* test/ruby/test_integer.rb: ditto.

	* test/ruby/test_time.rb: ditto.

	* test/ruby/test_numeric.rb: ditto.

	* test/ruby/test_fixnum.rb: ditto.

Mon Feb 11 00:18:57 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/benchmark.rb (Job::Benchmark#item): fix typo.

Sun Feb 10 21:58:32 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (encdb, transdb): depend on $(PREP).

Sun Feb 10 16:58:20 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*, test/rubygems*, gem_prelude.rb: Import RubyGems
	  r1601.  [ruby-core:15381]

Sun Feb 10 15:07:23 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {bcc32,win32,wince}/Makefile.sub (MISSING): added cbrt.obj.

Sun Feb 10 12:58:33 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/code_objects.rb: Make some attributes accessible for reuse.
	* lib/rdoc/generator/html.rb: Pull out ContextUser classes and related
	  methods for reuse.
	* lib/rdoc/generator.rb: Move ContextUser classes to
	  RDoc::Generator::Context for reuse.
	* lib/rdoc/rdoc.rb: Make RDoc::RDoc initialization a little easier.
	* lib/rdoc/options.rb: Make RDoc::Options easier to use without
	  parsing an ARGV.
	* lib/rdoc/markup/to_*.rb: Subclass RDoc::Markup::Formatter.
	* lib/rdoc/markup/formatter.rb: Add RDoc::Markup::Formatter to make
	  RDoc markup conversion easier.
	* lib/rdoc/markup/fragments.rb: Make RDoc::Markup::ListItem easier to
	  test.
	* lib/rdoc/markup/to_html_hyperlink.rb: Pulled out of the HTML
	  generator for easier reusability.
	* lib/rdoc/markup.rb: Fix bug with labeled lists containing bullet
	  lists.
	* lib/rdoc/generators/html/html.rb: Fix Constant display.

Sat Feb  9 23:44:29 2008  Tanaka Akira  <akr@fsij.org>

	* missing/tgamma.c (tgamma): use lgamma_r if available.

Sat Feb  9 23:22:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/extconf.rb: simplified the condition.

Sat Feb  9 21:20:28 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_math.rb: add tests for Math.gamma, Math.lgamma and
	  Math.cbrt, and use assert_in_delta instead of assert.

Sat Feb  9 18:34:45 2008  Tanaka Akira  <akr@fsij.org>

	* math.c (math_cbrt): new method Math.cbrt.

	* configure.in (cbrt): check for replacement functions.

	* missing/cbrt.c: new file.

Sat Feb  9 17:51:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_to_f): use strtod() for more
	  precision.  [ruby-talk:290296]

	* ext/bigdecimal/bigdecimal.c (BASE_FIG): made constant.

	* ext/bigdecimal/extconf.rb: ditto.  [ruby-dev:33658]

Sat Feb  9 12:06:45 2008  Tanaka Akira  <akr@fsij.org>

	* missing/tgamma.c (tgamma): add error check.

Sat Feb  9 11:47:03 2008  Tanaka Akira  <akr@fsij.org>

	* math.c (math_gamma): add error check.
	  (math_lgamma): ditto.

Sat Feb  9 11:09:26 2008  Tanaka Akira  <akr@fsij.org>

	* missing/lgamma_r.c (lgamma_r): return HUGE_VAL for non-positive
	  integers.

Sat Feb  9 10:03:07 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_new4): copy encoding from orig, instead of shared
	  one.

Sat Feb  9 01:01:38 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (lchmod_internal): fix warning cast from pointer to integer of
	  different size.

Sat Feb  9 00:44:52 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb.rb (IRB::Irb::eval_input): rescues Interrupt and other than
	  SystemExit and SignalException.  [ruby-core:15359]

Fri Feb  8 23:51:36 2008  Tanaka Akira  <akr@fsij.org>

	* missing/lgamma_r.c (lgamma_r): use smaller argument for sin function.

Fri Feb  8 22:10:36 2008  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI.open_http): rescue URI::InvalidURIError by
	  URI.parse for location URI.

Fri Feb  8 19:22:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (rb_str_derive): uses rb_str_subseq() for byte
	  length.  [ruby-dev:33653]

	* ext/iconv/iconv.c (iconv_convert): added toidx argument to set
	  encoding of successfully converted string.  [ruby-dev:33221]

Fri Feb  8 15:09:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (xsystem): expand macros like as make.

Fri Feb  8 09:27:57 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rdoc/ri/driver.rb (read_yaml): remove SM* for compatibility.

Fri Feb  8 00:07:24 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_hash.rb: follow the change of Hash#flatten.

	* test/ruby/test_time.rb: add tests to achieve over 70% test coverage
	  of time.c.

	* test/ruby/test_prec.rb: ditto over 90% for prec.c.

Thu Feb  7 19:11:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_dup): reverted unneeded change.  [ruby-dev:33634]

	* string.c (rb_str_replace): makes frozen shared string before
	  sharing.

Thu Feb  7 16:33:51 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_reopen): don't change access mode for stdin, stdout and
	  stderr.  [ruby-core:15360]

Thu Feb  7 16:33:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_replace_shared): replaces string with sharing.

	* string.c (rb_str_new4, rb_str_associate, rb_str_associated): allows
	  associated strings shared.

	* string.c (rb_str_dup, rb_str_substr, rb_str_replace): shares memory.
	  [ruby-core:15400]

Thu Feb  7 15:42:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_end_with): compares with the suffix.

Thu Feb  7 15:03:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/korean.c: add support for CP949 by Park Ji-In.
	  [ruby-dev:33626]

Thu Feb  7 11:11:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* missing/lgamma_r.c (lgamma_r): some compilers don't permit dividing
	  by literal 0.0. use const variable instead.

	* {bcc32,win32,wince}/Makefile.sub (MISSING): add lgamma_r.obj and
	  tgamma.obj.

Thu Feb  7 10:39:21 2008  Tanaka Akira  <akr@fsij.org>

	* math.c (math_gamma): new method Math.gamma.
	  (math_lgamma): new method Math.lgamma.

	* include/ruby/missing.h (tgamma): declared unless HAVE_TGAMMA.
	  (lgamma_r): declared unless HAVE_LGAMMA_R.

	* configure.in (tgamma): check for replacement functions.
	  (lgamma_r): ditto.

	* missing/tgamma.c: new file.  based on gamma.c from
	  "C-gengo niyoru saishin algorithm jiten" (New Algorithm handbook
	  in C language) (Gijyutsu hyouron sha, Tokyo, 1991)
	  by Haruhiko Okumura.

	* missing/lgamma_r.c: ditto.

	* LEGAL (missing/tgamma.c): describe as public domain.
	  (missing/lgamma_r.c): ditto.

Thu Feb  7 09:05:57 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (nkf_enc_from_index): BINARY does not
	  have in-bound encoding index.

Thu Feb  7 04:26:28 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/korean.c: add EUC-KR conversion support by Park Ji-In.
	  [ruby-dev:33621]

Wed Feb  6 01:47:39 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_flatten): do not flatten recursively by default.
	  [ruby-dev:33603]

Wed Feb  6 00:50:19 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* insns.def (adjuststack): never use INC_SP with minus value because
	  some compilers cannot deal it correctly. use DEC_SP instead.

Wed Feb  6 00:48:41 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_hash.rb: add tests to achieve over 90% test coverage
	  of hash.c.

	* test/ruby/test_env.rb: ditto.

Wed Feb  6 00:24:49 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* hash.c (env_rassoc): remove access to free'd environment on mswin32.

Tue Feb  5 21:57:34 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm.c (rb_call_super): pass a passed block when super is called via
	  rb_call_super.  [ruby-dev:33598]

Tue Feb  5 11:14:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (INSTALL_DIRS, install_dirs): added BINDIR.

	* lib/mkmf.rb (install_files): rejects files matching to
	  $NONINSTALLFILES.

	* lib/mkmf.rb (init_mkmf): defaults $NONINSTALLFILES to backup and
	  temporary files.

Mon Feb  4 21:52:06 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/delegate.rb (DelegateClass): use define_method instead of
	  module_eval to improve performance.  [ruby-dev:33586]

Mon Feb  4 16:44:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (darwin): NSIG is not defined if _XOPEN_SOURCE > 500L.
	  [ruby-dev:33584]

Mon Feb  4 14:51:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_enc_symname2_p): support "!", "!=" and "!~".
	  [ruby-dev:33592]

Mon Feb  4 13:58:42 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/delegate.rb (Delegator.preserved, DelegateClass.methods): extend
	  shouldn't be delegated. [ruby-dev:32987], etc.

Mon Feb  4 08:59:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension::[]): no more transition
	  extend(CGI::Value).  a patch from <tommy AT tmtm.org> in
	  [ruby-dev:33583].

Sun Feb  3 21:13:13 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_numeric.rb: forgot to add this (at r15360).

	* test/ruby/test_file_exhaustive.rb: add tests to achieve over 80% test
	  coverage of file.c.

Sat Feb  2 20:06:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/benchmark.rb (Benchmark::realtime): make Benchmark#realtime
	  a bit faster.  a patch from Alexander Dymo <dymo AT ukrpost.ua> in
	  [ruby-core:15337].

Sat Feb  2 17:40:21 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* time.c (time_cmp): Time.<=> no longer supports comparison with
	  numeric. [ruby-core:15332]

Sat Feb  2 09:53:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (darwin): disabled fat-binary support which confuses
	  configure much, since ``universal'' implies hidden cross-compiling.
	  TODO: ruby and libruby.bundle might be possible to bound with `lipo'
	  after builds for each archs.  Anyway, config.h and rbconfig.rb must
	  be separated definitely at least.

Sat Feb  2 09:28:36 2008  Tanaka Akira  <akr@fsij.org>

	* random.c (limited_big_rand): fix buffer overflow when SIZEOF_BDIGITS
	  is 2.  fixed by Kenta Murata.  [ruby-dev:33565]

Fri Feb  1 21:42:37 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (darwin): _XOPEN_SOURCE is necessary to make ucontext_t
	  consistent with the library implementation of MacOS X 10.5.
	  [ruby-dev:33461]

	* configure.in (darwin): ucontext on PowerPC MacOS X 10.5 is broken.

Fri Feb  1 11:44:22 2008  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb (C_ESC): use octal escape to avoid
	  "\x09for (;;) ..." to be interpret the first character 0x9f.

Thu Jan 31 23:06:42 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_bignum.rb: suppress warnings during test.

	* test/ruby/test_enum.rb: ditto.

	* test/ruby/test_integer.rb: add tests to achieve over 90% test
	  coverage of numeric.c.

	* test/ruby/test_float.rb: ditto.

	* test/ruby/test_fixnum.rb: ditto.

	* test/ruby/test_numeric.rb: ditto.

	* test/ruby/test_pack.rb: add tests to achieve over 90% test coverage
	  of pack.c.

Thu Jan 31 17:30:42 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* marshal.c (r_object0): no need to call r_entry for immediate values.

Thu Jan 31 15:46:30 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/ri/formatter.rb (output): add accessor.

	* lib/rdoc/ri/display.rb (page): replace @formatter.output instead of
	  $stdout.

Thu Jan 31 15:06:50 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* marshal.c (r_object0): call r_entry/r_leave to call proc when
	  TYPE_FIXNUM, TYPE_NIL, TYPE_TRUE, TYPE_FALSE, TYPE_SYMBOL.

Thu Jan 31 14:03:38 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/ri/display.rb (display_method_list, display_class_list):
	  use @formatter.raw_print_line instead of puts.

	* lib/rdoc/ri/driver.rb (select_methods): new method to collect all
	  instance/class methods which match with passed pattern.

	* lib/rdoc/ri/driver.rb (run): use class_cache's result directly
	  instead of select_classes' because it's removed now.

	* lib/rdoc/ri/driver.rb (run): search methods when passed name is not
	  class name. [ruby-core:15309]

Thu Jan 31 08:31:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ext/extmk.rb, instruby.rb): inlined $(MAKE) so that can
	  be executed even with -n.

Thu Jan 31 06:24:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_close_read): replaces fptr with the tied writer if
	  duplex.

	* io.c (rb_io_close_write): unties the tied IO for writing if duplex.
	  [ruby-dev:33532]

Thu Jan 31 02:22:04 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (open_key_args): allow encoding key to take two encoding
	  names.  a patch from <rubikitch AT ruby-lang.org>.  [ruby-dev:33540]

Thu Jan 31 02:15:49 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (dsym): allow empty symbols.  [ruby-core:15248]

Thu Jan 31 00:01:51 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (select_internal): fix SEGV by `select [STDIN],nil,[STDIN]'.
	  fixed by Petr Chromec.
	  http://rubyforge.org/tracker/index.php?func=detail&aid=17275&group_id=426&atid=1698

Wed Jan 30 17:32:49 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/*.c: add GB12345, UCS-{2,4}{BE,LE}.

Wed Jan 30 14:32:18 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/ri/driver.rb (cache_file_for): shouldn't use `:' in filename.

Wed Jan 30 14:27:19 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_succ): use wrapped character as a carry for
	  ASCII incompatible encoding.

Wed Jan 30 12:26:59 2008  Tanaka Akira  <akr@fsij.org>

	* enc/utf_16be.c (UTF16_IS_SURROGATE_FIRST): avoid branch.
	  (UTF16_IS_SURROGATE_SECOND): ditto.
	  (UTF16_IS_SURROGATE): defined.
	  (utf16be_mbc_enc_len): validation implemented.

	* enc/utf_16le.c (UTF16_IS_SURROGATE_FIRST): avoid branch.
	  (UTF16_IS_SURROGATE_SECOND): ditto.
	  (UTF16_IS_SURROGATE): defined.
	  (utf16le_mbc_enc_len): validation implemented.

Wed Jan 30 12:06:43 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* bignum.c (rb_cstr_to_inum): '0_2' is a valid representation.

Wed Jan 30 11:57:50 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* bootstraptest/runner.rb: fix -I../../hoge case.

Wed Jan 30 01:25:16 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_range.rb: add tests to achieve over 90% test coverage
	  of range.c.

Wed Jan 30 00:09:37 2008  Tanaka Akira  <akr@fsij.org>

	* enc/euc_tw.c (euctw_mbc_enc_len): validation implemented.

Tue Jan 29 22:58:11 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_enumerator.rb: add tests to achieve over 90% test
	  coverage of enumerator.c.

	* test/ruby/test_enum.rb: add for enum.c.

Tue Jan 29 22:29:48 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* enumerator.c: fix documents.

Tue Jan 29 22:27:11 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* range.c: fix SEGV by ("a" .. "z").step(2 ** 30) { }.

Tue Jan 29 21:59:16 2008  Tanaka Akira  <akr@fsij.org>

	* enc/euc_tw.c (euctw_islead): 0x8e is a leading byte.

Tue Jan 29 21:55:35 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c: move object allocation out of blocking_region.
	  [ruby-dev:33139]

Tue Jan 29 20:37:36 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/make_transdb.rb: add for make transdb.h.

	* dmytranscode.c: add for miniruby.

	* enc/gbk.c (gbk_left_adjust_char_head, gbk_is_allowed_reverse_match):
	  fix odd regexp match. [ruby-dev:33502]

Tue Jan 29 20:17:06 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32}/Makefile.sub (MINIOBJS): add dmytranscode.$(OBJEXT).

Tue Jan 29 19:39:40 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in, common.mk: fix rule for dmytranscode.o.

Tue Jan 29 19:03:16 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/japanese.c (rb_to_Windows_31J): to 'Windows-31J'.

	* common.mk: add rules for transdb.h.

	* transcode.c (init_transcoder_table): use transdb.h.

Tue Jan 29 18:05:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (encdb_{replicate,alias,dummy,declare}): define only if
	  NO_ENCDB_H is not defined.

Tue Jan 29 17:54:11 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/gbk.c (EncLen_gbk): too short. [ruby-dev:33497]

Tue Jan 29 17:25:22 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* dmyencoding.c, encoding.c (enc_init_db, NO_ENCDB_H):
	  miniruby doesn't use encdb.

	* common.mk: encdb.h use miniruby.

Tue Jan 29 17:37:36 2008  Tanaka Akira  <akr@fsij.org>

	* enc/gb18030.c (gb18030_mbc_enc_len): validation implemented.

Tue Jan 29 17:01:07 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/ifchange: remove $temp when unchanged.

Tue Jan 29 16:59:01 2008  Tanaka Akira  <akr@fsij.org>

	* insns.def (toregexp): generate a regexp from strings instead of one
	  string.

	* re.c (rb_reg_new_ary): defined for toregexp.  it concatenates
	  strings after each string is preprocessed.

	* compile.c (compile_dstr_fragments): split from compile_dstr.
	  (compile_dstr): call compile_dstr_fragments.
	  (compile_dregx): defined for dynamic regexp.
	  (iseq_compile_each): use compile_dregx for dynamic regexp.

	  [ruby-dev:33400]

Tue Jan 29 16:25:26 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk, ext/extmk.rb: always make encdb.h.

Tue Jan 29 12:53:39 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/gbk.c: add GBK, CP936 and CP949.

	* enc/euc_kr.c: remove CP949.

	* enc/euc_cn.c: remove CP936 and rename to gb2312.c

	* enc/gb2312.c: GB2312 is preferred MIME name.

Tue Jan 29 03:01:29 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (reg_fragment_setenc_gen): US-ASCII script special code.

	* parse.y (reg_fragment_check_len, reg_compile_gen): no need such
	  trick.
	  [ruby-dev:33399]

	* test/ruby/test_m17n.rb (test_regexp_usacii_literal): add tests.

Tue Jan 29 01:38:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk ($(srcdir)/revision.h): no need to show ifchange execution
	  because ifchange echos updated or unchanged.

Tue Jan 29 01:26:23 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (up): use last changed revision.

	* common.mk (up): force to update revision.h.

Tue Jan 29 00:12:17 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2str0): should be US-ASCII.

Tue Jan 29 00:10:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-set-encoding): updates magic comment.

Mon Jan 28 23:47:52 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (rb_id2str, ripper_initialize, Init_ripper):
	  use rb_usascii_str_new2. [ruby-dev:33449]

Mon Jan 28 19:37:08 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/win32ole/win32ole.c (ole_cp2encoding): new function.

	* ext/win32ole/win32ole.c (ole_wc2vstr, ole_variant2val, fole_missing):
	  set encoding to result.

	* ext/win32ole/win32ole.c (fole_s_set_code_page, Init_win32ole): set
	  default encoding.
	  [ruby-dev:33433]

Mon Jan 28 11:17:28 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c, parse.y, re.c: use rb_ascii8bit_encoding.

Mon Jan 28 17:54:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_7.h: add dummy encoding UTF-7 and its alias CP65000.

Mon Jan 28 17:41:19 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/utf_8.c: add alias CP65001.

Mon Jan 28 15:33:23 2008  Tanaka Akira  <akr@fsij.org>

	* enc/big5.c (big5_mbc_enc_len): validation implemented.

Mon Jan 28 13:02:02 2008  Tanaka Akira  <akr@fsij.org>

	* enc/euc_kr.c (euckr_mbc_enc_len): validation implemented.

Mon Jan 28 11:24:49 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (parser_str_new): encoding of UTF-8 literal string in
	  US-ASCII script is UTF-8. [ruby-dev:33406]

Mon Jan 28 10:25:59 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_m17n.rb (test_magic_comment): add test.

Mon Jan 28 09:34:54 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (help): use double quotes for nmake.

Mon Jan 28 00:39:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_set_encode): check if encoding is ASCII compatible.

Mon Jan 28 01:21:15 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_open_file): should check NUL in path.
	  <http://www.rubyist.net/~matz/20080125.html#c01>.

	* io.c (rb_io_s_popen): ditto.

	* io.c (rb_io_reopen): ditto.

	* io.c (next_argv): ditto.

Sun Jan 27 23:33:35 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): fix for left justify flag.

	* sprintf.c (rb_str_format): zero-precision zero bug revised.
	  [ruby-dev:33419]

Sun Jan 27 23:20:54 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h: precise mbclen API redesigned to avoid
	  inline functions.
	  (onigenc_mbclen_charfound): removed.
	  (onigenc_mbclen_needmore): removed.
	  (onigenc_mbclen_recover): removed.
	  (ONIGENC_MBCLEN_CHARFOUND): removed.
	  (ONIGENC_MBCLEN_CHARFOUND_P): defined.
	  (ONIGENC_MBCLEN_CHARFOUND_LEN): defined.
	  (ONIGENC_MBCLEN_INVALID): removed.
	  (ONIGENC_MBCLEN_INVALID_P): defined.
	  (ONIGENC_MBCLEN_NEEDMORE): removed.
	  (ONIGENC_MBCLEN_NEEDMORE_P): defined.
	  (ONIGENC_MBCLEN_NEEDMORE_LEN): defined.
	  (ONIGENC_MBC_ENC_LEN): use onigenc_mbclen_approximate.

	* regenc.c (onigenc_mbclen_approximate): defined.

	* include/ruby/encoding.h (MBCLEN_CHARFOUND): removed.
	  (MBCLEN_INVALID): removed.
	  (MBCLEN_NEEDMORE): removed.
	  (MBCLEN_CHARFOUND_P): defined.
	  (MBCLEN_INVALID_P): defined.
	  (MBCLEN_NEEDMORE_P): defined.
	  (MBCLEN_CHARFOUND_LEN): defined.
	  (MBCLEN_NEEDMORE_LEN): defined.

	* encoding.c: use new API.

	* re.c: ditto.

	* string.c: ditto.

	* parse.y: ditto.

Sun Jan 27 22:55:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (value_expr_gen): reverted r12880.  [ruby-dev:33388]

Sun Jan 27 22:33:39 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): fix for octal with precision.
	  [ruby-dev:33411]

Sun Jan 27 22:31:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-set-encoding): automatically insert
	  encoding magic comment.

	* misc/ruby-mode.el (ruby-mode): set ruby-mode-set-encoding to buffer
	  local before-save-hook.

Sun Jan 27 19:51:15 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_inspect): avoid exception by
	  "\#\xa1".force_encoding("euc-jp").inspect.

Sun Jan 27 19:07:33 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_succ): warning suppressed.

Sun Jan 27 18:18:13 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (help): show major targets.

Sun Jan 27 17:54:48 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf.c: raise error when no output encoding is given.

Sun Jan 27 17:20:10 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_succ): don't increment/decrement codepoint.

Sun Jan 27 16:03:42 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex#buf_input): use chars.to_a.

Sun Jan 27 16:27:22 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8: update nkf.

Sun Jan 27 16:25:27 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_source): set encoding as regexp encoding.

Sun Jan 27 05:56:39 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_preprocess): force fixed encoding when ASCII
	  incompatible source string.

Sat Jan 26 23:46:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): zero-precision zero should be empty.
	  [ruby-dev:33363]

	* sprintf.c (rb_str_format): not prepend octal prefix to negative or
	  zero value.  [ruby-dev:33363], [ruby-dev:33367]

Sat Jan 26 23:42:15 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (assignable_gen, keyword_to_name): __ENCODING__ was missing.

Sat Jan 26 19:08:45 2008  Tanaka Akira  <akr@fsij.org>

	* marshal.c (w_object): dump string encoding in USERDEF.
	  [ruby-dev:33401]

Sat Jan 26 17:42:23 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): validate argument expr of "next"
	  statement.

	* bootstraptest/test_syntax.rb: add a test.

Sat Jan 26 17:22:46 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.c, compile.h: fix to calculate correct stack depth
	   at each instruction.

Sat Jan 26 09:41:02 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/doctype.rb, test/rss/test_maker_itunes.rb: replace
	  multi-byte string.

	* test/json/{test_json.rb, test_json_unicode.rb}:
	  add magic comment.

Sat Jan 26 09:30:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (rb_usascii_encindex): added prototype.

	* include/ruby/intern.h (rb_usascii_str_new, rb_usascii_str_new2):
	  ditto.

Sat Jan 26 09:17:13 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_new): set US-ASCII and ENC_CODERANGE_7BIT when
	  empty string (len == 0).

Sat Jan 26 03:41:53 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (parser_initialize): set default script encoding as US-ASCII.

	* ruby.c (load_file): ditto.

	* ruby.c (process_options): set script encoding of -e from locale
	  except when -K is specified.

	* ruby.c (load_file): set script encoding of stdin from locale except
	  when -K is specified. [ruby-dev:33375]

Sat Jan 26 02:51:06 2008  Koichi Sasada  <ko1@atdot.net>

	* compile.c, compile.h: fix stack pointer issues.
	  calculate correct stack depth at compile time.

	* insns.def (emptstack): remove it and add a new insn "adjuststack".

	* bootstraptest/test_knownbug.rb: move/remove fixed test.

	* bootstraptest/test_syntax.rb: ditto.

Sat Jan 26 00:17:18 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_usascii_new{,2}: defined.
	  (rb_str_new): set US-ASCII and ENC_CODERANGE_7BIT when empty
	  string.

	* encoding.c (rb_usascii_encoding, rb_usascii_encindex): defined.
	  (rb_enc_inspect, enc_name, rb_locale_charmap, rb_enc_name_list_i):
	  use rb_str_ascii_new.

	* array.c (recursive_join, inspect_ary): ditto.

	* object.c (nil_to_s, nil_inspect, true_to_s, false_to_s,
	  rb_mod_to_s): ditto.

	* hash.c (inspect_hash, rb_hash_inspect, rb_f_getenv, env_fetch,
	  env_clear, env_to_s, env_inspect): ditto.

	* numeric.c (flo_to_s, int_chr, rb_fix2str): ditto.

	* bignum.c (rb_big2str): ditto.

	* file.c (rb_file_ftype, rb_file_s_dirname, rb_file_s_extname,
	  file_inspect_join, Init_file): ditto.

	* test/ruby/test_ruby_m17n.rb: add checks for encoding of string.

Sat Jan 26 01:35:46 2008  Tanaka Akira  <akr@fsij.org>

	* marshal.c (r_byte): use getbyte instead of getc.
	  (marshal_load): ditto.
	  [ruby-dev:33264]

Sat Jan 26 00:43:40 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_getline_fast): don't care ASCII incompatible encoding.
	  (prepare_getline_args): generate a newline according to IO encoding
	  when necessary.
	  (rb_io_getline_1): call rb_io_getline_fast only for ASCII
	  compatible encoding.

Fri Jan 25 21:49:36 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_buf_cat_ascii): use rb_enc_cr_str_buf_cat.

Fri Jan 25 19:38:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (version.$(OBJEXT)): depends on $(srcdir)/revision.h.

	* common.mk (revision.h): extracts revision number with ``svn info''.

	* common.mk (up): target to update from the repository.

	* Makefile.in, {win,bcc}32/Makefile.sub (IFCHANGE): tool to update a
	  file if changed.

	* tool/ifchange: for unixen.

	* win32/ifchange.bat: some fix

Fri Jan 25 17:12:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file): set default to ASCII-8BIT explicitly if -K
	  option is not given.

Fri Jan 25 16:31:47 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_str_buf_cat_ascii): declared.

	* string.c (rb_str_buf_cat_ascii): defined.

	* re.c (rb_reg_s_union): use rb_str_buf_cat_ascii to support ASCII
	  incompatible encoding.

Fri Jan 25 16:11:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options, load_file, rb_load_file): propagates script
	  encoding by -K to libraries.  [ruby-dev:33156]

Fri Jan 25 15:56:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (cmdline_arguments): split argc and argv from cmdline_options.

	* ruby.c (process_options): not set encoding of -e option from -E
	  option if they are not compatible.

Fri Jan 25 13:15:23 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (proc_options, process_options, load_file): shouldn't effect
	  --encoding to script encoding. [ruby-dev:33169]

Fri Jan 25 10:31:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* */*.bat: set svn:mime-type to text/batch.

Thu Jan 24 23:23:06 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* enum.c (enum_one, enum_take_while, enum_drop_while): fix documents.

Thu Jan 24 21:46:24 2008  Tanaka Akira  <akr@fsij.org>

	* parse.y (reg_fragment_setenc_gen): associate ASCII-8BIT only if
	  str has only ASCII characters.

Thu Jan 24 20:46:17 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_m17n.rb: follow to the following changes.

Thu Jan 24 20:21:07 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parser.y (parser_str_new): automatically update string literal's
	  encoding from US-ASCII to ASCII-8BIT when script encoding is US-ASCII
	  and the string includes non-ascii bytes. [ruby-dev:33348]

	* parser.y (reg_fragment_check_gen, reg_compile_gen): automatically
	  update regexp literal's encoding from US-ASCII to ASCII-8BIT when
	  script encoding is US-ASCII, the regexp has no kcode option and the
	  regexp includes non-ascii bytes. [ruby-dev:33353]

Thu Jan 24 19:36:22 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic::inspect): use Kernel#to_s instead
	  object_id with printf.  [ruby-dev:33347]

Thu Jan 24 19:29:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (remove_sign_bits): returns pointer to the first char to
	  be used, instead of copying.

	* sprintf.c (rb_str_format): negative indicator dots should come
	  before sign digits always.  [ruby-dev:33224]

Thu Jan 24 18:19:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_is_newline): parenthesized arguments.

Thu Jan 24 18:14:14 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_fixed_encoding_p): no need to treat ASCII-8BIT specially.

Thu Jan 24 16:53:06 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_initialize): 7bit clean regexp should be US-ASCII.
	  [ruby-dev:33346]

Thu Jan 24 16:31:04 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_getline_fast): the end point of left_char_head()
	  must be the last character.  [ruby-cvs:22445]

Thu Jan 24 16:24:25 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (reg_fragment_setenc_gen): recognize regexp with option n as
	  as ASCII-8BIT instead of US-ASCII. [ruby-dev:33339]

Thu Jan 24 15:44:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (collect_bang_i): use rb_ary_store() to avoid potential
	  memory corruption.  a patch from Yusuke Endoh <mame@tsg.ne.jp>
	  in [ruby-dev:33328].

	* array.c (ITERATE): remove unnecessary macro.

	* array.c (sort_1): remove ary_sort_check().  in-place sort keep
	  original elements even when it's modified.

	* array.c (sort_2): ditto.

Thu Jan 24 15:09:40 2008  Tanaka Akira  <akr@fsij.org>

	* time.c (make_time_t): revert round trip test.  [ruby-dev:33058]

Thu Jan 24 11:14:56 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_enc_cr_str_buf_cat): ASCII incompatible encoding is
	  not compatible with any other encoding.

Thu Jan 24 07:34:34 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (STR_NEW0): set encoding as US-ASCII.

Thu Jan 24 03:47:41 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/text.rb, lib/rubygems/open-uri.rb, lib/open-uri.rb,
	  test/logger/test_logger.rb, test/ruby/test_regexp.rb:
	  fix tests. [ruby-dev:33336]

Thu Jan 24 03:23:44 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_each_line): use memchr(3) for faster newline
	  search.

	* io.c (appendline): remove unused arguments

	* io.c (rb_io_getline_fast): make much simpler (and faster).

Thu Jan 24 02:13:07 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* insns.def (expandarray): fix stack inc.  [ruby-dev:32892]

	* bootstraptest/test_knownbug.rb, test_massign.rb: move a fixed test.

Thu Jan 24 01:00:34 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.{c, h} (rb_usascii_encoding): added.

	* parse.y (parser_str_new, rb_intern3): ascii only string literal is
	  US-ASCII.

	* ruby.c (proc_optionc): -Kn means ASCII-8BIT.

Wed Jan 23 23:54:40 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* sprintf.c: fix comment.  [ruby-dev:33275]

	* math.c: fix comment.  [ruby-dev:33276]

Wed Jan 23 22:47:34 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_struct.rb: add tests to achieve over 90% test
	  coverage of struct.c.

	* test/ruby/test_sprintf.rb: ditto for sprintf.c.

	* test/ruby/test_math.rb: ditto for math.c.

Wed Jan 23 22:14:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/japanese.c (rb_from_Windows_31J, rb_to_Windows_31J):
	  provisional workaround for Windows-31J.  [ruby-dev:33320]

Wed Jan 23 15:25:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_strftime): copy encoding from format.  [ruby-dev:33303]

Wed Jan 23 15:04:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_make_independent): should set length.

	* string.c (rb_str_associate): hide associated array from ObjectSpace.

	* string.c (rb_str_associated): return associated array with freezing
	  instead of false.  [ruby-dev:33282]

	* string.c (rb_str_freeze): freeze associated array together.

Wed Jan 23 13:39:48 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_prepare_re): fix SEGV by
	  /a/ =~ "aa".force_encoding("utf-16be").

Wed Jan 23 11:53:26 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_mod_check, str_nth, str_offset): constified.

	* string.c (rb_str_dump): dump in ASCII-8BIT always.

Wed Jan 23 10:18:10 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_method.c (rb_export_method): set ruby_vm_redefined_flag for
	  visibility change as well.  reported by K.Kosako in
	  http://d.hatena.ne.jp/kkos/20080122#1201012720.

Tue Jan 22 22:26:23 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_bignum.rb: change some tests because rational
	  redefines Bignum#quo and Bignum#**.

Tue Jan 22 20:58:15 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): need to output sodir rule.

Tue Jan 22 19:37:16 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): lib files shouldn't depend on install
	  dir because if the dir is newer than lib files, lib files will be
	  always copied.

Tue Jan 22 17:52:52 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/utf_16_32.c: Streamline parentheses, add more
	  'static' qualifiers.

Tue Jan 22 12:57:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in (MINIRUBY): remove -I$(EXTOUT)/$(arch) from
	  MINIRUBY since miniruby might not be able to load DLL.

	* test/ruby/test_m17n.rb: move tests from bootstrap test.

	* encoding.c (enc_find): should check name if ASCII compatible.

	* string.c (rb_str_end_with): should check character boundary.

	* encoding.c (rb_enc_compatible): encoding must be ASCII
	  compatible before checking ENC_CODERANGE_7BIT.

	* encoding.c (rb_enc_compatible): wrong compatibility condition.
	  [ruby-dev:33273]

Tue Jan 22 09:26:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_each_char): iterates over a shadow.
	  [ruby-dev:33243]

Tue Jan 22 08:59:52 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/ri/formatter.rb:  Indent labeled lists like note lists.

	* test/rdoc/test_rdoc_ri_overstrike_formatter.rb:  Added.

	* test/rdoc/test_rdoc_ri_formatter.rb:  Added tests.

Tue Jan 22 04:40:28 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (rb_intern3): do not call rb_enc_mbclen() if *m is
	  ASCII.  [ruby-talk:287225]

	* string.c (rb_str_each_line): use rb_enc_is_newline() to gain
	  performance if the record separator ($/) is not modified.

Tue Jan 22 01:15:51 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ChangeLog: format-time-string under C locale. [ruby-dev:33261]

Tue Jan 22 00:45:12 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/ruby/test_bignum.rb: add tests for bignum.c.

Tue Jan 22 00:30:08 2008  Yusuke Endoh  <mame@tsg.ne.jp>

	* bignum.c (big_shift): fix a bug that caused infinite loop when
	  left shifting.

Mon Jan 21 20:09:38 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (marshal_load): initialize the cache.

Mon Jan 21 19:42:42 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c, enc/trans/utf_16_32.c, test/ruby/test_transcode.rb:
	  added UTF-32BE and UTF-32LE conversions.

Mon Jan 21 14:36:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (str_transcode): initialize transcoder in
	  rb_transcoding.  [ruby-dev:33234]

	* transcode_data.h (rb_transcoding): transcoder constified.

Mon Jan 21 12:50:02 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c, gc.c (setjmp): sigsetjmp is a macro on cygwin.

Mon Jan 21 12:35:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_loop, str_transcoding_resize): use unsigned
	  char.  [ruby-dev:33232]

	* transcode_data.h (rb_transcoding, rb_transcoder): removed callback
	  parameters.

	* enc/trans/japanese.c: ditto.

	* enc/trans/utf_16_32.c: parenthesized bit-or operands.

Mon Jan 21 11:59:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_each_char): move forward.  [ruby-dev:33231]

Mon Jan 21 06:40:03 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_dispatch): constified return value.

	* transcode_data.h (rb_transcoding): include pointer to rb_transcoder
	  and auxiliary data.

	* transcode_data.h (rb_transcoder): all callback functions should have
	  their own parameters.

	* enc/trans/{japanese,single_byte}.c: constified.

Mon Jan 21 03:45:49 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_each_char): advance offset before get next char
	  length.  [ruby-dev:33211]

Sun Jan 20 20:00:20 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c, enc/trans/utf_16_32.c, test/ruby/test_transcode.rb:
	  added UTF-16LE conversions.

	* fixed changelog for last commit

Sun Jan 20 17:54:00 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* added changelog for last commit

Sun Jan 20 15:08:08 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/trans/utf_16_32.c: new file, currently implementing
	  UTF-16BE conversions only.

	* test/ruby/test_transcode.rb: Added tests for UTF-16BE;
	  made check_both_ways() use force_encoding differently.

	* transcode_data.h, transcode.c: Support for more conversion
	  functions.

Sun Jan 20 13:06:01 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_each_char): performance improvement, and stop if
	  shortened in the block.  [ruby-dev:33189]

Sun Jan 20 09:12:26 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: use -Ks when read insns.def. [ruby-dev#33185]

	* parse.y: fix -e and stdin strings aren't set encoding.

Sun Jan 20 05:12:44 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/make_encdb.rb: fix duplication check.

Sun Jan 20 05:03:46 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ascii.c: remove definition of replica KOI8-U.

Sun Jan 20 00:33:59 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/koi8_u.c: added.

	* regenc.c, enc/utf_8.c, enc/unicode.c, enc/gb18030.c: add ARG_UNUSED.

Sat Jan 19 22:41:39 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (coderange_scan): don't call mbclen functions for ASCII
	  characters with ASCII compatible encoding.

Sat Jan 19 21:00:34 2008  Tanaka Akira  <akr@fsij.org>

	* lib/rdoc/template.rb (RDoc): defined to avoid uninitialized constant
	  error by `./ruby test/rubygems/test_gem_server.rb'.

Sat Jan 19 20:41:29 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (enc_new): don't free rb_encoding to avoid SEGV by
	  `miniruby -e exit' on x86_64 GNU/Linux.

Sat Jan 19 18:40:19 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (once): use an instance variable which points a hash
	  as cache. [experimental]

Sat Jan 19 17:21:29 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: parse's hints as an
	  experimental function has been removed.

Sat Jan 19 11:21:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (sigsetjmp): check if available.

	* eval.c, gc.c (setjmp): do not use _setjmp if sigsetjmp is available.

Sat Jan 19 11:10:11 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: Remove wrong assumptions about Cygwin.  a patch from
	  Corinna Vinschen in [ruby-Bugs-17018].

Sat Jan 19 09:23:14 2008  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_set_safe_array): should not use
	  recursive calling.

	* test/win32ole/test_win32ole_variant.rb: ditto.

Sat Jan 19 08:58:47 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup: Remove ListBase and Line constants.

	* lib/rdoc/ri: Allow output IO to be specified.

	* test/rdoc/parser/test_parse_c.rb: Move up one level, fixed.

	* test/rdoc/parser/test_rdoc_markup_attribute_manager.rb: Renamed to
	  match new class name, updated to match new classes.

	* test/rdoc/test_rdoc_ri_formatter.rb: Start of RI formatting tests.

	* test/rdoc/test_rdoc_ri_attribute_manager.rb: Start of
	  RDoc::RI::AttributeManager tests.

	* test/rdoc/test_simple_markup.rb: Moved to match new class name.

Sat Jan 19 08:35:36 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_prepare): get encoding from the first line.
	  [ruby-dev:33168]

	* ruby.c (load_file): set encoding to input with set_encoding.

Sat Jan 19 03:46:42 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (thread_create_core): prohibit thread creation in the
	  frozen thread group.  a patch in [ruby-dev:33176] from sheepman
	  <sheepman AT sheepman.sakura.ne.jp>.

	* thread.c (thread_create_core): should inherit ThreadGroup from
	  the current thread.

Sat Jan 19 00:37:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): set result encoding for wider width.

Sat Jan 19 00:13:19 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_wait_events): shouldn't invoke interrupt handle
	  by timer_thread.

Fri Jan 18 23:49:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_create_core): set thread group before creating
	  thread.

Fri Jan 18 20:19:51 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (ripper_initialize): too early to set parser->enc.

Fri Jan 18 20:03:05 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak (BASERUBY): nmake cannot execute ruby correctly
	  if the path of ruby.exe is quoted.

	* win32/setup.mak ($(ARCH)): if a macro is appended by $(APPEND),
	  a space will be inserted on the top of the line.

Fri Jan 18 17:56:09 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_intern.h, insnhelper.h, thread_pthread.h, vm_core.h, vm_opts.h:
	  prefixed include guards with RUBY.

	* id.h: added include guard.

	* regenc.h, regint.h, regparse.h: prefixed include guards with
	  ONIGURUMA.

Fri Jan 18 15:57:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_cleanup_func): ignore errors from destroying mutex
	  of dead thread.  [ruby-core:15069]

	* thread_pthread.c, thread_win32.c (native_thread_destroy): ditto.

Fri Jan 18 15:56:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_name_list_i, rb_enc_aliases_enc_i): freeze
	  element strings to be returned.

Fri Jan 18 14:36:34 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_m17n.rb (test_str_dump): added test for
	  String#dump. [ruby-dev:33142]

Fri Jan 18 12:25:13 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (load_encoding): check if successfully loaded.

	* encoding.c (rb_enc_find_index): use original encoding name to
	  replicate loaded encoding instead alias.

Fri Jan 18 09:43:02 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_char_to_option_kcode): Regexp switch `s' should mean
	  Windows-31J, as wells as `-Ks'.

Fri Jan 18 09:22:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_initialize): explicitly call rb_ascii8bit_encoding().

	* parse.y (parser_prepare): lex_input may not be have encoding (e.g. IO).

	* parse.y (rb_parser_compile_string): set encoding from input string.

	* encoding.c (rb_enc_find_index): use ASCII-8BIT if loading known
	  encoding failed.

	* parse.y (ripper_initialize): move parser->enc initialization.

	* encoding.c (rb_enc_aliases_enc_i): exclude non alias names from
	  Encoding.aliases.

	* encoding.c (rb_enc_find_index): use original encoding name to
	  load DLL.

Fri Jan 18 07:06:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (Init_IO): stdin/stdout may not be duplex.

Fri Jan 18 04:27:57 2008  Eric Hodel  <drbrain@segment7.net>

	* sample/rdoc/markup/rdoc2latex.rb:  Fix for new namespacing.

	* lib/rdoc/markup/to_latex.rb:  Fix namespacing.

Fri Jan 18 02:02:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/runner.rb (assert_valid_syntax): added.

	* bootstraptest/test_knownbug.rb: added test for [ruby-list:44479]

Fri Jan 18 01:48:06 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): check argument number to
	  attr_reader.  [ruby-core:15120]

Fri Jan 18 00:49:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_check_readable): flush tied write IO too.

	* io.c (Init_IO): tie stdin with stdout.  [ruby-core:15107]

Fri Jan 18 00:23:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_free): removed since rb_encoding may be used while
	  cleanup.

Fri Jan 18 00:17:19 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/euc_cn.c: split from enc/euc_kr.c.

Fri Jan 18 00:03:54 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_init): use default external encoding
	  if nothing is given.  a patch from sheepman <sheepman AT
	  sheepman.sakura.ne.jp> in [ruby-dev:33159].

Thu Jan 17 23:56:20 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (encdb.h): give output file name to make_encdb.rb.

	* encoding.c (enc_table): simplified.

	* encoding.c (enc_register_at): lazy loading.  [ruby-dev:33013]

	* regenc.h (ENC_DUMMY): added.

	* enc/make_encdb.rb: now emits macros only.

	* enc/iso_2022_jp.h: split from encoding.c.

Thu Jan 17 21:48:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_char_to_option_kcode): fixed typo.

Thu Jan 17 21:01:25 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (Date::Infinity#<=>): didn't work.  A patch from
	  Dirkjan Bussink <d.bussink AT gmail.com> [ruby-core:15098].
	  This is a bug obviously.  However it didn't affect the library's
	  functions.

	* lib/date.rb, lib/date/format.rb: some trivial changes.

Thu Jan 17 13:07:18 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_dump): preserve the encoding of source string
	  if it is ASCII compatible.  otherwise, add '.force_encoding()'
	  for ugly work around.  maybe we should implement some other way
	  to keep non ASCII encoding in dumped string.  [ruby-dev:33142]

Thu Jan 17 10:30:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_fwrite): always flush IO on tty, even without newlines.
	  [ruby-core:15107]

Wed Jan 16 22:45:27 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_register_at): make own copy.  [ruby-dev:33136]

Wed Jan 16 18:03:10 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open, rb_io_s_popen): clear temporary object to release
	  and prevent from GC.

Wed Jan 16 17:55:07 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (fix_quo): typo. a patch from Shin-ichiro HARA
	  <sinara AT blade.nagaokaut.ac.jp> in [ruby-dev:33130]

Wed Jan 16 17:36:26 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/test_delegate.rb: add new test file for delegate.rb.

Wed Jan 16 16:14:00 2008  Akinori MUSHA  <knu@iDaemons.org>

	* ruby.1: Fix grammar.

Wed Jan 16 15:26:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (sys_fail2): get rid of unlimited alloca.

	* io.c (mode_enc, pipe_open, rb_io_s_popen): ditto.

	* load.c (rb_feature_p): ditto.

	* object.c (rb_cstr_to_dbl): ditto.

	* io.c (mode_enc): fixed uninitialized variable.

Wed Jan 16 12:51:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_str_tmp_new, rb_str_shared_replace):
	  prototype moved.

Tue Jan 15 23:52:51 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/*: add ARG_UNUSED.

	* enc/koi8_u.c: added.

Tue Jan 15 23:00:08 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_{16,32}{be,le}.c: remove some ARG_UNUSED.  replace struct
	  OnigEncodingST by OnigEncoding.

Tue Jan 15 22:30:43 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (ENC_REGISTER): use &OnigEncoding*.
	  (ENCINDEX_UTF_8): renamed from ENCINDEX_UTF8.
	  (rb_enc_init): use ENC_REGISTER.

	* include/ruby/oniguruma.h (OnigEncodingUTF8, ONIG_ENCODING_UTF8):
	  removed.

	* enc/*.c: remove use of &encoding_*; use enc argument instead.

Tue Jan 15 18:44:46 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enc/utf_8.c: remove use of ONIG_ENCODING_UTF8 altogether; use
	  enc argument instead.

Tue Jan 15 18:05:26 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/utf_8.c (ONIG_ENCODING_UTF8): reverted.

Tue Jan 15 18:01:55 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (MKFILES): add dependencies.

Tue Jan 15 18:00:16 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enc/utf_8.c (OnigEncodingDefine): encoding name should be kept
	  unchanged.

Tue Jan 15 17:53:05 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/utf_8.c: renamed as IANA name.

	* enc/Makefile.in: ditto.

Tue Jan 15 16:59:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): encoding libraries cannot be loaded until
	  load path is set.

Tue Jan 15 15:09:28 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/setup.mak: strip out empty lines from CPP output.

Tue Jan 15 14:57:38 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {win,bcc}32/setup.mak (-basic-vars-): expand BASERUBY to full path
	  to get rid of ./ruby.exe.

	* win32/enc-setup.mak: workaround for Borland make.

Tue Jan 15 14:44:53 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_locale_charmap): use ASCII-8BIT in miniruby.

Tue Jan 15 13:54:41 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32}/Makefile.sub (RUNRUBY): need to set archdir when
	  invoking ruby.

Tue Jan 15 13:43:18 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (us_ascii.o): add dependencies. [ruby-dev:33111]

Tue Jan 15 03:41:42 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (eval): check if backtrace is empty.  [ruby-core:15040]

Tue Jan 15 01:28:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk: simplified dummy objects dependencies.

Tue Jan 15 01:19:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (OBJS): moved encoding.o from COMMONOBJS.

	* common.mk (dmyencoding.o): added.  [ruby-dev:33099]

	* configure.in, {win,bcc}32/Makefile.sub (MINIOBJS): added
	  dmyencoding.o.

	* dmyencoding.c (rb_locale_charmap): returns nil for miniruby.

Tue Jan 15 00:05:50 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (appendline): specifying limit should not generate broken
	  byte sequence.  strings should be rounded.  [ruby-dev:33088]

Mon Jan 14 23:33:02 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (Kconv.tolocale): argument is str.

Mon Jan 14 23:31:05 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in (setup): add -I$(EXTOUT)/$(arch) to MINIRUBY.

	* bootstraptest/runner.rb (main): expand -I directory path.

Mon Jan 14 23:28:10 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/enc-setup.mak (BUILTIN_ENCOBJS): depends on enc/Makefile.in.

Mon Jan 14 22:48:16 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_char_to_option_kcode): use rb_enc_find_index() instead
	  of using fixed index value.

	* enc/Makefile.in (encsrcdir): make US-ASCII built-in.

Mon Jan 14 22:25:02 2008  WATANABE Hirofumi  <eban@ruby-lang.org>

	* golf_prelude.rb: Shorter method name completion.  Same method
	  used for const missing. do_while and do_until added.  Enumerator
	  gains all of Array's abilities. Ex:
	    '123'.m{|i|i*2} #=> "112233"
	    '123'.pe #=> '123'.perm*' ' #=> "123 132 213 231 312 321"
	  base on a patch from Darren Smith <darrenks AT ml1.net>.

Mon Jan 14 21:10:02 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enc/us_ascii.c: wrong alias name: ANSI_X3.4-1986.

	* rubytest.rb: add -I#{srcdir} to load encoding DLL.

Mon Jan 14 18:53:58 2008  Koichi Sasada  <ko1@atdot.net>

	* thread.c: clear thread structure.
	  (TODO: survey that child process should clear mutex or not).

	* bootstraptest/test_knownbug.rb, test_thread.rb: move a fixed test.

Mon Jan 14 18:43:38 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/runner.rb: add "flunk" method.

	* bootstraptest/test_knownbug.rb: fix to use flunk.

Mon Jan 14 18:10:59 2008  Koichi Sasada  <ko1@atdot.net>

	* vm.h: remove dangerous assembler sentence.

Mon Jan 14 18:06:37 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_locale_encoding): return US-ASCII when charmap is
	  nil.

Mon Jan 14 16:12:58 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/shellwords.rb: scape should be an alias to shellescape.  a
	  patch from Masahiro Kawato <m-kawato AT mwb.biglobe.ne.jp> in
	  [ruby-dev:33060].

Mon Jan 14 16:09:16 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.1: a patch to describe --encoding.  a patch from Yugui
	  <yugui AT yugui.sakura.ne.jp> in [ruby-dev:33079].

	* ruby.c: ditto.

Mon Jan 14 13:49:26 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_prepare_re): initialize error message buffer.
	  (rb_reg_search): ditto.
	  (rb_reg_check_preprocess): ditto.
	  (rb_reg_new_str): ditto.
	  (rb_enc_reg_new): ditto.
	  (rb_reg_compile): ditto.
	  (rb_reg_initialize_m): ditto.
	  (rb_reg_s_union_m): ditto.

Mon Jan 14 12:33:07 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup*:  Renamespace from SM::SimpleMarkup to
	  RDoc::Markup.

Mon Jan 14 10:45:45 2008  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* enc/ascii.c: Exchanged order of arguments for one ENC_ALIAS

Mon Jan 14 09:19:07 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/time.rb: do not reference Time directly from the inside of
	  definitions. [ruby-dev:33059]

Mon Jan 14 05:44:44 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/*.c: add replicas and aliases.

	* enc/make_encdb.h: add duplicate and undefined check.

Mon Jan 14 02:03:05 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/oniguruma.h: remove ONIG_ENCODING_* and OnigEncoding*
	  which are not builtin.

	* regenc.{c,h} (onigenc_mb2_code_to_mbclen, onigenc_mb4_code_to_mbclen):
	  fix prototype.

	* enc/big5.c, enc/euc_kr.c, enc/euc_tw.c, enc/gb18030.c,
	  enc/koi8_r.c, enc/windows_1251.c: imported from Oniguruma.

Sun Jan 13 22:47:28 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/make_encdb.h: sort encoding names by original name.

	* encoding.c, enc/*.c: define replicas and aliases.

Sun Jan 13 20:24:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c: add documents.

Sun Jan 13 18:41:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (Init_Encoding): moved initialization from encdb.h.

	* enc/make_encdb.rb (enc_name_list): constified.

	* enc/make_encdb.rb (enc_init_db): moved some functions to encoding.c.

Sun Jan 13 13:53:00 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file): local variable was not initialized when -x flag
	  is given.

	* ruby.c (load_file): script files should not be affected by locale.
	  [ruby-dev:33054]

Sun Jan 13 12:01:32 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/generators*: Reorganize RDoc generators.

Sun Jan 13 11:41:11 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (ENCINDEX_EUC_JP, ENCINDEX_SJIS): removed.
	  (rb_enc_init): EUC-JP and Shift_JIS are not builtin now.

	* enc/Makefile.in: ditto.

	* common.mk: ditto.

	* ruby.c (proc_options): ditto.

	* enc/shift_jis.c, enc/euc_jp.c: fixes for remove from builtin.

Sun Jan 13 10:21:40 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_table): packed all enc_table stuff.

Sun Jan 13 09:58:17 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_init): revert removing SJIS.

	* enc/sjis.c: move to enc/shift_jis.c, to make encoding name equal to
	  filename for convenience of loading lib.

	* enc/shift_jis.c: moved from enc/sjis.c.

	* common.mk: follows enc/shift_jis.c.

	* enc/Makefile.in: ditto.

Sun Jan 13 09:22:33 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (incs): includes encdb.h.

Sun Jan 13 09:17:29 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {bcc,win}32/Makefile.sub (MV): use move instead of ren.  [ruby-Bugs-17019]

Sun Jan 13 01:52:31 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enc/make_encdb.rb: should work on Ruby 1.8.  [ruby-dev:33069]

	* common.mk (encdb.h): pass enc dir from outside to make_encdb.rb.

Sun Jan 13 00:01:07 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/make_encdb.rb: added. search enc/*.c and make encoding database.

	* regenc.h (ENC_REPLICATE, ENC_ALIAS): added for defining replica
	  encoding and encoding alias.

	* encoding.c (rb_enc_init): move alias definitions to enc/*.c.
	  (rb_enc_find_index): search original of replica and alias when no
	  encoding library.
	  (rb_enc_name_list, rb_enc_aliases_enc_i, rb_enc_aliases_str_i,
	   rb_enc_aliases, Encoding.name_list, Encoding.aliases): added.
	  (Init_Encoding): init encdb.

	* enc/ascii.c, enc/us_ascii.c, enc/euc_jp.c, enc/sjis.c:
	  add replica encoding and encoding alias definition.

	* common.mk (dist-clean-local): add rule for remove encdb.h.

Sat Jan 12 18:27:41 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_define_alloc_func, rb_undef_alloc_func): should
	  define/undef on a singleton class.  [ruby-core:09959]

Sat Jan 12 12:44:36 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf.c: rdoc update.

Sat Jan 12 12:01:49 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: tuning for performance.

Sat Jan 12 11:29:45 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/test_proc.rb: fixed wrong expected result.  pointed
	  out by Kornelius "murphy" Kalnbach <murphy AT rubychan.de> in
	  [ruby-core:15022].

Sat Jan 12 04:38:38 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ruby.c (process_options): -e'script' is locale encoding by default.
	  (load_file): ruby script from stdin is locale encoding by default.

Sat Jan 12 04:31:59 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: fix bug: -m was -m0.

Fri Jan 11 23:22:31 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (string.c): call rb_str_buf_append to update encoding of
	  str1, even if str2 is empty.

Fri Jan 11 20:20:16 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (proc_mark): needs to mark the receiver too.  a patch from
	  Chris Heath <chris AT heathens.co.nz> in [ruby-core:14983].
	  [ruby-core:14885]

Fri Jan 11 18:28:49 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/usage.rb: Removed.

	* lib/getoptlong.rb: Update example to not use lib/rdoc/usage.rb.

Fri Jan 11 18:17:10 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/ri/driver.rb (read_yaml): Follow namespace change
	  [ruby-core:14964].

Fri Jan 11 16:55:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_append): performance improvement.

Fri Jan 11 12:35:56 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: moved broken syscall checks from process.c etc.

	* defines.h (WORDS_BIGENDIAN): honor __BIG_ENDIAN__ than the result of
	  configure.

	* lib/rdoc/options.rb (check_diagram): more precise check, darwin
	  is not Windows but mingw is on it.

Fri Jan 11 09:59:05 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: update to r1.163.

	* ext/nkf/nkf.c: ASCII's canonical name is US-ASCII.

	* ext/nkf/lib/kconv.rb (Kconv.isjis): force_encoding('BINARY').

Fri Jan 11 09:23:31 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (set_base_encoding): must use rb_enc_dummy_p.

Fri Jan 11 06:13:14 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_to_encoding_index, rb_to_encoding): disallow nil.
	  [ruby-dev:33003]

Fri Jan 11 01:08:01 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread.c (rb_mutex_unlock): proper error message for unlocking
	  mutex that is not locked.  a patch from Yusuke ENDOH
	  <mame at tsg.ne.jp> in [ruby-dev:33010].

Thu Jan 10 18:00:41 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* prelude.rb (Mutex::synchronize): capture exception from unlock.
	  [ruby-dev:32935]

Thu Jan 10 10:15:03 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_encoding_set): IO.pipe("euc-jp", nil) should work as
	  IO.pipe("euc-jp", nil).  [ruby-dev:33000]

	* io.c (io_encoding_set): handle nil for v1.

Thu Jan 10 02:41:22 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_binmode): should not alter encoding.  [ruby-dev:32918]

	* io.c (io_read_encoding): need not to return ASCII-8BIT for
	  binary IO.

Wed Jan  9 22:04:17 2008  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/mathn.rb (Prime#each): returns an enumerator if no block
	  given. [ruby-dev:32815]

Wed Jan  9 22:03:26 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_replicate): replica of dummy is a dummy.

Wed Jan  9 20:55:38 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/e2mmap.rb (Exception2MessageMapper::Raise): define fail.
	  [ruby-dev:32854]

Wed Jan  9 20:35:42 2008  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httprequest.rb: support X-Forwarded-* header fields.
	  WEBrick::HTTPRequest#{host,port,request_uri} is derived having
	  regards to X-Forwarded-Proto and X-Forwarded-Host.

	* lib/webrick/httprequest.rb
	  (WEBrick::HTTPRequest#server_name?): new method.
	  (WEBrick::HTTPRequest#remote_ip?): new method.
	  (WEBrick::HTTPRequest#ssl?): new method.

Wed Jan  9 18:24:39 2008  WATANABE Hirofumi  <eban@ruby-lang.org>

	* golf_prelude.rb (Array#to_s): alias to join.

	* golf_prelude.rb (FalseClass#to_s): return "".

Wed Jan  9 16:59:54 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_enc_cr_str_buf_cat): fix self appending.

Wed Jan  9 15:54:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): give priority command line encoding option
	  to RUBYOPT, and enable -E option in RUBYOPT.

	* ruby.c (load_file): deal with encoding option in shebang line if
	  nothing in command line and RUBYOPT.

Wed Jan  9 14:55:36 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (yycompile0): remove setting parser->enc because it is set
	  in parser_prepare() by previous change of parser_prepare().

Wed Jan  9 14:52:18 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat, rb_str_buf_append): deal with self
	  appending.

Wed Jan  9 14:44:57 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (parser_prepare): set parser->enc from lex_input for ripper.

Wed Jan  9 13:45:52 2008  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/server.rb (WEBrick::HTTPServer#start):
	  :DoNotReverseLookup option had not been performed.

Wed Jan  9 13:03:34 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): do not recalculate coderange
	  value if it's given from outside.

Wed Jan  9 08:42:01 2008  James Edward Gray II  <jeg2@ruby-lang.org>

	* enum.c:  Updating the documentation of Enumerable#zip to reflect
	  the recent changes Matz made to the method.

Wed Jan  9 01:35:10 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/Makefile.in (BUILTIN_ENCS): UTF-{16,32}{BE,LE} are not builtin.

Tue Jan  8 23:55:15 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_init): UTF-{16,32}{BE,LE} are not builtin.

Tue Jan  8 22:33:03 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c, Makefile.in, include/ruby/oniguruma.h,
	  enc/Makefile.in: fix rules for UTF-{16,32}{BE,LE}.

Tue Jan  8 20:02:08 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win{32,ce}/Makefile.sub: merged.

Tue Jan  8 19:48:15 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/ri/driver.rb: Speed up Marshal.load. Fix bug with nested
	  classes' methods.

Tue Jan  8 19:17:29 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/*: Clean up namespacing of RI's classes.

Tue Jan  8 18:05:35 2008  Eric Hodel  <drbrain@segment7.net>

	* bin/ri, lib/rdoc/ri/*: Replace with Ryan Davis' cached ri.

Tue Jan  8 17:32:07 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_zip): honor length of the receiver, not the
	  shortest length.  [ruby-core:14738]

	* enum.c (enum_zip): returns array not enumerator for no block
	  form.  [ruby-core:14738]

	* enumerator.c (next_ii): do not ignore multiple values yielded.

	* array.c (rb_ary_zip): faster version without creating generators.

Tue Jan  8 15:47:43 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/utf{16,32}_{be,le}.c: use &OnigEncodingName(*) instead of
	  ONIG_ENCODING_*.

Tue Jan  8 15:40:31 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regenc.c (onigenc_strlen_null, onigenc_str_bytelen_null): suppressed
	  warnings.

	* regenc.h, enc/unicode.c (onigenc_unicode_ctype_code_range): added
	  encoding argument.

	* enc/utf{16,32}_{be,le}.c: added init functions.

	* enc/utf{16,32}_{be,le}.c: imported from Oniguruma 5.9.1.

Tue Jan  8 15:03:10 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (str_gsub): avoid appending empty pre-match substr.

Tue Jan  8 13:05:57 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_build_from_ary), iseq.c (iseq_load): fix for format change.

Tue Jan  8 07:56:11 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_buf_append): fix append itself.

Tue Jan  8 01:13:50 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (STR_ENC_GET): defined.  same as rb_enc_get without
	  enc_capable.
	  (coderange_scan): ASCII-8BIT test refined.
	  (rb_enc_cr_str_buf_cat): new internal function to accumulate
	  strings with encoding.
	  (rb_enc_str_buf_cat): use rb_enc_cr_str_buf_cat.
	  (rb_str_buf_append): ditto
	  (str_gsub): use rb_str_buf_append.
	  (rb_str_hash): use ENCODING_GET.
	  (rb_str_comparable): ditto.
	  (rb_str_cmp): compare encoding index, not rb_encoding address.

Mon Jan  7 20:37:55 2008  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservlet/cgihandler.rb: external encoding of
	  tempfiles is set to "ASCII-8BIT".

Mon Jan  7 19:39:50 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/template.rb:  Use ERB instead of custom template language.

	* lib/rdoc/generators/template/html/old_html.rb:  Remove.

	* lib/rdoc/generators/template/*: Convert to ERB.

Mon Jan  7 19:11:30 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (Init_String): sym_match arity spec was wrong.  a patch
	  from Hiroyuki Iwatsuki <don at na.rim.or.jp> in [ruby-dev:32957].

Mon Jan  7 18:10:33 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (str_gsub): move rb_enc_get(str) to out of loop.

Mon Jan  7 15:52:10 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h (OnigEncodingType): new member
	  ruby_encoding_index to avoid linear search in rb_enc_to_index.

	* include/ruby/encoding.h (rb_enc_to_index): macro defined to use
	  ruby_encoding_index.

	* encoding.c (rb_enc_to_index): removed.
	  (enc_register_at): initialize ruby_encoding_index member.

Mon Jan  7 16:10:35 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/tokenstream.rb:  Namespace under RDoc.

Mon Jan  7 16:06:09 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/dot.rb:  Namespace under RDoc.

	* lib/rdoc/diagram.rb:  Clean up formatting.

Mon Jan  7 15:51:35 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/options.rb:  Convert to OptionParser, clean up -h output,
	  namespace under RDoc.
	* lib/rdoc/*:  Namespace RDoc::Options.

Mon Jan  7 15:42:46 2008  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk, Makefile.in, */Makefile.sub (distclean-local): move
	  removing rule of ext/ripper/y.output from common.mk to Makefiles
	  that depend on platforms.

Mon Jan  7 13:54:57 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_preprocess): fix fixed_enc condition.

Mon Jan  7 11:51:49 2008  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/generators/ri_generator.rb:  Merge documentation from the
	  same class on output.  Fixes bug where documentation could
	  disappear.

	* lib/rdoc/options.rb:  Fix typo.

	* lib/rdoc/generators/*: Clean up some namespacing and make RDoc
	  consistent.

Mon Jan  7 11:44:45 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_internal_get_index): extracted from
	  rb_enc_get_index.
	  (rb_enc_internal_set_index): extracted from rb_enc_associate_index

	* include/ruby/encoding.h (ENCODING_SET): work over ENCODING_INLINE_MAX.
	  (ENCODING_GET): ditto.
	  (ENCODING_IS_ASCII8BIT): defined.
	  (ENCODING_CODERANGE_SET): defined.

	* re.c (rb_reg_fixed_encoding_p): use ENCODING_IS_ASCII8BIT.

	* string.c (rb_enc_str_buf_cat): use ENCODING_IS_ASCII8BIT.

	* parse.y (reg_fragment_setenc_gen): use ENCODING_IS_ASCII8BIT.

	* marshal.c (has_ivars): use ENCODING_IS_ASCII8BIT.

Mon Jan  7 02:14:07 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (coderange_scan): avoid rb_enc_to_index.
	  (rb_enc_str_buf_cat): ditto.
	  (str_cat_char): use rb_enc_str_buf_cat.
	  (rb_str_inspect): ditto.

Mon Jan  7 01:36:49 2008  Tanaka Akira  <akr@fsij.org>

	* string.c (coderange_scan): optimize ASCII-8BIT string.
	  (rb_enc_str_buf_cat): don't call coderange_scan if possible.

Mon Jan  7 01:05:45 2008  Tanaka Akira  <akr@fsij.org>

	* lib/erb.rb (ERB::Revision): cut off locale dependent string in Date
	  keyword.

Mon Jan  7 00:48:02 2008  Tanaka Akira  <akr@fsij.org>

	* Date keyword removed to avoid inclusion of locale dependent
	  string.  [ruby-dev:32940]

Sun Jan  6 21:14:12 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_initialize_str): forbid raw non ASCII character
	  for ASCII-8BIT regexp in non ASCII-8BIT script.

Sun Jan  6 18:19:12 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_enc_str_buf_cat): declared.

	* string.c (coderange_scan): extracted from rb_enc_str_coderange.
	  (rb_enc_str_coderange): use coderange_scan.
	  (rb_str_shared_replace): copy encoding and coderange.
	  (rb_enc_str_buf_cat): new function for linear complexity string
	  accumulation with encoding.
	  (rb_str_sub_bang): don't conflict substituted part and replacement.
	  (str_gsub): use rb_enc_str_buf_cat.
	  (rb_str_clear): clear coderange.

	* re.c (rb_reg_regsub): use rb_enc_str_buf_cat.

Sun Jan  6 17:55:44 2008  Technorama Ltd.  <oss-ruby@technorama.net>

	* lib/securerandom.rb: Add Win32 support.

Sun Jan  6 09:32:58 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: introduced some constants
	  (for internal use) and aliases (minute and second).

	* sample/cal.rb: trivial adjustments.

Sun Jan  6 01:38:07 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_initialize_str): /\x80/n is not an error even if script
	  encoding is EUC-JP.

Sun Jan  6 00:48:12 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/resolv.rb (Resolv::DNS#each_address): get A record and then AAAA
	  record. [ruby-dev:32925]

Sat Jan  5 21:48:03 2008  Tanaka Akira  <akr@fsij.org>

	* vm_insnhelper.c (vm_callee_setup_arg): it is not inlinable because
	  alloca is used.

Sat Jan  5 16:50:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_resize): copy if old data is not empty
	  [ruby-core:14785]

Sat Jan  5 13:04:24 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): no need for intermediate object.

Sat Jan  5 11:48:19 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (Init_Encoding): alias csWindows31J to Windows-31J.
	  IE6 accepts csWindows31J but Windows-31J.

Sat Jan  5 02:21:10 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (rb_intern): memorize interned ID for constant
	  string, using gcc's __builtin_constant_p and statement expression.

Sat Jan  5 02:14:45 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (trnext): should enable backslash escape.

Sat Jan  5 01:50:32 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_eval): move instance_eval and instance_exec to
	  BasicObject.  [ruby-core:14747]

	* lib/delegate.rb: should preserve new methods in BasicObject.

Sat Jan  5 01:46:29 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (proc_options): update according to the last API revert.

Sat Jan  5 01:30:30 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h, re.c (rb_reg_new): keep interface same as
	  1.8.  [ruby-core:14583]

	* include/ruby/intern.h, re.c (rb_reg_new_str): renamed, and defines
	  HAVE_RB_REG_NEW_STR macro to tell if it is available.

	* include/ruby/encoding.h (rb_enc_reg_new): added.

	* insns.def (toregexp), marshal.c (r_object0): use rb_reg_new_str().

	* re.c (rb_reg_regcomp, rb_reg_s_union): ditto.

Fri Jan  4 23:08:48 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_arg): use converted object.  [ruby-core:14759]

Fri Jan  4 16:24:58 2008  Tanaka Akira  <akr@fsij.org>

	* ext/digest/lib/digest/hmac.rb (Digest::HMAC#initialize): use
	  String#bytesize to avoid test errors on EUC-JP environment.

Fri Jan  4 14:00:50 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_prepare_re): check string encoding.  Oniguruma doesn't
	  support invalid encoding.

Fri Jan  4 10:22:25 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_search): avoid inner loop for reverse search.

	* regexec.c: unset USE_MATCH_RANGE_MUST_BE_INSIDE_OF_SPECIFIED_RANGE
	  which is turned on since oniguruma 5.9.1.

Fri Jan  4 02:53:31 2008  Tanaka Akira  <akr@fsij.org>

	* enc/euc_jp.c: remove eucjp_ prefix.  breakpoint can be specified as
	  euc_jp.c:mbc_enc_len.  avoid needless conflict by merge.

	* enc/sjis.c: remove sjis_ prefix.

	* enc/utf8.c: remove utf8_ prefix.

	* enc/iso_8859_1.c: remove iso_8859_1_ prefix.

	* enc/iso_8859_2.c: remove iso_8859_2_ prefix.

	* enc/iso_8859_3.c: remove iso_8859_3_ prefix.

	* enc/iso_8859_4.c: remove iso_8859_4_ prefix.

	* enc/iso_8859_5.c: remove iso_8859_5_ prefix.

	* enc/iso_8859_6.c: remove iso_8859_6_ prefix.

	* enc/iso_8859_7.c: remove iso_8859_7_ prefix.

	* enc/iso_8859_8.c: remove iso_8859_8_ prefix.

	* enc/iso_8859_9.c: remove iso_8859_9_ prefix.

	* enc/iso_8859_10.c: remove iso_8859_10_ prefix.

	* enc/iso_8859_11.c: remove iso_8859_11_ prefix.

	* enc/iso_8859_13.c: remove iso_8859_13_ prefix.

	* enc/iso_8859_14.c: remove iso_8859_14_ prefix.

	* enc/iso_8859_15.c: remove iso_8859_15_ prefix.

	* enc/iso_8859_16.c: remove iso_8859_16_ prefix.

Fri Jan  4 02:47:06 2008  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_search): iterate onig_match for reverse mode.

Fri Jan  4 01:20:21 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32.h: only VC6 needs extern "C++" for math.h.  [ruby-talk:285660]

Fri Jan  4 00:54:43 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/oniguruma.h: Oniguruma 5.9.1 merged.

Fri Jan  4 00:20:47 2008  Tanaka Akira  <akr@fsij.org>

	* io.c (io_ungetc): move data in buffer if it is required to store the
	  argument.

Thu Jan  3 21:56:07 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (st_strcasecmp): declared for STRCASECMP.
	  (st_strncasecmp): declared for STRNCASECMP.

Thu Jan  3 20:24:48 2008  Koichi Sasada  <ko1@atdot.net>

	* eval_jump.c (rb_f_catch): Restore cfp if caught thrown object.

Thu Jan  3 19:45:57 2008  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_eval.rb, test_knownbug.rb: move a fixed test.

Thu Jan  3 18:39:12 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c: (rb_tolower, rb_toupper): body was exchanged.

Thu Jan  3 17:54:01 2008  Tanaka Akira  <akr@fsij.org>

	* regenc.h (onigenc_ascii_is_code_ctype): put back.

Thu Jan  3 17:33:09 2008  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_isalnum): defined.
	  (rb_isalpha): ditto.
	  (rb_isblank): ditto.
	  (rb_iscntrl): ditto.
	  (rb_isdigit): ditto.
	  (rb_isgraph): ditto.
	  (rb_islower): ditto.
	  (rb_isprint): ditto.
	  (rb_ispunct): ditto.
	  (rb_isspace): ditto.
	  (rb_isupper): ditto.
	  (rb_isxdigit): ditto.
	  (rb_tolower): ditto.
	  (rb_toupper): ditto.

	* include/ruby/ruby.h: don't include include/ruby/encoding.h.
	  (rb_isascii): defined.
	  (rb_isalnum): declared.
	  (rb_isalpha): ditto.
	  (rb_isblank): ditto.
	  (rb_iscntrl): ditto.
	  (rb_isdigit): ditto.
	  (rb_isgraph): ditto.
	  (rb_islower): ditto.
	  (rb_isprint): ditto.
	  (rb_ispunct): ditto.
	  (rb_isspace): ditto.
	  (rb_isupper): ditto.
	  (rb_isxdigit): ditto.
	  (rb_tolower): ditto.
	  (rb_toupper): ditto.
	  (ISASCII): simplified.
	  (ISPRINT): ditto.
	  (ISSPACE): ditto.
	  (ISUPPER): ditto.
	  (ISLOWER): ditto.
	  (ISALNUM): ditto.
	  (ISALPHA): ditto.
	  (ISDIGIT): ditto.
	  (ISXDIGIT): ditto.
	  (TOUPPER): ditto.
	  (TOLOWER): ditto.

	* include/ruby/encoding.h (rb_isascii): removed.
	  (rb_isalnum): ditto.
	  (rb_isalpha): ditto.
	  (rb_isblank): ditto.
	  (rb_iscntrl): ditto.
	  (rb_isdigit): ditto.
	  (rb_isgraph): ditto.
	  (rb_islower): ditto.
	  (rb_isprint): ditto.
	  (rb_ispunct): ditto.
	  (rb_isspace): ditto.
	  (rb_isupper): ditto.
	  (rb_isxdigit): ditto.
	  (rb_tolower): ditto.
	  (rb_toupper): ditto.

	* common.mk: dependency updated.

Thu Jan  3 15:10:26 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_isascii): simplified.
	  (rb_isalnum): call onigenc_ascii_is_code_ctype without indirect call.
	  (rb_isalpha): ditto.
	  (rb_isblank): ditto.
	  (rb_iscntrl): ditto.
	  (rb_isdigit): ditto.
	  (rb_isgraph): ditto.
	  (rb_islower): ditto.
	  (rb_isprint): ditto.
	  (rb_ispunct): ditto.
	  (rb_isspace): ditto.
	  (rb_isupper): ditto.
	  (rb_isxdigit): ditto.

	* include/ruby/oniguruma.h (onigenc_ascii_is_code_ctype): declaration
	  moved from regenc.h.

Thu Jan  3 14:37:17 2008  Tanaka Akira  <akr@fsij.org>

	* parse.y (parser_magic_comment): use STRNCASECMP.
	  (set_file_encoding): ditto.

Thu Jan  3 11:44:37 2008  Tanaka Akira  <akr@fsij.org>

	* time.c: don't mention an obsolete library, ParseDate.

Thu Jan  3 11:28:58 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fptr_finalize): clear errno first.  [ruby-talk:284492]

Thu Jan  3 05:02:36 2008  Tanaka Akira  <akr@fsij.org>

	* enc/us_ascii.c: add us_ascii_ prefix for functions to ease
	  setting breakpoint when debugging.

	* enc/euc_jp.c: add eucjp_ prefix.

	* enc/sjis.c: add sjis_ prefix.

	* enc/iso_8859_1.c: add iso_8859_1_ prefix.

	* enc/iso_8859_2.c: add iso_8859_2_ prefix.

	* enc/iso_8859_3.c: add iso_8859_3_ prefix.

	* enc/iso_8859_4.c: add iso_8859_4_ prefix.

	* enc/iso_8859_5.c: add iso_8859_5_ prefix.

	* enc/iso_8859_6.c: add iso_8859_6_ prefix.

	* enc/iso_8859_7.c: add iso_8859_7_ prefix.

Thu Jan  3 02:44:34 2008  Tanaka Akira  <akr@fsij.org>

	* bignum.c (conv_digit): use ISDIGIT, ISLOWER and ISUPPER.

Wed Jan  2 23:50:15 2008  Tanaka Akira  <akr@fsij.org>

	* util.c (ruby_strtoul): "0x", "+" and "-" is not a valid integer.
	  end of integer should be just after "0", the beginning, the
	  beginning respectively.

Wed Jan  2 15:23:15 2008  Tanaka Akira  <akr@fsij.org>

	* util.c (ruby_strtoul): locale independent strtoul is implemented to
	  avoid "i".to_i(36) cause 0 under tr_TR locale on Debian GNU/Linux
	  4.0 (Etch).
	  This is newly implemented, not a copy of missing/strtoul.c.

	* include/ruby/ruby.h (ruby_strtoul): declared.
	  (STRTOUL): defined to use ruby_strtoul.

	* bignum.c, pack.c, ext/socket/socket.c: use STRTOUL.

	* configure.in (strtoul): don't check.

	* missing/strtoul.c: removed.

	* include/ruby/missing.h (strtoul): removed.

	* common.mk (strtoul.o): removed.

	* LEGAL (missing/strtoul.c): removed.

Wed Jan  2 14:41:08 2008  Tanaka Akira  <akr@fsij.org>

	* common.mk (strcasecmp.o): removed.
	  (strncasecmp.o): removed.

	* include/ruby/missing.h (strcasecmp): removed.
	  (strncasecmp): removed.

Wed Jan  2 11:34:57 2008  Tanaka Akira  <akr@fsij.org>

	* missing/strcasecmp.c: removed.  Ruby don't use locale dependent
	  strcasecmp.

	* missing/strncasecmp.c: ditto.

	* configure.in: don't check strcasecmp and strncasecmp.

	* LEGAL: missing/strcasecmp.c and missing/strncasecmp.c removed.

Wed Jan  2 10:13:54 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* sample/time.rb: use Process.times instead of Time.times.

Wed Jan  2 09:09:53 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* sample/goodfriday.rb: examples for date are enough.  retired.

Wed Jan  2 08:58:54 2008  Tadayoshi Funaba  <tadf@dotrb.org>

	* sample/cal.rb: just updated with the newest version.

Wed Jan  2 01:19:31 2008  Tanaka Akira  <akr@fsij.org>

	* enc/depend: dependency updated.

Wed Jan  2 00:14:41 2008  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/{nkf.c, utf8tbl.c}: Update nkf.

	* ext/nkf/nkf.c: fix documents.

	* ext/nkf/lib/kconv.rb: fix documents.
	  (Kconv.is*): use valid_encoding?.
	  (Kconv.isjis): defined.

Tue Jan  1 23:17:03 2008  Tanaka Akira  <akr@fsij.org>

	* common.mk: dependency updated.

Tue Jan  1 21:11:33 2008  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_isascii): defined.
	  (rb_isalnum): ditto.
	  (rb_isalpha): ditto.
	  (rb_isblank): ditto.
	  (rb_iscntrl): ditto.
	  (rb_isdigit): ditto.
	  (rb_isgraph): ditto.
	  (rb_islower): ditto.
	  (rb_isprint): ditto.
	  (rb_ispunct): ditto.
	  (rb_isspace): ditto.
	  (rb_isupper): ditto.
	  (rb_isxdigit): ditto.
	  (rb_tolower): ditto.
	  (rb_toupper): ditto.

	* include/ruby/st.h (st_strcasecmp): declared.
	  (st_strncasecmp): ditto.

	* st.c (type_strcasehash): use st_strcasecmp instead of strcasecmp.
	  (st_strcasecmp): defined.
	  (st_strncasecmp): ditto.

	* include/ruby/ruby.h: include include/ruby/encoding.h.
	  (ISASCII): use rb_isascii.
	  (ISPRINT): use rb_isprint.
	  (ISSPACE): use rb_isspace.
	  (ISUPPER): use rb_isupper.
	  (ISLOWER): use rb_islower.
	  (ISALNUM): use rb_isalnum.
	  (ISALPHA): use rb_isalpha.
	  (ISDIGIT): use rb_isdigit.
	  (ISXDIGIT): use rb_isxdigit.
	  (TOUPPER): defined.
	  (TOLOWER): ditto.
	  (STRCASECMP): ditto.
	  (STRNCASECMP): ditto.

	* dir.c, encoding.c, file.c, hash.c, process.c, ruby.c, time.c,
	  transcode.c, ext/readline/readline.c: use locale insensitive
	  functions.  [ruby-core:14662]

Tue Jan  1 17:50:47 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_mode_enc): encoding spec is not allowed in binary mode.
	  [ruby-dev:32913]

Tue Jan  1 14:41:56 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml: 1.9 patch from Sam Ruby mentioned in his blog:
	  <http://intertwingly.net/blog/2007/12/31/Porting-REXML-to-Ruby-1-9>
	  [ruby-core:14639]

Tue Jan  1 14:15:04 2008  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_substr): offset movement bug.  a patch from
	  Vincent Isambart <vincent.isambart at gmail.com> in
	  [ruby-core:14647].  [ruby-core:14644]

Tue Jan  1 01:29:04 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_to_encoding): raises for non-nil, non-encoding,
	  non-string object.  [ruby-core:14634]

Tue Jan  1 01:04:06 2008  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): rejects dummy encoding.

Mon Dec 31 23:53:55 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options, process_options): delays finding encoding
	  until load_path is set.

Mon Dec 31 23:27:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_resize): embeds if ptr is null.  [ruby-dev:32819]

Mon Dec 31 23:17:22 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpproxy.rb (WEBrick::HTTPProxyServer#proxy_service):
	  call do_XXX which correspond with request method.
	  (WEBrick::HTTPProxyServer#do_CONNECT,do_GET,do_POST,do_HEAD): added.

	* test/webrick/test_httpproxy.rb: add test for WEBrick::HTTPProxyServer.

Mon Dec 31 22:53:29 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* thread_pthread.c (native_sleep): timespec tv_sec may overflow on
	  some platform.  a patch from zunda <zunda616e AT yahoo.co.jp> in
	  [ruby-dev:32904].

Mon Dec 31 19:35:20 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (IS_7BIT): removed.
	  (single_byte_optimizable): new function to test optimizationability
	  using single byte string.
	  (str_strlen): use single_byte_optimizable instead of
	  is_ascii_string.
	  (str_nth): rename argument: asc -> singlebyte.
	  (str_offset): ditto.
	  (rb_str_substr): use single_byte_optimizable instead of IS_7BIT.
	  (rb_str_index): ditto.
	  (rb_str_rindex): ditto.
	  (rb_str_splice): ditto.
	  (rb_str_justify): ditto.

Mon Dec 31 07:39:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* main.c, goruby.c (RUBY_MAIN_INIT): removed.

	* goruby.c (goruby_run_node): run after ruby_init_loadpath() so that
	  require works, and protect the call.

Mon Dec 31 06:50:38 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk: not use -I$(srcdir)/lib with $(MINIRUBY) for cross
	  compiling.

	* configure.in, {win,bcc}32/Makefile.sub (MINIRUBY): -I$(srcdir)/lib
	  moved.

Mon Dec 31 06:08:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_sprintf, rb_enc_vsprintf): prototyped.

	* sprintf.c (rb_enc_sprintf, rb_enc_vsprintf): new functions to format
	  arguments with encoding.

Sun Dec 30 23:48:00 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* golf_prelude.rb (String#/): define / as split, as association of
	  Array#*.

Sun Dec 30 23:19:06 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* golf_prelude.rb (@@golf_hash): for performance improvement.

Sun Dec 30 22:44:50 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (_valid_time?): I'm not sure to recommend such an
	  expression.  but anyway it is acceptable now.  [ruby-core:14580]

Sun Dec 30 21:54:26 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (program, yycompile0): too early to drop lex_lastline in
	  rules.

Sun Dec 30 19:23:23 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bootstraptest/test_knownbug.rb: support DOSISH.

Sun Dec 30 17:43:54 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (Init_Encoding): registered rb_encoding differs from
	  ONIG_ENCODINGs.

Sun Dec 30 13:56:15 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (program): clear input strings after all process.

	* parse.y (parser_nextc, parser_yylex): should not drop lex_lastline
	  while lex_p is valid.  [ruby-dev:32896]

Sun Dec 30 10:54:49 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: rm largefile.h.

	* common.mk: clean golf, conf*, preludes, and so on.

	* enc/depend: silent and ignore error for rm.

	* enc/Makefile.in: should define prefix and exec_prefix.

Sun Dec 30 06:31:11 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* encoding.c (Init_encoding): register Windows-31J and its alias.
	  [ruby-dev:32843]

	* ruby.c (proc_options): -Ks options means Windows-31J, not Shift_JIS.

Sun Dec 30 06:27:38 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (depend_rules): need to convert `/' to `\' for windows
	  native commands.

Sun Dec 30 01:43:56 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/Makefile.in (DLDFLAGS): like as extensions.  [ruby-core:14567]

Sat Dec 29 23:48:13 2007  Tanaka Akira  <akr@fsij.org>

	* io.c (io_fflush): don't retry when wbuf modified by other threads.

Sat Dec 29 22:44:30 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_regsub): returns the given string itself if nothing
	  changed.

	* string.c (rb_str_sub_bang): keeps code-range as possible.

	* string.c (str_gsub): adjusts code-range.  [ruby-core:14566]

Sat Dec 29 21:54:37 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (clean, distclean, realclean): should include clean-enc
	  and others.  [ruby-dev:32887]

Sat Dec 29 13:29:29 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/test_knownbug.rb: add a test reported by
	  Kazuhiro NISHIYAMA.  [ruby-dev:32819].
	  add a test reported by Frederick Cheung.  [ruby-core:14556].

	* test/ruby/test_m17n.rb (test_gsub): add a test reported by
	  Sam Ruby.  [ruby-core:14566]

Sat Dec 29 04:46:58 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert_throws):
	  throw won't raise NameError nor ThreadError but ArgumentError on 1.9.
	  (Test::Unit::Assertions#assert_not_throws): ditto.

	* test/testunit/test_assertions.rb: add assertions for throwing some
	  objects other than Symbol.

Sat Dec 29 03:10:12 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_unread): fix typo.

Sat Dec 29 02:18:45 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_unread): adhoc workaround for non-binary mode of some DOSish
	  platforms. this is not perfect and safety, but works with most cases.

Fri Dec 28 23:53:18 2007  Tanaka Akira  <akr@fsij.org>

	* ext/strscan/strscan.c (str_new): new function for allocate an string
	  with encoding propagation.
	  (extract_range): use str_new.
	  (extract_beg_len): ditto.
	  (strscan_peek): ditto.
	  (strscan_rest): ditto.

Fri Dec 28 20:18:42 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* golf_prelude.rb (Object.say): derived from Perl 5.10.

Fri Dec 28 19:39:34 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* encoding.c (rb_locale_encoding): should check return value from
	  rb_locale_charmap().

	* ruby.c (locale_encoding): removed.

	* ruby.c (process_options): use rb_locale_encoding() instead of
	  locale_encoding().

	* ext/readline/readline.c (readline_readline): use locale encoding
	  instead of input IO's encoding. [ruby-dev:32872]

Fri Dec 28 19:29:07 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/readline/readline.c (readline_readline, readline_s_set_input):
	  use mReadline directly because self is not always same.

Fri Dec 28 19:11:28 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_locale_encoding): defined.

	* include/ruby/encoding.h (rb_locale_encoding): declared.

Fri Dec 28 18:45:29 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/readline/readline.c (readline_readline): set encoding to result.

	* ext/readline/readline.c (readline_s_set_input, Init_readline): save
	  input IO to hidden instance variable.

Fri Dec 28 01:55:04 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c (transcode_dispatch): reverted some of the changes
	  in r14746.

	* transcode.c, enc/trans/single_byte.c: Added conversions to/from
	  US-ASCII and ASCII-8BIT (using data tables).

	* enc/trans/single_byte.c: Some spacing/ordering changes due to
	  automatic data file generation.

	* transcode_data.h, transcode.c: Preliminary code for using
	  micro-conversion functions.

	* test/ruby/test_transcode.rb: Added some tests for US-ASCII and
	  ASCII-8BIT conversions.

Fri Dec 28 17:33:44 2007  Tanaka Akira  <akr@fsij.org>

	* time.c (make_time_t): verify mktime and timegm result.

Fri Dec 28 16:36:33 2007  NARUSE, Yui  <naruse@airemix.com>

	* lib/resolv.rb (Resolv::DNS#each_address): now returns IPv6 address.

Fri Dec 28 16:10:00 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/dot/dot.rb: Move to lib/rdoc/dot.rb. Fix namespacing.

	* lib/rdoc/diagram.rb: Update for 1.9.

Fri Dec 28 15:38:29 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup/sample/: Move to sample/rdoc/markup directory.

Fri Dec 28 15:15:12 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/irb/completion.rb: Remove garbage ("X=1").

Fri Dec 28 15:12:05 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc, test/rdoc: Move RDoc tests out of lib/.

Fri Dec 28 15:10:47 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (set_base_encoding, enc_base_encoding): renamed
	  based_encoding as base_encoding.

Fri Dec 28 13:57:49 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* golf_prelude.rb (Integer#each): use alias simply.

Fri Dec 28 13:45:21 2007  Akinori MUSHA  <knu@iDaemons.org>

	* golf_prelude.rb (Object.const_missing): No need to delegate to
	  superclass.  Just raise a NameError when none matches.

Fri Dec 28 13:18:47 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb, test/rss/test_version.rb: 0.2.2 -> 0.2.3.

	* lib/rss/parser.rb, test/rss/test_parser.rb: supported "-" in tag name.
	  Reported by Ray Chen. Thanks.

Fri Dec 28 13:07:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (os_obj_of): returns an enumerator if no block given.  based on
	  a patch from Yugui <yugui AT yugui.sakura.ne.jp>.  [ruby-dev:32828]

Fri Dec 28 11:46:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/ytab.sed: skip yydestruct hack unless yymsg exists, for bison
	  1.8 series.  [ruby-dev:32825]

Fri Dec 28 11:39:02 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* golf_prelude.rb (Object.quine): need to join because SCRIPT_LINES__[]
	  returns an array of lines.

Fri Dec 28 11:16:53 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* golf_prelude.rb (Object.quine): get the script itself.

Fri Dec 28 10:06:54 2007  Akinori MUSHA  <knu@iDaemons.org>

	* golf_prelude.rb (Object.const_missing): Auto-complete constants.

Fri Dec 28 01:55:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_dispatch): allows transcoding from/to
	  ASCII-8BIT.

Fri Dec 28 01:47:25 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* golf_prelude.rb (Integer): Integer is now enumerable on goruby.

Fri Dec 28 01:27:47 2007  Tanaka Akira  <akr@fsij.org>

	* lib/rdoc/rdoc.rb (parse_files): don't depend on the default external
	  encoding.

Fri Dec 28 00:01:57 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (golf_prelude.c): use MINIRUBY instead of BASERUBY because
	  tool/compile_prelude.rb requires rbconfig.rb.

Thu Dec 27 23:56:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: should not use the libraries under the source directory
	  at cross compiling.

Thu Dec 27 23:43:35 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (EXTOBJS): uses ruby.rc always for other than
	  rubyw.exe.

Thu Dec 27 22:31:37 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rubygems/commands/update_command.rb (do_rubygems_update): use
	  portable and safely ENV operation. reported in
	  <http://slashdot.jp/developers/comments.pl?sid=384937&cid=1273085>.

Thu Dec 27 21:47:04 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* mkconfig.rb (prefix): archdir is "1.9.0", not "1.9". reported in
	  <http://slashdot.jp/developers/comments.pl?sid=384937&cid=1273085>.

Thu Dec 27 17:57:30 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y, transcode_data.h, transcode.c, lib/weakref.rb,
	  lib/irb/ruby-lex.rb, lib/irb/lc/error.rb, enc/trans/japanese.c:
	  change "illegal" to "invalid" in a context which doesn't against
	  a law.

Thu Dec 27 16:37:06 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_s_union): show encodings in error message.

Thu Dec 27 15:25:16 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_codelen): show codepoint in error message.

	* include/ruby/encoding.h (rb_enc_codelen): comment it returns
	  positive integer.

	* string.c (rb_str_concat): rb_enc_codelen doesn't return 0.

Thu Dec 27 15:18:44 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_codelen): error message refined.

Thu Dec 27 15:11:27 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_check): show encodings in error message.

Thu Dec 27 15:02:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_casecmp): fixed using a wrong variable.
	  [ruby-list:44402]

Thu Dec 27 14:34:38 2007  Tanaka Akira  <akr@fsij.org>

	* io.c (io_fflush): checks wbuf modification by other threads.
	  not perfect.  it need locks.

Thu Dec 27 10:44:03 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c: a patch to support IRIX from Andrew
	  Thompson <andrew@hijacked.us> in [ruby-core:14447].

Thu Dec 27 02:25:45 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_tmpsrc): retry to create file if Errno::EACCES
	  occurs. this is a workaround for mswin32.

Wed Dec 26 22:47:31 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* lib/resolv.rb (Resolv::DNS::Name.==): fix for other is array of
	  Resolv::DNS::Label::Str.

	* lib/resolv.rb (Resolv::DNS::MessageEncoder#put_label): String#string
	  is not defined, so replace to_s.

	* lib/resolv.rb (Resolv::IPv6#to_name): ip6.int is obsoleted by
	  ip6.arpa.

Wed Dec 26 21:27:02 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (_xmlschema): some improvements.

	* lib/date/format.rb (_parse): a new hint compfunc. [experimental]

Wed Dec 26 17:31:08 2007  Tanaka Akira  <akr@fsij.org>

	* io.c (io_fflush): check closed fptr after rb_write_internal to avoid
	  SEGV on MacOS X.

Wed Dec 26 16:10:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (Init_String): defines chars method.

Wed Dec 26 14:38:43 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* instruby.rb: install goruby if exists.

Wed Dec 26 13:55:02 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb:  Cleaned up some code with Ruby 1.9 idioms.

Wed Dec 26 13:29:35 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (tmpbuf): use rb_str_tmp_new().

Wed Dec 26 00:57:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/ext/generator/generator.c (Init_generator): requires
	  json/common.rb for GeneratorError, when static linked.  a patch from
	  Kenta Murata <muraken AT gmail.com> in [ruby-dev:32789].

Tue Dec 25 23:33:55 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* development version 1.9.0 released.

Tue Dec 25 23:25:29 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/node.rb (REXML::Node::indent): should initialize rv
	  variable.  a patch from Tadayoshi Funaba <tadf AT dotrb.org> in
	  [ruby-dev:32783].

Tue Dec 25 23:16:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): encoding option in shebang and RUBYOPT did not
	  work, do not store alloca()ed string in a parent scope struct.

Tue Dec 25 22:56:52 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.status): keep this file.

Tue Dec 25 22:55:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (TIMEZONE_VOID): typo.

Tue Dec 25 22:45:10 2007  Koichi Sasada  <ko1@atdot.net>

	* insns2vm.rb: add encoding option to shebang.

Tue Dec 25 22:13:51 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/pending.rb: add pending issue.

Tue Dec 25 22:12:40 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c: remove Thread.critical(=).

Tue Dec 25 21:44:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: add version number.

Tue Dec 25 21:32:54 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix stack consistency error
	  (break is compiled to throw instead of jump insn).
	  these problems are reported by Yusuke ENDOH <mame AT tsg.ne.jp>

	* bootstraptest/test_knownbug.rb, test_syntax.rb: move fixed test.

Tue Dec 25 21:32:44 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y (struct parser_params): make parser_ruby_sourcefile common
	  field.  it is used by node_newnode.
	  new field parser_ruby_sourcefile_string for ripper.
	  (parser_initialize): initialize parser_ruby_sourcefile in ripper.
	  (ripper_initialize): initialize parser_ruby_sourcefile_string.

Tue Dec 25 21:26:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (parse.c): depends on tool/ytab.sed.

	* tool/ytab.sed: hack for bison 2.1.

Tue Dec 25 20:24:58 2007  Technorama Ltd.  <oss-ruby@technorama.net>

	* ext/openssl/ossl_ssl.c: Only show a warning if the default
	  DH callback is actually used.

	* ext/openssl/ossl_rand.c: New method: random_add().

Tue Dec 25 20:24:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/make-snapshot: argument check, and cleanup exported directory.

Tue Dec 25 20:07:13 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* tool/make-snapshot: more portable.

Tue Dec 25 19:01:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.h (rb_enc_mbc_to_codepoint): wrapper for
	  ONIGENC_MBC_TO_CODE().

	* string.c (rb_str_succ): deal with invalid sequence as binary.

Tue Dec 25 18:40:46 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c: all methods need $SAFE < 1.

	 vm.c: comment out debug functions.

Tue Dec 25 18:37:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (appendline): move RS comparison to rb_io_getline_1().

Tue Dec 25 18:27:51 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_each_line): don't call rb_enc_codepoint with empty
	  string.

Tue Dec 25 18:06:04 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_inspect): don't call rb_enc_codepoint with empty
	  string.  fix '#'.inspect.

	* encoding.c (rb_enc_codepoint): raise on empty string.

Tue Dec 25 17:48:28 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* vm.c (rb_frame_method_id_and_class): new function to get the
	  method id and class of the current frame.

Tue Dec 25 17:32:04 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/mkmf.rb (create_makefile): Add a missing dependency on the
	  target directory for each .rb file.  This will hopefully fix
	  parallel make (-jN).  Tested on FreeBSD.

Tue Dec 25 16:51:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/japanese.c (rb_{from,to}_{SHIFT_JIS,EUC_JP}): inversed
	  from_encoding and to_encoding.

Tue Dec 25 16:41:57 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* golf_prelude.rb (h): add new method for all golfers.

Tue Dec 25 16:37:12 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/japanese.c (rb_to_EUC_JP): fixed typo.

Tue Dec 25 16:34:58 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/depend: add dependencies. [ruby-dev:32760]

Tue Dec 25 16:26:48 2007  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h, thread.c: rename is_ruby_native_thread() to
	  ruby_native_thread_p().

	* ext/tk/tcltklib.c: apply it.

Tue Dec 25 16:15:15 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (clean-enc): clean encoding objects.

Tue Dec 25 16:04:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk, goruby.c, golf_prelude.rb: for golfers.

	* main.c (main): hook for embedding applications.

	* tool/compile_prelude.rb: can change initialize function name.

Tue Dec 25 15:59:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_register): do not use based_encoding to check if
	  dummy encoding.

Tue Dec 25 15:55:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_succ): fix for string with non-alphanumeric chars.

Tue Dec 25 15:42:49 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_external_encoding): should return nil for
	  pass-through write IO.  [ruby-dev:32740]

Tue Dec 25 15:24:57 2007  Tanaka Akira  <akr@fsij.org>

	* io.c (appendline): initialize rslen to 1 if rsptr is 0.
	  rslen is the length of the delimiter.
	  if only delim is given, it should be 1.
	  [ruby-dev:32746]

Tue Dec 25 15:21:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_dispatch): fix for multistep transcode.

Tue Dec 25 15:07:51 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/trans/single_byte.c (Init_single_byte): renamed.

Tue Dec 25 15:00:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_yield): when multiple values yielded from #each
	  pack them into an array.  [ruby-dev:32708]

	* enum.c: all method but all?, any?, one? and none? passed packed
	  multiple values to the block.

	* enum.c (collect_all): should pack all values.  [ruby-core:14410]

Tue Dec 25 14:57:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (COMMONOBJS): transcode_data_*.c moved under enc/trans.

	* transcode_data.h (rb_transcoding, rb_transcoder): prefixed.

	* transcode.c (rb_register_transcoder, rb_declare_transcoder): split
	  declaration and registration.  [ruby-dev:32704]

	* transcode.c (transcode_dispatch): autoload pre-declared transcoder.

	* transcode.c (str_transcode): use rb_define_dummy_encoding().

	* transcode.c (Init_transcode): initialize transcoder tables.

	* enc/trans/single_byte.c, enc/trans/japanese.c: moved from top.

Tue Dec 25 14:20:13 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mkmf.rb (map_dir): should generate path including $top_srcdir.

Tue Dec 25 14:09:16 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb:  Fixed test failures caused by changes to Ruby.

	* test/csv/tc_serialization, test/csv/tc_csv_parsing, test/csv/tc_features:
	  Fixed test failures caused by changes to Ruby.

Tue Dec 25 14:11:57 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_encoding_set): missing return type.

Tue Dec 25 14:03:48 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* test/rinda/test_rinda.rb (MockClock#{_forward, forward, sleep}):
	  Change default value of n as @reso from nil.  If default value is
	  nil, n.+ is not defined.

Tue Dec 25 13:54:01 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io_m17n.rb (test_pipe): fixed.
	  [ruby-dev:32743]

Tue Dec 25 13:44:51 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_wait_fd_rw): should check EBADF on select().

Tue Dec 25 13:30:03 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c, thread_pthread.h, thread_win32.c,
	  thread_win32.c: make some functions static functions.
	  a patch from Tadashi Saito <shiba AT mail2.accsnet.ne.jp>
	  in [ruby-core:14407]

Tue Dec 25 13:23:13 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io_m17n.rb (test_write_noenc): don't mix text and
	  binary mode.  [ruby-dev:32743]

Tue Dec 25 13:13:09 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* README.EXT.ja, dir.c, eval.c, eval_intern.h, lex.c.src,
	  lex.c.blt, keywords, load.c, thread.c: more ANSI'ize.
	  a patch from Tadashi Saito <shiba AT mail2.accsnet.ne.jp>
	  in [ruby-dev:32725]

Tue Dec 25 13:07:56 2007  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h, thread.c, cont.c: add RUBY_VM_SET_INTERRUPT(),
	  RUBY_VM_SET_TIMER_INTERRUPT(), RUBY_VM_INTERRUPTED().

	* thread.c, thread_pthread.c, thread_win32.c: fix to ignore time slice
	  event until sleep.

	* bootstraptest/test_thread.rb: add a test for time limited join test.

Tue Dec 25 12:42:59 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (Init_VM): remove unused code.
	  [ruby-dev:32732]

Tue Dec 25 12:32:32 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c: Moving a static counter from inside register_transcoder()
	  and register_functional_transcoder() to outside the functions, renaming
	  from n to next_transcoder_position. Fixes 3) in [ruby-dev:32715].

Tue Dec 25 12:22:17 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* sample/from.rb: follow Ruby 1.9 libraries.

Tue Dec 25 12:21:56 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (method_inspect): preserve encoding of the method name.

Tue Dec 25 12:07:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (BASERUBY): delayed error until BASERUBY is used.

Tue Dec 25 11:48:35 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/README: removed obsoleted files: dbmtest.rb,
	  getopts.test, mrshtest.rb, regx.rb.

Tue Dec 25 11:45:34 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb:  Import the FasterCSV source as the new CSV class.

	* test/csv/*:  Added all applicable tests from FasterCSV.

Tue Dec 25 11:33:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (report_bug): uses ruby_description.

Tue Dec 25 11:20:38 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix stack consistency error.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>  [ruby-dev:32720]

	* bootstraptest/test_syntax.rb: add 2 tests for above.

Tue Dec 25 11:14:20 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c, vm_core.h: comment out unused fields.

Tue Dec 25 11:02:10 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c: check frame is FINAL when creating env.
	  [ruby-core:14395]

	* bootstraptest/test_block.rb: add a test for above.

Tue Dec 25 09:12:13 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/:  Enable RDoc debugging only with $DEBUG_RDOC.

Tue Dec 25 08:37:43 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb, test/csv/test_csv.rb:  Removed in preparation for
	  FasterCSV code import.

Tue Dec 25 08:27:43 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems.rb:  Fix test failures.

	* test/rubygems/test_gem.rb:  Fix test failure.

Tue Dec 25 06:23:40 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb, test_literal.rb: move fixed test.

Tue Dec 25 06:19:04 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* sample/biorhythm.rb: follow Ruby 1.9 libraries.

Tue Dec 25 06:15:01 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c: add dummy toplevel frame.

Tue Dec 25 05:44:56 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Fix uninitialized variable warning.
	  [ruby-talk:284582]

	* lib/irb/output-method.rb:  Remove unused #foo method.
	  [ruby-talk:284582]

Tue Dec 25 05:24:12 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile): clear local table if node == 0.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>  [ruby-dev:32530]

	* vm.c: clear VM stack.

Tue Dec 25 04:23:32 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y (rb_id2str): fill klass of returned string as rb_cString.
	  some strings are allocated before rb_cString is created.
	  This prevents a "called on terminated object" error by
	  ObjectSpace.each_object(Module) {|m| p m.name }.

Tue Dec 25 03:51:55 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix stack consistency bug.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>

Tue Dec 25 03:19:47 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* tool/make-snapshot: must create configure and lex.c.

Tue Dec 25 03:16:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_s_pipe): now takes up to two arguments.  allow its
	  external/internal encoding by Encoding objects.

	* io.c (rb_io_set_encoding): new method to set encoding of the IO.

	* io.c (argf_set_encoding): ditto.

Tue Dec 25 03:08:53 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* pack.c (pack_pack): use NUM2LONG instead of NUM2INT.

	* numeric.c (fix_lshift, fix_aref): use SIZEOF_LONG instead of
	  SIZEOF_VALUE.

	* bignum.c (big2ulong, rb_big_aref): ditto.

Tue Dec 25 02:55:26 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/rexml/element.rb (REXML::Elements#each): yield in each
	  should be called with one parameter. [ruby-dev:32708]

Tue Dec 25 02:15:39 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): add a "pop" insn after break
	  to fix stack consistency error.  [ruby-core:14385]

	* bootstraptest/test_syntax.rb: add tests for above.

	* bootstraptest/test_knownbug.rb: remove fixed bug.

Tue Dec 25 01:54:36 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* id.c (Init_id): remove several unused symbols. [ruby-core:14362]

	* compile.c (iseq_specialized_instruction): do not use
	  VM_CALL_SEND_BANG flag any longer.

Tue Dec 25 01:42:41 2007  Tanaka Akira  <akr@fsij.org>

	* lib/rdoc/rdoc.rb (parse_files): interpret coding cookie.

Tue Dec 25 01:38:04 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (method_name): preserve Symbol's encoding.

	* numeric.c (fix_id2name): ditto.

Tue Dec 25 01:19:18 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_left_char_head): new utility macro.

	* include/ruby/encoding.h (rb_enc_right_char_head): ditto.

	* io.c (appendline): does multibyte RS search in the function.

	* io.c (prepare_getline_args): RS may be nil.

	* io.c (rb_io_getc): should process character based on external
	  encoding, when transcoding required.

Tue Dec 25 01:07:57 2007  Tanaka Akira  <akr@fsij.org>

	* lib/irb/output-method.rb: translate a comment to English to
	  avoid mix of EUC-JP comment and UTF-8 Date keyword.
	  svn substitute Date keyword with UTF-8 weekday on UTF-8 locale.

Tue Dec 25 00:27:28 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservley/cgihandler.rb
	  (WEBrick::HTTPServlet::CGIHandler#do_GET): m17nized.

Mon Dec 24 23:55:29 2007  Tanaka Akira  <akr@fsij.org>

	* lib/cgi.rb (CGI::escape): m17nized.
	  (CGI::unescape): ditto.
	  (CGI::escapeHTML): ditto.
	  (CGI::unescapeHTML): ditto.

Mon Dec 24 23:32:24 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* transcode_data_japanese.c (select_iso_2022_mode): '\e' is not valid.

Mon Dec 24 23:13:09 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/rdoc/diagram.rb (RDoc::Diagram#initialize): use fileuitls
	  instead of ftools.

Mon Dec 24 23:04:57 2007  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/ftools.rb: removed obsoleted lib.  use fileutils instead (by eban).

	* lib/rdoc/rdoc.rb, lib/rdoc/generators/*, lib/rake.rb: let it use
	  fileutils instead of ftools.

	* lib/shell/command-processor.rb: removed unused references to ftools.

	* lib/parsedate.rb: removed.  see [ruby-core:12535], [ruby-dev:31969].

	* lib/README: updated.

Mon Dec 24 23:01:04 2007  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI::Buffer): use Meta ===.  [ruby-core:14295]

Mon Dec 24 22:46:42 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* transcode.c: register_functional_transcoder() added.
	  (init_transcoder_table(: register ISO-2022-JP.
	  (str_transcode): add preprocessor and postprocessor.

	* transcode_data_japanese.c: add ISO-2022-JP support.

	* transcode_data.h: moved transcoder and transcoding definition from
	  transcode.c.

Mon Dec 24 20:29:28 2007  Koichi Sasada  <ko1@atdot.net>

	* test/io/nonblock/test_flush.rb: fix test for 1.9.

Mon Dec 24 20:23:44 2007  Koichi Sasada  <ko1@atdot.net>

	* test/rinda/test_rinda.rb: revert last commit because this test seems
	  to have timing problem to halt all tests.

Mon Dec 24 20:18:52 2007  Koichi Sasada  <ko1@atdot.net>

	* test/rinda/test_rinda.rb: enable rinda test.

Mon Dec 24 20:16:54 2007  Koichi Sasada  <ko1@atdot.net>

	* instruby.rb: fix rdoc install dir.

Mon Dec 24 18:37:32 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_prepare_re): show regexp encoding in the error message.

Mon Dec 24 18:23:32 2007  Tanaka Akira  <akr@fsij.org>

	* eval.c (rb_exc_raise): ANSI style.
	  (rb_exc_fatal): ditto.
	  (rb_raise_jump): ditto.
	  (rb_jump_tag): ditto.
	  (rb_block_given_p): ditto.

	* variable.c (original_module): ditto.

Mon Dec 24 18:05:09 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (Init_ISeq): disable ISeq.load() because there is no verifier.

	* iseq.c, proc.c: add ISeq.disasm(method).

Mon Dec 24 18:06:03 2007  Tanaka Akira  <akr@fsij.org>

	* eval_method.c (Init_eval_method): extracted from Init_eval
	  for rdoc to find rb_mod_remove_method, rb_mod_undef_method and
	  rb_mod_alias_method.

	* eval.c (Init_eval): call Init_eval_method.

Mon Dec 24 17:59:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_lock): reverted.

	* thread.c (rb_barrier_wait): check for recursive wait.

Mon Dec 24 17:50:54 2007  Tanaka Akira  <akr@fsij.org>

	* eval.c (function_call_may_return_twice_jmp_buf): removed.
	  (function_call_may_return_twice_false): removed.
	  [ruby-core:14335]

Mon Dec 24 17:40:57 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (node_name.inc, miniprelude.c, prelude.c): nmake cannot
	  handle target vpath in other than implicit rules.

Mon Dec 24 17:20:34 2007  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/{mailread.rb,getopts.rb,parsearg.rb}: removed.
	  see [ruby-core:12535], [ruby-dev:31969].

Mon Dec 24 17:12:57 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h, random.c, array.c:
	  change exported name.
	  genrand_int32 -> rb_genrand_int32.
	  genrand_real -> rb_genrand_real.
	  [ruby-core:14335]

Mon Dec 24 17:06:37 2007  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* {lib,test}/{soap,wsdl,xsd}: removed soap4r along to the discussion
	  at ruby-core and ruby-dev.  see [ruby-core:12535], [ruby-dev:31969].

Mon Dec 24 17:06:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_feature_p): returns loading path name too.

	* load.c (search_required): returns path too if feature is being
	  loaded.  [ruby-dev:32048]  [TODO: refactoring]

Mon Dec 24 16:29:12 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* sample/openssl: reviewed and remove dependency on getopts.rb.

Mon Dec 24 16:18:57 2007  Koichi Sasada  <ko1@atdot.net>

	* mkconfig.rb: add teeny to CONFIG['ruby_version'].

Mon Dec 24 15:55:50 2007  Koichi Sasada  <ko1@atdot.net>

	* tool/compile.rb, getrev.rb, runruby.rb: remove unused tools.

Mon Dec 24 15:42:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, cygwin/GNUmakefile.in, */Makefile.sub,
	  djgpp/config.hin.: version dependent directory names now contain
	  teeny.

Mon Dec 24 15:29:13 2007  Tanaka Akira  <akr@fsij.org>

	* tool/serb.rb: removed.

Mon Dec 24 13:55:35 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (rb_proc_new), vm.c (invoke_block): removed u3.state magic.
	  [ruby-core:14310]

	* test/ruby/test_symbol.rb (test_to_proc): a test from Frederick
	  Cheung <frederick.cheung AT gmail.com>.

Mon Dec 24 13:43:36 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_atfork): should not leave living_threads
	  referring freed table while allocating new table.

Mon Dec 24 12:49:54 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, configure.in, lib/mkmf.rb, */Makefile.sub: specify
	  compiled output file name explicitly.

	* enc/Makefile.in, enc/depend: now makes compiler to put generated
	  files under directories corresponding to the each source.
	  enc/trans supported.

	* enc/make_encmake.rb: evaluates depend file before Makefile.in so
	  that the former can influence to CONFIG.

Mon Dec 24 12:35:03 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win{32,ce}/Makefile.sub (MFLAGS): defaulted to -l.

Mon Dec 24 12:08:10 2007  Eric Hodel  <drbrain@segment7.net>

	* /, ext/:  Add svn:ignore for OS X Xcode 3's conftest.dSYM
	  directories.

Mon Dec 24 11:56:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk: should not pass MAKEFLAGS to recursive make.
	  + normal make: MFLAGS are set and command line options and macros
	    are all passed silently.
	  + GNU make: ditto, and all options and macros in MAKEFLAGS are in
	    effect.
	  + nmake: MFLAGS is not set and MAKEFLAGS has only options without
	    hyphen, no macros exist in any variables.
	  + Borland make: ditto, and command line macros cannot override
	    macros in makefile, so passing them is vain.

	* {bcc32,win{32,ce}}/Makefile.sub (SET_MAKE): set MFLAGS which is not
	  set by default, to get rid of chaotic situation of MFLAGS/MAKEFLAGS.

Mon Dec 24 11:32:44 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_comparable): fixed to keep transitivity.
	  [ruby-dev:32693]

Mon Dec 24 11:20:31 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/ri/ri_options.rb:  Fix display of GEMDIRS, make command
	  examples match ri's name.

	* lib/rdoc/ri/ri_paths.rb:  Only allow latest ri dirs in ri output.

Mon Dec 24 10:49:04 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/uri/mailto.rb, lib/uri/common.rb:  Fix Regexp warnings.  Patch
	  #16524 from Kornelius Kalnbach, [ruby-core:14302].

Mon Dec 24 10:37:38 2007  Eric Hodel  <drbrain@segment7.net>

	* gem_prelude.rb:  Remove methods from Gem, not QuickLoader, to fix
	  warnings.

Mon Dec 24 09:45:45 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c, transcode_data_one_byte.c, transcode_data_japanese.c:
	  added rb_ prefix to external data symbols.

Mon Dec 24 05:32:22 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_inject): updated documentation.  a patch from Keita
	  Yamaguchi <keita.yamaguchi AT gmail.com> in [ruby-dev:32686].

	* README.EXT: updated.  a patch from Tadashi Saito
	  <shiba AT mail2.accsnet.ne.jp> in [ruby-core:14328].

	* array.c (rb_ary_at): updated documentation. a patch from Tadashi
	  Saito <shiba AT mail2.accsnet.ne.jp> in [ruby-core:14330].

Mon Dec 24 05:13:04 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (tr_trans): should associate new encoding if modified.

Mon Dec 24 04:04:12 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/net/http/test_https.rb: should rescue LoadError.

Mon Dec 24 03:57:28 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c, vm.h: fix to support sparc machine.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>

Mon Dec 24 03:35:19 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: remove additional "-".

Mon Dec 24 02:59:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_check_readable): should not fill fptr->enc always.
	  read-write IO (e.g. socket) does not work.  [ruby-dev:32685]

	* io.c (io_read_encoding): retrieve reading encoding.

	* io.c (prepare_getline_args): convert RS to external encoding.

	* string.c (str_new_shared): was setting embedding flag of wrong
	  string object.  [ruby-dev:32685]

	* io.c (io_enc_str): should preserve default_external encoding.

	* io.c (appendline): should do multibyte aware RS search.

Mon Dec 24 02:06:35 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_open): documentation update.

	* io.c (rb_io_s_pipe): ditto.

	* io.c (io_fwrite): wrong encoding destination.

	* io.c (rb_io_external_encoding): should return the encoding of
	  the file reading.

	* io.c (rb_io_internal_encoding): should return the encoding of
	  read string.

Mon Dec 24 01:46:43 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_s_pipe): allow specifying read-side encoding.

	* io.c (io_enc_str): wrong encoding destination.

Mon Dec 24 01:03:17 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_comparable): comparison including broken
	  coderange strings do not consider encoding.

Mon Dec 24 00:57:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (open_key_args): IO direct methods (foreach, readlines,
	  read) now takes keyword argument: encoding, mode, open_args.

Mon Dec 24 00:52:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_s_read): encoding argument reverted.

	* io.c (mode_enc): independent function to share code.

	* io.c (rb_io_internal_encoding): new method.

Mon Dec 24 00:47:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_beginendblock.rb (TestBeginEndBlock::test_endblockwarn):
	  rename endblockwarn.rb to endblockwarn_rb to avoid unnecessary
	  warning in make test.

Sun Dec 23 23:03:13 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_codepoint): implemented to raise invalid
	  encoding.

	* include/ruby/encoding.h (rb_enc_codepoint): macro is replaced as a
	  declaration.

Sun Dec 23 19:45:22 2007  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time.httpdate): fix 2 digits year for 20xx.
	  reported by Tadayoshi Funaba.  [ruby-dev:32687]

Sun Dec 23 19:33:42 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/open-uri.rb:  Fix method redefined warning.  [ruby-core:14304]

Sun Dec 23 18:31:49 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* ext/nkf/nkf.c (rb_nkf_enc_get): use rb_define_dummy_encoding.

	* ext/nkf/nkf.c (Init_nkf): use rb_nkf_enc_get("ASCII").

	* ext/nkf/nkf-utf8/nkf.c: Update 1.161.

	* ext/nkf/nkf-utf9/config.h: default output encoding is now UTF-8.

	* ext/nkf/lib/kconv.rb (Kconv.kconv): replace Encoding#name by
	  Encoding#to_s.

Sun Dec 23 18:02:52 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/gem_open_uri.rb:  Fix version check.

Sun Dec 23 17:24:48 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_init): add eucJP as an alias of EUC-JP.

Sun Dec 23 17:00:23 2007  Tanaka Akira  <akr@fsij.org>

	* lib/time.rb (Time.httpdate): use Time.utc for
	  "day-of-week, dd-mon-yy HH::MM:SS GMT" format.

Sun Dec 23 16:12:40 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Fix 1.9 warnings.

Sun Dec 23 15:28:37 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems, test/rubygems:  Fix new 1.9 warnings.

Sun Dec 23 14:43:10 2007  Eric Hodel  <drbrain@segment7.net>

	* gem_prelude.rb:  Use require to load rubygems.rb so the correct path
	  is in $LOADED_FEATURES on RubyGems upgrade.

Sun Dec 23 11:26:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_call): use exact argument array interface.
	  [ruby-core:14279]

Sun Dec 23 11:01:35 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_binmode_m): removed C99ism.

Sun Dec 23 10:23:23 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode_data_one_byte.c: Better (and more honest) optimization.

	* transcode_data_japanese.c: First optimization step.

Sun Dec 23 09:07:02 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h, encoding.c, re.c, io.c, parse.y, numeric.c,
	  ruby.c, transcode.c, ext/nkf/nkf.c: rename rb_ascii_encoding to
	  rb_ascii8bit_encoding.  rb_ascii_encoding is ambiguous with
	  ASCII-8BIT and US-ASCII.

Sun Dec 23 03:35:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* version.h: use patchlevel if revision is not set.

	* {bcc32,win{32,ce}}/setup.mak (-version-): skip including revision.h.

	* common.mk (srcs): new target to generated sources.

	* common.mk (encs, ext/ripper/ripper.c): MAKEFLAGS needs -.

	* enc/depend, enc/make_encmake.rb: use erb.

Sun Dec 23 01:56:18 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_mode_enc): do not set encoding unless explicitly
	  specified.

	* io.c (rb_io_check_readable): fill fptr->enc by default_external
	  if it's empty.

	* io.c (io_enc_str): fptr->enc is always set for reading IO (by
	  rb_io_check_readable(fptr)).

Sun Dec 23 01:18:06 2007  David Flanagan  <david@davidflanagan.com>

	* io.c, io.h: temporary patch to partially implement
	  transcode-on-read and transcode-on-write

Sun Dec 23 00:48:05 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* test/net/imap/test_imap.rb: added tests for SSL.

Sat Dec 22 21:10:53 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/rubyext.c (syck_genericresolver_node_import): should
	  not set instance variable "@kind" before initializing it.
	  [ruby-dev:32677]

Sat Dec 22 19:52:23 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_objectspace.rb: fix condition.

Sat Dec 22 19:17:10 2007  Koichi Sasada  <ko1@atdot.net>

	* ext/probeprofiler/: removed.

Sat Dec 22 19:14:38 2007  Koichi Sasada  <ko1@atdot.net>

	* process.c (rb_f_fork): Unsupport Kernel.fork() on NetBSD.

Sat Dec 22 18:20:13 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (version.o): add dependency. [ruby-dev:32680]

Sat Dec 22 17:45:11 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* ext/nkf/nkf.c (Init_nkf): use rb_ascii_encoding() for
	  rb_nkf_enc_get("US-ASCII").
	  * if use rb_nkf_enc_get("US-ASCII"), ruby will crash - this is bug?

Sat Dec 22 17:39:03 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb ($extmk): fixed broken condition.

Sat Dec 22 17:35:59 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8.c: Update nkf.c rev:1.157.

	* ext/nkf/nkf.c (rb_nkf_enc_get): replicate proper based encoding.

	* ext/nkf/kconv.c (Kconv#kconv, to*): use self.encoding as from_enc
	  when from_enc isn't given.

Sat Dec 22 17:06:50 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/net/ssl.rb (OpenSSL::SSL::SSLContext.build): removed.

	* ext/openssl/lib/net/ssl.rb (OpenSSL::SSL::SSLContext#set_params):
	  new method to set suitable SSL parameters.

	* lib/net/pop.rb, lib/net/http.rb, lib/net/imap.rb,
	  test/openssl/test_ssl.rb: follow above change.

	* test/net/http/test_https.rb: refine error case.

Sat Dec 22 16:58:49 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (encode_utf7): accept UTF-8 strings.

	* lib/net/imap.rb (decode_utf7): return UTF-8 strings.

Sat Dec 22 15:56:36 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* transcode_data_japanese: typo.

Sat Dec 22 15:54:54 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* ChangeLog: Information for last patch got lost, fixed

	* test/ruby/test_transcode.rb: Added simple tests for
	  EUC-JP and Shift_JIS and tests for ASCII-only range

Sat Dec 22 15:45:45 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode_data_one_byte: slightly optimized

	* transcode_data_japanese: new data file for EUC-JP and SHIFT_JIS
	  (not yet optimized; tests to follow; data from
	  http://nkf.sourceforge.jp/ucm/{SJIS|eucJP}-nkf.ucm)

	* common.mk, transcode.c: Adjusted for transcode_data_japanese

Sat Dec 22 15:30:13 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* */Makefile.sub (MFLAGS): define unless defined.

Sat Dec 22 15:17:40 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb ($extmk): set true only when under ext/ or tool/.

Sat Dec 22 15:14:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (encs, ext/ripper/ripper.c): needs MFLAGS.

	* configure.in (STRINGIZE): stringizing macro.

	* include/ruby/defines.h (STRINGIZE): fallback.

	* tool/make-snapshot: new file.

	* version.c (ruby_description, ruby_copyright): string constants for
	  -v option.

Sat Dec 22 15:03:37 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (initialize): fixed documentation.

Sat Dec 22 15:01:16 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/pop.rb (enable_ssl): use OpenSSL::SSL::SSLContext.build
	  instead of SSLContext.new (default verify mode is now
	  OpenSSL::SSL::VERIFY_PEER).

Sat Dec 22 14:45:21 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: shouldn't freeze nil. [ruby-dev:32677]

Sat Dec 22 14:27:27 2007  Tanaka Akira  <akr@fsij.org>

	* regenc.c (onigenc_ascii_is_code_ctype): moved from enc/ascii.c.

	* regenc.h (onigenc_ascii_is_code_ctype): declared.

	* enc/ascii.c: use onigenc_ascii_is_code_ctype.

	* enc/us_ascii.c: new file for US-ASCII.

Sat Dec 22 14:30:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (reg_named_capture_assign_iter): allows non-ascii names and
	  get rid of reserved word IDs.

Sat Dec 22 14:18:45 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_float.rb, test_sprintf.rb: fix test place.

Sat Dec 22 14:17:02 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_objectspace.rb: skip frozen string.

Sat Dec 22 14:02:58 2007  Koichi Sasada  <ko1@atdot.net>

	* array.c (rb_ary_permutation): add volatile to avoid GC problem.

Sat Dec 22 11:47:42 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_obj_instance_eval): use class of immediate objects.

	* test/ruby/test_eval.rb: fix a test.

Sat Dec 22 11:37:06 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* encoding.c (rb_locale_charmap): win32 support.

Sat Dec 22 11:31:14 2007  Eric Hodel  <drbrain@segment7.net>

	* gem_prelude.rb:  Place bin dir before lib dir so gem bin stubs work.

Sat Dec 22 11:05:44 2007  Jim Weirich  <jim@tardis.local>

	* lib/rake.rb (Rake): Added Rake and related libraries to the
	  source code base.

Sat Dec 22 10:30:45 2007  Koichi Sasada  <ko1@atdot.net>

	* tool/insns2vm.rb: moved from lib/vm/instruction.rb.

Sat Dec 22 10:25:44 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (reg_named_capture_assign_iter): captured name should
	  not be reserved word.  a patch from Keita Yamaguchi
	  <keita.yamaguchi AT gmail.com> in [ruby-dev:32675].

	* parse.y (reg_named_capture_assign_iter): just ignore the
	  captures that do not have valid local variable name.

Sat Dec 22 10:19:08 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_method_name): now __method__ and __callee__ are
	  aliases.  [ruby-core:14244]

Sat Dec 22 08:29:56 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_buf_append): improvement for non-broken coded
	  strings.

Sat Dec 22 06:30:04 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_fork.rb: skip if fork is not unsupported.

	* bootstraptest/test_io.rb: skip if require failed.

Sat Dec 22 06:09:12 2007  David Flanagan  <david@davidflanagan.com>

	* io.c: fix typo in rdoc comment

Sat Dec 22 05:09:43 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (parser_str_new, rb_intern3): rb_default_encoding() renamed.

	* ext/nkf/nkf.c (rb_nkf_putchar): ditto.

Sat Dec 22 03:54:18 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_ascii_encoding): renamed from previous
	  rb_default_encoding().

Sat Dec 22 02:49:02 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (command): block from cmd_brace_block was ignored.
	  [ruby-dev:32644]

	* re.c (rb_reg_prepare_re): stop ENCODING_NONE warning if the
	  encoding of the str is ASCII-8BIT.

Sat Dec 22 01:52:11 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_ungetc): avoid buffer relocation, which might cause
	  serious problem under concurrent situation.

Sat Dec 22 01:35:41 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (ARG_ENCODING_NONE): defined for /.../n option.
	  (REG_ENCODING_NONE): ditto.
	  (rb_char_to_option_kcode): return ARG_ENCODING_NONE for n.
	  (rb_reg_prepare_re): warn /ascii/n =~ "non-ascii".
	  (rb_reg_initialize): set REG_ENCODING_NONE from ARG_ENCODING_NONE.

Sat Dec 22 01:23:10 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* test/json/test_json_addition.rb (test_core): do not use Time.now
	  because JSON can't hold nsec.

Sat Dec 22 01:10:30 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/tk/sample/tkextlib/vu/canvSticker2.rb,
	  ext/tk/sample/demos-{en,jp}/bind.rb: fix typo. [ruby-dev:32668]

Sat Dec 22 00:56:43 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/test.rb (valid_syntax): force_encoding input script.

Fri Dec 21 23:48:38 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (depend_rules): suffixes list broken. fixed.

Fri Dec 21 20:18:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_mul0): remove unused variable.

	* bignum.c (bigdivrem): ditto.

Fri Dec 21 20:13:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_catch_obj, rb_throw_obj): prototyped.

	* include/ruby/intern.h (rb_fiber_alive_p): prototyped.

Fri Dec 21 20:09:18 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_succ): retry increasing until valid char is found.

Fri Dec 21 20:00:02 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_replicate): now creates first class encoding.

	* encoding.c (rb_define_dummy_encoding): always based on the default
	  encoding.

	* encoding.c (rb_enc_dummy_p): check if dummy.

	* encoding.c (enc_inspect): shows if dummy.

	* encoding.c (Init_Encoding): added dummy? method

	* include/ruby/encoding.h (ENCODING_INLINE_MAX): increased.

Fri Dec 21 18:40:54 2007  Koichi Sasada  <ko1@atdot.net>

	* io.c: write() should be in blocking region.

	* bootstraptest/test_io.rb, test_knownbug.rb: move a fixed test.

Fri Dec 21 17:56:30 2007  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: provisional support on Ruby-VM.

	* ext/tk/MANUAL_tcltklib.eng, ext/tk/MANUAL_tcltklib.eucj:
	  modify document about new functions.

	* ext/tk/lib/tk.rb, ext/tk/lib/tk/labelframe.rb,
	  ext/tk/lib/tk/frame.rb, ext/tk/lib/tk/toplevel.rb,
	  ext/tk/lib/tk/scrollbar.rb, ext/tk/lib/tk/message.rb,
	  ext/tk/lib/tk/listbox.rb, ext/tk/lib/tk/text.rb,
	  ext/tk/lib/tk/scale.rb, ext/tk/lib/tk/entry.rb,
	  ext/tk/lib/tk/ttk_selector.rb, ext/tk/lib/tk/menu.rb,
	  ext/tk/lib/tk/label.rb, ext/tk/lib/tk/spinbox.rb,
	  ext/tk/lib/tk/textmark.rb, ext/tk/lib/tk/winpkg.rb,
	  ext/tk/lib/tk/checkbutton.rb, ext/tk/lib/tk/panedwindow.rb,
	  ext/tk/lib/tk/texttag.rb, ext/tk/lib/tk/root.rb,
	  ext/tk/lib/tk/textimage.rb, ext/tk/lib/tk/radiobutton.rb,
	  ext/tk/lib/tk/package.rb, ext/tk/lib/tk/macpkg.rb,
	  ext/tk/lib/tk/composite.rb, ext/tk/lib/tk/autoload.rb,
	  ext/tk/lib/tk/canvas.rb, ext/tk/lib/tk/button.rb,
	  ext/tk/lib/tk/textwindow.rb,
	  ext/tk/lib/tkextlib/iwidgets/scrolledtext.rb,
	  ext/tk/lib/tkextlib/tile/style.rb,
	  ext/tk/lib/tkextlib/tile/tscrollbar.rb,
	  ext/tk/lib/tkextlib/tile/tpaned.rb, ext/tk/lib/tkextlib/tile.rb,
	  ext/tk/extconf.rb: support Tcl/Tk8.5 (partial, not complete).

	* ext/tk/sample/demos-jp/widget,
	  ext/tk/sample/demos-jp/pendulum.rb,
	  ext/tk/sample/demos-jp/bind.rb,
	  ext/tk/sample/tkextlib/vu/canvSticker2.rb,
	  ext/tk/sample/demos-en/pendulum.rb,
	  ext/tk/sample/demos-en/bind.rb: remove $KCODE and minor bug fix.

Fri Dec 21 17:49:06 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (rb_str_transcode_bang): returns self if no conversion.
	  [ruby-dev:32662]

Fri Dec 21 17:44:47 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*:  Update to RubyGems 1.0.1, r1581

Fri Dec 21 17:32:49 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/pending.rb: renamed from featurebug.rb.
	  This file contains bugs which is known but will not be
	  fixed in days.

Fri Dec 21 17:31:22 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c (dummy_gdb_enums.various): added ENCODING and CODERANGE
	  constants.

	* .gdbinit: use enum constants.

Fri Dec 21 17:28:17 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/featurebug.rb: added.

	* bootstraptest/test_knownbug.rb: move a feature bug.

Fri Dec 21 17:25:22 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_atfork): fix to mark thread object.
	  [ruby-dev:32404]

	* bootstraptest/test_knownbug.rb, test_fork.rb: move a fixed test.

Fri Dec 21 17:07:13 2007  Koichi Sasada  <ko1@atdot.net>

	* gc.h: extern variable should not be initialized.

	* thread_pthread.c: add a parameter.

Fri Dec 21 16:50:43 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (Init_Encoding): use enc_name as to_s.
	  (enc_inspect): renamed from enc_to_s.  add "#" at beginning.

Fri Dec 21 16:37:43 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/config.h (MIME_DECODE_DEFAULT, X0201_DEFAULT):
	 defined as FALSE.  nkf and kconv don't decode MIME encoded string
	 and don't convert JIS X 0201 Katakana.

	* test/nkf/test_kconv.rb: fix tests.

Fri Dec 21 16:33:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (enumerator_iter_i): adjusted for rb_block_call_func.

	* include/ruby/ruby.h (rb_block_call_func): function to be called back
	  as block.

Fri Dec 21 16:25:25 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* common.mk, transcode_data_iso_8859.c: renamed to
	  transcode_data_one_byte.c.

Fri Dec 21 16:10:30 2007  Shigeo Kobayashi  <shigeo@tinyforest.jp>

	* ext/bigdecimal/bigdecimal.c (VpMidRound): Round method bug
	  pointed by Ryan Platte fixed(Patch to the patch from "NATORI
	  Shin").  [ruby-talk:273360]

Fri Dec 21 16:06:13 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (append_utf8): use rb_utf8_encoding() instead of
	  rb_enc_find("utf-8").

Fri Dec 21 15:59:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_init): use enc_register_at() directly.

	* encoding.c (rb_utf8_encoding): returns utf-8 encoding.

	* include/ruby/encoding.h (rb_utf8_encoding): prototyped.

	* parse.y (UTF8_ENC): uses rb_utf8_encoding().

Fri Dec 21 15:31:59 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_s_read): allow specifying encoding explicitly.

	* io.c (rb_io_binmode): specifies encoding to ASCII-8BIT (binary).

	* io.c (rb_io_s_read): IO should be in binary mode when offset is
	  specified.

	* encoding.c (rb_to_encoding): returns default encoding if no
	  corresponding encoding found.

Fri Dec 21 15:24:22 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (initialize): accept service name.  changed
	  the default value of the old style +verify+ argument to true.

Fri Dec 21 15:15:44 2007  Tanaka Akira  <akr@fsij.org>

	* gc.c (rb_garbage_collect): new function for debugging.

Fri Dec 21 15:16:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_to_encoding_index): should return error instead of
	  exception even if type is incorrect.

Fri Dec 21 14:58:27 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_init_copy): prohibit cloning of
	  generators since Fibers cannot be copied.

	* enumerator.c (enumerator_init_copy): typo fixed.

Fri Dec 21 14:46:07 2007  Tanaka Akira  <akr@fsij.org>

	* io.c (Init_IO): define IO::BINARY even if O_BINARY is not exist.

Fri Dec 21 14:01:14 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_system.rb (TestSystem::valid_syntax): apply
	  ASCII-8BIT encoding explicitly.

	* re.c (rb_reg_prepare_re): add encoding name in the message.

Fri Dec 21 13:54:05 2007  Tanaka Akira  <akr@fsij.org>

	* re.c: change "character encodings differ" error messages.

Fri Dec 21 13:46:58 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_register): set encoding constant.

	* encoding.c (rb_enc_find_index): replace non-alphanumeric chars with
	  underscores, so that initialize function can be called.

	* encoding.c (rb_enc_find_index): extension libraries have lower case
	  names conventionally.

	* ruby.c (proc_options, process_options): finds encoding after
	  load_path is initialized.

Fri Dec 21 13:10:57 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_external_encoding): new method.

	* encoding.c (rb_enc_from_encoding): returns Qnil for NULL
	  encoding.

	* io.c (rb_io_external_encoding): should fill delayed
	  initialization for STDIN.

Fri Dec 21 13:09:11 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_locale_charmap): return nil if no locale information.

Fri Dec 21 12:55:39 2007  Tanaka Akira  <akr@fsij.org>

	* lib/runit, lib/rubyunit.rb, test/testunit/runit: removed.

Fri Dec 21 12:45:49 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_chomp_bang): avoid unnecessary loop using
	  ONIGENC_LEFT_ADJUST_CHAR_HEAD().

Fri Dec 21 12:32:08 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (Init_File): File.exists? revived.

	* dir.c (Init_Dir): Dir.exists? again.

Fri Dec 21 12:26:36 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: remove "illegal".

Fri Dec 21 12:22:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* keywords, parse.y (__ENCODING__): represent script encoding.

Fri Dec 21 12:16:50 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_is_ascii_only_p): new method ascii_only?.

Fri Dec 21 12:11:57 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_mode_enc): set default external encoding if no
	  encoding specified explicitly.

Fri Dec 21 12:00:34 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in: check langinfo.h and locale.h.

	* encoding.c: use langinfo.h only if available.

	* main.c: use locale.h only if available.

Fri Dec 21 11:47:56 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c: include locale.h
	  (rb_locale_charmap): new method Encoding.locale_charmap for
	  nl_langinfo(CODESET).

	* include/ruby/encoding.h (rb_locale_charmap): declared.

	* main.c (main): call setlocale with LC_CTYPE.

	* ruby.c (locale_encoding): use rb_locale_charmap.

Fri Dec 21 11:35:10 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_dump.c: fix typo.  Reported by Yuki Mitsui.

Fri Dec 21 11:28:00 2007  Tanaka Akira  <akr@fsij.org>

	* regerror.c, string.c, io.c, lib/getoptlong.rb, lib/net/imap.rb,
	  compile.c, sprintf.c, parse.y, ext/win32ole/win32ole.c,
	  ext/tk/sample/demos-en/entry3.rb, ext/tk/lib/tcltk.rb,
	  ext/openssl/ossl_bn.c, numeric.c, vm.c,
	  benchmark/bm_so_meteor_contest.rb, bignum.c, ruby.c: don't "illegal"
	  for non law violation context.

Fri Dec 21 11:23:24 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (enc.mk): depends on $(RBCONFIG) instead of rbconfig.rb.

	* encoding.c (Init_Encoding): ISO-8859-1 is no longer a replica.

	* regenc.h (OnigEncodingDefine): names of extension and encoding can
	  differ.

	* enc/Makefile.in: always shared.

	* enc/depend (deffile): should not upcase.

	* enc/{ascii,euc_jp,sjis,utf8,iso_8859_{1..16}}.c: fix for Init.

Fri Dec 21 09:26:48 2007  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb: use erb.

Fri Dec 21 08:07:35 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_next): should call next_init() if fiber
	  is dead already. [ruby-dev:32459]

Fri Dec 21 01:21:49 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::SSL::SSLContext.build):
	  enable CRL checking by default.

Fri Dec 21 01:20:56 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/net/http.rb (Net::HTTP#connect): use
	  OpenSSL::SSL::SSLContext.build instead of SSLContext.new (default
	  verify mode is now OpenSSL::SSL::VERIFY_PEER).

	* lib/net/https.rb: SSL parameters are defined by attr_accessor.

	* test/net/http/test_https.rb: add test for HTTPS features.

Fri Dec 21 01:11:37 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* io.c (select_internal): should return original value.

Fri Dec 21 00:26:39 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (tr_trans): wrong encoding check for tree strings.

	* test/ruby/test_m17n.rb (TestM17N::test_tr_s): "invalid mbstring
	  sequence" is not an error to be tested.

	* test/ruby/test_m17n.rb (TestM17N::test_tr): ditto.

Thu Dec 20 19:29:07 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (initialize): the second argument is an option
	  hash now.  use SSLContext.build to specify SSL parameters.

Thu Dec 20 19:11:56 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_thread_apply_priority): check
	  _POSIX_PRIORITY_SCHEDULING for OpenBSD.

Thu Dec 20 18:33:54 2007  Koichi Sasada  <ko1@atdot.net>

	* configure.in: add libthr for FreeBSD.

Thu Dec 20 18:17:14 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk, *.ci: renamed to *.c.

	* eval_load.c: renamed to load.c.

Thu Dec 20 17:36:01 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*:  Import RubyGems 1.0.0, r1575.

Thu Dec 20 17:18:38 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c: support Proc#binding.

	* sample/test.rb: add a test.

Thu Dec 20 17:15:15 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* pack.c: Slight change to documentation ('character' ->
	  'byte (C char)'). [ruby-core:13126], see also [ruby-core:13998].

Thu Dec 20 17:07:54 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (enc.mk): depends on rbconfig.rb.

	* regenc.h (OnigEncodingDefine): external encoding definition macro.

	* enc/Makefile.in: fix for linking.

	* enc/depend, enc/make_encmake.rb: fix for Windows.

	* enc/{ascii,euc_jp,sjis,utf8,iso_8859_{1..16}}.c: renamed.

Thu Dec 20 16:42:55 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (find_line_no): return 0 if not found.

Thu Dec 20 16:04:17 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci, vm.c, vm_core.h: change interface of
	  vm_invoke_block() to specify block ptr.  [ruby-talk:266422]

	* cont.c, eval_jump.ci, insns.def, proc.c, signal.c, thread.c:
	  apply above change.

	* bootstraptest/test_knownbug.rb: move fixed bug.

	* bootstraptest/test_block.rb: ditto. and add a test.

Thu Dec 20 15:47:13 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/iso_8859_{1..16}.c: renamed.

Thu Dec 20 09:59:27 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_expandarray): fix sp increase place.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp> in [ruby-dev:32581].

	* bootstraptest/test_massign.rb: add a test for above.

	* bootstraptest/test_syntax.rb: fix last committed test.

Thu Dec 20 09:47:58 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_syntax.rb: add a test.

Thu Dec 20 09:40:51 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each/NODE_RETURN): fix stack consistency.

Thu Dec 20 09:42:11 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (big2str_orig): access beyond memory region cause crash
	  on interrupt.  a patch from Yusuke ENDOH <mame AT tsg.ne.jp> in
	  [ruby-dev:32651].  [ruby-dev:32641]

Thu Dec 20 09:06:54 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_index): wrong starting position.

Thu Dec 20 06:34:27 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): add pop after throw as return.

	* bootstraptest/test_knownbug.rb, test_syntax.rb: move resolved test.

	* vm_core.h, iseq.c, compile.h: add debug output code.

Thu Dec 20 04:57:18 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): remove unused retry entry.

Thu Dec 20 04:15:41 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* */Makefile.sub (DEFS, RM): output to config.status.

Thu Dec 20 02:59:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* common.mk (encs): create encoding directory.

Thu Dec 20 02:50:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/iso8859_{1..16}.c: adjust for ruby.

Thu Dec 20 02:28:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/iso8859_{1..16}.c: imported from Onigiruma 5.9.0.

Thu Dec 20 02:23:22 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/Makefile.in (RM): added.

	* enc/depend (encs): sort in alpha-numeric order.

	* enc/depend (clean, distclean): added.

Thu Dec 20 01:10:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): should handle upper level eval iseq
	  from break/next, and COMPILE_ERROR() breaks only one block.
	  [ruby-dev:31372]

Thu Dec 20 00:07:36 2007  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/drbtest.rb (test_07_public_private_protected_missing):
	  followed current Ruby specification.

Wed Dec 19 23:57:37 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_inspect, dir_path, dir_tell): check for frozen and closed
	  is not needed.  [ruby-dev:32640]

Wed Dec 19 22:59:52 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_sublen): adjust position if position is not at the
	  head of a character.

	* string.c (rb_str_chomp_bang): check if match start at the head
	  of a character.

	* string.c (rb_str_chomp_bang): wrong adjust condition.

	* string.c (rb_str_rindex): comparison length should be based on
	  bytes, not characters.

	* string.c (rb_str_rindex_m): too much adjustment.

	* re.c (reg_match_pos): pos adjustment should be based on
	  characters.

	* test/ruby/test_m17n.rb (TestM17N::test_str_insert): test updated
	  to check negative offset behavior.

	* string.c (rb_str_each_line): should consider rslen.

	* string.c (rb_str_buf_append): should propagate encoding.

	* string.c (rb_str_each_line): ditto.

	* test/ruby/test_m17n.rb (TestM17N::test_str_each_line): should
	  check encoding as well.

	* test/ruby/test_m17n.rb (TestM17N::test_str_each_line): empty
	  array can not propagate encoding;  should not check.

Wed Dec 19 21:42:18 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_regsub): should set checked encoding.

	* string.c (rb_str_sub_bang): applied r14212 too.

Wed Dec 19 20:40:01 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (bigmul1): C99ism.

	* bignum.c (bigdivrem1): need dummy return value.

Wed Dec 19 19:18:06 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: Updated.

	* ext/nkf/nkf.c (rb_nkf_enc_get): added.
	  (find encoding or replicate default encoding)

	* ext/nkf/nkf.c (NKF::<ENCODING>): redefine encoding constant.

	* ext/nkf/lib/kconv.rb (Kconv::<ENCODING>): redefined as Encoding.

	* ext/nkf/lib/kconv.rb: refactoring.

Wed Dec 19 19:11:08 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_mul0): blocking check for bigger numbers.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp> in [ruby-dev:32632].

	* bignum.c (bigdivrem): ditto.

Wed Dec 19 17:34:50 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): remove "retry" in block.
	  ("iter{retry}" cause syntax error)
	  Currently, "begin; ...; rescue; iter{retry}; end" cause
	  syntax error too.

	* bootstraptest/test_jump.rb: ditto.

	* lib/drb/invokemethod.rb: ditto.

	* sample/drb/darrayc.rb: ditto.

	* sample/test.rb: ditto.

	* test/drb/drbtest.rb: ditto.

	* test/ruby/test_iterator.rb: ditto.

	* sample/test.rb: add a 'test' directory on the SYSTEM test.

Wed Dec 19 17:12:59 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb, test_block.rb:
	  move fixed bug.

	* bootstraptest/test_m17n.rb: added.

Wed Dec 19 16:59:55 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (errinfo_place): skip if error is Fixnum.  [ruby-dev:32608]

	* bootstraptest/test_exception.rb, test_known_bug.rb: move fixed bug.

Wed Dec 19 16:31:58 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (reg_named_capture_assign_iter): remove C99 dependency.

	* parse.y (reg_named_capture_assign_iter): get rid of creating
	  unnecessary ID.

	* parse.y (rb_enc_symname2_p): check for non-nul-terminated string.

Wed Dec 19 15:37:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insnhelper.ci (vm_yield_with_cfunc): call cfunc with
	   (argv[0], data, argc, argv) to pass all arguments.

	* enumerator.c (enumerator_each_i): adapted to new calling
	  convention.

Wed Dec 19 15:13:20 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_justify): should propagate encoding from pad
	  string too.

Wed Dec 19 13:57:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (TIMEZONE_VOID): check whether timezone requires zero
	  arguments.  [ruby-dev:32631]

Wed Dec 19 13:22:14 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* ext/nkf/nkf.c (NKF::_ENCODING): removed.

	* ext/nkf/nkf.c (rb_nkf_kconv): renamed to rb_nkf_convert.

	* ext/nkf/nkf.c (rb_nkf_convert): set encoding.

	* ext/nkf/nkf.c (rb_nkf_guess1): removed.

	* ext/nkf/nkf.c (rb_nkf_guess2): renamed to rb_nkf_guess.

	* ext/nkf/nkf.c (rb_nkf_guess):
	  guess method now returns encoding object.

	* ext/nkf/nkf-utf8/nkf.c: Update to nkf 2.0.8 2007-12-19.

Wed Dec 19 10:52:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_cstr_to_inum): an underscore succeeding after octal
	  prefix is allowed.  [ruby-core:14139]

Wed Dec 19 00:09:19 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_cstr_to_inum): wrong radix check.  a patch from
	  Yusuke ENDOH <mame AT tsg.ne.jp> in [ruby-dev:32628].

	* bignum.c (big2str_find_n1): ditto.

Tue Dec 18 23:53:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): fix for segfault.  [ruby-dev:31372]

Tue Dec 18 23:44:32 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/net/http/utils.rb: split TestNetHTTPUtils module from
	  test/net/http/test_http.rb. and start HTTP server in each test case.

Tue Dec 18 23:27:51 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/server.rb (WEBrick::GenericServer#accept_client):
	  should rescue Errno::EINVAL from TCPServer#accept. this exception
	  might occur if the server socket is not in ready to listen.

	* lib/webrick/server.rb (WEBrick::GenericServer#accept_client):
	  don't call TCPServer#close if the :ShutdownSocketWithoutClose is set.

	* lib/webrick/config.rb (WEBrick::Config::General): add new parameter
	  :ShutdownSocketWithoutClose.

Tue Dec 18 22:51:47 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::SSL::SSLServer#shutdown):
	  new method which calls TCPSocket#shutdown of the underlying socket.

Tue Dec 18 22:11:50 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/rss/parser.rb, lib/rss/atom.rb, lib/rss/rss.rb,
	  test/rss/rss-assertions.rb, test/rss/test_atom.rb: use
	  pack/unpack("m") instead of base64 library.

	* lib/webrick/httpproxy.rb: use delete("\n") instead of chomp/chop
	  because the result of pack("m") might be multi-line.

Tue Dec 18 22:12:35 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci, vm.c: rewrite sp manipulation around method/block
	  invocation.  [ruby-dev:32547]

Tue Dec 18 22:11:23 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/win32/lib/win32/sspi.rb: use pack/unpack("m") instead of
	  base64 library which was already removed.

Tue Dec 18 21:09:23 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (invoke_block): merge 2 stack overflow checks.

Tue Dec 18 20:58:35 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, insnhelper.ci, insns.def, object.c, vm.c, vm.h:
	  optimize !@, != method invocation.

	* id.c, id.h: ditto.

	* bootstraptest/test_syntax.rb: add tests for above.

Tue Dec 18 18:10:05 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: add issues.

Tue Dec 18 20:22:44 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y (arg tMATCH arg): call reg_named_capture_assign_gen if regexp
	  literal is used.
	  (reg_named_capture_assign_gen): assign the result of named capture
	  into local variables.
	  [ruby-dev:32588]

	* re.c: document the assignment by named captures.

Tue Dec 18 18:09:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_splice): propagate encoding.

	* string.c (rb_str_subpat_set): ditto.

Tue Dec 18 17:27:12 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_freeze): preserve frozen state of immediate
	  values in internal hash table, a la generic_ivar.

	* object.c (rb_obj_frozen_p): check immediate values too.

	* variable.c (generic_ivar_set): add frozen check fro immediate
	  values.

Tue Dec 18 17:04:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (rb_str_transcode_bang, rb_str_transcode): set new
	  encoding even if no conversion is done because of 7bit only.
	  [ruby-dev:32591]

Tue Dec 18 15:43:59 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (encs, ext/ripper/ripper.c): other options must come
	  before MAKEFLAGS in GNU make.

Tue Dec 18 15:19:55 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/parse_rb.rb: Don't call private fail anymore.

Tue Dec 18 15:17:26 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (encs, ext/ripper/ripper.c): pass MAKEFLAGS.

Tue Dec 18 14:45:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (op_tbl): remove duplication to avoid symbol aliases.

Tue Dec 18 14:39:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_nth): need not to raise out-of-range exception.

	* test/ruby/test_m17n.rb (TestM17N::test_str_aref_len): removed
	  debug print.

Tue Dec 18 14:05:23 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend: get rid of target expanded as empty for nmake.

Tue Dec 18 07:56:57 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* proc.c (rb_obj_public_method): Object#public_method to retrieve
	  public method object.

	* proc.c (rb_mod_public_instance_method): Module#public_instance_method
	  to retrieve public instance method from class / module.

	* proc.c (mnew): visibility check added.

	* eval_error.ci (rb_print_undef): add rb_ prefix.

	* eval_error.ci (rb_print_undef): add visibility in the error
	  message.

Tue Dec 18 05:54:26 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/Env.rb, lib/base64.rb, lib/importenv.rb, lib/eregex.rb: removed.

	* lib/ping.rb, lib/readbytes.rb: removed

Tue Dec 18 02:30:56 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (BUILTIN_ENCS): removed.

	* common.mk (enc.mk): pass BUILTIN_ENCS from command line.

	* enc/depend: ditto.

	* enc/make_encmake.rb: ditto.

Tue Dec 18 01:46:48 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): need to clear output buffer to avoid
	  broken encoding compatibility check.

Tue Dec 18 01:40:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (depend_rules): inserts ruby to only headers.

Tue Dec 18 01:21:19 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_encode_length): chomp eol style modifiers.

	* parse.y (parser_magic_comment): ditto.

	* parse.y (set_file_encoding): ditto.

Tue Dec 18 01:15:44 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (encs): added dependencies.

	* enc/Makefile.in, enc/depend, enc/make_encmake.rb: moved serb code.

	* lib/mkmf.rb (depend_rules): now takes content string, not file name.

	* win32/enc-setup.mak: overrides default target.

Tue Dec 18 00:26:12 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_initialize): raise error if non-Unicode fixed
	  encoding option is specified for regexp literals with \u{}
	  escapes.

	* string.c (rb_str_squeeze_bang): should squeeze multibyte
	  characters as well.

Mon Dec 17 21:41:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/enc-setup.mak: extracts BUILTIN_ENCOBJS.

	* tool/compile_prelude.rb: needs srcdir.

Mon Dec 17 21:24:04 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* common.mk (miniprelude.c): add -I$(srcdir).

Mon Dec 17 20:53:27 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_sslctx_set_ssl_version):
	  new method OpenSSL::SSL::SSLContext#ssl_version to wrap
	  SSL_CTX_set_ssl_version.

	* ext/openssl/ossl_ssl.c (ossl_ssl_get_verify_result):
	  new method OpenSSL::SSL::SSLSocket#verify_result to wrap
	  SSL_get_verify_result.

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::SSL::SSLContext.build):
	  new method to build OpenSSL::SSL::SSLContext with Hash parameters.
	  this method provides safety default parameters than SSLContext.new.

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::SSL.verify_certificate_identity):
	  new module function: pull out identity verification process
	  from OpenSSL::SSL::SSLSocket#post_connection_check.

Mon Dec 17 18:42:23 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (scan_once): need no encoding compatibility check.
	  it's done inside of re_reg_search().

	* string.c (rb_str_split_m): ditto.

	* re.c (rb_reg_regsub): ditto.

Mon Dec 17 17:50:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_index): check if substring is broken.

	* string.c (rb_str_rindex): ditto.

	* string.c (rb_str_succ): should carry over.

Mon Dec 17 17:47:26 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (encs): new target to compile external encodings.

	* enc/Makefile.in: became a serb template.

	* enc/make_encmake.rb: creates enc.mk from enc/Makefile.in using serb.

	* lib/mkmf.rb (relative_from): moved from ext/extmk.rb.

	* lib/mkmf.rb ($extmk): true if under to top source directory, not
	  only ext.

	* lib/mkmf.rb (depend_rules): extracted from create_makefile.

	* tool/serb.rb (serb): splitted from tool/compile_prelude.rb.

Mon Dec 17 17:32:55 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (MAKEFILES): removed enc/Makefile.

	* configure.in (EXTERNAL_ENCOBJS, ENCSOS): removed.

	* enc/Makefile.in (BUILTIN_ENCS): includes .c suffix.

	* enc/depend: splitted from Makefile.in.

	* {bcc32,win32,wince}/setup.mak (-encs-): extracts BUILTIN_ENCOBJS.

Mon Dec 17 17:07:53 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_enc_str_asciionly_p): use rb_enc_str_coderange.

Mon Dec 17 16:39:25 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_enc_str_coderange): set ENC_CODERANGE_BROKEN using
	  rb_enc_precise_mbclen.
	  (rb_str_valid_encoding_p): just check coderange is
	  ENC_CODERANGE_BROKEN or not.

Mon Dec 17 16:04:16 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/buffering.rb (Buffering#gets): added second
	  optional argument to specify maximum length limit.

Mon Dec 17 16:02:30 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httprequest.rb, lib/webrick/cgi.rb: Request-Line or
	  header fields should be read with maximum length. [ruby-talk:231745]

Mon Dec 17 14:03:39 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (ENC_CODERANGE_VALID): rename from
	  ENC_CODERANGE_8BIT.

	* string.c (rb_enc_str_coderange): follow the renaming.

Mon Dec 17 13:56:53 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (tr_find): wrong condition fixed.

	* sprintf.c (rb_str_format): check encoding based on result, not
	  the format string.

	* string.c (rb_str_upto): add encoding check.

Mon Dec 17 12:21:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (RUNRUBY): added RUNRUBYOPT.

Mon Dec 17 11:38:59 2007  Tanaka Akira  <akr@fsij.org>

	* thread_win32.ci (native_thread_create): initialize
	  th->machine_stack_maxsize as rb_gc_stack_maxsize.

Sun Dec 16 17:07:35 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c (transcode_loop): removed special case (-1)
	  for undefined conversions.

	* transcode_data_iso_8859.c: Changed from character constants
	  ('\xC2') to integer constants (0xC2) for shorter files and
	  better readability; eliminated duplicated tables; changed
	  from -1 offset to actual UNDEF entry (not yet distinguishing
	  UNDEF and ILLEGAL correctly).

	* test/ruby/test_transcode.rb: added a test for UNDEF conversion.

Sun Dec 16 14:51:59 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (MAKEFILES): should be enc/Makefile, not GNUmakefile.
	  [ruby-dev:32609]

	* configure.in (BUILTIN_ENCS): removed escapes for OpenBSD.

Sat Dec 15 23:58:46 2007  Tanaka Akira  <akr@fsij.org>

	* test/openssl/test_pair.rb (SSLPair#ssl_pair): join the thread, even
	  on an error.

Sat Dec 15 23:50:31 2007  Tanaka Akira  <akr@fsij.org>

	* test/xmlrpc/webrick_testing.rb: join webrick server thread.

Sat Dec 15 22:27:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (BUILTIN_ENCS): splitted command line instead of
	  semicolons for Solaris.

Sat Dec 15 21:38:24 2007  Tanaka Akira  <akr@fsij.org>

	* lib/timeout.rb: join the background thread to make sure it is dead.

Sat Dec 15 20:20:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (enc/Makefile): add external encoding objects list.

	* common.mk (BUILTIN_ENCOBJS): renamed from ENCOBJS.

	* configure.in (BUILTIN_ENCS): [] needs to be enclosed because of m4.

	* Makefile.in (BUILTIN_ENCOBJS): substituted by autoconf.

	* enc/Makefile.in: new file to compile external encoding sources.

	* encoding.c (rb_enc_find_index): auto-load external encoding objects
	  as "ext/ENCODING_NAME".  [ruby-dev:32606]

Sat Dec 15 13:04:30 2007  Tanaka Akira  <akr@fsij.org>

	* vm_core.h (rb_thread_t): new member machine_stack_maxsize and
	  machine_register_stack_maxsize.

	* gc.c (rb_gc_stack_maxsize): new global variable for the thread size
	  of the main thread.
	  (STACK_LEVEL_MAX): use machine_stack_maxsize of current thread.
	  (ruby_stack_check): check IA64 register stack.
	  (ruby_set_stack_size): set rb_gc_stack_maxsize.
	  (Init_stack): set rb_gc_stack_maxsize.

	* thread_pthread.ci (native_thread_create): initialize
	  th->machine_stack_maxsize and th->machine_register_stack_maxsize.

	* vm.c (Init_BareVM): initialize th->machine_stack_maxsize and
	  th->machine_register_stack_maxsize.

	* thread_win32.ci (native_thread_create): initialize
	  th->machine_stack_maxsize.  not tested.  just a guess at all.

	[ruby-dev:32604]

Sat Dec 15 12:58:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_register, rb_enc_replicate, rb_enc_alias): check
	  if already registered.

Sat Dec 15 01:57:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rdoc/options.rb (Options::parse): do not access $KCODE any
	  longer.  [ruby-core:14079]

	* lib/irb/init.rb (IRB::IRB.parse_opts): ditto.

	* lib/cgi.rb (CGI::CGI): ditto.

Fri Dec 14 18:18:31 2007  Tanaka Akira  <akr@fsij.org>

	* thread_pthread.ci (native_thread_create): twice the stack size.
	  512KB is not enough to complete test-all on Debian GNU/Linux on
	  IA64.

Fri Dec 14 16:10:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_p): RDoc update.  a patch from murphy <murphy AT rubychan.de>.
	  [ruby-core:14010]

Fri Dec 14 16:06:18 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_cmp): encoding aware comparison.

	* string.c (rb_str_casecmp): ditto.

Fri Dec 14 15:25:30 2007  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c (encoding_equal): new function.

	* transcode.c (str_transcode, transcode_dispatch): added two-step
	  conversion logic via UTF-8.

	* transcode.c: some minor formatting fixes

	* transcode_data.h, transcode_data_iso_8859.c: Shortened
	  extremely frequently used macros to shorten file length.

	* test/ruby/test_transcode.rb: Fixed name of test class;
	  added setup method to ensure all necessary encodings exist;
	  split tests into more test methods; added tests; fixed ordering
	  of arguments in assert_equal to have expected result first.

Fri Dec 14 13:47:54 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ruby.imp): fix for circular dependency.  a patch from
	  Yutaka Kanemoto <kinpoco AT gmail.com> in [ruby-dev:32590].

	* regint.h, st.c, ext/json/ext/generator/generator.c: suppress
	  warnings on AIX.

Fri Dec 14 12:36:35 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_CHECK_VARTYPE): check if a variable is defined
	  and its type.

	* configure.in (timezone, altzone): check for recent cygwin.

	* missing/strftime.c (strftime): fix for timezone.  [ruby-dev:32536]

	* lib/mkmf.rb (try_var): should fail for functions.

	* ext/readline/extconf.rb: should use have_func for functions instead
	  of have_var.

Fri Dec 14 10:25:56 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/e2mmap.rb (Exception2MessageMapper::E2MM.Raise): $! no
	  longer modifiable in 1.9.

Fri Dec 14 08:17:24 2007  Tanaka Akira  <akr@fsij.org>

	* eval.c (rb_protect): restore root_jmpbuf even if proc exits by
	  break such as dbm.delete_if { break }.

Fri Dec 14 02:55:41 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_nth): direct jump if string is 7bit only.  great
	  performance boost for worst case.

	* string.c (str_strlen): direct size if string is 7bit only.

Fri Dec 14 02:29:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_compatible): 1st argument (typically the
	  receiver) would have higher priority in encoding detection.

Fri Dec 14 02:05:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_synchronized): should check if initialized.
	  [ruby-dev:32585]

Fri Dec 14 00:54:40 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_initialize): embedded string may override encoding
	  of the regular expression.

	* re.c (rb_reg_initialize): fix encoding of regular expression if
	  embedded string has its own encoding specified.

Thu Dec 13 22:16:46 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_compatible): encoding should never fall back
	  to ASCII-8BIT unless both encodings are ASCII-8BIT.

Thu Dec 13 20:31:28 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (rb_str_shared_replace): make str noembed after free.

Thu Dec 13 20:09:09 2007  Tanaka Akira  <akr@fsij.org>

	* eval.c (rb_protect): restore root_jmpbuf to avoid SEGV by
	  'IO.pipe; [].each.next' with gcc version 3.3.5 (Debian 1:3.3.5-13)
	  on IA64.

Thu Dec 13 17:51:54 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_split_m): need not to check encoding if regexp
	  is empty.

	* string.c (rb_str_justify): associate encoding of original to the
	  result.

	* string.c (rb_str_chomp_bang): need to check encoding of record
	  separator.

	* string.c (str_gsub): should copy encoding to the result.

	* sprintf.c (rb_str_format): ditto.

	* string.c (rb_str_succ): should not enter infinite loop for
	  non-ASCII, non-alphanumeric character at the bottom.

Thu Dec 13 17:03:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_compatible): should swap encoding indexes too.

Thu Dec 13 16:41:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_compatible): should not judge compatibility
	  based on rb_enc_asciicompat().

Thu Dec 13 13:09:03 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/io.h (MakeOpenFile): fptr->enc should be
	  initialized to zero.  [ruby-dev:32569]

Thu Dec 13 08:56:01 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_getc): use default external encoding if fptr->enc is
	  not set.  [ruby-dev:32565]

	* lib/rubygems/package.rb (Gem::TarReader::Entry::rewind): typo fixed.
	  [ruby-dev:32565]

Thu Dec 13 08:24:16 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (read_all): should associate default external encoding.

	* io.c (io_read): should NOT associate default external encoding.

Wed Dec 12 23:22:58 2007  Tanaka Akira  <akr@fsij.org>

	* re.c, regerror.c, string.c, parse.y, ruby.c, file.c:
	  use capital letter for \xHH notation.  [ruby-dev:32511]

Wed Dec 12 22:21:34 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_mode_enc): allow specifying external encoding in
	  open mode, e.g. open(path, "r:utf-8").

Wed Dec 12 21:26:03 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_method.ci (rb_alias): no need to skip aliasing when new
	  equals to old.  [ruby-core:13990]

Wed Dec 12 16:34:53 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_check_readable): set default external encoding to
	  STDIN.

	* io.c (io_enc_str): associate encoding to output string.

Wed Dec 12 12:44:39 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (expr): 'not' and '!' should act as conditional
	  expression.   [ruby-dev:32548]

Wed Dec 12 12:11:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_regsub): should copy encoding.

	* string.c (rb_str_sub_bang, str_gsub): should check and copy encoding
	  to be replaced.

Tue Dec 11 23:04:17 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): RDoc update.  a patch from Gary Wright
	  <radar2002 AT gmail.com>.  [ruby-core:13998]

	* pack.c (pack_unpack): ditto.

Tue Dec 11 16:37:47 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_ascget): renamed from rb_enc_get_ascii.

	* include/ruby/encoding.h: follow the renaming.

	* re.c: ditto.

Tue Dec 11 16:19:26 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, */Makefile.sub (CP, MV): added.

	* common.mk (.y.c): not discard the old target until successfully
	  created.

Tue Dec 11 15:20:39 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (Init_Object): singleton_method_{added,removed,undefined}
	  hooks should be defined for BasicObject.  [ruby-dev:32531]

	* eval.c (Init_eval): method_missing should be defined for all
	  objects; moved to BasicObject.

Tue Dec 11 14:27:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_loop): get rid of SEGV at sequence can not be
	  converted.

	* transcode.c (rb_str_transcode_bang): copy encoding.  [ruby-dev:32532]

	* test/ruby/test_transcode.rb: added tests from Martin Duerst <duerst
	  AT it.aoyama.ac.jp>.  [ruby-dev:32532]

Tue Dec 11 12:05:51 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_get_ascii): add an argument to provide the
	  length of the returned character.

	* include/ruby/encoding.h (rb_enc_get_ascii): add the argument.

	* re.c (rb_reg_expr_str): modify rb_enc_get_ascii call.
	  (rb_reg_quote): ditto.
	  (rb_reg_regsub): ditto.

Tue Dec 11 09:40:21 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/oniguruma.h (ONIGENC_CONSTRUCT_MBCLEN_NEEDMORE):
	  parenthesize an argument.

Tue Dec 11 02:23:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_method_missing): RDoc update patch from Hugh Sasse
	  <hgs AT dmu.ac.uk>.  [ruby-core:12932]

Tue Dec 11 01:51:34 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP::get): now supports gzip
	  content-encoding.  a patch from Hugh Sasse <hgs AT dmu.ac.uk>.
	  [ruby-core:13451]

Tue Dec 11 01:21:21 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (shadowing_lvar_gen): no duplicate error for "_".

Mon Dec 10 22:08:47 2007  Akinori MUSHA  <knu@iDaemons.org>

	* array.c (rb_ary_slice_bang): If an invalid range is given, do
	  not raise an exception but return nil just like slice() does.

Mon Dec 10 21:47:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (str_transcode): allow non-registered encodings.
	  [ruby-dev:32520]

Mon Dec 10 21:00:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_slice_bang): should return nil if position out
	  of range.  a patch from Akinori MUSHA <knu AT iDaemons.org>.
	  [ruby-dev:32518]

Mon Dec 10 19:02:52 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_match): should calculate offset by converted
	  operand.  [ruby-cvs:21416]

Mon Dec 10 18:28:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/uri/common.rb (URI::REGEXP::PATTERN): typo in REG_NAME
	  regular expression.  a patch from Ueda Satoshi
	  <s-ueda AT livedoor.jp>.  [ruby-dev:32514]

Mon Dec 10 17:46:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_tmp_new): creates hidden temporary buffer.

	* transcode.c (transcoding): added a pointer to function to flush.

	* transcode.c (transcode_loop): do not use string internal.
	  [ruby-dev:32512]

	* transcode.c (str_transcode): allow Encoding objects.

	* transcode_data.h (BYTE_LOOKUP): use actual struct name.

Mon Dec 10 16:52:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_insert): should not add length in bytes to index in
	  chars.

Mon Dec 10 14:33:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_public_send): rename invoke_method to public_send.
	  it now invokes public method only no matter how it's called.

Mon Dec 10 14:00:43 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* transcode.c: new file to provide encoding conversion features.
	  code contributed by Martin Duerst.

Mon Dec 10 13:50:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_search): return byte offset.  [ruby-dev:32452]

	* re.c (rb_reg_match, rb_reg_match2, rb_reg_match_m): convert byte
	  offset to char index.

	* string.c (rb_str_index): return byte offset.  [ruby-dev:32472]

	* string.c (rb_str_split_m): calculate in byte offset.

Mon Dec 10 09:56:29 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm1_neq.rb, bm_vm1_not.rb: added.

Mon Dec 10 07:48:14 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): wrong token was generated.  [ruby-dev:32498]

	* object.c (rb_obj_not_match): wrong test.

Mon Dec 10 06:44:47 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_expr_str): use \xHH instead of \OOO.

	* regerror.c (to_ascii): ditto.
	  (onig_snprintf_with_pattern): ditto.
	  (onig_snprintf_with_pattern): ditto.

	* string.c (rb_str_inspect): ditto.
	  (rb_str_dump): ditto.

	* parse.y (parser_yylex): ditto.

	* ruby.c (proc_options): ditto.

	* file.c (rb_f_test): ditto.

	[ruby-dev:32495]

Mon Dec 10 06:41:00 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_names): new method Regexp#names.
	  (rb_reg_named_captures): new method Regexp#named_captures
	  (match_regexp): new method MatchData#regexp.
	  (match_names): new method MatchData#names.

	* lib/pp.rb (MatchData#pretty_print): show names of named captures.

	[ruby-dev:32493]

Mon Dec 10 01:35:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (expr): redefinable not (!) operator.

	* parse.y (arg): ditto.

	* object.c (rb_obj_not): new method "!".

	* object.c (rb_obj_not_equal): new method "!=".

	* object.c (rb_obj_not_match): new method "!~".

Sun Dec  9 22:31:36 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_s_last_match): accept named capture's name.

Sun Dec  9 15:57:53 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (match_backref_number): new function for converting a backref
	  name/number to an integer.
	  (match_offset): use match_backref_number.
	  (match_begin): ditto.
	  (match_end): ditto.
	  (name_to_backref_number): raise IndexError instead of RuntimeError.
	  (match_inspect): show capture index.

Sun Dec  9 14:59:15 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_intern.h (CHECK_STACK_OVERFLOW): reserve frame size.
	  [ruby-dev:32485]

Sun Dec  9 14:38:25 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (rb_thread_mark): use rb_gc_mark_maybe() for
	  VM stack specified by mark_stack_len.  [ruby-dev:32462]

	* insnhelper.ci: clear vm stack extended by opt value.

Sun Dec  9 14:08:47 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (FilePathStringValue): defined.  similar to
	  FilePathValue but no taint check.

	* file.c (rb_get_path_no_checksafe): implementation of
	  FilePathStringValue.
	  (rb_file_s_basename): use FilePathStringValue.
	  (rb_file_s_dirname): ditto.
	  (rb_file_s_extname): ditto.
	  (rb_file_s_split): ditto.
	  (rb_file_join): ditto.

	* dir.c (file_s_fnmatch): ditto.

Sun Dec  9 12:49:34 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (append_utf8): check unicode range.

Sun Dec  9 12:39:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/cgi.rb (read_multipart): exclude blanks from header values.
	  [ruby-list:44327]

Sun Dec  9 12:18:19 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_get_path): use the original object if to_path method is
	  not defined.  [ruby-dev:32473]

	* io.c (rb_f_open): call to_open on non-string objects, instead of
	  to_str.  [ruby-dev:32473]

Sun Dec  9 12:12:23 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (tr_find): returns true if no characters to be removed is
	  specified.

Sun Dec  9 12:03:16 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_magic_comment): delimits with a semicolon.

Sun Dec  9 11:29:23 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (tr_trans): get rid of segfaults when has multibytes but
	  source sets have no multibytes.

Sun Dec  9 04:01:28 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_mbclen): return 1 if underlying implementation
	  returns a length longer than e-p.
	  (rb_enc_precise_mbclen): return needmore if underlying
	  implementation returns a length longer than e-p.

Sat Dec  8 17:59:40 2007  Tanaka Akira  <akr@fsij.org>

	* signal.c (posix_signal): return value.

Sat Dec  8 17:22:16 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/openssl/test_pkcs7.rb: Remove redundant module namespace.

Sat Dec  8 17:07:10 2007  Tanaka Akira  <akr@fsij.org>

	* ruby.c (proc_options): make rb_raise format as a string literal to
	  avoid warning.

Sat Dec  8 16:18:16 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_check_preprocess): new function for validating regexp
	  fragment.

	* parse.y (regexp): invoke reg_fragment_check.
	  (reg_fragment_check): defined.
	  (reg_fragment_check_gen): defined.

Sat Dec  8 11:06:29 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_mbclen): make it never fail.
	  (rb_enc_nth): don't check the return value of rb_enc_mbclen.
	  (rb_enc_strlen): ditto.
	  (rb_enc_precise_mbclen): return needmore(1) if e <= p.
	  (rb_enc_get_ascii): new function for extracting ASCII character.

	* include/ruby/encoding.h (rb_enc_get_ascii): declared.

	* include/ruby/regex.h (ismbchar): removed.

	* re.c (rb_reg_expr_str): use rb_enc_get_ascii.
	  (unescape_escaped_nonascii): use rb_enc_precise_mbclen to determine
	  the termination of escaped non-ASCII character.
	  (unescape_nonascii): use rb_enc_precise_mbclen.
	  (rb_reg_quote): use rb_enc_get_ascii.
	  (rb_reg_regsub): use rb_enc_get_ascii.

	* string.c (rb_str_reverse) don't check the return value of
	  rb_enc_mbclen.
	  (rb_str_split_m): don't call rb_enc_mbclen with e <= p.

	* parse.y (is_identchar): use ISASCII.
	  (parser_ismbchar): removed.
	  (parser_precise_mbclen): new macro.
	  (parser_isascii): new macro.
	  (parser_tokadd_mbchar): use parser_precise_mbclen to check invalid
	  character precisely.
	  (parser_tokadd_string): use parser_isascii.
	  (parser_yylex): ditto.
	  (is_special_global_name): don't call is_identchar with e <= p.
	  (rb_enc_symname_p): ditto.

	  [ruby-dev:32455]

	* ext/tk/sample/tkextlib/vu/canvSticker2.rb: remove coding cookie
	  because the encoding is not UTF-8.  [ruby-dev:32475]

Fri Dec  7 20:21:35 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/net/ftptls.rb, ext/openssl/lib/net/telnets.rb:
	  half-finished libraries are discontinued.

Fri Dec  7 15:44:40 2007  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb: use Hash for recursion check as inspect.

Fri Dec  7 15:04:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (flatten): some performance improvements, based on a patch
	  from Yusuke ENDOH <mame AT tsg.ne.jp> in [ruby-core:13877].
	  [ruby-core:13851]

	* thread.c (rb_exec_recursive): use Hash instead of Array for
	  performance improvement.  [ruby-core:13898]

	* thread.c (recursive_pop): use object ID.

Thu Dec  6 19:52:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (arg): typo fixed ("!" -> "|") in the ripper code.

Thu Dec  6 19:48:41 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (arg): tUPLUS no longer works as identity operation any
	  more.  inspired by [ruby-talk:265532].

Thu Dec  6 18:22:11 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_precise_mbclen): new function for mbclen with
	  validation.

	* include/ruby/encoding.h (rb_enc_precise_mbclen): declared.
	  (MBCLEN_CHARFOUND): new macro.
	  (MBCLEN_INVALID): new macro.
	  (MBCLEN_NEEDMORE): new macro.

	* include/ruby/oniguruma.h (OnigEncodingTypeST): replace mbc_enc_len
	  by precise_mbc_enc_len.
	  (ONIGENC_PRECISE_MBC_ENC_LEN): new macro.
	  (ONIGENC_CONSTRUCT_MBCLEN_CHARFOUND): new macro.
	  (ONIGENC_CONSTRUCT_MBCLEN_INVALID): new macro.
	  (ONIGENC_CONSTRUCT_MBCLEN_NEEDMORE): new macro.
	  (ONIGENC_MBCLEN_CHARFOUND): new macro.
	  (ONIGENC_MBCLEN_INVALID): new macro.
	  (ONIGENC_MBCLEN_NEEDMORE): new macro.
	  (ONIGENC_MBC_ENC_LEN): use ONIGENC_PRECISE_MBC_ENC_LEN.

	* enc/euc_jp.c: validation implemented.

	* enc/sjis.c: ditto.

	* enc/utf8.c: ditto.

	* string.c (rb_str_inspect): use rb_enc_precise_mbclen for invalid
	  encoding.
	  (rb_str_valid_encoding_p): new method String#valid_encoding?.

	* io.c (rb_io_getc): use rb_enc_precise_mbclen.

	[ruby-dev:32438]

Thu Dec  6 01:37:23 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regparse.c (i_apply_case_fold): fix for negative character class.  a
	  patch from Yusuke ENDOH <mame AT tsg.ne.jp> in [ruby-core:13884].

Thu Dec  6 01:00:38 2007  NARUSE, Yui <naruse@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_s_list): support NetBSD/Citrus iconv.

Wed Dec  5 16:18:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (rb_proc_s_new): call initialize.  [ruby-core:13824]

	* proc.c (rb_proc_location): return file name and line number where
	  the proc is defined.

	* thread.c (thread_s_new): call initialize.  [ruby-core:13835]

	* thread.c (thread_initialize): split initialize method.

Wed Dec  5 15:25:55 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_intern3): fix to changing encoding to default, and
	  uncommented r13835, which is rare but not impossible.

Wed Dec  5 15:15:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (step_i, range_step): support non-fixnum steps.
	  [ruby-talk:282100]

Wed Dec  5 14:25:11 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix typo.

Wed Dec  5 13:41:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (yycompile): get rid of tracing while parsing.
	  [ruby-dev:31351]

	* thread.c (ruby_suppress_tracing): added a new parameter, which
	  directs to call func always.

Tue Dec  4 19:56:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_convert): should not set encoding unless
	  the target encoding is supported.  [ruby-dev:32451]

Tue Dec  4 17:34:17 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (tojis, tosjis, toeuc, toutf8):
	  set encoding. [ruby-dev:32447]

Tue Dec  4 17:07:25 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/json.rb, lib/json/*: moved to ext/json/lib.

Tue Dec  4 16:34:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_create): achieve target encoding.

	* ext/iconv/iconv.c (iconv_convert, iconv_finish, iconv_iconv,
	  iconv_conv): set result string encoding.  [ruby-dev:32446]

	* ext/iconv/iconv.c (iconv_initialize, iconv_s_open): set encoding to
	  Iconv instance.

Tue Dec  4 14:34:35 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): reverted c flag.

Tue Dec  4 11:23:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_cstr_to_inum): trailing spaces may exist at squeezing
	  preceding 0s.  [ruby-core:13873]

Mon Dec  3 11:51:53 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/Win32API/*: removed or moved to ext/dl/win32.

	* ext/dl/win32/*: new. [ruby-dev:32387]

Sun Dec  2 22:08:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_mbchar): fix for ASCII chars.  [ruby-dev:32432]

	* parse.y (parser_parse_string, parser_here_document): prevent false
	  error messages.

Sun Dec  2 20:43:22 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (unescape_escaped_nonascii): fix mbclen argument.

Sun Dec  2 15:47:57 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_mbchar): check insufficient multibyte char.
	  [ruby-dev:32429]

Sun Dec  2 15:42:16 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb, test/rss/test_version.rb: 0.2.1 -> 0.2.2.

	* lib/rss/maker/itunes.rb: fixed new_itunes_category.
	* lib/rss/maker/taxonomy.rb: new_taxo_topic -> new_topic because
	  of consistency.

	* test/rss/test_maker_itunes.rb, test/rss/test_itunes.rb: removed
	  needless UTF-8 characters.

Sun Dec  2 15:18:37 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_callee_setup_arg): fix error message.
	  [ruby-dev:32430]

Sun Dec  2 09:12:48 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y (regexp): fix /#{}\xa1\xa2/e to be EUC-JP.
	  (reg_fragment_setenc_gen): extracted from reg_compile_gen.

Sun Dec  2 01:39:51 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_uv_to_utf8): declared.

	* re.c (rb_reg_preprocess): new function for dynamic regexp with
	  \u{} such as Regexp.new("\\u{6666}").
	  (rb_reg_prepare_re): preprocess regexp for recompiling.
	  (read_escaped_byte): new function.
	  (unescape_escaped_nonascii): new function.
	  (append_utf8): new function.
	  (unescape_unicode_list): new function.
	  (unescape_unicode_bmp): new function.
	  (unescape_nonascii): new function.
	  (rb_reg_initialize): preprocess regexp.

	* pack.c (rb_uv_to_utf8): renamed from uv_to_utf8.

	* parse.y (STR_NEW3): take func instead of has8 and hasmb.
	  (parser_str_new): use default coderange mechanism except for regexp.
	  (parser_tokadd_utf8): copy regexp source as-is.
	  (parser_read_escape): UTF-8 stuff removed.
	  (parser_tokadd_escape): has8bit and hasmb removed.
	  (parser_tokadd_string): fix 8-bit single byte character with \u.
	  (parser_parse_string): has8bit and hasmb removed.
	  (parser_here_document): has8bit and hasmb removed.
	  (parser_yylex): call parser_tokadd_utf8 instead of read_escape for
	  UTF-8 character.

Wed Dec  2 01:00:07 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/xmlrpc/server.rb (XMLRPC::Server#server): Improve signal handling so
	  pressing control-c in the controlling terminal or sending SIGTERM stops
	  the XML-RPC server.

Sat Dec  1 23:04:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c: rename primary_encoding -> default_external (encoding).

Sat Dec  1 19:52:57 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (Time#to_datetime): use nsec instead of usec.

	* lib/date.rb (DateTime#to_time): second minute as an argument to
	  Time::utc contains fractional part in rational; hence Time
	  object may keep resolution at most nanosecond.

Sat Dec  1 14:36:05 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: move fixed bugs.

	* test/ruby/test_sprintf.rb: ditto.

	* test/yaml/test_yaml.rb: ditto.

Sat Dec  1 13:24:47 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_yield_with_cfunc): fix to passing argc on third
	  parameter of IFUNC.  [ruby-dev:32329]

	* enumerator.c: fix to pass exact number of argument.

	* eval.c (rb_yield_values2): added.

	* include/ruby/ruby.h: ditto.

	* bootstraptest/test_knownbug.rb: move a fixed test.

	* bootstraptest/test_block.rb: ditto.

Sat Dec  1 10:45:56 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_open): use to_open for every non-string object.  path
	  object may use method_missing.

Sat Dec  1 09:44:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (concatarray, splatarray): use to_a instead of
	  to_splat.

	* insnhelper.ci (caller_setup_args): ditto.

Sat Dec  1 03:34:32 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (newline_node): always remove NODE_BEGIN.

Fri Nov 30 23:48:07 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (ruby_signal): use SA_SIGINFO if available.
	  [ ruby-Patches-6418 ]

Fri Nov 30 22:52:54 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (trap_signm): SIGVTALRM no longer used for green
	  thread.  [ruby-talk:281318]

	* signal.c (ruby_sig_finalize): do not install SIG_DFL handler if
	  previous handler is sighandler().

Fri Nov 30 21:02:15 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/json.rb, lib/json/add/{core.rb, rails.rb},
	  test/json/test_json_rails.rb: additional files of JSON 1.1.2.
	  [ruby-dev:32405]

Fri Nov 30 19:33:38 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/rubyext.c (rb_syck_mktime): avoid segmentation fault.
	  [ruby-core:13735]

Fri Nov 30 19:05:55 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_count): precise argument number check.

	* enum.c (enum_count): return Enumerator if no block given.

Fri Nov 30 16:42:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_take_while): returns Enumerator if no block given.

	* enum.c (enum_drop_while): ditto.

Thu Nov 29 16:59:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): remove unnecessary NODE_BEGIN.  [ruby-core:13814]

Thu Nov 29 06:45:48 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_eql): recursive comparison should be based on
	  eql?  [ruby-core:13803]

Wed Nov 28 18:08:00 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json, lib/json, test/json: Update to JSON 1.1.2.
	  (RubyForge#15447)

	* math.c: fix typo.

Wed Nov 28 16:29:35 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_invoke_block): should splat args.
	  [ruby-dev:32392]

	* test/ruby/test_yield.rb: add tests for above.

Wed Nov 28 14:43:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): use dldflags instead of DLDFLAGS to
	  get rid of mixing $LDFLAGS and $ARCH_FLAG.

	* lib/mkmf.rb (configuration): ditto.

	* lib/mkmf.rb (create_makefile): support for extensions which has no
	  shared object.

Wed Nov 28 02:42:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (big2str_find_n1): removed extraneous element.
	  [ruby-dev:32351], [ruby-dev:32365]

	* bignum.c (big2str_find_n1): returns necessary digits now.

	* sprintf.c (remove_sign_bits): extends sign bit first.

Tue Nov 27 15:53:43 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): "when *[],1" dumps core.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>.  [ruby-dev:32350]

	* bootstraptest/test_syntax.rb: add a test for above.

Tue Nov 27 15:40:05 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): "a[*b] += 1" dumps core.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>.  [ruby-dev:32354]

	* bootstraptest/test_syntax.rb: add a test for above.

Tue Nov 27 12:47:23 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, insns.def: change return value of "defined?"
	  for $&, $1, ... .  If such variables are defined,
	  return "global-variable".

	* test/ruby/test_defined.rb: add tests.

	* bootstraptest/test_syntax.rb: fix a test.

Tue Nov 27 11:54:46 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def: fix typo.

Tue Nov 27 11:23:20 2007  Koichi Sasada  <ko1@atdot.net>

	* test_beginendblock.rb: add loop to wait signal.
	  [ruby-dev:32332]

Tue Nov 27 11:14:57 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h, encoding.c, re.c, string.c, parse.y:
	  rename ENC_CODERANGE_SINGLE to ENC_CODERANGE_7BIT.
	  rename ENC_CODERANGE_MULTI to ENC_CODERANGE_8BIT.
	  Because single byte 8bit character, such as Shift_JIS 1byte katakana,
	  is represented by ENC_CODERANGE_MULTI even if it is not multi byte.

Tue Nov 27 10:45:45 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_method_missing): fix stack trace.

	* bootstraptest/test_knownbug.rb: move solved tests.

	* bootstraptest/test_method.rb, test/ruby/test_regexp.rb: ditto.

Tue Nov 27 09:57:42 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def, compile.c: fix to allow dsym for alias/undef.
	  [ruby-dev:32355]

	* bootstraptest/test_method.rb: add tests for above.

Mon Nov 26 23:18:46 2007  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/extserv.rb (initialize, stop_service): synchronize with
	  ExtServManager.

	* test/drb/test_drb.rb (TestDRbEval): ignored.

Mon Nov 26 17:32:16 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (Init_Regexp): new method Regexp#fixed_encoding?
	  [ruby-dev:32361]

Mon Nov 26 13:28:14 2007  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/complex.rb: be able to create Complex(0, -0.0). [ruby-list:44268]

Mon Nov 26 11:24:04 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_fixed_encoding_p): extracted from rb_reg_prepare_re and
	  rb_reg_s_union.
	  (rb_reg_s_union): refactored.

Mon Nov 26 10:44:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_read_internal, rb_sysopen_internal): remove C99 dependency.

Sun Nov 25 22:21:35 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h (rb_enc_str_asciionly_p): declared.
	  (rb_enc_str_asciicompat_p): defined.

	* re.c (rb_reg_initialize_str): use rb_enc_str_asciionly_p.
	  (rb_reg_quote): return ascii-8bit string if the argument is
	  ascii-only to generate encoding generic regexp if possible.
	  (rb_reg_s_union): fix encoding handling.  [ruby-dev:32094]

	* string.c (rb_enc_str_asciionly_p): defined.

Sun Nov 25 12:12:03 2007  Eric Hodel  <drbrain@segment7.net>

	* gem_prelude.rb: Import fast-loading gem_prelude.rb from RubyGems.

	* lib/rubygems*: Import RubyGems r1516.

Sat Nov 24 23:25:52 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_eval.rb (TestEval::test_instance_eval_cvar):
	  updated not to modify class variable of Object class.

Fri Nov 23 17:34:24 2007  Koichi Sasada  <ko1@atdot.net>

	* io.c: add rb_read_internal() as blocking function.

Fri Nov 23 17:33:39 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c: fix comment.

Fri Nov 23 17:26:11 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: move solved tests.

	* bootstraptest/test_io.rb, test_marshal.rb, test_objectspace.rb:
	  ditto.

	* test/ruby/test_integer.rb, test_regexp.rb: ditto.

Fri Nov 23 15:59:04 2007  Tanaka Akira  <akr@fsij.org>

	* struct.c (rb_struct_alloc_noinit): new function.
	  (rb_struct_define_without_accessor): add allocator to the arguments.

	* range.c (range_alloc): re-introduced using rb_struct_alloc_noinit.

Fri Nov 23 15:27:43 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (REG_CASESTATE): unused macro removed.
	  (rb_reg_prepare_re): check encoding difference.
	  (rb_reg_initialize): check 8bit byte.

	* parse.y (parser_tokadd_escape): fix has8bit.

	  [ruby-dev:32113]

Fri Nov 23 15:16:48 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_f_global_variables): variable names should not
	  duplicate.  [ruby-dev:32344]

Fri Nov 23 13:34:08 2007  Tanaka Akira  <akr@fsij.org>

	* struct.c (rb_struct_define_without_accessor): new function.

	* range.c (range_alloc): removed.
	  (Init_Range): use rb_struct_define_without_accessor.

	  based on [ruby-dev:32327].

Fri Nov 23 11:01:54 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (match_begin): should return offset by character.
	  [ruby-dev:32331]

	* re.c (match_end): ditto.

	* re.c (rb_reg_search): ditto.

Fri Nov 23 10:44:24 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (defined_expr): defined(method(x)) dumped core.  a
	  patch from Yusuke ENDOH <mame AT tsg.ne.jp>.  [ruby-dev:32335]

Wed Nov 21 18:03:49 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c: fix to recycle thread data (VM stack).

	* thread.c: ditto.

	* benchmark/bm_vm3_thread_create_join.rb: add loop count.

Wed Nov 21 18:02:10 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: add path to trunk/lib if driver runner is
	  in build directory.

Wed Nov 21 16:39:21 2007  Tanaka Akira  <akr@fsij.org>

	* test/fileutils/fileasserts.rb (assert_equal_timestamp): new assert
	  to test tv_sec only for filestamp resolution portability.
	  (assert_same_entry): use assert_same_entry for mtime comparison.

Wed Nov 21 14:55:13 2007  Koichi Sasada  <ko1@atdot.net>

	* array.c (rb_ary_permutation): add gc guard codes.

Wed Nov 21 11:16:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insnhelper.ci (vm_search_normal_superclass): rename function.

	* insnhelper.ci (vm_search_superclass): ditto.

	* proc.c (struct METHOD): rename rklass -> rclass.

Wed Nov 21 03:12:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (rb_f_system): returns nil on execution failure.
	  [ruby-core:13715]

Wed Nov 21 01:04:12 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (nil_plus): remove unused function.  [ruby-core:13737]

Tue Nov 20 21:46:46 2007  Tanaka Akira  <akr@fsij.org>

	* time.c (time_mload): ignore invalid digits in submicro.

Tue Nov 20 20:33:32 2007  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: rename RFloat#double_value -> float_value.

	* numeric.c, parse.y: ditto.

Tue Nov 20 19:36:21 2007  Koichi Sasada  <ko1@atdot.net>

	* gc.h, vm_core.h: decl of rb_gc_save_machine_context()
	  should be at vm_core.h.

	* include/ruby/ruby.h, intern.h: remove type rb_thread_t.

	* include/ruby/intern.h: change rb_unblock_function_t,
	  rb_unblock_function_t.

	* file.c, process.c: apply above changes.

	* thread.c, thread_pthread.ci, thread_win32.ci: ditto.

	* io.c: support blocking open (2). [ruby-core:13614]

Tue Nov 20 17:10:11 2007  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_close_on_exec_p): new method IO#close_on_exec?.
	  (rb_io_set_close_on_exec): new method IO#close_on_exec=.
	  [ruby-dev:32323]

Tue Nov 20 16:24:31 2007  Tanaka Akira  <akr@fsij.org>

	* gc.c (gc_mark_children): obj->as.file.fptr may be 0 for T_FILE.

Tue Nov 20 15:09:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_read_escape): has8bit flag may be set with control
	  escape.  [ruby-core:13722]

	* parse.y (parser_prepare): set begging after BOM if exists.
	  [ruby-core:13718]

Tue Nov 20 14:55:37 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems*: Update to RubyGems 0.9.5.

Tue Nov 20 13:00:44 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h win32/win32.c (rb_w32_pipe_exec): use dual fd
	  instead of socketpair when mode is RDWR.

	* io.c (pipe_open): pass &write_fd to rb_w32_pipe_exec().

	* io.c (popen_redirect): define only when HAVE_FORK.

Tue Nov 20 12:12:04 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h (rb_io_t): add tied_io_for_writing member.

	* io.c: use tied_io_for_writing for duplex popen.

	* gc.c: mark tied_io_for_writing.

	* common.mk: gc.o depends io.h.

	  [ruby-dev:32205]

Tue Nov 20 11:59:33 2007  Tanaka Akira  <akr@fsij.org>

	* test/drb/test_drb.rb: rename TestRubyYield to TestDRbRubyYield to
	  avoid name crash with test/ruby/test_yield.rb.
	  TestRuby18Yield is renamed to TestDRbRuby18Yield too.

Tue Nov 20 03:24:42 2007  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/extservm.rb: merged from ruby_1_8 branch.

	* lib/drb/acl.rb: ditto.

	* lib/drb/ssl.rb: ditto.

	* lib/drb/unix.rb: ditto.

	* lib/drb/drb.rb: ditto.

	* lib/drb/observer.rb: ditto.

	* lib/drb/invokemethod.rb: ditto.

	* test/drb/test_drbssl.rb: ditto.

	* test/drb/test_drb.rb: ditto.

	* test/drb/drbtest.rb: ditto.

	* test/drb/test_drbunix.rb: ditto.

Tue Nov 20 00:52:46 2007  Tanaka Akira  <akr@fsij.org>

	* test/fileutils/fileasserts.rb (assert_equal_time): show nsec if
	  assertion fails but time.to_s equals.
	  (assert_same_entry): use assert_equal_time.

	* test/fileutils/test_fileutils.rb (test_install): use
	  assert_equal_time.

Mon Nov 19 18:46:49 2007  Tanaka Akira  <akr@fsij.org>

	* file.c (utime_internal): fallback utimensat to utimes.

Mon Nov 19 17:51:27 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in: check struct timespec, clock_gettime, utimensat,
	  struct stat.st_atim,
	  struct stat.st_atimespec,
	  struct stat.st_atimensec,
	  struct stat.st_mtim,
	  struct stat.st_mtimespec,
	  struct stat.st_mtimensec,
	  struct stat.st_ctim,
	  struct stat.st_ctimespec,
	  struct stat.st_ctimensec.

	* include/ruby/missing.h: provide struct timespec if not available.

	* time.c: support nanosecond-resolution using struct timespec.
	  (time_nsec): new method: Time#nsec and Time#tv_nsec.

	* include/ruby/intern.h: provide rb_time_nano_new.

	* file.c (utime_internal): use utimensat if available.
	  (rb_file_s_utime): refactored.
	  (rb_f_test): use stat_atime, stat_mtime, stat_ctime.
	  (rb_stat_cmp): check tv_nsec.
	  (stat_atimespec): new function.
	  (stat_atime): ditto.
	  (stat_mtimespec): ditto.
	  (stat_mtime): ditto.
	  (stat_ctimespec): ditto.
	  (stat_ctime): ditto.
	  (rb_stat_atime): use stat_atime.
	  (rb_file_s_atime): ditto.
	  (rb_file_atime): ditto.
	  (rb_stat_mtime): use stat_mtime.
	  (rb_file_s_mtime): ditto.
	  (rb_file_mtime): ditto.
	  (rb_file_ctime): use stat_ctime.
	  (rb_file_s_ctime): ditto.
	  (rb_stat_ctime): ditto.

	* variable.c (rb_copy_generic_ivar): clear clone's instance variables
	  if obj has no instance variable.

	* marshal.c (w_object): dump instance variables of generated string
	  for TYPE_USERDEF, even if original object has instance variables.

	* lib/time.rb (Time#xmlschema): use nsec instead of usec.

	[ruby-dev:32306]

Mon Nov 19 17:48:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_class_superclass): should not raise exception for
	  BasicObject.  [ruby-Bugs-15668]

Mon Nov 19 16:04:08 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_permutation): gives all permutations of elements
	  if no argument given.  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>.
	  [ruby-dev:32309]

Mon Nov 19 02:44:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): alias and undef accept dsyms as well
	  as literals.  [ruby-dev:32308]

Mon Nov 19 02:31:36 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_method.ci (rb_add_method): no redefinition warning for undef.

Mon Nov 19 01:53:11 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_read_escape): disallow control and meta modifiers
	  for non-ASCII characters.  [ruby-core:13685]

Sun Nov 18 20:47:41 2007  Tanaka Akira  <akr@fsij.org>

	* marshal.c (mark_dump_arg): it may be called after dump_ensure.

Sun Nov 18 18:27:47 2007  Tanaka Akira  <akr@fsij.org>

	* time.c (time_minus): fix Time.at(2**60+1) - Time.at(2**60).

Sun Nov 18 17:28:49 2007  Tanaka Akira  <akr@fsij.org>

	* time.c (time_arg): show actual year in 2-3 digits year warning.
	  (time_mdump): show actual year in "year too big to marshal" error.

Sun Nov 18 14:03:44 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_method.ci (rb_alias): do not call hook functions until
	  initialization finishes.  [ruby-talk:279538]

Sun Nov 18 09:09:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (String#tr_cpp): make preprocessor identifiers.

Sun Nov 18 05:19:46 2007  Tanaka Akira  <akr@fsij.org>

	* lib/mkmf.rb (have_struct_member): define HAVE_type_member.

Sat Nov 17 23:51:29 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_invoke): bug fix. [ruby-talk:279100]

Sat Nov 17 23:21:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): should clear parser->tokp as well.
	  [ruby-dev:32250]

	* parse.y: remove NEED_ASSOC that break test_parser_events.

	* parse.y (parser_yylex): should not decrement line numbers at the
	  end of file.

	* file.c (rb_find_file_ext): search .rb files first through in the
	  loadpath.

Fri Nov 16 23:31:18 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_odd_p): new method added.  a patch from Tadashi
	  Saito <shiba AT mail2.accsnet.ne.jp>.  [ruby-dev:32305]

	* bignum.c (rb_big_even_p): ditto.

Fri Nov 16 17:41:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Document-class): moved the simplest example to
	  the top.

	* ext/iconv/iconv.c (iconv_s_iconv): Document-method: needs class
	  prefix for class method.  [ruby-core:13542]

	* ext/iconv/iconv.c (iconv_iconv): also instance method needs to be
	  qualified.

Fri Nov 16 16:26:57 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* include/ruby/ruby.h: added some declarations for event hooks.

	* lib/profile.rb: set VM::InstructionSequence.compile_option.

Fri Nov 16 11:16:41 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/yaml/rubytypes.rb (String#is_binary_data?): use Integer#fdiv.

Fri Nov 16 03:36:01 2007  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c: Node#value defined twice.

	* lib/yaml/: several method redefinitions causing warnings.

Fri Nov 16 03:01:00 2007  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/types.rb: Likewise, pass self to YAML::quick_emit.

Fri Nov 16 02:51:59 2007  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml.rb (quick_emit): use combination of object_id and hash to
	  identify repeated object references, since GC will reuse memory of
	  objects during output of YAML. [ruby-Bugs-8548] [ruby-Bugs-3698]

Thu Nov 15 19:49:03 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/curses/extconf.rb: check macro if cannot find func.
	  [ruby-list:44224]

Thu Nov 15 18:04:06 2007  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb: fix TMP_RUBY_PREFIX for relative load path
	  environment.

Thu Nov 15 17:28:21 2007  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb: absolute path may not start with a slash.
	  pointed by usa.

Thu Nov 15 17:07:54 2007  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb: fix first substitution.
	  use constant for prefix.
	  pointed by Richard Kilmer.

Thu Nov 15 14:29:56 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (prereq): added auto generated sources.  [ruby-dev:32280]

Thu Nov 15 12:31:13 2007  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb: use constant for prefix.

Thu Nov 15 12:24:39 2007  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb: use simple template system for source
	  code generation.

Thu Nov 15 12:19:14 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session::FileStore::restore): use
	  lockfile for exclusive locks.  a patch from <tommy AT tmtm.org>.
	  [ruby-dev:32296]

Thu Nov 15 12:14:53 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* tool/compile_prelude.rb (c_esc): need to escape closing brace.

Thu Nov 15 11:52:16 2007  Tanaka Akira  <akr@fsij.org>

	* tool/compile_prelude.rb: adjust RbConfig::CONFIG paths relative
	  to the installation path.

Thu Nov 15 11:25:20 2007  Tanaka Akira  <akr@fsij.org>

	* ruby.c (usage): fix typo on --disable-gems option.
	  pointed by Richard Kilmer.

Wed Nov 14 16:16:17 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/net/http/test_https_proxy.rb
	  (HTTPSProxyTest::test_https_proxy_authentication): initialize
	  local variable 't' first.  [ruby-dev:32253]

Wed Nov 14 15:39:24 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/socket/test_socket.rb: update not to use 1.8 assignment to
	  external local variable in the block parameters.  [ruby-dev:32251]

	* test/strscan/test_stringscanner.rb: avoid $KCODE, and use
	  String#force_encoding().  [ruby-dev:32251]

Wed Nov 14 14:04:42 2007  Tanaka Akira  <akr@fsij.org>

	* common.mk, Makefile.in: rename prelude.c to miniprelude.c.
	  rename ext_prelude.c to prelude.c

	* win32/Makefile.sub: ditto.

	* bcc32/Makefile.sub: ditto.

Wed Nov 14 07:09:48 2007  Koichi Sasada  <ko1@atdot.net>

	* blockinlining.c, compile.c, compile.h, debug.c, debug.h,
	  id.c, insnhelper.h, insns.def, thread.c, thread_pthread.ci,
	  thread_pthread.h, thread_win32.ci, thread_win32.h, vm.h,
	  vm_dump.c, vm_evalbody.ci, vm_opts.h: fix comments and
	  copyright year.

Wed Nov 14 07:07:51 2007  Koichi Sasada  <ko1@atdot.net>

	* tool/makedocs.rb, template/insnstbl.html: removed.

Wed Nov 14 02:50:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (parse.c): dependency also needs vpath.

	* common.mk (node_name.inc, prelude.c): VPATH in nmake does not
	  work for targets of explicit rules.

Wed Nov 14 02:11:38 2007  Tanaka Akira  <akr@fsij.org>

	* missing/isinf.c (isinf): don't define if the macro is defined.

	* configure.in: no need to set ac_cv_func_isinf=yes on non-gcc
	  solaris.

Wed Nov 14 01:34:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (round): fallback definition.

	* numeric.c (flo_divmod, flo_round): use round() always.
	  [ruby-dev:32269]

Wed Nov 14 00:33:49 2007  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: introduce 2 macros:
	  RFLOAT_VALUE(v), DOUBLE2NUM(dbl).
	  Rename RFloat#value -> RFloat#double_value.
	  Do not touch RFloat#double_value directly.

	* bignum.c, insns.def, marshal.c, math.c, numeric.c, object.c,
	  pack.c, parse.y, process.c, random.c, sprintf.c, string.c,
	  time.c: apply above changes.

	* ext/dl/mkcallback.rb, ext/json/ext/generator/generator.c:
	  ditto.

Wed Nov 14 00:15:37 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/ytab.sed: get rid of GNU sed feature.  a patch from Laurent
	  Sansonetti <laurent.sansonetti AT gmail.com> in [ruby-core:13470].

Tue Nov 13 21:41:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (parse.c), ext/ripper/depend (ripper.c): process after
	  bison with sed.  [ruby-dev:32204]

	* ruby.c (proc_options): use yydebug in cmdline_options.

	* ruby.c (process_options): set yydebug flag of parser.

	* parse.y (yydebug): moved into struct parser_params.

	* parse.y (rb_parser_get_yydebug, rb_parser_set_yydebug): parser
	  generic methods.

	* */Makefile.sub (parse.c): moved to common.mk.

	* tool/ytab.sed: comment out yydebug definition, and substitute
	  yyerror with parser_yyerror.

Tue Nov 13 16:33:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flodivmod): work around for infinity.

	* numeric.c (flo_divmod): work around for platforms have no round().
	  [ruby-dev:32247]

Tue Nov 13 15:26:33 2007  Tanaka Akira  <akr@fsij.org>

	* lex.c.blt: moved from lex.c.

	* lex.c.src: copied from keywords.  This is the source of lex.c.blt.

	* Makefile.in (lex.c): use lex.c.blt if keywords is same as lex.c.src.

	* win32/Makefile.sub (lex.c): re-introduce copy rule.

	* bcc32/Makefile.sub (lex.c): ditto.

	* wince/Makefile.sub (lex.c): ditto.

Tue Nov 13 15:21:52 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_specialized_instruction): check argc.

Tue Nov 13 14:44:32 2007  why the lucky stiff  <why@ruby-lang.org>

	* test/yaml/test_yaml.rb: fixed the failing YAML Struct test
	  at ko1's request.

Tue Nov 13 02:57:04 2007  URABE Shyouhei  <shyouhei@ice.uec.ac.jp>

	* numeric.c (flo_divmod): round to the nearest integer.
	  [ ruby-Bugs-14540 ]

Tue Nov 13 00:36:16 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* test/ruby/test_settracefunc.rb: fixed tests for set_trace_func.

Mon Nov 12 19:47:29 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (call_trace_proc): should return value.

Mon Nov 12 19:45:18 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc,win}32/Makefile.sub (miniruby): use $(COMMONOBJS) and $(DMYEXT)
	  instead of $(LIBRUBY_A).

Mon Nov 12 18:32:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {bcc,win}32/Makefile.sub (MINIOBJS): added prelude.$(OBJEXT).

Mon Nov 12 17:13:23 2007  Tanaka Akira  <akr@fsij.org>

	* Makefile.in, common.mk: add prelude.o to MINIOBJS.

Mon Nov 12 16:52:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): rdoc about srcprefix.  a patch from
	  Daniel Berger <djberg96 AT gmail.com> in [ruby-core:13378].

Mon Nov 12 16:48:09 2007  Tanaka Akira  <akr@fsij.org>

	* Makefile.in, common.mk: add ext_prelude.o to OBJS.

Mon Nov 12 13:57:39 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in (MINIDLNOBJS): removed.
	  (MINIOBJS): set to dln.o if dmydln.o is not used.

	* Makefile.in (miniruby): use MINIOBJS instead of MINIDLNOBJS.

Mon Nov 12 13:53:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): handle stringified
	  symbols properly using ruby-forward-string.

Mon Nov 12 12:17:59 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in (MINIDLNOBJS): defined.

	* Makefile.in (miniruby): use MINIDLNOBJS and COMMONOBJS instead of
	  MINIOBJS and OBJS to avoid linking both dmydln.o and dln.o.

Sun Nov 11 20:32:45 2007  Tanaka Akira  <akr@fsij.org>

	* {win32,wince,bcc32}/Makefile.sub: delete lex.c rule.

Sun Nov 11 19:40:52 2007  Tanaka Akira  <akr@fsij.org>

	* Makefile.in (lex.c): simplified.

Sun Nov 11 18:31:48 2007  Tanaka Akira  <akr@fsij.org>

	* Makefile.in (lex.c): touch lex.c if gperf failed but lex.c exists.
	  Although this may cause non-updated lex.c,
	  svn co may generate keywords newer than lex.c especially on
	  a file system which can record fractional mtime such as XFS.

Sun Nov 11 17:32:46 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* insnhelper.ci (vm_call_method): pass mn->nd_clss to
	  vm_call_cfunc() instead of klass.

	* vm.c (rb_thread_method_id_and_klass): traverse parent_iseq.

	* thread.c (call_trace_proc): use rb_thread_method_id_and_klass().

Sun Nov 11 16:54:25 2007  Tanaka Akira  <akr@fsij.org>

	* lex.c: renamed from lex.c.blt.

	* Makefile.in (lex.c): use find command to check mtime.

Sun Nov 11 05:34:13 2007  Eric Hodel  <drbrain@segment7.net>

	* bin/gem: Add forgotten gem command.

Sat Nov 10 23:50:31 2007  Tanaka Akira  <akr@fsij.org>

	* string.c (tr_trans): cast to unsigned char after dereference
	  a pointer to a char to avoid SEGV with "\377".tr("a", "b").
	  on FreeBSD/amd64.

Sat Nov 10 23:08:53 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in, common.mk, Makefile.in: don't generate
	  libminiruby-static.a.

Sat Nov 10 19:46:54 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in, common.mk, Makefile.in: generate libminiruby-static.a
	  which contains prelude.o for miniruby.

Sat Nov 10 18:10:07 2007  Tanaka Akira  <akr@fsij.org>

	* gem_prelude.rb: new file for gem libraries.  currently empty.

	* common.mk: generate ext_prelude.c by prelude.rb and gem_prelude.rb.
	  ruby (not miniruby) is linked with ext_prelude.o instead of
	  prelude.o.

	* inits.c (rb_call_inits): don't call Init_prelude.

	* ruby.c: support --disable-gems option.
	  (ruby_init_gems): new function to define Gem::Enable and
	  invoke Init_prelude.
	  (process_options): call ruby_init_gems just after
	  ruby_init_loadpath.

	* tool/compile_prelude.rb: support multiple files.

Sat Nov 10 17:27:55 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* thread.c (call_trace_proc): don't call ID2SYM() for ID_ALLOCATOR
	  to avoid SEGV.

Sat Nov 10 16:37:07 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems: Import RubyGems revision 1493.

	* lib/rubygems.rb: ditto.

	* lib/ubygems.rb: ditto.

	* lib/rbconfig/datadir.rb: ditto.

	* test/rubygems: ditto.

Sat Nov 10 16:34:21 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/soap/property.rb: Don't override Enumerable#inject for 1.9.

Sat Nov 10 14:43:30 2007  David Flanagan  <davidflanagan@ruby-lang.org>

	* parse.y: use ASCII encoding for string literals that are
	  7-bit clean, fixing regression from my previous patch

Sat Nov 10 13:18:54 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {bcc32,win32}/Makefile.sub: vendor_ruby support.

Fri Nov  9 23:33:16 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_nextc): added single line read forward buffer.

	* parse.y (parser_yylex): adjust line number for fluent interface.

Fri Nov  9 22:04:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.h (FRAME_MAGIC_MASK_BITS): bits of FRAME_MAGIC_MASK.

	* insnhelper.ci (vm_call_cfunc, vm_cfunc_flags): use shift operations.

Fri Nov  9 21:46:28 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (eval): should be volatile value for GC.

Fri Nov  9 17:48:22 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (locale_encoding): guesstimate encoding from environment
	  variables.  [ruby-core:13315]

	* ruby.c (process_options): set primary encoding from environment.

Fri Nov  9 16:51:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_each_byte): should update rbuf_off and rbuf_len for
	  each iteration.  [ruby-dev:31659][ruby-dev:32192]

	* variable.c (rb_cvar_set): cvar assignment obey same rule to cvar
	  reference.  [ruby-dev:32192]

Fri Nov  9 15:52:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_check_encoding, rb_set_primary_encoding): ENCODING
	  is no longer in FL_USERS flags.

Fri Nov  9 15:20:13 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_squeeze_bang): initialize squeezing table if no
	  arguments given.

Fri Nov  9 13:57:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (each_with_index_i): use rb_yield_values() for
	  compatibility with Enumerator#with_index().  a patch from Yusuke
	  ENDOH <mame AT tsg.ne.jp>.  [ruby-dev:32195]

Fri Nov  9 13:45:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_iterator.rb (TestIterator::IterTest::each):
	  #each_pair is now alias to #each.  [ruby-dev:32192]

	* test/ruby/test_iterator.rb (TestIterator::test_assoc_yield):
	  ditto

Fri Nov  9 12:56:36 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_load.c (loaded_feature_path): check with type of given feature.

Fri Nov  9 12:43:02 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_basicinstructions.rb: updated for new class
	  behavior.  [ruby-dev:32192]

	* encoding.c (enc_name): Encoding should not rely on ENCODING in
	  the FL_USERS flags.

	* encoding.c (rb_enc_from_encoding): do not call rb_enc_associate
	  for encoding itself.

	* encoding.c (enc_register_at): ditto.

	* marshal.c (r_ivar): do not set real instance variable for
	  encoding data associated.

Fri Nov  9 10:43:55 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (send_internal): use self in the previous frame to check for
	  protected methods.  [ruby-core:13254]

	* insnhelper.ci (vm_call_method): send! method has gone.

Fri Nov  9 10:38:13 2007  Koichi Sasada  <ko1@atdot.net>

	* marshal.c (w_object): should be SPECIAL_CONST_P() instead of
	  IMMEDIATE_P().

Fri Nov  9 10:29:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_invoke_method): check if invoked in function style.
	  [ruby-core:13245]

	* insnhelper.ci (vm_call_cfunc, vm_cfunc_flags): stores and returns VM
	  calling flags.

	* vm.c (rb_vm_cfunc_funcall_p): returns if the current method is
	  invoked in function style.

Fri Nov  9 10:10:21 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: add rb_context_t#type.

Fri Nov  9 10:05:54 2007  Koichi Sasada  <ko1@atdot.net>

	* ruby.c (set_arg0): fix breaking environ bugs.

Fri Nov  9 07:26:04 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* random.c: update MT URL.[ruby-core:13305].

Thu Nov  8 17:09:55 2007  David Flanagan  <davidflanagan@ruby-lang.org>

	* object.c: improve docs for Object.tap

	* ChangeLog: fix bogus dates on my previous entries

Thu Nov  8 15:13:56 2007 David Flanagan <davidflanagan@ruby-lang.org>

	* parse.y: fix segfault with \x escapes in regexps
	  delete unused #if 0 code regions from previous patch

Thu Nov  8 12:12:10 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (parser_read_escape): remove C99/gcc-ism.

Thu Nov  8 07:54:22 2007 David Flanagan <davidflanagan@ruby-lang.org>

	* parse.y: patch, based on Nobu's, work to support \u escapes
	           also modifications for better coderange detection

	* test/ruby/test_unicode_escapes.rb: test cases

	* test/ruby/test_mixed_unicode_escapes.rb: mixed encoding test cases

Thu Nov  8 07:14:37 2007 David Flanagan <davidflanagan@ruby-lang.org>

	* parse.y (rb_intern3): commented out broken code that prevented
	  correct interning of multi-byte symbols.  Without this patch
	  :x==:x is false when x is a multi-byte character.

Thu Nov  8 07:04:31 2007 David Flanagan <davidflanagan@ruby-lang.org>

	* string.c (tr_setup_table, tr_trans): fix test failures
	  in test/ruby/test_string.rb

Wed Nov  7 15:07:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_each_with_index): make different arrays at each
	  iteration.  [ruby-dev:32181]

Wed Nov  7 05:17:24 2007  David Flanagan <davidflanagan@ruby-lang.org>

	* eval.c: fix typo in invoke_method documentation

Wed Nov  7 03:52:26 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_product): core dumped with non array arguments.
	  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>.  [ruby-dev:32180]

Wed Nov  7 03:32:38 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/encodings/SHIFT-JIS.rb (REXML::Encoding): place -x for
	  nkf conversion.  a patch from <moonwolf AT moonwolf.com>.
	  [ruby-dev:32183]

Wed Nov  7 02:59:49 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_each_index): should return meaningful value.

Tue Nov  6 16:37:47 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_load.c (loaded_feature_path): need to expand relative paths.

	* eval_load.c (rb_feature_p): check if the feature is loading with
	  load path.  [ruby-dev:31932]

	* eval_load.c (load_lock): check the result of barrier waiting.

	* thread.c (rb_barrier_wait): check if owned by the current thread.

	* thread.c (rb_barrier_release): ditto.

Mon Nov  5 08:01:22 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_eval): move #send to Kernel module from BasicObject.

Mon Nov  5 05:17:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Switch::summarize): fix for long form
	  option with very long argument.  a patch from Kobayashi Noritada
	  <nori1 AT dolphin.c.u-tokyo.ac.jp> in [ruby-list:44179].

Mon Nov  5 01:20:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (call_args): remove "parenthesize argument(s) for future
	  version" warning.  when I added this warning, I had a plan to
	  reimplement the parser that is simpler than the current one.
	  since we abandoned the plan, warning no longer required.

Mon Nov  5 01:02:56 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (HTTPHeader#initialize): provide default
	  User-Agent to fix 500 error on some corrupted HTTP servers.
	  [ruby-core:13135]

Mon Nov  5 00:32:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_send): allow send/__send__ to call methods of all
	  visibility again.  we no longer provide __send, __send!.

	* eval.c (rb_invoke_method): new method to honor private
	  visibility.  if it's invoked in a function call style, it calls
	  private methods as well (previous 1.9 send behavior).

Mon Nov  5 00:24:24 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub: vendor_ruby support.

	* configure.in (RUBY_LIB): duplicated.

Mon Nov  5 00:01:33 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_quote): quote \v as well.

Sun Nov  4 23:51:59 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_initialize_m): use StringValuePtr instead of
	  StringValueCStr because \0 exists when Regexp.new("\0").

Sun Nov  4 08:11:19 2007  Tanaka Akira  <akr@fsij.org>

	* gc.c (count_objects): count TOTAL.

Sun Nov  4 03:58:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (tr_setup_table): use C array for characters that fit
	  in a byte to gain performance.

	* string.c (rb_str_delete_bang): ditto.

	* string.c (rb_str_squeeze_bang): ditto.

	* string.c (rb_str_count): ditto.

	* string.c (tr_trans): ditto.

Sun Nov  4 00:06:40 2007  Tanaka Akira  <akr@fsij.org>

	* gc.c (count_objects): ObjectSpace.count_objects implemented.
	  [ruby-core:12301]

Sat Nov  3 22:49:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_each_pair): make Hash#each to be alias to
	  Hash#each_pair for compatibility and clarity.

	* hash.c (env_each_pair): ditto.

Sat Nov  3 22:41:05 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in: --with-vendor-hdrdir implemented.

	* lib/mkmf.rb: check --vendor argument.

	* README.EXT: explain --vendor option for extconf.rb

	* README.EXT.ja: ditto.

Sat Nov  3 20:30:48 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in: --with-vendordir implemented.

	* mkconfig.rb: add config to vendorlibdir and vendorarchdir.

	* instruby.rb: make vendor library directories.

	* ruby.c: insert vendor library directories into load path.

Fri Nov  2 20:55:49 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/content.rb, lib/rss/content/, lib/rss/maker/content.rb,
	  test/rss/test_content.rb, test/rss/test_maker_content.rb,
	  test/rss/rss-testcase.rb (RSS::TestCase): supported
	  content:encoded with RSS 2.0.
	  Suggested by Sam Lown. Thanks.

Fri Nov  2 20:47:04 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb, test/rss/test_version.rb: 0.2.0 -> 0.2.1.

Thu Nov  1 21:56:45 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (Init_Exception): make NameError to be subclass of
	  StandardError again.

	* error.c (Init_Exception): make SecurityError to be subclass of
	  Exception, since it's too important to be handled implicitly.

Thu Nov  1 14:51:39 2007 David Flanagan <davidflanagan@ruby-lang.org>
	* enum.c (take_while_i, drop_while_i) add RTEST to handle nil return

Thu Nov  1 02:12:50 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (prereq): update the path of prelude.c.

	* common.mk (prelude.c): rollback a part of r13675, because it is not
	  documented and causes build error.

Thu Nov  1 01:52:23 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enum.c (enum_drop): fix typo.

Thu Nov  1 01:51:01 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_core.h (ruby_current_thread): RUBY_EXTERN'ed for probeprofiler.

Thu Nov  1 00:46:30 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/configure.bat, setup.mak: now can recognize OS even if
	  the ``--target'' option of configure is omitted.

	* win32/README.win32: update the descriptions about compiler.

Wed Oct 31 03:13:41 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_take_while): separate with-block form.

	* enum.c (drop_while_i): ditto.

	* enum.c (enum_butfirst): abandon butfirst method.  reverted.

Tue Oct 30 10:03:43 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_butfirst): add a new method to iterates over
	  elements but first n.  RDoc need to be updated.

	* enumerator.c (Init_Enumerator): remove unnecessary symbol
	  initialization.

Mon Oct 29 18:42:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (bvar): block-local variable can shadow outer variable.
	  [ruby-core:13036]

Mon Oct 29 17:58:16 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_substr): performance improvement.  [ruby-dev:31806]

Mon Oct 29 17:20:13 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_replicate): new function to replicate encoding.

	* encoding.c (enc_based_encoding): Encoding#base_encoding returns
	  based encoding of replica.

Mon Oct 29 17:18:36 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_compatible): ASCII encoding is compatible with
	  ASCII-compatible encoding, even for non-string objects.

Sun Oct 28 21:50:02 2007  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb: :redirect option implemented to disable redirects.
	  (OpenURI::HTTPRedirect): new exception class for redirection.

Fri Oct 26 17:38:13 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (int_chr): take an optional encoding parameter.
	  [ruby-core:12816]

Fri Oct 26 17:14:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (fix_pow): returns 1.0 for 0**0.0.

	* numeric.c (fix_pow): returns infinity for 0**-1.  [ruby-dev:32084]

Fri Oct 26 15:00:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el (ruby-style-{case,label}-indent): adjust for
	  labels inside switch block.

Fri Oct 26 05:48:57 2007  David Flanagan <davidflanagan@ruby-lang.org>
	* array.c: raise IndexError for negative length in rb_ary_fill

Wed Oct 25 07:12:03 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/net/telnet.rb (Net::Telnet#login): Allowing "passphrase" in
	  addition to "password" for Telnet login prompts. [ruby-Bugs-10746]

Wed Oct 25 06:34:11 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/net/telnet.rb (Net::Telnet#login): Making the password prompt
	  pattern case insensitive. [ruby-Bugs-10746]

Fri Oct 26 04:21:36 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/pop.rb (Net::POP3::do_start): type fixed.  a patch from
	  Dan Zwell <dzwell AT zwell.net> in [ruby-core:12941].

Fri Oct 26 01:48:28 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_assoc): check and convert inner arrays (assocs)
	  using #to_ary.

	* hash.c (rb_hash_s_create): check and convert argument hash
	  using #to_hash.

	* hash.c (rb_hash_s_create): Hash#[] now takes assocs as source of
	  hash conversion.

Thu Oct 25 16:46:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): dot at the head of the line denote line
	  continuation from previous one to support fluent interface.
	  [experimental]

	* misc/ruby-mode.el (ruby-calculate-indent): support fluent dot.

Thu Oct 25 14:19:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_tell, rb_io_seek): check errno too.  [ruby-dev:32093]

Thu Oct 25 13:59:53 2007 David Flanagan <davidflanagan@ruby-lang.org>

	* parse.y (parser_tokspace): increment tokidx
	  fixes test failure at [test/ruby/test_stringchar.rb:72]

Thu Oct 25 09:49:49 2007  akira yamada  <akira@ruby-lang.org>

	* lib/uri.rb, lib/uri/ldaps.rb: added LDAPS
	  scheme. [ruby-dev:31896]

Wed Oct 25 06:23:14 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/xmlrpc/parser.rb (XMLRPC::Convert::dateTime): Fixing a bug that
	  caused time zone conversion to fail for some ISO 8601 date formats.
	  [ruby-Bugs-12677]

Wed Oct 25 04:59:28 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client#do_rpc): Explicitly start
	  the HTTP connection to support keepalive requests. [ruby-Bugs-9353]

Wed Oct 25 04:46:53 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client#do_rpc): Improving the error
	  message for Content-Type check failures. [ruby-core:12163]

Wed Oct 25 03:45:08 2007  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/xmlrpc/utils.rb (XMLRPC::ParseContentType#parse_content_type):
	  Making Content-Type checks case insensitive. [ruby-Bugs-3367]

Wed Oct 24 17:09:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokspace): make space in token buffer.

	* parse.y (parser_yylex): fix encoding of single character literal.

Tue Oct 23 13:44:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (call_args2): nd_head of NODE_BLOCK_PASS should be a list.
	  [ruby-core:12850]

Tue Oct 23 10:42:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): encoding set by command line option takes
	  priority over the encoding in the source, as the primary encoding.

Mon Oct 22 19:24:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (proc_options): allow space after -E (encoding) option.

Mon Oct 22 11:03:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_check_encoding): returns index now.

	* encoding.c (rb_enc_compatible): check if two objects have compatible
	  encodings.

	* encoding.c (enc_compatible_p): added Encoding.compatible?.

	* include/ruby/encoding.h (rb_enc_compatible): prototype.

Sun Oct 21 18:29:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_default, rb_enc_primary): return pointers to
	  rb_encoding of default and primary respectively.  [ruby-core:12795]

	* encoding.c (set_primary_encoding): removed primary_encoding setter.

Sat Oct 20 13:17:01 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_cycle): hide temporary array from ObjectSpace.
	  [ruby-core:12762]

Sat Oct 20 11:49:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_get_path): returns frozen string.

	* file.c (rb_file_s_chown, rb_file_s_lchown): use uid_t and gid_t.

Fri Oct 19 20:08:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_id_encoding): returns ID "encoding".

	* marshal.c (w_encoding): dump encoding name.

	* marshal.c (r_ivar): load encoding.

Fri Oct 19 16:41:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_regx_options, reg_compile_gen): relaxened encoding
	  matching rule.

	* re.c (rb_reg_initialize): always set encoding of Regexp.

	* re.c (rb_reg_initialize_str): fix encoding for non 7bit-clean
	  strings.

	* re.c (rb_reg_initialize_m): use ascii encoding for 'n' option.

Fri Oct 19 11:09:56 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): set primary encoding from the parser
	  always.  [ruby-core:12758]

	* ruby.c (load_file): should not discard the parser parameter.

Fri Oct 19 10:55:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (range_last): removed unused variables.

Thu Oct 18 17:08:57 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_find_index): update RDoc.  a patch from David Flanagan
	  <david AT davidflanagan.com> in [ruby-core:12710].

	* enum.c (enum_take, enum_drop): ditto.

	* enum.c (enum_cycle): should not cause infinite loop for empty
	  arrays.  [ruby-core:12710]

	* range.c (Init_Range): typo fixed.

Thu Oct 18 16:39:34 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/source.rb (REXML::SourceFactory::SourceFactory): more
	  duck typed.  better performance on JRuby.
	  http://headius.blogspot.com/2007/10/another-performance-discovery-rexml.html

Thu Oct 18 09:33:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_first): takes first n element if argument is
	  given.  [ruby-core:12697]

	* range.c (range_last): returns last n elements if argument is
	  given.

	* array.c (rb_ary_subseq, rb_ary_last): export.

Wed Oct 17 17:39:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): fixed reversed condition.  [ruby-core:12722]

Wed Oct 17 13:54:28 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_s_union): the last check was not complete.

Wed Oct 17 11:30:55 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_from_encoding, rb_enc_register): associate index
	  to self.

	* encoding.c (enc_capable): Encoding objects are encoding capable.

	* re.c (rb_reg_s_union): check if encoding matching by exact encoding
	  objects.

Wed Oct 17 06:18:06 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_alias, rb_enc_find_index): changed
	  enc_table_alias to a name-to-index hash.

	* encoding.c (rb_enc_init): use upper case names for aliases to use as
	  constant names.

	* encoding.c (enc_find): allow symbols.

	* encoding.c (Init_Encoding): define encoding constants.

	* st.c (strcasehash): fix wrong code range condition.

Wed Oct 17 05:07:18 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_primary_encoding): added Encoding.primary_encoding.

	* parse.y (rb_parser_encoding): added.

	* ruby.c (proc_options): added -E and --encoding options.

	* ruby.c (process_options): set primary encoding from command line
	  option if set, or source encoding.

	* include/ruby/encoding.h (rb_enc_from_encoding,
	  rb_get_primary_encoding, rb_set_primary_encoding): prototypes.

	* include/ruby/node.h (rb_parser_encoding): prototype.

Wed Oct 17 03:37:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_desc): set encoding.

	* re.c (rb_reg_s_union): check encodings.

	* enc/utf8.c (utf8_code_to_mbclen): 0xfe and 0xff are valid Unicode to
	  be encoded to 2bytes in UTF-8.  [ruby-core:12700]

Wed Oct 17 02:50:49 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_ord): use encoding.

Wed Oct 17 01:57:06 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_initialize_m): allow binary encoding option.
	  [ruby-dev:32083]

Tue Oct 16 19:48:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_reg_s_union): check for encoding of original object.

Tue Oct 16 18:28:51 2007  Tanaka Akira  <akr@fsij.org>

	* debug.c: use enum for constants for gdb if possible.

Tue Oct 16 18:20:10 2007  Tanaka Akira  <akr@fsij.org>

	* ruby.c, debug.c: move debug enum and constants to debug.c.

Tue Oct 16 18:16:15 2007  Tanaka Akira  <akr@fsij.org>

	* ruby.c (RUBY_ENCODING_SHIFT): added as enum.

	* .gdbinit (rp): show encoding and coderange for strings.

Tue Oct 16 14:48:38 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_regx_options): check if regexp encoding option
	  matches to current encoding.

	* re.c (char_to_option, rb_char_to_option_kcode): 'n' is not kcode
	  option now.

	* re.c (rb_reg_to_s, rb_reg_error_desc): copy encoding rather than
	  append as an option.

	* re.c (make_regexp, rb_reg_prepare_re): use encoding of Regexp and
	  String instead of kcode.

	* re.c (rb_reg_initialize): set fixed option if none is set.

	* re.c (rb_reg_regcomp): ditto.

	* re.c (rb_reg_equal): check if encodings are equal.

	* re.c (rb_reg_initialize_m): encoding option is obsolete.

	* re.c (rb_kcode, rb_get_kcode, rb_set_kcode): removed.

	* re.c (Init_Regexp): removed Regexp#kcode method.

	* ruby.c (proc_options): allow long encoding name.

Tue Oct 16 14:03:09 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_s_union): encoding of all regexp objects should
	  match.  [ruby-dev:32076]

Tue Oct 16 13:49:41 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (enc_to_s): rename function.

Tue Oct 16 13:25:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_new4): should copy encoding.  a patch from NARUSE,
	  Yui <naruse AT airemix.com>.  [ruby-dev:32076]

Tue Oct 16 01:31:23 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_inject): RDoc update.  a patch from David Flanagan
	  <david AT davidflanagan.com> in [ruby-core:12710].

Tue Oct 16 01:25:40 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (Init_Encoding): define #to_s to show encoding name
	  in to_s representation as well as #inspect.

Mon Oct 15 13:24:08 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): should be number but not rounding factor.
	  [ruby-dev:32060]

Mon Oct 15 11:45:12 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_bytes0): refined length check.  [ruby-dev:32059]

Mon Oct 15 10:24:19 2007  Tanaka Akira  <akr@fsij.org>

	* process.c (pst_to_s): returns a string such as "pid 10220 exit 1"
	  instead of "256".  [ruby-dev:32053]
	  (pst_inspect): change format
	  "#<Process::Status: pid=10220,exited(1)>" to
	  "#<Process::Status: pid 10220 exit 1>".

Mon Oct 15 09:58:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_bytes0): check if source has enough data.
	  [ruby-dev:32054]

Mon Oct 15 01:15:09 2007  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (s_accept_nonblock): make accepted fd
	  nonblocking.  [ruby-talk:274079]

Sun Oct 14 17:31:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_obj_encoding): rdoc update.  a patch from David
	  Flanagan <david AT davidflanagan.com>.  [ruby-core:12664]

	* encoding.c (enc_dump, enc_load): marshaling feature.  a patch from
	  David Flanagan.  [ruby-core:12665]

	* encoding.c (Init_Encoding): undefine allocator of Encoding.
	  [ruby-core:12665], [ruby-core:12666]

	* test/ruby/test_encoding.rb: tests for Encoding from David Flanagan
	  [ruby-core:12665]

Sun Oct 14 11:09:09 2007  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb (PP::PPMethods#pp_hash): don't sort keys because hash is
	  ordered.
	  (ENV.pretty_print): call pp_hash with sorted hash.

Sun Oct 14 04:08:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (AC_SYS_LARGEFILE): keep results also in command
	  options, to vail out of mismatch.  [ruby-list:44114]

	* mkconfig.rb, lib/mkmf.rb (configuration): add DEFS.

Sun Oct 14 03:55:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/mkexports.rb: deal with __fastcall name decorations.
	  [ruby-list:44111]

Sun Oct 14 02:20:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_cEncoding): new Encoding class.

	* encoding.c (rb_to_encoding, rb_to_encoding_index): helper functions.

	* encoding.c (rb_obj_encoding): return Encoding object now.

	* gc.c (garbage_collect): mark Encoding objects.

	* inits.c (rb_call_inits): call Init_Encoding.

	* string.c (rb_str_force_encoding): accept Encoding object as well as
	  encoding name.

	* include/ruby/encoding.h (rb_to_encoding_index, rb_to_encoding):
	  prototypes.

Sun Oct 14 01:03:30 2007  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (OpenURI.open_http): fix :ssl_ca_cert option.

Sat Oct 13 21:23:21 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (foletype_s_ole_classes,
	  foletype_s_typelibs): refactoring.

	* test/win32ole/test_win32ole_type.rb: add some test.

	* ext/win32ole/win32ole.c (Init_win32ole): change method name
	  WIN32OLE_TYPELIB.ole_types from WIN32OLE_TYPELIB.ole_classes.

	* test/win32ole/test_win32ole_typelib.rb: ditto.

	* test/win32ole/test_folderitem2_invokeverb.rb: check create
	  shortcut string more strictly (This test is invoked in Japanese
	  Windows environment).

Sat Oct 13 09:11:58 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (set_file_encoding): case-insensitive search, a patch from
	  David Flanagan <david AT davidflanagan.com> [ruby-core:12629]

Sat Oct 13 09:02:16 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {bcc,win}32/mkexports.rb: explicit data.  [ruby-list:44108]

Sat Oct 13 00:17:49 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/document.rb (REXML::Document::write): leaky
	  modification trans -> transitive.  [ruby-dev:32040]

Sat Oct 13 00:00:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: encoding specifier should work if the line matches
	  /coding[:=] ?/, a la Python PEP-263, so that VIM comments like
	  "# vim: set fileencoding=<encoding name>" should be recognized.

Fri Oct 12 15:04:54 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (magic_comments): add "encoding" as same as "coding".

	* parse.y (set_file_encoding): special file encoding handling.

	* parse.y (parser_yylex): ditto.

Fri Oct 12 12:44:11 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_combination): fixed memory corruption due to too
	  small memory allocation

	* array.c (rb_ary_product): accessing out of memory bounds.
	  condition fixed.

Fri Oct 12 11:22:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (match_values_at): make #select to be alias to #values_at
	  to adapt RDoc description.  [ruby-core:12588]

Thu Oct 11 21:10:17 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/node.h (NOEX_LOCAL): remove unused local visibility.

	* class.c (ins_methods_push): ditto.

	* class.c (rb_class_local_methods): method removed.

Thu Oct 11 14:29:31 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* */Makefile.sub (COMMON_MACROS): workaround for old SDK's bug.
	  [ruby-core:12584]

Thu Oct 11 06:35:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, */Makefile.sub (VPATH): add enc directory.

	* common.mk (ENCOBJS): encoding objects.

	* enc: directory for encodings.

Thu Oct 11 00:04:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/oniguruma.h (OnigEncodingTypeST): add OnigEncoding
	  parameter to every function members.

	* include/ruby/oniguruma.h (OnigEncodingTypeST): add auxiliary
	  data member to provide user defined data for an encoding.

Wed Oct 10 23:32:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_s_quote): no longer takes optional second argument
	  that has never been documented.

Wed Oct 10 15:39:04 2007  Tanaka Akira  <akr@fsij.org>

	* encoding.c (rb_enc_init): don't alias iso-8859-1 to ascii.

	* ascii.c (OnigEncodingASCII): change the name US-ASCII to ASCII-8BIT.

Wed Oct 10 14:31:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_enc_str_coderange): fixed check for non-ascii.

Tue Oct  9 21:35:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_permutation, rb_ary_combination): missing type
	  names.

	* array.c (rb_ary_permutation): used buffer should be t1.

	* array.c (rb_ary_permutation): use frozen shared hidden array.
	  [ruby-dev:31985]

Tue Oct  9 16:58:10 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c: remove to_a completely.

	* array.c (tmpbuf): keep DRY to clear klass of temporary objects.

Tue Oct  9 16:33:32 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_permutation, rb_ary_combination, rb_ary_product):
	  hide internal buffer objects.  [ruby-dev:31982]

Tue Oct  9 16:00:32 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (parser_read_escape, parser_tokadd_escape): check code range.
	  [ruby-dev:31980]

Tue Oct  9 15:40:24 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (STR_NEW3): check for if single byte sequence.

Mon Oct  8 20:06:29 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/net/imap.rb, lib/net/smtp.rb, lib/net/pop.rb: hostname should
	  be verified against server's identity as presented in the server's
	  certificate. [ruby-dev:31960]

	* ext/openssl/lib/net/telnets.rb, ext/openssl/lib/net/ftptls.rb: ditto.

Sun Oct  7 22:37:47 2007  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_taxonomy.rb, test/rss/test_parser_1.0.rb,
	  test/rss/test_image.rb, test/rss/rss-testcase.rb: ensured
	  declaring XML namespaces.

Sun Oct  7 22:00:01 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/node.h: make node flags as VALUE type.
	  enum ruby_node_flags removed.

	* ruby.c: define RUBY_NODE_* as const for gdb.

Sun Oct  7 18:57:12 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h: enum ruby_value_flags removed.  [ruby-dev:31959]

	* ruby.c: define RUBY_FL_* as const VALUE for gdb.

Sun Oct  7 17:50:14 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/net/http.rb: remove enable_post_connection_check flag.

	* lib/open-uri.rb: ditto.

Sun Oct  7 15:48:40 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def (opt_eq): fix to use rb_str_equal().

Sat Oct  6 23:14:54 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_to_i): update RDoc since base can be any value
	  between 2 and 36.  [ruby-talk:272879]

Sat Oct  6 16:24:02 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (cont_free): check Fiber or Continuation.

	* bootstraptest/test_knownbug.rb: remove a fixed test.

Sat Oct  6 14:56:02 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_register): returns new index or -1 if failed.

	* encoding.c (rb_enc_alias): check if original name is registered.

	* encoding.c (rb_enc_init): register in same order as kcode options in
	  re.c.  added new aliases.

	* string.c (rb_str_force_encoding): check if valid encoding name.

Sat Oct  6 14:32:30 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (opt_eq): get rid of gcc bug.

Sat Oct  6 02:34:18 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/defines.h: no longer provide DEFAULT_KCODE.

Fri Oct  5 21:24:59 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (rb_reg_s_union_m): Regexp.union accepts single argument which
	  is an array of patterns.  [ruby-list:44084]

Fri Oct  5 16:42:27 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_not_match): new method.

Fri Oct  5 16:15:52 2007  Akinori MUSHA  <knu@iDaemons.org>

	* configure.in: Turn on --enable-pthread by default for FreeBSD
	  5.2.1-RELEASE and later, and remove pthread support for older
	  versions which has never worked perfectly.

Fri Oct  5 16:11:50 2007  Akinori MUSHA  <knu@iDaemons.org>

	* time.c (time_to_s): Fix documentation.  Time format changed.

Fri Oct  5 04:02:39 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb (in_addr, in6_addr, addr_mask): Make some minor
	  code optimization.

Fri Oct  5 03:25:51 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb (<=>): Implement IPAddr#<=> and make IPAddr
	  comparable.

	* lib/ipaddr.rb (succ): Implement IPAddr#succ.  You can now create
	  a range between two IPAddr's, which (Range) object is
	  enumerable.

	* lib/ipaddr.rb (to_range): A new method to create a Range object
	  for the (network) address.

Fri Oct  5 03:14:45 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb (coerce_other): Support type coercion and make &,
	  |, == and include? accept a string or an integer instead of an
	  IPAddr object as the argument.

	* lib/ipaddr.rb (initialize): Give better error messages.

	* lib/ipaddr.rb: Improve documentation.

Thu Oct  4 20:45:53 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (Init_process): win32 has our own WNOHANG definition, so
	  remove unnecessary #ifdef guard.

Thu Oct  4 20:17:19 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* array.c (rb_ary_permutation, rb_ary_product): support non C99
	  compilers.

Thu Oct  4 17:33:18 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (kcode_setter): Perl-ish global variable `$=' no longer
	  effective.

	* io.c (Init_IO): remove obsolete variables: $defout, $deferr.

	* re.c (Init_Regexp): remove obsolete const alias: MatchingData.

	* time.c (Init_Time): remove obsolete Time::times.

	* re.c (ignorecase_setter): change warning message.

	* re.c (ignorecase_getter): now gives warning.

	* string.c (rb_str_cmp_m): update RDoc document.

	* re.c (kcode_setter): restore erroneously removed setter.

Thu Oct  4 16:28:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_obj_encoding): returns encoding of the given object.

	* parse.y (reg_compile_gen): copy encoding from source string if
	  non-empty.

	* re.c (Init_Regexp): new method Regexp#encoding.

	* string.c (str_encoding): moved to encoding.c

Thu Oct  4 15:49:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_permutation): remove C99 dependency.
	  [ruby-dev:31934]

	* array.c (rb_ary_product): ditto.

Wed Oct  3 23:37:17 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/nkf/nkf.c, bin/ri, bin/irb: fixed typos in doc and comments.
	  a patch from Eugene Ossintsev  <eugoss AT gmail.com>.
	  [ruby-core:12375]

Wed Oct  3 17:56:22 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: enable specify label to executable.
	  (-e "ruby1::/path/to/ruby1; ruby2::/path/to/ruby2; ...")

Wed Oct  3 16:58:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_str_new, parser_yylex, rb_intern3): set code-range
	  bits.

	* parse.y (parser_tokadd_string): check code-range.

	* parse.y (parser_parse_string, parser_here_document): ditto.

	* parse.y (parser_set_encode): check if valid encoding.

Wed Oct  3 15:43:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_cvar_set): check whether class variable is
	  defined in superclasses.  root classes have higher priority.
	  removes lower class variable entry from IV_TBL (if it's defined
	  in classes, not modules).

	* variable.c (rb_cvar_get): ditto.

Wed Oct  3 10:06:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_process_options): push frame with program name.
	  [ruby-core:12351]

Tue Oct  2 20:16:55 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (init_env): refactoring. remove unused code.

Tue Oct  2 12:30:40 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_product): generalized product, now takes
	  arbitrary number of arrays.  a patch from David Flanagan
	  <david AT davidflanagan.com>.  [ruby-core:12346]

Tue Oct  2 08:25:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_permutation): implementation contributed from
	  David Flanagan.  [ruby-core:12344]

	* array.c (rb_ary_combination): RDoc update to clarify.  a patch
	  from David Flanagan.  [ruby-core:12344]

	* array.c (rb_ary_permutation): small dirty hack by Matz to avoid
	  arrays on stack.

Tue Oct  2 07:01:05 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c (proc_dup): proc->block.proc should be self.

	* bootstraptest/test_knownbug.rb, test_method.rb:
	  move a fixed test.

Mon Oct  1 16:17:44 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/test_method.rb: use assert_normal_exit to test
	  [ruby-dev:31818].

Mon Oct  1 15:57:49 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (id2ref): skip ICLASS.

Mon Oct  1 15:29:35 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_normal_exit): use `` instead of
	  system.

Mon Oct  1 15:17:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (id2ref): T_VALUES is less than T_BLOCK.  [ruby-dev:31911]

Mon Oct  1 10:58:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (require_libraries): use require method instead of calling
	  rb_require directly.  [ruby-dev:31322]

Mon Oct  1 10:52:30 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_options), ruby.c (proc_options, process_options): not
	  call exit(2) directly.  [ruby-dev:31912]

	* eval.c (ruby_run_node): deal with direct exit code.

Sun Sep 30 17:12:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_append): always set encoding, and coderange
	  cache bits.

	* include/ruby/encoding.h (ENC_CODERANGE_SET): fixed a bug not to
	  set cache bits.

Sun Sep 30 11:52:11 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (pretty): don't show beginning empty line.

Sun Sep 30 11:32:34 2007  Tanaka Akira  <akr@fsij.org>

	* numeric.c: use #ifdef for test LONG_LONG_VALUE.

Sun Sep 30 04:30:55 2007  Tanaka Akira  <akr@fsij.org>

	* bignum.c: use SIZEOF_LONG instead of SIZEOF_ULONG which is not
	  defined.

Sun Sep 30 04:03:43 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (Init_Regexp): test DEFAULT_KCODE in C code because
	  KCODE_EUC, etc. are enum.

Sun Sep 30 00:55:40 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* variable.c (obj_ivar_each): get rid of warning.

Sat Sep 29 17:45:22 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* main.c (main): use platform-independent per-process initialization.
	  [ruby-dev:31900]

	* ruby.c (ruby_sysinit): new function for per-process initialization.

	* include/ruby/ruby.h (RUBY_GLOBAL_SETUP): toplevel setup declaration.

	* include/ruby/win32.h, win32/mkexports.rb: alias NtInitialize
	  ruby_sysinit.

	* win32/win32.c (rb_w32_sysinit): renamed from NtInitialize.

Sat Sep 29 17:31:04 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_combination): new method to give all combination
	  of elements from an array.  [ruby-list:42671]

	* array.c (rb_ary_product): a new method to get all combinations
	  of elements from two arrays.  can be extended to combinations of
	  n-arrays, e.g. a.product(b,c,d).  anyone volunteer?

	* array.c (rb_ary_permutation): empty function body to calculate
	  permutations of array elements.  need volunteer.

Sat Sep 29 17:14:44 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_leave): move proc invocation from r_entry() to
	  avoid potential crash.

Sat Sep 29 12:28:08 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_normal_exit): new method.

	* bootstraptest/test_knownbug.rb: add test for Marshal.load.

Sat Sep 29 10:12:20 2007  Tanaka Akira  <akr@fsij.org>

	* variable.c (rb_ivar_set): fix class instance variable.

	* object.c (rb_class_real): cl argument may be 0.

Sat Sep 29 09:12:02 2007  Tanaka Akira  <akr@fsij.org>

	* object.c (rb_class_real): use BUILTIN_TYPE instead of TYPE.
	  access flags directly instead of FL_TEST.
	  they are enough because cl argument is a class.

Sat Sep 29 08:57:15 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (strcasecmp): needed for type_strcasehash.

Sat Sep 29 06:47:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (struct cmdline_options): static variables packed.

Sat Sep 29 05:29:30 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_fdopen): create IO object from fd.

	* parse.y (yycompile): use encoding of the source as default.

	* ruby.c (proc_options, load_file): ditto.

Sat Sep 29 04:27:08 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_alias): allow encodings multiple aliases.

	* encoding.c (rb_enc_find_index): search the encoding which has the
	  given name and return its index if found, or -1.

	* st.c (type_strcasehash): case-insensitive string hash type.

	* string.c (rb_str_force_encoding): force encoding of self.  this name
	  comes from [ruby-dev:31894] by Martin Duerst.  [ruby-dev:31744]

	* include/ruby/encoding.h (rb_enc_find_index, rb_enc_associate_index):
	  prototyped.

	* include/ruby/encoding.h (rb_enc_isctype): direct interface to ctype.

	* include/ruby/st.h (st_init_strcasetable): prototyped.

Sat Sep 29 03:53:26 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: Thread local storage should be fiber local.

	* bootstraptest/test_knownbug.rb, test/ruby/test_fiber.rb:
	  move a fixed test.

Fri Sep 28 23:15:31 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insnhelper.ci (vm_call_method): allow send! to call protected
	  methods as well.  [ruby-core:12280]

Fri Sep 28 22:33:47 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_so_fasta.rb: added.

	* benchmark/bm_so_k_nucleotide.rb: added.

	* benchmark/bm_so_reverse_complement.rb: added.

	* benchmark/make_fasta_output.rb: added.

	* benchmark/prepare_so_k_nucleotide.rb: added.

	* benchmark/prepare_so_reverse_complement.rb: added.

Fri Sep 28 19:14:51 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: fix notations.

	* benchmark/bm_loop_whileloop.rb: ditto.

	* benchmark/bm_loop_whileloop2.rb: ditto.

	* benchmark/bm_app_uri.rb: added.

	* benchmark/bm_vm1_ivar_set.rb: ditto.

	* benchmark/bm_so_binary_trees.rb: added from Computer Language
	  Benchmarks Game (http://shootout.alioth.debian.org/).

	* benchmark/bm_so_fannkuch.rb: ditto.

	* benchmark/bm_so_mandelbrot.rb: ditto.

	* benchmark/bm_so_meteor_contest.rb: ditto.

	* benchmark/bm_so_nbody.rb: ditto.

	* benchmark/bm_so_nsieve.rb: ditto.

	* benchmark/bm_so_nsieve_bits.rb: ditto.

	* benchmark/bm_so_partial_sums.rb: ditto.

	* benchmark/bm_so_pidigits.rb: ditto.

	* benchmark/bm_so_spectralnorm.rb: ditto.

Fri Sep 28 16:22:52 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_core.h (rb_vm_struct): fix typo: bufferd -> buffered.

Fri Sep 28 15:47:48 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: fix to output benchmark results
	  to file "bmlog-#{Time.now.strftime('%Y%m%d-%H%M%S')}.#{$$}".

	* benchmark/bm_io_file_create.rb: remove useless codes.

	* benchmark/bm_vm2_eval.rb: added.

Fri Sep 28 15:05:24 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h: export rb_ivar_foreach.

	* include/ruby/ruby.h: modify struct RObject and RClass for optimizing
	  T_OBJECT space.  [ruby-dev:31853]
	  (ROBJECT_LEN, ROBJECT_PTR)
	  (RCLASS_IV_TBL, RCLASS_M_TBL, RCLASS_SUPER, RCLASS_IV_INDEX_TBL)
	  (RMODULE_IV_TBL, RMODULE_M_TBL, RMODULE_SUPER): abstract accessor
	  defined.

	* variable.c: support the modified RObject and RClass.

	* object.c: ditto.

	* class.c: ditto.

	* gc.c: ditto.

	* marshal.c: ditto.

	* eval_method.ci: use the abstract accessor.

	* insns.def: ditto.

	* proc.c: ditto.

	* struct.c: ditto.

	* eval.c: ditto.

	* error.c: ditto.

	* vm.c: ditto.

	* insnhelper.ci: ditto.

	* ext/digest/digest.c: ditto.

Fri Sep 28 13:20:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_getline_fast, rb_io_getline_1): set encoding to the
	  result string, as well as getc.

Fri Sep 28 12:51:42 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_app_erb.rb: added.

	* benchmark/bm_io_file_(create|read|write).rb: added.

Fri Sep 28 12:49:05 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: fix file selection algorithm.

Fri Sep 28 02:05:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_comparable): need not to check asciicompat here.

	* encoding.c (rb_enc_check): ditto.

	* string.c (rb_enc_str_coderange): tuned a bit; no broken check.

	* encoding.c (rb_enc_check): new encoding comparison criteria.

Thu Sep 27 17:36:28 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/REAMDE.win32: follow recent changes.

Thu Sep 27 16:01:53 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: fix to output some helpful messages.

Thu Sep 27 15:44:51 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/driver.rb: added.

	* common.mk: fix to use above driver.

	* benchmark/prepare_so_count_words.rb: added.

	* benchmark/bm_so_count_words.rb: fix benchmark process.

Thu Sep 27 15:42:34 2007  Koichi Sasada  <ko1@atdot.net>

	* ext/fiber/fiber.c: modify prototype declaration.
	  [ruby-core:12247]

Thu Sep 27 09:42:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (strings, xstring, regexp, dsym): empty strings have
	  US-ASCII encoding.

Thu Sep 27 07:39:13 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_finish): new method.

	* bootstraptest/test_knownbug.rb: add test for [ruby-dev:31866] using
	  assert_finish.

Thu Sep 27 04:46:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_associate_index): deal with ASCII compatible
	  flags.

	* encoding.c (rb_enc_check): allow ASCII compatible strings.

	* parse.y (rb_intern_str): use ASCII encoding for ASCII string.

	* string.c (rb_enc_str_coderange): check for code-range.

	* string.c (rb_str_modify): clear code-range flags.

	* string.c (rb_str_hash, rb_str_eql): ASCII compatible strings are
	  comparable.

	* include/ruby/encoding.h: added code-range flags.

Thu Sep 27 04:40:47 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_mark_set): new function to mark keys.

	* marshal.c (struct dump_arg, struct load_arg): added wrappers to mark
	  data and compat_tbl entries.  [ruby-dev:31870]

Thu Sep 27 03:17:41 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_waitpid): no needs to poll.  [ruby-dev:31871]

Wed Sep 26 20:11:46 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: remove a fixed test.

Wed Sep 26 20:00:12 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: move fixed tests.

	* bootstraptest/test_method.rb: ditto.

	* test/ruby/test_io.rb: ditto.

Wed Sep 26 19:36:26 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (eval): fix to check stack overflow.
	  [ruby-dev:31850]

	* eval_intern.h, vm.h: move CHECK_STACK_OVERFLOW() macro.

Wed Sep 26 19:27:11 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_throw): fix to move increment point.
	  [ruby-dev:31840]

Wed Sep 26 19:23:56 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: Fiber as SemiCoroutine on default. [ruby-core:12146]

	* ext/fiber/fiber.c: enable Fiber#transfer.

Wed Sep 26 18:38:41 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_check): check for ASCII-compatibilities.

	* parse.y (parser_tokadd_string, parser_parse_string,
	  parser_here_document, parser_yylex): set encoding to US-ASCII.

	* parse.y (rb_enc_symname_p): check if valid with encoding.

	* parse.y (rb_intern3): let symbols have encoding.

	* string.c (rb_str_hash): add encoding index.

	* string.c (rb_str_comparable, rb_str_equal, rb_str_eql): check if
	  compatible encoding.

	* string.c (sym_inspect): made encoding aware.

	* insns.def (opt_eq): compare with encoding.

	* include/ruby/encoding.h (rb_enc_asciicompat): check if ASCII
	  compatible.

	* include/ruby/encoding.h (rb_enc_get_index): added prototype.

	* include/ruby/intern.h (rb_str_comparable, rb_str_equal): ditto.

Wed Sep 26 15:01:16 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_method.ci (rb_get_alloc_func): cast to suppress a warning.

	* eval_method.ci (remove_method): local variable to be initialized.

Wed Sep 26 08:36:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (ext/extinit.o): use $(OUTFLAG) as well as other
	  objects.  [ruby-Bugs-14228]

Wed Sep 26 05:12:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yyerror): limit error message length.
	  [ruby-dev:31848]

Tue Sep 25 15:11:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_ungetc): reallocate internal buffer if pushing data
	  excess capacity.  [ruby-dev:31650]

Tue Sep 25 13:43:03 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_method.ci (remove_method): should not remove undef place
	  holder.  [ruby-dev:31816], [ruby-dev:31817]

Tue Sep 25 09:51:31 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_longjmp): source file information may be NULL.
	  [ruby-dev:31849]

	* eval.c (ruby_finalize_0): clear trace_func before finalization.

Mon Sep 24 22:36:13 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_equal): should handle recursive array.

	* hash.c (hash_equal): should handle recursive hash.

Mon Sep 24 22:14:13 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/weakref.rb (WeakRef): remove debug print.  [ruby-dev:31799]

	* hash.c (hash_i): avoid too frequent hash conflict where key and
	  value are same.  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>.
	  [ruby-dev:31802]

Mon Sep 24 17:56:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/strscan/strscan.c (strscan_initialize, strscan_getch): use the
	  encoding of the target string instead of setting to StringScanner
	  instance.  [ruby-dev:31831]

Mon Sep 24 16:52:11 2007  Urabe Shyouhei  <shyouhei@ruby-lang.org>

	* lib/net/http.rb: fix typo.

Mon Sep 24 06:49:15 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/net/http.rb: an SSL verification (the server hostname should
	  be matched with its certificate's commonName) is added.
	  this verification can be skipped by
	  "Net::HTTP#enable_post_connection_check=(false)".
	  suggested by Chris Clark <cclark at isecpartners.com>

	* lib/net/open-uri.rb: use Net::HTTP#enable_post_connection_check to
	  perform SSL post connection check.

	* ext/openssl/lib/openssl/ssl.c
	  (OpenSSL::SSL::SSLSocket#post_connection_check): refine error message.

Sun Sep 23 09:05:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (os_obj_of, os_each_obj): hide objects to be finalized.
	  [ruby-dev:31810]

Sun Sep 23 08:58:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_method.ci (rb_attr): should not use alloca for unknown size
	  input.  [ruby-dev:31818]

	* parse.y (rb_intern_str): prevent str from optimization.

Sun Sep 23 06:16:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_method.ci (remove_method): check for undefined method.
	  [ruby-dev:31816]

Sun Sep 23 05:42:35 2007  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* lib/rdoc/options.rb (Options::check_diagram): dot -V output
	  changed. [ ruby-Bugs-11978 ], Thanks Florian Frank.

Sat Sep 22 06:02:11 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::List::summarize): use each_line if
	  defined rather than each.  [ruby-Patches-14096]

Sat Sep 22 05:19:49 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_init): separate from strio_initialize
	  to share with strio_reopen properly.  [ruby-Bugs-13919]

Fri Sep 21 14:51:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (gc_mark_rest): copy just used part.

	* gc.c (gc_mark_children): mark u1 and u2 of NODE_ARGSCAT.

	* gc.c (os_obj_of): hide T_VALUES too.  [ruby-dev:31804]

	* gc.c (run_final): freeze temporary argument array.

Fri Sep 21 04:58:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el (ruby-style-label-indent): fix for function top
	  level labels.

Fri Sep 21 02:11:22 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_match_m): evaluate a block if match.  it would make
	  condition statement much shorter, if no else clause is needed.

	* string.c (rb_str_match_m): ditto.

Fri Sep 21 02:02:34 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (hash_equal): should call rb_eql when argument eql is set.

Thu Sep 20 17:28:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (popen_exec), process.c (rb_spawn): stop other threads before
	  exec.  [ruby-core:08262]

Tue Sep 18 22:08:42 2007  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/matrix.rb: fix a coerce bug of Vector. [ruby-core: 12190]

Mon Sep 17 21:06:03 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (HTTP::GenericRequest#initialize): check path is
	  not nil. [ruby-dev:31149]

Mon Sep 17 21:00:51 2007  Minero Aoki  <aamine@loveruby.net>

	* parse.y (ripper): rename event: arglist_* -> args_*.

	* parse.y (ripper): rename event: restparam -> rest_param.

	* parse.y (ripper): rename event: constpath_* -> const_path_*.

	* parse.y (ripper): rename event: topconst_* -> top_const_*.

	* parse.y (ripper): rename event: iter_block -> method_add_block.

	* parse.y (ripper): support block local parameter declaration.

	* parse.y (ripper): introduce new macro params_new.

	* ext/ripper/lib/ripper/sexp.rb: should not dispose event
	  arguments whose name ends with "_new" but arity != 0.

Sat Sep 15 23:36:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (struct parser_params): common members in the parser and
	  ripper must be placed at each same location.

Sat Sep 15 18:25:15 2007  Kouhei Sutou  <kou@cozmixng.org>

	* string.c (rb_str_rstrip_bang): fixed too much rstrip. [ruby-dev:31786]

Sat Sep 15 17:32:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_initialize): set default encoding.  [ruby-dev:31787]

	* ruby.c (load_file): make new parse instance after processing shebang
	  line options.

Sat Sep 15 17:04:08 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_associate_index, rb_enc_get_index): check if
	  object is encoding capable.  [ruby-dev:31780]

	* string.c (rb_str_subpat_set): check for if the argument is a String.

Sat Sep 15 13:31:21 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss.rb, lib/rss/, test/rss/:
	  - 0.1.9 -> 0.2.0.
	  - supported Slash module.

Fri Sep 14 22:20:01 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (fev_unadvise): no needs to reset
	  event handlers.

Fri Sep 14 17:28:32 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_io.rb: tests which cause SEGV should not be
	  added.

	* bootstraptest/test_knownbug.rb: add above test to known bug.

Fri Sep 14 16:24:04 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_expandarray): assignment should be placed
	  after creating new array.

Fri Sep 14 16:17:30 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/runner.rb: add a stress test (-s).

Fri Sep 14 16:14:28 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.h, eval_intern.h: move some macros to eval_intern.h.

	* eval_jump.ci (rb_f_throw): fix to use NEW_THROW_OBJECT().

	* eval.c (rb_f_loop): remove additional macro.

Fri Sep 14 16:12:10 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_expandarray): should be volatile value for GC.

Thu Sep 13 15:42:03 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): inline cache entries are overwritten
	  in iseq_build_body().

Thu Sep 13 14:00:15 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (brace_block): should use compstmt.  patch submitted by
	  Kirill A. Shutemov <k.shutemov AT gmail.com>  [ruby-core:12154].

Thu Sep 13 13:47:08 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_id2str): fixed typo.

Wed Sep 12 23:12:22 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (proc_options): -W should be allowed in RUBYOPT
	  environment variable.  [ruby-core:12118]

Wed Sep 12 15:19:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_s_sysopen): should not use alloca for unknown size
	  input.  [ruby-dev:31775]

	* parse.y (rb_id2str): ditto.

	* marshal.c (w_float): use snprintf instead of sprintf.

Tue Sep 11 17:28:00 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/tempfile.rb (Tempfile::make_tmpname): Allow to specify a
	  suffix for a temporary file name.

	* lib/tempfile.rb (Tempfile::make_tmpname): Make temporary file
	  names less predictable by including a random string.
	  [inspired by: akr]

Tue Sep 11 17:25:59 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/shellwords.rb: Add shellescape() and shelljoin().

	* lib/shellwords.rb: Rename shellwords() to shellsplit() and make
	  the former an alias to the latter.

	* lib/shellwords.rb: Add escape(), split(), join() as class
	  methods, which are aliases to their respective long names
	  prefixed with `shell'.

	* lib/shellwords.rb: Add String#shellescape(), String#shellsplit()
	  and Array#shelljoin() for convenience.

Mon Sep 10 15:48:31 2007  Tanaka Akira  <akr@fsij.org>

	* range.c: represent initialized state using EXCL instead of FL_USER3.

	* range.c (range_dumper): make uninitialized range dumpable.
	  (range_loader): make uninitialized range loadable.

Mon Sep 10 13:44:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_cycle): avoid infinite loop for empty array.
	  based on a patch from David Flanagan.  [ruby-core:12085]

Mon Sep 10 01:21:23 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_object0): struct allocation first to check if a
	  class is a struct.  compatibility check should come next.

Mon Sep 10 01:05:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_step): fixed integer overflow.  [ruby-dev:31763]

Sun Sep  9 08:57:27 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (_strptime): now also attaches an element
	  which denotes leftover substring if exists.

Sun Sep  9 01:59:08 2007  Tanaka Akira  <akr@fsij.org>

	* marshal.c (r_object0): check T_STRUCT type for structs.

Sun Sep  9 01:17:05 2007  Tanaka Akira  <akr@fsij.org>

	* marshal.c (r_object0): don't call user-defined initialize for
	  T_STRUCT objects.

	* include/ruby/intern.h (rb_struct_initialize): declared.

	* struct.c (rb_struct_initialize): export.

Sat Sep  8 23:55:56 2007  Tanaka Akira  <akr@fsij.org>

	* eval_method.ci (rb_get_alloc_func): new function to get allocation
	  function.

	* include/ruby/intern.h (rb_alloc_func_t): declared.
	  (rb_define_alloc_func): declared.
	  (rb_marshal_define_compat): declared.

	* range.c: use T_STRUCT for Range.

	* inits.c: move Init_marshal() prior to Init_Range() because
	  Init_Range calls rb_marshal_define_compat which needs
	  marshal's compat_allocator_tbl initialized.

	* marshal.c: support marshal format compatibility layer designed for
	  marshaling T_STRUCT Range using T_OBJECT format.
	  (rb_marshal_define_compat): defined.

	[ruby-dev:31710]

Sat Sep  8 10:05:14 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_s_members): check if __members__ is an
	  array to prevent segmentation fault.  [ruby-dev:31759]

Sat Sep  8 09:33:09 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (str[fp]time): now check specifications more
	  strictly.

Sat Sep  8 02:56:31 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_fiber.rb (TestFiber::test_throw): uncaught throw
	  now raise ArgumentError exception.

Sat Sep  8 02:45:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_s_members): should raise TypeError instead
	  of call rb_bug().  [ruby-dev:31709]

	* marshal.c (r_object0): no nil check require any more.

Sat Sep  8 01:46:36 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* regenc.c, regenc.h (onigenc_single_byte_mbc_enc_len): should take
	  two arguments. [ruby-dev:31754]

Fri Sep  7 00:58:16 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: fix typo.

Fri Sep  7 00:28:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_getc): forgot to commit rb_enc_mbclen() fix.

	* ext/stringio/stringio.c (strio_getc): rb_enc_mbclen() fix.

	* ext/stringio/stringio.c (strio_ungetc): ditto.

Thu Sep  6 22:57:01 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::Entry_::copy): prevent self copy of
	  directories.

	* lib/fileutils.rb (FileUtils::fu_each_src_dest0): use try_convert.

	* lib/fileutils.rb (FileUtils::fu_update_option): ditto.

Thu Sep  6 21:36:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/oniguruma.h (OnigEncodingTypeST): add end parameter
	  to mbc_enc_len.

	* euc_jp.c (mbc_enc_len), sjis.c (mbc_enc_len),
	  utf8.c (utf8_mbc_enc_len): ditto.

	* encoding.c (rb_enc_mbclen): add end parameter.

Thu Sep  6 21:31:49 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_cycle): typo in rdoc.  a patch from Yugui
	  <yugui@yugui.sakura.ne.jp>.  [ruby-dev:31748]

Thu Sep  6 12:42:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_succ, rb_str_chop_bang, rb_str_chop): m17n support.
	  [ruby-dev:31734]

Wed Sep  5 22:02:27 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_subseq): need integer overflow check.
	  [ruby-dev:31736]

	* array.c (rb_ary_splice): ditto.  [ruby-dev:31737]

	* array.c (rb_ary_fill): ditto.  [ruby-dev:31738]

	* string.c (rb_str_splice): integer overflow for length.
	  [ruby-dev:31739]

Tue Sep  4 20:43:44 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_EVENT#unadvise.

	* test/win32ole/test_win32ole_event.rb: ditto.

Mon Sep  3 15:37:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (vm.o): depends on st.h too.

Sun Sep  2 23:38:29 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/st.h (struct st_table): make num_entries bitfield
	  instead of num_bins for speed.  num_entries has less access.

Sun Sep  2 00:37:57 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (_parse): improved parsing of ordinal dates.

	* lib/date/format.rb (_parse): use named character classes in some
	  regular expressions.

Sat Sep  1 23:44:26 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_jump.ci (rb_f_throw): wrap tag and TAG_THROW in a NODE_MEMO
	  node to make throw instruction to work well.

Sat Sep  1 20:56:07 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (struct RBignum): embed digits in RBignum for
	  small bignums.

	* bignum.c: RBignum embedded digits implemented.

	* include/ruby/intern.h: declare rb_big_resize.

	* gc.c: don't free embedded digits.

	* numeric.c: replace direct bignum field accessor by abstract field
	  accessor such as RBIGNUM(val)->sign to RBIGNUM_SIGN(val).

	* sprintf.c: ditto.

	* compar.c: ditto.

	* marshal.c: ditto.

	* random.c: ditto.

	* .gdbinit: support embedded small bignums.

	[ruby-dev:31689]

Sat Sep  1 19:59:43 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_event_free): IConnectionPoint should be
	  released.

	* ext/win32ole/win32ole.c (EVENTSINK_Destructor): ITypeInfo should be
	  released.

	* ext/win32ole/win32ole.c (fev_initialize): refactoring.

Sat Sep  1 16:26:09 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/socket/test_tcp.rb (test_recvfrom): same as mswin32 on mswin64.

Sat Sep  1 14:24:23 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_numcmp, st_numhash): use st_data_t instead of long, because
	  the former may be larger than the latter.

	* include/ruby/st.h (CHAR_BIT): get rid of magic number.

	* include/ruby/st.h (rb_index_t): use st_data_t for the platforms it
	  is larger than int.

Sat Sep  1 10:43:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_jump.ci (rb_f_catch): generate new tag object if no argument is
	  given.  backported from MatzRuby.  [ruby-dev:31609]

	* eval_jump.ci (rb_catch): call #catch without arguments if tag
	  string is NULL.

	* eval_jump.ci (rb_f_throw): allow throwing non-symbol object.

	* eval_jump.ci (rb_catch_obj): new function to wait throw with arbitrary
	  object.

	* eval_jump.ci (rb_throw_obj): new function to throw arbitrary object.

	* variable.c (check_autoload_table): prevent multiple calls from
	  RSTRING_PTR().

Fri Aug 31 07:12:24 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (SQRT_LONG_MAX): use SIZEOF_LONG instead of SIZEOF_VALUE
	  because SIZEOF_VALUE > SIZEOF_LONG on some platforms.

Fri Aug 31 04:18:03 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (f_norm_arg, f_arg_item): not croak already erred names.
	  [ruby-dev:31687]

	* parse.y (assignable_gen): ignore already erred names.

	* parse.y (shadowing_lvar_gen): always make new block local variable
	  when shadowing outer local variable.  [ruby-dev:31507]

Thu Aug 30 19:40:33 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* regenc.h: check RUBY_EXTERN before including config.h and defines.h

	* common.mk: update header dependency.

Thu Aug 30 14:06:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (rb_obj_define_method): reverted.  [ruby-talk:266637]

Thu Aug 30 13:49:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: initialize $top_srcdir always.  [ruby-dev:31682]

	* lib/mkmf.rb (try_const, have_const): check for a const is defined.
	  [ruby-core:04422]

Thu Aug 30 08:00:12 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h: declare rb_hash_tbl.

	* include/ruby/ruby.h (RHash): delay st_table allocation.
	  rename tbl field to ntbl to detect direct reference to the st_table
	  as a compile error.
	  (RHASH_TBL): abstract accessor defined.
	  (RHASH_ITER_LEV): ditto.
	  (RHASH_IFNONE): ditto.
	  (RHASH_SIZE): ditto.
	  (RHASH_EMPTY_P): ditto.
	  (hash_alloc0, hash_alloc): unified because hash_alloc doesn't
	  allocate st_table now.

	* hash.c: delay st_table allocation.

	* gc.c: replace tbl by ntbl.

	* array.c: replace direct field accessor by abstract field accessor
	  such as RHASH(hash)->tbl to RHASH_TBL(hash).

	* marshal.c: ditto.

	* insns.def: ditto.

	* ext/iconv/iconv.c: ditto.

	* ext/json/ext/generator/generator.c: ditto.

	* ext/json/ext/parser/parser.c: ditto.

	* ext/json/ext/parser/parser.rl: ditto.

	* ext/syck/rubyext.c: ditto.

	* ext/tk/tkutil/tkutil.c: ditto.

	[ruby-dev:31678]

Wed Aug 29 18:36:06 2007  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb: add :ftp_active_mode option.  [ruby-dev:31677]

Wed Aug 29 14:55:28 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): should not use mbclen2() which has broken API.

	* re.c: remove rb_reg_mbclen2().

Wed Aug 29 12:48:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (aref_args): args may not be a list.  [ruby-dev:31592]

Wed Aug 29 11:30:10 2007  Tanaka Akira  <akr@fsij.org>

	* include/ruby/st.h (struct st_table): add entries_packed 1-bit
	  bitfield.  decrease num_bins 1-bit.

	* st.c: pack numhash which have 5 or less entries in bins.
	  (st_init_table_with_size): setup entries_packed flag.
	  (st_clear): support packed mode.
	  (st_lookup): ditto.
	  (st_insert): ditto.
	  (st_add_direct): ditto.
	  (st_copy): ditto.
	  (st_delete): ditto.
	  (st_foreach): ditto.
	  (st_reverse_foreach): ditto.
	  (unpack_entries): new function for converting to unpacked mode.

	[ruby-list:43954]

Wed Aug 29 10:46:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/defines.h (flush_register_windows): call "ta 0x03"
	  even on Linux/Sparc.  [ruby-dev:31674]

Tue Aug 28 19:16:00 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_type_progid): progid getted by
	  ProgIDFromCLSID should be freed by CoTaskMemFree. Thanks, arton.

	* test/win32ole/test_win32ole.rb (test_raise_message): set negative
	  compareMode value to raise WIN32OLERuntimeError.

	* test/win32ole/test_win32ole_type.rb (test_implemented_ole_types):
	  support some environment which returns IShellDispatch5 instead
	  of IShellDispatch.

Tue Aug 28 15:42:09 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_subseq): retrieve substring based on byte offset.

	* string.c (rb_str_rindex_m): was confusing character offset and
	  byte offset.

Tue Aug 28 14:23:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_splice_0): should check to modify.  [ruby-dev:31665]

Tue Aug 28 14:21:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_prepare): set parser encode too when BOM exists.

Tue Aug 28 00:51:22 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c: fix Mutex to be interruptable lock.

	* thread_win32.ci, thread_win32.h, thread_pthread.ci, thread_pthread.h:
	  prepare native_cond_*() which are based on pthread_cond_*() spec.

	* prelude.rb: fix Mutex#synchronize method.

	* vm_core.h, include/ruby/intern.h: change unblock function interface
	  (to pass some user data).

	* file.c, process.c: ditto.

	* benchmark/bm_vm2_mutex.rb: add a benchmark for mutex.

	* benchmark/bm_vm3_thread_mutex.rb: add a benchmark for mutex
	  with contention.

	* benchmark/run.rb: fix to remove ENV['RUBYLIB'] for matzruby.

	* test/ruby/test_thread.rb: add a test.

	* common.mk: fix benchmark options.

Mon Aug 27 23:14:02 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_rstrip_bang): wrong strip point.  [ruby-dev:31652]

	* string.c (rb_str_each_line): should swallow sequence of newlines
	  if rs (optional argument) is an empty string.  [ruby-dev:31652]

Mon Aug 27 22:39:08 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c (rb_enc_codelen): raises invalid sequence exception
	  if ONIGENC_CODE_TO_MBCLEN() returns zero.  [ruby-dev:31661]

	* encoding.c (rb_enc_mbclen): check invalid sequence.

Mon Aug 27 20:27:59 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_type_progid): fix the bug.
	  [ruby-dev:31576]

	* test/win32ole/test_win32ole_type.rb (test_initialize):
	  remove duplicate assertions.

Mon Aug 27 19:10:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/etc/etc.c (etc_getlogin): update documentation to note
	  security issue.  [ruby-Bugs-11821]

Mon Aug 27 15:56:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_encoding): return the encoding of a Symbol.

Mon Aug 27 15:33:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (IEEE_BIG_ENDIAN): use configured value.  [ruby-dev:31623]

	* util.c (Llong): set to LONG_LONG if available.

Mon Aug 27 13:11:56 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (tr_trans): wrong condition for mbmaxlen==1 strings.
	  [ruby-dev:31652]

Mon Aug 27 00:41:13 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_each_byte): caused infinite loop.  [ruby-dev:31652]

	* io.c (rb_io_getc): should return nil at EOF, not EOFError.

	* lib/delegate.rb (SimpleDelegator::__setobj__): use raise
	  argument to specify backtrace.

	* test/ruby/test_fnmatch.rb (TestFnmatch::bracket_test):
	  String#include? no longer works for Fixnum.  use #chr.
	  [ruby-dev:31652]

Sun Aug 26 12:27:14 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: fix to remove Fiber.new until fiber.so is not loaded.

	* test/ruby/test_continuation.rb: fix to use resume.

Sun Aug 26 06:51:46 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_wc2mb, reg_enum_key): allocate
	  buffer should be NULL terminated.

Sun Aug 26 06:04:13 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_setup_method): reorder code for branch prediction.

Sun Aug 26 05:54:49 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_call_method): fix to relaxant safe level check
	  ($SAFE > 2).  [ruby-core:11998]

	* bootstraptest/test_method.rb: add tests for above.

Sun Aug 26 05:52:08 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_fiber.rb: fix to require 'continuation'.

Sat Aug 25 23:52:14 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_next): message changed.

Sat Aug 25 23:22:14 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/encoding.h: remove unused rb_enc_ismbchar().

Sat Aug 25 22:50:14 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_event_free, EVENTSINK_Destructor,
	  fev_initialize): remove the connection ole_event_free and
	  EVENTSINK_Destructor.

Sat Aug 25 17:52:06 2007  Koichi Sasada  <ko1@atdot.net>

	* string.c, include/ruby/intern.h: export rb_str_length().

	* insns.def: use rb_str_length() in opt_length.

Sat Aug 25 17:48:51 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: rename FIBER_STACK_SIZE to FIBER_VM_STACK_SIZE.

Sat Aug 25 17:05:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (swallow): removed condition using an unset variable.

	* parse.y, re.c: re-applied revision 13092.

	* string.c (rb_str_splice): return from void function.

	* include/ruby/encoding.h (rb_enc_str_new): prototype added.

Sat Aug 25 11:45:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* encoding.c: provide basic features for M17N.

	* parse.y: encoding aware parsing.

	* parse.y (pragma_encoding): encoding specification pragma.

	* parse.y (rb_intern3): encoding specified symbols.

	* string.c (rb_str_length): length based on characters.
	  for older behavior, bytesize method added.

	* string.c (rb_str_index_m): index based on characters.  rindex as
	  well.

	* string.c (succ_char): encoding aware succeeding string.

	* string.c (rb_str_reverse): reverse based on characters.

	* string.c (rb_str_inspect): encoding aware string description.

	* string.c (rb_str_upcase_bang): encoding aware case conversion.
	  downcase, capitalize, swapcase as well.

	* string.c (rb_str_tr_bang): tr based on characters.  delete,
	  squeeze, tr_s, count as well.

	* string.c (rb_str_split_m): split based on characters.

	* string.c (rb_str_each_line): encoding aware each_line.

	* string.c (rb_str_each_char): added.  iteration based on
	  characters.

	* string.c (rb_str_strip_bang): encoding aware whitespace
	  stripping.  lstrip, rstrip as well.

	* string.c (rb_str_justify): encoding aware justifying (ljust,
	  rjust, center).

	* string.c (str_encoding): get encoding attribute from a string.

	* re.c (rb_reg_initialize): encoding aware regular expression

	* sprintf.c (rb_str_format): formatting (i.e. length count) based
	  on characters.

	* io.c (rb_io_getc): getc to return one-character string.
	  for older behavior, getbyte method added.

	* ext/stringio/stringio.c (strio_getc): ditto.

	* io.c (rb_io_ungetc): allow pushing arbitrary string at the
	  current reading point.

	* ext/stringio/stringio.c (strio_ungetc): ditto.

	* ext/strscan/strscan.c: encoding support.

Sat Aug 25 10:59:19 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: separate Continuation and Fiber from core.

	* ext/continuation/*, ext/fiber/*: ditto.

	* include/ruby/ruby.h: remove rb_cFiber.

	* include/ruby/intern.h: add the rb_fiber_new() declaration.

	* enumerator.c (next_init): fix to use rb_fiber_new().

	* test/ruby/test_enumerator.rb: remove next? tests.

	* test/ruby/test_continuation.rb: add a require 'continuation'.

	* test/ruby/test_fiber.rb: add a require 'fiber'.

Sat Aug 25 10:20:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (prelude.o): depends on vm_core.h now.

	* common.mk (prelude.c): depends on tool/compile_prelude.rb too.

	* common.mk (prereq): updates all auto-generated sources.

	* tool/compile_prelude.rb: separated dynamic and static portions.

Sat Aug 25 10:05:17 2007  Koichi Sasada  <ko1@atdot.net>

	* prelude.rb: add Thread.exclusive.  This class method
	  is different from 1.8's.  Thread.exclusive only does
	  synchronize with VM global mutex.

Sat Aug 25 09:39:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_s_try_convert): more document description.

	* re.c (rb_reg_s_try_convert): typo fixed.

Sat Aug 25 08:54:12 2007  Koichi Sasada  <ko1@atdot.net>

	* id.h, id.c: remove idFuncall.

	* compile.c (iseq_specialized_instruction): ditto.

Sat Aug 25 08:47:28 2007  Koichi Sasada  <ko1@atdot.net>

	* tool/compile_prelude.rb: fix to include "vm_core.h".

Sat Aug 25 03:49:14 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/sentence.rb (Sentence): include Enumerable.
	  (Sentence#each): defined.

	* test/ruby/test_assignment.rb: use Sentence#expand.

Sat Aug 25 03:08:57 2007  Koichi Sasada  <ko1@atdot.net>

	* prelude.rb: fix Mutex#synchronize definition.

Sat Aug 25 02:08:45 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_s_try_convert): a new class method to convert
	  object or nil if it's not target-type.  this mechanism is used
	  to convert types in the C implemented methods.

	* hash.c (rb_hash_s_try_convert): ditto.

	* io.c (rb_io_s_try_convert): ditto.

	* re.c (rb_reg_s_try_convert): ditto.

	* string.c (rb_str_s_try_convert): ditto.

Sat Aug 25 00:49:44 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_loop_generator.rb: added.

Sat Aug 25 00:22:31 2007  Koichi Sasada  <ko1@atdot.net>

	* prelude.rb: added.  run this script on startup.

	* tool/compile_prelude.rb: compile prelude.rb to C string.
	  (prelude.rb -> prelude.c)

	* common.mk: fix to build with prelude.c.

	* inits.c (rb_call_inits): ditto.

	* thread.c (Init_Thread): move definition of Mutex#synchronize
	  to prelude.rb.

Sat Aug 25 00:08:43 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (compile_massign_opt): fix to skip massign optimization
	  with global variables.

	* bootstraptest/test_massign.rb: add some tests for above.

Fri Aug 24 18:42:03 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_dir.rb (TestDir::setup): ?c now makes a string.

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner::initialize):
	  initialize @workdir to stop warning.

Fri Aug 24 18:30:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/drb/drb.rb (DRb::DRbServer::InvokeMethod::perform_without_block):
	  replace funcall by send!.  other files in the distribution as well.

Fri Aug 24 17:06:56 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_send_bang): abandon the name funcall for private
	  aware method call.

Fri Aug 24 15:27:12 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_next): stop pre-fetching.

	* enumerator.c (Init_Enumerator): remove next? method.

Fri Aug 24 15:14:57 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_loop): now handles StopIteration exception.

Thu Aug 23 20:31:31 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: optimize simple massign.

Thu Aug 23 20:02:25 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (reg_get_value): use RegQueryValueEx instead
	  of RegQueryValueEx.

	* ext/win32ole/win32ole.c (typelib_file_from_clsid): fix the bug
	  that the function always returns Qnil.

	* test/win32ole/test_win32ole_type.rb (test_initialize): add some test.

Thu Aug 23 17:25:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (group_member): check if presents.

	* configure.in (XCFLAGS): add _GNU_SOURCE on linux.

	* file.c (group_member): use system routine if available.

	* process.c: moved _GNU_SOURCE macro to Makefile.

Thu Aug 23 16:59:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (compile_massign), insnhelper.ci (vm_throw): not use C99
	  comment.

	* cont.c (rb_cont_call, fiber_switch, rb_fiber_resume, rb_fiber_yield):
	  suppress warnings.

	* cont.c (rb_fiber_start): change on non-volatile variable between
	  setjmp and longjmp may not has an effect.

	* enumerator.c (sym_call): initialize first.

	* enumerator.c (enum_iter): typedefed.

	* enumerator.c (next_i): suppress a warning.

Thu Aug 23 16:04:11 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, insns.def, parse.y: fix massign order.  This change
	  causes performance problem.  Try vm1_swap benchmark.
	  [ruby-dev:31522]

	* insns.def, insnhelper.ci: move process body of expandarray insn to
	  vm_expandarray().

	* bootstraptest/test_knownbug.rb, bootstraptest/test_massign.rb:
	  move a solved test.

Thu Aug 23 15:51:19 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (f_norm_arg): ripper has no shadowing check.

	* parse.y (f_block_arg): dispatch blkarg_mark.

Thu Aug 23 15:48:26 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (make_masgn_lhs, iseq_compile_each): fixed indent.

	* compile.c (iseq_translate_threaded_code),
	  vm_evalbody.ci (get_insns_address_table),
	  template/vmtc.inc.tmpl (insns_address_table): constified.

	* vm_evalbody.ci (vm_eval),
	  template/insns_info.inc.tmpl (insn_stack_increase, insn_ret_num):
	  suppress warnings.

Thu Aug 23 13:19:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (f_norm_arg): check also nested arguments.  [ruby-dev:31502]

Thu Aug 23 00:06:48 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* util.c: updated for ANSI C only.  applied a patch from
	  <snakagawa AT infoteria.co.jp>.  [ruby-dev:31591]

Thu Aug 23 00:04:45 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* missing/strtod.c: removed.  [ruby-dev:31588]

	* LEGAL: updated.

Wed Aug 22 15:59:44 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb:
	  fix typo of filename (test_knownbug.rb).

Wed Aug 22 14:04:53 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_knownbug.rb: added.  This file will contain
	  test cases which point out known bug.  If bug is fixed, tests
	  should move to the suitable place.

	* bootstraptest/test_massign.rb: move a test which show known bug
	  to test_knownbug.rb.

Wed Aug 22 13:02:26 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (in_temporary_working_directory):
	  don't remove the directory specified by --dir.

Wed Aug 22 05:51:23 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* util.c (ruby_strtod): replaced by the implementation by David
	  M. Gay inspired by William D. Clinger's paper "How to Read Floating
	  Point Numbers Accurately" [Proc. ACM SIGPLAN '90, pp. 92-101].
	  a patch from Satoshi Nakagawa <snakagawa AT infoteria.co.jp>.
	  [ruby-dev:31582]

	* test/ruby/test_float.rb (TestFloat::test_float): add test for
	  precision.

Wed Aug 22 03:51:07 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: add Fiber#resume and Fiber.yield.
	  and Fiber::Core class to realize Coroutine.

	* include/ruby/intern.h: declare rb_fiber_yield(), rb_fiber_resume().

	* enumerator.c: use above api.

	* test/ruby/test_fiber.rb: fix and add tests for above changes.

Tue Aug 21 21:09:48 2007  Tanaka Akira  <akr@fsij.org>

	* lib/tmpdir.rb (Dir.mktmpdir): make directory suffix specifiable.
	  suggested by knu.  [ruby-dev:31568]

Tue Aug 21 15:00:23 2007  Koichi Sasada  <ko1@atdot.net>

	* st.c (st_clear): reset num_entries too.

Tue Aug 21 13:57:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (st_foreach_func, rb_foreach_func): typedefed.

	* hash.c (rb_hash_clear): use st_clear() unless iterating.

	* st.c (struct st_table_entry): add new members, fore and back, to
	  iterate in inserted order.

	* include/ruby/st.h (struct st_table): ditto.

Tue Aug 21 04:09:06 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm2_case.rb: add a new benchmark.
	  YARV optimize case/when syntax.  If every conditions
	  are literal (such as Symbol, Fixnum, String), dispatch
	  calc order will be O(1).

Tue Aug 21 04:08:07 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_enumerator.rb: fix last commit.

Tue Aug 21 03:59:32 2007  Koichi Sasada  <ko1@atdot.net>

	* test_enumerator.rb (enum_test): fix to return sorted
	  array (for Hash test).

Tue Aug 21 03:55:20 2007  Koichi Sasada  <ko1@atdot.net>

	* enumerator.c (next_i): fix to return with Fiber#yield at
	  the end of each block.  [ruby-dev:31470]

	* enumerator.c (enumerator_next_p): call init_next if not
	  initialized.  [ruby-dev:31514]

	* test/ruby/test_enumerator.rb: add tests for Enumerator.

Mon Aug 20 23:28:39 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (Init_String): remove Symbol.intern and Symbol#dump.
	  [ruby-dev:31525]

	* dir.c (dir_foreach): return Enumerator if no block given.
	  [ruby-dev:31525]

	* io.c (rb_io_s_foreach): argument count check before making
	  Enumerator.  [ruby-dev:31525]

Mon Aug 20 23:17:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (struct rb_thread_struct): removed first_func_arg and
	  reuse first_args instead.

Sun Aug 19 13:31:40 2007  Tanaka Akira  <akr@fsij.org>

	* gc.c: use VALGRIND_MAKE_MEM_UNDEFINED to detect use of collected
	  objects if valgrind is available.  It cannot detect first 2 words
	  because they are used as the free list.

Sun Aug 19 13:13:52 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each/NODE_RESBODY): fix to add
	  additional nop to prevent tailcall optimization.

	* vm_opts.h: clean up comments.

Sun Aug 19 12:58:39 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_call_bmethod): fix to propagate information
	  that this proc is "from Method".  [ruby-dev:31490]

	* proc.c (method_proc, rb_mod_define_method): ditto.

	* vm.c (vm_invoke_proc_core): removed.

	* vm_core.h: ditto.

Sun Aug 19 12:36:11 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/sentence.rb: new method Sentence().

Sun Aug 19 12:32:39 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_callee_setup_arg): fix to mark enough VM stack.
	  [ruby-dev:31492]

Sat Aug 18 19:02:34 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_yield.rb (TestYieldGen): relax array size check
	  in nested parameters.
	  [ruby-dev:31485]

Sat Aug 18 17:44:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/tcltklib.c (Init_tcltklib): use rb_set_end_proc().

Sat Aug 18 17:40:11 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (is_ruby_native_thread): check properly.  [ruby-dev:31166]

Sat Aug 18 16:44:15 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_call_bmethod),
	  vm.c (vm_invoke_proc_core): fix to do not restore
	  $SAFE when proc invoked by bmethod.

	* vm_core.h: ditto.

Sat Aug 18 16:44:49 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.ci (ruby_error_print): call error_print.

	* eval_jump.ci, process.c (rb_exit, rb_f_exit, rb_f_abort): moved.

Sat Aug 18 15:59:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (detach_process_watcher): should not pass the pointer
	  to an auto variable to the thread to be created.  pointed and
	  fix by KUBO Takehiro <kubo at jiubao.org>  [ruby-dev:30618]

Sat Aug 18 15:52:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insnhelper.ci (vm_send_optimize): use MEMMOVE to shift values inside
	  an array.

Sat Aug 18 15:45:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insnhelper.ci (vm_yield_setup_args): rsize and psize should not be
	  negative.

Sat Aug 18 14:35:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insnhelper.ci (vm_callee_setup_arg, vm_send_optimize,
	  vm_yield_setup_args): bulk copy for arguments.

Sat Aug 18 13:55:58 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix to allow self.x=
	  if x= is private.

	* bootstraptest/test_method.rb: add a test for above.

Sat Aug 18 14:05:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (reg_compile_gen): obtain error info from errinfo.

	* re.c (rb_reg_error_desc): make RegexpError for initialization error.

	* re.c (rb_reg_compile): return nil and set errinfo if error.

Sat Aug 18 13:23:01 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c: $! should not be writable.

	* eval.c (rb_rubylevel_errinfo): added.  rb_errinfo() returns
	  rb_thread_t#errinfo.  rb_rubylevel_errinfo() returns $! value.

Sat Aug 18 13:14:40 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_callee_setup_arg): fix to check arguments
	  correctly. [ruby-dev:31472]

Sat Aug 18 13:13:06 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_exception.rb: add escape character ("\") for
	  editors.

Sat Aug 18 12:42:50 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_yield.rb (TestYieldGen): add test for yielding to
	  lambda using lambda parameter passing emulator.

Sat Aug 18 12:24:30 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sample/test.rb, test/ruby/test_system.rb(valid_syntax?): keep
	  comment lines first.

Sat Aug 18 11:44:59 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_set_arguments), insnhelper.ci
	  (vm_callee_setup_arg, vm_yield_setup_args):
	  fix to cause raise on "lambda{|a|}.call(1, 2)".
	  [ruby-dev:31464]

	* bootstraptest/test_block.rb: add tests for above.

Sat Aug 18 01:12:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (frame_func_id): return proper method ID.

Fri Aug 17 22:43:11 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): massign should return rvalue(s).

Fri Aug 17 22:10:19 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_basicinstructions.rb: fix old tests.
	  class variables should be inherited.

Fri Aug 17 21:20:44 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_call), eval_method.ci (rb_add_method, rb_alias),
	  insnhelper.ci (vm_call_method): fix to save safelevel for
	  method node.

	* include/ruby/node.h: ditto.

	* bootstraptest/test_method.rb: add a test for above.

Fri Aug 17 16:02:50 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_terminate_all): fix to ignore
	  exceptions.

	* thread.c (thread_start_func_2): fix
	  abort_on_exception process.  [ruby-dev:31394]

Fri Aug 17 14:38:36 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (in_temporary_working_directory): use
	  Dir.mktmpdir to create and remove temporary directory.
	  (Dir.mktmpdir): define if not available.
	  [ruby-dev:31431]

Fri Aug 17 03:07:37 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix throw insn option of next.

Fri Aug 17 01:25:23 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_set_arguments), insnhelper.ci
	  (vm_callee_setup_arg, vm_yield_setup_args): fix
	  block parameter problems. [ruby-dev:31437], [ruby-dev:31440]

	* bootstraptest/test_block.rb: add a test of [ruby-dev:31440].

Fri Aug 17 01:24:12 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (ruby_iseq_disasm): fix to show arg_simple value.

Fri Aug 17 01:21:29 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def (throw): insert a RUBY_VM_CHECK_INTS(). [ruby-dev:31361]

Thu Aug 16 20:40:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigtrunc): RBIGNUM(x)->len may be zero.  out of bound
	  access.  [ruby-dev:31404]

	* sprintf.c (rb_str_format): small float should not call
	  rb_dbl2big().

Thu Aug 16 22:10:06 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix next/redo stack consistency.
	  [ruby-dev:31373]

	* bootstraptest/test_syntax.rb: add tests for above.

	* sample/test.rb: fix to use __FILE__ instead of $0 to know basedir.

Thu Aug 16 21:14:06 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (BASERUBY): need AC_SUBST.  [ruby-dev:31438]

Thu Aug 16 19:18:26 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/sentence.rb: Sentence class implemented
	  based on sentgen.rb

	* test/ruby/sentgen.rb: removed.

	* test/ruby/test_assignment.rb: use sentence.rb.

	* test/ruby/test_yield.rb: block parameter passing emulator
	  implemented.

Thu Aug 16 16:48:47 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (BASERUBY): check if base ruby is runnable first.
	  [ruby-core:11900]

Thu Aug 16 16:46:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (aix): enable shared by default.

	* configure.in (aix): for 64bit-mode AIX.  [ruby-dev:31401]
	  + use CC for LDSHARED if non-gcc,
	  + moved -G option from *LDFLAGS to LDSHARED,
	  + set -brtl only in XLDFLAGS.

Thu Aug 16 13:06:08 2007  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big_lshift): make shift offset long type.
	  (big_rshift): ditto.
	  (rb_big_lshift): ditto.
	  (big_rshift): ditto.
	  [ruby-dev:31434]

Thu Aug 16 06:29:08 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_readpartial): argf_forward needs argc and argv.

Thu Aug 16 02:47:39 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_fiber_m_yield): added.  use this function
	  for Fiber#yield instead of rb_fiber_yield.

Thu Aug 16 00:36:52 2007  Tanaka Akira  <akr@fsij.org>

	* lib/tmpdir.rb (Dir.mktmpdir): new method.  [ruby-dev:31416]

Wed Aug 15 18:57:30 2007  Koichi Sasada  <ko1@atdot.net>

	* gc.c (os_live_obj): fix to skip T_VALUES.

	* sample/test.rb: add an ObjectSpace test.

Wed Aug 15 16:49:04 2007  Koichi Sasada  <ko1@atdot.net>

	* inits.c (rb_call_inits): change initializing order.
	  [ruby-dev:31420]

Wed Aug 15 16:44:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (ARGF_FORWARD): wrongly compares with current_file with
	  rb_stdout.  should be rb_stdin.  [ruby-cvs:20177]

Wed Aug 15 14:59:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_initialize, argf_each_line, argf_each_byte): suppress
	  warnings.

Wed Aug 15 14:22:05 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y: remove "//" type comment.

Wed Aug 15 13:42:15 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y: fix rules around f_margs.  "make test" passes all tests.

	* bootstraptest/test_block.rb: add some tests for above.

Wed Aug 15 13:50:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_delete_key): delete the entry without calling block.

	* hash.c (rb_hash_shift): should consider iter_lev too.

	* hash.c (delete_if_i): use rb_hash_delete_key() so that the block
	  isn't called twice.  [ruby-core:11556]

Wed Aug 15 13:39:25 2007  Koichi Sasada  <ko1@atdot.net>

	* process.c (proc_geteuid): fix strange conversion.  [ruby-dev:31417]

Wed Aug 15 01:05:55 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_check): don't call newtest.
	  (assert_equal): call newtest.
	  (assert_match): ditto.

Tue Aug 14 21:43:39 2007  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (assert_check): new method.
	  (assert_match): new method.
	  (assert_equal): use assert_check.
	  (pretty): give failure description as an argument.

	* bootstraptest/test_exception.rb: use assert_match to describe the
	  test for [ruby-dev:31407].  [ruby-dev:31412]

Tue Aug 14 19:53:15 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c (Init_Proc), eval.c (Init_eval), eval_intern.h: move
	  init place of exception_error.

	* inits.c: ditto.

	* eval.c (Init_eval): set exception_error#throwed_state as TAG_FATAL.
	  [ruby-dev:31407]

	* bootstraptest/test_exception.rb: add a test for above.

Tue Aug 14 19:51:20 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: change test order (test -> btest).

Tue Aug 14 00:04:27 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: 0.1.8 -> 0.1.9.

	* test/rss/test_version.rb: followed the above change.

	* lib/rss/parser.rb: fixed a bug that handles unintended elements.
	  Thanks to Takuo Yonezawa. [ruby-list:43841]

Mon Aug 13 17:23:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_clear_trace_func, rb_thread_stop_timer_thread):
	  declarations for forward references.

	* eval.c (rb_longjmp, eval): use local variable.

	* eval.c (rb_longjmp): string object not to be optimized.

Mon Aug 13 13:21:58 2007  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb: make ftp passive mode to avoid NAT problem.
	  [ruby-dev:31377]

Mon Aug 13 09:18:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getc): should returns
	  one-character string.

	* ext/stringio/stringio.c: remove unnecessary prototypes.

	* ext/stringio/stringio.c (strio_getbyte): new method.

	* ext/stringio/stringio.c (strio_readbyte): new method.

	* ext/stringio/stringio.c (strio_ungetc): should take a string as
	  an input.

Mon Aug 13 08:19:43 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_close): always close via method.

	* io.c (Init_IO): remove obsolete Kernel#getc.

Mon Aug 13 05:03:53 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_raise): check if target thread is
	  thrown by another thread or not.  [ruby-dev:31371]

	* bootstraptest/test_thread.rb: add a test for above.

Mon Aug 13 04:35:30 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_peephole_optimize): fix peephole optimization
	  bug. [ruby-dev:31360]

	* bootstraptest/test_syntax.rb: add a test for above.

Mon Aug 13 04:02:29 2007  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c (debug_print_pre): fix to show control frame count.

	* insns.def (opt_call_c_function): fix operand type.

	* lib/vm/instruction.rb: ditto.

	* insnhelper.ci (vm_push_frame, vm_pop_frame): fix to show
	  control stack status on if VMDEBUG == 2.

	* vm.h: add a comment about VMDEBUG.

	* iseq.c (find_prev_line_no): fix to skip bug report if
	  line is not found.

	* lib/vm/instruction.rb: fix to use build_string() on
	  source code generators.

Mon Aug 13 03:57:32 2007  Koichi Sasada  <ko1@atdot.net>

	* template/yasmdata.rb.tmpl: fix type and name.

Sat Aug 11 23:27:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_each_line): should use #each_line, not #each.

	* io.c (argf_each_line): simplified.

	* io.c (argf_getline): should handle non T_FILE object in ARGV.

	* io.c (argf_each_byte): each_byte should yield bytes not
	  one-character strings.  [ruby-dev:31374]

Sat Aug 11 07:24:55 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: reverted some wrongly erased "o" options
	  (pointed out by nobu).

Sat Aug 11 00:01:12 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): not re-raise to main thread if it is
	  joining the current thread.

Fri Aug 10 23:54:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_create_core): inherit the priority of creating
	  thread.  submitted at [ruby-core:11873] by David Flanagan <david AT
	  davidflanagan.com>.  [ruby-core:11876]

Fri Aug 10 05:12:19 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): let abort_on_exception work.
	  [ruby-core:11873]

Fri Aug 10 04:47:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (internal_id_gen): internal ID must be bigger than
	  tLAST_TOKEN.

Thu Aug  9 16:04:55 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): check if rhs has value before assignment instead
	  inside node_assign_gen().  [ruby-dev:31293]

	* parse.y (call_bin_op_gen, call_uni_op_gen): split call_op_gen.

Thu Aug  9 14:01:36 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (f_marg_list): renamed from f_marg_head.

	* parse.y (f_margs): allow multiple mandatory arguments after a splat.
	  [ruby-dev:31153]

Thu Aug  9 02:02:02 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_cycle): typo fixed.  a patch from Kazuhiro
	  NISHIYAMA <zn AT mbf.nifty.com>.  [ruby-dev:31362]

Wed Aug  8 19:17:40 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/dl/cptr.c (rb_dlptr_s_to_ptr): no longer check
	  HAVE_RB_IO_STDIO_FILE.

Wed Aug  8 15:52:01 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_next_p): should check correctly even when
	  e.next has not been called before.

	* enumerator.c (enumerator_next): raise StopIteration (name taken
	  from Python) instead of IndexError.

	* enum.c (enum_zip): catch StopIteration exception.

	* enumerator.c (enumerator_with_index): return Enumerator if no
	  block is given.

	* test/ruby/test_iterator.rb (TestIterator::test_enumerator): add
	  test for enumerators.

Wed Aug  8 11:48:37 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big2str0): should not use RTEST for non-VALUE.

Wed Aug  8 11:25:25 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2str0): should preserve sign mark.

Wed Aug  8 11:02:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (btest-miniruby, test-sample): split the test target
	  so that -k option works.

Tue Aug  7 14:58:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (establishShell): handshaking before close slave
	  device.  [ruby-talk:263410]

	* ext/pty/pty.c (MasterDevice, SlaveDevice, deviceNo): constified.

	* ext/pty/pty.c (SlaveName): removed static buffer.

	* ext/pty/expect_sample.rb: support for autologin.

Tue Aug  7 13:58:03 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ruby_special_consts): added RUBY_SPECIAL_SHIFT.

	* .gdbinit: some improvements.

Tue Aug  7 13:28:32 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (node_name.inc): use $? instead of $< for nmake.
	  [ruby-dev:31356]

Tue Aug  7 12:45:13 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ac_cv_func_isinf): set yes also on OpenSolaris.
	  [ruby-Bugs-12859]

Tue Aug  7 12:31:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): fix for win32 platforms.

Tue Aug  7 02:58:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big2str0): make Bignum#to_s even faster.  a patch
	  from Kenta Murata <muraken AT gmail.com>.  [ruby-dev:31354]

Tue Aug  7 01:42:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_zip): zip no longer converts arguments into
	  arrays, uses enumerators.

Tue Aug  7 01:27:47 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* cont.c (rb_fiber_yield): change argument ordering.  export.

	* cont.c (rb_fiber_current): export

	* include/ruby/intern.h: export several functions from cont.c.

	* enumerator.c (enumerator_next): new method to implement external
	  iterator (generator) using fiber.

	* enumerator.c (enumerator_next_p): new method to check whether
	  any element is left in the generator sequence.

	* enumerator.c (enumerator_rewind): a new method to rewind the
	  generator sequence.

Tue Aug  7 01:15:24 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_cycle): new method to cycle enumerable forever.

Tue Aug  7 00:05:38 2007  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* irb/ruby-lex.rb: support for '\c'. [ruby-talk:263508]

Mon Aug  6 20:29:22 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci, insns.def: move some statements to functions.

	* vm.c, vm.h, vm_evalbody.ci: fix include/typedef places.

Mon Aug  6 18:41:12 2007  Koichi Sasada  <ko1@atdot.net>

	* lib/vm/instruction.rb (make_header_analysys): fix last commit.

Mon Aug  6 18:33:22 2007  Koichi Sasada  <ko1@atdot.net>

	* lib/vm/instruction.rb (make_header_analysys): add to separate
	  header addition process.

Mon Aug  6 17:36:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rexml/encodings/{ISO-8859-15,CP-1252}.rb: fixed invalid syntax.

Mon Aug  6 16:57:08 2007  Koichi Sasada  <ko1@atdot.net>

	* sample/test.rb: fix to output file name if it contains
	  invalid syntax.

Mon Aug  6 16:41:22 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y (value_expr_gen): fix to cause "void value expression"
	  when jump expression such as "next" are shown on value_expr().
	  [ruby-dev:31119]

	* bootstraptest/test_syntax.rb: fix to above change.

Mon Aug  6 14:36:30 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y: fix a f_marg rule. [ruby-dev:31160]

Mon Aug  6 14:29:30 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/runner.rb (assert_equal): add additional
	  message parameter.

Mon Aug  6 13:34:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (INSNS): not chdir to srcdir.

	* common.mk (node_name.inc): auto-generate node name list.

	* iseq.c (ruby_node_name): ditto.

	* iseq.c (iseq_s_compile_option_get, Init_ISeq): added a new
	  method VM::InstructionSequence::compile_option.

	* lib/vm/instruction.rb (RubyVM::SourceCodeGenerator): --destdir
	  option.

	* tool/node_name.rb: to auto-generate node name list.

Sun Aug  5 11:51:39 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss, sample/rss, test/rss:
	- 0.1.7 -> 0.1.8.
	- supported <itunes:XXX>.
	- reverted backward incompatibility API changes introduced 0.1.7.

Sun Aug  5 04:56:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open_v, pipe_open_s): separate array and string
	  cases.  [ruby-dev:31344]

Fri Aug  3 11:05:54 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): save all CONFIG values.

	* ext/extmk.rb (extmake): remove mkmf.log at clean, and extconf.h at
	  distclean, respectively.

	* ext/extmk.rb: remove rdoc at clean, and installed list file at
	  distclean, respectively.

Fri Aug  3 07:09:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: more verbose message.  [ruby-Bugs-12766]

	* lib/mkmf.rb (have_type): suppress a warning with -Wall.

	* lib/mkmf.rb (find_type): new method.

Fri Aug  3 00:00:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (big2str_table): base cannot be 0 or 1.

Thu Aug  2 23:42:57 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (reg_compile_gen): set error if failed to compile regexp
	  literal.  [ruby-dev:31336]

	* re.c (option_to_str, arg_kcode, opt_kcode): options conversion
	  between int and string.

	* re.c (rb_reg_compile): should not use regexp which could not get
	  initialized.  [ruby-dev:31333]
	  return error message to let the parser know it.

	* re.c (rb_reg_compile): append regexp options to error message.
	  [ruby-dev:31334]

Thu Aug  2 22:05:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big2str0): faster Bignum#to_s using Karatsuba
	  algorithm.  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>
	  in [ruby-dev:31312], slightly modified by Kenta Murata
	  <muraken AT gmail.com> in [ruby-dev:31339].

Thu Aug  2 13:46:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): should not check positional number as
	  width.  [ruby-core:11838]

Wed Aug  1 12:40:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* generic.rb (URI::Generic::merge_path): behave as RFC 3986.
	  [ruby-talk:252052]

Tue Jul 31 23:38:09 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (_parse): now interprets slashed numerical
	  dates as a big endian (except dd/mm/yyyy). [experimental]

Mon Jul 30 11:16:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_aref): check for Bignum index range.
	  [ruby-dev:31271]

Sat Jul 28 09:35:41 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/digest/lib/digest.rb (Digest::self.const_missing): avoid
	  infinite recursive const_missing call.  [ruby-talk:262193]

Thu Jul 26 20:40:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_eqq): call_super() in === does not work well
	  since Enumerable#=== has different behavior.  [ruby-dev:31296]

Thu Jul 26 13:57:45 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (load_1, dln_find_1): constified.

	* dln.c (conv_to_posix_path): removed.

	* ruby.c (usage): constified.

	* ruby.c (rubylib_mangled_path, rubylib_mangled_path2): return
	  VALUE instead of a pointer to static buffer.

	* ruby.c (push_include_cygwin): fixed buffer overflow.
	  [ruby-dev:31297]

	* ruby.c (ruby_init_loadpath): not convert built-in paths.

Tue Jul 24 10:37:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_f_p): return nil if no argument.  [ruby-dev:31285]

Tue Jul 24 01:05:07 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regint.h (USE_MATCH_RANGE_IS_COMPLETE_RANGE): undef to achieve old
	  rindex behavior.  [ruby-dev:31265]

Mon Jul 23 18:37:14 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* include/ruby/oniguruma.h: upgrade to Oniguruma 5.9.0.  fixes
	  some memory violation.  [ruby-dev:31070]

Sun Jul 22 20:09:49 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (Date._parse): now accepts some new
	  hints. [experimental]

	* lib/parsedate.rb: followed the changes on
	  lib/date/format.rb. [experimental]

Sun Jul 22 16:06:56 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (is_ruby_native_thread): made an int function as
	  well as version 1.8.

	* include/ruby/ruby.h (is_ruby_native_thread): moved prototype
	  from intern.h as well as version 1.8.

Sun Jul 22 14:33:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_rename): deleted code to get rid of a bug of
	  old Cygwin.

	* file.c (rb_file_truncate): added prototype of GetLastError()
	  on cygwin.  [ruby-dev:31239]

	* include/ruby/intern.h (is_ruby_native_thread): prototype.

	* missing/strftime.c (strftime): fix printf format and actual
	  arguments.

	* ext/Win32API/Win32API.c (Win32API_initialize): ditto.

	* ext/tk/tcltklib.c (ip_finalize): ditto.

	* ext/win32ole/win32ole.c (lcid_installed): ditto.

	* ext/socket/getnameinfo.c: include stdio.h always.

Sat Jul 21 21:39:12 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb (Date._parse): now can take some
	  hints (its aim must be mainly determination of endianness of
	  date). [experimental]

	* lib/date.rb, lib/date/format.rb (Date._parse): now completes
	  truncated year as default action. [experimental]

	* lib/date.rb, lib/date/format.rb: added ::iso8601, ::rfc3339,
	  ::xmlschema, ::rfc2822, ::httpdate, ::jisx0301, #xmlschema,
	  #httpdate. [experimental]

Sat Jul 21 17:48:26 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk: inverted rules order.

	* thread_win32.ci (w32_create_thread): bcc does not have
	  _beginthreadex().

	* lib/mkmf.rb (create_makefile): make OBJS depend on RUBY_EXTCONF_H
	  only if extconf.h is created.

	* bcc32/Makefile.sub: headers have moved.

	* bcc32/{Makefile.sub,configure.bat,setup.mak: configure_args
	  support.

	* bcc32/setup.mak: check runtime version.

	* win32/win32.c (rb_w32_open_osfhandle): prototype has changed
	  in bcc 5.82.

	* {win32,wince,bcc32}/setup.mak (-version-): no RUBY_EXTERN magic.

	* win32/resource.rb: include patchlevel number.

Sat Jul 21 12:06:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (init_mkmf): should remove mkmf.log too.

Sat Jul 21 01:45:03 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (Date._parse): completes calendar week based year.

	* lib/date/format.rb (Date._parse): detects year of ordinal date in
	  extended format.

Fri Jul 20 16:30:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_sequence): raise SyntaxError instead of rb_bug
	  since this function can be called from VM::InstructionSequence.load.

	* compile.c (insn_set_sc_state, iseq_set_sequence_stackcaching): ditto.

Fri Jul 20 16:11:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c, compile.h (DECL_ANCHOR, INIT_ANCHOR): split not to
	  initialize aggregations with dynamic values.  [ruby-talk:259306]

	* eval.c (rb_protect): not to initialize aggregations with dynamic
	  values.  [ruby-talk:259306]

	* gc.c (mark_current_machine_context): ditto.

	* thread.c (thgroup_list, call_trace_func): ditto.

	* vm.c (vm_init_redefined_flag): ditto.

Fri Jul 20 15:22:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_config.c (ossl_config_set_section): do not
	  initialize aggregations with dynamic values.  [ruby-talk:259306]

Fri Jul 20 10:39:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt, mlhs_node, lhs, arg, var_ref): return dummy
	  NODE_BEGIN after errors.  [ruby-dev:31100], [ruby-dev:31118]

	* parse.y (remove_begin): keep empty NODE_BEGIN, instead of null.
	  [ruby-dev:31252], [ruby-dev:31263]

Fri Jul 20 09:50:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/runner.rb (get_result_string): check $?.coredump?
	  first.

	* bootstraptest/runner.rb (cleanup_coredump, check_coredump): see
	  stackdump file too.

Thu Jul 19 20:39:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (value_expr_gen): warn for empty expression ().
	  [ruby-dev:31252]

Thu Jul 19 19:24:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.ci (get_backtrace): check the result more.
	  [ruby-dev:31261] [ruby-bugs-12398]

Thu Jul 19 14:38:45 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_lshift, rb_big_rshift): separated functions
	  to get rid of infinite recursion.  fixed calculation in edge
	  cases.  [ruby-dev:31244]

	* numeric.c (rb_fix_lshift, rb_fix_rshift): ditto.

Wed Jul 18 16:57:41 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_pow): refine overflow check.  [ruby-dev:31242]

Wed Jul 18 09:19:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_parser_append_print, rb_parser_while_loop): moved check
	  for node to the head.

	* ruby.c (proc_options): do nothing for -p/-n options if tree is null.
	  submitted by Yusuke ENDOH <mame AT tsg.ne.jp> at [ruby-dev:31243].

Wed Jul 18 08:47:09 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_succ): Time#succ should return a time object in the
	  same timezone mode to the original.  [ruby-talk:260256]

Mon Jul 16 23:07:51 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/base64.rb (Base64::b64encode): should not specify /o option
	  for regular expression.  [ruby-dev:31221]

Mon Jul 16 22:57:53 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): make %u behave like %d for negative
	  values, since decimal format does not work with preceding dots.
	  [ruby-core:11575]

Mon Jul 16 18:29:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_rindex_m): accept string-like object convertible
	  with #to_str method, as well as rb_str_index_m.  [ruby-core:11692]

Mon Jul 16 07:17:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (getspecial): lfp_svar_get() requires int for special
	  global variables.

Mon Jul 16 05:45:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): more checks for format argument.
	  [ruby-core:11569], [ruby-core:11570], [ruby-core:11571],
	  [ruby-core:11573]

Mon Jul 16 00:26:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_pow): removed invariant variable.  [ruby-dev:31236]

Sun Jul 15 22:24:37 2007  pegacorn  <subscriber.jp AT gmail.com>

	* ext/dl/cfunc.c (rb_dlcfunc_call): adjust format.  [ruby-dev:31222]

	* ext/digest/digest.c (rb_digest_instance_update,
	  rb_digest_instance_finish, rb_digest_instance_reset,
	  rb_digest_instance_block_length): %s in rb_raise() expects char*.
	  [ruby-dev:31222]

	* ext/openssl/ossl.h: include ossl_pkcs5.h.  [ruby-dev:31231]

	* ext/openssl/ossl_pkcs5.h: new file for PKCS5.  [ruby-dev:31231]

	* ext/openssl/ossl_x509name.c (ossl_x509name_to_s): use ossl_raise()
	  instead of rb_raise().  [ruby-dev:31222]

	* ext/sdbm/_sdbm.c: DOSISH platforms need io.h.  [ruby-dev:31232]

	* ext/syck/syck.h: include stdlib.h for malloc() and free().
	  [ruby-dev:31232]

	* ext/syck/syck.h (syck_parser_set_input_type): prototype added.
	  [ruby-dev:31231]

	* win32/win32.c: include mbstring.h for _mbspbrk().  [ruby-dev:31232]

	* include/ruby/win32.h (rb_w32_getcwd): prototype added.
	  [ruby-dev:31232]

Sun Jul 15 21:07:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (bigtrunc): do not empty Bignum.  [ruby-dev:31229]

Sun Jul 15 19:05:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_cstr_to_inum): check leading non-digits.
	  [ruby-core:11691]

Sun Jul 15 04:42:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (get2comp): do nothing for empty Bignum.  [ruby-dev:31225]

Sat Jul 14 22:49:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_pow): integer power calculation: 0**n => 0,
	  1**n => 1, -1**n => 1 (n: even) / -1 (n: odd).

	* test/ruby/test_fixnum.rb (TestFixnum::test_pow): update test
	  suite.  pow(-3, 2^64) gives NaN when pow(3, 2^64) gives Inf.

Sat Jul 14 18:46:35 2007  Tanaka Akira  <akr@fsij.org>

	* configure.in: add --with-valgrind.

	* gc.h (SET_MACHINE_STACK_END): new macro to replace
	  rb_gc_set_stack_end.  it find out accurate stack boundary by
	  asm using gcc on x86.

	* thread.c (rb_gc_set_stack_end): don't define if asm-version
	  SET_MACHINE_STACK_END is available.

	* gc.c (mark_current_machine_context): extracted from garbage_collect.
	  it use SET_MACHINE_STACK_END to not scan out of stack area.
	  it notify conservative GC information to valgrind if
	  --with-valgrind.

Sat Jul 14 14:04:06 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (sort_by_cmp): check if reentered.  [ruby-dev:24291]

Sat Jul 14 11:08:28 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/json/ext/generator/generator.c (check_max_nesting): wrong
	  format specifier.  a patch from pegacorn <subscriber.jp AT gmail.com>.
	  [ruby-dev:31217]

Sat Jul 14 02:27:43 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_pow): overflow detection using FIT_SQRT_LONG().
	  [ruby-dev:31215]

Sat Jul 14 02:05:53 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (opt_div): LONG2FIX() may not work for corner cases,
	  use LONG2NUM() instead.  [ruby-dev:31210]

Sat Jul 14 00:34:01 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_round): should not return false, but self.
	  [ruby-dev:31212]

Fri Jul 13 18:31:27 2007  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/intern.h: remove unused function declarations.

	* include/ruby/ruby.h: ditto.

Fri Jul 13 17:32:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm.c (vm_free): clear free'ed living_threads field.
	  [ruby-dev:31163]

	* insns.def (opt_succ): use cast to shut a warning up.

Fri Jul 13 16:10:00 2007  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb (URI::Generic#find_proxy): use ENV.to_hash to access
	  http_proxy environment variable to avoid case insensitive
	  environment search.

Fri Jul 13 15:02:15 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (CreateChild): enclose command line except for
	  command.com which can not handle quotes.  [ruby-talk:258939]

Fri Jul 13 11:33:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (range_max, range_min): return nil for empty set as well as
	  1.8 and Enumerable.  [ruby-dev:31198]

Fri Jul 13 11:28:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (bvar): semicolon was lost for ripper description.
	  [ruby-dev:31140]

Fri Jul 13 11:25:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (program, stmt, primary): reduced duplicated code.

	* parse.y (dsym): convert also literals containing NUL to
	  symbol.

	* parse.y (debug_lines): use rb_hash_lookup() to get rid of
	  call of Hash#default.

	* parse.y (ripper_warningS): unused in ripper right now.

Fri Jul 13 10:33:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_flatten_bang): check argument if valid
	  integer.  [ruby-dev:31197]

Fri Jul 13 10:10:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (link_command, cc_command, cpp_command): do not expand
	  ::CONFIG which is an alias of MAKEFILE_CONFIG.

Thu Jul 12 21:38:02 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* insns.def (opt_succ): use LONG_MAX as maximum Fixnum VALUE.
	  [ruby-dev:31199]

Thu Jul 12 18:42:18 2007  Tanaka Akira  <akr@fsij.org>

	* range.c (range_max): use FIX2LONG instead of FIX2INT to avoid
	  RangeError by ((-0x80000001)...(-0x80000001)).max on LP64.

	* insns.def (opt_plus): use FIX2LONG instead of FIX2INT to avoid
	  RangeError by 0x3fffffffffffffff+1 on LP64.

	* insns.def (opt_succ): don't use 0x80000000 which assumes 32bit VALUE.
	  use FIX2LONG instead of FIX2INT.
	  [ruby-dev:31190]

Thu Jul 12 17:03:15 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* struct.c (rb_struct_init_copy): disallow changing the size.
	  [ruby-dev:31168]

Thu Jul 12 12:58:21 2007  Koichi Sasada  <ko1@atdot.net>

	* blockinlining.c: remove "yarv" prefix.

	* array.c, numeric.c: ditto.

	* insnhelper.ci, insns.def, vm_evalbody.ci: ditto.

	* yarvcore.c: removed.

	* yarvcore.h: renamed to core.h.

	* cont.c, debug.c, error.c, process.c, signal.c : ditto.

	* ext/probeprofiler/probeprofiler.c: ditto.

	* id.c, id.h: added.

	* inits.c: ditto.

	* compile.c: rename internal functions.

	* compile.h: fix debug flag.

	* eval.c, object.c, vm.c: remove ruby_top_self.
	  use rb_vm_top_self() instead.

	* eval_intern.h, eval_load: ditto.

	* gc.c: rename yarv_machine_stack_mark() to
	  rb_gc_mark_machine_stack().

	* insnhelper.h: remove unused macros.

	* iseq.c: add iseq_compile() to create iseq object
	  from source string.

	* proc.c: rename a internal function.

	* template/insns.inc.tmpl: remove YARV prefix.

	* thread.c: use rb_iseq_eval() and rb_str_new2().

	* vm.c (rb_iseq_eval): added.

	* vm.c: move some functions from yarvcore.c.

	* vm_dump.c: fix to remove compiler warning.

Thu Jul 12 12:24:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (opt_succ): fixed typo.  [ruby-dev:31189]

Thu Jul 12 10:30:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): moved prototye from thread_*.ci.

	* thread_pthread.ci (thread_start_func_2): not use a directive
	  inside a macro argument.  [ruby-talk:258763]

	* thread.c (thread_join): pthread_t may not be pointer.

	* thread_pthread.ci (ubf_select_each): ditto.

Thu Jul 12 05:32:28 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (FIX2ULONG): drop sign bit for LLP64 platform.

Tue Jul 10 19:34:45 2007  Koichi Sasada  <ko1@atdot.net>

	* hash.c (rb_hash_lookup): added.  this function is similar to
	  rb_hash_aref(), but doesn't call Hash#default when no entry
	  exists.

	* include/ruby/intern.h: ditto.

	* insnhelper.ci (lfp_svar_get): use rb_hash_lookup().

Tue Jul 10 19:16:28 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c, insnhelper.ci, vm.c: change cref index (-1 -> 2).

Tue Jul 10 18:49:56 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (exec_under): add proper casts.

Tue Jul 10 16:58:16 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c, insnhelper.ci: fix svar interface.

	* compile.c (iseq_compile_each), yarvcore.h: fix to use new
	  svar interface for flip flop.

	* eval.c: ditto.

	* insns.def: ditto.

	* include/ruby/intern.h: remove "rb_svar()" declaration.

Tue Jul 10 16:52:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (rb_iseq_compile): formatted if/else to switch statement.

Tue Jul 10 15:57:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/test_flip.rb: new test for flip-flop operator.

Tue Jul 10 14:50:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bcc32/{Makefile.sub,setup.mak}: remove surplus slash from srcdir.

Mon Jul  9 02:17:36 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* cont.c (cont_restore_1): workaround for x64-mswin64's SEH.

Sun Jul  8 02:08:53 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/json.rb, lib/json/, ext/json/: import JSON 1.1.1

Sat Jul  7 21:59:29 2007  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb (PP::PPMethods#pp_hash): sort condition changed:
	  all keys have a same class which is kind of Comparable.

Sat Jul  7 17:12:37 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: use rb_bug() instead of rb_compile_error().

Sat Jul  7 16:12:48 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y: fix node construction (around f_margs).
	  [ruby-dev:31143]

	* bootstraptest/test_block.rb: add a test for above.

	* insnhelper.ci: fix indent.

Sat Jul  7 15:36:50 2007  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb (PP::PPMethods#pp_hash): sort if
	  all keys are strings, symbols or integers.

Sat Jul  7 15:30:05 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_yield_setup_args), vm.c, insns.def:
	  fix to pass nil as block parameter to yielded block.
	  [ruby-dev:31147]

	* bootstraptest/test_block.rb: add a test for above.

Fri Jul  6 19:55:10 2007  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb.rb: typo. Thanks, Giles Bowkett.

	* lib/irb/completion.rb: support Ruby1.9 changing return value
	  String to Symbol for Object#methods, etc. [ruby-dev:31148].

Fri Jul  6 18:20:50 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/runner.rb: fix load path.

	* common.mk: fix "test" rule to run with "btest".

	* rubytest.rb, sample/test.rb: fix to show tests progress.

Fri Jul  6 15:37:48 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_iterator.rb: fix test to 1.9 spec.

Fri Jul  6 15:21:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_interrupt): suppress a gcc's officious warning.

Fri Jul  6 14:57:12 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (keyword_to_name): constified.

	* ext/ripper/eventids2.c (token_to_eventid): ditto.

Fri Jul  6 14:50:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bootstraptest/runner.rb: added --quiet option.

Fri Jul  6 14:35:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (f_marg): wrap f_norm_arg assignment node with NODE_LIST.
	  [ruby-dev:31141]

Fri Jul  6 12:15:01 2007  Tanaka Akira  <akr@fsij.org>

	* test/ruby/sentgen.rb: new file.

	* test/ruby/test_assignment.rb: tests implemented using assignment
	  generator and emulator.

Fri Jul  6 03:06:58 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def: remove unused code.

	* compile.c (compile_massign): fix to invoke to_splat on
	  splat rhs (example: *a = *nil). [ruby-dev:31136]

	* bootstraptest/test_massign.rb: add tests for above.

	* compile.c (iseq_compile_each): disable excess optimization.
	  [ruby-dev:31126]

Fri Jul  6 02:08:25 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def: fix to invoke nil.to_splat on NODE_ARGSCAT.
	  [ruby-dev:31138].

	* bootstraptest/test_literal.rb: add tests for above.

Thu Jul  5 19:45:55 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h: rename rb_control_frame_t#magic to flag.

	* vm.h: add VM_FRAME_TYPE() and VM_FRAME_FLAG().

	* cont.c, insnhelper.ci, insns.def, vm.c, vm_dump.c,
	  vm_evalbody.ci, yarvcore.c: apply above changes.

Thu Jul  5 19:16:14 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_basicinstructions.rb: remove an assertion using
	  unsupported hash literal (such as {1, 2}).

	* test/ruby/test_hash.rb: ditto.

Thu Jul  5 19:12:22 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c: Qfalse is VALUE, not pointer.

Thu Jul  5 18:42:01 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): add break catch point.

	* insns.def (throw): support correct "break" and "return".
	  this commit achieve that "make test" passes all tests.

	* vm.c: ditto.

Thu Jul  5 18:44:12 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y (mlhs_basic): use mlhs_post after tSTAR.
	  [ruby-dev:31109]

Thu Jul  5 18:27:58 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/{intern,ruby}.h, compile.[ch], error.c, eval.c,
	  eval_load.c, gc.c, iseq.c, main.c, parse.y, re.c, ruby.c,
	  yarvcore.[ch] (ruby_eval_tree, ruby_sourcefile, ruby_sourceline,
	  ruby_nerrs): purge global variables.

	* ruby.c (proc_options): moved do_print and do_loop options
	  handling from ruby_process_options().

Thu Jul  5 16:37:34 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (int_pow): fix previous nubu's commit.

	* test/ruby/test_fixnum.rb: new test.

Thu Jul  5 15:56:06 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (int_pow): even number multiplication never be negative.

Thu Jul  5 10:42:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/{node,ruby}.h, ruby.c: added enum constants for gdb
	  support.  [ruby-dev:31066]

	* .gdbinit: some improvements.

Thu Jul  5 10:13:08 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (global_symbols.last_id): reduce unused ID numbers.

	* include/ruby/st.h, st.c (st_init_table, st_init_table_with_size):
	  constified.

Wed Jul  4 23:36:27 2007  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/httpauth/authenticator.rb
	  (WEBrick::HTTPAuth::Authenticator#check_scheme): auth-scheme must be
	  treated as a case-insensitive token according to RFC 2617 section 1.2.

Wed Jul  4 18:30:04 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y (mlhs_inner): new rule.  [ruby-dev:31132]

Wed Jul  4 05:11:57 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (set_relation): added.

Wed Jul  4 04:58:30 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (caller_setup_args): fix to show correct class
	  on an error message (ex: m(&1)). [ruby-dev:31101]

Wed Jul  4 04:30:32 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (compile_array, iseq_compile_each): fix about array
	  generation in void context. [ruby-dev:31102]

	* bootstraptest/test_literal.rb: add a test for above.

Wed Jul  4 04:07:00 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (compile_array): ignore NODE_ZARRAY.
	  [ruby-dev:31110]

	* bootstraptest/test_method.rb: add a test for above.

Wed Jul  4 04:04:02 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.h: fix debug print level.

Wed Jul  4 03:52:55 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): support v[&b]= type method call.
	  [ruby-dev:31094]

	* bootstraptest/test_method.rb: add a test for above.

Wed Jul  4 03:43:29 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (compile_massign): fix massign compilation
	  (example: a, *v, (*x) = ...).  [ruby-dev:31107]

	* bootstraptest/test_massign.rb: add tests for above.

Tue Jul  3 23:12:29 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/onigiruma.h (ONIG_EXTERN): use RUBY_EXTERN if defined.

	* regenc.h: include ruby/defines.h.

	* regint.h: x64-mswin64 support.

Tue Jul  3 13:47:44 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (cont_save_machine_stack): clear saved_thread.machine_stack*.

Mon Jul  2 21:45:53 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: rename iseq_translate_direct_threaded_code()
	  to iseq_translate_threaded_code().

	* eval_intern.h, yarvcore.h: mv EXEC_EVENT_HOOK() and
	  exec_event_hooks() to yarvcore.h.

	* insnhelper.ci, vm.c: mv yarv_finish_insn_seq to vm.c.

	* insns.def (opt_call_c_function): fix to use RESTORE_REGS().

	* iseq.c (rb_iseq_build_for_ruby2cext): fix to allocate iseq.

Mon Jul  2 11:59:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defineclass): suppress a warning.

	* insns.def (opt_call_c_function): should raise the thrown exception
	  instead of returning it.

Mon Jul  2 08:53:47 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_intern.h, yarvcore.h: move declaration of sysstack_error
	  to yarvcore.h.

	* iseq.c: fix symbol name (:toplevel -> :top).

	* lib/vm/instruction.rb, template/vm.inc.tmpl: replaceable
	  current file name.

Mon Jul  2 05:29:07 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, iseq.c: fix iseq some of load/store process.

Mon Jul  2 03:09:36 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h, compile.c, insnhelper.ci, iseq.c, vm.c:
	  rename structure names and field names.

	* insnhelper.h, insns.def: add GET_CONST_INLINE_CACHE().

	* iseq.c: add rb_iseq_build_for_ruby2cext().

	* yarvcore.h, vm.h: move declaration of rb_insn_func_t
	  to yarvcore.h.

Sun Jul  1 03:25:53 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.h, vm.h: some refactoring.
	  remove useless comments, etc.

Sun Jul  1 03:02:29 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h: some refactoring on rb_iseq_t.
	  rename some variable names, add comments, etc.

	* compile.c, iseq.c, proc.c, vm.c: ditto.

Sun Jul  1 02:57:57 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.h: rename insn_func_type to rb_insn_func_type.

	* vm_evalbody.ci: ditto.

	* insns.def: add opt_call_native_compiled instruction
	  instead of opt_call_native_compiled.

Sat Jun 30 00:17:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): return non-valid token for an invalid
	  instance/class variable name.  a patch from Yusuke ENDOH
	  <mame AT tsg.ne.jp>.  [ruby-dev:31095]

Fri Jun 29 23:38:06 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmts): fix for ripper.

Fri Jun 29 21:55:48 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y: fix to show line number of blank block.
	  [ruby-dev:31093]

Fri Jun 29 20:51:04 2007  Tanaka Akira  <akr@fsij.org>

	* lib/cgi/session.rb (create_new_id): don't cut off md5.hexdigest to
	  follow Ruby 1.8.

Fri Jun 29 17:10:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.h: constified.

	* debug.c (ruby_set_debug_option): separated from main.c.

	* gc.c (ruby_gc_stress), signal.c (ruby_enable_coredump): prefixed.

Fri Jun 29 16:39:06 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c (proc_new): fix to return a proc object
	  which block is contained ([ruby-dev:31056]).

Fri Jun 29 15:43:59 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (fix_pow): get rid of division by zero.  reported by
	  Yusuke ENDOH <mame AT tsg.ne.jp> [ruby-dev:31040]

	* numeric.c (int_round): do nothing when rounding by zeroth digit.
	  check underflow.  [ruby-dev:31043]

Fri Jun 29 15:32:00 2007  Koichi Sasada  <ko1@atdot.net>

	* configure.in: add fastcall attribute check.

Fri Jun 29 14:51:24 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (assoc_list): remove expanded hash literal (no splat).

	* lib/webrick/httpstatus.rb (WEBrick::HTTPStatus::EOFError): adapt
	  to new syntax.

Fri Jun 29 14:48:18 2007  Koichi Sasada  <ko1@atdot.net>

	* tool/insns2vm.rb, lib/vm/instruction.rb: move process body
	  to lib/vm/instruction.rb.

	* common.mk: fix aotc rule.
	  experimental. bin/ruby2cext is not added yet.

Fri Jun 29 11:23:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (dsym): return non-null NODE even if yyerror().  based on a
	  patch from Yusuke ENDOH <mame AT tsg.ne.jp>.  [ruby-dev:31085]

Thu Jun 28 23:29:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (assoc_list): odd number check only for NODE_ARRAY.
	  [ruby-dev:31082]

Thu Jun 28 22:24:33 2007  Koichi Sasada  <ko1@atdot.net>

	* win32/Makefile.sub: define FUNC_FASTCALL macro.

	* vm.h: fix to use FUNC_FASTCALL macro.
	  TODO: add FUNC_FASTCALL macro by configure.

Thu Jun 28 19:38:53 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: fix to remove -Wall warnings on gcc.

	* compile.c (make_name_with_str): removed. use rb_sprintf() instead.

Thu Jun 28 18:53:01 2007  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big_hash): fix hash area.

Thu Jun 28 15:00:06 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): local variable to be
	  initialized.  [ruby-dev:31077]

Thu Jun 28 11:30:39 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (rb_obj_id): use SIGNED_VALUE instead of long.

Thu Jun 28 05:01:56 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk (run.gdb): fix to load $(srcdir)/.gdbinit

	* vm.c (rb_vm_set_finish_env): add a cast.

	* vm.h: support __fastcall for MSVC.

Thu Jun 28 02:12:08 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/runner.rb: fix to untouch $:.

Thu Jun 28 02:03:07 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (setup_args): change parameter type.

Thu Jun 28 02:03:39 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (rb_intern2): unconstify cast.

Thu Jun 28 01:44:31 2007  Tanaka Akira  <akr@fsij.org>

	* parse.y (rb_intern2): don't allocate a string object at first.
	  [ruby-dev:31064]

Thu Jun 28 01:24:02 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/runner.rb: fix to show file name.

	* bootstraptest/test_*.rb: add bootstrap tests.

Thu Jun 28 01:22:15 2007  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/node.h, parse.y, gc.c, iseq.c: remove NODE_CREF.

Thu Jun 28 01:19:43 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix popped backref and others.
	  ([ruby-dev:31068]).

	* compile.c (iseq_compile_each): remove needless statements.

Wed Jun 27 23:51:33 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c: remove unused functions.

Wed Jun 27 20:46:05 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h, win32/Makefile.sub, win32/configure.bat,
	  win32/mkexports.rb, win32/setup.mak, win32/win32.c: import
	  x64-mswin64 port.

Wed Jun 27 20:31:07 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_translate_direct_threaded_code): fix prototype
	  function name.

	* vm.h: add correct cast.

Wed Jun 27 17:08:42 2007  Koichi Sasada  <ko1@atdot.net>

	* vm_evalbody.ci: support OPT_CALL_THREADED_CODE.

	* insns.def, vm.c, vm.h: ditto.

	* vm.h: add VM_CFP_CNT() and VM_SP_CNT().

Wed Jun 27 04:23:47 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix type error.

Wed Jun 27 03:26:15 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (compile_massign), insns.def (expandarray): support
	  postarg with massign (a, *b, c = ...).

	* bootstraptest/test_massign.rb: add tests for above.

	* compile.h: fix debug macro names.

Wed Jun 27 00:18:41 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_clear): need to check STR_EMBED_P() before
	  free()ing memory.  a patch from Yusuke ENDOH <mame AT tsg.ne.jp>.
	  [ruby-dev:31062]

Tue Jun 26 16:39:01 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_getgroups): use GIDT2NUM for rb_gid_t.

Tue Jun 26 16:28:24 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_wait_fd_rw): terminate fdset.

Tue Jun 26 16:26:58 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* regint.h: IL32LLP64 support.

Tue Jun 26 16:22:45 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (ruby_node_name): update node names.

Tue Jun 26 15:21:20 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h: IL32LLP64 support.

	* bignum.c (bigfixize, rb_cstr_to_inum): ditto.

	* insns.def (opt_plus, opt_minus, opt_mult): ditto.

Tue Jun 26 15:04:06 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_fiber_s_new): revert initializing VM stack.

	* yarvcore.c (th_init2): ditto.

	* vm.c, vm.h: fix to stop using Qundef on VM stack.  According to
	  this change, VM stack should not include Qundef value.

	* insns.def (putundef): removed.

	* compile.c (iseq_compile_each): ditto.

	* eval.c (eval): fix spacing.

Tue Jun 26 04:03:50 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (vm_yield_with_cfunc), proc.c: fix Method#to_proc
	  to return lambda Proc ([ruby-dev:31021], [ruby-dev:31037]).

Tue Jun 26 03:46:08 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_fiber_s_new): fix to clear rb_thread_t#tag.
	  [ruby-dev:30995]

Tue Jun 26 03:38:31 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_fiber_s_new), yarvcore.c (th_init2): fix to clear
	  VM stack ([ruby-dev:31046]).

Tue Jun 26 03:15:27 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: rename setup_arg() to setup_args().
	  fix to use setup_args() at processing NODE_YIELD.

Tue Jun 26 02:50:24 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (setup_arg): support kind of "m(*ary, x)" method call.
	  ([ruby-dev:31048]).

Tue Jun 26 00:28:44 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci, vm.c: complete block parameter support.
	  post arguments, optional arguments, block argument.

	* compile.c, parse.y: fix {|a|} parameter.

	* insnshelper.ci, insns.def: revert caller_setup_args() option
	  (need_block_check) parameter.

Mon Jun 25 20:18:44 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (RVALUE): in RVALUE and RBasic, flags must be the same type.

Mon Jun 25 18:02:55 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/pty/extconf.rb: skip wince and win64.

Mon Jun 25 17:59:32 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/node.h (NODE_LMASK, nd_line): shouldn't use int and/or
	  long carelessly.

Mon Jun 25 11:36:35 2007  Koichi Sasada  <ko1@atdot.net>

	* gc.h: add RUBY_ prefix to debug macros.

	* cont.c, proc.c, yarvcore.c,

	* gc.c: define ruby_gc_debug_indent variable to debug mark/free.

	* vm.c, insnhelper.ci: rename some functions to vm_* or rb_vm_*.
	  move some functions, definitions, declarations to suitable files.

	* eval.c, yarvcore.h, eval_error.ci, insnhelper.ci: ditto.

Mon Jun 25 09:45:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.ci, eval_jump.ci, eval_method.ci, eval_safe.ci: c-mode.

Mon Jun 25 05:27:54 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c: remove ruby_current_node and change eval() prototype.
	  fix to use rb_sourcefile/line() instead of ruby_sourcefile/line.

	* error.c, eval_error.ci, eval_load.c, eval_safe.ci, gc.c,
	  include/ruby/intern.h, parse.y, process.c, ruby.c: ditto.

	* vm.c: fix spaces.

Mon Jun 25 04:20:14 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_*.h: rename to eval_*.ci.

	* common.mk: ditto.

	* eval_error.ci: remove ruby_set_current_source().

	* error.c, eval.c, ruby.c: ditto.

	* eval_safe.c, proc.c: remove unused macros.

Mon Jun 25 03:37:20 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.ci (caller_setup_args): add need_block_check option.

	* insns.def: ditto.

	* yarvcore.h: add GetCoreDataFromValue().

Mon Jun 25 02:14:30 2007  Koichi Sasada  <ko1@atdot.net>

	* call_cfunc.ci: removed.

	* insnhelper.ci: added. this function includes all functions that
	  vm insns need.

	* common.mk: ditto.

	* insnhelper.h, vm.h, vm.c: move some declaration.

	* gc.h: remove GC_CHECK() macro because GC.stress is more useful.

	* compile.c, iseq.c, vm_dump: ditto.

	* gc.h, thread.c: move a prototype declaration.

	* debug.c, debug.h: rename some functions.

	* compile.h: ditto.

Mon Jun 25 00:45:02 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def (invokesuper): fix error message.

Mon Jun 25 00:14:13 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c: some refactoring.
	  * rename th_* to vm_*.
	  * remove unused variables functions.
	  * add prototypes.

	* blockinlining.c, compile.c, cont.c, eval.c, eval_intern.h,
	  eval_jump.h, eval_load.c, inits.c, insns.def, iseq.c, parse.y,
	  proc.c, process.c, signal.c, thread.c, vm.c, vm_dump.c,
	  vm_evalbody.ci, yarvcore.c, yarvcore.h: ditto.

Sun Jun 24 22:32:00 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_method.h (rb_add_method): fix to check 0.

Sun Jun 24 22:00:17 2007  Koichi Sasada  <ko1@atdot.net>

	* insn_send.ci: removed.

	* common.mk: ditto.

	* vm.c (vm_call_bmethod), isnsn.def: added.  fix to use this
	  function instead of using goto.

	* vm.c (vm_call_bmethod): renamed from th_invoke_bmethod().

	* vm.c (vm_method_missing): renamed from eval_method_missing().

	* vm_evalbody.ci: remove tmp_* variables.

	* insnhelper.h: add some macros.

	* insns.def: forbid zsuper from method defined by define_method().

	* test/ruby/test_super.rb: ditto.

Sun Jun 24 20:01:08 2007  Koichi Sasada  <ko1@atdot.net>

	* vm_macro.def: removed.

	* insn_send.ci: added.  this file includes send instruction body.

	* common.mk: ditto.

	* insns.def: ditto.

	* tool/insns2vm.rb: ditto.

	* vm.c: ditto.

Sun Jun 24 19:30:37 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.h (RESTORE_REGS): add do/while(0) around macro.

	* vm.c, vm_macro.def: remove macro_eval_invoke_func() and
	  add vm_setup_method().  use it instead.

Sun Jun 24 19:02:33 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_macro.def : remove macro_eval_invoke_cfunc() and
	  add vm_call_cfunc().

Sun Jun 24 17:54:13 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def, vm.c: add/fix stack overflow check.

Sun Jun 24 17:28:52 2007  Koichi Sasada  <ko1@atdot.net>

	* insnhelper.h: change CHECK_STACK_OVERFLOW() to throw exception.

	* vm.c (caller_setup_arg), vm_macro.def: remove
	  macro_eval_setup_send_arguments and add caller_setup_arg().

	* insns.def: ditto.

	* bootstraptest/test_method.rb: add splat arg tests.

Sun Jun 24 16:35:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (proc_to_s): used a variable before initialized.

Sun Jun 24 16:05:45 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (callee_setup_arg): added.  support correct post arg.

	* vm_macro.def (macro_eval_invoke_func): fix to use
	  callee_setup_arg.

	* compile.c (set_arguments): adjust for above changes.

	* compile.c (iseq_compile_each): ditto.

	* iseq.c (ruby_iseq_disasm): ditto.

	* yarvcore.h: add rb_iseq_t#post_arg_start and arg_size.

	* bootstraptest/test_method.rb: add post arg tests.

Sun Jun 24 16:10:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (proc_to_s): suppress warning, and reduced duplicated code.

Sun Jun 24 15:33:47 2007  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/runner.rb: set default directory to
	  '/tmp/bootstraptest.tmpwd' and add --dir option.
	  fix to output driver and target information.

	* common.mk: fix to run btest on BASERUBY and
	  add OPTS to pass option ("make btest OPTS=...").

Sun Jun 24 03:05:00 2007  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_minmax): fix SEGV by [].minmax.

Sat Jun 23 17:18:19 2007  Tanaka Akira  <akr@fsij.org>

	* re.c (match_inspect): MatchData#inspect implemented.

Sat Jun 23 15:00:16 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_minmax): new method to get the minimum and maximum
	  values from the enumerable at once.

	* enum.c (enum_minmax_by): ditto.

Sat Jun 23 01:25:40 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_assoc): new method.

	* hash.c (rb_hash_rassoc): ditto.

	* hash.c (rb_hash_flatten): ditto.

Fri Jun 22 23:55:59 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_upto): add optional argument to specify
	  exclusiveness.

	* range.c (range_step): use String#upto with optional argument.

	* range.c (range_each): ditto.

Fri Jun 22 19:55:51 2007  Tanaka Akira  <akr@fsij.org>

	* proc.c (proc_to_s): revert the change from %p to %lx at YARV
	  merge time.

Fri Jun 22 19:33:49 2007  Tanaka Akira  <akr@fsij.org>

	* proc.c (proc_to_s): show is_lambda.

Thu Jun 21 20:36:12 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_sort): remove hash specific implementation.

Thu Jun 21 20:28:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_select): returns new hash, not assoc array.
	  [ruby-core:11504]

	* hash.c (env_select): ditto.

Thu Jun 21 23:08:19 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (rb_intern2): ID_JUNK test based on len, not by NUL.

Thu Jun 21 19:42:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* yarvcore.c (rb_thread_mark): mark also thrown_errinfo.

Thu Jun 21 17:13:44 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_intern2): name may not be NUL-terminated.

Wed Jun 20 08:27:57 2007  Tanaka Akira  <akr@fsij.org>

	* eval_error.h (error_print): show full stacktrace on
	  non-SystemStackError.

Wed Jun 20 04:45:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_intern2): use rb_intern2 to intern without trailing
	  equal sign.

	* parse.y (rb_intern2, ripper_id2sym): fixed indent.

Tue Jun 19 10:55:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_load.c (load_ext, rb_require_safe): pass VALUE instead of
	  pointer.  [ruby-Bugs-11659]

Mon Jun 18 08:47:54 2007  Technorama Ltd.  <oss-ruby@technorama.net>

	* ext/openssl/{extconf.rb,ossl_ssl_session.c}:
	  Fix ruby-Bugs-11513.

	* ext/openssl/ossl_pkey_ec.c
	  New methods EC::Point.[eql,make_affine!,invert!,on_curve?,infinity?]
	  By default output the same key form as the openssl command.

	* ext/openssl/ossl_rand.c
	  New method Random.status?

	* test/openssl/test_ec.rb
	  New tests.

Mon Jun 18 17:04:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_load.c (rb_require_safe, ruby_init_ext): load with ruby level
	  cfp.  [ruby-core:10779]

	* eval_intern.h, vm.c (rb_vm_call_cfunc): new function to call a
	  function with ruby level cfp.

Mon Jun 18 16:57:24 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (yycompile): disable trace while creating ruby_debug_lines.
	  [ruby-talk:253586]

	* thread.c (ruby_suppress_tracing): new function to call a function
	  with suppressing trace.

	* lib/debug.rb, lib/tracer.rb: for YARV.

Mon Jun 18 13:54:36 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): return EXIT_FAILURE if any exceptions occurred
	  in at_exit blocks.  [ruby-core:11263]

Mon Jun 18 02:49:16 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (env_mark): fix to mark block.proc.

	* vm.c (th_make_proc_from_block): set created proc to block->proc.

Mon Jun 18 02:48:12 2007  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c (vm_stack_dump_raw): hide VM stack trace.

Mon Jun 18 02:43:53 2007  Koichi Sasada  <ko1@atdot.net>

	* signal.c (sigsegv): clear gc_stress flag on SEGV.

Mon Jun 18 01:14:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_path2class): get rid of dangling pointer caused by
	  optimized out value.

	* variable.c (rb_global_entry, rb_f_untrace_var, rb_alias_variable,
	  rb_generic_ivar_table, generic_ivar_get, generic_ivar_set,
	  generic_ivar_defined, generic_ivar_remove, rb_mark_generic_ivar,
	  rb_free_generic_ivar, rb_copy_generic_ivar,
	  rb_obj_instance_variables): suppress warnings.

Sun Jun 17 11:11:07 2007  Tanaka Akira  <akr@fsij.org>

	* eval.c (rb_method_missing): avoid a warning "too many arguments
	  for format string" on "./ruby -ve 'def m() super end; m'".

Sat Jun 16 22:24:17 2007  Tanaka Akira  <akr@fsij.org>

	* gc.c (garbage_collect): re-introduce ruby_current_node marking code.
	  [ruby-dev:31005]

Sat Jun 16 21:37:43 2007  Tanaka Akira  <akr@fsij.org>

	* gc.c (gc_sweep): re-introduce heap extension strategy change.
	  [ruby-dev:31005]

Fri Jun 15 22:59:37 2007  Tanaka Akira  <akr@fsij.org>

	* .gdbinit: new file to ease debugging using gdb.

Fri Jun 15 22:33:55 2007  Tanaka Akira  <akr@fsij.org>

	* signal.c (default_handler): func argument removed.
	  (trap_handler): support SYSTEM_DEFAULT.  call default_handler
	  internally.
	  (sig_trap): don't call default_handler.
	  [ruby-dev:30999]

Fri Jun 15 22:33:29 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (realclean): separate local and ext.

	* ext/extmk.rb: not remove unrelated directories.

Fri Jun 15 20:50:02 2007  Tanaka Akira  <akr@fsij.org>

	* keywords: enclose C code in declaration section by %{ and %} to
	  avoid extra semicolon after #ifdef RIPPER.
	  pointed by eban.

Fri Jun 15 18:56:52 2007  Tanaka Akira  <akr@fsij.org>

	* signal.c (trap_handler): trap("SIGSEGV", "DEFAULT") may cause wrong
	  trap error because SIG_DFL may be zero.

Fri Jun 15 15:55:55 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def (setconstant, toregexp): fix to mark object correctly.

Fri Jun 15 13:24:18 2007  Koichi Sasada  <ko1@atdot.net>

	* hash.c: exchange semantics of Hash#each and Hash#each_pair.
	  pointed out by [ruby-dev:30997].

	* test/ruby/test_iterator.rb: ditto.

	* test/ruby/test_yield.rb: ditto.

Fri Jun 15 12:38:29 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_iterator.rb: remove debug code (GC.stress=true).

Fri Jun 15 12:25:33 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (th_yield_setup_args): |v| should work as |v,|.
	  ex) def m;yield 1, 2; end; m{|v| p v} #=> 1

	* parse.y: apply above change for "for" statement.

	* test/ruby/test_assignment.rb: ditto

	* test/ruby/test_basicinstructions.rb: ditto.

	* test/ruby/test_iterator.rb: ditto.

	* test/ruby/test_yield.rb: ditto.

	* compile.c (iseq_compile_each): fix debug.

Fri Jun 15 12:22:10 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (ruby_finalize_1): rb_thread_t#errinfo should be clear with
	  Qnil.

Fri Jun 15 12:20:11 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_cont_call): forbid cross fiber continuation call.

	* test/ruby/test_fiber.rb: ditto.

Fri Jun 15 12:14:07 2007  Koichi Sasada  <ko1@atdot.net>

	* sample/test.rb: fix to show line information whether test succeeds.

Thu Jun 14 17:16:05 2007  Tanaka Akira  <akr@fsij.org>

	* eval_load.c (Init_load): delay allocating an array for rb_load_path
	  to avoid GC problem in very early stage.
	  (RUBY_GC_STRESS causes GC in such stage.)

	* variable.c (rb_gc_mark_global_tbl): rb_global_tbl may be 0 in
	  very early stage.

	* thread.c (thread_cleanup_func) [IA64]: clear register stack position.
	  (thread_start_func_2) [IA64]: record the beginning of register
	  stack using extra argument.
	  (rb_gc_save_machine_context) [IA64]: record the end of register
	  stack.

	* gc.c [IA64] (SET_STACK_END): record the end of register stack.
	  (garbage_collect) [IA64]: use recorded register stack area for
	  GC marking.
	  (yarv_machine_stack_mark) [IA64]: GC mark from the register stack
	  area.

	* yarvcore.c [IA64] (rb_gc_register_stack_start): defined.
	  (Init_VM): store th->self on stack to fix GC problem.
	  (Init_yarv) [IA64]: initialize the beginning of register stack.

	* yarvcore.h (struct rb_thread_struct) [IA64]: new members for
	  register stack area.

	* thread_pthread.ci (thread_start_func_1) [IA64]: call
	  thread_start_func_2 with the end of register stack.

	* cont.c (struct rb_context_struct) [IA64]: new members for register
	  stack area.
	  (cont_mark) [IA64]: GC mark from register stack area.
	  (cont_free) [IA64]: free saved register stack.
	  (cont_save_machine_stack) [IA64]: record the position and contents
	  of the register stack.
	  (cont_capture): store cont->self on stack to fix GC problem.
	  (cont_restore_1) [IA64]: restore the register stack.
	  [IA64] (register_stack_extend): new function.
	  (cont_restore_0) [IA64]: call register_stack_extend instead of
	  cont_restore_1.

	[ruby-dev:30982]

Thu Jun 14 17:09:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser): handle more
	  extensions.  [ruby-dev:30972]

Thu Jun 14 14:40:42 2007  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb: document updated.
	  suggested by NaHi.  [ruby-dev:30966]

Wed Jun 13 22:42:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (garbage_collect): update IA64 register stack code.
	  [ruby-dev:30971]

Wed Jun 13 06:05:12 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (darwin): prohibit loading extension libraries to
	  miniruby.

Tue Jun 12 21:50:51 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (call_args): no allow splat after assocs.  takes
	  consistency over compatibility.

	* parse.y (call_args2): ditto

Tue Jun 12 14:53:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (Logging.quiet, Logging.message): added quiet flag and
	  use it.  [ruby-core:10909]

	* lib/mkmf.rb (find_header): use header names in the message.

Sun Jun 10 18:37:13 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/probeprofiler/probeprofiler.c: clean warnings.

Sun Jun 10 18:32:24 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/isinf.c, missing/dup2.c, missing/strtod.c, missing/x68.c,
	  missing/alloca.c: use "ruby/config.h".

Sun Jun 10 17:49:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (install_recursive): should check parent directories of
	  the destination.  [ruby-dev:30947]

Sun Jun 10 16:59:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (do_block, brace_block): fix line numbers.  [ruby-dev:30831]

Sun Jun 10 16:57:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (install_recursive): add :glob option rather than
	  using FNM_DOTMACH.

	* instruby.rb (ext-comm): make header directory first.

Sun Jun 10 16:10:58 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_beginendblock.rb: typo.

Sun Jun 10 16:07:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (install_recursive): skip .svn directories.

Sun Jun 10 15:44:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.status): rubyhdrdir was missing.

Sun Jun 10 15:26:36 2007  Tanaka Akira  <akr@fsij.org>

	* Makefile.in: use --output-file for gperf to not leave lex.c.tmp.

Sun Jun 10 15:11:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, win32/Makefile.sub (XCFLAGS): -I. is needed for *.inc.

	* ext/extmk.rb: prepend also topdir to mflags at last.

Sun Jun 10 13:47:36 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_beginendblock.rb (test_should_propagate_signaled):
	  get rid of invoking shell.  [ruby-dev:30942]

Sun Jun 10 12:56:46 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby: moved public headers.

	* instruby.rb (install_recursive): skip backup files.

	* instruby.rb (ext-comm): install only current platform headers.

Sun Jun 10 10:42:04 2007  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb: renamed from lib/secrand.rb.
	  suggested by NaHi.  [ruby-dev:30934]

Sat Jun  9 06:40:05 2007  Tanaka Akira  <akr@fsij.org>

	* lib/secrand.rb: rename SecRand() to SecRand.random_number.
	  suggested by NaHi.  [ruby-dev:30934]

Fri Jun  8 16:34:20 2007  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c (gzfile_s_open): use FilePathValue to support
	  to_path.

Fri Jun  8 16:11:00 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_jump.h: th->errinfo should clear with nil.

Fri Jun  8 14:53:28 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (call_args): allow splat argument after unpacked
	  assocs like 1.8 does.

	* parse.y (call_args): ditto.

Fri Jun  8 14:26:18 2007  Tanaka Akira  <akr@fsij.org>

	* lib/secrand.rb: new file for secure random interface.

	* lib/cgi/session.rb: use secrand for generating cookies.

Fri Jun  8 12:44:37 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {win32,wince}/Makefile.sub: add lex.c rule.

Fri Jun  8 11:54:18 2007  Tanaka Akira  <akr@fsij.org>

	* lex.c.blt: moved from lex.c.

	* Makefile.in: use lex.c.blt if gperf is not available.
	  [ruby-list:8212], [ruby-list:8214], [ruby-list:24667],
	  [ruby-talk:120857], [ruby-dev:28102]

Thu Jun  7 21:38:39 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_execute_interrupts): invoke ensure when
	  main thread exits.

Thu Jun  7 19:02:48 2007  Tanaka Akira  <akr@fsij.org>

	* lib/pp.rb: call original "method" method instead of redefined one.

Thu Jun  7 17:20:57 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (prepare_iseq_build): freeze filename and name string.

	* variable.c: freeze class name string.

Thu Jun  7 12:48:33 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (cont_restore_1): fix to check root fiber [ruby-dev:30911].

	* test/ruby/test_fiber.rb: add a test.

Thu Jun  7 07:24:36 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/json/common.rb: Ponder offering parse! method.

	* lib/json/editor.rb: be a bit more robust while loading data.

	* ext/json/ext/{generator,parser}/extconf.rb:
	  add a have_header directive for st.h

	* test/json: fix some tests.

Thu Jun  7 03:29:18 2007  Koichi Sasada  <ko1@atdot.net>

	* test_fiber.rb: add a test (Continuation and Fiber).

Thu Jun  7 03:17:24 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (cont_new): add debug message.

	* cont.c (cont_restore_1): copy stack information from fiber.

	* cont.c (rb_fiber_s_new): fix to mark created fiber.

	* test/ruby/test_fiber.rb: add some tests around Thread and Fiber.

	* yarvcore.c (thread_free): fix to skip freeing stack if root fiber
	  is available.

Thu Jun  7 01:03:20 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_intern.h, eval.c (ruby_init): remove POP_TAG_INIT().

	* cont.c (rb_fiber_start): remove zero-clearing tag.

Wed Jun  6 20:23:46 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def (invokeblock): fix of splat argument.
	  (splat same as normal method dispatch)

Wed Jun  6 16:27:25 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* insns.def: fixed indentation.

Wed Jun  6 10:58:23 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_yield): fix to check Qundef.

Wed Jun  6 10:57:45 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_continuation.rb: add a test for last commit.

Wed Jun  6 10:55:42 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_cont_call): forbid calling dead fiber with
	  Continuation#call.

Wed Jun  6 10:50:01 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix around yield arguments
	  (with NODE_ARGSCAT).

Wed Jun  6 02:50:53 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_fiber_start): clear th->tag and check error to fix
	  [ruby-dev:30888] and [ruby-dev:30889].

	* eval_intern.h: fix rb_fiber_start() prototype.

	* test/ruby/test_fiber.rb: add tests for above.

Wed Jun  6 02:40:20 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* insnhelper.h, insns.def (DEC_SP): shouldn't use unary minus operator
	  in pointer operation. some compilers (such as VC++8 x64) cannot deal
	  it with expected way.

Wed Jun  6 02:19:48 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y (new_yield), compile.c (iseq_compile_each): fix
	  passing parameter.

	* eval.c, eval_jump.h: simplify rb_yield*.

	* proc.c (proc_mark): fix to mark proc->block.proc.

	* proc.c (Init_Proc): add Proc#lambda?

	* test/ruby/test_lambda.rb: add some tests.

	* vm.c (invoke_block): fix to check lambda block or not.

	* vm.c (th_yield_setup_args): fix to check arguments size
	  when lambda block.

Tue Jun  5 16:30:38 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_p): returns arguments to intervene.  [ruby-dev:29736]

Tue Jun  5 14:07:55 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def (invokeblock): check block is created by lambda
	  or Proc.new.

	* vm.c (block_proc_is_lambda): added.

Tue Jun  5 14:47:52 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/pp.rb (PP::PPMethods::seplist): revert last change to work
	  around wrapper bug.  [ruby-dev:30840]

Tue Jun  5 14:11:15 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (kanji_convert): Fix guess fallback.

Tue Jun  5 13:32:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c, dir.c, eval.c, eval_jump.h, eval_method.h, numeric.c,
	  pack.c, parse.y, re.c, thread.c, vm.c, vm_dump.c, call_cfunc.ci,
	  thread_pthread.ci, thread_win32.ci: fixed indentation.

	* call_cfunc.ci: protoized.

	* thread_win32.ci: fixed typo.

Tue Jun  5 13:17:11 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* call_cfunc.ci, compile.c, dir.c, eval.c, eval_jump.h, numeric.c,
	  pack.c, re.c, thread.c, thread_win32.ci, vm.c, vm_dump.c: fixed
	  indentation.

Mon Jun  4 21:15:45 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/json.rb, lib/json, ext/json, test/json:
	  import JSON library.

	* ext/nkf: import nkf.c rev:1.124
	  Support CP10001.

Mon Jun  4 20:52:58 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_round): should not just truncate.

Sat Jun  2 16:48:55 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (Fiber#pass): rename to Fiber#yield.  Block parameter
	  of fiber body receive first yield values.
	  e.g.: Fiber.new{|x| p x}.yield(:ok) #=> :ok

	* cont.c: rename rb_context_t#retval to rb_context_t#value.

	* test/ruby/test_fiber.rb: ditto.

Sat Jun  2 16:45:21 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c (Init_Proc): remove a line break.

Sat Jun  2 01:27:27 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_round): small optimization to handle bignums.

Fri Jun  1 13:02:35 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* insnhelper.h (INC_SP): shouldn't cast ``x'' to unsigned type because
	  it might be a negative value.

	* insnhelper.h, insns.def: shouldn't use unary minus operator in index
	  operator. some compilers (such as VC++8 x64) cannot deal it with
	  expected way.

Fri Jun  1 11:33:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (num_round): should convert self to Float.
	  [ruby-dev:30860]

Fri Jun  1 02:01:13 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_round): now takes optional argument to specify
	  number of digits, like round() in Python/PHP.

	* numeric.c (num_round): ditto.

Fri Jun  1 01:58:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (each_with_index_i): should work well with continuation.
	  a patch from sheepman <sheepman AT sheepman.sakura.ne.jp>.
	  [ruby-dev:30846]

Thu May 31 17:27:53 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/benchmark.rb (Benchmark::Job::item): avoid modifying the
	  argument unintentionally.  [ruby-talk:253676]

Wed May 30 14:43:00 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c (cont_capture): store all local variables in heap
	  ([ruby-dev:30832]).

	* vm.c (th_stack_to_heap): added.

	* test/ruby/test_continuation.rb: add a test for above.

	* eval_intern.h (th_get_ruby_level_cfp): fix to clean code.

Wed May 30 13:32:34 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (ResponseParser#next_token): fixed
	  error message.

	* lib/net/imap.rb (ResponseParser#parse_error): fixed
	  the condition not to refer to @token.symbol unexpectedly.
	  Thanks, Dick Monahan.

Wed May 30 13:24:33 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (Net::FTP#transfercmd): skip 2XX
	  responses for some FTP servers.

Wed May 30 04:18:37 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval_cmd): just return if no exceptions.
	  [ruby-dev:30820]

Wed May 30 02:14:25 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (interrupt_init): needs to pass nil for Interrupt.
	  [ruby-core:11038]

	* signal.c (trap): fixed segfaults.  [ruby-dev:30830]

Wed May 30 00:50:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_source_filename, obj_free): suppress warnings.

	* gc.c (garbage_collect, yarv_machine_stack_mark): fixed typo.
	  http://bugs.debian.org/426267

Wed May 30 00:24:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (open_args, arg_ambiguous, parser_warning): should not use
	  rb_warning in the parser.

Tue May 29 12:31:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_opendir): removed duplicated code.

Tue May 29 10:55:24 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: fix bug around Continuation and Fiber.

	* test/ruby/test_continuation.rb: add tests for Continuation.

Tue May 29 10:54:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_opendir, rb_w32_readdir): eliminate magic
	  numbers.

Mon May 28 10:27:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cont.c: fixed a function name.

Mon May 28 03:56:44 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: support Fiber.  Check test/ruby/test_fiber.rb for detail.
	  Fiber is known as "Micro Thread", "Coroutine", and other terms.
	  At this time, only Fiber#pass is supported to change context.
	  I want to know more suitable method name/API for Fiber (... do you
	  know more suitable class name instead of Fiber?) as "suspend/resume",
	  "call", "yield", "start/kick/stop/restart", ....

	* eval.c, eval_intern.h, thread.c, yarvcore.c, yarvcore.h: ditto.

Sat May 26 00:38:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_exec_internal): do nothing if no code.

	* compile.c (rb_iseq_compile): check node if NULL before check
	  nd_type.  [ruby-talk:252956]

Sat May 26 00:05:22 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_beginendblock.rb (test_should_propagate_signaled):
	  skip tests for exitstatus and termsig on the platforms where
	  signals not supported.

Fri May 25 16:04:47 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* yarvcore.c (Init_VM): wrap already initialized structs to use
	  it directly.

Fri May 25 11:09:47 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* regint.h (include): on some platform, defines.h redefines
	  SIZE_OF_LONG_LONG so shouldn't re-include config.h after included
	  defines.h.

	* regint.h (vsnprintf): ruby on windows already have vsnprintf macro.

Thu May 24 12:07:27 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: check across trap violation.

	* eval.c, yarvcore.h: ditto.

Thu May 24 11:46:55 2007  Koichi Sasada  <ko1@atdot.net>

	* gc.c, yarvcore.c: fix to mark VM structure on startup.

	* yarvcore.h: disable USE_CACHED_VALUE.

Thu May 24 01:54:53 2007  Koichi Sasada  <ko1@atdot.net>

	* cont.c: support callcc which everyone love.
	  incomplete. please give me bug reports.

	* common.mk, inits.c, thread.c: ditto.

	* yarvcore.c: export thread_mark().

	* yarvcore.h: disable value cache option.

	* eval_intern.h: set th_get_ruby_level_cfp to inline.

Wed May 23 15:39:02 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* common.mk: add a rule for regsyntax.c.

Wed May 23 10:31:53 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* oniguruma.h: updated to Oniguruma 5.7.0.

	* regsyntax.c, unicode.c: new files along with Oniguruma 5.x.

Wed May 23 06:51:46 2007  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* lib/cgi.rb (CGI#[]): get rid of exceptions being raised.
	  [ruby-dev:30740], Thanks Kentaro KAWAMOTO.

Wed May 23 05:49:49 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb, ext/purelib.rb, lib/mkmf.rb, runruby.rb: clear default
	  load path to get rid of load pre-installed extensions/libraries.
	  [ruby-core:11017]

Tue May 22 16:37:36 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (set_arg0): support RSTRING_LEN on HP-UX.  a patch from
	  WATANABE Tetsuya <Tetsuya.WATANABE AT nifty.com>.  [ruby-dev:30806]

Mon May 21 13:40:00 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, vm_macro.def: support tail call optimization
	  (on default, this feature is not enabled).

	* iseq.c, compile.c, vm_opts.h: add "tailcall_optimization"
	  option.

	* sample/test.rb (test_ok): fix to adjust tailcall stack layout.

	* insns.def, vm.c, compile.c, yarvcore.c, yarvcore.h:
	  add opt_gt, opt_le instructions.

Mon May 21 03:34:06 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb: CRAM-MD5 authentication did not work.
	  [ruby-dev:30770]

Sat May 19 10:26:01 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (Date._parse): detects some OFX dates
	  (Of course not fully).

Sat May 19 03:08:05 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_inject): minor improvement.  [ruby-dev:30792]

	* enum.c (one_i): no needs to iterate once the result became false.

	* enum.c (enum_one): fix for an example.

	* enum.c (one_iter_i, none_iter_i): DRY.;

Sat May 19 01:07:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_inject): it is now can work without block.  you
	  have to specify two argument method name as the first argument.

	* enum.c (Init_Enumerable): reduce is new alias to inject.

Sat May 19 01:05:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (Init_File): method definition mismatch.

Fri May 18 16:44:04 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (Init_File): add to_path method to File objects.

Fri May 18 11:12:39 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (DllMain, ruby_init_loadpath): use DLL instance handle given
	  to DllMain instead of VirtualQuery so that loadpath becomes relative
	  from the DLL on WinCE too.

Thu May 17 17:03:11 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el (ruby-style-label-indent): for yacc rules.

Thu May 17 13:30:27 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_arg): remove typo from ripper description.

Thu May 17 13:23:38 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y, compile.c (set_arguments): fix to support in-paren
	  parameter (ex: def foo((a, b))).

Thu May 17 13:01:52 2007  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (ruby_iseq_disasm): fix to show post arg info.

Thu May 17 12:56:52 2007  Koichi Sasada  <ko1@atdot.net>

	* debug.c (ruby_debug_node): fix to show node line.

Wed May 16 21:48:44 2007  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb (Logger::Application): remove meaningless logdev
	  attribute and added logger attribute instead.  [ruby-core:11143]
	  also added Logger#formatter rdoc comment.

Tue May 15 16:40:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_beginendblock.rb (test_endblockwarn): now parser
	  warnings emit source names and line numbers.

Tue May 15 15:01:38 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (init_stdhandle): stderr should be without buffering,
	  but mswin32 use buffering when stderr is not connected to tty.

Mon May 14 02:12:07 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_zip): a.zip(b,c) should return an array, not
	  enumerator.

	* array.c (rb_ary_zip): a.zip(b,c) should return array with size
	  truncated to the size of its shortest argument array.
	  [incompatible]

Mon May 14 01:54:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_choice): should return nil when the array is
	  empty.

Sat May 12 18:26:36 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (tokens): forgot to add strip. [ruby-core:11120]

	* test/net/http/test_http.rb: test Net::HTTP.post_form.

Fri May 11 15:27:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (iseq_data_to_ary): internal IDs must not be exposed.
	  [ruby-core:11073]

	* parse.y (internal_id_gen): now returns scope local ID instead of
	  global one.

Thu May 10 15:15:53 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_super.rb: add tests.

Thu May 10 15:14:05 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_s_conv): rdoc fix.

Thu May 10 15:09:23 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (POINTER_P): pointer may be larger than long.

	* parse.y (vtable_size, vtable_included, vtable_tblcpy,
	  vtable_to_tbl): constified.

Thu May 10 10:13:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_priority): rdoc fix; the initial value is
	  inherited from the creating thread.  [ruby-core:10607]

Wed May  9 12:28:57 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (Init_Bignum), numeric.c (Init_Numeric): added fdiv as
	  aliases of quo.  [ruby-dev:30771]

Tue May  8 23:39:09 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (Date._parse): revised treatment of
	  hyphened/separatorless dates.

	* lib/date/format.rb: some trivial adjustments.

Tue May  8 20:23:07 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: reverted.

Tue May  8 19:32:18 2007  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/rational.rb: fix high-precision Rationals cannot be
	  converted to Floats. [ruby-Bugs:10502], [ruby-core:11069],
	  [ruby-dev:30743]

Mon May  7 10:59:55 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/image.rb, test/rss/test_image.rb: fixed Image module
	  namespace URI. reported by Dmitry Borodaenko. Thanks.

Sun May  6 18:44:11 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (Net::HTTP.post_form): allow an Array of String
	  for pairs argument. [ruby-Bugs:10340]

	* lib/net/http.rb (Net::HTTP#set_form_data): ditto.

Sun May  6 17:54:36 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: Connection header field might include both of
	  "keep-alive" token and "close" token. [ruby-core:10818]

Sat May  5 16:26:33 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/date/format.rb (Format::Bag#method_missing): get rid of
	  modifying original argument.  [ruby-core:11090]

Thu May  3 22:20:08 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, defines.h, eval_load.c (rb_feature_p, rb_provided,
	  search_required, rb_require_safe), ext/extmk.rb: Fix
	  a bug where a statically linked extension cannot be autoloaded.
	  [ruby-dev:30023] / [ruby-dev:30239]

	* thread.c: added an internal class, Barrier.

	* thread.c: copied rdocs from fastthread.

	* yarvcore.h (struct rb_vm_struct): moved loading_table from global.

Thu May  3 18:10:12 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_evalbody.ci, insns.def, vm.c, tool/insns2vm.rb (rb_num_t):
	  renamed to get rid of name clash.  [ruby-dev:30504]

	* yarvcore.c (ruby_thread_init): ditto.

Wed May  2 18:52:58 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c, yarvcore.h, yarvcore.c, insns.def: fix to mark VM stack
	  in correct range.

Wed May  2 17:13:26 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_quo): now calculate in integer.  [ruby-dev:30753]

Wed May  2 15:14:56 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_method.h: add redefine checks ([ruby-dev:30751]).

Wed May  2 11:22:52 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: use Qtrue instead of 2.

	* vm.c, insns.def: support "lambda" calling convention.

Wed May  2 06:46:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c, parse.y, ruby.h (rb_compile_warn, rb_compile_warning): warn
	  for compilation.  the parser should no longer use rb_warn() and
	  rb_warning().  [ruby-dev:30121]

Wed May  2 05:45:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (assoc): result of assoc_new needs to be an assoc.

Wed May  2 05:40:43 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_pow): improvement by calculating from MSB and using
	  factorization.  <http://yowaken.dip.jp/tdiary/20070426.html#p01>

Tue May  1 18:45:45 2007  Koichi Sasada  <ko1@atdot.net>

	* sample/test.rb: import matzruby's sample/test.rb.

Tue May  1 17:46:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_choice): a new method to choose an element
	  randomly from an array.

	* array.c (rb_ary_choice): fixed mistake from RDoc.

Tue May  1 13:59:18 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c (proc_arity): fix an arity bug ([ruby-core:11060]).

Tue May  1 13:12:49 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h, compile.c (set_arguments): support post arguments.

	* test/ruby/test_method.rb: add tests for above.

	* test/ruby/test_proc.rb: ditto.

	* proc.c: fix an arity bug ([ruby-core:11029]).

	* vm.c, vm.h, insns.def, vm_dump.h: fix bmethod process.

	* vm.c: support block argument on block parameter.

Fri Apr 27 17:05:41 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (int_pow): bugfix of overflow detection.

	* numeric.c (int_pow): rb_big_pow() may return other than Bignum.

Fri Apr 27 01:51:50 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c: support multiple splat (e.g, [a, *b, *c, e, *f]).

Fri Apr 27 00:03:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_pow): truncate all zero BDIGITs. [ruby-dev:30733]

Thu Apr 26 17:31:00 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_pow): reduce multiplying for even number.

	* numeric.c (int_pow): calculate power in Fixnum as possible.
	  [ruby-dev:30726]

Thu Apr 26 17:18:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y: fixes for ripper.

	* parse.y (primary): reduced duplicated code.

	* parse.y (f_arg_item): should not override by meaningless value.

	* parse.y (f_arg, assocs): should not use $$ before assigned.

	* parse.y (assoc_list): dispatch assoclist_from_args for assocs as
	  well as args.

	* parse.y (assoc): return assoc if dispatched result is $1.

Thu Apr 26 13:54:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-style.el: new file.  C/C++ style for ruby source code.

Wed Apr 25 19:49:16 2007  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (unix_send_io, unix_recv_io): use CMSG_DATA to
	  align file descriptor appropriately.

Wed Apr 25 15:23:29 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (NtInitialize, exit_handler): add initializing and
	  cleanup of critical section object for select.

	* win32/win32.c (do_select): block reentrance.

	* win32/win32.c (rb_w32_select): 0 sec polling of socket. this is
	  workaround because winsock cannot do select at same socket at the
	  same time by two or more threads.

Wed Apr 25 14:10:47 2007  Koichi Sasada  <ko1@atdot.net>

	* ext/probeprofiler/probeprofiler.c: fix function name and
	  return value.

Wed Apr 25 12:42:40 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h: remove rb_control_frame_t#callee_id.

	* vm_macro.def: ditto.

	* eval_intern.h (exec_event_hooks): fix to check event flags

	* eval_intern.h (EXEC_EVENT_HOOK): fix to re-check event flags.

	* ext/probeprofiler : added.  this profiler is sampling based
	  profiler.

	* vm.c: add rb_thread_current_status() API for probeprofiler.

	* thread.c (rb_thread_execute_interrupts): add comments.

Wed Apr 25 10:36:03 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_intern.h (PUSH_TAG): no argument now.

	* eval.c, eval_error.h, eval_jump.h, eval_load.c, proc.c, thread.c:
	  ditto.

	* thread.c (alloc_event_hook, rb_thread_remove_event_hook): should
	  return value.

Tue Apr 24 09:33:57 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (do_stat, do_lstat, do_opendir): should not warn ENOTDIR.
	  [ruby-talk:248288]

Mon Apr 23 22:14:42 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb ($ruby): add extout directory to include path.
	  [ruby-core:11003]

	* lib/mkmf.rb (libpathflag): not to append RPATHFLAG to current
	  directory.

	* lib/mkmf.rb (init_mkmf): add current directory to default
	  library path with highest priority.  [ruby-core:10960]

	* lib/mkmf.rb (LINK_SO): LIBPATH to be placed before DLDFLAGS.

Fri Apr 20 16:05:22 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBPATHFLAG, RPATHFLAG): no needs to be quoted,
	  it is done by libpathflag in mkmf.rb.

Fri Apr 20 12:27:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb: fix to override conv proc.

Fri Apr 20 12:21:28 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): fixed access to out of bound, and inverted
	  the order of errinfos.

Fri Apr 20 10:33:23 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_intern.h: add prototypes of rb_sourceline() and
	  rb_sourcefile().

Fri Apr 20 02:37:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): re-send signal.  [ruby-dev:30516]

	* eval_error.h (error_handle): no message when exiting by signal.

	* intern.h (rb_thread_signal_raise, ruby_default_signal): prototypes.

	* signal.c (esignal_init): takes a signal number and an optional
	  signal name.

	* signal.c (interrupt_init): pass SIGINT always.

	* signal.c (ruby_default_signal): invoke system default signal
	  handler.

	* signal.c (rb_f_kill): use NUM2PIDT instead of NUM2INT.

	* signal.c (rb_signal_exec, trap): handle SIGTERM.  [ruby-dev:30505]

	* thread.c (rb_thread_signal_raise): now takes signal number instead
	  of signal name.

	* thread.c (rb_thread_signal_exit): since rb_make_exception() calls
	  #exception method, rb_class_new_instance() is not needed here.

	* yarvcore.h (struct rb_vm_struct), eval_jump.h (terminate_process):
	  exit_code is no longer stored in VM.

Thu Apr 19 18:37:49 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c, node.h, thread.c, yarvcore.[ch], eval_intern.h:
	  support set_trace_func (incomplete.  id and klass
	  don't be passed).  And support Thread#set_trace_func
	  which hook only specified thread and Thread#add_trace_func
	  which add new trace func instead of replace old one.
	  C level API was modified.  See thread.c (logic) and
	  yarvcore.h (data structures).

	* vm.c, vm_macro.def: add hook points.

	* compile.c, insns.def: fix "trace" instruction.

	* iseq.c, vm_macro.h: add compile option "trace_instruction".

	* test/ruby/test_settracefunc.rb: hook "c-return" of set_trace_func.

Thu Apr 19 20:57:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (symbol): symbols should be followed by EXPR_ENDARG.

	* parse.y (dsym): ditto.

	* parse.y (parser_yylex): strings should be followed by
	  EXPR_ENDARG.

	* parse.y (parser_yylex): ditto for numbers.

	* parse.y (parser_yylex): EXPR_ENDARG after ']' and '}'.

Thu Apr 19 17:46:36 2007  Koichi Sasada  <ko1@atdot.net>

	* lib/optparse.rb: fix to override conv proc.

Wed Apr 18 10:41:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strtod): exponent is radix 10.  [ruby-talk:248272]

Wed Apr 18 02:50:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* yarvcore.c (th_init2): push initial blockptr value for
	  rb_block_given_p() outside ruby_exec().  [ruby-core:10923]

Wed Apr 18 02:30:24 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LDFLAGS): prepend -L. instead appending it to
	  XLDFLAGS.  [ruby-core:10933]

	* configure.in (Makefile): remove $U for automake from MISSING.
	  [ruby-talk:248171]

Mon Apr 16 22:56:01 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/pty/expect_sample.rb: avoid symbolic link representation for
	  expect.  a patch from Kazuhiro NISHIYAMA <zn at mbf.nifty.com>.
	  [ruby-dev:30714]

Mon Apr 16 22:51:11 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample: replace TRUE, FALSE with true, false respectively.
	  a patch from Kazuhiro NISHIYAMA <zn at mbf.nifty.com>.
	  [ruby-dev:30713]

Mon Apr 16 17:08:02 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (make_switch): do not clobber converter if pattern
	  has no convert method.  reported by sheepman in [ruby-dev:30709].

Mon Apr 16 16:49:32 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_seek): consistent behavior with
	  IO#seek.  patch by sheepman in [ruby-dev:30710].

Mon Apr 16 16:34:08 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): should set command_start after block
	  starting "do"s and braces.  [ruby-core:10916]

Mon Apr 16 10:51:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_each_with_index): each_with_index to forward
	  arguments to each.  [ruby-core:10921]

Mon Apr 16 10:43:10 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_arg): should allow to specify 24:00.
	  [ruby-core:10915]

Sun Apr 15 09:12:54 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: added some zone names.

	* lib/date/format.rb (_parse): now interprets doted numerical
	  dates as a big endian (except dd.mm.yyyy).

Thu Apr 12 17:13:22 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (mutex_try_lock): check and set owner thread.

	* thread_pthread.ci: fix to show error code in error message.

Thu Apr 12 17:11:54 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_rescue2): restore cfp ([ruby-dev:30582]).

Thu Apr 12 16:06:48 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c (rb_protect): restore cfp ([ruby-dev:30671]).

Thu Apr 12 16:04:31 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): check node->nd_state == 1, not !0.

Wed Apr 11 16:35:16 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.[ch] (rb_w32_enter_critical, rb_w32_leave_critical): no
	  need to reject reentrance. removed.

	* rubysig.h (RUBY_CRITICAL): follow above changes.

	* rubysig.h (TRAP_BEG, TRAP_END): no need to save errno.

Tue Apr 10 17:02:17 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_fclose, rb_w32_close): need to save errno
	  before calling original fclose()/close().

Tue Apr 10 16:14:22 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.ci (w32_wait_events): check whether interrupt_event is
	  valid handle or not.

	* thread_win32.ci (native_thread_destroy): clear interrupt_event when
	  close it.

Tue Apr 10 15:53:17 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_pthread.ci (native_thread_create): initialize sleep_cond.
	  fixed: [ruby-dev:30675]

Mon Apr  9 18:48:57 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (do_select): ubf_select() is not necessary. interrupt is
	  checked in the loop.

Mon Apr  9 18:27:26 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (do_select): use ubf_select() as UBF on windows.

	* win32/win32.c (do_select): shouldn't call catch_interrupt() here.
	  fixed: [ruby-dev:30674], reported by wanabe.

Mon Apr  9 09:24:32 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (disconnect): call shutdown for
	  SSLSocket. Thanks, Technorama Ltd.

Sun Apr  8 13:28:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (defined_expr): test arguments of NODE_CALL and so
	  on as well as NODE_ATTRASGN.  [ruby-core:10886]

Fri Apr  6 10:56:29 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_pkey_ec.c (ossl_ec_key_get_group): get rid of
	  warning. we are aware of it.

Fri Apr  6 04:00:24 2007  Technorama Ltd.  <oss-ruby@technorama.net>

	* ext/openssl/ossl_{bn,x509{attr,cert,name,store}}.c:
	  Add documentation.

Thu Apr  5 17:59:19 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (defined_expr): support for assignment.
	  [ruby-core:10867]

	* compile.h (ADD_CATCH_ENTRY): removed temporary variable.

Thu Apr  5 15:13:34 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_alloc): should
	  return value.

Thu Apr  5 14:58:49 2007  Technorama Ltd. <oss-ruby@technorama.net>

	* ext/openssl/ossl_pkcs5.c: New module.

	* ext/openssl/ossl_{cipher,digest,pkcs7,pkcs12}.c:
	  Remove redundant module namespace.

	* ext/openssl/lib/openssl/{cipher,digest}.rb
	  Add backwards compatible classes for rearranged classes.

	* ext/openssl/ossl_{pkcs7,pkcs12}.c: Add documentation.

Thu Apr  5 00:42:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_notimplement), io.c (pipe_open): removed definite
	  articles and UNIX manual section from messages.  [ruby-dev:30690]

Wed Apr  4 17:09:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): refined the message of NotImplementedError.
	  [ruby-dev:30685]

Wed Apr  4 12:29:02 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* error.c (rb_notimplement): should show the name of this func,
	  not callee.

Wed Apr  4 10:18:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (popen_exec): should not close close-on-exec FDs.
	  [ruby-dev:30679]

	* io.c (pipe_open): raise NotImplementedError for command "-" on
	  platforms where fork(2) is not available.  [ruby-dev:30681]

Tue Apr  4 04:17:18 2007  Technorama Ltd. <oss-ruby@technorama.net>

	* ext/openssl/ossl_ssl.c: Add documentation.

Tue Apr  3 16:22:24 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/extconf.rb: check for functions added in 1.9.

	* ext/openssl/ruby_missing.h: check per features instead by
	  checking version code.  [ruby-core:10845]

Tue Apr  3 16:02:44 2007  Technorama Ltd. <oss-ruby@technorama.net>

	* ext/openssl/ossl_bn.c: More documentation.

	* ext/openssl/lib/ossl_{pkey,pkey_ec}.[ch]: Add elliptic curves.

Tue Apr  3 15:50:41 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (s_recv, s_recvfrom): some systems (such as
	  windows) doesn't set fromlen if the socket is connection-oriented.
	  reported by Bram Whillock in [ruby-core:10512] [ruby-Bugs#9061]

Tue Apr  3 09:36:55 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ruby_missing.h: need to include version.h to check
	  RUBY_VERSION_CODE.

Mon Apr  3 07:10:12 2007  Technorama Ltd. <oss-ruby@technorama.net>

	* ext/openssl/ossl_{ssl.[ch],ssl_session.c},
	  ext/openssl/lib/openssl/lib/openssl/ssl.rb:
	  New SSL::Session class.  Add session cb's, getter/setters,
	  config, and statistics methods.

Mon Apr  3 04:00:23 2007  Technorama Ltd. <oss-ruby@technorama.net>

	* ext/openssl/{ossl.[ch],ossl_pkey.c} Add documentation.

	* ext/openssl/ossl_hmac.c Add reset method.

	* ext/openssl/ossl_cipher.c (Cipher#update) Take additional
	  buffer argument.

	* ext/openssl/{ossl_bio.c,ossl_ssl.c,ruby_missing.h}
	  compatibility with 1.8.

Mon Apr  2 21:55:12 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (throw), thread.c, yarvcore.h (throwed_errinfo): fixed
	  typo.

Fri Mar 30 11:46:51 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_cmdvector): fixed buffer size. reported by
	  wanabe [ruby-dev:30672]

	* win32/win32.c (init_env, insert, rb_w32_get_environ): use strdup
	  instead of malloc + strlcpy. suggested by nobu [ruby-dev:30673]

Fri Mar 30 02:29:04 2007  Technorama  <oss-ruby@technorama.net>

	* ext/openssl/ossl_{bn,cipher,digest,hmac,rand,pkey_{dh,dsa,rsa}}.c:
	  Add Documentation for various methods.

	* ext/openssl/lib/openssl/cipher.rb: Ditto

	* ext/openssl/ossl_bn.c: add lshift! and rshift! methods.

	* ext/openssl/ossl_digest.c: GetDigestPtr() also accept a string.

Fri Mar 23 11:28:24 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (init_env, insert, cmdglob, rb_w32_cmdvector,
	  rb_w32_opendir, rb_w32_readdir, rb_w32_strerror, rb_w32_stati64,
	  rb_w32_get_environ): use strlcpy() and strlcat().

	* win32/win32.c (rb_w32_opendir): use realloc() instead of xrealloc().

	* win32/win32.c (rb_w32_closedir): check NULL before free pointers.

Fri Mar 23 00:24:52 2007  Keiju Ishitsuka <keiju@ruby-lang.org>

	* lib/shell: commit miss(support for ruby 1.9(YARV) thread model).

Thu Mar 22 13:32:17 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (LIBS): remove an unnecessary library.

Thu Mar 22 10:27:58 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_bignum.rb (test_to_s): add tests for Bignum#to_s.

Wed Mar 21 20:38:06 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* marshal.c (w_short, w_long, w_object): get rid of VC++ warnings.

Wed Mar 21 20:05:07 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, parse.y, eval.c, intern.h, iseq.c, lex.c, node.h,
	  proc.c, vm.c, vm_macro.def, vm_macro.def, yarvcore.c, yarvcore.h,
	  debug.c, debug.h: merge half-baked-1.9 changes.  The biggest change
	  is to change node structure around NODE_SCOPE, NODE_ARGS.  Every
	  scope (method/class/block) has own NODE_SCOPE node and NODE_ARGS
	  represents more details of arguments information.  I'll write a
	  document about detail of node structure.

Wed Mar 21 17:04:30 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big2str0): round up for the most significant digit.
	  [ruby-core:10686]

Tue Mar 21 08:20:00 2007  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* test/testunit/collector/test_dir.rb: Fixed test/unit tests that
	  were breaking due to Module#public_instance_methods now
	  returning a Symbol instead of a String.

	* test/testunit/collector/test_objectspace.rb: Ditto.

Tue Mar 20 22:54:50 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_extended): erroneous check condition when dump
	  method is defined.  [ruby-core:10646]

Tue Mar 20 21:36:47 2007  Keiju Ishitsuka <keiju@ruby-lang.org>

	* lib/shell.rb, lib/shell: support for ruby 1.9(YARV) thread model.

Tue Mar 20 16:36:08 2007  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* distruby.rb: Add zip generation.

Tue Mar 20 16:20:49 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_callee_name): add __method__ and __callee__ again.
	  __callee__ need to rework to adopt YARV.  [ruby-core:10671]

Tue Mar 20 11:09:00 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb: Revise rdoc.

	* lib/set.rb (Set#freeze, Set#taint, Set#untaint): Implement
	  Set#freeze, Set#taint, and Set#untaint; requested by: Dan
	  Hutchings <dan AT moltoagitato.com> in [ruby-bugs:PR#9359].

Tue Mar 20 09:13:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_fork): flush stdouts always before fork(2).
	  fixed: [ruby-dev:30612]

Tue Mar 20 01:38:48 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_start_func_2): store the result of first_func
	  as well as first_proc.

	* thread.c (thread_create_core): block is not used if first_func
	  is given.

Mon Mar 19 16:58:52 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* missing/{strlcat,strlcpy}.c, missing.h: new functions.

	* LEGAL: add copyright notice about above files.

	* configure.in: check whether strlcat and strlcpy are exist or not.

	* {bcc32,win32,wince}/Makefile.sub: use above files.

Mon Mar 19 14:12:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/matrix.rb (Matrix::inverse_from): adding partial pivoting to
	  the Gauss-Jordan algorithm, making it stable.  a patch from
	  Peter Vanbroekhoven.  [ruby-core:10641]

Mon Mar 19 12:13:36 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regparse.c, etc.: K&R to ANSI code cleanup patch from Stefan
	  Huehner <stefan at huehner.org>.  [ruby-core:10543]

Mon Mar 19 11:27:13 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/protocol.rb (rbuf_read): extend buffer size for speed.

Sun Mar 18 08:31:51 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/dir.h, win32/win32.c (rb_w32_opendir, rb_w32_readdir,
	  rb_w32_closedir): get rid of possible buffer-overflows.

Sat Mar 17 19:10:39 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss, test/rss:
	- supported Atom.
	- bumped version 0.1.6 to 0.1.7.
	* sample/rss/convert.rb: added new sample.

Fri Mar 16 22:32:20 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/pop.rb: change default verification mode from
	  VERIFY_PEER to VERIFY_NONE because most POPS server does not have
	  true certification.

Fri Mar 16 22:19:24 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE#ole_activex_initialize,
	  a little bit supporting ActiveX control. [ruby-talk:241188]

Fri Mar 16 22:16:58 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: merge Ruby-SSPI patch contributed by Justin
	  Bailey.

	* ext/Win32API/lib/win32/sspi.rb: new file.

Wed Mar 14 12:30:00 2007  Shigeo Kobayashi  <shigeo@tinyforest.jp>

	* ext/bigdecimal/bigdecimal.c: BigDecimal("-.31") is now
	  treated as ("-0.31") not as ("0.31").

Tue Mar 13 19:04:30 2007  Keiju Ishitsuka <keiju@ruby-lang.org>

	* lib/sync.rb: support for ruby 1.9(YARV) thread model.

Tue Mar 13 09:25:10 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (clear-installed-list): separated from install-prereq.

Tue Mar 13 07:23:20 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb (mon_try_enter): call @mon_muetx.try_lock.
	  Thanks, Keiju ISHITSUKA. [ruby-dev:30507]

Tue Mar 13 02:42:58 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/cgi.rb (CGI::header): IIS >= 5.0 does not need the nph
	  assumption any more; submitted by MIYASAKA Masaru <alkaid AT
	  coral.ocn.ne.jp> in [ruby-dev:30537].

Mon Mar 12 10:53:28 2007  Akinori MUSHA  <knu@iDaemons.org>

	* ext/openssl/ossl_asn1.c (Init_ossl_asn1): Let rdoc know about
	  externally defined modules; submitted by Technorama
	  Ltd. <oss-ruby AT technorama.net> in [ruby-bugs:PR#4704].

	* ext/openssl/ossl_bn.c (Init_ossl_bn): Ditto.

	* ext/openssl/ossl_cipher.c (Init_ossl_cipher): Ditto.

	* ext/openssl/ossl_digest.c (Init_ossl_digest): Ditto.

	* ext/openssl/ossl_hmac.c (Init_ossl_hmac): Ditto.

	* ext/openssl/ossl_pkey.c (Init_ossl_pkey): Ditto.

	* ext/openssl/ossl_pkey_dh.c (Init_ossl_dh): Ditto.

	* ext/openssl/ossl_pkey_dsa.c (Init_ossl_dsa): Ditto.

	* ext/openssl/ossl_pkey_rsa.c (Init_ossl_rsa): Ditto.

	* ext/openssl/ossl_rand.c (Init_ossl_rand): Ditto.

	* ext/openssl/ossl_ssl.c (Init_ossl_ssl): Ditto.

Sun Mar 11 18:42:01 2007  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-mode.el (ruby-block-end-re): Support for the
	  experimental ';;' terminator had been dropped.

Sun Mar 11 05:45:46 2007  Akinori MUSHA  <knu@iDaemons.org>

	* misc/README, misc/rdebug.el: Add rdebug.el, Emacs ruby-debug
	  interface based on rubydb3x.el; submitted by Martin Nordholts
	  <enselic AT gmail.com> in [ruby-bugs:PR#9023].

Sat Mar 10 07:20:28 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_TYPELIB#library_name,
	  WIN32OLE_TYPELIB#visible?.

	* test/win32ole/test_win32ole_typelib.rb: ditto.

Thu Mar  8 09:17:59 2007  Minero Aoki  <aamine@loveruby.net>

	* compile.c: iseq_compile -> rb_iseq_compile.

	* iseq.c: ditto.

	* intern.h: provide function prototype of Init_jump.

	* eval_jump.h (Init_jump): declare function type.

	* thread.c: platform-dependent functions should be surrounded by #ifdef.

	* iseq.c (iseq_data_to_ary): remove unused variable.

	* compile.c (set_arguments): ditto.

	* thread.c (set_unblock_function): ditto.

	* thread_pthread.ci: reduce printf warning.

	* vm_dump.c: ditto.

Tue Mar  6 16:35:04 2007  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/shell/process-controller.rb: fix thread synchronization problem for [ruby-dev:30477].

Tue Mar  6 11:53:25 2007  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/irbtkw.rbw: fails to exit process.

Tue Mar  6 10:23:09 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* runruby.rb: added --pure (turned on by default) and --debugger
	  options.

Mon Mar  5 09:19:33 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/timeout.rb (Timeout.timeout): should return the block value
	  always.

	* lib/timeout.rb (Timeout.timeout): should yield sec argument
	  always.

	* lib/timeout.rb (Timeout.timeout): fix document.

Mon Mar  5 09:16:40 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb: support automatic STARTTLS.

	* lib/net/smtp.rb: check server advertisement.

	* lib/net/smtp.rb: introduce new class SMTP::Response.

	* lib/net/smtp.rb (getok): should not use sprintf.

	* lib/net/smtp.rb (get_response): ditto.

	* lib/net/protocol.rb: reduce syntax warning on 1.9.

Mon Mar  5 07:13:28 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb: reconstruct SMTPS/STARTTLS interface.  New
	  interface is incompatible from current 1.9 interface at all.

	* lib/net/smtp.rb: All SSL-related class methods are removed; use
	  instance methods instead.

	* lib/net/smtp.rb: rename methods: *ssl -> *tls (with alias
	  "ssl").

	* lib/net/smtp.rb: rename methods: *tls -> *starttls.

Mon Mar  5 01:36:41 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex), win32/win32.c (rb_w32_utime): fixed
	  indentation broken at YARV merger.

Sun Mar  4 23:41:14 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_stat_uid, rb_stat_gid, eaccess): use rb_uid_t and
	  rb_gid_t instead of int.

	* file.c (rb_stat_s_utime): fixed a commit miss for the platforms
	  where utimes() does not exist.

	* lib/fileutils.rb (touch): ditto.

Sun Mar  4 14:46:56 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* util.c (push_element): should return a int value.

Sun Mar  4 01:01:25 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#^, Set#&): Correct documentation.  Those methods
	  return sets, not arrays; noted by Oliver Frank Wittich <nietz AT
	  mangabrain.de>.

Sat Mar  3 22:54:33 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (touch): last #touch change causes error when
	  :mtime option was not given.

Sat Mar  3 22:51:29 2007  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mv): could not move directory between
	  different file systems. [ruby-dev:30411]

Sat Mar  3 22:37:02 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_utime): allow nil to set the current time.

	* lib/fileutils.rb (touch): ditto, and added :mtime and :nocreate
	  options.  fixed: [ruby-talk:219037]

Sat Mar  3 15:52:26 2007  Akinori MUSHA  <knu@iDaemons.org>

	* object.c (instance_variable_get): Restore rdoc markups lost in
	  the last commit.

Fri Mar  2 21:17:14 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (get_ptr_of_variant, ole_set_safe_array,
	  ole_val2ptr_variant, ole_val2olevariantdata, ole_variant2val,
	  ): fix some bugs of WIN32OLE_VARIANT.new when variant type is
	  VT_ARRAY|VT_BSTR or VT_BYREF.

	* ext/win32ole/win32ole.c (folevariant_s_array, folevariant_initialize):
	  WIN32OLE_VARIANT#[], WIN32OLE_VARIANT#[]=, WIN32OLE_VARIANT#value=
	  is defined as instance method of WIN32OLE_VARIANT.

	* test/win32ole/test_win32ole_variant.rb: add some test for
	  VT_ARRAY, VT_BYREF variant type.

Fri Mar  2 07:58:24 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_ivar_set): RDoc updated according to a
	  suggestion from Brian Candler <B.Candler AT pobox.com>.
	  [ruby-core:10469]

Thu Mar  1 21:38:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt, arg): should not omit lhs of OP_ASGN1 even if
	  empty.  [ruby-dev:30455]

Thu Mar  1 02:55:25 2007  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (get_digest_base_metadata): Allow inheriting
	  Digest::Base subclasses, which was unintentionally made
	  impossible while restructuring Digest classes.

Thu Mar  1 02:05:17 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb (patchlevel): read from version.h.

Wed Feb 28 21:15:00 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (ac_cv_func_fcntl): fcntl support for MinGW.

	* missing/flock.c: workaround for MinGW.

Wed Feb 28 20:51:32 2007  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* pack.c (pack_unpack): properly ignore non-base64 octets such as
	  UTF-8 encoded BOMs; submitted by SOUMA Yutaka <holon@radastery.jp>
	  to fix [ruby-core:10437]

Wed Feb 28 18:31:51 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/extconf.rb: no need to check unistd.h and sys/time.h.
	  they are already checked at configure.
	  reported by KOBAYASHI Yasuhiro [ruby-list:43225]

Wed Feb 28 18:23:43 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb ($DEFLIBPATH): default library paths ($(topdir), etc)
	  should be the first elements of library paths list.
	  reported by KOBAYASHI Yasuhiro [ruby-list:43225]

Wed Feb 28 10:33:58 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, configure.in, */Makefile.sub (THREAD_MODEL): system
	  specific thread model.

	* compile.h, regint.h, vm.h, array.c: removed unnecessary #include.

Wed Feb 28 04:03:03 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (take_i): small cosmetic / documentation patch from
	  Tadashi Saito <shiba AT mail2.accsnet.ne.jp>. [ruby-dev:30446]

Wed Feb 28 01:20:18 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/{dbm,gdbm}/test_{dbm,gdbm}.rb: shouldn't use host_os. use
	  target_os instead. reported by KOBAYASHI Yasuhiro [ruby-list:43225]

Wed Feb 28 00:08:11 2007  URABE Shyouhei  <shyouhei@ice.uec.ac.jp>

	* mkconfig.rb (RbConfig): add CONFIG['PATCHLEVEL']

	* common.mk: new target dist

	* distruby.rb: new file

Tue Feb 27 22:18:45 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (--enable-auto-image-base): avoid the necessity to
	  rebase the shared libs as much as possible;
	  submitted by Corinna Vinschen <spam at vinschen.de> in
	  [ruby-talk:240964].

Tue Feb 27 21:36:47 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* util.c (__crt0_glob_function): use ruby_glob() instead of rb_globi().

Tue Feb 27 21:33:04 2007  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (ac_cv_func_setrlimit): workaround for djgpp.

Tue Feb 27 20:35:28 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (error.c, process.c): depend on yarvcore.h and rubysig.h.

Tue Feb 27 19:26:31 2007  Akinori MUSHA  <knu@iDaemons.org>

	* ext/nkf/nkf.c (rb_str_resize, rb_nkf_kconv, rb_nkf_guess1,
	  rb_nkf_guess2): Silence warnings regarding char * vs. unsigned
	  char * mismatch; submitted by Lyle Johnson
	  <lyle.johnson@gmail.com> in [ruby-core:10416].

Tue Feb 27 19:15:01 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/base64.rb (Base64::b64encode): Fix documentation; submitted
	  by David Symonds <dsymonds@gmail.com> in [ruby-core:10432].

Tue Feb 27 18:59:42 2007  Akinori MUSHA  <knu@iDaemons.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_load): Silence warnings
	  regarding char * vs. unsigned char * mismatch; submitted by Lyle
	  Johnson <lyle.johnson@gmail.com> in [ruby-core:10416].

	* ext/digest/sha1/sha1ossl.c (SHA1_Finish): Ditto.

	* ext/digest/rmd160/rmd160ossl.c (RMD160_Finish): Ditto.

	* ext/digest/digest.c (rb_digest_base_finish,
	  rb_digest_base_update): Ditto.

Tue Feb 27 18:12:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_take): new method.  [ruby-dev:30407]

	* enum.c (enum_drop): ditto.

Tue Feb 27 07:47:24 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h, vm.h: rename th_invoke_yield() to th_yield().

	* blockinlining.c: ditto.

	* eval.c: ditto.

	* vm.c, insns.def: rename th_invoke_yield_cfunc()
	  to th_yield_with_cfunc().

	* yarvcore.h, yarvcore.c: rename theYarvVM to ruby_current_vm and
	  yarvCurrentThread to ruby_current_thread.  remove yarvVMArray.

Tue Feb 27 00:45:23 2007  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_optimization.rb: restore method before calling
	  assert_equal.

Mon Feb 26 00:58:39 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h: add rb_thread_t#top_wrapper, top_self.

	* eval_load.c (rb_load): support eval in wrapper module
	  (load(file, true)).

	* eval.c: ditto.

	* eval_jump.h: ditto.

	* iseq.c: ditto.

	* vm.c: ditto.

	* yarvcore.c: ditto.

	* insns.def: add a empty line.

Mon Feb 26 00:54:36 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: change "gdb" rule.  You can debug miniruby with
	  $(srcdir)/test.rb on gdb by this rule (type "make gdb").
	  If you write break points to "breakpoints.gdb" on $srcdir,
	  gdb runs with this file.

Sun Feb 25 11:46:58 2007  Koichi Sasada  <ko1@atdot.net>

	* win32/Makefile.sub: enable -Zi (debug) option.

Sun Feb 25 11:38:40 2007  Koichi Sasada  <ko1@atdot.net>

	* ruby.h: define RUBY_VM macro and remove NATIVETHREAD* macros.

	* intern.h: ditto.

	* signal.c (posix_signal): remove unused function
	  posix_nativethread_signal().

Sun Feb 25 11:31:13 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_run): fix to ANSI style.

Sun Feb 25 11:09:16 2007  Minero Aoki  <aamine@loveruby.net>

	* bootstraptest/runner.rb: show source code in error message.

Sun Feb 25 09:39:50 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h:
	  rename:
	    rb_iseq_t#file_name -> filename
	    rb_iseq_t#local_tbl -> local_table
	  add:
	    rb_iseq_t#local_table_size

	* compile.c: separate local_table_size and local_size
	  (local variable size)

	* blockinlining.c: apply above rename.

	* compile.h: ditto.

	* eval.c: ditto.

	* iseq.c: ditto.

	* proc.c: ditto.

	* vm.c: ditto.

	* vm_dump.c: ditto.

Sun Feb 25 10:27:17 2007  Minero Aoki  <aamine@loveruby.net>

	* bootstraptest/runner.rb: add lib/ to load path.

Sat Feb 25 10:16:50 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* rubyio.h (HAVE_RB_IO_T): macro to tell if rb_io_t is defined.

Sat Feb 24 19:39:16 2007  Minero Aoki  <aamine@loveruby.net>

	* common.mk: new target "btest", to run bootstraptests.

Sat Feb 24 19:30:40 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c, gc.c, io.c, ruby.h, rubyio.h, win32/win32.h (rb_io_t):
	  renamed from OpenFile.

	* ext/dl/cptr.c, ext/io/wait/wait.c, ext/openssl/ossl.h,
	  ext/openssl/ossl_bio.c, ext/openssl/ossl_ssl.c, ext/pty/pty.c,
	  ext/readline/readline.c, ext/socket/socket.c: ditto.

Sat Feb 24 19:28:23 2007  Minero Aoki  <aamine@loveruby.net>

	* bootstraptest/runner.rb: new option -v,--verbose.

Sat Feb 24 18:55:50 2007  Minero Aoki  <aamine@loveruby.net>

	* yarvtest/test_method.rb: removed (merged to bootstraptest).

	* yarvtest/test_class.rb: ditto.

Sat Feb 24 18:44:39 2007  Minero Aoki  <aamine@loveruby.net>

	* bootstraptest/test_class.rb: new file.

	* bootstraptest/test_method.rb: add tests.

Sat Feb 24 18:44:30 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h (rb_thread_blocking_region): add prototype.

	* file.c (rb_thread_flock, rb_file_flock): use UBF feature.

	* process.c (rb_waitpid_blocking, rb_waitpid): use UBF feature.

	* thread.c (rb_thread_debug): added runtime debugging flag.

	* thread.c (BLOCKING_REGION): restore previous UBF.

	* thread.c (rb_thread_blocking_region): default UBF to interrupt
	  in system dependent way by RB_UBF_DFL.
	  + ubf_select() on posix system
	  + ubf_handle() on Win32
	  + none on cygwin

	* thread_win32.ci (rb_w32_wait_events_blocking): blocking version.

	* win32/win32.c (waitpid): use rb_w32_wait_events_blocking().

Sat Feb 24 17:45:48 2007  Minero Aoki  <aamine@loveruby.net>

	* parse.y (f_arg, opt_f_block_arg): ripper should export VALUE.

Sat Feb 24 16:52:55 2007  Minero Aoki  <aamine@loveruby.net>

	* bootstraptest/runner.rb: fix syntax error.

Sat Feb 24 16:51:09 2007  Minero Aoki  <aamine@loveruby.net>

	* bootstraptest/runner.rb: new option --help.

Sat Feb 24 16:47:33 2007  Minero Aoki  <aamine@loveruby.net>

	* bootstraptest: new test suite.

	* bootstraptest/runner.rb: new file.

	* bootstraptest/test_literal.rb: new file.

	* bootstraptest/test_method.rb: new file.

Sat Feb 24 16:29:15 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (StartSocket): remove unnecessary code.

Sat Feb 24 16:04:30 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (struct local_vars): remove unused nofree member from
	  struct.

	* parse.y (parser_free): ditto.

Sat Feb 24 15:57:19 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/thread.rb (ConditionVariable#broadcast): use Mutex
	  instead of Thread.exclusive.

	* lib/monitor.rb (MonitorMixin#mon_exit): unset @mon_owner
	  before calling Mutex#unlock.

Sat Feb 24 15:51:45 2007  Minero Aoki  <aamine@loveruby.net>

	* parse.y (program): remove useless assignment to reduce warning.

Sat Feb 24 15:41:51 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (lambda): remove unused clause from the rule to stop
	  warning.

Sat Feb 24 15:41:22 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/thread.rb: do not redefine Mutex#synchronize.

Sat Feb 24 15:14:02 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb: rewritten using Mutex/ConditionVariable.

Sat Feb 24 13:25:32 2007  Koichi Sasada  <ko1@atdot.net>

	* lib/soap/mapping/factory.rb: catch up with spec changes (return
	  Symbols instead of Strings).

	* lib/soap/mapping/mapping.rb: ditto.

Sat Feb 24 10:49:55 2007  Koichi Sasada  <ko1@atdot.net>

	* parse.y, node.h, compile.c: change node tree structure.  a purpose
	  of this change is to unify argument structure of method and block.
	  this change prohibits duplicate block parameter name.
	  new argument information:
	    NODE_ARGS	  [m: int, o: NODE_OPT_ARG, ->]
	    NODE_ARGS_AUX [r: ID, b: ID, ->]
	    NODE_ARGS_AUX [Pst: id, Plen: int, init: NODE*]
	  optarg information:
	    NODE_OPT_ARGS [idx, expr, ->]

	* vm_macro.def: ditto.

	* gc.c: ditto.

	* iseq.c: ditto.

	* compile.h: fix debug function name.

	* test/ripper/test_scanner_events.rb: |_,_,foo| -> |_1,_2,foo|

	* test/ruby/test_lambda.rb: disable test temporarily.

Sat Feb 24 10:46:28 2007  Koichi Sasada  <ko1@atdot.net>

	* test/testunit/test_testcase.rb: catch up with current instance
	  variable spec.

Sat Feb 24 10:32:59 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: change vm_macro.def rule.

Sat Feb 24 10:38:05 2007  Minero Aoki  <aamine@loveruby.net>

	* ext/racc/cparse/cparse.c (cparse_params_mark): remove useless
	  rb_gc_mark.  Thanks Tomoyuki Chikanaga. [ruby-dev:30405]

Sat Feb 24 07:31:35 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_VARIANT.array,
	  WIN32OLE_VARIANT#value=, refactoring.

	* test/win32ole/test_win32ole_variant.rb: add some test for
	  WIN32OLE_VARIANT.array, WIN32OLE_VARIANT#value=.

Fri Feb 23 18:37:55 2007  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_yield.rb: new test.

	* yarvtest/test_yield.rb: removed (moved to test_yield.rb).

Fri Feb 23 18:27:17 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (rb_thread_polling): check interrupts here.

	* thread_win32.ci (w32_wait_events): rename from w32_wait_event(), and
	  now receive multiple event handles.

	* win32/win32.c (wait_events, rb_w32_main_context): removed.

	* thread_win32.ci (rb_w32_wait_events): new function.

	* thread_win32.ci, win32/win32.c (rb_w32_sleep, rb_w32_Sleep): move
	  from win32/win32.c to thread_win32.ci, and use w32_wait_events().

Fri Feb 23 18:13:22 2007  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_optimization.rb: new test (merges test_opts.rb).

	* yarvtest/test_opts.rb: removed.

Fri Feb 23 16:59:39 2007  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_assignment.rb: merge yarvtest/test_massign.

	* yarvtest/test_massign.rb: removed (merged to
	  test_assignment.rb).

Fri Feb 23 15:58:20 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* signal.c (sighandler): need to re-install sighandler on some
	  platforms.

Fri Feb 23 15:05:57 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (set_pioinfo_extra): simplified.

Fri Feb 23 14:23:20 2007  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_literal.rb: new test.

Fri Feb 23 12:40:12 2007  James Edward Gray II  <james@grayproductions.net>

	* lib/xmlrpc/client.rb (XMLRPC::Client::do_rpc): Make the
	  Content-Length parameter optional for responses in
	  xmlrpc/client.rb; suggested by Daniel Berger
	  <Daniel.Berger@qwest.com> and approved by the maintainer.

	* lib/xmlrpc/create.rb (XMLRPC::Create::conv2value): Add DateTime
	  support to xmlrpc; approved by the maintainer.

Fri Feb 23 12:24:46 2007  Minero Aoki  <aamine@loveruby.net>

	* parse.y (lambda): add ripper event.  This fixes bus error on
	  "make test-all".

	* ext/ripper/extconf.rb: do not stop build.

Fri Feb 23 12:16:05 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: remove dyna_check_gen() prototype.

Fri Feb 23 11:41:21 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y, compile.c, gc.c, insns.def, intern.h, iseq.c, node.h,
	  object.c, string.c, variable.c, vm_macro.def: revert private
	  instance variable feature, which is postponed until next major
	  release.

	* marshal.c: TYPE_SYMBOL2 removed; MARSHAL_MINOR reverted back to
	  8th version.

Fri Feb 23 10:53:21 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* thread_pthread.ci (native_mutex_lock): do not call
	  pthread_mutex_trylock().

Fri Feb 23 10:31:16 2007  Minero Aoki  <aamine@loveruby.net>

	* dln.c: use dlopen on Mac OS X 10.3 or later.

Fri Feb 23 10:03:49 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_ord): need not to check string length;  ord
	  returns a codepoint for the first character in the string.

Wed Feb 21 22:29:45 2007  Akinori MUSHA  <knu@iDaemons.org>

	* numeric.c (fix_equal): A bit more optimization.

Wed Feb 21 17:40:37 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_equal): remove FIX2LONG() to optimize.  suggested
	  in http://t-a-w.blogspot.com/2007/02/making-ruby-faster.html.
	  [ruby-talk:240223]

	* numeric.c (fix_cmp): ditto.

Wed Feb 21 09:14:04 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_load.c (rb_require_safe): should restore safe level.

Tue Feb 20 21:19:29 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (installed_code_page_proc,
	  ole_variant2val): small refactoring.

Tue Feb 20 15:11:42 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c, vm.c, yarvcore.h: move definition of rb_call_super() to
	  vm.c from eval.c.  change th_call_super() to static function.

Tue Feb 20 15:08:25 2007  Koichi Sasada  <ko1@atdot.net>

	* test/io/nonblock/test_flush.rb: YARV doesn't raise any errors if
	  another thread close IO object which current thread is blocking with.

Tue Feb 20 15:03:29 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (do_select, rb_thread_wait_fd_rw): raise sys error if
	  errno is not 0 and EBADF.

Mon Feb 19 22:15:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_REPLACE_TYPE): cache convertible type info.

	* intern.h (rb_detach_process): use rb_pid_t instead of pid_t.

	* ruby.h (PIDT2NUM, NUM2PIDT, UIDT2NUM, NUM2UIDT, GIDT2NUM, NUM2GIDT):
	  defaulted to conversion using long.

Mon Feb 19 17:14:28 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (unix_peeraddr): wrong syscall name in error
	  message for #peeraddr. a patch from Sam Roberts
	  <sroberts at uniserve.com>.  [ruby-core:10366]

Sun Feb 18 22:56:07 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_getgrgid): missed to replace a macro.

Sun Feb 18 19:33:00 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: updated based on date2 4.0.3.

Sun Feb 18 13:11:51 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (pid_t, uid_t, gid_t): check if defined.

	* intern.h, process.c, rubyio.h, ext/etc/etc.c, ext/pty/pty.c: use
	  rb_{pid,uid,gid}_t instead of plain int.  [ruby-dev:30376]

	* ext/etc/extconf.rb (PIDT2NUM, NUM2PIDT, UIDT2NUM, NUM2UIDT, GIDT2NUM,
	  NUM2GIDT): moved to configure.in.

Fri Feb 16 21:34:33 2007  Koichi Sasada  <ko1@atdot.net>

	* object.c (rb_obj_ivar_set/get/defined): fix to check :@_v/C id.

	* test/testunit/test_testcase.rb: fix to use instance_variable_get()
	  to access @_result.

Fri Feb 16 20:59:10 2007  Koichi Sasada  <ko1@atdot.net>

	* intern.h: add a prototype of rb_sym_to_s().

Fri Feb 16 19:24:22 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* math.c (math_log): update document to mention second optional
	  argument for logarithm base.

Fri Feb 16 19:19:21 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (mrhs): need to append by arg_append().
	  [ruby-talk:239385]

Fri Feb 16 11:18:21 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/.document: Apply patch for irb, e2mmap and README by Hugh Sasse
	  <hgs at dmu.ac.uk> from [ruby-core:10135]

	* lib/prettyprint.rb: Suppress RDoc for PrettyPrint test suite.

Thu Feb 15 20:48:36 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (set_pioinfo_extra): new function for VC++8 SP1
	  workaround. [ruby-core:10259]

	* win32/win32.c (NtInitialize): call above function.

Thu Feb 15 16:25:54 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/uri/generic.rb (URI::Generic::userinfo): Considering how
	  `scheme://user:@...', `scheme://:password@...' and
	  `scheme://:@...' are parsed, an empty user name or password
	  should be allowed and represented as it is.

Thu Feb 15 01:52:53 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.(c|h), yarvcore.(c|h) (yarvGlobalStateVersion): rename to
	  ruby_vm_global_state_version.

Thu Feb 15 01:50:26 2007  Koichi Sasada  <ko1@atdot.net>

	* test/fileutils/test_fileutils.rb (check_singleton): fix to use
	  symbol instead of string.

	* test/io/nonblock/test_flush.rb: enable tests.

	* test/xmlrpc/test_webrick_server.rb: ditto.

Thu Feb 15 01:43:45 2007  Koichi Sasada  <ko1@atdot.net>

	* lib/delegate.rb: catch up with class local variable (@_v) spec.

	* lib/singleton.rb: ditto.

Wed Feb 14 22:52:43 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_variant2val): VC++6 does not
	  support VT_I8, VT_UI8.

Wed Feb 14 22:10:21 2007  Koichi Sasada  <ko1@atdot.net>

	* configure.in: change stack limit to 2MB from 32MB.

	* win32/Makefile.sub: ditto.

Wed Feb 14 21:39:36 2007  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest.rb (Digest::self.const_missing): Drop
	  autoloads for sha2 classes in favor of handling in
	  const_missing(), to work around a problem exposed on OS X.

Wed Feb 14 21:19:47 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.ci (native_thread_create): adjust 4KB (page size)
	  alignment.

Wed Feb 14 21:12:36 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.ci (CHECK_ERR): call rb_bug()
	  instead of printf() and exit().

Wed Feb 14 16:48:56 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/date/format.rb (Date::Format::Bag::method_missing): need not
	  to use instance variables corresponding each method; use Hash
	  instead.

Wed Feb 14 13:12:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (reg_operand): allow symbols to be operands for regular
	  expression matches.

	* string.c (Init_String): allow Symbol#===.

	* lib/date/format.rb (Date::Format::Bag::to_hash): string
	  added prefixes.

Wed Feb 14 12:58:38 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (do_select): fix to iterate select().
	  on cygwin/mswin32, iterate in unblocking region.

	* thread.c (rb_thread_select): don't iterate on this function.
	  (iterate in do_select).

Wed Feb 14 11:39:18 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (set_unblock_function): fix function interface.

Wed Feb 14 11:12:02 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_load.c, yarvcore.h: use rb_vm_t#loaded_features instead of
	  rb_features (global variable).

	* yarvcore.c: mark rb_vm_t#loaded_features.

Wed Feb 14 08:46:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compile.c (defined_expr): no longer distinguish ordinary local
	  variables and in-block local variables in defined? value.

Wed Feb 14 03:14:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic::userinfo): should support
	  empty password.  [ruby-core:10290]

	* lib/uri/generic.rb (URI::Generic::set_password): password can be
	  cleared by nil.  [ruby-core:10290]

Wed Feb 14 03:10:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (struct local_vars): no need to warn out-of-scope
	  variables; remove dnames member from struct.

Wed Feb 14 03:04:10 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: RVarmap no longer used as yytype; removed.

	* parse.y (dyna_push_gen): no longer need return value.

	* parse.y (dyna_pop_gen): no longer need argument.

	* parse.y (local_push_gen): initialize nofree.

Wed Feb 14 00:30:07 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (init_unixsock): path may contain NUL for
	  abstract unix sockets.  [ruby-core:10288]

Tue Feb 13 02:21:12 2007  Sam Roberts  <sroberts@uniserve.com>

	* io.c (rb_f_syscall): Fix buffer overflow with syscall
	  arguments.  [ruby-bugs:PR#8541]

Mon Feb 12 13:57:30 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_variant2val): support VT_I8, VT_UI8.

Mon Feb 12 11:48:52 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/dublincore.rb, lib/rss/maker/dublincore.rb: dc_rightses
	  -> dc_rights_list. dc_rightses still exists for backward
	  compatibility. [ruby-core:8350]

	* test/rss/test_maker_dc.rb: added tests for dc_rights_list.

Sun Feb 11 22:40:17 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_ptrtype2val): ole_type, ole_type_detail
	  should not return "VARIANT,VARIANT".

Sun Feb 11 22:11:05 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/xml-stylesheet.rb (RSS::XMLStyleSheet#initialize):
	  kept backward compatibility.

Sun Feb 11 22:10:08 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb (RSS::ListenerMixin#start_else_element): used
	  const_defined? instead of constants.include?.

Sun Feb 11 18:47:14 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_val2olevariantdata):
	  WIN32OLE_VARIANT#new accepts nil when variant type is VT_ARRAY.

	* test/win32ole/test_win32ole_variant.rb: ditto.

	* ext/win32ole/win32ole.c: small refactoring.

Sun Feb 11 07:42:25 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/cgi.rb (CGI::QueryExtension::read_multipart): Properly parse
	  a quoted-string in a Content-Disposition value.

Sat Feb 10 20:21:29 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE#ole_query_interface.
	  thanks to Mikael Pahmp.

	* test/win32ole/test_win32ole.rb: ditto.

Sat Feb 10 17:46:52 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk: targets which depend on yarvcore.h now depend on
	  rubysig.h too.

	* yarvcore.h (rb_vm_t): use rb_atomic_t instead of int.

Sat Feb 10 00:13:11 2007  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fix typo (TkConfigMethod::__confinfo_cmd,
	  __conv_keyonly_opts).

Fri Feb  9 12:33:40 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_win32.ci (w32_show_error_message): renamed to w32_error.
	  this function do rb_bug().

	* thread_win32.ci (w32_set_event, w32_reset_event, w32_close_handle,
	  w32_resume_thread): added. fix to use these functions instead calling
	  win32api directly.

	* thread_win32.ci (w32_create_thread): create suspend thread
	  (caller must call w32_resume_thread()).

Fri Feb  9 11:03:40 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_readpartial.rb: tests are working on mswin32/cygwin.

Fri Feb  9 05:08:17 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c, thread_pthread.ci, thread_win32.ci (thread_start_func_1):
	  move cleanup function to thread_start_func_2().

	* thread.c, thread_pthread.ci, thread_win32.ci:
	  add more destruct functions.
	  (native_thread_destroy() and native_mutex_destroy())

	* thread_pthread.ci, thread_pthread.h: make native_mutex_* functions
	  (check error, etc), it's not macro any more.

	* thread_win32.ci (thread_start_func_1): store some values before
	  running thread (to release these after running thread).

	* thread_win32.ci (native_thread_create): fix spaces.

Thu Feb  8 22:44:04 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_set_safe_array, ole_variant2val,
	  ole_val_ary2variant_ary): fix WIN32OLE_VARIANT.new bug when
	  1st argument is empty array, and when 2nd argument is
	  VT_ARRAY|VT_BYREF.

	* test/win32ole/test_win32ole_variant.rb: ditto.

Thu Feb  8 22:39:09 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvtest/yarvtest.rb: check target command names.

Thu Feb  8 22:31:45 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_clone.rb: fix to current spec
	  (Module should not be occur many times in ancestors).

Thu Feb  8 22:26:14 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_string.rb: ("foo" == :foo) and ("foo" === :foo)
	  should be false.

	* ChangeLog: fix last messages.

Thu Feb  8 22:24:06 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_module.rb: fix to use Symbol instead of String.

	* test/ruby/test_module.rb: remove space before argument parentheses.

Thu Feb  8 22:02:14 2007  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/marshaltestlib.rb: eval(sym) -> eval(sym.to_s)

Thu Feb  8 21:35:16 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_propertyputref.rb (setup): fix typo.

	* test/win32ole/test_win32ole_event.rb: should not use
	  InternetExplorer.gohome to test.

Thu Feb  8 21:02:07 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (GVL_UNLOCK_RANGE): rename to BLOCKING_REGION().

	* thread.c (rb_thread_run_parallel): rename to
	  rb_thread_blocking_region().

Thu Feb  8 15:48:44 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvcore.h, thread.c: fix to use pthread on cygwin.

	* yarvcore.h, thread.c: move GVL_UNLOCK_BEGIN() and GVL_UNLOCK_END()
	  from yarvcore.h to thread.c.

	* thread.c: change GVL_UNLOCK_RANGE() arguments
	  (adding ubf as 2nd argument).

	* thread.c: fix to use polling in select on cygwin and mswin32.

	* thread.c, thread_pthread.ci, thread_win32.ci, yarvcore.h:
	  rename:
	  * rb_thread_t#interrupt_function -> unblock_function
	  * rb_interrupt_function_t -> rb_unblock_function
	  * some interrupt function name -> ubf_*
	  * yarv_* -> *

Thu Feb  8 16:08:02 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: fix to use RUNRUBY instead of BASERUBY if possible.

	* common.mk ($(INSNS) rule): remove $(PROGRAM) first.

Thu Feb  8 15:43:05 2007  Koichi Sasada  <ko1@atdot.net>

	* process.c: fix to use rb_status_line_set/get/clear().

	* eval_intern.h: fix line break.

Thu Feb  8 15:00:14 2007  Koichi Sasada  <ko1@atdot.net>

	* blockinlining.c, error.c, eval.c, eval_error.h, eval_intern.h,
	  eval_jump.h, eval_load.c, eval_safe.h, gc.c, proc.c, signal.c,
	  thread.c, thread_pthread.ci, thread_win32.ci, vm.c, vm.h,
	  vm_dump.c, vm_evalbody.ci, yarvcore.c, yarvcore.h:
	  fix typo (rb_thead_t -> rb_thread_t).

	* eval_intern.h: remove unused definitions.

	* common.mk: fix around vm_opts.h path
	  and remove harmful argument passed to insns2vm.rb.

Thu Feb  8 03:11:47 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::unescapeHTML): invalid decoding for single
	  unescaped ampersand.  a patch from Tietew
	  <tietew+ruby-dev at tietew.net> in [ruby-dev:30292].
	  fixed: [ruby-dev:30289]

Wed Feb  7 23:25:31 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (specific_eval): suppress warning.

	* thread_win32.h: undefine _WIN32 on cygwin.  [ruby-dev:30303]

Wed Feb  7 22:41:34 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_intern.h: remove UNSUPPORTED() macro.

	* thread.c: fix to define Continuation methods
	  (they only do rb_notimplement()).

Wed Feb  7 22:33:58 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_intern.h, yarvcore.h: remove unused macro definition.

Wed Feb  7 22:30:28 2007  Koichi Sasada  <ko1@atdot.net>

	* eval.c: fixed to use ANSI function style.

Wed Feb  7 09:35:32 2007  Koichi Sasada  <ko1@atdot.net>

	* this commit is a result of refactoring. only renaming functions,
	  moving definitions place, add/remove prototypes, deleting
	  unused variables and removing yarv.h.
	  This commit doesn't change any behavior of ruby/vm.

	* yarv.h, common.mk: remove yarv.h (contents are moved to yarvcore.h).

	* error.c, eval_intern.h: include yarvcore.h instead yarv.h

	* rename some functions:
	  * debug.[ch]: debug_*() -> ruby_debug_*()
	  * iseq.c: iseq_*() -> rb_iseq_*(), ruby_iseq_disasm()
	  * iseq.c: node_name() -> ruby_node_name()
	  * vm.c: yarv_check_redefinition_opt_method() ->
	          rb_vm_check_redefinition_opt_method()

	* some refactoring with checking -Wall.

	* array.c: remove rb_ary_ptr() (unused) and remove unused
	  local variables.

	* object.c: add a prototype of rb_mod_module_exec().

	* eval_intern.h (ruby_cref): set it inline.

	* eval_load.c (rb_load), yarvcore.c: yarv_load() -> rb_load_internal().

	* parse.y: add a prototype of rb_parse_in_eval() (in eval.c).

	* process.c: add a prototype of rb_thread_stop_timer_thread() (in thread.c).

	* thread.c: remove raw_gets() function (unused) and fix some format
	  mismatch (format mismatches have remained yet. this is todo).

	* thread.c (rb_thread_wait_fd_rw): fix typo on label name.

	* thread_pthread.ci: comment out codes with USE_THREAD_CACHE.

	* vm.c (rb_svar, rb_backref_get, rb_backref_get,
	  rb_lastline_get, rb_lastline_set) : moved from yarvcore.c.

	* vm.c (yarv_init_redefined_flag): add a prototype and rename
	  yarv_opt_method_table to vm_opt_method_table.

	* vm.c (rb_thread_eval): moved from yarvcore.c.

	* yarvcore.c: remove unused global variables and fix to use nsdr().

Wed Feb  7 03:39:32 2007  Koichi Sasada  <ko1@atdot.net>

	* blockinlining.c, compile.c, compile.h, error.c, eval.c,
	  eval_intern.h, eval_jump.h, eval_load.c, eval_method.h,
	  eval_safe.h, gc.c, insnhelper.h, insns.def, iseq.c, proc.c,
	  process.c, signal.c, thread.c, thread_pthread.ci, thread_win32.ci,
	  vm.c, vm.h, vm_dump.c, vm_evalbody.ci, vm_macro.def,
	  yarv.h, yarvcore.h, yarvcore.c: change type and macro names:
	  * yarv_*_t -> rb_*_t
	  * yarv_*_struct -> rb_*_struct
	  * yarv_tag -> rb_vm_tag
	  * YARV_* -> RUBY_VM_*

	* proc.c, vm.c: move functions about env object creation
	  from proc.c to vm.c.

	* proc.c, yarvcore.c: fix rb_cVM initialization place.

	* inits.c: change Init_ISeq() order (after Init_VM).

	* ruby.h, proc.c: change declaration place of rb_cEnv
	  from proc.c to ruby.c.

Tue Feb  6 22:06:45 2007  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/{nkf.c,utf8tbl.c}:
	  imported nkf 2007-01-28.
	  * Fixed: can't decode MIME encode JIS string.
	  * Fixed: Fullwidth-halfwidth conversion.
	  * Support DoCoMo's and Softbank's EMOJI
	  * Support CP932, CP5022x, eucJP-ms UDC
	  * Support UTF-32 encoding
	  * Support beyond BMP
	  [ruby-dev:29700] [ruby-dev:29922] [ruby-dev:30144]

Tue Feb  6 20:36:19 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb, lib/rss/parser.rb: followed current Ruby
	  specification. [ruby-dev:30274]

Tue Feb  6 20:29:44 2007  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb, lib/rss/parser.rb: removed needless code for
	  backward compatibility.

Tue Feb  6 18:43:17 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb: moved fixes for EPIPE to the correct
	  place. [ruby-core:10204]

Tue Feb  6 16:38:08 2007  Koichi Sasada  <ko1@atdot.net>

	* vm_opts.h: set properties:
	  svn:keywords:  Author Date Id Revision
	  svn:eol-style: native

Tue Feb  6 15:55:46 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (ivar_i): need to support class local instance
	  variables.

Tue Feb  6 15:44:11 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): fix setting is_local flag.

	* yarvtest/test_class.rb: add a test for class local instance variable.

Tue Feb  6 14:15:34 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, insns.def: remove (get|set)instancevariable2 and add a
	  operand is_local to (get|set)instancevariable.

	* yarvtest/test_class.rb: add a test for class local instance variable.

	* parse.y (rb_decompose_ivar2): remove unused variable oid.

	* tool/insns2vm.rb: remove needless require.

Tue Feb  6 11:18:41 2007  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb: check the control connection on EPIPE.
	  Thanks, Simon Williams. [ruby-core:9547]

Tue Feb  6 11:03:27 2007  Koichi Sasada  <ko1@atdot.net>

	* complement last commit.

	* common.mk (*.inc): use VPATH.

	* vm_opts.h: renamed from vm_opts.h.base.

Tue Feb  6 10:02:41 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/insns2vm.rb: use vm_opts.h in VPATH.

Tue Feb  6 03:47:58 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c: support Binding#eval.

	* yarvtest/test_eval.rb: add a test for above change.

Tue Feb  6 03:13:33 2007  Koichi Sasada  <ko1@atdot.net>

	* proc.c: refactoring (remove K&R style, move Binding stuffs from
	  Init_Proc() to Init_Binding()).

Tue Feb  6 01:07:14 2007  Koichi Sasada  <ko1@atdot.net>

	* intern.h: prepare rb_last_status_get() and rb_last_status_set().
	  Use these functions instead of rb_last_status ([ruby-dev:30264]).

	* process.c: define above functions.

	* ext/pty/pty.c: use above functions.

	* io.c (pipe_finalize): ditto.

	* process.c: ditto.

Mon Feb  5 21:26:56 2007  Koichi Sasada  <ko1@atdot.net>

	* ruby.h: add a prototype of rb_id2str().

Mon Feb  5 21:06:50 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_thread.c, common.mk: remove eval_thread.c.

	* yarvcore.c: rename cYarvThread to rb_cThread.

	* gc.c: remove YARV_* prefix.

	* gc.h: add an include guard and prototype of rb_gc_set_stack_end().

	* inits.c: fix to ANSI prototype style and reorder Init_*().

	* io.c (pipe_finalize): TODO: comment out last_status.

	* process.c, yarvcore.h: fix to use yarv_vm_t#last_status instead of
	  rb_last_status and make last_status_get() to access $?.

	* yarvcore.c (vm_mark): mark yarv_vm_t#last_status.

	* ruby.h: add declarations of rb_cISeq and rb_cVM.

	* thread.c: move eval_thread.c codes to thread.c and remove yarv_*
	  function prefix.

	* thread.c (thread_start_func_2): use yarv_thread_t#first_func if
	  it is not null.

	* vm.c: fix copyright year.

	* yarvcore.c (Init_vm): rename to Init_VM().

Mon Feb  5 04:09:48 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_frame_callee): check if prev_cfp can be accessible.
	  a patch from Yoshinori Sano <yoshinori.sano at gmail.com> in
	  [ruby-dev:30252].  solves [ruby-dev:30200] and [ruby-core:9856].

Sun Feb  4 20:34:41 2007  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/rss-assertions.rb: removed needless code for backward
	  compatibility.

Sun Feb  4 02:22:59 2007  Akinori MUSHA  <knu@iDaemons.org>

	* lib/cgi.rb (CGI::QueryExtension::read_multipart): Remove a debug
	  print.

Sat Feb  3 23:51:58 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (rb_compose_ivar2): function to create a new ivar2
	  symbol from a symbol and a class.  back-ported from matzruby.

	* parse.y (rb_decompose_ivar2): reverse function of
	  rb_compose_ivar2().

	* marshal.c (w_symbol): support class local instance variables.

	* marshal.c (r_object0): ditto.

	* compile.c (defined_expr): ditto.

	* compile.c (iseq_compile_each): ditto.

	* insns.def: add two new instructions: getinstancevariable2 and
	  setinstancevariable2.

Sat Feb  3 23:21:13 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (setclassvariable): remove unnecessary operand.

	* compile.c (iseq_compile_each): ditto.

	* common.mk (insns_info.inc): add dependency for insns_info.inc.

Sat Feb  3 14:32:58 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_val2olevariantdata, ole_val2variant):
	  fix the bug of WIN32OLE_VARIANT.new when variant type is
	  VT_ARRAY.

	* ext/win32ole/sample/excel1.rb: rewrite using WIN32OLE_VARIANT.

	* test/win32ole/test_win32ole.rb: add some test.

	* test/win32ole/test_win32ole_variant.rb: ditto.

Sat Feb  3 03:35:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, */Makefile.sub, common.mk (vmasm): generalized.

	* common.mk (runruby, benchmark, benchmark-each, tbench): use
	  PROGRAM for the file to be built.

	* proc.c (yarv_proc_alloc): needs return.

	* call_cfunc.ci, compile.c, compile.h, debug.h, eval.c,
	  eval_error.h, eval_jump.h, eval_load.c, eval_thread.c, gc.c,
	  insnhelper.h, insns.def, iseq.c, main.c, numeric.c, parse.y,
	  range.c, ruby.h, signal.c, thread.c, thread_win32.ci, vm.c,
	  vm.h, vm_dump.c, vm_evalbody.ci, yarvcore.c, yarvcore.h:
	  fixed indents and non-C90 comments.

	* regenc.h: revert to before YARV.

	* lib/mkmf.rb (create_makefile): make object files depend on
	  extconf.h even if depend file exists.

Fri Feb  2 23:39:42 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* common.mk (bin): add more dependency.  a patch from Tadashi
	  Saito <shiba at mail2.accsnet.ne.jp>.  [ruby-dev:30245]

Fri Feb  2 18:44:31 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* insns.def (setclassvariable): remove warn argument.

Fri Feb  2 18:36:40 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* common.mk (compile.$(OBJEXT)): add config.h to vm.c and
	  compile.c.

Fri Feb  2 18:27:54 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c: remove duplicated global variables rb_cProc and
	  rb_cBinding.  [ruby-dev:30242]

Fri Feb  2 00:13:44 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (SYMBOL_P): make Symbol immediate again for performance.

	* string.c: redesign symbol methods.

Thu Feb  1 23:25:21 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_id2str): store Strings for operator symbols.
	  [ruby-dev:30235]

Thu Feb  1 21:04:39 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (assignable_gen): no need to generate NODE_CVDECL.

	* compile.c (iseq_compile_each): no NODE_CVDECL.

Thu Feb  1 20:53:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm.c (eval_get_cvar_base): destination for class variable access
	  is now strictly innermost surrounding class or module.  warned
	  if accessed from toplevel.

	* variable.c (rb_cvar_get): new class variable look-up scheme:
	  1) look up in the class.  2) if the class is singleton attached
	  to a class (i.e. metaclass) then start look up in the attached
	  class and its ancestors. 3) otherwise, look-up in ancestors of
	  the class.

	* eval.c (cvar_cbase): destination for class variable access is
	  the class/module that holds the method, or cbase outside of
	  methods.

Thu Feb  1 20:31:41 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_cvar_set): remove warn argument.

Wed Jan 31 14:52:09 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_iterator.rb (TestIterator::test_block_given_within_iterator):
	  add new test.  [ruby-core:10125]

Tue Jan 30 17:01:21 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* string.c (rb_str_sub_bang): calling rb_str_modify() should be just
	  before actually modifying the string.
	  fixed: [ruby-dev:30211] (originally reported by zunda)

Tue Jan 30 13:24:06 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_pred): add Integer#pred corresponding
	  Integer#succ.  [RCR#5]

Tue Jan 30 12:05:35 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: autoconf 2.61 support.  [ruby-core:10016]

Mon Jan 29 23:52:32 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* tool/compile.rb: replace YARVCore by VM class.

Mon Jan 29 17:52:44 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/date/format.rb (Date::Format::Bag::method_missing): add
	  prefix to avoid making t class-local instance variable.

Mon Jan 29 21:32:37 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE.locale=, WIN32OLE.locale,
	  WIN32OLE_VARIANT#vartype.

	* test/win32ole/test_win32ole.rb: add test for WIN32OLE.locale=,
	  WIN32OLE.locale.

	* test/win32ole/test_win32ole_variant.rb: add test for
	  WIN32OLE_VARIANT#vartype.

Mon Jan 29 14:14:35 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* tool/parse.rb: replace YARVCore by VM class.
	  http://d.hatena.ne.jp/ysano2005/20070128

Sun Jan 28 08:41:49 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: refactoring.

Sat Jan 27 18:36:33 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_val2olevariantdata): bug fix.
	  WIN32OLE_VARIANT.new check that 1st argument should T_ARRAY
	  when variant type is VT_ARRAY.

	* test/win32ole/test_win32ole_variant.rb: add some test.

Fri Jan 26 23:55:56 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: bug fix of WIN32OLE_VARIANT when variant
	  type is VT_BYREF|VT_VARIANT.

	* test/win32ole/test_win32ole_variant_with_ie.rb: ditto.

Fri Jan 26 12:03:39 2007  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb (TkConfigMethod#__confinfo_cmd,
	  __conv_keyonly_optkeys): make them private [ruby-dev:30074].

	* ext/tk/lib/tk/txtwin_abst.rb: fix typo [ruby-dev:30073].

	* ext/tk/lib/tk/canvas.rb (TkCanvas#scan_dragto): lack of an argument.

	* ext/tk/lib/tk/canvas.rb: clarify the including module name
	  [ruby-dev:30080].

	* ext/tk/lib/tk/scrollable.rb: change primary name of modules
	  [ruby-dev:30080].

Fri Jan 26 07:48:57 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_init_copy): need to copy internal
	  structure on clone and dup.  [ruby-dev:30192]

Wed Jan 24 20:34:51 2007  Kouhei Sutou  <kou@cozmixng.org>

	* test/ruby/test_iterator.rb: removed a needless workaround.

Wed Jan 24 18:05:39 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-font-lock-syntactic-keywords): fix
	  regexp font-lock bug.  [ruby-talk:235758]

Tue Jan 23 18:26:12 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension::read_multipart): use == instead
	  of ===.  [ruby-dev:30176]

Tue Jan 23 15:39:25 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* Makefile.in, common.mk, configure.in, */{Makefile.sub, configure.bat,
	  setup.mak}: add --with-baseruby configure option.

Mon Jan 22 14:57:25 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c: fix errors in socket sample code.
	  [ruby-core:09992]

Sat Jan 20 21:05:18 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (fole_s_set_code_page): WIN32OLE.codepage=
	  accepts installed codepage.

	* test/win32ole/test_win32ole.rb (test_s_codepage_changed): ditto.

Sat Jan 20 11:18:49 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_invoke, ole_invoke2, ole_propertyput):
	  modify WIN32OLERuntimeError message.

	* test/win32ole/test_win32ole.rb: ditto.

Sat Jan 20 06:45:21 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval_proc.c (method_receiver): add new method to get the bound
	  receiver of the method object.  [ruby-talk:234949]

	* eval_proc.c (method_name): new method to get the name of a
	  method.

	* eval_proc.c (method_owner): a new method to get the class or
	  module that defines the method.

Fri Jan 19 17:12:23 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (Init_win32ole): add WIN32OLE_VARIANT::Empty,
	  WIN32OLE_VARIANT::Null, WIN32OLE_VARIANT::Nothing.

	* test/win32ole/test_win32ole_variant.rb: ditto.

	* test/win32ole/test_nil2vtempty.rb(test_openSchema): ditto.

Fri Jan 19 06:53:38 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (olevariant_free): fix memory leak.

	* ext/win32ole/win32ole.c (ole_val2olevariantdata):
	  WIN32OLE_VARIANT.new accepts nil as first argument for some VARIANT
	  TYPE.

	* test/win32ole/test_win32ole_variant.rb: ditto.

Wed Jan 17 17:31:28 2007  Koichi Sasada  <ko1@atdot.net>

	* some refactoring around yarvcore and proc.

	* eval_proc.c: renamed to proc.c.

	* common.mk: ditto.

	* yarvcore.h, yarvcore.c: rename or remove some global variables
	  removed: mYarvCore, mYarvInsns
	  renamed: cYarvISeq -> rb_cISeq,
	           cYarvProc -> rb_cProc, cYarvBinding -> rb_cBinding
	  ::YarvCore module is removed and ::YarvCore::VM class becomes ::VM.
	  And change/remove some functions which added with YARV.

	* compile.c: ditto.

	* eval.c: ditto.

	* iseq.c: ditto.

	* vm.c: ditto.

	* inits.c: rename Init_yarvcore to Init_vm.

	* yarvcore.c, proc.c: move some functions and initialization
	  from yarvcore.c to proc.c.

	* intern.h, proc.c: add global function rb_binding_new(void).

Tue Jan 16 17:49:29 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (eval_search_super_klass): rename to search_super_klass() and
	  use it by th_call_super().

	* insns.def: ditto.

Tue Jan 16 17:48:11 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: fix ruby script path.

Tue Jan 16 17:39:44 2007  Koichi Sasada  <ko1@atdot.net>

	* vm.c (invoke_block): fix to specify self.

Tue Jan 16 12:12:27 2007  Koichi Sasada  <ko1@atdot.net>

	* env.h: removed

Tue Jan 16 12:00:06 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_proc.c (rb_proc_new): added.

	* string.c (sym_to_proc): supported.

	* vm.c (invoke_block, th_invoke_yield, th_invoke_proc): fix to support
	  rb_proc_new.

	* yarvcore.c: add a test code.

Sat Jan 13 23:24:59 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_free, ole_type_free,
	  olemethod_free, olevariable_free, oleparam_free,
	  ole_event_free): fix memory leak.  [ruby-core:09846]

Wed Jan 10 00:10:23 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_replace): use ptr and len of orig instead of
	  shared.  fixed: [ruby-dev:30116]

Tue Jan  9 17:48:38 2007  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (rb_find_file): should not call fpath_check() with NULL.
	  fixed: [ruby-core:09867]

Tue Jan  9 12:29:20 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_getpwuid, etc_getgrgid): fix to correctly
	  convert uid/gid from VALUE.

	* ext/etc/etc.c (etc_getpwuid): ditto.

Tue Jan  9 03:54:38 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_upto): String#upto from empty string makes
	  infinite loop.  [ruby-core:09864]

	* string.c (rb_str_upto): use RSTRING_LEN().

Sun Jan  7 18:36:05 2007  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_thread_stop_timer_thread(), rb_thread_reset_timer_thread(),
	  rb_thread_start_timer_thread()): added.

	* thread_pthread.ci: add a native_thread_join() and move
	  rb_thread_reset_timer_thread() definition to thread.c.

	* thread_win32.ci: ditto

	* process.c: fix before_exec(), after_exec() to stop timer thread
	  (and restart timer thread if exec failed).  and fix to reset
	  timer thread information when forked child process starts
	  (to fix [ruby-core:09822]).

Sun Jan  7 18:28:17 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: add a "compare" rule and fix MATZRUBY variable

Sun Jan  7 17:47:16 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole.rb: add test for WIN32OLE#[],
	  WIN32OLE#[]=.

	* ext/win32ole/win32ole.c: update comment for rdoc of
	  WIN32OLE#[] and WIN32OLE#[]=.

Sun Jan  7 12:13:26 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser#find_class_comment):
	  Look for class and module comments above rb_define_class and
	  rb_define_module.  Patch by Daniel Berger <djberg96 at gmail.com>

Sun Jan  7 10:32:12 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser#handle_constants):
	  Properly handle escaping of : in comments.
	* test/rdoc/parsers/test_parse_c.rb:
	  Test RDoc::C_Parser#do_classes and Rdoc::C_Parser#find_class_comment.

Sun Jan  7 09:31:18 2007  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: updated based on date2 4.0.1.

Sat Jan  6 18:46:34 2007  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_getline_fast, rb_io_getline): increase lineno
	  when met the delimiter or EOF.  fixed: [ruby-dev:30081]

	* io.c (prepare_getline_args, rb_io_getline_1): split
	  preparation of arguments and reading.  [ruby-dev:30085]

Sat Jan  6 13:48:36 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def (send): fix to optimize send() with Symbol.

	* yarvtest/test_method.rb: add another test.

Sat Jan  6 13:43:55 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: add PHONY dependency to some rules

Sat Jan  6 11:50:33 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_read): fix wrong replacement.  [ruby-dev:30070]

Sat Jan  6 09:10:52 2007  Koichi Sasada  <ko1@atdot.net>

	* insns.def: support direct method dispatch with "send" or "funcall".
	  This means that "obj.send :m" skips "BasicObject#send" invocation
	  (method frame creation, etc) and "obj.m" invokes directly.
	  If you make backtrace, there are no entries of "send" method.

	* compile.c (iseq_specialized_instruction): fix to support above

	* eval.c: ditto (remove "static" from rb_f_send and rb_f_funcall

	* yarvcore.c: ditto (add a external IDs for compiler)

	* yarvcore.h: ditto (add a VM_CALL_SEND_BIT macro)

	* yarvtest/test_method.rb: add tests for above changes

	* eval.c: remove unused "Kernel#send" declaration

Sat Jan  6 08:29:17 2007  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (Init_win32ole): add
	  WIN32OLE::VARIANT::VT_EMPTY, WIN32OLE::VARIANT::VT_NULL

	* test/win32ole/test_win32ole_variant_m.rb (test_variant): ditto.

Sat Jan  6 03:49:22 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/run.rb: change option format

	* common.mk: ditto

Fri Jan  5 22:21:08 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_app_pentomino.rb: use Array#dup instead of
	  Array#clone

	* benchmark/bmx_temp.rb: removed

	* benchmark/run.rb: use run.rb instead of run_rite.rb

	* common.mk: ditto

	* benchmark/run_rite.rb: removed

	* common.mk: use $(srcdir)/test.rb to run a test program
	  with "make run"

	* benchmark/bmx_temp.rb: removed and
	  set svn:ignore (bmx_*.rb) to benchmark/

	* test.rb: set svn:ignore

Fri Jan  5 21:03:08 2007  Koichi Sasada  <ko1@atdot.net>

	* yarvtest/yarvtest.rb: fix to compare results

Fri Jan  5 20:52:56 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c, compile.h: add ADD_CALL_RECEIVER() macro.

	* insns.def (send): use GET_SELF() direct if FCALL.

	* eval.c (rb_f_send): check method dispatch type to permit
	  invoking private method when dispatch type is FCALL/VCALL

	* insns.def (opt_ltlt): remove useless statement.

	* vm.h: remove unused macros.

Fri Jan  5 20:50:31 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/run_rite.rb: fix to use readlines instead of
	  read(...).lines (because 1.8 doesn't have String#lines).

Fri Jan  5 20:28:19 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_win32.ci (rb_thread_reset_timer_thread):
	  added ([ruby-dev:30086]).

Fri Jan  5 20:20:36 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: add .SUFFIXES rule

Fri Jan  5 15:58:15 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_method.h (rb_alias): fix to check search result

Fri Jan  5 13:59:53 2007  Koichi Sasada  <ko1@atdot.net>

	* eval_method.h (rb_add_method): fix to check old_node

Fri Jan  5 12:03:07 2007  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each, set_block_local_tbl):
	  support NODE_LAMBDA (partly).

	* sample/test.rb: restore test of NODE_LAMBDA

	* test/ruby/test_lambda.rb: ditto

Fri Jan  5 12:31:23 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* thread_pthread.ci (native_sleep): fix tv_nsec overflow.

Thu Jan  4 20:01:29 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: rename yarv-test-[all/each] to compare-test[/-each].
	  purpose of "compare-test" rule is to compare ruby (trunk) and
	  matzruby (branches/matzruby) binary in miniruby level.  MATZRUBY
	  parameter means an path to miniruby of matzruby binary.  to do this
	  comparison test, you should build matzruby branch.

	* yarvtest/yarvtest.rb: fix to use command line option as
	  command names to be compared.

	* yarvtest/runner.rb: remove a debug output.

Thu Jan  4 19:12:27 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: fix to use test.rb script in build directory.
	  ($(srcdir)/test.rb -> test.rb)

Thu Jan  4 17:28:05 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/utils.rb (WEBrick::Utils::TimeoutHandler#initialize):
	  Arrays could not be modified in its each block. [ruby-dev:30063]

Thu Jan  4 16:57:14 2007  Koichi Sasada  <ko1@atdot.net>

	* yarv_version.h: removed.

	* common.mk: remove yarv_version.h from rules

	* yarvcore.h (Init_yarvcore): remove useless constants

Thu Jan  4 17:00:06 2007  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (Init_ossl_asn1):
	  OpenSSL::ASN1::ASN1Data#value,#tag,#tag_class and
	  OpenSSL::ASN1::BitString#unused_bits should be public.

Thu Jan  4 13:45:10 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.ci: fix last changes around PTHREAD_STACK_MIN.

Thu Jan  4 13:42:47 2007  Koichi Sasada  <ko1@atdot.net>

	* common.mk: restore changes.

Thu Jan  4 10:33:54 2007  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.ci: fix to skip using PTHREAD_STACK_MIN.
	  [ruby-dev:30063]

Thu Jan  4 10:30:11 2007  Koichi Sasada  <ko1@atdot.net>

	* benchmark/run_rite.rb (bm): fix to use lines.

Wed Jan  3 18:49:15 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_getline): lineno update condition was wrong.
	  [ruby-dev:30065]

	* io.c (rb_io_getline_fast): ditto.

Wed Jan  3 11:36:51 2007  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (ruby_dup): start GC on ENOMEM as well.

Tue Jan  2 10:29:54 2007  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c: fix to compile on YARV
	  ruby_errinfo -> rb_errinfo()

Mon Jan  1 08:07:06 2007  Koichi Sasada  <ko1@atdot.net>

	* ext/tk/tcltklib.c: fix to compile on YARV
	  ruby_errinfo -> rb_errinfo(),
	  ruby_safe_level -> rb_safe_level().

Mon Jan  1 07:57:17 2007  Koichi Sasada  <ko1@atdot.net>

	* test/drb/test_drbssl.rb: fix to skip drb tests.

Mon Jan  1 06:13:11 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/c_parser.rb: Make Rdoc accessible.  Update constant
	  value information.

	* ext/bigdecimal/bigdecimal.c: Update constant comments to provide
	  values for RDoc.

Mon Jan  1 06:05:55 2007  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser#handle_constants):
	  Allow RDoc comment to give friendly value for rb_define_const.  Patch
	  by Daniel Berger <djberg96 at gmail.com>, [ruby-patches-7499].
	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser#handle_constants): Fix
	  whitespace handling in constant comments.

Mon Jan  1 00:00:00 2007  Koichi Sasada  <ko1@atdot.net>

	* Merge YARV

Sun Dec 31 16:22:48 2006  Eric Hodel  <drbrain@segment7.net>

	* array.c: Fix Array#reject.

Sun Dec 31 00:46:25 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date2.rb: removed.

Sun Dec 31 00:15:13 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: updated based on date2 4.0.

Sat Dec 30 04:38:23 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_each_with_index): reuse array for yield parameters.

	* enum.c (enum_min, enum_max): ditto.

Sat Dec 30 04:25:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_inject): reuse array for yield parameters.

Sat Dec 30 02:54:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/stringio/stringio.c (strio_gets): accepts limit argument.

	* ext/stringio/stringio.c (strio_readline, strio_each,
	  strio_readlines): ditto.

Sat Dec 30 02:22:32 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): add limit capability.

	* io.c (rb_io_gets_m): accepts limit argument.  [ruby-talk:231563]

	* io.c (rb_io_readline, rb_io_readlines, rb_io_each_line, argf_getline):
	  ditto.

	* io.c (appendline): add limit capability.

	* io.c (rb_io_getline_fast, rb_io_getline): ditto.

	* io.c (rb_io_getline): small refactoring for DRY.

	* io.c (rb_io_s_foreach, rb_io_s_readlines): small refactoring.

Thu Dec 28 15:27:38 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::Cookie::initialize): use Array() again.
	  [ruby-core:09781]

Wed Dec 27 20:52:32 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: remove WIN32OLE::PROPERTY class.

	* ext/win32ole/tests/testWIN32OLE.rb: ditto.

Wed Dec 27 10:04:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_Array): returns 1-element array if the argument
	  does not have to_ary nor to_a.

Tue Dec 26 21:02:14 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb: The argument
	  of Shell.NameSpace should not be file path.

Tue Dec 26 06:13:08 2006  Minero Aoki  <aamine@loveruby.net>

	* ext/bigdecimal/bigdecimal.c: remove useless method
	  BigDecimal#!=. [ruby-dev:30050]

Thu Dec 21 15:37:17 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_slice_bang): rdoc description bug fixed.
	  [ruby-core:09754]

Wed Dec 20 12:54:31 2006  Koichi Sasada  <ko1@atdot.net>

	* Convert CVS repository to Subversion repository.

Mon Dec 18 08:36:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::Cookie::initialize): Array(string) no longer
	  works.  [ruby-core:09738]

Fri Dec 15 00:19:53 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (COMPILE_RULES): latter rule has higher priority.

	* lib/mkmf.rb (create_makefile): remove static library before update,
	  to get rid of sludge of Borland tlib.exe.

Thu Dec 14 18:29:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/readline/readline.c: NetBSD editline does not have
	  rl_username_completion_function() and rl_completion_matches().
	  a patch from Takahiro Kambe <taca at back-street.net>.
	  [ruby-dev:30008]

Thu Dec 14 18:20:43 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/locale.rb (IRB::Locale::puts): typo fixed.  a patch from
	  NAKAMURA Usaku <usa@ruby-lang.org>.  [ruby-dev:30012]

Tue Dec 12 23:33:53 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (Switch#parse_arg, Switch#conv_arg): splat failures.

Mon Dec 11 11:51:10 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/sha2/lib/sha2.rb: Moved one level up from under
	  the superfluous subdirectory digest/.

Mon Dec 11 11:46:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_define_const): typo fixed.

Mon Dec 11 09:36:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_aset): index double decode problem.
	  [ruby-core:09695]

Sat Dec  9 21:39:24 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): keep the exception till after END blocks.
	  [ruby-core:09675]

Sat Dec  9 11:22:00 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/locale.rb (IRB::Locale::search_file): use File.exist?
	  instead of File.exists?.  a patch from Yutaka Kanemoto
	  <kinpoco at gmail.com> in [ruby-dev:30000].

Fri Dec  8 18:11:18 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/optparse.rb: cannot put :nodoc: before method definition.
	  put after it.

Fri Dec  8 17:00:13 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bin/rdoc: use File.exist? instead of File.exists?.

Thu Dec  7 23:50:21 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (Init_Object): new method Dir.exist?(path).
	  [ruby-core:09663]

	* file.c (Init_File): remove File.exists?; use File.exist?
	  instead.

	* file.c: rename functions to test_* to rb_file_*_p.

Thu Dec  7 09:29:02 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/weakref.rb (WeakRef::__setobj__): should support
	  marshaling.  [ruby-talk:228508]

Wed Dec  6 23:58:36 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.mk (NULLCMD): moved for platforms that empty
	  command does not run.  fixed: [ruby-dev:29994]

	* win32/win32.c (init_stdhandle): redirect unopened IOs to NUL.
	  [ruby-core:09572]

Tue Dec  5 19:01:42 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (SITE_DIR): fixed to empty RUBY_SITE_LIB in config.h on
	  NetBSD.  fixed: [ruby-dev:29358]

Tue Dec  5 18:38:21 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/matrix.rb (Matrix::rank): use quo method to avoid integer
	  division problem.  [ruby-core:09644]

	* lib/matrix.rb (Matrix::rank_e): ditto.

Tue Dec  5 00:59:05 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): need to parse "/=" as
	  self assignment operator, not regex.  [ruby-talk:227324]

Tue Dec  5 00:19:14 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h, object.c, variable.c (rb_mod_constants): added an optional
	  flag to search ancestors, which is defaulted to true, as well as
	  const_defined? and const_get.  [ruby-dev:29989]

Mon Dec  4 23:49:28 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (install_recursive): get rid of warning.

	* lib/optparse.rb (CompletingHash#match): get rid of splat failure.

Mon Dec  4 19:16:39 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest/hmac.rb: Do alias << update.

Mon Dec  4 10:48:03 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (OFFT2NUM): use LONG2NUM() if sizeof(long) equals to
	  sizeof(off_t).

Mon Dec  4 08:32:25 2006  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension::read_multipart): should quote
	  boundary. JVN#84798830

Sun Dec  3 16:16:53 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest/hmac.rb: Fix problems with update
	  timing. [Reported by: oss-ruby@technorama.net]

Sat Dec  2 07:33:53 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils::FormData::<<):
	  HTTPUtils::parse_header() takes a string.  [ruby-dev:29931]

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils::parse_header):
	  String does no longer have each method.

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils::parse_form_data):
	  ditto.

Sat Dec  2 07:09:04 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ocsp.c: OpenSSL::OCSP::OSCPError should be
	  subclass of OpenSSL::OpenSSLError. [ruby-dev:29980]

Fri Dec  1 16:31:53 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: shouldn't run the killed thread at callback.
	  [ruby-talk: 227408]

Tue Nov 28 17:25:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (ary_iter_check): should check modification (size
	  change) during iteration.

	* array.c (rb_ary_initialize, rb_ary_shift, rb_ary_unshift,
	  rb_ary_splice, rb_ary_reverse, rb_ary_sort, rb_ary_delete,
	  rb_ary_delete_at, rb_ary_reject_bang, rb_ary_replace,
	  rb_ary_clear, rb_ary_fill, rb_ary_uniq_bang, rb_ary_compact,
	  rb_ary_shuffle): add iteration check.

Mon Nov 27 09:00:15 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_ord): typo fixed.  reported from Kornelius
	  Kalnbach <murphy@rubychan.de>.  [ruby-core:09621]

Sun Nov 26 16:36:46 2006  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* version.h: addition of RUBY_PATCHLEVEL.
	* version.c: ditto.

Wed Nov 22 16:00:49 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: support --with-X11/--without-X11 option.

	* ext/tk/README.tcltklib: add description about --with-X11-* option
	  [ruby-talk:225166] and --with-X11/--without-X11 option.

	* ext/tk/tkutil/extconf.rb: able to be called manually
	  [ruby-talk:225950].

Sat Nov 18 23:39:20 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_tap): a new method.  [ruby-talk:224013]

Wed Nov 15 23:22:54 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (test_grpowned, rb_stat_grpowned): should honor
	  supplementary group IDs.  [ruby-core:09546]

Tue Nov  7 18:35:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (formal_assign): need to pack rest arg information in
	  argc.

Tue Nov  7 18:05:01 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/itemconfig.rb: minor bug fix.

Tue Nov  7 17:52:08 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (rb_include_module): revert duplicate inclusion of
	  modules.  [ruby-dev:29793]

Tue Nov  7 17:18:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (method_missing): update old argument adjustment.

Tue Nov  7 16:41:21 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (when_check): need to splat for NODE_ARGSCAT as well.
	  [ruby-dev:29860]

Mon Nov  6 22:23:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (Init_String): remove duplicated definition of
	  Symbol#to_s.

Mon Nov  6 18:54:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (svalue_to_avalue): need to splat but no error.

	* eval.c: new macros - YIELD_CALL, YIELD_VALUES.

	* eval.c (rb_yield_values): specify YIELD_VALUES.

	* eval.c (rb_yield_0): use new macros.

	* eval.c (proc_invoke): slightly modified to separate YIELD_CALL
	  and YIELD_VALUES from YIELD_ARY_ARGS.

	* object.c (Init_Object): add nil.to_splat => [].

Mon Nov  6 15:41:55 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/itemconfig.rb: ext/tk/lib/tk/itemconfig.rb: bug
	  fix on 'itemconfiginfo' method, and modify to make it easy to
	  override 'itemconfiginfo' method.

	* ext/tk/lib/tkextlib/tile/treeview.rb: support Tile 0.7.8.

	* ext/tk/lib/tkextlib/version.rb: [new] add Tk::Tkextlib_RELEASE_DATE
	  to get the information from scripts.

	* ext/tk/lib/tk.rb: load 'tkextlib/version.rb', and update RELEASE_DATE

	* ext/tk/lib/tkextlib/SUPPORT_STATUS: update.

	* ext/tk/sample/editable_listbox.rb: [new] the listbox with editable
	  items. It's one of the example about usage of Place geometry manager.

	* ext/tk/sample/tktextio.rb: improve the functions of TkTextIO class.
	  Those are required by 'irbtkw.rbw'.

	* ext/tk/sample/irbtkw.rbw: [new] IRB on Ruby/Tk. It doesn't need any
	  real console. IRB works on a text widget without I/O blocking. That
	  is, thread switching on IRB will work properly, even if on Windows.

Mon Nov  6 00:42:05 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (arg_dup_check): vid may be nameless internal id.

Sun Nov  5 19:52:19 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: updated based on date2 3.9.7.

Sat Nov  4 13:09:31 2006  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: accept NOMODSEQ. [ruby-core:9002]

Fri Nov  3 00:16:37 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (ruby_getnameinfo__aix): AF_INET6 workaround
	  for AIX.  a patch from Yutaka Kanemoto <kinpoco AT gmail.com>.
	  [ruby-dev:29744]

Thu Nov  2 14:19:44 2006  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#^): Fix XOR operation against a container that
	  holds duplicate values. [ruby-core:9372]

Thu Nov  2 10:00:06 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c: class Symbol is no longer subclass of String. also
	  covers [ruby-core:09366]

Thu Nov  2 08:21:07 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/xmlrpc/create.rb (XMLRPC::Create::conv2value): Symbol should
	  come earlier than String.

	* lib/soap/mapping/rubytypeFactory.rb (RubytypeFactory::obj2soap):
	  ditto.

	* lib/set.rb (TC_Set::test_s_new): strings are no longer
	  Enumerable

	* lib/soap/property.rb (Property::load): ditto.

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils::parse_header): ditto.

	* lib/soap/mimemessage.rb (MIMEMessage::Headers::parse): ditto.

Thu Nov  2 09:08:04 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c: revert lfree shift/unshift boost patch to avoid unknown
	  memory error.

Wed Nov  1 23:24:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (struct RArray): revert embedding ptr in RVALUE.

	* array.c: ditto.

Wed Nov  1 23:01:55 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (hash): use Bob Jenkins' hash algorithm.

Wed Nov  1 02:22:31 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest/hmac.rb (Digest::HMAC::update): Minor
	  optimization.

	* ext/digest/digest.c (rb_digest_instance_equal): Allow comparing
	  a digest instance with another of a different class.

Wed Nov  1 01:05:13 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (rb_call0): fixed bug of zsuper with both of opt and rest.
	  fixed: [ruby-list:42928]

Tue Oct 31 17:03:21 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_dup): duplicate the class of original time.
	  [ruby-core:09357]

	* lib/time.rb (Time::make_time, Time::rfc2822, Time::httpdate):
	  should respect subclasses.  [ruby-core:09357]

Tue Oct 31 16:25:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (ary_shared_first): should address offset after
	  ary_shared_array().  [ruby-core:09358]

Mon Oct 30 23:40:52 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (miniruby): add XLDFLAGS.

	* configure.in (aix): use -bE option for miniruby.  [ruby-dev:29698]

	* dir.c (glob_helper): get rid of possible memory leak.

	* win32/win32.c (cmdglob, rb_w32_cmdvector, rb_w32_opendir,
	  rb_w32_get_environ): not to use GC before initialization.

Mon Oct 30 19:28:02 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2str0): use better approximation.

Mon Oct 30 18:35:33 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big2str0): wrong allocation length.  a patch from
	  U.Nakamura <usa at garbagecollect.jp> [ruby-dev:29710]

Mon Oct 30 12:34:02 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): fix commit miss.  [ruby-dev:29707]

Mon Oct 30 11:15:40 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): should preserve leading zero
	  information for negative %b and %x.  [ruby-talk:221347]

Sun Oct 29 19:51:31 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* regexec.c: invalid offset value was used in STATE_CHECK_BUFF_INIT().

Sat Oct 28 20:13:18 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* oniguruma.h: Version 4.4.5

	* regint.h: ditto.

	* regerror.c: ditto.

	* regexec.c: ditto.

	* regcomp.c ditto.

	* regparse.c ditto.

Sat Oct 28 07:56:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_object0): missing break.  [ruby-core:09345]

Fri Oct 27 17:30:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enum_each_cons): move RETURN_ENUMERATOR() after
	  argument check.

Thu Oct 26 21:05:48 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_pkcs7.c (ossl_pkcs7_verify): should clear error.
	  (fix http://bugs.debian.org/394336)

	* ext/openssl/ossl_ns_spki.c (ossl_spki_initialize): ditto.

Thu Oct 26 15:23:47 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c: remove by_slice and by_cons.

Thu Oct 26 15:12:12 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/digest/digest.c (Init_digest): typo.

Wed Oct 25 17:16:05 2006  Akinori MUSHA  <knu@iDaemons.org>

	* test/digest/test_digest_hmac.rb: added.

Wed Oct 25 16:34:31 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/test.sh: make this script work again.

Wed Oct 25 07:59:42 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: updated based on date2 3.9.6.
	  [ruby-core:09323]

Wed Oct 25 00:58:19 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/mkexports.rb, win32/resource.rb: use unique variable names.

Tue Oct 24 19:18:53 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_by_slice): new method added.

	* enumerator.c (enumerator_by_cons): ditto.

Tue Oct 24 18:56:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enum_each_slice, enum_each_cons): returns
	  Enumerable::Enumerator if no block is given.  [ruby-dev:29246]

	* enumerator.c: remove methods: enum_with_index, enum_slice,
	  enum_cons.  [ruby-dev:29246]

Tue Oct 24 18:51:27 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_zip): add RETURN_ENUMERATOR() to zip method.

Mon Oct 23 04:30:04 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_object0): use return value from proc given as the
	  second argument to Marshal#load() to allow value replacement in
	  the restoring data.

Sun Oct 22 14:48:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (Init_signal): avoid duplicated installation of SIGCHLD
	  handler.

Sun Oct 22 16:47:56 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_substr): should be infected with only original
	  string, but not the shared string.  fixed: [ruby-core:09152]

	* string.c (rb_str_new4): keep shared string untainted when original
	  string is tainted.  fixed: [ruby-dev:29672]

Sun Oct 22 07:55:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_upcase, rb_str_downcase, rb_str_downcase,
	  rb_str_upcase_bang, rb_str_downcase_bang, rb_str_swapcase_bang):
	  add RDoc description that case conversion to be effective only
	  in ASCII region.

Sun Oct 22 05:20:34 2006  URABE Shyouhei  <shyouhei@ice.uec.ac.jp>

	* configure.in: alloca is broken; use C_ALLOCA instead.
	  [ruby-dev:29416]

Sat Oct 21 17:50:40 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest.rb: Follow the framework updates.

Fri Oct 20 22:00:43 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest/hmac.rb: Complete half-boiled updates.

	* ext/digest/sha2/lib/digest/sha2.rb: Fix #initialize_clone().

Fri Oct 20 20:28:37 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest: Prefix C constants with RUBY_ and C type names with
	  rb_ to avoid name clash in writing extensions.

	* ext/digest: Introduce Digest::Class and Digest::Instance for
	  ease of implementing subclasses and add-ons, inspired by
	  gotoyuzo.

	* ext/digest: The Digest::Instance module now requires and assumes
	  that any instance be resettable and clonable, and add some
	  convenient instance methods such as "new()", for creating a new
	  copy, parameter taking "digest()" and "hexdigest()", for instant
	  calculation.  These methods make digest instances work just like
	  digest classes.

	* ext/digest/sha2/lib/digest/sha2.rb:
	  Add the Digest::SHA2 class to wrap up SHA2 variants: SHA256,
	  SHA384 and SHA512, hoping this module would make a decent
	  example of a digest subclass written in Ruby.

	* ext/digest/lib/digest.rb: Adjust autoload entries for SHA2
	  classes.

	* ext/digest/lib/digest/hmac.rb: Follow the framework updates.

Fri Oct 20 10:47:43 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb: fixed the bug of handling COMMON_MACROS.

Fri Oct 20 08:42:38 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (NULLCMD): dummy command.

	* bcc32/Makefile.sub (post-install-*): Borland make cannot ignore
	  command-less double-colon rules.  [ruby-dev:29676]

Fri Oct 20 00:37:07 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bcc32/Makefile.sub ($(LIBRUBY_SO)): execute pre-link hook.

	* ext/extmk.rb: workaround for Borland make.

Wed Oct 18 23:02:40 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shift): shorten copy size.  fixed: [ruby-list:42907]

	* signal.c (Init_signal): handle SIGTERM.  fixed: [ruby-list:42895]

	* win32/win32.c (rb_w32_utime): allow NULL to set the current time.
	  [ruby-talk:219248]

Wed Oct 18 13:25:50 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_each_line): String#lines now works when a block
	  is given.  in other words, lines become an alias to each_line.
	  [ruby-core:09218]

	* string.c (rb_str_each_byte): ditto for bytes in place of lines.

Wed Oct 18 00:55:33 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): use particular enums.  [ruby-core:09221]

Tue Oct 17 22:03:08 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/erb.rb: String#each was removed, use #each_line instead.

Tue Oct 17 12:27:32 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (ary_shared_array): should set NOEMBED flag for a copied
	  array.

Tue Oct 17 08:04:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_lines): now takes optional argument for the
	  line separator.

	* io.c (rb_io_lines, rb_io_bytes): new methods.

Mon Oct 16 23:33:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_unshift_m): a bug in lfree shift length
	  calculation.

Mon Oct 16 08:30:43 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: *OBJS are not needed for extension libraries.

	* {bcc32,wince,win32}/Makefile.sub (config.status): fixed typo,
	  missing comma.

Mon Oct 16 00:44:26 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_unpack): execute block if given with unpacked value
	  instead of creating an array.  an idea from Tim Bray.

Sun Oct 15 01:03:08 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/collector/dir.rb (Collector::Dir#collect): append base
	  directory but not prepend.

	* lib/test/unit/collector/dir.rb (Collector::Dir#collect_file): do not
	  join with dot.  fixed: [ruby-core:09179]

Sat Oct 14 23:39:50 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (singleton): no need to re-create NODE_SELF() again.
	  [ruby-core:09177]

Sat Oct 14 23:25:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_warning, parser_warn): some error message may
	  contain format specifiers.  a patch from Akinori MUSHA <knu at
	  iDaemons.org>.  [ruby-dev:29657]

	* regparse.c (onig_rb_warning, onig_rb_warn): ditto.

	* ext/bigdecimal/bigdecimal.c (VpException): ditto.

	* ext/dl/handle.c (rb_dlhandle_initialize): ditto.

	* ext/gdbm/gdbm.c (rb_gdbm_fatal): ditto.

Sat Oct 14 08:15:42 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c, ext/digest/digest.h,
	  ext/digest/md5/md5init.c, ext/digest/rmd160/rmd160init.c,
	  ext/digest/sha1/sha1init.c, ext/digest/sha2/sha2init.c:
	  Introduce API versioning.

	* ext/digest/digest.c, ext/digest/digest.h,
	  ext/digest/md5/md5init.c, ext/digest/rmd160/rmd160init.c,
	  ext/digest/sha1/sha1init.c, ext/digest/sha2/sha2init.c: Remove
	  the constants DIGEST_LENGTH and BLOCK_LENGTH and turn them into
	  instance methods digest_length() and block_length().  Class
	  methods with the same names are also provided, which take extra
	  parameters for a digest method.

	* ext/digest/lib/digest/hmac.rb: Completely redesign the somewhat
	  bizarre API, now that Digest classes can take hashing
	  parameters.

Sat Oct 14 05:54:05 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c: Improve RDoc documentation further more.

Sat Oct 14 04:33:33 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c: Improve RDoc documentation.

	* ext/digest/digest.c (Init_digest, rb_digest_base_s_digest,
	  rb_digest_base_s_hexdigest): Make Digest::Base::digest() and
	  Digest::Base::hexdigest() take extra arguments, which are passed
	  through to the constructor in an internal call.

	* ext/digest/bubblebabble/bubblebabble.c
	  (rb_digest_base_s_bubblebabble): Ditto for
	  Digest::Base::bubblebabble().

Sat Oct 14 00:55:08 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bcc32/Makefile.sub (post-install-ext): no longer needed.

	* bcc32/configure.bat: get rid of a quirk of Borland make, which
	  sets empty macro in command line to "1".

Fri Oct 13 22:49:02 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: updated based on date2 3.9.5.

Fri Oct 13 21:00:01 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest.rb (Digest): Try to auto-load non-standard
	  digest modules when a specified digest class is missing.

	* ext/digest/lib/digest.rb: Define Digest(name) for ease of
	  dynamically selecting a hashing algorithm.

Fri Oct 13 20:53:37 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (Init_digest): Digest::Base.new() does no
	  longer take an initial string to feed.  This change allows
	  subclasses to take hashing parameters.  A statement such as
	  ``md = Digest::MD5.new(s)'' can be easily rewritten as
	  ``md = Digest::MD5.new << s'' or
	  ``md = Digest::MD5.new.update(s)''.

Fri Oct 13 20:51:55 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c, ext/digest/md5/md5init.c,
	  ext/digest/rmd160/rmd160init.c, ext/digest/sha1/sha1init.c,
	  ext/digest/sha2/sha2init.c: Add RDoc documentation.

	* ext/digest/digest.txt, ext/digest/digest.txt.ja: Removed in
	  favor of embedded RDoc documentation.

Fri Oct 13 20:38:12 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/bubblebabble, ext/digest/digest.c: Rip BubbleBabble
	  support out of the base class and have a separate module named
	  digest/bubblebabble.

Fri Oct 13 19:53:59 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_base_equal): Again, should call
	  digest() of a subclass instead of the one defined in the base
	  class.

Fri Oct 13 18:19:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c: Class#inherited RDoc added.  a patch from Daniel
	  Berger <djberg96 at gmail.com>  [ruby-core:08942]

Fri Oct 13 02:42:00 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_base_equal): Should call digest()
	  of a subclass instead of the one defined in the base class.

Fri Oct 13 02:30:12 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/collector/dir.rb (Collector::Dir#collect): prepend
	  base directory to load path.

	* lib/test/unit/collector/dir.rb (Collector::Dir#collect_file): should
	  use the given File-like interface, but not File directly.

	* test/testunit/collector/test_dir.rb (TestDir::FileSystem): implement
	  File-like methods correctly.

Fri Oct 13 01:48:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/date.rb (Date::self.complete_hash): need to check if g is
	  nil before dereference.  [ruby-core:09116]

Fri Oct 13 01:05:58 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_partition): RDoc update.  a patch from
	  Mauricio Fernandez <mfp at acm.org>.  [ruby-core:09160]

	* hash.c (rb_hash_compare_by_id): ditto.

Fri Oct 13 00:34:26 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_mod_cvar_defined): wrong id check.  a patch from
	  Mauricio Fernandez <mfp at acm.org>.  [ruby-core:09158]

	* object.c (rb_mod_cvar_get): typo fixed.  [ruby-core:09168]

	* object.c (rb_mod_cvar_set): ditto.

Thu Oct 12 22:58:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_compare_by_id): somehow we lost renaming from
	  Hash#identical.  [ruby-core:09163]

Thu Oct 12 18:25:40 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/tk/tkutil/tkutil.c (cbsubst_table_setup): need to handle new
	  character literal (1 char string).

	* lib/mkmf.rb: shut up some warnings from tk's extconf.rb.

Thu Oct 12 02:15:24 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest/hmac.rb: Make use of String#bytes.

Thu Oct 12 02:12:31 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (get_digest_base_metadata): Use an instance
	  variable of a class object instead of a class variable for
	  metadata.  This change is only crucial for ruby 1.8 because
	  class variables are inherited to subclasses prior to 1.9, but
	  applying it also to 1.9 will assure compatibilities.

	* ext/digest/md5/md5init.c (Init_md5): Ditto.

	* ext/digest/rmd160/rmd160init.c (Init_rmd160): Ditto.

	* ext/digest/sha1/sha1init.c (Init_sha1): Ditto.

	* ext/digest/sha2/sha2init.c (Init_sha2): Ditto.

Wed Oct 11 21:36:47 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_base_alloc,
	  rb_digest_base_equal): Simplify the equality check and just
	  compare resulted digests since state-level equality should
	  not be so significant.

	* ext/digest/digest.h: Ditto.

	* ext/digest/*/*.[ch]: Ditto.

Wed Oct 11 17:11:03 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_obj_define_method): add half boiled RDoc document.

Wed Oct 11 16:57:46 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_replace): should shift lfree pointer before
	  calling xfree.

Wed Oct 11 15:07:42 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest/hmac.rb: Add digest/hmac, which implements
	  HMAC keyed-hashing algorithm.

Wed Oct 11 15:03:55 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_base_reset): Do not make
	  recursive calls, but call initialize() when reset() is not
	  defined in a subclass.

Wed Oct 11 14:56:10 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/digest/sha1/sha1ossl.h: libssl 0.9.8c-3 defines no
	  SHA_BLOCK_LENGTH.

Wed Oct 11 14:03:31 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_base_reset, Init_digest): Add
	  Digest::Base#reset.

	* ext/digest/digest.h: Update the header comment.

	* ext/digest/md5/md5ossl.h, ext/digest/md5/md5init.c (Init_md5):
	  Define DIGEST_LENGTH and BLOCK_LENGTH.

	* ext/digest/rmd160/rmd160init.c (Init_rmd160): Ditto.

	* ext/digest/sha1/sha1init.c (Init_sha1): Ditto.

	* ext/digest/sha2/sha2init.c (Init_sha2): Ditto.

	* ext/digest/depend, ext/digest/extconf.rb: Use $INSTALLFILES
	  rather than adding make targets. [Pointed out by: nobu]

Tue Oct 10 16:39:08 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (hexdigest_str_new, bubblebabble_str_new):
	  Perform StringValue() checks properly.

Tue Oct 10 13:21:21 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/sha1/depend, ext/digest/sha2/depend: Remove obsolete
	  dependencies.

Mon Oct  9 23:46:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/parsedate.rb: documentation patch from Konrad Meyer
	  <konrad.meyer@gmail.com>.  [ruby-doc:1238]

	* lib/open3.rb, lib/ping.rb: ditto.

Mon Oct  9 23:40:58 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb, lib/fileutils.rb, lib/mkmf.rb, lib/optparse.rb,
	  lib/shellwords.rb: get rid of shadowing outer local variable.

Mon Oct  9 22:56:12 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/encoding.rb (REXML::Encoding::check_encoding): spaces
	  are allowed around equal sign.  [ruby-core:09032]

	* lib/rexml/parsers/baseparser.rb (REXML::Parsers::BaseParser): ditto.

Mon Oct  9 01:56:34 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_obj_define_method): add new method
	  Kernel#define_singleton_method.  [ruby-list:42851]

Sat Oct  7 23:53:08 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_scan): small documentation fix.
	  [ruby-core:09007]

Sat Oct  7 23:44:33 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_rshift): a bug in right shift of negative
	  bignums.  [ruby-core:09020]

Sat Oct  7 23:33:02 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (formal_assign): packed post splat arguments may conflict
	  with normal arguments.  [ruby-core:09021]

	* eval.c (rb_call0): ditto.

Sat Oct  7 11:53:04 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_mod_initialize): since module_eval no longer passes
	  self, use module_exec instead.  fixed: [ruby-dev:29637]

Sat Oct  7 00:27:58 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (rb_include_module): remove unnecessary check.
	  [ruby-talk:218402]

Fri Oct  6 15:19:59 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/depend: Fix header installation when the build
	  directory is different from srcdir. [Pointed out by: eban]

Fri Oct  6 09:56:31 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32,wince}/Makefile.sub (config.status): shouldn't use
	  copy command instead of install. use -run install.

Fri Oct  6 06:53:46 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_yield_0): small refactoring.

	* parse.y (bparam_item): fixed bugs in handling parenthesized LHS.

Fri Oct  6 04:47:07 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/depend: Install digest.h.

Fri Oct  6 04:27:40 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/md5.rb, ext/digest/lib/sha1.rb: Remove those
	  compatibility stub libraries.

	* sample/openssl/c_rehash.rb: Use digest/md5 instead of obsolete md5.

Fri Oct  6 04:09:51 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c: Make hexdigest() always call digest() internally.

	* ext/digest/digest.c: Add bubblebabble().

Fri Oct  6 02:38:42 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c: Allow subclassing in Ruby.

Fri Oct  6 02:06:10 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (hexdigest_str_new): Add a string size check.

Thu Oct  5 19:28:35 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.[ch]: Since the argument order of
	  hash_final_func_t was inconsistent with others, change it and
	  rename to hash_finish_func_t to avoid confusion.

	* ext/digest/digest.[ch]: Remove and eliminate the use of
	  hash_end_func_t.  Implement hexdigest conversion in the base
	  class.

	* ext/digest/md5/md5.c, ext/digest/md5/md5.h,
	  ext/digest/md5/md5init.c, ext/digest/md5/md5ossl.c,
	  ext/digest/md5/md5ossl.h: Remove MD5_End() and change
	  MD5_Final() to MD5_Finish().

	* ext/digest/rmd160/depend, ext/digest/rmd160/extconf.rb,
	  ext/digest/rmd160/rmd160.c, ext/digest/rmd160/rmd160.h,
	  ext/digest/rmd160/rmd160hl.c, ext/digest/rmd160/rmd160init.c,
	  ext/digest/rmd160/rmd160ossl.c, ext/digest/rmd160/rmd160ossl.h:
	  Remove unused functions RMD160_End(), RMD160_File(),
	  RMD160_Data() and change RMD160_Final() to RMD160_Finish().

	* ext/digest/sha1/extconf.rb, ext/digest/sha1/sha1.c,
	  ext/digest/sha1/sha1.h, ext/digest/sha1/sha1hl.c,
	  ext/digest/sha1/sha1init.c, ext/digest/sha1/sha1ossl.c,
	  ext/digest/sha1/sha1ossl.h: Likewise.

	* ext/digest/sha2/extconf.rb, ext/digest/sha2/sha2.c,
	  ext/digest/sha2/sha2.h, ext/digest/sha2/sha2hl.c,
	  ext/digest/sha2/sha2init.c: Likewise.

Wed Oct  4 18:47:25 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkextlib/*: bugfix and update
	  (see ext/tk/ChangeLog.tkextlib).

Wed Oct  4 17:25:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call): check protected visibility based on real self,
	  not ruby_frame->self.  [ruby-talk:217822]

Wed Oct  4 15:46:32 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (block_param): should interpret single parenthesized
	  left hand side expression.

Wed Oct  4 08:52:30 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/optparse/test_getopts.rb: changed the class name of test case
	  to get rid of conflict with test_optparse.rb.

Tue Oct  3 21:04:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (dyna_in_block): inline using macro.

	* parse.y (mlhs): simplifies the rule a bit.

	* parse.y (block_param): restrict block parameters to be local
	  variables only.

	* test/ruby/test_iterator.rb (TestIterator::test_nested_iterator):
	  update test suite to conform the last change.

Tue Oct  3 02:31:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (splat_value): use "to_splat" instead of "to_ary" to
	  prepare splat values as an array.

	* array.c (Init_Array): define to_splat.

	* range.c (range_to_splat): new method.

	* enumerator.c (enumerator_to_splat): ditto.

Tue Oct  3 01:36:47 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_lines): returns an Enumerator instead of an
	  array of lines.

	* string.c (rb_str_bytes): a new method.

Mon Oct  2 23:47:55 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner::COLLECTORS):
	  base directory should be lower precedence.  fixed: [ruby-dev:29622]

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner#options): typo.

	* lib/test/unit/collector/dir.rb (Test::Unit::Collector::Dir#collect_file):
	  load expanded path.  fixed: [ruby-dev:29621]

Mon Oct  2 15:47:55 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* instruby.rb: batfile should be CRLF'ed.

Mon Oct  2 01:24:26 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (test-all): separate directory where running test cases
	  from source tree.

	* lib/test/unit/autorunner.rb (options): added --basedir, --workdir
	  and --load-path options.

	* lib/test/unit/collector/dir.rb (recursive_collect, collect_file):
	  base directory support.

Sun Oct  1 23:56:52 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.mk, ext/extmk.rb, win{32,ce}/Makefile.in: keep
	  LIBRUBY_SO unless need to be removed.

Sun Oct  1 23:12:19 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#make_switch): pass arguments directly.

Sat Sep 30 15:11:26 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: updated based on date2 3.9.4.

Fri Sep 29 13:18:24 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest.rb (Digest): Require digest.so and fix the
	  breakage.  Point out by NAKAMURA Usaku in [ruby-dev:29619].

Fri Sep 29 12:11:04 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* jcode.rb (succ!): call original succ! if $KCODE == 'n'.
	  fixed: [ruby-talk:216845]

Fri Sep 29 11:43:40 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_func): revert fallback checking undeclared function.
	  fixed: [ruby-core:08949]

Fri Sep 29 09:56:56 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: extout is needed for also clean.
	  fixed: [ruby-core:08944]

	* lib/optparse.rb (OptionParser::Switch#conv_arg): unsplat by
	  Proc#call if no conversion is given.

Thu Sep 28 23:59:31 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (struct thread): declare win32_exception_list on cygwin and
	  win32 regardless if it is implemented.  Provisional fix for
	  [ruby-core:08917].

Thu Sep 28 20:49:20 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/tmpdir.rb: use return value of getdir.call for length.

Wed Sep 27 22:08:16 2006  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/md5/md5init.c (Init_md5): Now that we have digest.rb,
	  require "digest" rather than "digest.so".

	* ext/digest/rmd160/rmd160init.c (Init_rmd160): Ditto.

	* ext/digest/sha1/sha1init.c (Init_sha1): Ditto.

	* ext/digest/sha2/sha2init.c (Init_sha2): Ditto.

Wed Sep 27 21:21:08 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_startwith): rename startwith? to start_with?,
	  endwith? to endwith?, respectively.  [ruby-talk:216685]

Wed Sep 27 13:29:01 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::TagMaker::nOE_element_def): replace to_s by
	  join.  some other methods as well.  [ruby-dev:29613]

Wed Sep 27 01:04:49 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_func): check function pointer first and macro next.

	* lib/mkmf.rb (have_type): simplified with typedef and sizeof.

Wed Sep 27 00:08:12 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_shift): shift/unshift performance boost patch,
	  based on the patch from Eric Mahurin <eric_mahurin at yahoo.com>.
	  [ruby-core:05861]

	* array.c (rb_ary_unshift_m): ditto.

	* array.c (ary_make_shared): ditto.

	* array.c (RESIZE_CAPA): ditto.

	* array.c (rb_ary_free): new function to free memory.  code moved
	  from gc.c.

	* string.c (rb_str_free): ditto.

Tue Sep 26 23:57:03 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#getopts): use strings as key.
	  fixed: [ruby-dev:29614]

Tue Sep 26 15:29:55 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {win32,wince}/Makefile.sub (CPP): check predefined value.

Tue Sep 26 07:55:16 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_shift): should not move memory region if array
	  body is shared.  a patch from Kent Sibilev <ksruby at gmail.com>.
	  [ruby-core:08922]

Mon Sep 25 23:10:46 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (rb_push_glob): need not to check by FilePathValue().
	  [ruby-dev:29599]

	* dir.c (dir_globs): ditto.

Mon Sep 25 22:26:26 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_path_end): skip root directory.  fixed: [ruby-core:08913]

	* lib/mkmf.rb (rm_f): get rid of NUL.

	* lib/mkmf.rb (init_mkmf): set default $LDFLAGS.  Patch by Michal
	  Suchanek <hramrach at centrum.cz>.  [ruby-talk:216256]

Mon Sep 25 15:06:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/test.rb: "print nil" now prints empty string.

	* test/ruby/test_system.rb (TestSystem::test_system): ditto.

Mon Sep 25 11:26:25 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (recursive_hash): remove unused local variable.

	* parse.y (parser_yylex): ditto.

	* parse.y (rb_gc_mark_symbols): fix unmatched prototype .

	* file.c (rb_get_path): check NUL byte in the path string.

Mon Sep 25 08:14:43 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_shift): should clear shifting top element.
	  [ruby-talk:216055]

	* array.c (rb_ary_shift): avoid creating shared object if array
	  size is small.

Mon Sep 25 08:11:35 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* random.c (rb_f_rand): RDoc typo fix.  a patch from Frederick
	  Cheung <fred at 82ask.com>.  [ruby-talk:216047]

Sun Sep 24 21:19:24 2006  Guy Decoux  <ts@moulon.inra.fr>

	* gc.c (gc_mark_children): NODE_POSTEXE holds Ruby VALUE.
	  [ruby-core:08912]

Sun Sep 24 22:28:20 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* runruby.rb: extension library scripts moved into common directory.

Sun Sep 24 12:10:04 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: updated based on date2 3.9.3.

Sun Sep 24 06:55:36 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_print): no special handling for nil as well as puts.
	  fixed: [ruby-dev:29586]

Sun Sep 24 06:25:53 2006  why the lucky stiff  <why@ruby-lang.org>

	* eval.c (rb_thread_save_context, rb_thread_restore_context):
	  sandbox hook to save and restore sandbox state.

	* eval.c (thread_no_ensure): added THREAD_NO_ENSURE thread flag.

	* eval.c (rb_thread_kill_bang): Thread#kill! uses the above flag
	  to circumvent ensure, in order to prevent endless loops.
	  contributed by MenTaLguY. [ruby-core:08768]

	* eval.c (rb_thread_kill): fix Thread#kill docs, which returns
	  the thread object in all cases.

	* node.h: expose the rb_jmpbuf_t and rb_thread_t structs, along
	  with the thread flags.  used by the sandbox extension.

	* ruby.h: extern rb_eThreadError, so sandbox can swap it.

Sat Sep 23 21:34:15 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension::read_multipart): CGI content
	  may be empty.  a patch from Jamis Buck <jamis at 37signals.com>.

Sat Sep 23 20:54:28 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* oniguruma.h: Version 4.4.4

	* regexec.c: ditto.

	* regcomp.c ditto.

Sat Sep 23 08:35:53 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rdoc/ri/ri_options.rb: prevent NameError.  [ruby-dev:29597]

Sat Sep 23 01:02:57 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: updated based on date2 3.9.2.

Fri Sep 22 18:07:17 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_partition): no need to call rb_call_super(),
	  since String is no longer includes Enumerable.

Fri Sep 22 17:33:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_eql): new method to be used by Hash.

	* hash.c (rb_hash_hash): ditto.

Fri Sep 22 06:53:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_hash): use rb_memhash().

	* numeric.c (flo_hash): simplified.  klass need not to affect
	  resulting hash value.

Fri Sep 22 02:06:26 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .cvsignore: ignore timestamp files and installed list file.

Fri Sep 22 01:36:34 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb: include FileUtils unconditionally.

Fri Sep 22 00:36:05 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (Init_Numeric): fix_odd_p and fix_even_p are for Fixnum.
	  patch from Ondrej Bilka <neleai at seznam.cz>.  [ruby-core:08904]

Thu Sep 21 22:56:20 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (no-install): not install rdoc actually.

	* common.mk (install-doc, no-install-doc): use instruby.rb.

	* instruby.rb: rdoc installation.

	* ext/extmk.rb: expand ruby executable names.

Thu Sep 21 20:19:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_new3): embed shorter strings more eagerly.

Thu Sep 21 17:44:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_startwith): a new method to check if a string
	  starts with given prefix.

	* string.c (rb_str_endwith): the opposite of String#startwith?.

Thu Sep 21 16:29:02 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* rubytest.rb: use each_line instead of each.

Thu Sep 21 15:06:24 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_odd_p): a new method to check even or odd.
	  [RCR#337]

	* numeric.c (int_even_p): ditto.

Thu Sep 21 13:55:07 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/etc/etc.c (etc_getpwuid): uid integer should be wrapped in
	  uid_t value.  [ruby-core:08897]

	* ext/etc/etc.c (etc_getpwuid): uid_t may be bigger than plain
	  'int' type.

Thu Sep 21 10:07:09 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_partition): RDoc typo fixed.  [ruby-core:08898]

	* string.c (rb_str_rpartition): fixed separation seek bug.

Thu Sep 21 09:38:12 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_lines): new method to split a string into lines.

	* string.c (Init_String): Strings are no longer Enumerable.  use
	  each_line or lines method explicitly.

	* string.c (Init_String): remove each method. use each_lines.

Wed Sep 20 23:17:41 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (pre-install-doc): create data directory before install.

	* lib/mkmf.rb (dir_re): fixed typo.

	* lib/mkmf.rb (install_dirs): remove extra slash.

Wed Sep 20 22:41:45 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (fix_mul): typo again.  patch from Tadashi Saito
	  <shiba at mail2.accsnet.ne.jp>.  fixed: [ruby-core:08893]

Wed Sep 20 19:32:06 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_partition): a new method to separate the string
	  by a separator.  taken from Python 2.5.

	* string.c (rb_str_rpartition): ditto.

Wed Sep 20 09:49:40 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32,wince}/Makefile.sub (INSTALLED_LIST): need to define
	  this macro to install.

Wed Sep 20 09:43:10 2006  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: allow extra spaces in responses.
	  Thanks, Tom Soderlund.

Wed Sep 20 09:25:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/gdbm/gdbm.c: add RDoc documentation. a patch from Peter
	  Adolphs <futzilogik at users dot sourceforge dot net>.
	  [ruby-doc:1223]

Tue Sep 19 00:42:15 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_obj_ivar_defined, rb_mod_cvar_defined): new methods,
	  Kernel#instance_variable_defined? and Module#class_variable_defined?.
	  [ruby-dev:29587]

	* lib/date/format.rb (Date::Bag#method_missing): use new method,
	  instance_variable_defined? to check if an instance variable is
	  defined.  fixed: [ruby-dev:29554]
	  -- This didn't fix anything.

Tue Sep 19 00:07:17 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_eql): fail early to gain performance.

	* string.c (sym_hash): cache hash value in aux.shared if possible.

	* gc.c (rb_obj_id): no need to treat symbols specially.

	* lib/fileutils.rb (FileUtils::FileUtils): singleton_methods() no
	  longer return an array of strings, but of symbols.

	* lib/delegate.rb (DelegateClass): ditto.

Mon Sep 18 15:29:21 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_s_glob): restore GC protection volatile variable.
	  [ruby-dev:29588]

	* re.c (rb_reg_regcomp): ditto.

Mon Sep 18 12:16:48 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (fix_mul): get rid of shift overflow.

Mon Sep 18 10:47:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_s_glob): remove unused variable.

	* math.c (math_log): ditto.

	* re.c (rb_reg_regcomp): ditto.

	* eval.c (break_jump): ditto.

	* eval.c (rb_thread_yield_0): remove unused function.

Sun Sep 17 23:44:58 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/rdoc.rb (RDoc::RDoc#document): scan only files modified
	  after the previous generation.

Sun Sep 17 17:42:13 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (install-doc): reverted.

	* instruby.rb: stores file name list without destdir prefix.

	* lib/rdoc/generators/ri_generator.rb: do not chdir twice.

Sun Sep 17 10:42:10 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (fix_mul): fixed typo.  fixed: [ruby-core:08885]

Sat Sep 16 19:47:16 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* README.EXT: should mention new macros: RSTRING_PTR, RSTRING_LEN,
	  RARRAY_PTR, RARRAY_LEN.

	* README.EXT.ja: ditto.

Sat Sep 16 16:39:23 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.in, instruby.rb, ext/extmk.rb, lib/mkmf.rb:
	  use instruby.rb to install extensions instead of ext/extmk.rb.

	* instruby.rb: store installed list into the file.

	* ext/dbm/extconf.rb: allow multiple candidates for dbm-type.

	* ext/io/wait/extconf.rb: suspicious checking_for.

	* ext/pty/pty.c (establishShell): parent pid is not used.

	* ext/pty/pty.c (freeDevice): not used.

	* lib/mkmf.rb (checking_for): improved the messages.

Sat Sep 16 11:03:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (ary_shared_first): should create embedded copies
	  instead of sharing memory region for smaller arrays.

Sat Sep 16 09:37:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (inspect_struct): do not display a class name for
	  anonymous struct.  The member fields are sufficient.

Fri Sep 15 20:22:15 2006  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-8/nkf.c: imported nkf 2.0.8 rev.110.
	  * Fix: check_bom cuts \xfe\xff\xXX\xXX of UTF-32LE.
	  * Add support --ic=UTF-32.
	  * Fix: can't guess UTF-16 and UTF-32.
	  * Fix: can't decode beyond BMP of UTF-16LE.

	* ext/nkf/nkf.c (guess): Support UTF-32.

	* ext/nkf/lib/kconv.rb (kconv): Support UTF-32.

	* ext/nkf/lib/kconv.rb (to_utf32): new method.

Fri Sep 15 05:23:24 2006  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-8/nkf.c: imported nkf 2.0.8 2006-09-15.
	  Add support for U+10000 - U+10FFFF
	  Add support UTF-32

Fri Sep 15 00:03:07 2006  Tanaka Akira  <akr@fsij.org>

	* ext/digest/lib/digest.rb (Digest::Base.file): open a file in binary
	  mode.  suggested by Kazuhiro NISHIYAMA.  [ruby-dev:29579]

Thu Sep 14 17:21:07 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_mul): avoid bignum multiplication as far as
	  possible.  a patch from Ondrej Bilka <neleai at seznam.cz>.
	  [ruby-core:08825]

Thu Sep 14 16:34:55 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_intern): allow zero length symbols.
	  [ruby-core:08861]

Thu Sep 14 16:11:15 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_intern): raise SecurityError only when $SAFE
	  level is greater than zero.  [ruby-core:08862]

	* parse.y (rb_interned_p): new function to check if a string is
	  already interned.

	* string.c (str_to_id): use rb_str_intern().

Thu Sep 14 14:37:45 2006  Tanaka Akira  <akr@fsij.org>

	* ext/digest/lib/digest.rb (Digest::Base.file): new method.
	  [ruby-dev:29572]

Thu Sep 14 08:30:02 2006  Tanaka Akira  <akr@fsij.org>

	* ext/digest/digest.c (rb_digest_base_inspect): new method.
	  [ruby-dev:29573]

Thu Sep 14 01:13:56 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (ruby_init_stack): decrease "stack level too deep" in Windows.
	  [ruby-dev:29569]

Thu Sep 14 01:02:25 2006  Tanaka Akira  <akr@fsij.org>

	* ext/digest/lib/digest.rb: new file.
	  [ruby-dev:28689]

Wed Sep 13 18:43:05 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* README.EXT: English adjustment.  [ruby-core:08851] and
	  [ruby-core:08852]

Wed Sep 13 18:25:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): better here-doc support.
	  a patch from Marshall T. Vandegrift <llasram at gmail.com>.
	  [ruby-core:08804]

Wed Sep 13 16:43:36 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_intern): prohibit interning tainted string.

Wed Sep 13 01:14:02 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#getopts): works with pre-registered
	  options.  [ruby-core:08826]

Tue Sep 12 03:58:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_compare_by_identity): rename Hash#identical to
	  Hash#compare_by_identity.

Mon Sep 11 16:52:37 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_identical): a new method to make a hash to
	  compare keys by their identity.

	* hash.c (rb_hash_identical_p): new method to tell if a hash is
	  identical or not.

	* st.c (st_numcmp, st_numhash): export hash type functions.

Mon Sep 11 11:42:21 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rexml/source.rb (REXML::Source::encoding): should not
	  convert the body twice.  [ruby-core:08828]

	* lib/rexml/encoding.rb (REXML::Encoding::encoding):
	  Encoding#encoding= to return boolean value to tell if the body
	  is really converted or not.

	* lib/rexml/encoding.rb (REXML::Encoding::encoding): Specific
	  conversion library (e.g. rexml/encodings/UTF-16.rb) to have
	  higher preceding.

	* lib/rexml/encodings/UTF-16.rb (REXML::Encoding::decode_utf16):
	  UTF-16#decode_utf16 should work strings without BOM.

Mon Sep 11 07:39:44 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_equal): "sym == str" should compare them as
	  strings.  [ruby-dev:29554]

Sun Sep 10 22:59:43 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (parse_args): remove splat.

Sun Sep 10 20:25:30 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: updated based on date2 3.9.1.

Sun Sep 10 09:41:29 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c: ISPRINT() needs ctype.h

Sun Sep 10 09:19:47 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb: splat parsed arguments.

Tue Jan 10 09:18:03 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_require_safe): prevent extension from loading twice.
	  fixed: [ruby-dev:29523]

Sat Sep  9 23:55:28 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_f_test): test(0) should not have any special
	  meaning.  [ruby-dev:29425]

	* file.c (rb_f_test): properer error message.

Sat Sep  9 14:08:38 2006  Eric Hodel  <drbrain@segment7.net>

	* lib/test/unit/testcase.rb (Test::Unit::TestCase#run): Rescue
	  Exception in Test::Unit::TestCase#run.  [ruby-core:08783]

Sat Sep  9 04:55:59 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pstore.rb: open all in binary mode, and get rid of the quirk of
	  msvcrt.  fixed: [ruby-dev:29518]

Sat Sep  9 04:47:45 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, win32/Makefile.sub (MINIRUBY): append MINIRUBYOPT.

	* mkconfig.rb, ext/extmk.rb, lib/mkmf.rb, win32/mkexports.rb: suppress
	  warnings with $VERBOSE.

	* win32/resource.rb: only file which has more than one icon is DLL.

Fri Sep  8 16:53:30 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_alloc): should allocate a String object, even when
	  asked to allocate a Symbol object.  [ruby-dev:29529]

Fri Sep  8 16:36:27 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/extmk.rb (extmake): follow Array#to_s.

	* lib/mkmf.rb (create_makefile): ditto.

	* win32/resource.rb: ditto.

Fri Sep  8 10:00:12 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cookie.rb (WEBrick::Cookie.parse_set_cookies): new
	  method to parse multiple cookies per Set-Cookie header.
	  Thanks to Aaron Patterson <aaron_patterson at speakeasy.net>.
	  [ruby-core:08802]

Fri Sep  8 08:59:30 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub, win32/configure.bat win32/setup.mak: program
	  name transform.

Fri Sep  8 08:25:39 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb: suppress `assigning void value' warning.

Fri Sep  8 01:16:34 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (Init_Array): #to_s to be an alias to #inspect.
	  [ruby-dev:29520]

	* hash.c (Init_Hash): ditto.

	* lib/mkmf.rb (create_makefile): replace "print array" by
	  "print *array".

	* mkconfig.rb: ditto.

Thu Sep  7 21:02:56 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (nil_to_s): returns the empty string again.
	  [ruby-dev:29520]

Thu Sep  7 23:27:05 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (path_check_0, fpath_check): disable path check on cygwin.
	  [ruby-talk:213074]

Thu Sep  7 02:03:45 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_to_s): adopt new date format using digits
	  e.g. "2006-09-07 02:03:45 +9000".

Thu Sep  7 01:54:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (sym_equal): override.  check equivalence.

Wed Sep  6 13:25:04 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (symbols_i): need to initialize early-created symbols.
	  [ruby-dev:29496]

Wed Sep  6 12:05:19 2006  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (Kconv::toeuc): remove -m0 [ruby-dev:29505]

Tue Sep  5 22:06:43 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/tcltklib.c: use rb_ary_new3() since RARRAY_LEN() is not l-value.

	* ext/tk/tkutil/tkutil.c: use RARRAY_PTR() and RARRAY_LEN() and etc.
	  fixed: [ruby-dev:29473]

Tue Sep  5 06:47:22 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_to_s): variable declaration after an execution
	  statement.

Tue Sep  5 05:49:41 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (path_check_0): check if sticky bit is set on parent
	  directories for executable path.  fixed: [ruby-dev:29415]

Tue Sep  5 05:03:46 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_plus): addition in Fixnum will never overflow
	  long.  a patch from Ondrej Bilka <neleai at seznam.cz>.
	  [ruby-core:08794]

	* numeric.c (fix_minus): ditto.

	* bignum.c (rb_big_pow): eagerly truncate resulting bignum.
	  [ruby-core:08794]

Mon Sep  4 23:15:34 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_to_s): make it conform to RFC2822 date format.
	  [ruby-dev:29467]

Mon Sep  4 21:43:57 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dbm/extconf.rb: create makefile according to the result of check
	  for dbm header.  fixed: [ruby-dev:29445]

Mon Sep  4 21:39:42 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: updated based on date2 3.9.

Mon Sep  4 21:14:20 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_strftime): include nul character.  fixed: [ruby-dev:29422]

Mon Sep  4 16:39:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::out): specify -x option for nkf.

	* lib/cgi.rb (CGI::out): should not convert utf-8 implicitly using
	  NKF.  it is too Japanese centric.

Mon Sep  4 14:23:10 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/dbm/extconf.rb (db_check): remove debug print.

Mon Sep  4 06:46:08 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (rb_id2sym): intern if id is attrset_id.
	  [ruby-dev:29420] [ruby-dev:29447]

Mon Sep  4 01:25:16 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_local_variables): list symbols.

	* struct.c (rb_struct_s_members_m): ditto.

	* variable.c (ivar_i): ditto.

	* variable.c (gvar_i): ditto.

	* variable.c (cv_i): ditto.

Sun Sep  3 20:47:02 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.h (SYMBOL_P): Qnil and Qfalse are not Symbol.

Sun Sep  3 15:32:44 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: get rid of nil.to_s.

Sun Sep  3 06:24:38 2006  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (ruby_connect): sockerrlen should be socklen_t.

Sun Sep  3 04:40:42 2006  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: check arpa/inet.h for ntohs.

	* ext/socket/socket.c: include arpa/inet.h if available.

Sat Sep  2 23:59:58 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (Init_String): undef Symbol#new.

	* struct.c (rb_struct_s_def): wrong symbol detection.

Sat Sep  2 23:59:37 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_to_id): a bug caused by premature optimization.

Sat Sep  2 23:53:28 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (Init_Object): move symbol related code to string.c

	* string.c (Init_String): Symbol as subclass of String.

	* parse.y (rb_intern2): handle symbol as strings.

	* string.c (str_new): substring of symbols are mere strings, not
	  symbols.

Sat Sep  2 23:37:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (struct RArray): embed small arrays.
	  (RARRAY_LEN): defined for accessing array members.
	  (RARRAY_PTR): ditto.

	* array.c: use RARRAY_LEN and RARRAY_PTR.

Sat Sep  2 13:23:01 2006  Tanaka Akira  <akr@fsij.org>

	* common.mk (ia64.o): use the compiler driver to assemble ia64.s
	  to use appropriate ABI.

Sat Sep  2 12:06:35 2006  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/generator.rb (SOAP::SOAPGenerator#encode_tag): do not dump
	  XML attribute which value is nil.  value "" and nil both were dumped
	  as 'attr="value"'.  [ruby-dev:29395]

Sat Sep  2 12:00:32 2006  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb (CSV::IOReader#initialize): use String#[](pos, len)
	  instead of String#[](idx) to check utf BOM.  follows String#[](idx)
	  behavior change of 1.9.

Sat Sep  2 11:47:58 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): should handle when in else clause.  a patch
	  from Eric Hodel <drbrain at segment7.net>.  [ruby-core:08662]

	* parse.y (primary): wrap with NODE_CASE.  [ruby-core:08663]

Fri Sep  1 22:07:04 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (RSTRING_EMBED_LEN_MASK): uses 5 bits to support 64bit
	  environment.  [ruby-dev:29369]

Fri Sep  1 22:02:08 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_resize): should copy embedded string to
	  malloc'ed buffer.  a patch from <nobu at ruby-lang.org> in
	  [ruby-dev:29369].  fixed: [ruby-dev:29368]

	* string.c (rb_str_ord): use %ld specifier since STRING_LEN() is a
	  long.  [ruby-dev:29369]

Fri Sep  1 21:41:12 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (socks_init): typo fixed.  a patch from Sven
	  Klemm <sven at c3d2.de>.  [ruby-core:08770]

Fri Sep  1 14:22:42 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* array.c (rb_ary_shuffle): RDoc fixed.

Fri Sep  1 13:52:57 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/font.rb: TkFont#current_configinfo() doesn't work
	  on Tcl/Tk8.x.

Fri Sep  1 09:32:55 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex::getc): should not push nil into
	  reading buffer (@readed).  reported in
	  <http://jarp.does.notwork.org/diary/200608c.html#200608311>.

Thu Aug 31 23:59:03 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): follow nil.to_s.

Thu Aug 31 20:50:46 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): follow nil.to_s.

	* win32/resource.rb: ditto.

Thu Aug 31 20:21:47 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (search_required): use RSTRING_PTR and RSTRING_STR.

	* file.c (test_identical, rb_file_s_truncate): ditto.

	* io.c (pipe_open, rb_io_reopen): ditto.

	* object.c (nil_plus): ditto.

	* process.c (proc_spawn_n, rb_spawn): ditto.

	* util.c (ruby_add_suffix): ditto.

	* ext/Win32API/Win32API.c (Win32API_initialize): ditto.

	* ext/dl/cptr.c (rb_dlptr_s_to_ptr): ditto.

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_create_ext): ditto.

	* ext/tk/stubs.c, ext/tk/tcltklib.c, ext/tk/tkutil/tkutil.c: ditto.

	* ext/win32ole/win32ole.c (ole_val2olevariantdata): ditto.

Thu Aug 31 18:23:00 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (struct RString): embed small strings.
	  (RSTRING_LEN): defined for accessing string members.
	  (RSTRING_PTR): ditto.

	* string.c: use RSTRING_LEN and RSTRING_PTR.

Thu Aug 31 17:16:19 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): new method.

	* array.c (rb_ary_shuffle): ditto.

	* random.c (genrand_real): ditto.

	* random.c (genrand_int32): export the function.

	* random.c (Init_Random): initialize random seed at the
	  beginning.

Thu Aug 31 13:12:06 2006  why the lucky stiff  <why@ruby-lang.org>

	* eval.c (ruby_init): rename top_cref to ruby_top_cref and export,
	  along with ruby_cref, for use by the sandbox. [ruby-core:08762]

	* node.h: ditto.

Wed Aug 30 12:01:57 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_hash): improve collision.

	* string.c (rb_memhash): new generic function to calculate hash value
	  for memory chunk.

Tue Aug 29 19:10:10 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_s_create): fixed memory leak, based on the patch
	  by Kent Sibilev <ksruby at gmail.com>.  fixed: [ruby-talk:211233]

Mon Aug 28 11:29:46 2006  Eric Hodel  <drbrain@segment7.net>

	* eval.c, parse.y: Revert.
	* ext/.document: Add digest.c.
	* ext/digest/digest.c: Make RDoc show up.
	* ext/io/wait.c: Fix call-seq in RDoc.

Mon Aug 28 08:03:20 2006  Eric Hodel  <drbrain@segment7.net>

	* ext/.document: Add C files with RDoc.
	* ext/digest/digest.c: Convert to RDoc.
	* ext/io/wait.c: ditto.
	* lib/rdoc/parsers/parse_rb.rb: Fix typo.  Submitted by
	  <calamitas at gmail.com>.  [ruby-core:08724]

Mon Aug 28 07:21:47 2006  Eric Hodel  <drbrain@segment7.net>

	* file.c (File#size?): Fix documentation submitted by Rick Ohnemus.
	  ruby-Bugs-5529.  [ruby-core:08725]

Sun Aug 27 21:41:23 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* oniguruma.h: Version 4.4.0

	* regint.h: ditto.

	* regparse.h: ditto.

	* regexec.c: ditto.

	* regcomp.c ditto.

	* regparse.c: ditto.

Sat Aug 26 08:03:03 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: updated based on date2 3.8.2.

Fri Aug 25 21:15:22 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* common.mk: add regint.h and oniguruma.h to dependence.

	* ext/strscan/depend: ditto.

Fri Aug 25 20:35:57 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/wsdl/document/echo.rb: removed.

	* test/wsdl/document/test_rpc.rb: remove echo.rb after test.
	  [ruby-dev:29337]

Fri Aug 25 17:02:06 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_sweep): typo fixed.

Fri Aug 25 16:05:50 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (sym_call): check if the receiver is given.

Fri Aug 25 01:10:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_Integer): Integer(nil) should raise TypeError.
	  [ruby-talk:210205]

	* object.c (nil_to_s): no longer returns empty string but "nil".
	  [ruby-talk:210205]

	* lib/mkmf.rb: avoid COMMON_HEADERS being nil.

Wed Aug 23 00:25:14 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rexml/source.rb (REXML::IOSource#initialize): encoding have to
	  be set with the accessor.  fixed: [ruby-list:42737]

Tue Aug 22 19:21:00 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb: parameter `to_addrs' might be an Array,
	  .flatten is required. [ruby-dev:29316]

Tue Aug 22 18:47:51 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::handle_method):
	  rdoc documents C module methods as instance methods. a patch in
	  [ruby-core:08536].

Tue Aug 22 12:35:57 2006  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (Kconv::RegexpEucjp): fix regexp for
	  euc-jp [ruby-dev:29344]

Sun Aug 20 11:46:52 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (num_step): also return an enumerator object if no block
	  is given.

Sat Aug 19 16:47:51 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (hash2named_arg): accept hash argument
	  of symbol key.

	* test/win32ole/test_win32ole.rb
	  ditto.

Sat Aug 19 11:28:08 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_rename): use errno if set properly.
	  fixed: [ruby-dev:29293]

Fri Aug 18 01:05:57 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::out): specify -m0 to disable MIME decode.  a
	  patch from Fujioka <fuj at rabbix.jp>.  [ruby-dev:29284]

Thu Aug 17 19:15:16 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_stat_[rRwWxX]): check for super user.
	  fixed: [ruby-core:08616]

Thu Aug 17 14:47:06 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: added rdoc by Daniel Berger.  [ruby-core:08177]

Wed Aug 16 17:46:59 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_byte): IO#getc returns one byte string now.
	  fixed: [ruby-dev:29255]

Wed Aug 16 17:22:44 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (pre-install-local): remove unnecessary code.
	  [ruby-dev:29249]

Wed Aug 16 11:45:36 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_setuid, proc_setgid, proc_seteuid, proc_setegid):
	  get rid of bogus implementations on Mac OS X.

Wed Aug 16 11:09:26 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (set_arg0): fill argv other than the first with an empty
	  string instead of NULL.

Tue Aug 15 11:21:08 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb: support SMTP/SSL.  Thanks Kazuhiro NISHIYAMA.

	* lib/net/smtp.rb: new method SMTP.use_ssl?

	* lib/net/smtp.rb: new method SMTP.enable_ssl.

	* lib/net/smtp.rb: new method SMTP.disable_ssl.

	* lib/net/smtp.rb: new method SMTP.default_ssl_port.

	* lib/net/smtp.rb: new method SMTP.default_tls_port.

	* lib/net/smtp.rb: now SMTP#enable_tls accepts a SSLContext
	  object, instead of a verity and cert.  [FEATURE CHANGE]

	* lib/net/smtp.rb: new method SMTP.ssl_context.

	* lib/net/smtp.rb: new method SMTP.default_ssl_context.

	* lib/net/smtp.rb: export SMTP.authenticate.

	* lib/net/smtp.rb: export SMTP.auth_plain.

	* lib/net/smtp.rb: export SMTP.auth_login.

	* lib/net/smtp.rb: export SMTP.auth_cram_md5.

	* lib/net/smtp.rb: export SMTP.starttls.

	* lib/net/smtp.rb: export SMTP.helo.

	* lib/net/smtp.rb: export SMTP.ehlo.

	* lib/net/smtp.rb: export SMTP.mailfrom.

	* lib/net/smtp.rb: export SMTP.rcptto.

	* lib/net/smtp.rb: export SMTP.rcptto_list.

	* lib/net/smtp.rb: export SMTP.data.

	* lib/net/smtp.rb: export SMTP.quit.

Sat Aug 12 22:33:06 2006  Eric Hodel  <drbrain@segment7.net>

	* string.c (String#split): Describe grouping behavior.  Patch by Jan
	  Svitok <jan.svitok at gmail.com>.  [ruby-core:08603]

Sun Aug 13 12:08:02 2006  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c: ANSIfied.  [ruby-core:08601]

Sat Aug 12 15:55:32 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, bcc32/Makefile.sub, win32/Makefile.sub, win32/dir.h,
	  win32/win32.c, win32/win32.h: large file support for win32.

Fri Aug 11 15:39:25 2006  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser#find_body): Make RDoc
	  ignore C function prototypes.  Patch by Tilman Sauerbeck
	  <tilman at code-monkey.de>.  [ruby-core:8574]
	* lib/yaml/tag.rb: Replace nodoc with stopdoc so Module methods get
	  documented.

Wed Aug  9 16:53:28 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/smtp.rb (Net::SMTP::auth_cram_md5): use ord to retrieve
	  bytes from strings.  a patch from WATANABE Tetsuya
	  <Tetsuya.WATANABE at nifty.com>.  [ruby-dev:29240]

Tue Aug  8 23:49:06 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/extend-command.rb (IRB::ExtendCommandBundle): pacify
	  RDoc.  a patch from Eric Hodel <drbrain at segment7.net>.
	  [ruby-core:08522]

Tue Aug  8 19:26:10 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/resolv.rb (Resolv::DNS::Message::MessageDecoder::get_string):
	  affected by str[0] returns 1 char string.  [ruby-dev:29223]

	* lib/resolv.rb (Resolv::DNS::Message::MessageDecoder::get_labels):
	  ditto.

Tue Aug  8 12:28:43 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (arg): allow newlines before ternary colon.  [ruby-dev:29189]

Mon Aug  7 17:56:59 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c, ext/digest/rmd160/rmd160ossl.c,
	  ext/digest/sha1/sha1ossl.c, ext/readline/readline.c: move
	  inclusion of config.h to pacify AIX.  a patch from Yutaka
	  Kanemoto <kinpoco at gmail.com>.  [ruby-dev:29197]

Mon Aug  7 15:55:08 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/syck.c (syck_move_tokens): should avoid negative
	  memmove.  [ruby-list:42625]

Mon Aug  7 14:37:48 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in, common.mk: AIX link issue.  a patch from Yutaka
	  Kanemoto <kinpoco at gmail.com>.  [ruby-dev:29190]

	* ext/socket/socket.c: AIX socket support.  [ruby-dev:29190]

Mon Aug  7 12:05:28 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dln.c, eval.c, gc.c, ruby.h: shut up AIX alloca warning.
	  a patch from Yutaka Kanemoto <kinpoco at gmail.com>.
	  [ruby-dev:29191]

Sun Aug  6 20:34:24 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (str[fp]time): %[EO]U didn't denote %U.

Sun Aug  6 17:12:12 2006  Tanaka Akira  <akr@fsij.org>

	* io.c (io_reopen): STDERR.reopen(open("/dev/tty", "w")) should not
	  clear FMODE_PREP in STDERR.

Sat Aug  5 22:53:41 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* oniguruma.h: Version 4.2.2

	* regint.h: ditto.

	* regparse.h: ditto.

	* regexec.c: ditto.

	* regcomp.c ditto.

	* regerror.c: ditto.

	* regparse.c: ditto.

Sat Aug  5 17:07:43 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (top_local_setup): local_vars[-1] should point
	  ruby_scope itself to protect local_tbl from garbage collection.
	  [ruby-dev:29049]

Sat Aug  5 13:49:43 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb (str[fp]time): "%\n" means "\n".

Fri Aug  4 12:13:22 2006  Eric Hodel  <drbrain@segment7.net>

	* lib: Clean up files for RDoc.
	* lib/.document: Include most of the standard library in RDoc
	  generation.
	* lib/rdoc/ri/ri_formatter.rb: Don't unescape HTML in HtmlFormatter.
	  Submitted by <ksruby at gmail.com>.  [ruby-core:08392].
	* lib/drb/ssl.rb: Close socket on SSLError [ruby-core:7197]

Fri Aug  4 18:59:49 2006  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/{init.rb,ruby-lex.rb,slex.rb}: can't input '\c' for
	  [ruby-core: 7122]. and support for ruby1.8.X

Fri Aug  4 14:02:14 2006  James Edward Gray II  <james@grayproductions.net>

	* lib/date/format.rb (__strptime, strftime): allow multi-line patterns
	  in Date#strftime the same as Time#strftime accepts.
	  fixed: [ruby-core:08466]

Fri Aug  4 13:56:51 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_pack): check argument overrun for 'P'.  based on a
	  patch by rucila <rucila at yahoo.cojp>.  fixed: [ruby-dev:29182]

Fri Aug  4 02:42:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): a bug in %c type check.

Fri Aug  4 01:28:19 2006  Tanaka Akira  <akr@fsij.org>

	* io.c (io_reopen): STDERR.reopen(File.open("/dev/null", "w")) should
	  not fclose stderr.

Thu Aug  3 15:16:44 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_include): should always call Enumerable#include?
	  (not #===) for non numeric end points.  [ruby-core:08477]
	  [ruby-core:08496]

Mon Jul 31 16:51:40 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (exit_handler): new function; release winsock and
	  environment work area.

	* win32/win32.c (NTInitialize): setup exit_handler.

	* win32/win32.c (StartSockets): use exit_handler.

	* win32/win32.c (rb_w32_getenv): use GetEnvironmentStrings() instead
	  of GetEnvironmentVariable(), because the latter cannot distinguish
	  whether a null environment variable exists or not.
	  fixed: [ruby-talk:205123]

Mon Jul 31 16:15:13 2006  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_process.rb (TestProcess#test_rlimit_nofile):
	  setrlimit may fail with EINVAL.
	  reported by MIYAMUKO Katsuyuki.  [ruby-dev:29174]

Mon Jul 31 09:22:12 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h: use ifdef (or defined) for macro constants that may or
	  may not be defined to shut up gcc's -Wundef warnings.
	  [ruby-core:08447]

Mon Jul 31 13:38:13 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPReuqest#parse_uri): improve
	  for the value of IPv6 address in the Host: header field.

Sun Jul 30 23:26:12 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_call0): trace call/return of method defined from block.
	  fixed: [ruby-core:08329]

	* eval.c (rb_trap_eval): make the current thread runnable to deal with
	  exceptions which occurred within the trap.  fixed: [ruby-dev:27729]

	* lib/cgi/session.rb, lib/cgi/session/pstore.rb: suppress warnings.
	  fixed: [ruby-talk:204896]

Sat Jul 29 06:12:06 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: freeze ip_name for security reason.

Sat Jul 29 01:23:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/logger.rb: improves the amount of documentation that Rdoc
	  picks up when processing logger.rb by moving the require
	  statement back before the comment block.  a patch from Hugh
	  Sasse <hgs at dmu.ac.uk>.  [ruby-core:08422]

Fri Jul 28 17:18:03 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/curses/curses.c (NUM2CH, CH2FIX): use single char strings.

Fri Jul 28 14:09:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call): fixed typo in cache look-up.  [ruby-dev:29167]

Fri Jul 28 10:41:35 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call): a bug in method cache look-up.
	  http://www.rubyist.net/~matz/20060720.html#c04

Fri Jul 28 10:19:28 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): documentation update patch from Jacob
	  Fugal <lukfugl at gmail.com>.  [ruby-core:08418]

Fri Jul 28 09:41:45 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_to_s): fixed typo.  [ruby-dev:29162]

Fri Jul 28 00:26:47 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* math.c (domain_check): ANSI style function arguments

	* math.c (math_log): too few argument to domain_check().

Thu Jul 27 21:19:54 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* math.c (domain_check): a new function to check domain error
	  explicitly for systems that return NaN like FreeBSD.
	  [ruby-core:07019]

	* math.c (math_acos, math_asin, math_acosh, math_atanh, math_log,
	  math_log10, math_sqrt): use domain_check().

	* math.c (math_sqrt): fix documentation flaw.

Thu Jul 27 22:21:52 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_to_s): fixed format mismatch.

Thu Jul 27 18:12:12 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* time.c: need to declare time_utc_offset.

Thu Jul 27 17:01:01 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_close): always calls "close" method of the receiver.
	  [ruby-core:6911] [ruby-core:8112]

Thu Jul 27 16:41:15 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/openssl/ossl.h: move <ruby.h> inclusion point to shut up
	  Solaris compiler.  [ruby-core:08114]

	* time.c (time_to_s): use +0900 style timezone string for local time.
	  [ruby-dev:29143]

Wed Jul 26 22:20:59 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: add support for as and ASFLAGS.  [ruby-dev:29138]

Wed Jul 26 21:59:33 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (Net::HTTP#post, request_post, request): should
	  set Content-Type: x-www-form-urlencoded by default.

	* lib/net/http.rb (Net::HTTPHeader#content_type): should return
	  nil when there's no Content-Type.

	* lib/net/http.rb (Net::HTTPHeader#sub_type): should return nil
	  when there's no sub Content-Type (e.g. "Content-Type: text").

	* lib/net/http.rb (Net::HTTPHeader#type_params): wrongly failed
	  when there's no Content-Type.

Wed Jul 26 18:38:13 2006  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c (strscan_do_scan): always return nil if
	  p->curr exceeds string size.

Wed Jul 26 18:33:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_eval): rename #invoke_method and
	  #invoke_functional_method to __send and __send! respectively.

	* eval.c (remove_method): prohibit removing __send and __send!.

	* eval.c (rb_undef): prohibit undef'ing  __send and __send!.

	* eval.c (rb_eval): prohibit redefining  __send and __send!.

	* lib/delegate.rb (Delegator): preserve __send.

Wed Jul 26 18:14:19 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (getDevice): retry once after GC on failure.
	  [ruby-core:08282]

Wed Jul 26 17:43:20 2006  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c (strscan_do_scan):
	  StringScanner.new("").scan(//) should return "". [ruby-Bugs:4361]

Wed Jul 26 17:28:16 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_str_format): prepend ".." to %u for negative bignum,
	  but not "-".  fixed: [ruby-core:08167]

Wed Jul 26 16:39:07 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_scan): add string modification check.
	  [ruby-core:7216]

Wed Jul 26 16:06:03 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension::read_multipart): check
	  multipart boundary end.  a patch from Fujioka <fuj at rabbix.jp>
	  [ruby-dev:28470]

Wed Jul 26 01:02:59 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: suppress warnings by automake 1.8 or later.

Tue Jul 25 14:46:14 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (configuration): typo.

Tue Jul 25 13:14:32 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (rb_proc_times): rename hz to hertz to avoid name
	  crash on AIX.  [ruby-dev:29126]

Mon Jul 24 22:03:40 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (backtrace): skip frames successive on node and method name.

Mon Jul 24 15:51:52 2006  Tanaka Akira  <akr@fsij.org>

	* ext/readline/readline.c (readline_readline): rl_deprep_term_function
	  may be NULL with libedit.  reported by Ryan Davis.  [ruby-dev:29070]

Mon Jul 24 15:19:55 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): revert last change.  [ruby-dev:29112]
	  [ruby-core:08374]

Sun Jul 23 22:59:49 2006  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_unix.rb: disabled on cygwin.
	  reported by Kouhei Yanagita.  [ruby-dev:29080]

Fri Jul 21 23:57:26 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): script is never used while recursing.

Fri Jul 21 21:21:08 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_call0): include funcalled methods in caller list.
	  fixed: [ruby-core:08290]

Fri Jul 21 17:52:24 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): "9_e8" should consider "_e8" as
	  trailing garbage so that it should return 9.0.  [ruby-dev:29088]

Fri Jul 21 12:11:00 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb, lib/mkmf.rb (with_destdir): remove drive letter before
	  prepending destdir on DOSISH.

Fri Jul 21 04:17:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call): try local method look-up first for fcall, then
	  normal method look-up.  [ruby-talk:202564]

	* eval.c (rb_get_method_body): save local method cache separately.

	* eval.c (search_method): export info whether method is local or
	  not.

Thu Jul 20 20:27:07 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_mod_attr): make Module#attr to be an alias to
	  attr_reader.  [RCR#331]

Thu Jul 20 15:07:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h: export classes/modules to implement sandbox.
	  [ruby-core:08283]

Wed Jul 19 19:40:00 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_yield_0): should check args_args before lambda
	  argument check.  [ruby-dev:29029]

Tue Jul 18 23:53:59 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (rb_f_system): shouldn't block SIGCHLD if it's not
	  exist.

Tue Jul 18 22:10:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (rb_f_system): block SIGCHLD during the process
	  execution, like glibc system(3) does.  [ruby-talk:202361]

Tue Jul 18 23:10:43 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (open_ifs_socket): should not use plain malloc.

	* win32/win32.c (rb_w32_opendir): should not use plain realloc.

Tue Jul 18 18:05:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_float.rb (TestFloat::test_strtod): update test to
	  conform strtod change.

Tue Jul 18 16:52:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (yield_under_i): argument should be passed in avalue
	  form.  [ruby-dev:29044]

Tue Jul 18 15:49:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_unpack): propagate association array to copied
	  string.  [ruby-core:08223]

	* pack.c (pack_unpack): return referenced string itself if it has
	  same length as specified.  a patch from <nobu at ruby-lang.org>
	  in [ruby-core:08225].

	* pack.c (pack_pack): taint 'p' packed strings.

Tue Jul 18 15:19:07 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* intern.h (st_foreach_safe): fix prototype.

	* node.h (NODE_LMASK): bigger than long on LLP64.

	* missing/vsnprintf.c (BSD__uqtoa): new function to support LLP64.
	  all changes are derived from [ruby-dev:29045]

Tue Jul 18 14:03:02 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer::unmount): remove
	  inpect argument from sprintf.  [ruby-dev:29039]

Tue Jul 18 10:53:37 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): limit out-of-range message.

	* util.c (ruby_strtod): return end pointer even if ERANGE occurred.
	  fixed: [ruby-dev:29041]

Mon Jul 18 00:43:05 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strtod): stop at dot not followed by digits.
	  fixed: [ruby-dev:29036]

Tue Jul 18 00:01:27 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: remove LIBRUBY_SO if static linked extensions exist.

Mon Jul 17 23:30:46 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_msvcrt): defaulted to msvcrt.  Workaround for a
	  bug of cygwin 1.5.20.

Mon Jul 17 22:55:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/io/wait/wait.c (io_ready_p): protoize.

Mon Jul 17 13:43:05 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (define_swapx): should not use plain malloc.

	* ext/curses/curses.c (curses_getmouse): ditto.

Mon Jul 17 12:58:41 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: should use ac_cv_lib_dl_dlopen=no on MinGW.

Mon Jul 17 11:47:35 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* st.c: still need to include config.h on some platforms.

Sat Jul 15 01:09:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* st.c (malloc): use xmalloc/xcalloc instead of plain
	  malloc/calloc, to detect memory allocation failure.  see
	  <http://www.nongnu.org/failmalloc/>.

Fri Jul 14 13:08:13 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: add methods for new features of latest Tcl/Tk8.5.

	* ext/tk/lib/tk/namespace.rb: ditto.

Fri Jul 14 02:30:12 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/monitor.rb: document patch from Hugh Sasse <hgs at dmu.ac.uk>.
	  [ruby-core:08205]

Fri Jul 14 00:10:15 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_pop): may cause realloc oscillation.  a patch
	  from MORITA Naoyuki <mlgetter at kidou.sakura.ne.jp>.
	  [ruby-dev:29028]

Thu Jul 13 22:23:56 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/composite.rb: improve handling of the classname on the
	  option database for the widget class which includes TkComposite.

Thu Jul 13 00:40:57 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (FIX2LONG): returns integer of size of VALUE.
	  [ruby-dev:29024]

	* ruby.h (FIX2ULONG): ditto.

Wed Jul 12 20:05:23 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_args): allow post mandatory arguments after optional
	  arguments.  [ruby-dev:29014]

	* parse.y (new_args_gen): allow post_args without rest_args.

	* eval.c (formal_assign): ditto.

	* parse.y (new_args_gen): check post argument duplication.

Tue Jul 11 20:58:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h: export rb_cMethod.  [ruby-talk:201259]

Tue Jul 11 19:13:33 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: remove restriction on the class of
	  pseudo-toplevel.

Tue Jul 11 18:00:57 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: security fix.

Tue Jul 11 17:28:08 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* string.c (rb_str_dump): need to extend len for \b.

Tue Jul 11 15:29:15 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_int2big): use SIGNED_VALUE.  [ruby-dev:29019]

	* bignum.c (rb_int2inum, rb_uint2inum): use VALUE sized integer.

	* bignum.c (rb_big2long, rb_big2ulong): ditto.

	* numeric.c (rb_num2long, rb_num2ulong): ditto.

	* numeric.c (check_int, check_uint): ditto.

	* bignum.c (rb_quad_pack): typo fixed.

Tue Jul 11 13:40:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bignorm): sizeof(long) may be smaller than
	  sizeof(VALUE).  [ruby-dev:29013]

	* ruby.h (FIXNUM_MAX): fixnum may be bigger than long.

	* ruby.h (SIGNED_VALUE): signed integer of size of VALUE.

Mon Jul 10 23:37:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/soap/rpc/proxy.rb (Proxy::Operation::response_doc): remove
	  splat star from return statements.

	* lib/soap/rpc/proxy.rb (Proxy::Operation::response_obj): retrieve
	  the first value from the result array if response has only one
	  value.

Mon Jul 10 22:00:00 2006  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c: Allows '_' to appear within
	  digits.  [ruby-dev:28872]

	* ext/bigdecimal/lib/bigdecimal/util.rb: Bug in to_r reported by
	  [ruby-list:42533] fixed.

Mon Jul 10 19:22:19 2006  Tanaka Akira  <akr@fsij.org>

	* gc.c (gc_sweep): expand heap earlier.
	  reported by MORITA Naoyuki.  [ruby-dev:28960]

Mon Jul 10 18:59:34 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/font.rb: sorry. mistaken to patch.

Mon Jul 10 18:46:52 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: make SEGV risk lower at exit.

	* ext/tk/lib/tk.rb: ditto.

	* ext/tk/lib/multi-tk.rb: fail to call function-style methods on slave
	  interpreters. The strategy (MultiTkIp_PseudoToplevel_Evaluable) to
	  fix the problem is a little tricky. You may have to take care of
	  conflicting with it.

	* ext/tk/lib/tk.rb: a little change for the pseudo-toplevel strategy.

	* ext/tk/lib/tk/font.rb: ditto.

	* ext/tk/lib/tk/msgcat.rb: ditto.

	* ext/tk/lib/tkextlib/itk/incr_tk.rb: ditto.

	* ext/tk/sample/demos-en/widget: fail to call function-style methods
	  on sample scripts. To fix it, a strategy which similar to the way
	  on MultiTiIp is used. Please take care when re-write and re-run a
	  demo script on the Widget-Demo code viewer.

	* ext/tk/sample/demos-jp/widget: ditto.

Mon Jul 10 17:32:38 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/test.rb: update test suites.

	* test/ruby/test_assignment.rb (TestAssignment::test_yield): ditto.

	* test/ruby/test_iterator.rb (TestIterator::test_itertest): ditto.

Mon Jul 10 14:43:47 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call): remove erroneously restored prot_tag->blkid
	  initialization.  [ruby-dev:28997]  [ruby-dev:29000]

Mon Jul 10 13:58:08 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* signal.c (install_nativethread_sighandler): commented out.

Mon Jul 10 09:29:12 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_clear_cache_for_remove): clear entries for included
	  module.  fixed: [ruby-core:08180]

Mon Jul 10 02:22:58 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): should not overwrite block information in
	  current frame.  [ruby-dev:28957]

	* eval.c (rb_yield_0): retrieve proper block object from the frame
	  record.

	* eval.c (proc_alloc): return preserved block object if it's
	  available.

Mon Jul 10 01:48:38 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* st.h (st_data_t): use pointer sized integer for st_data_t.
	  [ruby-dev:28988]

Sun Jul  9 18:06:47 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_constant): fix for value 1 at cross compiling.

	* lib/mkmf.rb (create_makefile): prevent substitution of macro
	  definition.  fixed: http://www.yotabanana.com/lab/20060624.html#p02

Sun Jul  9 07:58:48 2006  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rdoc/parsers/parse_f95.rb: massive overhaul from Yasuhiro
	  Morikawa including new file suffixes, function support, public
	  variables and constants, derived-types, defined operators and
	  assignments, namelists, and subroutine and function
	  arguments. Truly massive.

	* lib/rdoc/diagram.rb: diagrams are now cached.

	* lib/irb/completion.rb: fixed a crasher when completing against
	  an unnamed class/module.

	* lib/rdoc/parsers/parse_c.rb: private comment (--/++) support in
	  C-file rdoc.

	* lib/debug.rb: minor clarification in help.

	* lib/pp.rb: minor clarification on exception.

Sun Jul  9 00:54:11 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (next_jump): deal with destination of next.
	  fixed: [ruby-core:08169]

Fri Jul  7 17:49:16 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_ord): extract lower byte.  fixed: [ruby-dev:28980]

	* lib/jcode.rb (String#succ!): fix for 1.9.  fixed: [ruby-dev:28979]

Fri Jul  7 14:05:03 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): define FUNC_STDCALL/FUNC_CDECL.
	  from [ruby-dev:28970].

Fri Jul  7 00:38:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_default): should not call default procedure if
	  no key is given.  [ruby-list:42541]

Thu Jul  6 23:30:04 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_proc_times): use sysconf(_SC_CLK_TCK) value prior to
	  HZ and CLK_TCK.  fixed: [ruby-talk:200293]

Thu Jul  6 21:50:06 2006  Minero Aoki  <aamine@loveruby.net>

	* ext/racc/cparse/cparse.c: sync with original code, rev 1.8.

	* ext/racc/cparse/cparse.c: should mark CparseParams objects.

	* lib/racc/parser.rb: sync with original code, rev 1.8.

	* lib/racc/parser.rb: update coding style.

Wed Jul  5 05:28:45 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (block_param): should allow block argument after splat
	  and post splat args.

Wed Jul  5 01:12:19 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/ruby/test_lambda.rb (TestLambdaParameters::test_lambda_as_iterator):
	  -> style block no longer available.  [ruby-dev:28958]

Tue Jul  4 21:48:56 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (proc_options): suppress warning on DOSISH.

Tue Jul  4 15:12:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call): should not set prot_tag->blkid since it would
	  never catch breaks at this level.  [ruby-dev:28922]

Tue Jul  4 04:48:36 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c: ruby 1.9 HEAD 64 bit warnings clean up from
	  <ville.mattila at stonesoft.com>.   [ruby-core:08120]

Mon Jul  3 19:04:38 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_make_menu_embeddable): help to make a menu
	  widget embeddable (pack, grid, and so on) like as a general widget.
	  However, an embeddable menu may require to be defined some event
	  bindings for general use.

	* ext/tk/lib/tk/event.rb: [bug fix] Tk.callback_break and
	  Tk.callback_continue don't work on MultiTkIp.

	* ext/tk/lib/multi-tk.rb: ditto.

	* ext/tk/lib/tk.rb: lack of Tk.callback_return.

	* ext/tk/lib/tk/menu.rb: improve creating clone menus.

Mon Jul  3 14:42:06 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/extconf.rb (PW_UID2VAL, PW_GID2VAL): defaulted to conversion
	  from int, and sys/types.h needs to be included before grp.h.
	  fixed: [ruby-dev:28938]

Mon Jul  3 10:44:01 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (popen_exec): close file descriptors other than standard I/Os.
	  fixed: [ruby-dev:28924]

Mon Jul  3 05:15:29 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/openssl/test_asn1.c: String#[]= doesn't accept Integer.

Mon Jul  3 01:14:15 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_inspect): encode \b (\010) for escape.
	  [ruby-dev:28927]

	* string.c (rb_str_dump): ditto.

Sun Jul  2 19:03:30 2006  Minero Aoki  <aamine@loveruby.net>

	* ext/racc/cparse/cparse.c: sync with original code, rev 1.7.

	* ext/racc/cparse/cparse.c: must require version.h to get
	  RUBY_VERSION_CODE.

Sun Jul  2 18:42:27 2006  Minero Aoki  <aamine@loveruby.net>

	* ext/racc/cparse/cparse.c: sync with original source code, rev
	  1.6.

	* ext/racc/cparse/cparse.c: do not use rb_iterate to give a block
	  to the method, use rb_block_call instead. [ruby-dev:28445]

Sun Jul  2 11:22:03 2006  Tanaka Akira  <akr@m17n.org>

	* io.c (io_reopen): STDOUT.reopen(filename, "w+") didn't work.
	  (rb_io_reopen): STDOUT.reopen(File.open(filename, "w+")) didn't work.

Sat Jul  1 23:55:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (PUSH_FRAME): initialize frame->self.  [ruby-dev:28911]

Sat Jul  1 17:00:42 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/webrick/utils.rb: use Proc#yield instead of Proc#call.
	  [ruby-dev:28914]

Sat Jul  1 15:15:49 2006  Tanaka Akira  <akr@m17n.org>

	* test/socket/test_nonblock.rb: add timeout to send/receive
	  an empty UDP packet.
	  [ruby-dev:28820]

Fri Jun 30 23:46:23 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: should test isinf for Solaris with GCC compiler.
	  a patch from <ville.mattila at stonesoft.com>.  [ruby-core:07791]

	* configure.in: -shared patch from Andrew Morrow
	  <andrew.c.morrow at gmail.com>.  [ruby-core:08100]

Fri Jun 30 19:35:41 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils._escape): should
	  use String#ord to get ascii code from the one-character string.
	  [ruby-dev:28901]

Thu Jun 29 23:56:01 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_mark_children): a bug in NODE_BLOCK_PASS marking.
	  [ruby-dev:28908]

Thu Jun 29 23:04:36 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: use ARGSPUSH instead of ARGSCAT to prevent too much
	  splat expansion.

	* eval.c (when_check): need to handle ARGSPUSH as well.

	* eval.c (block_orphan): lambda and proc from method are always
	  orphan.

	* gc.c (gc_mark_children): proper marking for NODE_LAMBDA.

Thu Jun 29 22:47:30 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (SETUP_ARGS0): avoid GC problem.
	  [ruby-dev:28902]

Thu Jun 29 18:58:51 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_version): fix patch
	  failure.

Thu Jun 29 18:00:51 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c: add RDoc document.  a patch from
	  mathew <meta at pobox.com>.   [ruby-core:07050]

Wed Jun 28 14:53:09 2006  Eric Hodel  <drbrain@segment7.net>

	* lib/optparse.rb: RDoc patch from Robin Stocker <robin@nibor.org>
	  [ruby-core:08087]

Wed Jun 28 23:23:48 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): underscores should appear only
	  between digits.  [ruby-dev:28891]

Wed Jun 28 19:04:34 2006  Tanaka Akira  <akr@m17n.org>

	* test/socket/test_unix.rb: test_seqpacket_pair removed.
	  [ruby-dev:28846]

Wed Jun 28 13:51:21 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (when_check): arbitrary values are allowed after splats.
	  fixed: [ruby-dev:28879]

Wed Jun 28 09:16:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (primary): remove meaningless else-only case statement
	  syntax.

Wed Jun 28 08:08:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): problem to handle else part.  [ruby-dev:28873]

Wed Jun 28 01:48:23 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): support splat in when expression list.
	  [ruby-dev:28822]

	* eval.c (when_check): a new auxiliary function for case match.

	* eval.c (when_cond): ditto.

Wed Jun 28 01:05:37 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_cstr_to_dbl): should not skip '_' at the beginning
	  of a string.  [ruby-dev:28830]

	* bignum.c (rb_cstr_to_inum): ditto.

Tue Jun 27 23:03:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c: RDoc update for =~ method.  a patch from Alex Young
	  <alex at blackkettle.org>.  [ruby-core:08068]

Tue Jun 27 22:47:18 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: forgot to update TCLTKLIB_RELEASE_DATE.

	* ext/tk/lib/tk.rb (tk_tcl2ruby): [bug fix] sometimes fail to convert
	  a tcl string to a ruby object if the tcl string includes "\n".

Tue Jun 27 20:05:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (pipe_open): backout unnecessary fix on 2006-06-26.
	  [ruby-dev:28865]

	* eval.c (rb_yield_0): exact argument number check now done only
	  for lambda Proc.

	* eval.c (rb_yield_0): add check for number of arguments, if
	  there's one lambda block parameter.

Tue Jun 27 16:04:05 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* win32/win32.h: define isascii on MinGW for msvcrt compatibility.

	* configure.in: set ac_cv_header_sys_time_h=no on MinGW
	  for msvcrt compatibility.

Tue Jun 27 11:36:02 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (setup_passwd, setup_group): allow bignum uid, gid and
	  so on.  [ruby-talk:199102]

Tue Jun 27 10:46:53 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (rb_yield_0): avoid core dump.  [ruby-dev:28840]

Mon Jun 26 11:03:00 2006  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/ri: Add options to limit the ri search path.

Tue Jun 27 01:31:59 2006  Tanaka Akira  <akr@m17n.org>

	* ext/socket/socket.c (bsock_recv_nonblock): new method
	  BasicSocket#recv_nonblock.
	  (udp_recvfrom_nonblock): renamed from ip_recvfrom_nonblock.
	  IPSocket#recvfrom_nonblock is moved to UDPSocket#recvfrom_nonblock.
	  (unix_recvfrom_nonblock): removed.
	  UNIXSocket#recvfrom_nonblock is removed.

Tue Jun 27 00:52:40 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/eventids2.c (token_assoc): added tCHAR, which is not
	  under 256 now.  fixed: [ruby-dev:28832]

Mon Jun 26 23:42:57 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (call_trace_func): no check for argument number of the
	  callback.  fixed: [ruby-dev:28812]

Mon Jun 26 18:37:44 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_delete): fix SEGV when a slave-ip is
	  deleted on callback.

Mon Jun 26 15:40:26 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_accept): revert to avoid ambiguity of
	  argument evaluation order.  [ruby-dev:28861]

	* ext/socket/socket.c (sock_accept_nonblock): ditto.

Mon Jun 26 10:47:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (pipe_open): avoid closing uninitialized file descriptors.
	  a patch from <tommy at tmtm.org> [ruby-dev:28600]

Sun Jun 25 23:02:12 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, mkconfig.rb: catch-up for latest autoconf.

Sun Jun 25 17:44:16 2006  Tanaka Akira  <akr@m17n.org>

	* parse.y (paren_args): wrap $2 by escape_Qundef because it may be
	  Qundef.  [ruby-dev:28843]

Sun Jun 25 17:18:33 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c(ole_invoke): support some kind of
	  method of word. [ruby-Bugs#3237]

	* test/win32ole/test_word.rb: ditto.

Sat Jun 24 23:48:08 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: replace terminal token names with more descriptive
	  name, i.e. kEND to keyword_end.  [ruby-list:42477]

Sat Jun 24 23:37:41 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (rb_eval): use rb_ary_new2 instead of rb_ary_new4 to avoid
	  GC problem.
	  (rb_yield_values): use rb_ary_new2 instead of rb_ary_new4.

	* array.c (rb_ary_new4): don't set len as n if contents is not
	  initialized.  make it safe with GC.

	  [ruby-dev:28826]

Fri Jun 23 23:35:32 2006  Tanaka Akira  <akr@m17n.org>

	* ruby.h, lib/drb/drb.rb, lib/drb/invokemethod.rb: remove Values class.
	  [ruby-dev:28805]

Fri Jun 23 17:27:52 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_block_pass): removed.

	* eval.c (rb_thread_start_1): use rb_proc_yield() instead of
	  rb_block_pass().  fixed: [ruby-dev:28794]

Thu Jun 22 11:52:02 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPResponse): duplicated error 501;
	  HTTPInternalServerError should be error 500.  [ruby-core:08037]

Thu Jun 22 11:47:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_mod_name): returns nil for anonymous modules.
	  [ruby-talk:198440]

Thu Jun 22 10:31:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_aref): "abc"[3] should not return an empty
	  string but nil.  [ruby-dev:28786]

Thu Jun 22 05:15:58 2006  Tanaka Akira  <akr@m17n.org>

	* ext/socket/socket.c (sock_s_socketpair): try GC only once.
	  [ruby-dev:28778]

Wed Jun 21 21:20:31 2006  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (jd_to_commercial): now works fine even if in
	  mathn-ized context.

Wed Jun 21 17:29:57 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/getaddrinfo.c (freeaddrinfo, get_name): fixed typo.

	* ext/tk/tcltklib.c (tcl_eval, tcl_global_eval): ditto.

	* ext/zlib/zlib.c (rscheck): constified.

Wed Jun 21 17:18:55 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/pp.rb (PP::PPMethods::seplist): should have preserved
	  original reference to the array.  [ruby-dev:28747]

Wed Jun 21 14:35:06 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (block_param): do not use multiple assignment for a sole
	  block parameter.  [ruby-dev:28710]

	* eval.c (rb_yield_0): pass a raw yielded value to a sole block
	  parameter if a value is passed by yield.

	* eval.c (proc_invoke): args may not be an array.

	* eval.c (rb_proc_yield): pass original value without wrapping
	  it in an array.

Wed Jun 21 14:06:47 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (method_call): remove (fn)(args) style lambda
	  invocation, add fn.(args) instead.

Wed Jun 21 08:39:54 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/xmlrpc/create.rb (XMLRPC::Create::conv2value): merge Date
	  and Time processing.  [ruby-core:08033]

Wed Jun 21 03:01:10 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c, file.c, etc.: code-cleanup patch from Stefan Huehner
	  <stefan at huehner.org>.  [ruby-core:08029]

Wed Jun 21 01:40:25 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (reswords): modifier token is no longer returned in fname
	  state.  fixed: [ruby-dev:28775]

Tue Jun 20 23:28:34 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (parse_args): provisional catch-up for the recent changes.

	* lib/optparse.rb (OptionParser::List#summarize, OptionParser#order!): ditto.

Tue Jun 20 11:07:55 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): intercept break and return from lambda
	  Proc objects.  [ruby-dev:28742]

	* eval.c (proc_invoke): remove unnecessary YIELD_PROC_CALL flag.

	* eval.c (YIELD_EXACT_ARGS): renamed from YIELD_LAMBDA_CALL, which
	  is no longer related to the behavior turned on by this flag.

	* eval.c (return_jump): no need to care about PROT_YIELD.

	* eval.c (break_jump): no jump to toplevel PROT_THREAD tag.

	* eval.c (rb_yield_0): fix confusion between lambda (which is a
	  property of a proc) and pcall (which depends on whether it's
	  called via yield or call).

	* eval.c (rb_thread_yield): no need to specify YIELD_LAMBDA_CALL.

	* eval.c (rb_block_pass): update blkid in prot_tag.

Mon Jun 19 23:40:59 2006  NARUSE, Yui  <naruse@ruby-lang.org>

	  * ext/nkf/lib/kconv.rb: remove default -m0 and fix document.

	  * ext/nkf/nkf-8/{nkf.c, config.h, utf8tbl.c, utf8tbl.h}:
	    imported nkf 2.0.7.

Mon Jun 19 17:02:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/test.rb (proc_return3): return within non lambda block
	  should terminate surrounding method.  [ruby-dev:28741]

Mon Jun 19 13:22:48 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (unix_sysaccept): typo fixed.

	* ext/socket/socket.c (sock_connect): remove an unused local
	  variable tmpaddr.

Mon Jun 19 02:10:32 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (tcp_accept_nonblock): forgot to remove
	  abandoned hacks.  [ruby-dev:28740]

Mon Jun 19 00:00:17 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: fix bug: initialize improper tables.

Sun Jun 18 20:28:43 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (fole_methods): The return value
	  of WIN32OLE#ole_methods should include PROPERTYPUTREF methods.

	* ext/win32ole/win32ole.c (fole_put_methods): The return value
	  of WIN32OLE#ole_put_methods should include PROPERTYPUTREF methods.

	* test/win32ole/test_ole_methods.rb: ditto.

	* ext/win32ole/win32ole.c (ole_propertyput): support
	  PROPERTYPUTREF. [ruby-talk:183042]

	* test/win32ole/test_propertyputref.rb: ditto.

Sat Jun 17 23:42:26 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_eval): add aliases invoke_method and
	  invoke_functional_method corresponding send and funcall
	  respectively.  [ruby-talk:197512]

	* parse.y (parser_yylex): returns the most typical keyword token
	  on EXPR_FNAME.  [ruby-core:7995]

	* ext/socket/socket.c: protoize.

Sat Jun 17 22:17:17 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mathn.rb (Integer::prime_division): raise ZeroDivisionError
	  on zeros.  [ruby-dev:28739]

Sat Jun 17 14:53:32 2006  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Kernel#Pathname): new method.

Sat Jun 17 02:01:00 2006  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb (Kernel#pretty_inspect): defined for pretty printed
	  string.

Fri Jun 16 01:41:00 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_proc_arity): get rid of segfault for mere splat.

	* gc.c (gc_mark_children): NODE_BLOCK_PASS needs u3 to be marked.

Thu Jun 15 22:06:56 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (then): remove ':' from 'then' and 'do' rules.

Wed Jun 14 18:00:20 2006  Eric Hodel  <drbrain@segment7.net>

	* enum.c (enum_any): Documentation typo.

Wed Jun 14 15:01:09 2006  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser#warn): Don't print
	  warnings when -q is set.

Wed Jun 14 16:11:37 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (rb_f_method_name, rb_f_callee_name): document typo.

Wed Jun 14 15:19:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (env_aset): raise TypeError on nil with more descriptive
	  message.  [ruby-core:07990]

Tue Jun 13 17:22:19 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (Init_socket): remove obsolete constants:
	  IPsocket, TCPsocket, SOCKSsocket, TCPserver, UDPsocket,
	  UNIXsocket, UNIXserver.

Tue Jun 13 09:07:27 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (formal_assign): post splat arguments should have had
	  higher priority than optional arguments, since they are
	  mandatory.  [ruby-dev:28715]

	* eval.c (VIS_MASK): broken. should be 15.  [ruby-dev:28715]

	* io.c (argf_getc): should return one-character string.
	  [ruby-dev:28715]

	* io.c (rb_io_readchar): ditto.

Sun Jun 11 23:20:07 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (sym_call): disallow to call private methods.

	* lib/optparse.rb (OptionParser::Arguable#getopts): pass self to the
	  parser.

Sun Jun 11 09:56:41 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.h (write): not need to define on bcc.

Sun Jun 11 08:30:33 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#getopts): new methods.

Sun Jun 11 07:27:11 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/ri/ri_writer.rb: use String#ord.

Sun Jun 11 04:38:20 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (sym_to_proc): imported Symbol#to_proc from ActiveSupport.

Sat Jun 10 18:02:40 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/newton.rb (Newton::nlsolve): typo
	  fixed: raize -> raise.  [ruby-talk:196608]

Sat Jun 10 17:49:53 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_ord): new method.

	* parse.y (rbracket): allow optional newline before closing
	  brackets.

Sat Jun 10 15:12:29 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (rb_f_method_name, rb_f_callee_name): new functions.
	  new global method `__method__' and `__callee__'.

Sat Jun 10 10:13:13 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/getoptlong.rb (GetoptLong#set_options): receive arguments
	  as Array.

	* lib/irb/slex.rb: use Proc#yield.

	* lib/rdoc/markup/simple_markup/inline.rb: follow the new behavior
	  of String#[].

	* lib/rdoc/ri/ri_writer.rb: ditto.

Sat Jun 10 08:17:23 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* math.c (log2): may be a macro.

	* parse.y (args, block_param, f_args): pass f_post_arg to #params.

	* util.c (powersOf10): constified.

	* ext/readline/readline.c: include extconf.h first.

	* ext/ripper/eventids2.c: removed tLAMBDA_ARG.

	* ext/tk/tcltklib.c (lib_fromUTF8_core): removed conflict.

	* ext/tk/tkutil/tkutil.c (cbsubst_get_subst_arg): rb_id2name() is
	  defined as const now.

	* ext/win32ole/win32ole.c (fole_missing): ditto.

	* lib/mkmf.rb (create_makefile): force to create extconf header.

	* lib/optparse.rb (order!): use Proc#yield.

Sat Jun 10 06:53:22 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (CALLARGS): remove last semicolon. C90 compiler doesn't
	  allow any lines (even if they're empty) within variable
	  declarations.

Fri Jun  9 09:56:32 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): allow %c to print one character
	  string (e.g. ?x).

Thu Jun  8 14:00:02 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.[ch] (rb_w32_read, rb_w32_write): new functions.
	  use recv() and send() when fd is socket. fixed: [ruby-dev:28694]

Wed Jun  7 16:22:51 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tempfile.rb (Tempfile::make_tmpname): put dot between
	  basename and pid.  [ruby-talk:196272]

Wed Jun  7 16:16:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (do_block): remove -> style block.

	* parse.y (parser_yylex): remove tLAMBDA_ARG.

Wed Jun  7 14:51:22 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (errmap): add some winsock errors.

Wed Jun  7 09:14:44 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): binding for the return event hook should have
	  consistent scope.  [ruby-core:07928]

Tue Jun  6 23:25:49 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): return behavior should depend whether it
	  is surrounded by a lambda or a mere block.

Mon Jun  5 18:12:12 2006  Tanaka Akira  <akr@m17n.org>

	* ext/socket/socket.c (sock_s_unpack_sockaddr_in): reject
	  non-AF_INET/AF_INET6 sockaddr.
	  (sock_s_unpack_sockaddr_un): reject non-AF_UNIX sockaddr.
	  [ruby-dev:28691]

Sun Jun  4 20:40:19 2006  Tanaka Akira  <akr@m17n.org>

	* ext/socket/socket.c: fix sockaddr_un handling.
	  [ruby-dev:28677]

Sat Jun  3 23:53:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (formal_assign): handles post splat arguments.

	* eval.c (rb_call0): ditto.

Sat Jun  3 13:10:41 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* st.c (strhash): use FNV-1a hash.

Fri Jun  2 20:01:24 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): removed experimental ';;' terminator.

Fri Jun  2 19:00:40 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: use create_header.

	* ext/openssl/ossl.h, ext/openssl/openssl_missing.h:
	  include RUBY_EXTCONF_H.

Fri Jun  2 17:16:52 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (CLEANINGS): remove extconf.h by distclean if created.

Fri Jun  2 00:11:19 2006  Tanaka Akira  <akr@m17n.org>

	* ext/socket/socket.c (s_recvfrom): alen may be zero with UNIXSocket
	  too.  (tested on NetBSD 3.0)
	  (s_recvfrom_nonblock): extracted from sock_recvfrom_nonblock.
	  (sock_recvfrom_nonblock): use s_recvfrom_nonblock.
	  (ip_recvfrom_nonblock): new method: IPSocket#recvfrom_nonblock
	  (unix_recvfrom_nonblock): new method: UNIXSocket#recvfrom_nonblock
	  (s_accept_nonblock): extracted from sock_accept_nonblock.
	  (sock_accept_nonblock): use s_accept_nonblock.
	  (tcp_accept_nonblock): new method: TCPServer#accept_nonblock
	  (unix_accept_nonblock): new method: UNIXServer#accept_nonblock

Thu Jun  1 19:12:37 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_cmdvector): backslashes inside single-quotes
	  no longer has special meanings.  fixed: [ruby-list:42311]

Thu Jun  1 17:55:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_node_arity): should be aware of post splat arguments.

	* eval.c (rb_proc_arity): ditto.

Thu Jun  1 16:17:26 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getcwd): runtime's getcwd() will not success
	  if the length of the cwd is longer than MAX_PATH.
	  fixed [ruby-list:42335]

Thu Jun  1 16:07:48 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_args): syntax rule enhanced to support arguments
	  after the splat.

	* parse.y (mlhs_basic): ditto for multiple assignments

	* parse.y (block_param): ditto for block parameters.

	* parse.y (f_post_arg): mandatory formal arguments after the splat
	  argument.

	* parse.y (new_args_gen): generate nodes for mandatory formal
	  arguments after the splat argument.

	* eval.c (rb_eval): dispatch mandatory formal arguments after the
	  splat argument.

Thu Jun  1 11:33:32 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getcwd): set errno if not set.
	  fixed [ruby-list:42346]

Thu Jun  1 00:45:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (args): allow more than one splat in the argument list.

Wed May 31 18:38:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (method_call): allow aref [] to accept all kind of
	  method argument, including assocs, splat, and block argument.

	* eval.c (SETUP_ARGS0): prepare block argument as well.

Tue May 30 18:13:53 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mathn.rb (Integer): remove Integer#gcd2. [ruby-core:07931]

Mon May 29 22:40:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (error_line): print receivers true/false/nil specially.

	* eval.c (rb_proc_yield): handles parameters in yield semantics.

	* eval.c (nil_yield): gives LocalJumpError to denote no block
	  error.

	* io.c (rb_io_getc): now takes one-character string.

Sat May 27 22:46:38 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): save and restore block in the current frame.
	  fixed: [ruby-core:07833], [ruby-talk:191639]

Sat May 27 11:29:46 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): remove extinit files if no statically linked
	  extensions.

Fri May 26 19:56:46 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_hash): use FNV-1a hash from Fowler/Noll/Vo
	  hashing algorithm.

Fri May 26 09:05:11 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.h, lib/mkmf.rb (create_header): clear command line options for
	  macros moved to extconf.h.

	* ext/extmk.rb (extract_makefile, extmk): made RUBY_EXTCONF_H and
	  EXTSTATIC permanent.

	* ext/{dbm,digest/*,socket,zlib}/extconf.rb: used $defs and $INCFLAGS.

	* {bcc32,win32,wince}/Makefile.sub (COMPILE_C, COMPILE_CXX): added
	  $(INCFLAGS).

	* lib/mkmf.rb (configuration): add $defs unless extconf.h was created.

Thu May 25 01:52:07 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (pkg_config): particular config commands support.

	* ext/extmk.rb: deal with $static set in extconf.rb.

	* mkconfig.rb: merge multiple entries to an entry with multiple lines.

	* lib/mkmf.rb: allow a series of commands to link.

	* win32/Makefile.sub: embed manifests.

	* win32/setup.mak: suffix OS name by runtime version.

Wed May 24 23:52:11 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ac_install_sh): ignore dummy install-sh.
	  [ruby-talk:193876]

Wed May 24 17:55:13 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_aref): str[0] now returns 1 character string,
	  instead of a fixnum.	[Ruby2]

	* parse.y (parser_yylex): ?c now returns 1 character string,
	  instead of a fixnum.	[Ruby2]

	* string.c (rb_str_aset): no longer support fixnum insertion.

Wed May 24 03:10:44 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb
	  (OpenSSL::SSL::SocketForwarder#setsockopt,getsockopt): typo fixed.

Mon May 22 16:32:03 2006  Tanaka Akira  <akr@m17n.org>

	* rubyio.h (rb_io_set_nonblock): declared.

	* io.c (rb_io_set_nonblock): new function.
	  (io_getpartial): nonblocking read support.
	  (io_read_nonblock): new method: IO#read_nonblock.
	  (io_write_nonblock): new method: IO#write_nonblock.

	* ext/socket/socket.c (s_accept): retry for EWOULDBLOCK.
	  revert [ruby-talk:113807].
	  (sock_connect_nonblock): new method: Socket#connect_nonblock.
	  (sock_accept_nonblock): new method: Socket#accept_nonblock.
	  (sock_recvfrom_nonblock): new method: Socket#recvfrom_nonblock.

	  [ruby-core:7917]

Mon May 22 15:57:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (umethod_bind): should not update original class.
	  [ruby-dev:28636]

Mon May 22 13:38:57 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (ev_const_get): should support constant access from
	  within instance_eval().  [ruby-dev:28327]

Sun May 21 09:50:31 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* regexec.c: add STK_NULL_CHECK_END to IS_TO_VOID_TARGET().
	  [ruby-list:42234]

Thu May 18 22:37:20 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/config.rb (WEBrick::Config::HTTP): add new parameters,
	  :InputBufferSize and :OutputBufferSize.

	* lib/webrick/utils.rb (WEBrick::Utils.timeout): add new timeout
	  method. this implementation is expected to be compatible with
	  timeout.rb and faster than timeout.rb.

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#_read_data):
	  Timeout.timeout is replaced by WEBrick::Utils.timeout.

	* lib/webrick/httprequest.rb: WEBrick::HTTPRequest::BUFSIZE is
	  replaced by config[:InputBufferSize].

	* lib/webrick/httpresposne.rb: WEBrick::HTTPResponse::BUFSIZE is
	  replaced by config[:OutputBufferSize].

	* lib/webrick/server.rb: get rid of unnecessary require.

	* test/webrick/test_utils.rb: test for WEBrick::Utils.timeout.

Thu May 18 17:51:32 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_timeval): should round for usec floating
	  number.  [ruby-core:07896]

	* time.c (time_add): ditto.

Thu May 18 00:42:12 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb, lib/mkmf.rb: use BUILD_FILE_SEPARATOR in Makefiles.

Wed May 17 17:55:26 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (sys_warning): should not call a vararg function
	  rb_sys_warning() indirectly.	[ruby-core:07886]

Tue May 16 17:23:19 2006  Shin-ichiro HARA  <sinara@blade.nagaokaut.ac.jp>

	* numeric.c (flo_divmod): the first element of Float#divmod should
	  be an integer. [ruby-dev:28589]

	* test/ruby/test_float.rb: add tests for divmod, div, modulo and remainder.

Tue May 16 15:34:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_initialize): should not allow modifying literal
	  regexps.  frozen check moved from rb_reg_initialize_m as well.

Tue May 16 09:20:16 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_initialize): should not modify untainted objects in
	  safe levels higher than 3.

	* re.c (rb_memcmp): type change from char* to const void*.

	* dir.c (dir_close): should not close untainted dir stream.

	* dir.c (GetDIR): add tainted/frozen check for each dir operation.

Mon May 15 21:37:12 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* re.c (rb_reg_prepare_re): don't use onig_recompile().

Mon May 15 17:42:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_symbol_arg):
	  typo fixed.  a patch from Florian Gross <florg at florg.net>.

Sat May 13 16:14:05 2006  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb (PP.mcall): new method.
	  (Struct#pretty_print): call Kernel#class and Struct#members even if
	  overridden.
	  (Struct#pretty_print_cycle): ditto.
	  [ruby-core:7865]

Fri May 12 15:54:48 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (EXEC_EVENT_HOOK): trace_func may remove itself from
	  event_hooks.	no guarantee for arbitrary hook deletion.
	  [ruby-dev:28632]

Thu May 11 19:57:00 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* util.c (ruby_strtod): differ addition to minimize error.
	  [ruby-dev:28619]

Thu May 11 18:30:11 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_cipher.c (add_cipher_name_to_ary): should return
	  value. [ruby-dev:28627]

Thu May 11 18:10:43 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* util.c (ruby_strtod): should not raise ERANGE when the input
	  string does not have any digits.  [ruby-dev:28629]

Wed May 10 23:40:21 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* oniguruma.h: Version 4.0.3

	* regexec.c: ditto.

Mon May  8 09:10:31 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: add check for OBJ_NAME_do_all_sorted.

	* ext/openssl/ossl_cipher.c (ossl_s_ciphers): new method
	  OpenSSL::Cipher.ciphers. it returns all the cipher names.

	* ext/openssl/ossl_cipher.c (ossl_cipher_init): refine warning message.

	* ext/openssl/lib/openssl/cipher.rb: reimplement without eval() and
	  add constants AES128, AES192, AES256. [ruby-dev:28610]

	* ext/openssl/lib/openssl/digest.rb: reimplement without eval().

	* test/openssl/test_cipher.rb, test_digest: fix about reimplemented
	  features.

	* sample/openssl/cipher.rb: rewrite all.

Sun May  7 03:09:51 2006  Stephan Maka  <stephan@spaceboyz.net>

	* lib/resolv.rb (Resolv::DNS::Requester::ConnectedUDP#initialize):
	  Use AF_INET6 for nameservers containing colons.

Sat May  6 23:40:03 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): should restore old ruby_frame->block.
	  thanks to ts <decoux at moulon.inra.fr>.  [ruby-core:07833]
	  also fix [ruby-dev:28614] as well.

Sat May  6 00:38:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (trap): sig should be less then NSIG.  Coverity found
	  this bug.  a patch from Kevin Tew <tewk at tewk.com>.
	  [ruby-core:07823]

Thu May  4 22:13:22 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* math.c (math_log2): add new method inspired by
	  [ruby-talk:191237].

	* math.c (math_log): add optional base argument to Math::log().
	  [ruby-talk:191308]

Thu May  4 02:24:16 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/emitter.c (syck_scan_scalar): avoid accessing
	  uninitialized array element.	a patch from Pat Eyler
	  <rubypate at gmail.com>.  [ruby-core:07809]

	* array.c (rb_ary_fill): initialize local variables first.  a
	  patch from Pat Eyler <rubypate at gmail.com>.	 [ruby-core:07810]

	* ext/syck/yaml2byte.c (syck_yaml2byte_handler): need to free
	  type_tag.  a patch from Pat Eyler <rubypate at gmail.com>.
	  [ruby-core:07808]

Wed May  3 02:12:07 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (make_hostent_internal): accept ai_family
	  check from Sam Roberts <sroberts at uniserve.com>.
	  [ruby-core:07691]

Mon May  1 17:58:16 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (add_event_call_back): should not
	  delete event handler when the event name is not entried.

Mon May  1 08:32:10 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_param_ole_type): should return
	  "unknown type" string when ITypeInfo::GetFuncDesc failed.

Sat Apr 29 22:43:37 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode0): should initialize
	  flag. [ruby-core:07785]

Fri Apr 28 10:53:16 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* util.c (ruby_strtod): should not cut off 18 digits for no
	  reason.  [ruby-core:07796]

Thu Apr 27 01:38:10 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_fill): internalize local variable "beg" to
	  pacify Coverity.  [ruby-core:07770]

Wed Apr 26 16:59:24 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_unpack): now supports CRLF newlines.  a patch from
	  <tommy at tmtm.org>.	[ruby-dev:28601]

Wed Apr 26 16:55:19 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* applied code clean-up patch from Stefan Huehner
	  <stefan at huehner.org>.  [ruby-core:07764]

Tue Apr 25 18:00:05 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (delete_slaves): maybe increment the reference
	  count of a NULL Tcl_Obj [ruby-core:07759].

Tue Apr 25 07:55:31 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/jcode.rb (String::tr_s): should have translated non
	  squeezing character sequence (i.e. a character) as well.  thanks
	  to Hiroshi Ichikawa <gimite at gimite.ddo.jp> [ruby-list:42090]

Fri Apr 21 15:19:13 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (lib_eventloop_ensure): avoid dereferencing
	  freed pointer [ruby-core:07744] and memory leak.

Fri Apr 21 12:14:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c: document update patch from Sam Roberts
	  <sroberts at uniserve.com>.  [ruby-core:07701]

Thu Apr 20 08:43:54 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mathn.rb (Integer): need not to remove gcd2.  a patch from
	  NARUSE, Yui <naruse at airemix.com>.	[ruby-dev:28570]

Wed Apr 19 13:55:27 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (arg): too much NEW_LIST()

	* eval.c (SETUP_ARGS0): remove unnecessary access to nd_alen.

Wed Apr 19 11:57:04 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): use ARGSCAT for NODE_OP_ASGN1.
	  [ruby-dev:28585]

	* parse.y (arg): use NODE_ARGSCAT for placeholder.

Wed Apr 19 11:13:17 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/getoptlong.rb (GetoptLong::get): RDoc update patch from
	  mathew <meta at pobox.com>.  [ruby-core:07738]

Wed Apr 19 10:13:27 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_const_set): raise error when no target klass is
	  supplied.  [ruby-dev:28582]

Tue Apr 18 17:40:37 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: add a binding to a container for a slave IP.

	* ext/tk/lib/tk.rb: update RELEASE_DATE.

	* ext/tk/tcltklib.c: forget to reset a Tcl interpreter.

	* ext/tk/stubs.c: fix potential bugs about handling rb_argv0.

Mon Apr 10 01:03:10 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* prec.c (prec_prec_f): documentation patch from
	  <gerardo.santana at gmail.com>.  [ruby-core:07689]

Sat Apr  8 02:34:34 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_pow): second operand may be too big even if
	  it's a Fixnum.  [ruby-talk:187984]

Sat Apr  8 02:12:38 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* README.EXT: update symbol description.  [ruby-talk:188104]

Sat Apr  8 18:06:28 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_METHOD#inspect,
	  WIN32OLE_PARAM#inspect.

	* test/win32ole/test_win32ole_method.rb: ditto.

	* add test/win32ole/test_win32ole_param.rb.

Fri Apr  7 22:11:30 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c(foletypelib_initialize): WIN32OLE_TYPELIB.new
	  accepts OLE file.

	* test/win32ole/test_win32ole_typelib.rb(test_initialize): ditto.

Thu Apr  6 23:28:47 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* COPYING: explicitly note GPLv2.  [ruby-talk:187922]

Thu Apr  6 16:43:06 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* intern.h (rb_obj_instance_exec, rb_mod_module_exec): add declaration.

Thu Apr  6 11:18:37 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/panedwindow.rb: lack of arguments. [ruby-core:7681]

Thu Apr  6 01:04:47 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: fix SEGV when embedding to an application.
	  [ruby-core:7600]

	* ext/tk/tcltklib.c: fix SEGV at exit. [ruby-talk:186489]

	* ext/tk/tkutil/tkutil.c: follow to changing specification of
	  instance_eval on ruby-1.9.x.

	* ext/tk/lib/tk.rb: ditto.

	* ext/tk/lib/multi-tk.rb: ditto.

	* ext/tk/lib/tk.rb: remove warning about redefinition of methods.

	* ext/tk/lib/tk/variable.rb: remove warning about unseting Tcl
	  variables.

Wed Apr  5 00:22:54 2006  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb: use a subclass for instantiation except
	  methods take pathname argument.  suggested by Evan Phoenix.
	  [ruby-core:7618]

Tue Apr  4 22:15:41 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: remove some obsolete syntax rules (unparenthesized
	  method calls in argument list).

Sat Apr  1 15:11:27 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_TYPE#inspect,
	  WIN32OLE_VARIABLE#inspect

	* remove ext/win32ole/tests/testOLEVARIABLE.rb, testOLETYPE.rb
	  testOLETYPELIB.rb.

	* testall.rb: ditto.

	* add test/win32ole

Fri Mar 31 14:24:55 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (enumerator_with_index): removed suspicious return
	  statement.

Wed Mar 29 23:06:48 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_invoke): change the behavior of
	  WIN32OLE#[], WIN32OLE#[]=. These methods invoke DISPID_VALUE.

	* ext/win32ole/sample/excel2.rb: ditto.

	* ext/win32ole/tests/testWIN32OLE.rb: ditto.

Wed Mar 29 10:11:31 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (nkf_each_char_to_hex, encode_fallback_subchar,
	  e2w_conv): support C90 compiler.

Mon Mar 27 22:45:37 2006  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/{nkf.c, utf8tbl.c}: imported nkf 2.0.6.
	  * Add --ic / --oc option and mapping tables.
	  * Add fallback option.
	  * Add --no-best-fit-chars option.
	  * Fix some bugs.

	* ext/nkf/nkf.c (nkf_split_options): added for parse option string.

	* ext/nkf/lib/kconv.rb (Kconv.to*): add -m0.
	  Note that Kconv.to* still imply -X.

	* ext/nkf/test.rb: Removed.  Obsolete by test/nkf.

	* ext/.document: enabled documents in nkf and kconv

	* ext/nkf/nkf.c, ext/nkf/lib/kconv.rb: Add rdoc.

Mon Mar 27 03:17:21 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): insecure calling should be checked for non
	  NODE_SCOPE method invocations too.

	* eval.c (rb_alias): should preserve the current safe level as
	  well as method definition.

Sun Mar 26 22:02:51 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* re.c: refactoring for options.

	* parse.y: ditto.

Fri Mar 24 21:11:02 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* re.c (match_aref): RDoc description updated.

	* string.c (rb_str_sub): ditto.

	* string.c (rb_str_gsub): ditto.

Fri Mar 24 17:20:03 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (rb_f_sleep): remove RDoc description about SIGALRM
	  which is not valid on the current implementation. [ruby-dev:28464]

Thu Mar 23 21:40:47 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* re.c (rb_reg_regsub): prohibit \1, \2 ...\9 in replaced string
	  for named regex pattern.

Thu Mar 23 21:06:23 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* oniguruma.h: Version 4.0.2

	* regparse.c: ditto.

	* regcomp.c ditto.

	* regerror.c: ditto.

Thu Mar 23 10:47:03 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (method_missing): should support argument splat in
	  super.  a bug in combination of super, splat and
	  method_missing.  [ruby-talk:185438]

Thu Mar 23 00:01:32 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* re.c (rb_reg_regsub): add back reference by name \k<name> in
	  replace string.

	* re.h: add regexp argument to rb_reg_regsub().

	* string.c (rb_str_sub_bang): ditto.

	* string.c (str_gsub): ditto.

Tue Mar 21 22:14:01 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* re.c (match_alloc): initialize member regexp.

	* re.c (match_aref): add String and Symbol argument. [ruby-dev:28448]

	* re.h: add member regexp to RMatch.

	* gc.c (gc_mark_children): add gc_mark() to regexp member.

Mon Mar 20 12:05:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: Solaris SunPro compiler -rapth patch from
	  <kuwa at labs.fujitsu.com>.  [ruby-dev:28443]

Mon Mar 20 11:12:38 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/win32ole/win32ole.c (folevariant_value): could not compile
	  with C90 compiler.

Mon Mar 20 09:40:23 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: remove enable_rpath=no for Solaris.
	  [ruby-dev:28440]

Sun Mar 19 09:46:30 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_val2olevariantdata): change behavior
	  of converting	 OLE Variant object with VT_ARRAY|VT_UI1 and Ruby
	  String object.

	* ext/win32ole/win32ole.c (folevariant_value): ditto.

	* ext/win32ole/tests/testOLEVARIANT.rb: ditto.

Wed Mar 15 16:51:11 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): support libraries without *.so.

Wed Mar 15 16:39:29 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c, ext/openssl/ossl_nsspki.c: should use
	  "rb_str_new(0, 0)" to make empty string.

Sun Mar 12 17:02:10 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c(ole_val2olevariantdata): support VT_ARRAY in
	  WIN32OLE_VARIANT.new().

	* ext/win32ole/tests/testOLEVARIANT.rb: ditto.

	* ext/win32ole/tests/testOLEPARAM.rb: test method name should not be
	  duplicated.

Sat Mar 11 14:24:06 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.1: a clarification patch from David Lutterkort
	  <dlutter at redhat.com>.  [ruby-core:7508]

Sun Mar  5 18:40:58 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb: do not repeat command options.

Sun Mar  5 18:35:03 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (send_request_with_body): #content_type never
	  return false, use #main_type instead. [ruby-core:07476]

Sat Mar  4 15:26:40 2006  Tanaka Akira  <akr@m17n.org>

	* gc.c (id2ref): fix symbol test.

Sat Mar  4 01:08:07 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rdoc/ri/ri_paths.rb (RI::Paths): adding paths from rubygems
	  directories.	a patch from Eric Hodel <drbrain at segment7.net>.
	  [ruby-core:07423]

Fri Mar  3 17:59:00 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_clear_cache_by_class): clearing wrong cache.

Fri Mar  3 21:22:42 2006  Tanaka Akira  <akr@m17n.org>

	* lib/fileutils.rb (FileUtils.cp_r): implement :remove_destination
	  option.

	* ext/extmk.rb: use :remove_destination to install extension libraries
	  to avoid SEGV.  [ruby-dev:28417]

Fri Mar  3 14:41:04 2006  Minero Aoki  <aamine@loveruby.net>

	* ext/dl/.cvsignore: ignore callback.h.

	* ext/ripper/.cvsignore: ignore eventids2table.c.

	* ext/socket/.cvsignore: ignore constants.h.

Thu Mar  2 18:58:18 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_thread_fd_writable): should not re-schedule output
	  from KILLED thread (must be error printing).

Thu Mar  2 09:12:05 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_flatten_bang): allow specifying recursion
	  level.  [ruby-talk:182170]

	* array.c (rb_ary_flatten): ditto.

Thu Mar  2 08:02:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (add_heap): a heap_slots may overflow.  a patch from Stefan
	  Weil <weil at mail.berlios.de>.

Wed Mar  1 17:13:37 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call): use separate cache for fcall/vcall
	  invocation.

	* eval.c (rb_eval): NODE_FCALL, NODE_VCALL can call local
	  functions.

	* eval.c (rb_mod_local): a new method to specify newly added
	  visibility "local".

	* eval.c (search_method): search for local methods which are
	  visible only from the current class.

	* class.c (rb_class_local_methods): a method to list local methods.

Thu Mar  2 17:54:45 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* gc.c: committed magic for reducing RVALUE size on windows. (24->20byte)
	  [ruby-core:7474]

Thu Mar  2 14:12:26 2006  Tanaka Akira  <akr@m17n.org>

	* gc.c: align VALUE with sizeof(RVALUE) globally.
	  (is_pointer_to_heap): check alignment out of loop.
	  (id2ref): avoid collision between symbols and objects.
	  (rb_obj_id): ditto.  moved from object.c.
	  [ruby-talk:178364] [ruby-core:7305]

Thu Mar  2 12:55:16 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (filetime_to_unixtime): should set tm_isdst to -1.
	  stat() didn't treat daylight saving time property on WinNT.
	  [ruby-talk:182100]

Wed Mar  1 00:15:51 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/rdoc/parsers/parse_rb.rb (read_escape): could not handle /\^/.
	  merged Mr. Ishizuka's lib/irb/ruby-lex.rb 's patch rev 1.29.
	  [ruby-talk:181631] [ruby-dev:28404]

Tue Feb 28 19:32:14 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (Init_Object): add BasicObject class as a top level
	  BlankSlate class.

Mon Feb 27 00:19:16 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (SYM2ID): should not cast to signed long.
	  [ruby-core:07414]

Fri Feb 24 20:21:38 2006  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/drbtest.rb (add_service_command): quote pathnames in the
	  server's command line for space contained directory names.
	  Thanks, arton. [ruby-dev:28386]

Fri Feb 24 12:10:07 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* instruby.rb: install *.exe.manifest and *.dll.manifest if exist.
	  It's for VC++8.

Fri Feb 24 11:17:45 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (NtInitialize): need to set a handler for VC++8.

Thu Feb 23 22:39:59 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/Makefile.sub: use borlndmm.dll if possible. bcc32's RTL internal
	  memory manager cannot handle large memory block properly.
	  ex: 10000.times { "" << "." * 529671; GC.start } # crash
	  [ruby-dev:28230]

Thu Feb 23 13:23:03 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* eval.c (SETUP_ARGS0): fixed memory corruption. [ruby-dev:28360]

Wed Feb 22 21:16:55 2006  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#each_filename): use split_names properly.

Wed Feb 22 16:24:05 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/test_cgi.rb: should support platforms which search
	  library path from the interpreter's path.
	  And, support test without install incidentally.

Wed Feb 22 14:21:03 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bignorm): x may not be a bignum.  [ruby-dev:28367]

Wed Feb 22 09:22:40 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_alloc): add proper check for creation of a lambda
	  without a block.

Tue Feb 21 02:07:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_arglist): should set command_start = Qtrue for
	  command body.  [ruby-talk:180648]

Mon Feb 20 22:30:17 2006  Tanaka Akira  <akr@m17n.org>

	* mkconfig.rb: alias Config to RbConfig for compatibility.

Mon Feb 20 18:21:41 2006  Tanaka Akira  <akr@m17n.org>

	* io.c (rb_io_reopen): flush before reopening a file.
	  reported by Mathieu Bouchard.  [ruby-core:7396]

Mon Feb 20 17:29:50 2006  Tanaka Akira  <akr@m17n.org>

	* mkconfig.rb: generate RbConfig instead of Config.

	* instruby.rb, rubytest.rb, runruby.rb, bcc32/Makefile.sub,
	  ext/extmk.rb, ext/dl/extconf.rb, ext/iconv/charset_alias.rb,
	  lib/mkmf.rb, lib/rdoc/ri/ri_paths.rb,
	  lib/webrick/httpservlet/cgihandler.rb,
	  test/dbm/test_dbm.rb, test/gdbm/test_gdbm.rb,
	  test/ruby/envutil.rb, test/soap/calc/test_calc_cgi.rb,
	  test/soap/header/test_authheader_cgi.rb, test/soap/ssl/test_ssl.rb,
	  win32/mkexports.rb, win32/resource.rb: Use RbConfig instead of
	  Config.

Mon Feb 20 13:46:19 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/find.rb: should raise ENOENT if root entry does not exist,
	  without opening it. [ruby-dev:28345]

Mon Feb 20 12:27:53 2006  Kent Sibilev  <ksruby@gmail.com>

	* lib/rational.rb (Integer::gcd): small typo fix.
	  [ruby-core:07395]

Mon Feb 20 10:03:59 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_const_get_0): Object should have been the lowest
	  in const lookup precedence.  [ruby-dev:28343]

Mon Feb 20 09:17:11 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator): should not delegate "funcall".

Mon Feb 20 09:13:42 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/webrick/httpservlet/cgihandler.rb (WEBrick::HTTPServlet::CGIHandler):
	  qualify the access for Config constant.  [ruby-dev:28338]

	* lib/resolv.rb (Resolv::DNS::Resource::IN::A): qualify
	  ClassValue.  [ruby-dev:28338]

Mon Feb 20 01:05:27 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rational.rb (Integer::gcd): replaced by gcd4 in
	  [ruby-core:07390].  [ruby-core:07377]

Mon Feb 20 00:57:02 2006  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.h (OSSL_Debug): should not use __func__.
	  [ruby-dev:28339]

Mon Feb 20 00:13:49 2006  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb: add :ssl_verify_mode option.
	  suggested by Will Glynn.

	* lib/open-uri.rb: add :ssl_ca_cert option.

Sun Feb 19 04:46:29 2006  Guy Decoux  <ts@moulon.inra.fr>

	* eval.c: initial value for block_unique must be 1.
	  [ruby-talk:180420]

Sat Feb 18 23:58:26 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tracer.rb (Tracer::Tracer.add_filter): turn on tracer mode
	  only when caller() level size is one.  [ruby-core:07389]

	* lib/rdoc/parsers/parse_rb.rb: need not to require "tracer".
	  [ruby-core:07389]

	* sample/rtags.rb: ditto.

Sat Feb 18 21:16:27 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_obj_instance_eval): RDoc description updated.  a
	  patch from Ozgur Murat Homurlu <ozgurmurath at gmail.com>.
	  [ruby-core:07381]

Sat Feb 18 01:01:17 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_const_get_0): skip ruby_wrapper in const search
	  to give it lower priority (just above Object).  need not to
	  change rb_const_defined_0() since it's only a precedence matter;
	  they are defined anyway.

Sat Feb 18 00:22:39 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tracer.rb: merged a minor clarification patch from Daniel
	  Berger <Daniel.Berger at qwest.com>.  [ruby-core:07376]

Fri Feb 17 17:30:20 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (ev_const_get): simplified using rb_const_get_fallback().

	* eval.c (ev_const_defined): adopt to ev_const_get() using
	  rb_const_defined_fallback().

	* variable.c (rb_const_get_fallback): new function to implement
	  constant search.

	* variable.c (rb_const_defined_fallback): new function to
	  implement constant definition check.

	* variable.c (rb_const_get_0): adopt to new behavior.  constants
	  are looked up in the order of: current class, super classes (but
	  Object), lexically external classes/modules, and Object.

	* variable.c (rb_const_defined_0): ditto.

Fri Feb 17 11:20:53 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* util.c (ruby_strtod): Float("1e") should fail. [ruby-core:7330]

	* pack.c (EXTEND32): unpack("l") did not work where sizeof(long) != 4.
	  [ruby-talk:180024]

	* pack.c (pack_unpack): fixed integer overflow on template "w".
	  [ruby-talk:180126]

Fri Feb 17 09:39:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_thread_wait_for): sleep should always sleep for
	  specified amount of time.  [ruby-talk:180067]

Wed Feb 15 16:52:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): NODE_OP_ASGN1 should allow splat in its
	  argument list.  [ruby-core:07366]

	* parse.y (arg): avoid unnecessary extra argument.
	  [ruby-core:07366]

	* eval.c (rb_eval): honor visibility on OP_ASGN1 and
	  OP_ASGN2. [ruby-core:07366]

Wed Feb 15 15:20:23 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (error_line): remove void control path.  [ruby-dev:28335]

Wed Feb 15 10:09:51 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (yield_under_i): should not pass self as an argument to
	  the block for instance_eval.  [ruby-core:07364]

Wed Feb 15 09:20:35 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_obj_instance_eval): should be no singleton classes for
	  true, false, and nil.  [ruby-dev:28186]

Tue Feb 14 20:26:00 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_each): return self if no block is
	  given.  [yarv-dev:882]

Tue Feb 14 18:48:33 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (DMETHOD_P): accessing wrong frame.  [ruby-dev:28181]

	* eval.c (proc_invoke): preserve FRAME_DMETH flag.

Tue Feb 14 15:15:22 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/zlib/zlib.c: suppress warning on test/zlib. [ruby-dev:28323]

Tue Feb 14 13:47:22 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_utime): drop read-only attribute before
	  changing file time.

Tue Feb 14 13:38:01 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): should define HAVE_LONG_LONG with
	  VC++8.

Tue Feb 14 11:42:38 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* time.c (search_time_t): support non 32bit time_t environments.

	* win32/Makefile.sub (config.h): VC++8 has ``long long'' type.

	* win32/Makefile.sub (config.h): VC++8's time_t is 64bit value.

Mon Feb 13 18:01:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (copy_node_scope): remove duplicated semicolons at end.
	  a patch from KIMURA Koichi <kimura.koichi at canon.co.jp>.
	  [ruby-dev:28332]

	* eval.c (VIS_MODE): remove unnecessary argument.
	  [ruby-dev:28332]

Mon Feb 13 13:49:48 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_parse_string): mention "regexp" in a error
	  message.  a patch from Mauricio Fernandez <mfp at acm.org>
	  [ruby-core:07340]

Mon Feb 13 00:01:32 2006  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* oniguruma.h: Version 4.0.1

	* regparse.c (onig_free_shared_cclass_table): fix memory leaks.

	* regcomp.c (optimize_node_left): change from IS_POSIXLINE() to IS_MULTILINE().

	* regint.h: rename ANCHOR_ANYCHAR_STAR_PL to ANCHOR_ANYCHAR_STAR_ML.

	* regparse.h: ditto.

	* regexec.c: ditto.

Sat Feb 11 21:57:29 2006  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE.create_guid.

	* ext/win32ole/tests/testWIN32OLE.rb: ditto.

Sat Feb 11 01:57:44 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_autoload): check if ruby_cbase is nil (during
	  instance_eval for objects cannot have singleton classes,
	  e.g. fixnums and symbols).  [ruby-dev:28178]

Fri Feb 10 12:31:05 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): should support NODE_ZSUPER in NODE_ITER.
	  [ruby-dev:28326]

	* eval.c (ZSUPER_ARGS): support macro.

Wed Feb  8 10:26:06 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (rb_gc_call_finalizer_at_exit): turn on during_gc while
	  invoking finalizers.

	* gc.c (rb_gc_finalize_deferred): ditto.

Tue Feb  7 23:03:13 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/zlib/zlib.c: should not access ruby objects in finalizer.
	  [ruby-dev:28286]

Tue Feb  7 18:42:00 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_write_error2): use fwrite(3) if rb_stderr is not
	  updated or is already freed.  [ruby-dev:28313]

Mon Feb  6 16:02:51 2006  WATANABE Hirofumi  <eban@ruby-lang.org>

	* file.c (rb_thread_flock): ERROR_NOT_LOCKED is not an error on Cygwin.
	  In such situation, flock() should return 0.

Mon Feb  6 14:36:29 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (error_line): include the class name of a surrounding
	  method in error position description.

Mon Feb  6 00:14:57 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_find_index): a new method Enumerable#find_index.
	  [ruby-talk:178495]

Sun Feb  5 23:29:31 2006  Tanaka Akira  <akr@m17n.org>

	* ruby.h (struct RStruct): embed 3 or less elements structs.
	  (RSTRUCT_LEN): defined for accessing struct members.
	  (RSTRUCT_PTR): ditto.

	* struct.c: use RSTRUCT_LEN and RSTRUCT_PTR.
	  (struct_alloc): allocate small structs in embedded format.
	  (rb_struct_init_copy): ditto.

	* gc.c (gc_mark_children): use RSTRUCT_LEN and RSTRUCT_PTR.
	  (obj_free): ditto.

	* marshal.c (w_object): use RSTRUCT_LEN and RSTRUCT_PTR.

Sun Feb  5 21:01:49 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* numeric.c (fix_to_s): removed workaround for radix 2. Historically,
	  rb_fix2str could only handle radix 8, 10, 16. (Rev1.37) But for now,
	  it can handle radix 2..36. [ruby-Bugs#3438] [ruby-core:7300]

Sun Feb  5 18:49:00 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (add_field, get_fields): keep 1.8.2
	  compatibility.  This patch is contributed by Rob Pitt.

Sun Feb  5 16:33:50 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/mkmf.rb (create_makefile): Kernel#sub! was removed on HEAD.

Sun Feb  5 14:26:54 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/pstore.rb: should return default value if name is not found.
	  [ruby-core:7304]

	* lib/pstore.rb: should raise PStore::Error if not in transaction.

Sat Feb  4 22:51:43 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c: apply the FreeBSD getcontext/setcontext workaround
	  only before FreeBSD 7-CURRENT.

Sat Feb  4 21:10:06 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (LK_ERR): ERROR_NOT_LOCKED is not an error.
	  In such situation, flock() should return 0.

Sat Feb  4 15:52:56 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* numeric.c (fix_to_s): (2**32).to_s(2) fails with exception where
	  sizeof(int) == 4 < sizeof(long). [ruby-core:7300]

Sat Feb  4 15:02:05 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* oniguruma.h: merge Oniguruma 4.0.0  [ruby-dev:28290]

Fri Feb  3 19:25:53 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ruby.h: fixed prototype.

	* ext/syck/rubyext.c: defined symbol ID as global variable as others.

Fri Feb  3 17:57:02 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c: unify ruby_class (for method definition) and ruby_cbase
	  (for constant reference).

Fri Feb  3 15:02:10 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/syck.c (syck_move_tokens): should reset p->cursor or etc
	  even if skip == 0. This causes buffer overrun.
	  (ex: YAML.load('--- "..' + '\x82\xA0' * 511 + '"'))

Fri Feb  3 00:01:31 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/emitter.c (syck_emitter_write): should not set '\0' on
	  emitter's marker. if marker points to the end of buffer, this is
	  buffer overrun. (ex: YAML.dump("." * 12288))

Thu Feb  2 17:13:01 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser#get_tk): added
	  support of :'string' style Symbol.

Thu Feb  2 16:01:24 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): use TMP_ALLOC() instead of allocating
	  a temporary array object.

	* eval.c (eval): need not to protect $SAFE value.
	  [ruby-core:07177]

	* error.c (Init_Exception): change NameError to direct subclass of
	  Exception so that default rescue do not handle it silently.

Thu Feb  2 14:45:53 2006  Ville Mattila  <ville.mattila@stonesoft.com>

	* configure.in: The isinf is not recognized by autoconf
	  library guesser on solaris 10. [ruby-core:7138]

Wed Feb  1 22:01:47 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* configure.in, hash.c (ruby_setenv): use setenv(3) and unsetenv(3)
	  where they are supported. modifying environ variable seems to
	  segfault solaris 10. [ruby-core:7276] [ruby-dev:28270]

	* ruby.c (set_arg0): if use setenv(3), environ space cannot be used
	  for altering argv[0].

Tue Jan 31 14:46:28 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_select): update RDoc description.
	  [ruby-core:7254]

Tue Jan 31 11:58:51 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: add MultiTkIp#eval and bg_eval.

	* ext/tk/lib/tk/namespace.rb: TkNamespace#eval was enbugged at the
	  last commit. Now it will return a proper object.

Tue Jan 31 08:07:02 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (int_upto): return an enumerator if no block is
	  attached to the method.

	* numeric.c (int_downto): ditto.

	* numeric.c (int_dotimes): ditto.

	* enum.c (enum_first): new method Enumerable#first to take first n
	  elements from an enumerable.

	* enum.c (enum_group_by): new method Enumerable#group_by that
	  groups enumerable values according to their block values.

Tue Jan 31 00:08:22 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c (syck_resolver_transfer): workaround for SEGV.
	  ex: ruby -ryaml -e 'YAML.load("!map:B {}")' [ruby-core:7217]

Sat Jan 28 07:49:30 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/rdoc/usage.rb: support "a:0:33" style caller[-1]. In this case
	  file name is "a:0". I don't know this really happens though...
	  [ruby-Bugs:3344]

Thu Jan 26 15:55:52 2006  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c: turn on do_not_reverse_lookup by default.

Wed Jan 25 22:29:04 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, dln.c, file.c, intern.h, missing.h (eaccess): use
	  system routine if provided.  fixed: [ruby-core:07195]

Sun Jan 22 23:27:13 2006  Go Noguchi  <gonoguti@yahoo.co.jp>

	* lib/test/unit/autorunner.rb (process_args): ignore arguments after
	  '--' so that test scripts can handle them.  fixed: [ruby-dev:28258]

Sun Jan 22 22:09:52 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (POST_GETCONTEXT): define separately from PRE_GETCONTEXT on
	  IA64 to avoid reusing variable address.

Sun Jan 22 20:03:35 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (ruby_setjmp): define PRE_GETCONTEXT and POST_GETCONTEXT
	  instead of FUNCTION_CALL_MAY_RETURN_TWICE.
	  define PRE_GETCONTEXT to clear carry flag for workaround of
	  FreeBSD/i386 getcontext/setcontext bug.
	  [ruby-dev:28263]

Thu Jan 19 22:19:18 2006  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mv): should remove file after copying.
	  [ruby-dev:28223]

Wed Jan 18 23:37:06 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (FUNCTION_CALL_MAY_RETURN_TWICE): don't clobber %l7 of SPARC
	  if enable-shared.
	  (ruby_setjmp): call FUNCTION_CALL_MAY_RETURN_TWICE after getcontext
	  too.
	  reported by Pav Lucistnik and Marius Strobl.
	  http://lists.freebsd.org/pipermail/freebsd-sparc64/2006-January/003739.html

Tue Jan 17 23:59:56 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_mod_const_get, rb_mod_const_defined): added optional
	  flag to search ancestors, which is defaulted to true.
	  fixed: [ruby-talk:175899]

	* eval.c (rb_mod_method_defined): ditto.

Tue Jan 17 11:31:47 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak (MAKE): workaround for nmake 8.

Tue Jan 17 11:06:19 2006  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub: invoke .bat via shell. workaround for nmake 8.

Mon Jan 16 10:13:38 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/emitter.c (syck_emit_seq, syck_emit_map, syck_emit_item):
	  should output complex key mark even if map's key is empty seq/map.
	  [ruby-core:7129]

Sat Jan 14 03:38:54 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* file.c (rb_file_s_chmod): avoid warning where sizeof(int) !=
	  sizeof(void*).

Fri Jan 13 19:26:15 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/rdoc/diagram.rb:
	    - properly quote bare element attributes
	    - terminates dangling elements (e.g. <img>, <br>, <link>, etc)
	    - converts "CVS" to the more HTML-friendly acronym element
	    - adds missing type attributes to style elements

	  based on Paul Duncan's patch <pabs@pablotron.org> [ruby-core:7028]

	* lib/rdoc/generators/html_generator.rb: ditto.
	* lib/rdoc/generators/template/html/hefss.rb: ditto.
	* lib/rdoc/generators/template/html/html.rb: ditto.
	* lib/rdoc/generators/template/html/kilmer.rb: ditto.

Thu Jan 12 11:53:08 2006  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tkballoonhelp.rb: [bug fix] couldn't add to a widget
	  which is constructed with TkComposite module.
	  [new feature] support 'command' option which is called just before
	  popping up the balloon help.

Wed Jan 11 00:12:29 2006  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/erb.rb (ERB::Compiler): add instance variable @insert_cmd to
	  change <%='s behavior.

Tue Jan 10 19:42:33 2006  Tanaka Akira  <akr@m17n.org>

	* gc.c (garbage_collect): mark ruby_current_node.
	  if an exception is raised in a finalizer written in C called by
	  rb_gc_call_finalizer_at_exit, ruby_set_current_source may use
	  collected ruby_current_node and mark_source_filename may corrupt
	  memory.

Tue Jan 10 13:30:34 2006  akira yamada  <akira@ruby-lang.org>

	* ext/syck/rubyext.c (syck_resolver_transfer): should be able to load
	  !ruby/object:Bignum syntax 1.8.3 dumped. [ruby-core:6159]

Tue Jan 10 12:47:41 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/yaml/rubytypes.rb (Fixnum): Bignum could not be loaded in
	  ruby 1.8.3/1.8.4. [ruby-core:6115]

	* lib/yaml/rubytypes.rb (Numeric): Subclass of Numeric could not
	  be dumped properly. [ruby-core:7047]

Tue Jan 10 12:00:48 2006  Aaron Schrab  <aaron @nospam@ schrab.com>

	* lib/yaml/rubytypes.rb (Symbol#yaml_new): YAML loading of quoted
	  Symbols broken. [ruby-Bugs:2535]

Tue Jan 10 07:26:52 2006  Tanaka Akira  <akr@m17n.org>

	* gc.c (gc_stress): renamed from always_gc and enabled by default.
	  (gc_stress_get): new function for GC.stress.
	  (gc_stress_set): new function for GC.stress=.

Mon Jan  9 19:58:56 2006  arton  <artonx@yahoo.co.jp>

	* ext/zlib/extconf.rb: zlib compiled DLL version 1.2.3 distributed by
	  http://www.zlib.net/ has zdll.lib. [ruby-dev:28209]

Mon Jan  9 14:25:00 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/Makefile.sub (OPTFLAGS): I have experienced trouble on y- flag,
	  (VisualC++6) so use -O2b2xg- if  $(MSC_VER) < 1400. [ruby-core:7040]

Mon Jan  9 14:25:00 2006  Kero van Gelder  <rubyforge @nospam@ kero.tmfweb.nl>

	* lib/webrick/httpservlet/filehandler.rb: fixed typo. [ruby-core:7075]

Sun Jan  8 14:15:27 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (GCC_VERSION_BEFORE): check __INTEL_COMPILER.
	  Intel C++ Compiler defines __GNUC__.
	  http://www.intel.com/software/products/compilers/clin/docs/ug_cpp/lin1077.htm

Sat Jan  7 15:40:07 2006  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (singleton): get rid of segfault on syntax error.
	  fixed: [ruby-core:07070]

Sat Jan  7 06:24:18 2006  Tanaka Akira  <akr@m17n.org>

	* eval.c (rb_fd_isset): compare the result of FD_ISSET with 0 to
	  avoid FreeBSD bug.  FreeBSD defines FD_ISSET as just a bitmap of
	  unsigned long.  So returning the value from rb_fd_isset discards
	  upper 32bits on LP64 environment.
	  http://www.freebsd.org/cgi/query-pr.cgi?pr=ia64/91421

Fri Jan  6 02:20:18 2006  Tanaka Akira  <akr@m17n.org>

	* configure.in: don't force getcontext on IA64.

	* eval.c (ruby_setjmp): add an argument for just before getcontext.
	  (THREAD_SAVE_CONTEXT): call rb_thread_save_context just
	  before getcontext.
	  [ruby-dev:28205]

Sun Jan  1 15:28:46 2006  Tanaka Akira  <akr@m17n.org>

	* missing.h (isinf): avoid macro expansion
	  "extern int isinf(double);" to
	  "extern int ((sizeof(double)==sizeof(float))?_Isinff(double):_Isinf(double));" on
	  HP-UX.

Sun Jan  1 14:42:54 2006  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_seekdir): should not segfault even if passed
	  the location which rb_w32_telldir didn't return. (and should change
	  `bits' position) [ruby-core:7035]

	* win32/dir.h: ditto. (stores `loc' instead of `bitpos')

	* test/ruby/test_dir.rb: added.

Sat Dec 31 22:57:00 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_save_context): should not recycle scope object used
	  in a thread.  fixed: [ruby-dev:28177]

Sat Dec 31 19:50:38 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c: attribute name was truncated with Rev1.64.

Sat Dec 31 11:53:16 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/generator.rb: (Generator#initialize): should kill @loop_thread
	  before starting new thread. (occurs when called via Generator#rewind)
	  [ruby-dev:28184]

Fri Dec 30 18:22:42 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (garbage_collect): mark objects referred from aborting threads.
	  [ruby-dev:28190]

	* win32/Makefile.sub: VC++8 support.

Fri Dec 30 15:17:35 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/generator.rb (Generator#initialize): ensured to stop @loop_thread.
	  Mr. Tanaka pointed out one Thread.pass is not enough. [ruby-dev:28185]

Fri Dec 30 12:20:57 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/generator.rb (Generator#initialize): fixed dead lock. this occurred
	  when end? was called before @loop_thread was stopped. [ruby-core:7029]

Fri Dec 30 01:04:52 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/generator.rb: should work with another thread. (more robust code)
	  [ruby-dev:28177]

Thu Dec 29 23:59:37 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_gc_mark_threads): keep unmarked threads which won't wake
	  up alone, and mark threads in the loading table.  [ruby-dev:28154]

	* eval.c (rb_gc_abort_threads), gc.c (gc_sweep): kill unmarked
	  threads.  [ruby-dev:28172]

Thu Dec 29 17:02:07 2005  Tanaka Akira  <akr@m17n.org>

	* test/ruby/envutil.rb (EnvUtil.rubybin): search "ruby" instead of
	  "miniruby".  [ruby-dev:28140]

Thu Dec 29 14:35:10 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_mod_define_method): should save safe_level in the
	  proc object.  [ruby-dev:28146]

Thu Dec 29 11:22:34 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/generator.rb: reimplemented Generator class with Thread instead of
	  callcc, in order to fix memory leak. [ruby-dev:28142]

Wed Dec 28 14:10:05 2005  Tanaka Akira  <akr@m17n.org>

	* ia64.s: remove .pred.safe_across_calls directive.
	  reported by WATANABE Tetsuya.  [ruby-dev:28141]

Wed Dec 28 01:32:39 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (struct thread): add bstr_max.
	  (rb_thread_save_context): use realloc instead of REALLOC_N
	  to avoid GC.

Tue Dec 27 23:59:53 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (CompletingHash#match): fix for 1.9.

Tue Dec 27 16:59:52 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/drb/drbtest.rb (DRbService::self.ext_service): increase
	  timeout limit.  a patch from Kazuhiro NISHIYAMA
	  <zn at mbf.nifty.com>. [ruby-dev:28132]

Tue Dec 27 14:17:55 2005  Tanaka Akira  <akr@m17n.org>

	* configure.in: define IA64 for portability.  (HP aC++/ANSI C doesn't
	  define __ia64__.)
	  don't check libunwind stuff.
	  check __libc_ia64_register_backing_store_base.

	* defines.h: declare rb_ia64_bsp and rb_ia64_flushrs.
	  (flush_register_windows): call rb_ia64_flushrs on IA64.

	* ia64.s: new file for IA64.
	  it is separated from C program files because
	  Intel C++ Compiler for IA64 doesn't support inline assembly.

	* common.mk (ia64.$(OBJEXT)): new target.

	* ruby.h (RUBY_INIT_STACK): defined.
	  (ruby_init_stack): declared for RUBY_INIT_STACK.

	* main.c (main): precedes RUBY_INIT_STACK before ruby_init.

	* gc.c (rb_gc_register_stack_start): new global variable on IA64.
	  (garbage_collect): simplify register stack marking code.
	  don't use libunwind.
	  (Init_stack): initialize rb_gc_register_stack_start.
	  (ruby_init_stack): new function for RUBY_INIT_STACK.

	* eval.c (struct thread): add bstr_pos member for original position of
	  register stack.
	  (rb_thread_save_context): simplify register stack saving code.
	  don't use libunwind.
	  (rb_thread_restore_context_0): new function.  moved from
	  rb_thread_restore_context except the stack position checking code.
	  don't use libunwind for IA64 register stack.
	  (register_stack_extend): new function.
	  (stack_extend): make it self-recursive with
	  the stack position checking code in old rb_thread_restore_context.
	  (rb_thread_restore_context): just call stack_extend.
	  (flush_register_windows): removed.

	  [ruby-dev:28127]

Tue Dec 27 14:09:39 2005  Minero Aoki  <aamine@loveruby.net>

	* process.c: new method Process.exec. [ruby-dev:28107]

Tue Dec 27 08:22:15 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::SSL::SSLSocket#post_connection_check):
	  treat wildcard character in commonName. [ruby-dev:28121]

Mon Dec 26 08:50:36 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (ev_const_get): fixed a bug in constant reference during
	  instance_eval.  [yarv-dev:707]

	* eval.c (ev_const_defined): ditto.

	* lib/yaml.rb (YAML::add_domain_type): typo fixed.  a patch from
	  Joel VanderWerf <vjoel at path.berkeley.edu>.
	  [ruby-talk:165285] [ruby-core:6995]

Fri Dec 23 10:30:23 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/digest/sha2/sha2.c (ULL): support AIX C.  a patch from
	  Kailden <kailden at gmail.com>.  [ruby-core:06984]

Wed Dec 21 16:47:35 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* file.c (w32_io_info): should return handle because FileIndex is
	  valid only while file is open. [ruby-dev:28088]

Wed Dec 21 12:12:21 2005  Tanaka Akira  <akr@m17n.org>

	* test/pathname/test_pathname.rb (test_kernel_open): use
	  File.identical?.
	  [ruby-talk:171804]

Tue Dec 20 22:41:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (eval_under_i): evaluate source in caller's frame.
	  [ruby-dev:28076]

Tue Dec 20 12:53:23 2005  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c (syck_emitter_reset): to ensure compatibility
	  with previous Ruby versions, documents are no longer headless.

Tue Dec 20 12:33:01 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c (syck_node_transform): ruby object holding
	  explicitly freed SyckNode caused SEGV. [ruby-dev:28067]

	... I think syck GC problem was solved now!

Tue Dec 20 01:46:48 2005  Tanaka Akira  <akr@m17n.org>

	* io.c (rb_f_backquote): fix a GC problem on
	  IA64 with gcc 4.0.3 20051216 (prerelease) -O3.

Mon Dec 19 23:32:39 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (XCFLAGS): separated as well as win32/Makefile.sub.

	* main.c (always_gc): dllimport is required for VC to import a DLL
	  symbol.  fixed: [ruby-dev:28051]

	* parse.y (rb_symname_p): fixed wrong validation.  [ruby-dev:28047]

Mon Dec 19 23:09:24 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* st.c: uses malloc instead of xmalloc to avoid GC. syck uses st_insert
	  in gram.c to insert node from rb_syck_bad_anchor_handler into
	  SyckParser's hash table. if GC occurs in st_insert, it's not under
	  SyckParser's mark system yet. so RString can be released wrongly.

	* ext/syck/syck.h (S_FREE): small hack. no need to check if pointer is
	  NULL or not before S_FREE.

	* ext/syck/rubyext.c (syck_parser_assign_io): rb_check_string_type can
	  return new RString. if so, it becomes unreachable from GC after
	  returns syck_parser_assign_io, and can be freed by GC. (dangling
	  in syck io system) so extends its life time till syck_parse is called.

	* ext/syck/rubyext.c (syck_parser_s_alloc): always allocates bonus,
	  so no need to check if NULL, and "volatile VALUE hash"
	  is not needed. (bonus->port was not protected in syck_emitter_reset)

	* ext/syck/rubyext.c (syck_mark_parser): ditto.

	* ext/syck/rubyext.c (syck_parser_load): ditto.

	* ext/syck/rubyext.c (syck_parser_load_documents): ditto.

	* ext/syck/rubyext.c (syck_emitter_s_alloc): ditto.

	* ext/syck/rubyext.c (syck_mark_emitter): ditto.

	* ext/syck/rubyext.c (syck_emitter_reset): ditto.

	* ext/syck/rubyext.c (syck_scalar_value_set): "should set newly
	  allocated memory instead of RString's internal storage" stuff again.
	  by this, should call syck_free_node instead of rb_syck_free_node.

	* ext/syck/rubyext.c (syck_node_type_id_set): ditto.

	... I believe syck GC problem was solved by this.

Mon Dec 19 12:20:59 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (FUNCTION_CALL_MAY_RETURN_TWICE): activate only
	  before gcc 4.0.3 on SPARC and IA64.

Mon Dec 19 11:37:47 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c: sorry, I reverted my "should set newly
	  allocated memory instead of RString's internal storage" stuff.
	  node allocated in rubyext.c seems to be freed by rb_syck_free_node
	  not syck_free_node, and it won't free data.str->ptr and type_id.

	 (I still think this is unsafe because RString(foo)->ptr becomes
	  dangling pointer when RString is modified or freed, but anyway
	  I misunderstood, so go back to original code for now)

Sat Dec 17 21:50:41 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c (syck_emitter_reset): should initialize
	  emitter->bonus->oid. otherwise rb_gc_mark crashes.

	* ext/syck/rubyext.c (syck_mark_parser): should mark anchor nodes
	  because they hold ruby objects. (ie: rb_syck_bad_anchor_handler)

Sat Dec 17 11:00:17 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/rubyext.c (rb_syck_compile): avoid potential memory
	  leak.

	* ext/syck/rubyext.c (syck_set_ivars): avoid potential memory
	  leak by explicit symbol allocation.

Sat Dec 17 03:57:01 2005  Tanaka Akira  <akr@m17n.org>

	* bignum.c (rb_big_rshift): fix a GC problem on
	  IA64 with gcc 4.0.3 20051216 (prerelease).

Sat Dec 17 03:30:23 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (bmcall): fix a GC problem by tail call on
	  IA64 with gcc 4.0.3 20051216 (prerelease).

Fri Dec 16 17:53:45 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c (rb_syck_compile): fixed memory leak.

	* ext/syck/rubyext.c: should protect global variable from GC.

Fri Dec 16 11:44:43 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c (syck_resolver_tagurize): fixed memory leak.

	* ext/syck/rubyext.c (syck_node_type_id_set): should set newly
	  allocated memory instead of RString's internal storage.

	* ext/syck/rubyext.c (syck_scalar_value_set): ditto.

	... these fixes won't fix [ruby-dev:27839]. more work is needed.

Fri Dec 16 04:38:55 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator::method_missing): should delegate
	  block as well.

Thu Dec 15 19:57:12 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension::MorphingBody): fix criteria to
	  use Tempfile.  A fix from Zev Blut <rubyzbibd at ubit.com>.
	  [ruby-core:06076]

	* string.c: remove global functions work on $_.

Thu Dec 15 12:35:14 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tmpdir.rb: merged RDoc patch from Eric Hodel <drbrain at
	  segment7.net>.  [ruby-core:06894]

Thu Dec 15 01:33:31 2005  Tanaka Akira  <akr@m17n.org>

	* ext/zlib/zlib.c (zstream_run): fix a GC problem by tail call on
	  x86_64 with gcc 4.0.3 20051111 (prerelease) (Debian 4.0.2-4)

Wed Dec 14 23:50:20 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parsers/parse_c.rb (find_class_comment): fix for class
	  document with prototypes.  [ruby-core:06863]

Wed Dec 14 23:39:53 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (has_magic): glob names contain alphabets to enable case fold
	  search.  [ruby-dev:27735]

	* dir.c (Init_Dir): FNM_SYSCASE which is default case fold flag.
	  [ruby-dev:23296]

Wed Dec 14 12:01:26 2005  Tanaka Akira  <akr@m17n.org>

	* marshal.c (r_object0): fix a GC problem for reading a bignum on
	  IA64 with gcc 3.3.5 (Debian 1:3.3.5-13).

Tue Dec 13 12:23:47 2005  Tanaka Akira  <akr@m17n.org>

	* re.c (rb_reg_regcomp): fix a GC problem on x86_64 with
	  gcc 3.3.5 (Debian 1:3.3.5-13).

Tue Dec 13 01:44:16 2005  Tanaka Akira  <akr@m17n.org>

	* array.c (rb_ary_diff): fix a GC problem on IA64 with
	  gcc 3.3.5 (Debian 1:3.3.5-13).
	  When rb_ary_push is called, there was no register which contains
	  `hash' but `&RHASH(hash)->tbl' instead.

Tue Dec 13 00:08:09 2005  Tanaka Akira  <akr@m17n.org>

	* sprintf.c (rb_str_format): fix a GC problem.
	  [ruby-dev:28001]

Mon Dec 12 15:51:22 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/openssl/test_ssl.rb (test_parallel): call GC.start to close
	  unused files. [ruby-dev:27981]

Mon Dec 12 09:58:09 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_cover): new method Range#cover? added.  the
	  method name might be changed.  thanks to takano32 at
	  http://www.rubyist.net/~matz/20051210.html#c08 for name
	  suggestion.  [ruby-talk:167182]

Mon Dec 12 00:33:56 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/digest/digest.c (rb_digest_base_s_digest): add volatile to
	  protect temporary context object.  [ruby-dev:27979]

	* ext/iconv/iconv.c (Init_iconv): rb_gc_register_address() should
	  be called before actual variable initialization.
	  [ruby-dev:27986]

Sun Dec 11 23:54:07 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/*: update to support libraries in ActiveTcl8.4.12.0
	  (see ext/tk/ChangeLog.tkextlib).

	* ext/tk/sample/scrollframe.rb: add a new sample.

Sun Dec 11 22:07:58 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb (test_remote_array_and_hash): pseudo remote
	  objects are protected against GC. [ruby-dev:27911]

Sat Dec 10 01:06:06 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/matrix.rb: add Matrix#determinant_e, Matrix#rank_e.
	  [ruby-dev:27820] and related thread.

Sat Dec 10 00:31:42 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (calling_scope_t): gave names to magic numbers for rb_call().
	  [ruby-dev:27978]

Fri Dec  9 23:31:02 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rexml/encoding.rb (encoding=): give priority to particular
	  conversion to iconv.  [ruby-core:06520]

Fri Dec  9 23:16:51 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* range.c (range_include): return false unless included in numeric
	  range.  fixed: [ruby-dev:27975]

Thu Dec  8 02:07:19 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (umethod_bind): adjust invoking class for module method.
	  [ruby-dev:27964]

Thu Dec  8 00:40:52 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (call_trace_func): klass parameter should be a
	  class/module that defines calling method.  [ruby-talk:169307]

Wed Dec  7 17:10:27 2005  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* sprintf.c (rb_f_sprintf): [ruby-dev:27967]

Wed Dec  7 16:39:18 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_include): use discrete membership for non Numeric
	  values, for example, String.

	* numeric.c (num_scalar_p): new method. [ruby-dev:27936]

	* lib/complex.rb (Complex#scalar?): ditto.

Wed Dec  7 15:31:35 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_str_format): integer overflow check added.

	* sprintf.c (GETASTER): ditto.

Wed Dec  7 01:02:04 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/README.macosx-aqua: [new document] tips to avoid the known
	  bug on platform specific dialogs of Tcl/Tk Aqua on MacOS X.

	* ext/tk/tcltklib.c: fix bug on switching threads and waiting on the
	  deleted interpreter on vwait and tkwait command.

	* ext/tk/lib/multi-tk.rb: kill the meaningless loop for the deleted Tk
	  interpreter.

	* ext/tk/sample/demos-jp/image3.rb: [bug fix] wrong argument.

	* ext/tk/sample/demos-en/image3.rb: ditto.

	* ext/tk/sample/demos-jp/menu.rb: fix message for MacOS X.

	* ext/tk/sample/demos-jp/menu8x.rb: ditto.

	* ext/tk/sample/demos-en/menu.rb: ditto.

Tue Dec  6 16:48:40 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (ruby_xmalloc2): change check condition for integer
	  overflow.  [ruby-dev:27399]

	* gc.c (ruby_xrealloc2): ditto.

Tue Dec  6 16:37:57 2005  Yuya Nishida  <yuya@j96.org>

	* eval.c (exec_under): avoid accessing ruby_frame->prev.
	  [ruby-dev:27948]

Fri Dec  2 19:06:06 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (Compare): should not fold double byte alphabet on win9x.

Thu Dec  1 00:50:33 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_funcall2): allow to call protected methods.
	  fixed: [ruby-dev:27890]

Wed Nov 30 23:52:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (struct parser_params): fields common to ripper must be
	  placed at each same offset.

	* parse.y (NEWHEAP, ADD2HEAP): set count after pointer was set.
	  fixed: [ruby-dev:27896]

Wed Nov 30 13:43:07 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg): support $! at the end of
	  expression.   [ruby-dev:27868]

Tue Nov 29 23:57:05 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (struct parser_params): heap must be placed at same offset
	  also in ripper.y.  fixed: [ruby-dev:27846]

	* parse.y (yycompile): prevent vparser from tail call optimization.
	  fixed: [ruby-dev:27851]

	* parse.y (parser_mark): value needs to be marked.
	  fixed: [ruby-dev:27845]

Tue Nov 29 22:45:30 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/observer.rb (notify_observers): follow change of observer.rb.
	  fixed: [ruby-core:6796]

Mon Nov 28 20:24:22 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb (PP::PPMethods#object_address_group): mask an address with
	  word size.

	* lib/pp.rb (PP::PPMethods#object_address_group): adjust address format.

Mon Nov 28 18:55:22 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (init_inetsock_internal): remove setting
	  SO_REUSEADDR option on server socket on Cygwin.
	  fixed: [ruby-core:6765] ([ ruby-Bugs-2872 ])

Mon Nov 28 13:11:45 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_strerror): remove all CR and LF. (avoid broken
	  error message on bccwin32 + winsock)

Mon Nov 28 09:15:50 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/mkmf.rb (create_makefile): should not change sodir with
	  dir.gsub!. (bccwin32 failed to install third party extensions)
	  [ruby-dev:27834]

Sun Nov 27 05:37:20 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb: use File.basename to decompose pathnames.
	  experimental Windows support.

Sun Nov 27 00:56:13 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/wsdl/xmlSchema/complexContent.rb: missing
	  ComplexContent#elementformdefault method.

Sat Nov 26 19:57:45 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* dln.c (conv_to_posix_path): should initialize posix.

Fri Nov 25 20:34:56 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/xmlrpc/datetime.rb (DateTime::to_a): comparison with non
	  array-convertible object must return false.

Fri Nov 25 14:34:09 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_max): treat end exclusion without iteration if
	  the end value is an integer.  [ruby-talk:167433]

Fri Nov 25 12:52:57 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: added backward compatibility codes.
	* lib/rss/parser.rb: ditto.
	* test/rss/test_parser.rb: ditto.
	* test/rss/test_2.0.rb: ditto.

	* test/rss/test_content.rb: use #__send__ instead of #funcall for
	  no private method.

Fri Nov 25 12:39:56 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: improved type conversion.
	* lib/rss/1.0.rb: ditto.
	* lib/rss/0.9.rb: ditto.
	* lib/rss/2.0.rb: ditto.
	* lib/rss/image.rb: ditto.
	* lib/rss/syndication.rb: ditto.

	* test/rss/test_2.0.rb: added type conversion tests.
	* test/rss/test_accessor.rb: ditto.
	* test/rss/test_to_s.rb: ditto.
	* test/rss/test_syndication.rb: ditto.
	* test/rss/test_setup_maker_2.0.rb: ditto.
	* test/rss/test_setup_maker_1.0.rb: ditto.
	* test/rss/test_setup_maker_0.9.rb: ditto.
	* test/rss/test_maker_sy.rb: ditto.
	* test/rss/test_maker_image.rb: ditto.
	* test/rss/test_maker_2.0.rb: ditto.
	* test/rss/test_maker_0.9.rb: ditto.
	* test/rss/test_image.rb: ditto.

	* test/rss/test_maker_1.0.rb: use assert instead of assert_equal.

	* test/rss/rss-assertions.rb: improved type conversion assertions.

Fri Nov 25 10:38:20 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/image.rb: added Image prefix.

	* lib/rss/maker/image.rb: ditto.

Fri Nov 25 10:33:02 2005  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_2.0.rb: added RSS 2.0 tests.

	* test/rss/rss-assertions.rb: extended XML stylesheet assertion.

	* lib/rss/0.9.rb: added initialize method.

	* test/rss/test_1.0.rb: cleanup.

Fri Nov 25 10:29:48 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_min): use <=> comparison rather than iteration.
	  [ruby-talk:167420]

	* range.c (range_max): ditto.

Thu Nov 24 01:31:44 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* file.c (w32_io_info): CreateFile failed on Win9x if file was already
	  opened. (FILE_SHARE_READ was needed, but actually I don't understand
	  the flags of CreateFile well...)

Wed Nov 23 23:52:35 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (num_div): use floor rather than rb_Integer().
	  [ruby-dev:27674]

Wed Nov 23 22:34:15 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb: added entity handling type predicate.
	* lib/rss/rexmlparser.rb: ditto.
	* lib/rss/xmlparser.rb: ditto.
	* lib/rss/xmlscanner.rb: ditto.

	* lib/rss/xmlscanner.rb: more robust entity handling.

	* test/rss/test_parser.rb: added an entity handling test.

Wed Nov 23 20:59:01 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: add Tk.pkgconfig_list and Tk.pkgconfig_get
	  [Tk8.5 feature].

	* ext/tk/lib/tk/text.rb: supports new indices modifiers on a Text
	  widget [Tk8.5 feature].

	* ext/tk/lib/tk/virtevent.rb: add TkNamedVirtualEvent.

	* ext/tk/lib/tk/autoload.rb: ditto.

	* ext/tk/lib/tk/event.rb: add :data key for virtual events [Tk8.5
	  feature].

Wed Nov 23 18:52:45 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* file.c (w32_io_info): should not call GetFileInformationByHandle
	  for pipe.

	* file.c (w32_io_info): checks return value from rb_w32_get_osfhandle.

	* file.c (w32_io_info): now can identify directory on WinNT.

Wed Nov 23 18:46:53 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/: use #__send__ instead of #send.
	* test/rss/: ditto.

Wed Nov 23 18:32:56 2005  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_taxonomy.rb: use #reject directory.

Wed Nov 23 18:26:00 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/taxonomy.rb: changed class or module prefix to
	  Taxonomy from Taxo.
	* lib/rss/maker/taxonomy.rb: ditto.

Wed Nov 23 18:21:11 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/taxonomy.rb: implemented taxonomy module for RSS
	  Maker.
	* lib/rss/taxonomy.rb: supported RSS Maker.
	* lib/rss/maker.rb: added taxonomy module support.

	* lib/rss/rss.rb: adjusted to other element API.
	* lib/rss/1.0.rb: adjusted to other element API but backward
	  compatibility is reserved.
	* lib/rss/0.9.rb: ditto.

	* test/rss/test_maker_taxo.rb: added test case for taxonomy module
	  for RSS Maker.
	* test/rss/test_setup_maker_1.0.rb: added tests for taxo:topic.

	* test/rss/test_setup_maker_1.0.rb: added backward compatibility
	  test.
	* test/rss/test_setup_maker_0.9.rb: ditto.
	* test/rss/test_setup_maker_2.0.rb: ditto.

	* test/rss/rss-testcase.rb: added convenience method for setting
	  up taxo:topic.
	* test/rss/rss-assertions.rb: added assertion for taxo:topic.

	* sample/rss/blend.rb: followed new API.

Wed Nov 23 17:42:24 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: fixed a indentation bug.

	* lib/rss/taxonomy.rb: fixed <taxo:topic> #to_s bug.

	* test/rss/test_taxonomy.rb: added a #to_s test.

Wed Nov 23 03:40:49 2005  Guy Decoux  <ts@moulon.inra.fr>

	* re.c (KR_REHASH): should cast to unsigned for 64bit CPU.
	  [ruby-core:06721]

Wed Nov 23 07:26:44 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: check for X509V3_EXT_nconf_nid.

	* ext/openssl/ossl_x509ext.c (MakeX509ExtFactory): should use
	  OPENSSL_malloc to allocate X509V3_CTX.

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_create_ext): use
	  X509V3_EXT_nconf_nid to avoid SEGV (and to build extensions which
	  values are placed in separate section).

	* test/openssl/test_x509ext.rb: new file.

Wed Nov 23 01:22:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (test_identical): test if two files are identical.

	* file.c (rb_f_test): support DOSISH systems where st_ino is not
	  reliable.  fixed: [ruby-core:06672]

	* win32.h, win32.c (rb_w32_osid): check the running platform.

Tue Nov 22 23:52:06 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb: match incomplete (in current enconding) multibyte
	  string.  http://inamode6.tokuhirom.dnsalias.org/show/1551

Tue Nov 22 18:36:11 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (winnt_stat): set mapped errno instead of ENOENT.

Tue Nov 22 14:36:54 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (rb_file_s_basename): skip slashes just after UNC top slashes.

	* test/ruby/test_path.rb (test_dirname, test_basename): follow new
	  spec. and add new tests.

Tue Nov 22 13:30:15 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_stat): Dir.chdir('//server/shared');
	  p Dir.glob('*') should work on WinNT. (implemented our own
	  stat(2) on WinNT) [ruby-list:41552] [ruby-dev:27711]

Tue Nov 22 02:31:53 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkextlib/tile.rb: bug fix (Tk::Tile::USE_TTK_NAMESPACE
	  is not defined).

Tue Nov 22 01:45:21 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_basename): DOSISH_UNC is defined on cygwin but
	  DOSISH is not.  fixed: [ruby-dev:27797]

Mon Nov 21 22:50:48 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_path_skip_prefix, rb_file_s_basename): UNC without path
	  should not be splitted.  fixed: [ruby-dev:27776] [ruby-dev:27786]

	* parse.y (dsym): prohibit empty symbol literal by interpolation.
	  fixed: [ruby-talk:166529]

Mon Nov 21 16:03:48 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/setup.mk: findstr doesn't exist on win9x.
	  fixed: [ruby-dev:27756]

Sun Nov 20 21:39:27 2005  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* regparse.c (fetch_token_in_cc): tok->escaped should be
	  initialized.  [ruby-dev:27763]

Sun Nov 20 22:34:06 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_symname_p): [ not followed by ] is not valid symbol.
	  fixed: [ruby-talk:166520]

Sat Nov 19 19:57:54 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::ln): ln documentation fix.
	  [ruby-core:06661]

Sat Nov 19 08:19:38 2005  Zach Dennis  <zdennis@mktec.com>

	* ext/socket/socket.c: Socket Documentation. [ruby-core:6552]

Sat Nov 19 07:34:32 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/font.rb: remove dependency on Ruby's version (1.8
	  or 1.9).

	* ext/tk/lib/tkextlib/ICONS/icons.rb: ditto.

	* ext/tk/sample/tkextlib/treectrl/demo.rb: ditto.

Fri Nov 18 18:07:05 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (rb_file_s_dirname): should use skipprefix for UNC path.
	  pointed out by nobu ([ruby-dev:27744]). fixed: [ruby-core:5076]

Fri Nov 18 17:35:09 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: add restriction to access the entried
	  command table and manipulate other IPs (for reason of security).
	  Now, a IP object can be controlled by only its master IP or the
	  default IP.

	* ext/tk/lib/remote-tk.rb: add restriction to manipulate.

	* ext/tk/tcltklib.c (ip_is_slave_of_p): add TclTkIp#slave_of?(ip)
	  to check manipulability.

	* ext/tk/lib/tk.rb: bug fix on handling of Tcl's namespaces.

	* ext/tk/lib/tk/namespace.rb: ditto.

Fri Nov 18 16:47:33 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (rb_file_s_dirname): added checks for some patterns with drive
	  letter. fixed: [ruby-dev:27738]

	* test/ruby/test_path.rb (test_dirname): added tests for above
	  patterns.

Fri Nov 18 12:19:16 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.h (S_IFIFO): r,w = IO.pipe; r.stat.pipe? now
	  returns true on VisualC++6.

Thu Nov 17 17:58:00 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/1.0.rb: added convenience method 'resources'.

	* lib/rss/taxonomy.rb: ditto.

	* test/rss/rss-assertions.rb: added test for 'resources'.

	* test/rss/test_taxonomy.rb: ditto.

Thu Nov 17 17:53:30 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/taxonomy.rb: implemented taxonomy module.

	* test/rss/test_taxonomy.rb: added tests for taxonomy support.

Thu Nov 17 17:40:19 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/1.0.rb: added rdf:Bag.

Thu Nov 17 13:52:00 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: removed needless argument 'prefix'.

	* lib/rss/parser.rb: ditto.

Wed Nov 16 23:24:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (static-ruby): overridable.

	* ext/extmk.rb (parse_args): force to link extensions statically only
	  if static is given for extstatic.

	* ext/extmk.rb (RUBY, RUBYW): overridable.

Wed Nov 16 01:29:31 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/trackback.rb: added TrackBack prefix.

	* lib/rss/maker/trackback.rb: ditto.

Wed Nov 16 01:26:13 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::VERSION): 0.1.5 -> 0.1.6.

	* test/rss/test_version.rb (RSS::TestVersion#test_version): ditto.

Tue Nov 15 23:54:24 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_load_ok): eaccess() returns 0 on success.
	  fixed: [ruby-dev:27713]

Tue Nov 15 16:36:03 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* array.c (rb_ary_fill): previous commit disabled this usage:

	    a = [0,1,2,3,4,5,6,7,8,9]
	    a.fill {|i| a[i] * 10} #=> [nil, nil, ...., nil]

	  previous commit has the advantage of early garbage collection, but
	  potentially this would break some script. so I reverted behavior.

Tue Nov 15 16:15:23 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (file_load_ok): use eaccess() instead of actually opening
	  the file.  [ruby-talk:156378]

	* lib/jcode.rb (String::reverse): add new methods.
	  [ruby-list:41245]

Tue Nov 15 15:49:34 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* array.c (rb_ary_fill): tail elements were vanished when the middle
	  part of array was filled. (ie: [0,1,2,3,4].fill(-1,2,1) => [0,1,-1])

	* test/ruby/test_array.rb (test_fill): added.

Tue Nov 15 14:39:16 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_fill): should adjust array length correctly when
	  an array is expanded in the fill process.  [ruby-core:06625]

Mon Nov 14 23:49:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_readlink): ERANGE will occur only on GPFS.
	  [ruby-dev:27699]

Mon Nov 14 17:36:22 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_first): RDoc update from Daniel Berger
	  <djberg96@yahoo.com>.  [ruby-core:06577].

Sun Nov 13 10:55:24 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/uri/common.rb (escape): regard second argument as a
	  character set. [ruby-dev:27692]

Sat Nov 12 08:36:40 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, eval.c, intern.h: check fd_mask type.

	* configure.in (socketpair): need to be checked.

Fri Nov 11 19:53:47 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* eval.c, intern.h: failed to compile where NFDBITS is defined but
	  howmany() is not defined. [ruby-dev:27680]

	* io.c (is_socket): failed to compile where S_ISSOCK is not defined.

	* io.c (pipe_open): failed to compile where socketpair is not supported.

Fri Nov 11 08:20:56 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (OUTFLAG): keep trailing spaces.  [ruby-dev:27666]

	* mkconfig.rb: substitution references added.

Fri Nov 11 07:39:49 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* configure.in: undef HAVE_LINK on BeOS. (link(2) always returns
	  EINVAL, and this causes error in test/fileutils.)

	* file.c: override chown(2) and fchown(2) on BeOS. (these functions
	  should not change user/group id if -1 is passed as corresponding
	  argument, and this causes error in test/fileutils too)
	  [ruby-dev:27672]

Thu Nov 10 21:05:03 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/shellwords.rb: fix for blank but not empty string.
	  fixed: [ruby-dev:27663]

Wed Nov  9 08:39:38 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/shellwords.rb: refactored.  [ruby-core:06581]

Tue Nov  8 17:35:53 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* intern.h, eval.c (rb_thread_signal_raise): constified.

	* signal.c: cosmetic change.

Tue Nov  8 15:32:27 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/drb/ssl.rb (DRb::SSLConfig#accept): fixed typo.
	  [ruby-dev:27560] [ruby-core:4627]

Mon Nov  7 20:54:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c: iconvctl() support.  [EXPERIMENTAL]

Mon Nov  7 16:23:23 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl.h: need to include winsock2.h before including
	  windows.h by some openssl headers.

Mon Nov  7 13:43:51 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/stubs.c (_nativethread_consistency_check): use simpler
	  (low cost) way to check whether the Tcl interpreter was compiled
	  with threads enabled of not.

	* ext/tk/tcltklib.c: reduce warnings.

	* ext/tk/tkutil/tkutil.c: ditto.

Mon Nov  7 00:06:12 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/yaml.rb: removed :nodoc: to generate Kernel doc. [ruby-core:6324]

Sun Nov  6 23:39:13 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Iconv::BrokenLibrary): exception when detected a
	  bug of underlying library.

Sun Nov  6 21:43:22 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/stubs.c (ruby_tcl_create_ip_and_stubs_init): should touch
	  interpreter after initialization is done. [ruby-dev:27638]

Sun Nov  6 20:13:27 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_readlink): readlink(2) on AIX fails with ERANGE if
	  buffer size is less than required.  fixed: [ruby-dev:27634]

Sat Nov  5 13:42:50 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, cygwin/GNUmakefile.in (mingw): use def file to alias
	  symbols.  [ruby-dev:27532]

	* bcc32/mkexports.rb, win32/mkexports.rb: make aliases in DLL.

	* win32/win32.c, win32/win32.h: replace symbols only when RUBY_EXPORT
	  is defined.

Thu Nov  3 07:57:39 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/open-uri.rb (open_loop): find_proxy should return nil when
	  proxy does not exist. [ruby-dev:27630]

Wed Nov  2 20:25:28 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: ext/tk/extconf.rb: change the check parameter
	  for Win32.

Wed Nov  2 19:03:06 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_rbUpdateObjCmd, ip_rb_threadUpdateObjCmd):
	  passed improper flags to DoOneEvent().

	* ext/tk/tkutil/tkutil.c: use rb_obj_respond_to() instead of
	  rb_respond_to().

Tue Nov  1 14:20:11 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call_super): should call method_missing if super is
	  called from Kernel method.

	* eval.c (exec_under): frame during eval should preserve external
	  information.

Tue Nov  1 10:48:49 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: should check ERR_peek_last_error().
	  [ruby-dev:27597]

	* ext/openssl/ossl.c (ossl_raise): ditto.

Mon Oct 31 17:34:46 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: use proper option for Sun linker. A patch from
	  Shinya Kuwamura <kuwa at labs.fujitsu.com>.  [ruby-dev:27603]

Mon Oct 31 05:46:08 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_update): input data must
	  not be empty. [ruby-talk:161220]

	* test/openssl/test_cipher.rb: add test for Cipher#update("").

Mon Oct 31 05:38:26 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservlet/cgihandler.rb
	  (WEBrick::HTTPServlet::CGIHandler#do_GET): the value of Set-Cookie:
	  header field should be splited into each cookie.  [ruby-Bugs:2199]

	* lib/webrick/cookie.rb (WEBrick::Cookie.parse_set_cookie): new method
	  to parse the value of Set-Cookie: header field.

	* test/webrick/test_cookie.rb, test/webrick/test_cgi.rb,
	  test/webrick/webrick.cgi: add some test for cookie.

Mon Oct 31 02:33:25 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_rshift): RDoc fix.  [ruby-core:6351]

	* util.h (strtod): add #undef for platforms defines strtod()
	  macro.   [ruby-dev:27563]

Mon Oct 31 02:31:41 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_float.rb (test_precision): test by assert_in_delta.
	  [ruby-dev:27575]

Sat Oct 29 01:58:25 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/etc/etc.c: document update from mathew <meta@pobox.com>.
	  [ruby-core:06473]

	* ext/fcntl/fcntl.c: ditto.

Sat Oct 29 16:56:03 2005  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: added seven predicates sunday? to saturday?.

	* lib/date.rb: added two methods {prev,next}_month,
	  that are almost same as << and >>.

Thu Oct 27 20:34:43 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (enumerator_allocate): allow subclassing.

Thu Oct 27 16:45:31 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (scan_once): wrong condition to use mbclen2().
	  [ruby-dev:27535]

Thu Oct 27 11:53:17 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* missing.h, missing/memcmp.c, missing/memmove.c:
	  ANSI compatible interface.

Wed Oct 26 09:15:48 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/implicit.c (syck_type_id_to_uri): should return
	  newly allocated memory. otherwise, type_id will be freed
	  twice. [ruby-dev:27384] [ruby-core:6385]

Wed Oct 26 01:58:19 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_EXTERN): macro to export symbols in shared
	  library.  [ruby-core:05528]

	* defines.h, {bcc32,win32,wince}/Makefile.sub (RUBY_EXTERN): moved to
	  configuration pass.

	* ext/extmk.rb (extmake): RUBY_EXTERN for static linked extensions.

Tue Oct 25 20:06:59 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ruby.h (Qfalse, Qtrue, Qnil, Qundef): make sure these immediate
	  values have VALUE type. there is an environment where sizeof(VALUE)
	  != sizeof(int) like IA64. if 32bit integer (Qtrue) is passed to ANYARGS
	  and received by 64bit integer (VALUE), upper bits may have garbage value.
	  [ruby-dev:27513]

Tue Oct 25 15:32:00 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rational.rb: applied documentation patch from Gavin Sinclair
	  <gsinclair@gmail.com>.  [ruby-core:06364]

	* lib/irb.rb (IRB::Irb::eval_input): handle prompts with newlines
	  in irb auto-indentation mode.  [ruby-core:06358]

Tue Oct 25 14:21:46 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* gc.c (garbage_collect): sorry, previous commit was incorrect.
	  [ruby-core:6386]

Tue Oct 25 13:40:16 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* gc.c (garbage_collect): return now whether there're rooms for new
	  objects, rather than whether GC run. fixed: [ruby-core:6376]

Tue Oct 25 02:12:08 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/markup/simple_markup.rb (SM::SimpleMarkup::LABEL_LIST_RE):
	  reduce redundant backtrack.  [ruby-talk:161771]

Tue Oct 25 00:35:33 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/*: RDoc documentation from Eric Hodel
	  <drbrain@segment7.net> added.

Mon Oct 24 21:14:29 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, io.c: use sys/syscall.h if syscall.h is not available.
	  [ruby-core:06247]

Mon Oct 24 20:38:25 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/Win32API/lib/win32/resolv.rb (get_info): support multiple DNS.
	  fixed: [ruby-list:40058], [ruby-dev:27479]

Mon Oct 24 11:01:11 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/canvas.rb (TkCanvasItemConfig::__item_val2ruby_optkeys):
	  typo fixed.  [ruby-talk:162187]

	* ext/tk/lib/tk/menu.rb (TkMenuEntryConfig::__item_val2ruby_optkeys):
	  ditto.  [ruby-core:06359]

Mon Oct 24 07:57:56 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/tk/lib/tk/canvas.rb (TkCanvasItemConfig::__item_val2ruby_optkeys):
	  typo fixed.  [ruby-talk:162187]

	* ext/tk/lib/tk/menu.rb (TkMenuEntryConfig::__item_val2ruby_optkeys):
	  ditto.  [ruby-core:06359]

	* lib/matrix.rb (Matrix::initialize): use funcall instead of send
	  to allow private methods to be called.  A report from
	  Jean-Claude Arbaut <jcarbaut@laposte.net>.  [ruby-core:06359]

Mon Oct 24 00:41:18 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_sunday): added predicate methods for the days of the
	  week.  [ruby-list:41340]

Sun Oct 23 07:11:11 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: improve messages [ruby-core:06325].

	* ext/tk/lib/tk.rb, ext/tk/lib/tk/canvas.rb, ext/tk/lib/tk/entry.rb,
	  ext/tk/lib/tk/frame.rb, ext/tk/lib/tk/image.rb,
	  ext/tk/lib/tk/itemconfig.rb, ext/tk/lib/tk/labelframe.rb,
	  ext/tk/lib/tk/listbox.rb, ext/tk/lib/tk/menu.rb,
	  ext/tk/lib/tk/radiobutton.rb, ext/tk/lib/tk/scale.rb,
	  ext/tk/lib/tk/spinbox.rb, ext/tk/lib/tk/text.rb,
	  ext/tk/lib/tk/toplevel.rb: improve conversion of option values.

	* ext/tk/lib/tkextlib/*: ditto.

	* ext/tk/lib/tkextlib/*: update to support ActiveTcl8.4.11.2.

	* ext/tk/lib/tkextlib/trofs/*: support Trofs 0.4.3.

	* ext/tk/lib/tkextlib/tile/*: support Tile 0.7.2.

	* ext/tk/lib/tkextlib/vu/*: support vu 2.3.0.

	* ext/tk/lib/tkextlib/tcllib/*: support Tcllib 1.8 (Tklib 0.3).

Sat Oct 22 23:54:07 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb, lib/mkmf.rb (with_config): support --with-extension
	  options.  [ruby-dev:27449]

Sat Oct 22 14:25:43 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* util.[hc] (ruby_add_suffix): constified.

	* util.[hc] (ruby_scan_{oct,hex}): fixed typo. (renamed from
	  scan_{oct,hex})

	* util.c: almostly ANSI styled. (except for functions depending on
	  macro and K&R technique)

Sat Oct 22 13:26:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (sym_inspect), parse.y (parser_yylex, rb_symname_p): check
	  if valid as a symbol name more strictly.  [ruby-dev:27478]

	* test/ruby/test_symbol.rb: tests for [ruby-core:03573].

	* time.c (rb_strftime): removed meaningless volatile modifiers, and
	  concatenate successive nul characters at once.  [ruby-dev:27472]

	* ext/tk/lib/tk/font.rb, ext/tk/lib/tkextlib/ICONS/icons.rb,
	  ext/tk/sample/tkextlib/treectrl/demo.rb, lib/net/imap.rb,
	  lib/rss/parser.rb, test/rss/test_content.rb,
	  test/rss/test_dublincore.rb, test/rss/test_syndication.rb,
	  test/rss/test_trackback.rb, test/ruby/test_eval.rb,
	  test/socket/test_socket.rb, test/socket/test_udp.rb:
	  Object#fcall was renamed as Object#funcall.

Sat Oct 22 10:08:28 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* missing.h, missing/*.c: SUSv3 compatible strcasecmp and strncasecmp,
	  ANSI compatible strtol and strtoul, and ANSI styled other functions.

Fri Oct 21 19:16:08 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* rubysig.h (CHECK_INTS): fixed typo. (I believe bit-or is improper)

Fri Oct 21 17:49:32 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bin/erb (ERB::Main::run): typo fixed.  [ruby-core:06337]

Fri Oct 21 15:42:28 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* intern.h, struct.c (rb_struct_iv_get): constified.

	* marshal.c: avoid one VC++6 warning for implicit conversion
	  from int to char.

	* ruby.h: ANSI styled.

	* bcc32/Makefile.sub (HAVE_HYPOT): added.

	* ext/socket/extconf.rb: BeOS is only one platform should call
	  closesocket, so check __BEOS__ macro directly. (I was worried
	  accidentally HAVE_CLOSESOCKET is defined on windows again because
	  it has it)

	* ext/socket/{getaddrinfo.c,socket.c}: ditto.

	... these are all cosmetic changes.

Fri Oct 21 15:23:23 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bignum.c (bignew_1): conversion from `int' to `char' discards
	  upper bits, (ie. (char)0xff00 -> 0) so it's better to test if
	  nonzero and set 0 or 1 instead of simply casting ... as a flag usage.
	  (but I believe this won't cause actual bug in current implementation)
	  [ruby-dev:27055]

	* time.c: should use LONG_LONG instead of `long long'.

Thu Oct 20 22:22:49 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parser.y (struct parser_params): parser never modify input string.

	* ext/ripper/tools/preproc.rb (prelude): do not append surplus
	  newlines to fix line numbers.

Thu Oct 20 11:41:57 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* class.c, eval.c, hash.c, st.c, variable.c: changed /* ??? */ stuff
	  protoize generated to ANYARGS.

Thu Oct 20 11:18:11 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* eval.c, file.c, ruby.c: removed strchr, strrchr, strstr definition
	  because they are defined in missing.h.

	* missing.h, missing/strchr.c, missing/strstr.c: ANSI styled.

Thu Oct 20 09:36:06 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/mkmf.rb (create_makefile): Borland make seems not to allow
	  empty dependency list. If this change is not good, please correct
	  it.

Thu Oct 20 07:55:09 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): get rid of a restriction
	  of Borland make.  fixed: [ruby-dev:27460]

	* ext/ripper/depend: ditto.

Wed Oct 19 23:58:03 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): do not create unnecessary empty
	  directories.  fixed: [ruby-dev:27451]

Wed Oct 19 08:28:32 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_join): elements may contain null pointer strings.
	  report and fixed by Lloyd Zusman (hippoman): [ruby-core:06326]

Wed Oct 19 02:34:33 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c, eval.c, gc.c, parse.y, regparse.c, sjis.c, time.c:
	  made internal symbols static.  [ruby-dev:27435]

Tue Oct 18 10:58:27 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/depend, ext/dl/extconf.rb, ext/socket/depend,
	  ext/socket/extconf.rb: shouldn't define DESTCLEANFILES in depend,
	  use $distcleanfiles in extconf.rb.

	* win32/Makefile.sub (distclean-local): should remove .config.h.time.

Mon Oct 17 09:42:50 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* mkconfig.rb: fixup configure_args for mswin32 configure.

	* win32/configure.bat (srcdir, target): ditto.

Mon Oct 17 05:01:50 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* env.h: move struct METHOD and struct BLOCK from eval.c to
	  support NodeWrap and ParseTree.

Sun Oct 16 22:16:51 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: omit non-existing directories.

Sun Oct 16 14:40:54 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/rinda.rb (Rinda::Tuple#initialize): check remote hash
	  tuple. fixed: [ruby-list:41227]

	* test/rinda/test_rinda.rb: test it.

Sun Oct 16 03:38:07 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* rubysig.h (CHECK_INTS): prevent signal handler to run during
	  critical section.  [ruby-core:04039]

	* eval.c (load_wait): need not to call rb_thread_schedule()
	  explicitly.  [ruby-core:04039]

	* eval.c (rb_thread_schedule): clear rb_thread_critical.
	  [ruby-core:04039]

Sun Oct 16 00:13:14 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/configure.bat: remove unnecessary line which prevents
	  creating Makefile.

Sat Oct 15 23:52:07 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb: (getbinaryfile): allow nil for localfile, and
	  returns retrieved data if localfile is nil.

	* lib/net/ftp.rb: (gettextfile): ditto.

Sat Oct 15 19:51:29 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* bin/erb: typo fixed, again. thanks, Doug Kearns.

Fri Oct 14 23:09:31 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (MKFILES): update MKFILES if configure files get
	  changed.

	* win32/configure.bat, win32/setup.mak (configure_args): store
	  arguments to configure files.

Fri Oct 14 22:05:45 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (ioctl): should set errno.

Fri Oct 14 16:39:37 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/config.rb (Config::FileHandler): :UserDir should be nil.
	  It is harmful to permit the access to ~/public_html by default.
	  suggested by Hiroyuki Iwatsuki.

Fri Oct 14 04:58:38 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_obj_instance_exec): create instance_exec and
	  module_exec which pass arguments to the block.

	* eval.c (rb_f_funcall): rename fcall to funcall to follow
	  tradition.

Thu Oct 13 23:29:51 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (HEAPCNT): bison allocates indivisible size.
	  fixed: [ruby-core:06261]

	* io.c, pack.c, ext/syck/rubyext.c, ext/syck/syck.h, missing/isinf.c:
	  get rid of warnings.  fixed: [ruby-core:06247]

Wed Oct 12 12:51:56 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.c (Init_openssl): should call
	  OpenSSL_add_ssl_algorithms().

Wed Oct 12 11:08:54 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* file.c (rb_f_test): typo in RDoc comments.

Tue Oct 11 21:41:58 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_FUNC_ATTRIBUTE): check prefixed attribute form
	  first.  [ruby-dev:27398]

	* array.c, enum.c, eval.c, util.c: safer function pointer usage.
	  fixed: [ruby-core:06143]

	* util.h (qsort): removed the definition incompatible to ANSI.
	  fixed: [ruby-core:06147]

	* eval.c (rb_obj_respond_to): check if obj responds to the given
	  method with the given visibility.  [ruby-dev:27408]

	* eval.c (rb_respond_to): conform to Object#respond_to?.  [ruby-dev:27411]

Tue Oct 11 00:01:21 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* st.c (st_free_table): do not call free() but xfree().
	  [ruby-core:06205]

Sat Oct  8 19:49:42 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (Init_Binding): add Binding#dup method.  [yarv-dev:666]

	* io.c (rb_io_init_copy): clear PREP flag for copied IO.
	  fixed: [ruby-dev:27371]

	* parse.y (rb_parser_malloc, rb_parser_free): manage parser stack on
	  heap.  [ruby-list:41199]

	* parse.y (ripper_initialize): use rb_respond_to().

	* ext/ripper/depend (check): get rid of re-generating ripper.y always.

	* ext/iconv/charset_alias.rb: parse config.charset_alias file directly.

	* ext/nkf/lib/kconv.rb (Kconv.conv): get rid of nil.to_a.

	* lib/scanf.rb (Scanf::FormatSpecifier#letter, #width): use matched
	  substring directly.

	* test/ruby/test_assignment.rb, test/ruby/test_iterator.rb: followed
	  change of sample/test.rb.

	* test/net/http/test_http.rb: removed superfluous splatting stars.

Fri Oct  7 16:41:43 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (splat_value): call rb_Array() to convert svalue to
	  values.  [ruby-dev:27397]

Fri Oct  7 09:54:00 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::Cookie::parse): Cookies from Nokia devices may
	  not be parsed correctly.  A patch from August Z. Flatby
	  (augustzf) in [ruby-Patches-2595].  [ruby-core:06183]

Thu Oct  6 22:51:30 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_Array): Array() to raise error for objects without
	  to_ary, nor to_a.

	* object.c (nil_to_a): revert NilClass#to_a.

Thu Oct  6 20:10:38 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c (strscan_free): remove useless code.
	  [ruby-dev:26368] [ruby-dev:27389]

Thu Oct  6 01:02:19 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (rb_range_beg_len): should return Qfalse for non-range
	  object.

Wed Oct  5 04:42:38 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/xmlrpc/server.rb (XMLRPC::Server#initialize): should mount the
	  servlet on "/".

Wed Oct  5 04:06:49 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/xmlrpc/server.rb (XMLRPC::Server#serve): delete wrong call
	  of "join".

Mon Oct  3 00:04:00 2005  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* pack.c (EXTEND16): [ruby-dev:27383]

Sat Oct  1 23:55:24 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (do_select, rb_w32_select): brush up.

Sat Oct  1 12:57:02 2005  Tanaka Akira  <akr@m17n.org>

	* bignum.c (rb_big_rand): removed.  [ruby-dev:25405]

Sat Oct  1 01:46:51 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI.open_loop): prohibit multiple proxy
	  options.

Thu Sep 29 10:26:18 2005  Tanaka Akira  <akr@m17n.org>

	* ext/dl/cptr.c (rb_dlptr_s_to_ptr): abolish sizeof(FILE).
	  [ruby-dev:27317]

Thu Sep 29 10:15:14 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (:proxy_http_basic_authentication): new option.

Thu Sep 29 07:22:05 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_f_send): underscores need to be escaped.
	  fixed by Doug Kearns.  [ruby-core:06053]

Thu Sep 29 00:57:35 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ev_const_get), variable.c (rb_const_get_0): retry only when
	  autoload succeeded.

	* variable.c (rb_autoload_load): now return true if autoload
	  succeeded.  fixed: [ruby-dev:27331]

Wed Sep 28 23:40:04 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_stat_inspect): constified.

Wed Sep 28 15:12:28 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI#start): req.query_string should
	  refer to the value of QUERY_STRING. [ruby-list:41186]

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#query_string=):
	  add new method.

Wed Sep 28 10:45:44 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: cannot compile with Tcl/Tk8.0.x [ruby-dev:27335].

Wed Sep 28 07:56:52 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/yaml/basenode.rb (YAML::BaseNode::match_segment): fix typo.
	  [ruby-dev:27237], [ruby-core:05854]

	* lib/yaml/tag.rb (Module#yaml_as): suppress warnings.

	* lib/yaml/types.rb (YAML::PrivateType, YAML::DomainType): ditto.

Wed Sep 28 03:16:41 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* rubysig.h: fixed build problem with --enable-pthread on platforms
	  which don't have setitimer().

Mon Sep 26 22:32:13 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (set_trace_func): add rb_secure(4) to prevent adding
	  tracing function.

Mon Sep 26 20:59:28 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* parse.y: changed to ANSI function style.

Sun Sep 25 12:02:04 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* bin/erb: typo fixed.

Sun Sep 25 11:54:11 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/tuplespace.rb (Rinda::TemplateEntry::initialize): pull
	  up method. Tabs converted to spaces.

Sun Sep 25 09:34:22 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* parse.y: replaced `foo _((boo))' with `foo(boo)'.

Sun Sep 25 08:19:53 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rss/test_content.rb, test/rss/test_syndication.rb: use fcall
	  instead of send in order to override visibility.

Sun Sep 25 01:46:43 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-calculate-indent): arrange deep-indent
	  closing parenthesis at same column as the opening.

Sun Sep 25 01:33:41 2005  Tanaka Akira  <akr@m17n.org>

	* process.c (proc_setrlimit): make the third argument (rlim_max)
	  optional.

Sun Sep 25 00:42:11 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg): deal with heredoc separately.
	  fixed: [ruby-list:41168]

	* misc/ruby-mode.el (ruby-calculate-indent): not to deepen indent
	  level for continuous line inside parentheses.
	  http://nabeken.tdiary.net/20050915.html#p02

Sat Sep 24 21:19:39 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c: document enhancement.

	* ext/strscan/strscan.c: update copyright year.

	* ext/strscan/strscan.c: update coding style.

Sat Sep 24 20:20:05 2005  Minero Aoki  <aamine@loveruby.net>

	* test/net/http/test_http.rb (teardown): Net::HTTP.version_1_1 breaks
	  many other tests; ensure that Net::HTTP is version 1.2 after test.
	  [ruby-dev:27312]

Sat Sep 24 11:44:28 2005  Minero Aoki  <aamine@loveruby.net>

	* test/net/http/test_http.rb: new file.

Sat Sep 24 08:54:05 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (cd): no longer accept :noop option, related
	  code is useless. [ruby-core:05858] [ruby-Bugs:2494]

Sat Sep 24 08:30:00 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#sub): new method.

Sat Sep 24 08:29:36 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb: fix visibility of FileUtils::NoWrite, Verbose,
	  DryRun. [ruby-core:05954]

	* test/fileutils/test_nowrite.rb: test it.

	* test/fileutils/test_dryrun.rb: new file.

	* test/fileutils/test_verbose.rb: new file.

Sat Sep 24 07:59:01 2005  Minero Aoki  <aamine@loveruby.net>

	* sample/ripper/colorize.rb: removed (replaced by ruby2html.rb).

	* sample/ripper/ruby2html.rb: added.

Sat Sep 24 06:35:15 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper: no longer generates .rb files.

	* parse.y (Init_ripper): ripper_init_eventids*() takes 1 argument,
	  self (class Ripper).

	* ext/ripper/depend: target removed: `lib/ripper/core.rb'.

	* ext/ripper/depend: new target `eventids2table.c'.

	* ext/ripper/depend: new target `check'.

	* ext/ripper/eventids2.c: include eventids2table.c.

	* ext/ripper/eventids2.c: initialize SCANNER_EVENT_TABLE.

	* ext/ripper/extconf.rb: update $cleanfiles list.

	* ext/ripper/tools/generate.rb: no longer generate ripper/core.rb.

	* ext/ripper/tools/generate.rb: new mode `check'.

	* ext/ripper/tools/generate.rb: new mode `eventids2table'.

	* ext/ripper/lib/ripper/core.rb.in: removed.

	* ext/ripper/lib/ripper/core.rb: added.

	* ext/ripper/lib/ripper/filter.rb: update copyright year.

	* ext/ripper/lib/ripper/lexer.rb: ditto.

	* ext/ripper/lib/ripper/sexp.rb: ditto.

Sat Sep 24 02:40:20 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb: document update from James Edward Gray II
	  <james@grayproductions.net>.  [ruby-core:05942]

Sat Sep 24 02:05:51 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (proc_daemon): should restrict execution on levels
	  higher than $SAFE=2.  suggested by URABE Shyouhei
	  <shyouhei@ice.uec.ac.jp>.

Fri Sep 23 20:10:35 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/tools/generate.rb, ext/ripper/tools/preproc.rb: StringIO
	  is not available for miniruby.  fixed: [ruby-dev:27307]

Fri Sep 23 17:36:48 2005  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: avoid core dump with WIN32OLE_EVENT.
	  [ruby-dev:27133]

Fri Sep 23 16:27:39 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/forwardable.rb: replaced by new implementation from
	  <Daniel.Berger@qwest.com>.  [ruby-core:05899]

Fri Sep 23 07:07:47 2005  Minero Aoki  <aamine@loveruby.net>

	* test/ripper/depend: use --output option instead of redirect;
	  nmake does not remove a target when the target file is created by
	  redirect. [ruby-dev:26466]

	* test/ripper/tools/preproc.rb: new option --output.

Fri Sep 23 06:57:52 2005  Minero Aoki  <aamine@loveruby.net>

	* test/ripper/tools/generate.rb: check parser event arity.

	* test/ripper/tools/generate.rb: detect crash of parser-event-IDs
	  and scanner-event-IDs.

Fri Sep 23 06:01:30 2005  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_file.rb: check File#chown(nil,nil).
	  [ruby-dev:27140]

Fri Sep 23 05:57:23 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper: refactoring code generation tools. [ruby-dev:27247]
	  [ruby-dev:27273]

	* ext/ripper/depend: use generate.rb.

	* ext/ripper/lib/ripper/core.rb: removed.

	* ext/ripper/tools/generate-eventids1.rb: removed (code moved to
	  generate.rb).

	* ext/ripper/tools/generate-ripper_rb.rb: removed (code moved to
	  generate.rb).

	* ext/ripper/tools/list-parse-event-ids.rb: removed (code moved to
	  generate.rb).

	* ext/ripper/tools/list-scan-event-ids.rb: removed (code moved to
	  generate.rb).

	* ext/ripper/lib/ripper/core.rb: removed.

	* ext/ripper: refactoring tests. [ruby-dev:27273]

	* ext/ripper/test/check-event-arity.rb: removed (code moved to
	  tools/generate.rb).

	* ext/ripper/test/check-event-coverage.rb: removed (code moved to
	  test/ripper/test_parser_events.rb).

	* ext/ripper/test/check-scanner-event-coverage.rb: removed (code
	  moved to test/ripper/test_scanner_events.rb).

	* ext/ripper/test/list-called-events.rb: removed.

	* ext/ripper/test/src_rb: removed.

	* ext/ripper/test/validate.rb: removed.

	* test/ripper/test_scanner_events.rb: check event coverage.

	* ext/ripper/lib/ripper/core.rb.in: update copyright year.

Thu Sep 22 23:40:19 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (find_executable0): default path if environment is not
	  set.  [ruby-dev:27281]

	* ext/ripper/extconf.rb (have_command): replaced with find_executable.

Thu Sep 22 17:31:48 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* test/readline/test_readline.rb (TestReadline::replace_stdio):
	  merged the patch of [ruby-dev:25232] instead of [ruby-dev:25223].
	  (merged from ruby_1_8 branch)

Wed Sep 21 23:30:44 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): generalized nmake dependent code.

Wed Sep 21 14:16:30 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/ripper/depend (SUFFIXES): no longer needed.

	* ext/ripper/depend (c): avoid nmake problem. fixed [ruby-dev:27191]

Wed Sep 21 08:52:25 2005  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/token.c: correctly compute indentation of a block
	  scalar's parent node. [ruby-talk:150620]

Wed Sep 21 08:20:24 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja: add new features.

Wed Sep 21 07:43:58 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (default_argv, Arguable#options): defaults strings
	  to be parsed to Arguable instance.

Wed Sep 21 02:44:09 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (path_check_0): disallow sticky world writable directory
	  in PATH (and $LOAD_PATH).  [ruby-dev:27226]

Wed Sep 21 00:32:22 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_idiv): 1.div(1.0) should return integer value.
	  [ruby-dev:27235]

Tue Sep 20 22:25:43 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/wait/lib/nonblock.rb: disable on platforms non-blocking flag
	  is not available.  fixed: [ruby-dev:27187]

	* file.c (rb_stat_inspect): protoized function pointer.

Tue Sep 20 18:23:04 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (thread_mark): mark th->last_status.  [ruby-dev:27179]

Tue Sep 20 18:20:33 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/yaml.rb: require 'yaml/constants'.  [ruby-core:5776]

Tue Sep 20 17:48:34 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client::do_rpc): add charset
	  information to content-type header.[ruby-core:5127]

	* lib/xmlrpc/server.rb (CGIServer::serve): ditto.

	* lib/xmlrpc/server.rb (ModRubyServer::serve): ditto.

	* lib/xmlrpc/server.rb (WEBrickServlet::service): ditto.

Tue Sep 20 17:26:42 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/webrick/test_cgi.rb: set ENV["PATH"] to CGIEnvPath on
	  windows. bcc32's runtime is not installed into system directory,
	  so it cannot be found without this setting. [ruby-dev:27166]

Tue Sep 20 17:14:10 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* io.c: PIPE_BUF is not defined on BeOS. use _POSIX_PIPE_BUF instead.
	  [ruby-dev:27185]

Tue Sep 20 17:10:38 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/dbm/test_dbm.rb (TestDBM::test_s_open_error): remove
	  test_s_open_error test to detect duplicate open.
	  [ruby-dev:27202]

Tue Sep 20 15:39:40 2005  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/emitter.c (syck_scan_scalar): prevent indicators from
	  appearing alone or at the end of plain scalars. [ruby-core:5826]

	* ext/syck/emitter.c (syck_emit_scalar): treat typed scalar nodes
	  as complex keys.

	* lib/syck.h: version 0.60.

	* lib/yaml/basenode.rb (YAML::BaseNode#at): transform keys during
	  key searches.

	* ext/syck/rubyext.c: loading of binary-typed nodes.  prevent
	  emission of plain strings that look like symbols, but which aren't.

Tue Sep 20 05:48:26 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/xmlrpc/test_webrick_server.rb (setup_http_server):
	  should not include 'webrick/https' unless 'use_ssl' because
	  it fails where openssl is not installed.

Tue Sep 20 01:24:45 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (splat_value): use to_a to splat non Array object.

	* object.c (nil_to_a): remove nil.to_a.  [experimental]

Tue Sep 20 01:01:41 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mathn.rb (Fixnum): remove debug print.

	* lib/rational.rb (Rational): ditto.

Tue Sep 20 00:34:07 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_close): call rb_io_close() directly if io is a T_FILE
	  object.  [ruby-dev:27156]

Mon Sep 19 18:58:10 2005  Minero Aoki  <aamine@loveruby.net>

	* file.c (rb_file_chown): should accept nil. [ruby-dev:27171]

Mon Sep 19 18:29:54 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (file_expand_path): allow pathnames to expand.
	  [ruby-dev:27152]

Mon Sep 19 15:12:15 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/depend: do not make ripper/core.rb. [ruby-dev:26462]

Mon Sep 19 14:49:19 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/eventids2.c: add prefix `t' to tLAMBDA-related lexer
	  events.

	* ext/ripper/lib/ripper/core.rb: updated.

Mon Sep 19 14:39:46 2005  Minero Aoki  <aamine@loveruby.net>

	* parse.y (do_block): do_block event dispatches 2 args.
	  [ruby-dev:26964]

	* ext/ripper/lib/ripper/core.rb: updated.

	* ext/ripper/tools/list-parser-event-ids.rb: check arity mismatch.

Mon Sep 19 07:45:37 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_pkey.h, ossl_pkey_rsa.c, ossl_pkey_dsa.c:
	  an instance variable "private" is added to OpenSSL::PKey class.
	  this ivar is a flag that shows whether there is a private key
	  in the instance.

	* ext/openssl/ossl_engine.c: (ossl_engine_load_privkey): set private
	  key flag.

	* test/openssl/test_pkey_rsa.rb: add test about private detection.

Mon Sep 19 06:38:03 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb: method renaming: collect_methods ->
	  collect_method.

Mon Sep 19 05:58:59 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb: use module_function instead of single extend.

	* test/fileutils/test_fileutils.rb: test existence of singleton
	  methods.

Mon Sep 19 05:32:41 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (remove_entry_secure): does not use chdir(2).

Mon Sep 19 03:17:48 2005  Tanaka Akira  <akr@m17n.org>

	* file.c (rb_thread_flock): wrap the flock system call by
	  TRAP_BEG/TRAP_END to enable signals.  [ruby-dev:27122]

	* ext/socket/socket.c (bsock_send): wrap the sendto and send system
	  call by TRAP_BEG/TRAP_END to enable signals when writing to a socket
	  which is full.  [ruby-dev:27132]

	* io.c (rb_io_syswrite): wrap the write system call by
	  TRAP_BEG/TRAP_END to run signal handler in syswrite method.
	  [ruby-dev:27134]

Mon Sep 19 01:07:38 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (Init_Numeric): should define Fixnum#div.
	  [ruby-dev:27129]

	* file.c (rb_thread_flock): wrap flock(2) by TRAP_BEG and
	  TRAP_END.  [ruby-dev:27122]

	* file.c (rb_file_join): call FilePathValue() to all Pathnames to
	  join.  [ruby-dev:27127]

	* file.c (rb_get_path): call StringValueCStr() to ensure no nul
	  bytes in path strings.

	* gc.c (garbage_collect): need value for return.  [ruby-dev:27127]

Sun Sep 18 02:10:47 2005  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/rubytypes.rb: remove comments that are bungling up
	  the rdoc and ri output.  output symbols as plain scalars.

	* ext/syck/rubyext.c (syck_emitter_reset): emit headless
	  documents always.

	* ext/syck/emitter.c (syck_scan_scalar): quote scalars with any
	  kind of surrounding line space, tabs or spaces alike.

	* ext/syck/token.c: accept tabs as whitespace, not for indentation,
	  but strip from plain scalars.

	* test/yaml/test_yaml.rb: remove outdated tests.

Sun Sep 18 01:10:37 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (garbage_collect): return false if no GC run.

Sat Sep 17 23:25:04 2005  sheepman  <sheepman@sheepman.sakura.ne.jp>

	* lib/mathn.rb (Rational::inspect): should preserve original
	  operand.  [ruby-core:05806]

Sat Sep 17 23:20:27 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::Cookie): should handle multiple values for a
	  cookie name.  [ruby-talk:156140]

	* test/socket/test_tcp.rb (TestTCPSocket::test_recvfrom): typo
	  fixed.  [ruby-dev:27123]

Sat Sep 17 20:58:56 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_select): fixed deadlock bug.
	  because select(2) modifies its fd_set arguments, it must be
	  restored sometimes.

	* win32/win32.c (rb_w32_select): performance improvement when
	 'always readable/writable handles' and sockets are passed.
	  sockets should be polled every time.

	    require "net/http"

	    Thread.new {
	      loop do
		STDOUT.write(".") # busy on console (this is worst case though)
	      end
	    }

	    # socket operation took long time. (sometimes timed out)
	    Net::HTTP.start("www.ruby-lang.org") do |http|
		http.get("/cgi-bin/cvsweb.cgi/ruby/array.c?rev=1.179")
	    end

Sat Sep 17 14:54:40 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_readpartial.rb (test_open_pipe, test_with_stdio):
	  these tests are working now, so turned on. (windows)

Sat Sep 17 14:18:15 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_select): I hope performance problem was
	  solved.

Sat Sep 17 13:45:22 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_select): console support is back.
	  but still has performance problem because I loosely took 1 second
	  for wait time. I'll fix it later. (The reason I drastically changed
	  the code is that I wanted to implement the fileset management as
	  single function, and I was worried that if pipe or console
	  was always available, socket may not be processed any time)

Sat Sep 17 11:24:16 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_select): select for socket didn't work.
	  this caused deadlock in drb test. this happened because GetFileType
	  for socket handle returns FILE_TYPE_PIPE. Of course, it's not a
	  pipe. So socket handle didn't reach winsock's select function.

	* win32/win32.c (rb_w32_select): read for pipe was still blocked
	  even if writer handle was closed.

	    r,w = IO.pipe

	    Thread.new {
	      sleep 3; puts "------- 1"
	      w.puts("foo")
	      sleep 3; puts "------- 2"
	      w.puts("boo")
	      sleep 3; puts "------- 3"
	      w.close
	    }

	    until r.eof? # should break by w.close but didn't.
	      puts r.gets
	    end

	* win32/win32.c (rb_w32_select): temporary reverted console support
	  but it'll be back soon.

Sat Sep 17 10:42:13 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: MultiTkIp#eval_string and bg_eval_string
	  should call Kernel.eval on caller's safe-level instead of slave's
	  safe-level (Of course, the given script should be evaluated on
	  slave's safe-level).

Sat Sep 17 09:45:26 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_substr): should propagate taintness even for
	  empty strings.  [ruby-dev:27121]

	* string.c (rb_str_aref): should infect result if range argument
	  is tainted.  [ruby-dev:27121]

Sat Sep 17 08:35:39 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb (RSS::Maker::ItemsBase#normalize): fixed
	  strange RSS::Maker::Item#max_size behavior.
	  Thanks to Kazuhiko <kazuhiko@fdiary.net>.

	* test/rss/test_maker_1.0.rb (RSS::TestMaker10#test_items): ditto.

Sat Sep 17 08:02:53 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: supported DIGEST-MD5.  Thanks, Mathieu Arnold.

	* lib/net/imap.rb: use fcall instead of send.  Thanks, Satoru
	  Takabayashi.

Fri Sep 16 22:45:49 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_extname): empty string for path name ending with a
	  period.  fixed: [ruby-core:05651]

	* file.c (rb_file_join): smarter behavior at edge cases.
	  fixed: [ruby-core:05706]

	* gc.c (rb_memerror, ruby_xmalloc, ruby_xrealloc, rb_newobj): just
	  abandon if no memory available, when interpreter is not running.
	  [ruby-dev:27104]

	* gc.c (garbage_collect): return whether GC could run.

	* dir.c (rb_push_glob): fix delimiter bug.  fixed: [ruby-dev:27105]

	* dir.c (dir_s_aref, dir_s_glob): allow multiple patterns.
	  [ruby-dev:27110]

	* win32/win32.c (cmdglob): enable brace expansion.

Fri Sep 16 18:34:01 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/node.c (syck_replace_str): was using return from the
	  void function.  a patch from MIYAMUKO Katsuyuki
	  <miyamuko at mtb.biglobe.ne.jp>.  [ruby-dev:27111]

Fri Sep 16 14:48:48 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: fix typo on MultiTkIp#bg_eval_string

Fri Sep 16 12:02:12 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/rubyext.c (syck_resolver_transfer): remove C++ style
	  comment (//).  [ruby-core:05793]

Fri Sep 16 00:17:03 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/logger/test_logger.rb: unintentionally overwritten changes by
	  Usa.  reverted.

Fri Sep 16 00:03:11 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI::Socket#initialize): should set
	  $stdout.binmode.

Thu Sep 15 23:25:21 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/{soap,wsdl,xsd}, test/{soap,wsdl,xsd}: imported soap4r/1.5.5.

	  #nnn is a ticket number at http://dev.ctor.org/soap4r

	  * SOAP

	    * allow to configure an envelope namespace of SOAP request. (#124)
		TemporaryNamespace = 'http://www.w3.org/2003/05/soap-envelope'
		@client.options["soap.envelope.requestnamespace"] =
		  TemporaryNamespace
		@client.options["soap.envelope.responsenamespace"] =
		  TemporaryNamespace
		@client.do_proc(...)

	    * let SOAP request XML indent space configurable.  see
	      "soap.envelope.no_indent" option. (#130)

	    * let external CES configurable.
	      ex. client["soap.mapping.external_ces"] = 'SJIS'.  $KCODE is used
	      by default. (#133)
		external CES ::= CES used in Ruby object of client and server
		internal CES ::= CES used in SOAP/OM

	    * add iso-8859-1 external CES support. (#106)

	    * fixed illegal 'qualified' handling of elements.  it caused
	      ASP.NET interoperability problem. (#144)

	    * added 'soap.envelope.use_numeric_character_reference' (boolean)
	      option to let query XML use numeric character reference in XML,
	      not plain UTF-8 character.  !GoogleSearch server seems to not
	      allow plain UTF-8 character since 2005-08-15 update. (#147)

	    * SOAP::Header::SimpleHeader (de)serialization throws an exception
	      on !SimpleHeader.on_(in|out)bound when header is a String.  so we
	      could not use a simple single element headerItem.  fixed.  thanks
	      to emil. (#129)

	    * out parameter of rpc operation did not work.  (#132)

	    * follow HTTP redirect only if using http-access2.  (#125) (#145)

	    * add a workaround for importing an WSDL whose path begins with
	      drive letter.  (#115)

	  * WSDL

	    * SOAP Data which is defined as a simpletype was not mapped
	      correctly to Ruby obj when using wsdl2ruby.rb generated classdef
	      file. (#123)

	    * rpc/literal support. (#118)

	    * re-implemented local element qualify/unqualify control.  handles
	      elementFormDefault and form in WSDL.  (#119)

	    * Array of an element which has simpleType causes a crash. (#128)

	    * parameterOrder may not contain return part so it can be shorter
	      than parts size.  Thanks to Hugh.  (#139)

	  * Samples

	    * added !BasicAuth client sample. (#117)

	    * added Base64 client/server sample.

	    * added Flickr SOAP interface client sample. (#122)

	    * added !SalesForce client sample. (#135)

	    * updated Thawte CA certificate for !GoogleAdWords sample.

	    * updated a client script with the newer version made by Johan.
	      thanks!

	    * shortened long file names. (#120)

	    * fixed typo in authheader sample. (#129)

	    * updated deprecated method usage.  (#138)

Thu Sep 15 22:40:27 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_signal.rb (test_exit_action): skip the test using
	  fork on fork-less platforms.

Thu Sep 15 13:54:33 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb: add :read_timeout option.
	  [ruby-core:4848]

Thu Sep 15 11:39:18 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/dialog.rb: If a dialog does not show up yet,
	  TkDialogObj#name raises an exception. [ruby-talk:156109]

Thu Sep 15 11:01:58 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_pipe_exec): remove unnecessary CloseHandle().

	* win32/win32.c (extract_console_fd, peek_console): new functions.

	* win32/win32.c (rb_w32_select): check consoles by polling them.

Thu Sep 15 00:18:24 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/net/telnet.rb (Net::Telnet::waitfor): replace sysread with
	  readpartial.  [ruby-talk:127641]

Wed Sep 14 23:28:28 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (collect_file_fd): rename from extract_file_fd.

	* win32/win32.c (extract_pipe_fd, peek_pipe): new functions.

	* win32/win32.c (rb_w32_select): check pipes by polling them.

Wed Sep 14 22:40:26 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (ruby_glob): glob function not using ruby exception system.

Wed Sep 14 17:24:22 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c: changed `foo (*bar)_((boo))' to `foo (*bar)(boo)`.

	* enumerator.c, eval.c, gc.c, intern.h, io.c, process.c, ruby.c,
	  ruby.h, signal.c: ditto.

Wed Sep 14 15:06:22 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bignum.c: changed `foo _((boo))' to `foo(boo)`. [ruby-dev:27056]

	* defines.h, dir.c, dln.h, enumerator.c, env.h, error.c, eval.c, file.c,
	  gc.c, hash.c, inits.c, intern.h, io.c, lex.c, marshal.c, missing.h,
	  node.h, numeric.c, pack.c, process.c, re.h, ruby.c, ruby.h, rubyio.h,
	  rubysig.h, signal.c, sprintf.c, st.h, string.c, struct.c, time.c,
	  util.c, util.h, variable.c: ditto.

Tue Sep 13 22:09:40 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb (Logger): added formatter accessor to logger for
	  dictating the way in which the logger should format the messages it
	  displays.  Thanks to Nicholas Seckar (cf. [ruby-talk:153391]) and
	  Daniel Berger.

	* lib/logger.rb (Logger): added VERSION constant.

	* lib/logger.rb: removed document for LogDevice. It is an
	  implementation detail and is not a public interface.

	* test/logger/test_logger.rb: added tests.

Tue Sep 13 21:47:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (BEGIN_CALLARGS): pop halfly pushed status.
	  fixed: [ruby-dev:26881]

Tue Sep 13 20:24:37 2005  Tanaka Akira  <akr@m17n.org>

	* ruby.h (PRINTF_ARGS): new macro for printf style argument checking.

Tue Sep 13 15:41:29 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: wrote documentation of HTTPRequest/HTTPResponse
	  classes.

Tue Sep 13 14:27:47 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* string.c, missing.h: failed to build on powerpc-apple-darwin7.9.0
	  because of crypt argument's constness mismatch. (I hope this works)
	  (http://mput.dip.jp/autobuild/ruby-trunk/log/20050913T110001.gz)

Tue Sep 13 12:33:05 2005  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml.rb: reworking YAML::Stream to use the new
	  emitter.

	* lib/yaml/stream.rb: ditto.

	* lib/yaml/rubytypes.rb: added Object#yaml_new.

	* lib/yaml/tag.rb: the tag_subclasses? method now
	  shows up in the class.  allow taguri to be set using an accessor.
	  continue support of Object#to_yaml_type.

	* ext/syck/rubyext.c: new emitter code.  yaml_new and yaml_initialize
	  get called, should they be present.  consolidated all the diaspora of 	  internal node types into the family below YAML::Syck::Node -- Map,
	  Seq, Scalar -- all of whom are SyckNode structs pointing to
	  Ruby data.  moved Object#yaml_new into the node_import and made it
	  the default behavior.  the target_class is always called with
	  yaml_new, prepended a parameter, which is the klass.  loaded nodes
	  through GenericResolver show their style.
	  new Resolver#tagurize converts type ids to taguris.

	* ext/syck/implicit.re: were 'y' and 'n' seriously omitted??

	* ext/syck/emitter.c: renovated emitter, walks the tree in advance.
	  consolidated redundant block_styles struct into
	  the scalar_style struct.  (this means loaded nodes can now
	  be sent back to emitter and preserve at least its very basic
	  formatting.)

	* ext/syck/gram.c: headless documents of any kind allowed.

	* ext/syck/node.c: new syck_replace_str methods and syck_empty_*
	  methods for rewriting node contents, while keeping the ID
	  and other setup info.  added syck_seq_assign.

	* ext/syck/syck.h: reflect block_styles and new node functions.

Tue Sep 13 08:09:18 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ostruct.rb (new_ostruct_member): Object#send no longer call
	  private methods.  [ruby-dev:27044]

	* test/rss/test_dublincore.rb, test/rss/test_trackback.rb,
	  test/ruby/test_eval.rb, test/socket/test_socket.rb: ditto.

	* test/ruby/test_lambda (test_call_with_block): lambda makes new scope
	  for formal block parameter.

Tue Sep 13 01:17:45 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_save_safe_level): no need to restrict safe level
	  memoize in $SAFE>=3.  [ruby-dev:27050]

Tue Sep 13 00:02:33 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (apply2files): stricter callback definition.

	* file.c (rb_path_check): constified.

Mon Sep 12 20:53:06 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/openssl/test_pkcs7.rb (test_enveloped): skip this test
	  to avoid a bug of PKCS7_encrypt() (only if ext/openssl is
	  compiled with OpenSSL-0.9.7d or earlier versions).
	  http://www.mail-archive.com/openssl-dev@openssl.org/msg17376.html

Mon Sep 12 20:32:00 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.[hc] (rb_w32_argv_size, ...): reverted my latest change
	  to avoid incompatible pointer warning. (mingw32)

Mon Sep 12 19:58:53 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dln.c: avoid warning of const to non-const conversion.
	  [ruby-dev:27041]

	* eval.c, io.c, ruby.c: ditto.

Mon Sep 12 19:26:29 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* array.c: moved to ANSI function style from K&R function style.
	  (used protoize on windows, so still K&R remains on #ifdef part of
	   other platforms. And  `foo _((boo))' stuff is still there)
	   [ruby-dev:26975]

	* bignum.c, class.c, compar.c, dir.c, dln.c, dmyext.c, enum.c,
	  enumerator.c, error.c, eval.c, file.c, gc.c, hash.c, inits.c,
	  io.c, main.c, marshal.c, math.c, numeric.c, object.c, pack.c,
	  prec.c, process.c, random.c, range.c, re.c, regcomp.c, regenc.c,
	  regerror.c, regexec.c, regparse.c, regparse.h, ruby.c, signal.c,
	  sprintf.c, st.c, string.c, struct.c, time.c, util.h, variable.c,
	  version.c: ditto.

Mon Sep 12 14:03:33 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* test/dbm/test_dbm.rb: remove locking test, which may not be
	  supported on some platforms.  [ruby-dev:27030]

Sun Sep 11 23:23:02 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (starttls): supported the STARTTLS command.

Sun Sep 11 22:18:07 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* bin/erb (ERB::Main#run): set ERB#filename so that it is used
	  when reporting syntax/runtime errors. Tabs converted to spaces.

Sat Sep 10 22:34:19 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c, bignum.c: protoize.

Sat Sep 10 00:23:01 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (splat_value): simpler and consistent array conversion
	  for argument splat.  [yarv-dev:599]

Fri Sep  9 16:45:25 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_times): make empty strings to keep taintness,
	  and a little improvement.  [ruby-dev:26900]

	* ext/iconv/iconv.c (iconv_try), ext/iconv/extconf.rb: get rid of meta
	  characters in command line option.  fixed: [ruby-talk:155369]

	* ext/iconv/iconv.c: protoized.

Thu Sep  8 14:58:11 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* merged a patch from Takahiro Kambe <taca at back-street.net> to
	  support DragonFly BSD.  [ruby-dev:26984]

Thu Sep  8 13:14:57 2005  Tadashi Saito  <shiba@mail2.accsnet.ne.jp>

	* missing/strchr.c (strrchr): fixed a bug in detecting NUL in a
	  string.  [ruby-dev:26985]

Wed Sep  7 17:29:27 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_engine.c (ossl_engine_s_by_id):
	  OpenSSL::Engine.by_id calls given block before calling
	  ENGINE_init (block parameter is the return value of this method
	  itself).  this functionality is useful to load dynamic shared
	  engines.

		require "openssl"
		pkcs11 = OpenSSL::Engine.by_id("dynamic"){|e|
		  e.ctrl_cmd("SO_PATH", "/usr/lib/opensc/engine_pkcs11.so")
		  e.ctrl_cmd("LIST_ADD", "1")
		  e.ctrl_cmd("LOAD")
		}
		pkcs11.ctrl_cmd("PIN", "secret")
		key = pkcs11.load_private_key

	* ext/openssl/ossl_engine.c (ossl_engine_ctrl_cmd): new method
	  OpenSSL::Engine#ctrl_cmd. it wraps ENGINE_ctrl_cmd_string.

	* ext/openssl/ossl_engine.c (ossl_engine_get_cmds): new method
	  OpenSSL::Engine#cmds. it returns engine command definitions.

Wed Sep  7 15:48:37 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (asn1str_to_str): new function.

	* ext/openssl/ossl_pkcs7.c: new class OpenSSL::PKCS7::RecipientInfo.
	  this class wraps PKCS7_RECIP_INFO struct.

	* ext/openssl/ossl_pkcs7.c: OpenSSL::PKCS7::Signer is renamed to
	  OpenSSL::PKCS7::SignerInfo. ("Signer" remains as an alias of
	  SignerInfo.)

	* test/openssl/test_pkcs7.rb: new file.

Wed Sep  7 12:55:08 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb: abolish mod === tempfile to avoid a problem
	  [ruby-dev:26967].

Wed Sep  7 10:45:15 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_switch): convert all exceptions to
	  SystemExit.  fixed: [ruby-core:05724]

	* eval.c (rb_thread_terminated): show backtrace before propagate
	  exceptions to main thread.

Wed Sep  7 09:21:41 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.[hc] (rb_w32_utime): constified.

	* win32/win32.h (rb_w32_stat): added prototype.

	* win32/win32.[hc] (rb_w32_argv_size,rb_w32_join_argv,rb_w32_aspawn):
	  changed `char *const *' to `const char *const *'. (constify string)

Wed Sep  7 08:35:04 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, configure.in (MINIOBJS): miniruby on HP-UX can not load
	  extension libraries.

	* bignum.c (bignew_1, bigadd): K&R style argument actually can't be
	  defined as char.

	* missing/vsnprintf.c: ANSI compiler supports const keyword.

	* ext/digest/sha2/extconf.rb: reject platforms which has inttypes.h
	  but no 64bit integer.

	* lib/mkmf.rb (what_type?): guesstimate type.

	* ext/etc/etc.c (setup_passwd), ext/etc/extconf.rb: pw_age might be
	  char*.  fixed: [ruby-core:05470]

Wed Sep  7 08:32:07 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_times): should taint empty strings as well.

	* object.c (Init_Object): make class_variable_{get,set} public.
	  [ruby-dev:26965]

Mon Sep  5 22:28:46 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt, mlhs_node, lhs, arg, method_call): aref_args might be
	  nothing.  fixed: [ruby-dev:26952]

	* ext/ripper/eventids2.c: added new tokens.  fixed: [ruby-dev:26952]

Mon Sep  5 17:03:07 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/find.rb: should raise ENOENT if root entry does not exist.
	  [ruby-list:41054]

	* lib/ostruct.rb: a patch from Florian Gross <florgro at gmail.com>
	  merged to allow recursive inspect (and to_s) for OpenStruct.
	  [ruby-core:05532]

Mon Sep  5 08:20:19 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/observer.rb: a patch from nornagon <nornagon at gmail.com>
	  merged to allow arbitrary names for update methods.
	  [ruby-core:05416]

Mon Sep  5 07:01:12 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/openssl/lib/openssl/buffering.rb (Buffering#do_write):
	  should clear data from the buffer which already been output.

Sun Sep  4 15:01:35 2005  Minero Aoki  <aamine@loveruby.net>

	* parse.y (f_arg): Ripper should not do semantic check.
	  [ruby-dev:26948]

Sat Sep  3 23:52:35 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_fcall): new method to avoid inefficiency of
	  obj.instance_eval{send(...)} tricks.

Sat Sep  3 13:59:31 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#descend): Pathname.new("./a/b/c").descend
	  didn't yield "."
	  (Pathname#ascend): ditto.

Fri Sep  2 23:51:54 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (f_arg): f_norm_arg is a VALUE in ripper, not an ID.
	  fixed: [ruby-dev:26942]

	* lib: do not use __send__ to access private methods.  [ruby-dev:26935]

Thu Sep  1 17:11:25 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): wrong condition for $SAFE restoration.

Thu Sep  1 14:12:45 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: On Tcl8.5, MultiTkIp#invoke_hidden doesn't
	  work (gives wrong order of arguments).

	* ext/tk/lib/multi-tk.rb: add MultiTkIp#invoke_hidden_on_namespace
	  to support '-namespace' option of 'interp invokehidden' command
	  on Tcl8.5.

Wed Aug 31 14:41:30 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (OPTFLAGS): default global optimization to
	  disabled for all VC++ versions.  fixed: [ruby-dev:26897]

Wed Aug 31 10:36:09 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* process.c (proc_detach, proc_setmaxgroups): missing argument type
	  declaration. (I recommend ANSI-style function)

Wed Aug 31 06:59:01 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_scan): already String#scan behaves differently
	  regarding if block is given.

Tue Aug 30 23:49:34 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c, dir.c, enum.c, hash.c, io.c, range.c, string.c, struct.c:
	  let enumerable methods return Enumerator.  [ruby-dev:26924]

	* intern.h (RETURN_ENUMERATOR): utility macro for enumerable methods.

Tue Aug 30 23:25:45 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/debug.rb: no need to restart at exit.

Tue Aug 30 23:20:19 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_rescue2): initialization miss.  fixed: [ruby-dev:26917]

	* lib/mkmf.rb (xsystem, xpopen): no longer expand by Config.

	* lib/mkmf.rb (link_command, cc_command, cpp_command): expand
	  variables at once, and quote hdrdir.  fixed: [ruby-core:05680]

	* lib/mkmf.rb (libpathflag): quote paths.

Tue Aug 30 19:34:27 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/digest/md5/md5ossl.h, ext/digest/rmd160/rmd160ossl.h,
	  ext/digest/sha1/sha1ossl.h: include <stddef.h> to avoid
	  error in compilation with OpenSSL-0.9.8. [ruby-list:41068]

Tue Aug 30 16:19:40 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/init.rb: bug fix. [ruby-dev: 26920]

Tue Aug 30 16:13:00 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_count): new method.  [ruby-dev:26895]

Tue Aug 30 12:45:15 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_send): do not call private methods if the receiver
	  is specified.  [ruby-talk:153672]

Mon Aug 29 19:47:18 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/rdoc/usage.rb: improper exceptions. [ruby-dev:26870]

	* lib/rdoc/usage.rb: support the case when non-ruby code exists before
	  shebang. (this is needed when ri.bat is executed on windows)

Mon Aug 29 18:58:05 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/init.rb: make IRB -I option that is same behavior for ruby.
	  [ruby-dev:26872]

	* lib/irb/locale.rb: support to print help message when OS locale is
	  ja_JP.utf-8. [ruby-dev:26872]

Mon Aug 29 01:43:05 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#descend): new method.
	  (Pathname#ascend): ditto.

Mon Aug 29 00:35:09 2005  Tanaka Akira  <akr@m17n.org>

	* lib/time.rb: require 'date/format' instead of 'parsedate'.
	  (Time.parse): extract fractional seconds using Date._parse.
	  (Time.strptime): extract fractional seconds using Date._strptime.
	  [ruby-talk:153859]

Sat Aug 27 20:13:31 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/curses/curses.c ({curses,window}_clrtoeol): added. suggested
	  by Reyn Vlietstra.

	* ext/curses/curses.c: chtype in curses is not `char', rather `long'.
	  [ruby-Bugs:2298]

	* ext/curses/view.rb: String =~ String is deprecated.

Thu Aug 25 15:48:58 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/win32ole/win32ole.c: suppress warnings. (win32)

Wed Aug 24 11:01:26 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/logger/test_logger.rb (test_shifting_size): should close log
	  device before unlink, since some platform cannot unlink opened
	  file.

Tue Aug 23 06:07:02 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/digest.rb: added SHA224, SHA256, SHA384 and SHA512.
	  these features are enabled if this library is compiled with
	  OpenSSL 0.9.8 or later.

	* test/openssl/test_digest.rb: add test for new digests.

Tue Aug 23 05:47:04 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ns_spki.c (ossl_spki_initialize): try to decode
	  the argument as a string.

	* ext/openssl/ossl_ns_pki.c (ossl_spki_to_der): new method.

	* ext/openssl/ossl_x509store.c (ossl_x509store_initialize): should
	  set @time to avoid warning.

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_default_paths,
	  X509_STORE_add_cert, X509_STORE_add_crl): should raise error if
	  wrapped functions fails.

	* ext/openssl/ossl_ssl.c (ossl_sslctx_set_ciphers): fix error message.

	* ext/openssl/ossl_x509req.c (ossl_x509req_set_attributes): get rid
	  of unused variable.

	* test/openssl/test_ns_spki.rb: add new file.

	* test/openssl/test_x509store.rb: add test for error.

Tue Aug 23 01:11:40 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* sprintf.c (ruby__sfvwrite): should move `buf' to the end of
	  `result'. [ruby-dev:26859]

Mon Aug 22 23:51:19 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: ONIG_OPTION_CAPTURE_GROUP conflicts with
	  RE_OPTION_ONCE.  [ruby-dev:26852]

Mon Aug 22 20:11:35 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/vsnprintf.c (BSD__sprint): needs to call vwrite function
	  pointer.  fixed: [ruby-dev:26854]

Sat Aug 20 23:55:25 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): update paren_nest for brackets [].

Sun Aug 21 00:10:23 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/wsdl/xmlSchema/importer.rb (WSDL::XMLSchema::Importer#fetch): add
	  a workaround for importing an WSDL whose path begins with drive
	  letter.  [ruby-dev:26242]

Sat Aug 20 22:05:25 2005  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* regexec.c (code_is_in_cclass_node): check code size.
	  [ruby-dev:26840]

Sat Aug 20 22:37:13 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb (write, shift_log?, shift_log): file shifting race
	  condition bug fixed.  [ruby-dev:26764]

	* test/logger/test_logger.rb: tests.

Fri Aug 19 18:13:39 2005  Tanaka Akira  <akr@m17n.org>

	* lib/time.rb (Time.apply_offset): fix a problem with last day of
	  month.  reported by Lucas Nussbaum.  [ruby-talk:152866]

Thu Aug 18 11:05:36 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (socketpair_internal): need to call open_ifs_socket()
	  to create sockets instead of winsock's socket().
	  fixed: [yarv-dev:581]

Wed Aug 17 23:58:05 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (terminate_process): take String message.

	* eval.c (rb_thread_switch): propagate the exception caused thread
	  termination directly.  fixed: [ruby-core:05552]

Wed Aug 17 21:20:05 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb: ensure that symbol_to_option is private_class_method
	  and all other methods are module_function
	  fixed: [ruby-dev:26808]

Wed Aug 17 00:05:46 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_add_method): preserve safe level in the environment
	  where a method is defined .

	* eval.c (rb_call0): restore preserved safe level in the method
	  execution.

	* parse.y (lambda): need separate block variable stack
	  manipulation and lpar_beg maintenance.  based on a patch found
	  in [ruby-core:05551] from Mauricio Fernandez <mfp at acm.org>.

	* parse.y (parser_yylex): adjust lpar_beg after tLAMBEG and
	  kDO_LAMBDA. [ruby-core:05551]

Mon Aug 15 07:24:38 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h (rb_check_to_integer): add declaration.

	* object.c (rb_to_integer, rb_check_to_integer): argument constified.

Mon Aug 15 00:38:51 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_rescue2): reduce PUSH_TAG() as well as NODE_RESCUE.
	  [ruby-dev:26800]

	* range.c (range_check, range_init): reduce useless exceptions.

Mon Aug 15 00:34:11 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (yycompile): remove unreachable code.  [yarv-dev:570]

Sat Aug 13 22:16:12 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (remove_entry_secure): forgot final chdir.

Sat Aug 13 22:07:49 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (remove_entry_secure): uses chdir(2) and check
	  if current directory is correct. [ruby-dev:26100] [ruby-dev:26226]

Sat Aug 13 21:11:05 2005  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_VARIANT class.

	* ext/win32ole/tests/testall.rb: ditto.

	* ext/win32ole/tests/testOLEVARIANT.rb: ditto.

Sat Aug 13 18:51:26 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_block_pass): distinguish current block from others.
	  fixed: [ruby-dev:26274]

	* ext/stringio/stringio.c (strio_set_string): disallow nil.
	  http://www.rubyist.net/~nobu/t/20050811.html#c05

Sat Aug 13 08:01:59 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb: Kconv.kconv is now alias of Kconv.conv
	* ext/nkf/lib/kconv.rb: remove nkf dependent symbols from SYMBOL_TO_OPTION

Fri Aug 12 17:06:53 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_larglist): allow optional arguments even when
	  parentheses are omitted.  based on Nobu's patch from
	  http://www.rubyist.net/~nobu/t/20050805.html

	* parse.y (parser_yylex): update & maintain lpar_beg for detect
	  lambda parameters.

Thu Aug 11 23:29:03 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c: keep holding string after closed.

Thu Aug 11 20:48:40 2005  Tadashi Saito  <shiba@mail2.accsnet.ne.jp>

	* numeric.c (fix_equal, fix_cmp, fix_gt, fix_ge, fix_lt, fix_le):
	  reduce coercing when a method knows about a operand type.
	  [ruby-dev:26789]

Thu Aug 11 13:01:48 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss: fixed sort bug. [ruby-list:41018]

	* lib/rss/1.0.rb (RSS::RDF::Channel#setup_maker_attributes):
	  removed self.

	* lib/rss/maker/base.rb (RSS::Maker::ItemsBase#<=>): use #date
	  instead of @date.
	  (RSS::Maker::Base::self.def_array_element): added #size.

	* lib/rss/maker/1.0.rb
	  (RSS::Maker::RSS10::Channel#to_rss,
	   RSS::Maker::RSS10::Items::Item#to_rss): cleared dc_dates set
	  upped by using #date.

	* lib/rss/maker/dublincore.rb
	  (RSS::Maker::ChannelBase, RSS::Maker::ItemsBase::ItemBase):
	  fixed opposite alias.

	* test/rss/test_setup_maker_1.0.rb
	  (RSS::TestSetupMaker10::test_setup_maker_items_sort): added some
	  tests for RSS::Maker::ItemsBase#do_sort.

Wed Aug 10 12:01:20 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb: simplifies Delegator classes; SimpleDelegator
	  now uses method_missing for all methods.

Wed Aug 10 10:38:50 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_mul0): multiply two numbers (x, y) without
	  normalizing the result.  x should be a big number.
	  [ruby-dev:26778]

	* bignum.c (rb_big_pow): use rb_big_mul0() instead of
	  rb_big_mul().

	* array.c (rb_ary_or, rb_ary_and, rb_ary_plus, rb_ary_diff):
	  revert the change on 2005-08-03.  Set operation on other item
	  should have in separate methods.

	* parse.y (shadowing_lvar_gen): warn when arguments shadows
	  external local variables.

	* parse.y (f_opt): optional arguments should not clobber external
	  local variables.

	* parse.y (f_rest_arg): rest arguments should not clobber external
	  local variables.

Wed Aug 10 10:29:40 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fix bug on handling __ruby2val_optkeys().

	* ext/tk/lib/tk/itemconfig.rb: fix bug on handling
	  __item_ruby2val_optkeys().

	* ext/tk/lib/tk/canvas.rb: didn't check __item_ruby2val_optkeys().

	* ext/tk/lib/tkextlib/blt/component.rb: ditto.

Tue Aug  9 21:53:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (formal_assign): let default values override
	  arguments to zsuper.  fixed: [ruby-dev:26743]

Tue Aug  9 20:30:19 2005  Tadashi Saito  <shiba@mail2.accsnet.ne.jp>

	* bignum.c (rb_big_coerce): allow bignum x bignum coercing.
	  [ruby-dev:26778]

Tue Aug  9 15:12:04 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: remove dangerous 'rb_jump_tag's.

	* ext/tk/lib/tk.rb: add __val2ruby_optkeys and __ruby2val_optkeys to
	  help to convert option values between ruby and tcl.

	* ext/tk/lib/tk/itemconfig.rb: add __item_val2ruby_optkeys and
	  __item_ruby2val_optkeys to help to convert option values between
	    ruby and tcl.

	* ext/tk/lib/tk/radiobutton.rb: use __ruby2val_optkeys for 'variable'
	  option (for the reason of backward compatibility).

	* ext/tk/lib/tk/composite.rb: clarify the arguments of super().

	* ext/tk/lib/tk/spinbox.rb: ditto.

	* ext/tk/lib/tk/text.rb: ditto.

	* ext/tk/lib/tk/validation.rb: ditto.

	* ext/tk/lib/tkextlib/*: support to treat tkvariable-type
	  configure options.

Tue Aug  9 08:24:05 2005  Mauricio Fernandez  <mfp@acm.org>

	* parse.y (f_block_arg), eval.c (rb_yield_0): deal with dynamic
	  variable lambda arguments.  [ruby-core:05540]

Mon Aug  8 22:13:48 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (assign): deal with new block argument.
	  fixed: [ruby-core:05536]

	* eval.c (rb_node_arity): follow change of NODE_ARGS.
	  fixed: [ruby-dev:26761]

Mon Aug  8 21:28:13 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_fnmatch.rb: separated from test_file.rb.

Mon Aug  8 20:40:35 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_method.rb: added.  [ruby-dev:26761]

Mon Aug  8 01:26:37 2005  Mauricio Fernandez  <mfp@acm.org>

	* parse.y (f_larglist): mistake in syntax rule.  [ruby-core:05535]

Mon Aug  8 05:16:55 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.c (ossl_raise): should use ERR_peek_last_error
	  to get last error on the current thread. And should report
	  if errors are on the stack while OpenSSL.debug is true.

	* ext/openssl/ossl.c (ossl_get_errors): new method for debugging
	  this library.

Mon Aug  8 05:15:19 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpproxy.rb (HTTPProxyServer#initialize),
	  lib/webrick/httpserver.rb (HTTPServer#initialize),
	  lib/webrick/httpservlet/cgihandler.rb (CGIHandler#initialize),
	  lib/webrick/httpservlet/erbhandler.rb (ERBHandler#initialize),
	  lib/webrick/httpservlet/filehandler.rb(DefaultFileHandler#initialize):
	  super (called with no arguments) takes default value of optional
	  arguments. [ruby-dev:26743]

	* lib/webrick/httputils.rb: add a media-type "text/html" for .xhtml.

Sun Aug  7 23:52:39 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_super.rb: added optional arg tests.  [ruby-dev:26743]
	  the tests expects 1.8 behavior at this time.

Sat Aug  6 12:35:24 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/{tk.rb,tk/itemconfig.rb}: configure creates
	  TkVariable if key name is 'variable' or 'textvariable'
	  by default. [ruby-dev:26749]

	* ext/tk/lib/tk/{label,radiobutton}.rb: removed its own
	  {variable,textvariable} function.

	* ext/tk/lib/tk/variable.rb: retains backward compatibility.

Fri Aug  5 12:48:31 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c: fixed memory leak when tk_funcall raised
	  exception. (copies argv into heap in tk_funcall instead of
	  caller)

Fri Aug  5 12:36:40 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): need to convert path separator
	  before invoking install command.

Fri Aug  5 08:08:05 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (return_jump): fix "can't across thread" error message
	  when no thread associated.
	  http://www.namikilab.tuat.ac.jp/~sasada/diary/200507.html#d31

Fri Aug  5 00:25:12 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c: refactoring - extract ruby string <->
	  tcl object conversion as get_str_from_obj and get_obj_from_str.

Fri Aug  5 00:19:33 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (Init_Enumerator): provided features should have
	  extensions.

	* eval.c (rb_feature_p): returns type of the feature instead of
	  extension.

	* eval.c (search_required): ruby library should be prior to statically
	  linked extensions.  fixed: [ruby-dev:26711]

	* eval.c (formal_assign): returns position of rest arguments variable.

	* parse.y (f_rest_arg): use anonymous variable for rest arguments.
	  fixed: [ruby-dev:26647]

	* extmk.rb (extmake): needs to be wrapped in an Array.

Thu Aug  4 20:03:18 2005  Tadashi Saito  <shiba@mail2.accsnet.ne.jp>

	* numeric.c (Init_Numeric): do not share implementation among
	  Fixnum#/ and Fixnum#div.  [ruby-core:05531]

Thu Aug  4 18:38:36 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: cannot compile for Tcl7.6/Tk4.2.

	* ext/tk/tcltklib.c: add nativethread consistency check.

	* ext/tk/stubs.c: ditto.

	* ext/tk/lib/tk.rb: forgot to define TclTkIp.encoding and encoding=
	  when Tcl is 7.6 or 8.0.

	* ext/tk/lib/tk/wm.rb: support to make some methods as options of
	  root or toplevel widget. [ruby-talk:150336]

	* ext/tk/lib/tk/root.rb: ditto.

	* ext/tk/lib/tk/toplevel.rb: ditto.

	* ext/tk/lib/tkextlib/SUPPORT_STATUS: update RELEASE_DATE

Thu Aug  4 13:30:15 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_div): should not convert the result into
	  integer.  [ruby-core:05524]

Thu Aug  4 08:03:39 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): should not modify $mflags for each
	  extensions.

Thu Aug  4 00:25:48 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk, Makefile.in, {bcc32,win32,wince}/Makefile.sub: integrated
	  macro definitions.

	* bcc32/Makefile.sub: LIBRUBY_SO should use DLDOBJS, not EXTOBJS.

	* {win32,wince}/Makefile.sub: separate config.h for compiler versions.

Thu Aug  4 00:24:59 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c: replacing is no longer needed.

Wed Aug  3 21:59:16 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb: TkVariable#trace didn't work on
	  TkVariable retrieved from TkVariable.new_hash.ref. [ruby-dev:26721]

Wed Aug  3 12:40:28 2005  Tadashi Saito  <shiba@mail2.accsnet.ne.jp>

	* numeric.c (fix_plus): reduce coercing when a method knows about
	  a operand type.  [ruby-dev:26723]

	* numeric.c (fix_minus, fix_mul, fix_quo, fix_div, fix_mod,
	  fix_divmod, fix_pow): ditto.

	* bignum.c (rb_big_div, rb_big_modulo): export to reduce
	  coercing.

Wed Aug  3 10:13:52 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, {bcc32,win32,wince}/Makefile.sub (HAVE_SNPRINTF,
	  HAVE_VSNPRINTF): use win32/win32.c's implementation instead of
	  missing/vsnprintf.c's.

	* win32/win32.[ch] (rb_w32_snprintf, rb_w32_vsnprintf): reverted.

Wed Aug  3 10:05:08 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check vsnprintf() and snprintf().

	* sprintf.c, missing/vsnprintf.c: made vsnprintf() and snprintf()
	  private.  fixed: [ruby-dev:26651]

Wed Aug  3 08:22:13 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (ruby_connect): revert [ruby-talk:111654]
	  changes at 2004-09-07.  [ruby-dev:26656]

Wed Aug  3 06:53:35 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_or): wraps the operand in an array if it is not
	  an array.  [ruby-talk:150495] [EXPERIMENTAL]

	* array.c (rb_ary_and, rb_ary_plus, rb_ary_diff): ditto.

Tue Aug  2 10:23:12 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c: use Tcl_[GS]etVar2Ex instead of
	  Tcl_Obj[GS]etVar2. (avoid Tcl_NewStringObj on supported platforms)

	* ext/tk/tcltklib.c: use ip_{get,set,unset}_variable2_core from
	  ip_{get,set,unset}_variable.

	* ext/tk/tcltklib.c: replaced Tcl_Panic with rb_bug.

Tue Aug  2 01:40:38 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/ping.rb (Ping.pingecho): should rescue StandardError.
	  [ruby-dev:26677]

Mon Aug  1 19:02:23 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c: refactoring - replaced rb_ivar_defined &
	  rb_ivar_get with single rb_attr_get call.

Mon Aug  1 18:44:08 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c (Tcl_GetStringResult): refactoring - define
	  alternative macro on Tcl7.x or earlier.

Mon Aug  1 13:53:55 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c (deleted_ip): refactoring - interpreter
	  deletion check. [ruby-dev:26664]

Mon Aug  1 01:08:21 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (check_insecure_method): use private_methods and
	  protected_methods instead of respond_to? to check method visibility.
	  [ruby-dev:26616]

	* test/drb/drbtest.rb: ditto.

	* test/drb/ut_drb.rb: ditto.

Sat Jul 30 18:49:44 2005  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_TYPE#ole_typelib,
	  WIN32OLE_TYPE#implemented_ole_types.

	* ext/win32ole/tests/testOLETYPE.rb: ditto.

Fri Jul 29 16:12:02 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/context.rb: fix `irb --readline` option. [ruby-dev:40955]

Fri Jul 29 09:59:38 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_call0): fix calling zsuper from a method with anonymous
	  rest argument.  [ruby-dev:26639]

	* eval.c (rb_yield_0): push yielded node instead of yielding.
	  fixed: [yarv-dev:549]

Thu Jul 28 21:49:17 2005  IWATSUKI Hiroyuki  <don@na.rim.or.jp>

	* parse.y (rb_parser_end_seen_p): exclude from ripper.
	  <http://moonrock.jp/~don/d/200507.html#d28_t2>

	* sprintf.c (clearerr): remove standard macro before re-definition.
	  <http://moonrock.jp/~don/d/200507.html#d28_t3>

Thu Jul 28 18:09:55 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/stubs.c: When --enable-tcltk-stubs, the initialize
	  routine creates a Tcl/Tk interpreter and deletes it. However,
	  init cost of Tk's MainWindow is not so small. And that makes it
	  impossible to use libraries written with Tcl functions only on
	  an environment without a graphical display. This changes support
	  delaying initialization of Tk_Stubs until the script needs Tk.

	* ext/tk/stubs.h: New file. Define prototypes and return codes of
	  functions on stubs.c.

	* ext/tk/tcltklib.c: Support delaying initialization of Tk_Stubs
	  until the script needs Tk.

	* ext/tk/tcltklib.c: Show friendly error messages for errors on
	  initialization.

	* ext/tk/tcltklib.c: Avoid SEGV on ip_finalize() when ruby is
	  exiting and $DEBUG is true. (Not fix. If you know the reason of
	  why, please fix it.)

	* ext/tk/tkutil/tkutil.c (ary2list, ary2list2): bug fix on handling
	  of encoding.

	* ext/tk/lib/multi-tk.rb: MultiTkIp#eval_string and bg_eval_string
	  don't work properly.

	* ext/tk/lib/tk.rb: Forget extending Tk::Encoding module to Tk.

	* ext/tk/lib/tk/variable.rb: TkVarAccess fails to initialize the
	  object for an element of a Tcl's array variable.

Thu Jul 28 17:23:37 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_larglist): allow block argument in lambda parameter
	  list without parenthesis.

Thu Jul 28 17:14:01 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (each_i): typo fixed.  [ruby-dev:26622]

Thu Jul 28 15:04:11 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_arg): better argument name duplication check

	* parse.y (new_args_gen): factored out name duplication check for
	  optional and rest arguments.

	* parse.y (new_bv_gen): allow shadowing outer local variables;
	  warning remains.

Thu Jul 28 13:46:06 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (ripper_warningS): the argument was omitted.
	  [ruby-dev:26621]

Thu Jul 28 11:30:57 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (f_larglist): allow bv_decl at the end of lambda
	  argument list.  [EXPERIMENTAL]

	* parse.y (new_bv_gen): allow local variable shadowing, with
	  warning in verbose mode.

Wed Jul 27 23:23:54 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (obj_free): make message format consistent with one from
	  gc_mark().  [ruby-talk:149668]

	* sprintf.c (quad_t): prepare quad_t as well.  [ruby-talk:149668]

Wed Jul 27 22:11:37 2005  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/tdiary_plugin: removed. because the plugin
	  is imported in the tDiary plugin packages.

Wed Jul 27 19:11:53 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (cd): follow :noop option change. (This patch
	  is contributed by Doug Kearns)

Wed Jul 27 16:25:59 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (lambda): Perl6 style -> lambda expression. [NEW]
	  [VERY EXPERIMENTAL]

Wed Jul 27 10:43:14 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (id2ref): must not assign pointers to long int.  use
	  LONG_LONG instead if SIZEOF_LONG < SIZEOF_VOIDP.
	  [ruby-talk:149645]

	* ruby.h: use LONG_LONG to simplify the change.
	  [ruby-talk:149645]

Wed Jul 27 10:59:02 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_each): rewinddir(3) before iteration.
	  [ruby-talk:149628]

Wed Jul 27 02:34:58 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_throw): replace all '0x%lx' by '%p'.
	  [ruby-talk:149553]

	* missing/vsnprintf.c (BSD_vfprintf): '%p' need to handle 64bit
	  size pointer.  [ruby-talk:149553]

Tue Jul 26 22:41:28 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/lib/ripper/sexp.rb: new method Ripper.sexp_raw.

	* ext/ripper/lib/ripper/sexp.rb (Ripper.sexp): returns more
	  readable tree.  This is suggested by Kirill A. Shutemov.

Tue Jul 26 22:05:12 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: merge a patch contributed by Daniel Berger,
	  with some modification. (RubyForge #2128)

Tue Jul 26 18:11:33 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h: support LLP64 model.  [ruby-talk:149524]

Tue Jul 26 12:57:40 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/openssl_missing.c: include <openssl/engine.h> before
	  <openssl/x509_vfy.h> to avoid compilation error of mswin32.
	  suggested by NAKAMURA Usaku.

Mon Jul 25 23:48:55 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.[ch]: (rb_w32_vsnprintf, rb_w32_snprintf): removed.

Mon Jul 25 21:30:46 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk: Borland MAKE doesn't look for file names which have paths
	  from VPATH.  fixed: [ruby-dev:26604]

	* ruby.h (NORETURN, DEPRECATED): moved just after config.h.

	* {win32,wince}/Makefile.sub: vsnprintf() is in missing now.

	* {bcc32,win32,wince}/Makefile.sub: moved CPPFLAGS only for ruby
	  source to XCFLAGS.

Mon Jul 25 14:10:02 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: fix en-bugged part in the last commit.

Mon Jul 25 13:45:18 2005  NAJIMA Hiroki  <najima@mickey.ai.kyutech.ac.jp>

	* io.c: check HAVE_SYS_IOCTL_H before including the header.
	  [ruby-dev:26610]

Sat Jul 23 16:48:12 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_engine.c (ossl_engine_s_load): should check
	  OPENSSL_NO_STATIC_ENGINE.

Sat Jul 23 11:46:30 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (rb_fd_select): the all three fd_sets must be long enough for
	  select.  fixed: [ruby-talk:149059]

Sat Jul 23 10:01:41 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_vsprintf, rb_sprintf): new functions return new String,
	  using missing/vsnprintf.c.  [ruby-dev:26580]

	*  missing/vsnprintf.c: made the output changeable.

Fri Jul 22 21:06:08 2005  Tadashi Saito  <shiba@mail2.accsnet.ne.jp>

	* bignum.c (rb_big_eq): reduce isnan().  [ruby-dev:26600]

	* numeric.c (flo_eq, flo_gt, flo_ge, flo_lt, flo_le): ditto.

Fri Jul 22 15:02:39 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: moved copyright description to lib/rss.rb.

	* lib/rss.rb: added for convenience.

	* sample/rss/re_read.rb: added #to_s sample.

	* sample/rss/blend.rb: use 'require "rss"' instead of
	  'require "rss/*"'.
	* sample/rss/list_description.rb: ditto.
	* sample/rss/rss_recent.rb: ditto.
	* sample/rss/tdiary-plugin/rss-recent.rb: ditto.

	* sample/rss/tdiary-plugin/rss-recent.rb: 0.0.6 -> 0.0.7.

Fri Jul 22 14:37:43 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb (RSS::Parser#initialize): accept HTTP/FTP
	  URI and local file path too.

	* test/rss/test_parser.rb (RSS::TestParser#test_parse): test
	  for the above.

Fri Jul 22 07:01:42 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tkutil/tkutil.c (tk_conv_args): forget to revert
	  thread_critical and gc_disable when raise ArgumentError.

	* ext/tk/lib/remote-tk.rb: RemoteTkIp doesn't need to include TkUtil.

	* ext/tk/tcltklib.c: add TclTkIp#has_mainwindow? method.

	* ext/tk/lib/tk.rb: add Tk.has_mainwindow? method.

	* ext/tk/lib/multi-tk.rb: add MultiTkIp#has_mainwindow? method.

	* ext/tk/lib/remote-tk.rb: add RemoteTkIp#has_mainwindow? method.

	* ext/tk/lib/multi-tk.rb: slave IP fail to exit itself when $SAFE==4.

	* ext/tk/lib/multi-tk.rb: remove constants from MultiTkIp module to
	  avoid access from external.

	* ext/tk/lib/multi-tk.rb: check_root flag is ignored on slave IPs'
	  mainloop.

	* ext/tk/lib/multi-tk.rb: hang-up Tk.mainloop called on a slave IP
	  with $SAFE==4.

	* ext/tk/lib/multi-tk.rb: MultiTkIp#bg_eval_proc doesn't work
	  properly.

	* ext/tk/lib/multi-tk.rb: add MultiTkIp#set_cb_error(proc) and
	  cb_error(exc) to log errors at callbacks on safe slave IPs.

	* ext/tk/lib/multi-tk.rb: fail to get an available slave IP object
	  when call Tk.mainloop in the block which is given to new_* method,
	    because cannot finish initialize while the root widget is alive.

	* ext/tk/lib/multi-tk.rb: fail to control a slave IP when Tk.mainloop
	  runs on the IP.

Thu Jul 21 01:00:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/{nkf.c,utf8tbl.c,config.h}:
	  import 1.76
	  [ruby-dev:26592] nkf constification

Wed Jul 20 19:18:52 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (S_ISREG): need to define S_ISREG before it is used first.

Wed Jul 20 18:33:15 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* io.c (wsplit_p): patch for the environment where
	  fcntl(F_GETFL, O_NONBLOCK) is not supported. in that case,
	  set FMODE_WSPLIT without fcntl check. [ruby-dev:26566]

Wed Jul 20 18:07:11 2005  Tanaka Akira  <akr@m17n.org>

	* io.c (rb_io_ctl): update FMODE_WSPLIT_INITIALIZED and FMODE_WSPLIT
	  by F_SETFL.

Wed Jul 20 10:04:51 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_class_path): need to adjust snprintf() len for
	  terminating NUL.  [ruby-dev:26581]

Wed Jul 20 03:58:52 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/socket/socket.c: sorry, BeOS also uses HAVE_CLOSESOCKET,
	  so reverted.

	* ext/socket/extconf.rb: should not define HAVE_CLOSESOCKET
	  on windows.

Wed Jul 20 03:12:21 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/socket/socket.c: should not undef close() on win32.
	  it's defined to rb_w32_close(), otherwise handle leaks.
	  [ruby-Bugs-2131]

Wed Jul 20 00:48:16 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (syserr_initialize): don't use str before StringValue()
	  check.  [ruby-dev:26579]

Tue Jul 19 22:47:29 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (syserr_initialize): add 1 byte for snprintf() size for
	  NUL at the end.  [ruby-dev:26574]

Tue Jul 19 17:16:34 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (trap): remove sigexit(); handle "EXIT" via sig_exec().
	  [ruby-dev:26440]

	* io.c (rb_io_inspect): replace sprintf() with "%s" format all
	  over the place by snprintf() to avoid integer overflow.

Tue Jul 19 14:10:50 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c: rbtk_eventloop_depth is used as int.

	* ext/tk/tcltklib.c: rbtk_pending_exception is tested with
	  NIL_P, so should assign Qnil instead of 0 (Qfalse).

	* ext/tk/tcltklib.c (ip_invoke_real): fixed memory leak when
	  ip is deleted.

Tue Jul 19 13:19:46 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb: For symmetry, add TkVariable#string. It
	  returns a string even if the default value type of the TkVariable
	  object is not "string".

Mon Jul 18 21:39:18 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* eval.c (rb_call0): make the pointer to NODE volatile
	  instead of NODE itself.

Mon Jul 18 14:32:21 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (rb_call0): make body volatile to avoid possible optimization
	  problem.
	  [ruby-dev:26195]

Mon Jul 18 12:23:27 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/io/wait/wait.c: wrong backport from trunk, and compile error on
	  platforms fd_set is not a bit set.  fixed: [ruby-dev:26562]

Mon Jul 18 09:36:25 2005  Tanaka Akira  <akr@m17n.org>

	* rubyio.h (FMODE_WSPLIT, FMODE_WSPLIT_INITIALIZED): new constant.

	* io.c (wsplit_p): new function.
	  (io_fflush): split writing data by PIPE_BUF if wsplit_p is true in
	  multi-threaded mode.
	  (io_fwrite): ditto.
	  [ruby-dev:26540]

Mon Jul 18 05:00:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: import nkf.c 1.73
	  fix: TestKconv 1F

Sun Jul 17 13:46:54 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/wait/extconf.rb, ext/io/wait/wait.c: Win32 platforms support.

Sat Jul 16 23:43:16 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (Init_Enumerator): wrong argument specs.
	  [ruby-core:05481]

Sat Jul 16 15:52:50 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.[hc]: constified socket functions. [ruby-dev:26553]

Fri Jul 15 23:59:03 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parsers/parse_c.rb (handle_class_module): handle a
	  module enclosed in a built-in module.  fixed: [ruby-talk:148239]

	* lib/rdoc/parsers/parse_c.rb (find_body): allow macros as methods.

	* lib/rdoc/parsers/parse_c.rb (find_call_seq): allow :nodoc: modifier
	  in C.  [ruby-core:04572]

Fri Jul 15 23:20:03 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (Init_Enumerator): use an internal directly.

Fri Jul 15 07:58:10 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/server.rb (WEBrick::GenericServer#accept_client):
	  sockets should be non-blocking mode. [ruby-dev:26405]

	* lib/webrick/utils.rb (WEBrick::Utils.set_non_blocking): new method.

Fri Jul 15 00:11:36 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enumeratorize): create new enumerator for current method if
	  no block is given.

	* enumerator.c: moved from ext/enumerator.

Thu Jul 14 18:27:35 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_strerror): should return correct message
	  for ENAMETOOLONG and ENOTEMPTY. (bcc32) [ruby-dev:26533]

	* win32/win32.c (rb_w32_strerror): stripped CR LF on the tail.
	  (bcc32) [ruby-dev:26533]

Thu Jul 14 00:45:42 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* LEGAL (ext/nkf/nkf-utf8): updated from nkf1.7 to nkf-utf8.

Wed Jul 13 22:44:00 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y: remove static variables.  [ruby-dev:26530]

Wed Jul 13 19:36:29 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_mkdir): should set EEXIST (not EACCES)
	  if file or directory already exists. (bcc32) [ruby-dev:26508]

	* win32/win32.c (rb_w32_rmdir): should set ENOTDIR (not EINVAL)
	  if it is not directory. (bcc32, win32)

	* win32/win32.c (rb_w32_rmdir, rb_w32_unlink): restore
	  FILE_ATTRIBUTE_READONLY flag on function failure.

Wed Jul 13 12:40:00 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: TclTkLib.do_one_event doesn't work.

	* ext/tk/lib/tk.rb: Tk.thread_update is available.

Tue Jul 12 23:32:11 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: keep curdir unexpanded.

Mon Jul 11 23:50:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c, intern.h (rb_proc_call, rb_obj_method, rb_method_call):
	  export.

	* ext/enumerator/enumerator.c (enumerator_with_index): [EXPERIMENTAL]
	  added a new method Enumerator#with_index.  [ruby-talk:147728]

Mon Jul 11 08:31:29 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regparse.c (fetch_escaped_value): mask values following \c in
	  regexp.  fixed: [ruby-dev:26500]

Sun Jul 11 05:18:17 2005  Michael Neumann  <mneumann@ruby-lang.org>

	* lib/xmlrpc/server.rb (XMLRPC::Server): Switch from GServer over to
	  WEBrick. This makes file lib/xmlrpc/httpserver.rb obsolete (at least it is
	  no further used by the XML-RPC library).

Mon Jul 11 02:50:23 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI::Socket#request_line):
	  mistook to merge the patch of [ruby-dev:26235] at
	  revision 1.11.

Sun Jul 10 23:58:04 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#unlink): try Dir.unlink first to
	  avoid unlink a directory by root.
	  cf. [ruby-dev:26237]

Sun Jul 10 12:47:01 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/debug.rb (debug_command): added a deficient format specifier.
	  fixed: [ruby-core:05419]

Sat Jul  9 22:02:37 2005  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_method_dispid): convert dispid
	  in Ruby and C by INT2NUM and NUM2INT.

	* ext/win32ole/win32ole.c (ole_invoke2): ditto.

	* ext/win32ole/test/testWIN32OLE.rb: ditto.

	* ext/win32ole/test/testOLEMETHOD.rb: ditto.

Fri Jul  8 15:45:04 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::VERSION): 0.1.4 -> 0.1.5.

	* test/rss/test_version.rb (RSS::TestVersion#test_version):
	  ditto.

	* lib/rss/0.9.rb (RSS::Rss::Channel::Item::Category):
	  domain attribute of <category> is optional. Thanks to
	  Chris Lee <clee@kde.org>.

	* test/rss/test_parser.rb (RSS::TestParser#test_category20):
	  adjusted test case.

Wed Jul  6 18:45:53 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_pattern_match): now returns nil.
	  [ruby-core:05391]

Mon Jul  4 14:35:52 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sample/svr.rb: service can be stopped by ill-behaved client; use
	  tsvr.rb instead.

Mon Jul  4 13:25:21 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* missing/erf.c: original erf.c by prof. Okumura is confirmed to
	  be public domain.  reverted BSD implementation.

Wed Jul  6 11:15:21 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (open_ifs_socket): new function.

	* win32/win32.c (StartSockets, rb_w32_socket): use open_ifs_socket()
	  instead of socket().
	  all changes are derived from [ruby-core:5388].

Wed Jul  6 00:15:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/{nkf.c,utf8tbl.c,config.h}:
	  imported nkf.c 1.70 (support UTF-8-MAC)

	* ext/nkf/lib/kconv.rb: add :utf8mac and :internalunicode

Tue Jul  5 23:44:06 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb: expand source library path.

Tue Jul  5 23:27:14 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (sort_2): get rid of yet another bcc's bug.
	  fixed: [ruby-core:05152]

	* eval.c (rb_thread_save_context): must not switch contexts during
	  re-allocating stack.  fixed: [ruby-core:05219]

Tue Jul  5 15:15:10 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tkutil.c: fix typo.

Tue Jul  5 14:52:56 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: bug fix on treating Unicode strings.

	* ext/tk/tcltklib.c: add methods to treat encoding mode.

	* ext/tk/MANUAL_tcltklib.eng: add description of TclTkLib#encoding,
	  encoding_system, and so on.

	* ext/tk/MANUAL_tcltklib.eucj: ditto.

	* ext/tk/tkutil/tkutil.c: fail to create a Tcl's list string from
	  an array including multiple kind of encoded strings.

	* ext/tk/lib/tk.rb: ditto.

	* ext/tk/lib/multi-tk.rb: 2nd arg of _{to|from}UTF8 is omissible.

	* ext/tk/lib/remote-tk.rb: ditto.

	* ext/tk/lib/tk.rb: override TclTkLib#encoding and encoding= to
	  use TkCore::INTERP.encoding and encoding=.

	* ext/tk/lib/tk.rb: when "require 'tk'" and $KCODE=='NONE', check
	  DEFAULT_TK_ENCODING to decide Ruby/Tk's system encoding mode.

	* ext/tk/lib/tk/encodedstr.rb: check both of Tk.encoding and
	  Tk.encoding_system. Tk.encoding has higher priority.

	* ext/tk/lib/tk/optiondb.rb: ditto.

	* ext/tk/lib/tk/spinbox.rb: ditto.

	* ext/tk/lib/tk/validation.rb: ditto.

	* ext/tk/lib/tk/namespace.rb: arguemnts for TclTkIp#_merge_tklist
	  should be UTF-8 strings.

Mon Jul  4 19:29:32 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/set.rb: test change to follow revision 1.28. (duck typing?)

Mon Jul  4 11:23:50 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/{dbm,gdbm,sdbm}/test_{dbm,gdbm,sdbm}.rb: skip some tests
	  which using fork on fork-less platforms.

Sun Jul  3 23:26:30 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/wsdl/document/test_rpc.rb: compare formatted time string of
	  Time objects instead of comparing Time objects itself to avoid
	  unintended conflict of usec part.  [ruby-dev:26220]

Sat Jul  2 22:41:04 2005  Tanaka Akira  <akr@m17n.org>

	* ext/socket/socket.c (unix_send_io, unix_recv_io): support x86-64 and
	  IA64.

Sat Jul  2 17:06:23 2005  Tanaka Akira  <akr@m17n.org>

	* defines.h (FLUSH_REGISTER_WINDOWS): defined for IA64.
	  (flush_register_windows): declare flush_register_windows.

	* eval.c (flush_register_windows): new function.

	* ruby.h (NOINLINE): move up to be effective in defines.h.

Sat Jul  2 15:19:41 2005  Tanaka Akira  <akr@m17n.org>

	* configure.in: check select_large_fdset.

	* eval.c: use select_large_fdset to support large file descriptors
	  on Solaris.  [ruby-dev:26404]

Fri Jul  1 17:55:08 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_neg): may be accessing bogus pointer value.

Fri Jul  1 15:50:12 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* missing/erf.c: need to include some headers for some platforms.

	* win32/win32.h (copysign, scalb): define for compatibility with
	  other platforms. [ruby-dev:26430]

Fri Jul  1 15:37:42 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* missing/crypt.c: modified to make it compilable on platforms
	  other than BSD.  [ruby-dev:26430]

	* missing/erf.c: ditto.  code from <exp.c> merged.

Fri Jul  1 12:44:56 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI.open_http): refine post_connection_check
	  call.

Fri Jul  1 11:34:08 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* missing/crypt.c: replaced with 4.4BSD version.

	* missing/erf.c: ditto.

	* missing/vsnprintf.c: removed the third provision from the old
	  BSD license.  [ruby-core:05177]

Fri Jul  1 01:45:21 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_min, enum_max): must not return Qundef.
	  fixed: [ruby-core:05299]

Fri Jul  1 00:18:40 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator::respond_to): respond_to? must check
	  destination object.  [ruby-talk:146894]

Thu Jun 30 23:52:12 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (trap): non-string trap hander was ignored.
	  fixed: [ruby-dev:26417]

Thu Jun 30 19:00:21 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex::identify_number): alternative implements
	  for [ruby-dev:26410]. And support a numeric form of 0d99999.

Thu Jun 30 17:28:10 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex::identify_number): should not treat
	  plain zero as an octal number.  [ruby-dev:26410]

Thu Jun 30 15:13:16 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): pre-evaluate argument for unambiguous
	  evaluation order.  [ruby-dev:26383]

Thu Jun 30 14:48:23 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/net/http.rb (Net::HTTP#connect, Net::HTTP#request): should
	  not send proxy username and password to origin servers.
	  [ruby-dev:25673]

	* lib/net/http.rb (Net::HTTP::ProxyDelta#edit_path): should not
	  send HTTPS scheme URL to origine servers. [ruby-dev:25689]

Thu Jun 30 09:53:56 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (Delegator::method_missing): forward unknown
	  method to the destination.  suggested by
	  <christophe.poucet@gmail.com>.  [ruby-talk:146776]

Wed Jun 29 00:03:20 2005  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* regparse.c (fetch_token): avoid warning of unused goto tag.
	  [ruby-dev:26389]

Tue Jun 28 21:59:29 2005  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* dir.c, eval.c, parse.y, process.c, ruby.c: avoid warning "unused
	  variable" [ruby-dev:26387]

	* dir.c (glob_helper): avoid warning "enumeration value `RECURSIVE'
	  not handled in switch" [ruby-dev:26392]

Tue Jun 28 01:52:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb: add Kconv::VERSION
	* ext/nkf/lib/kconv.rb (conv): can process arrayed options
	* ext/nkf/nkf-utf8/nkf.c: imported Revision 1.69
	* ext/nkf/nkf-utf8/utf8tbl.c: imported Revision 1.9

Sat Jun 25 23:30:51 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (detach_process_watcher): terminate process watcher
	  thread right after rb_waitpid() succeed.  [ruby-talk:146430]

Sat Jun 25 17:12:20 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils.parse_query): should
	  discard if key=val pair is empty. patch from Gary Wright.

Sat Jun 25 15:49:18 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_min, enum_max, enum_min_by, enum_max_by): do not ignore
	  nil as the first element.

Sat Jun 25 15:13:54 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/set.rb (Set#==): [ruby-dev:25206] (ported from ruby_1_8 branch)

Sat Jun 25 11:37:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb: remove constants
	  Iconv_Shift_JIS, Uconv_EUC_JP, Iconv_UTF8
	* ext/nkf/lib/kconv.rb: add module functions to Kconv
	  conv, {eucjp, shiftjis, utf8}?, guess_as_symbol
	* ext/nkf/lib/kconv.rb: add instance methods to String
	  conv, {eucjp, shiftjis, utf8}?
	* ext/nkf/lib/kconv.rb: add aliases Kconv.to_* and String#to_*

Fri Jun 24 17:00:00 2005  Shigeo Kobayashi  <shigeo@tinyforest.jp>

	* ext/bigdecimal/bigdecimal.c: patch from "NATORI Shin"
	  (u-tokyo.ac.jp) applied to fix rounding bug.

Fri Jun 24 13:17:45 2005  akira yamada  <akira@ruby-lang.org>

	* lib/uri/common.rb, lib/uri/generic.rb: fixed typo in documents and
	  replaced some existent domain name with "example.com".

Fri Jun 24 12:23:19 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fix typo on Tk.grid_propagate.

	* ext/tk/lib/tk.rb: Tk.event_generate and TkWindow#event_generate
	  accept TkEvent::Event object as context argument.

	* ext/tk/lib/tk/event.rb: add TkEvent::Event#valid_fields and
	  valid_for_generate to get field parameters of event_generate.

Thu Jun 23 23:55:59 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* runruby.rb: should load built rbconfig.rb.

Thu Jun 23 16:53:15 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/canvastag.rb: TkcGroup.new cannot include given items.
	  TkcGroup#exclude calls wrong method.
	  Add alias TkcGroup#add [ruby-talk:146049].

	* ext/tk/lib/tk/canvas.rb: TkCanvas#dtag and some subcommands of
	  TkCanvas#addtag fail to treat a TkcTag argument.

	* ext/tk/lib/tk/event.rb: add TkEvent::Event#generate to help to send
	  current event to other widgets.

Mon Jun 20 18:44:04 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (FUNCTION_CALL_MAY_RETURN_TWICE): DUMMY_SETJMP is replaced
	  because setjmp is not enough to fix getcontext and SPARC register
	  window problem.

Mon Jun 20 17:15:51 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dbm/dbm.c (fdbm_closed): new method DBM#closed?

	* ext/gdbm/gdbm.c (fgdbm_closed): new method GDBM#closed?

	* ext/sdbm/init.c (fsdbm_closed): new method SDBM#closed?

	* test/dbm/test_dbm.rb, test/gdbm/test_gdbm.rb, test/sdbm/test_sdbm.rb
	  (teardown): close all db objects before deleting data files.

	* win32/win32.{ch} (unlink): hook runtime function to change
	  file attribute before unlinking.
	  merge from 1.8, see [ruby-dev:26360]

Mon Jun 20 02:15:35 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (define_final): document fix: finalizers never get called
	  before target object is destroyed.

Mon Jun 20 01:26:49 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/openssl_missing.c, ext/openssl/ossl.h,
	  ext/openssl/ossl_asn1.c, ext/openssl/ossl_bio.c,
	  ext/openssl/ossl_pkcs12.h, ext/openssl/ossl_x509req.c: avoid
	  compiler warnings. suggested by Michal Rokos.

Sun Jun 20 00:22:02 2005  Michael Neumann  <mneumann@ruby-lang.org>

	* lib/xmlrpc/utils.rb: Patch by Nobuhiro IMAI fixes the following
	  problem: Default value modification on
	  Module#public_instance_methods (false -> true) breaks
	  s.add_handler(XMLRPC::iPIMethods("sample"), MyHandler.new) style
	  security protection.

	* lib/xmlrpc/client.rb: Aliased XMLRPC::Client#new2 as
	  XMLRPC::Client#new_from_uri, and #new3 as #new_from_hash.

Sun Jun 19 14:09:07 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (run_final): reduce unnecessary object allocation during
	  finalization.

	* gc.c (rb_gc_call_finalizer_at_exit): deferred finalizers list should
	  be cleared before calling them.  fixed: [ruby-talk:145790]

Sat Jun 18 01:15:36 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/readline/readline.c (readline_readline): do not set
	  rl_{in,out}stream.

	* ext/readline/readline.c (readline_s_set_input): new method.

	* ext/readline/readline.c (readline_s_set_output): new method.

	* lib/irb/input-method.rb: set Readline.input and Readline.output.

Fri Jun 17 13:01:40 2005  Tanaka Akira  <akr@m17n.org>

	* lib/time.rb (Time.parse): fix previous leap seconds support.
	  (Time.rfc2822): ditto.
	  (Time.xmlschema): ditto.

Thu Jun 16 15:41:32 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (load_file): '!' is already read. reported by gotoyuzo.

Thu Jun 16 15:09:38 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c (ip_rb_threadVwaitCommand): Tcl_Release
	  was missing.

Thu Jun 16 13:34:48 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: add Tk.getMultiple{Open|Save}File() which return
	  an Array of selected files.

Thu Jun 16 12:53:24 2005  Tanaka Akira  <akr@m17n.org>

	* lib/time.rb (Time.parse): "Fri Jan  1 08:59:60 +0900 1999" was
	  parsed as "Fri Jan 01 09:00:00 JST 1999" even on an environment
	  which supports leap seconds.
	  (Time.rfc2822): ditto.
	  (Time.xmlschema): ditto.

Thu Jun 16 00:13:41 2005  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb (Resolv::DNS::Resource#ttl): new attribute.
	  (Resolv::DNS::Resource#==): ignore @ttl.
	  (Resolv::DNS::Resource#hash): ditto.
	  (Resolv::DNS::Message::MessageDecoder#get_rr): save TTL in a
	  Resource object.
	  based on [ruby-core:5190] by Eric Hodel.

Wed Jun 15 18:26:39 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: support "tk inactive" sub-command [for Tcl/Tk8.5a3]

	* ext/tk/lib/tk/namespace.rb: support "namespace path" sub-command and
	  'namespace ensemble' sub-command [for Tcl/Tk8.5a3]

Tue Jun 14 02:02:43 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tkutil/tkutil.c: add TkUtil::CallbackSubst.subst_arg(m, ...)
	  & _define_attribute_aliases(hash) to get substitution-argument from
	  attributes (e.g. subst_arg(:x,:y,:num,:button) --> "%x %y %b %b ").

	* ext/tk/lib/tk/event.rb: use _define_attribute_aliases().

Mon Jun 13 13:03:08 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* hash.c (ruby_setenv): fixed SEGV. [ruby-dev:26186]

Mon Jun 13 01:54:20 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (sigexit): call rb_thread_signal_exit() instead of
	  rb_exit().  [ruby-dev:26347]

	* eval.c (rb_thread_signal_exit): a new function to exit on main
	  thread.

	* eval.c (rb_thread_switch): exit status should be retrieved from
	  ruby_errinfo.

	* eval.c (rb_f_exit): ensure exit(0) should call
	  exit(EXIT_SUCCESS).

Mon Jun 13 01:20:02 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (rb_gc_mark_threads): curr_thread may not be part of the
	  thread list.  [ruby-dev:26312]

Sat Jun 11 22:34:44 2005  Minero Aoki  <aamine@loveruby.net>

	* parse.y: missing arg_paren event.  This patch is contributed by
	  Mitchell N Charity.

Fri Jun 10 23:55:17 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (unknown_node): show more information.  [ruby-dev:26196]

Fri Jun 10 23:35:34 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* missing/mkdir.c: remove. [ruby-core:05177]

Fri Jun 10 22:54:18 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing.h: fd_set stuffs need sys/types.h.  fixed: [ruby-core:05179]

Thu Jun  9 23:58:12 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/Win32API/Win32API.c (Win32API_Call): disable global
	  optimization. fixed: [ruby-core:05143]

Thu Jun  9 23:35:22 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_inject): default the result value to Qundef to use
	  first element as initial value if not given.

Thu Jun  9 19:55:41 2005  Tanaka Akira  <akr@m17n.org>

	* eval.c (ruby_longjmp): new macro to call longjmp, setcontext, etc.
	  (ruby_setjmp): new macro to call setjmp, getcontext, etc.
	  (ruby_setjmp): call setjmp before getcontext to avoid IA64 register
	  stack problem.
	  [ruby-talk:144939]

	* gc.c (Init_stack): remove IA64_MAGIC_STACK_LIMIT.

Thu Jun  9 18:24:16 2005  Tanaka Akira  <akr@m17n.org>

	* configure.in, eval.c, gc.c: use libunwind only on HP-UX.
	  [ruby-dev:26297]

Thu Jun  9 14:46:32 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (env_aset): do not treat nil as key-removing value.
	  [ruby-list:40865]

	* parse.y (method_call): allow aref expression ([]) to take a
	  block.

	* parse.y (block_dup_check): a function to check duplication of
	  a block argument and an actual block.

Thu Jun  9 11:55:34 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (SimpleDelegator::__setobj__): need check for
	  recursive delegation.  [ruby-core:04940]

Thu Jun  9 11:50:43 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb: add underscore aliases CGI::escape_html,
	  CGI::unescape_html, CGI::escape_element, CGI::unescape_element.
	  [ruby-core:05058]

Wed Jun  8 18:47:10 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg): fix looking point drift.

Wed Jun  8 12:25:59 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_nitems): add the block feature to Array#nitems.
	  suggested by Bertram Scharpf <lists@bertram-scharpf.de> in
	  [ruby-talk:134083].

Wed Jun  8 11:11:34 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (get2comp): revert all prior changes, and calculate
	  proper 2's complement for negative numbers.

Wed Jun  8 08:33:10 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_min_by, enum_max_by): return nil if no iteration.
	  fixed: [ruby-dev:26245]

	* eval.c (rb_need_block): ensure a block is given.

	* eval.c (backtrace): skip successive frames sharing same node.

Wed Jun  8 01:27:06 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bignorm): fixed a bug in normalizing negative numbers
	  reported from Honda Hiroki <hhonda@ipflex.com>.  normalizing
	  should not trim leading zeros from negative numbers.

	* bignum.c (rb_cstr_to_inum): must remove leading zeros for this
	  case.

Wed Jun  8 00:15:08 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (ruby_getaddrinfo__aix): merged a patch from
	  KUBO Takehiro <kubo at jiubao.org> to support AIX.  [ruby-list:40832]

Wed Jun  8 00:09:01 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/yaml/rubytypes.rb (Array::to_yaml): merged a patch from
	  Tilman Sauerbeck <tilman at code-monkey.de>.  [ruby-core:05055]

	* lib/yaml/rubytypes.rb (Hash::to_yaml): ditto.

Wed Jun  8 00:00:01 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/curses/curses.c (curses_insertln): merged a patch from
	  TAKAHASHI Tamotsu <ttakah at lapis.plala.or.jp>.  [ruby-ext:02305]

Tue Jun  7 19:34:15 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/init.rb (IRB::IRB.rc_file_generators): more flexible
	  IRB.rc_file_generators.  [ruby-core:05163]

Tue Jun  7 18:39:31 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/thread.rb: RDoc documentation from Eric Hodel
	  <drbrain@segment7.net> added.  [ruby-core:05148]

Tue Jun  7 18:30:04 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): add .SUFFIXES from depend file.
	  fixed: [ruby-dev:26294]

Tue Jun  7 17:20:39 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): allow ';;' to be block terminator in
	  place of 'end'.  [highly experimental]

	* misc/ruby-mode.el (ruby-block-end-re): allow ';;' to be a
	  negative indent trigger.  [highly experimental]

	* parse.y (parser_yylex): small error fixed.

Tue Jun  7 16:45:49 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): "respond_to?:foo" should be interpreted
	  as "respond_to? :foo" at the command level.  [ruby-talk:144303]

Tue Jun  7 16:32:53 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): raise exception on debug mode (-d),
	  not verbose mode (-v/-w).  [ruby-core:05123]

	* sprintf.c (rb_f_sprintf): warn always on verbose mode.

Tue Jun  7 10:30:49 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: slave-ip fails to call procedures
	  delegated by master-ip.

Mon Jun  6 16:35:18 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/ripper/depend: add .y to .SUFFIXES for nmake.

Sun Jun  5 23:00:35 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/console.rb: create console when required

	* ext/tk/sample/tkextlib/tile/demo.rb: fix TypeError & create Console

Sun Jun  5 10:23:52 2005  Tanaka Akira  <akr@m17n.org>

	* signal.c (ruby_signal): don't set SA_RESTART.
	  [ruby-dev:26276]

Sat Jun  4 14:55:18 2005  Tanaka Akira  <akr@m17n.org>

	* test/dbm/test_dbm.rb: merged from ext/dbm/testdbm.rb.

	* test/gdbm/test_gdbm.rb: merged from ext/gdbm/testgdbm.rb.

	* test/sdbm/test_sdbm.rb: renamed from ext/sdbm/testsdbm.rb with
	  modification to use test/unit.

Fri Jun  3 23:23:02 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h (rb_fdset_t): deal with fd bit sets over FD_SETSIZE.
	  fixed: [ruby-dev:26187]

	* eval.c (rb_fd_init, rb_fd_term, rb_fd_zero, rb_fd_set, rb_fd_clr,
	  rb_fd_isset, rb_fd_copy): ditto.

	* io.c (rb_io_wait_readable, rb_io_wait_writable, rb_f_select): ditto.

	* ext/io/wait/wait.c (io_wait): ditto.

	* ext/socket/socket.c (wait_connectable, unix_recv_io): ditto.

Fri Jun  3 14:06:12 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: fix typo.

Thu Jun  2 23:42:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y: pragma support on ripper.  [ruby-dev:26266]

Thu Jun  2 00:02:16 2005  Minero Aoki  <aamine@loveruby.net>

	* struct.c: accessing >10 member caused segmentation fault.
	  [ruby-dev:26247]

	* test/ruby/test_struct.rb: test it.

Wed Jun  1 11:30:09 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/Makefile.sub: can use single quote character in DESTDIR.
	  [ruby-dev:26205]

	* bcc32/Makefile.sub: Dir.glob in 1.9 doesn't treat \ as path separator.
	  [ruby-dev:26254]

Wed Jun  1 00:11:06 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (method_call): new experiment: "(expr)(args...)" to
	  invoke "expr.call(args...)".  [EXPERIMENTAL]

Tue May 31 23:43:41 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (command): revert implicit "call" for local variables.

Tue May 31 15:52:45 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#run): should
	  break the loop if the socket reached to EOF. [ruby-talk:142285]

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#run): send response
	  without reading the whole request body if keep-alive is disabled.
	  [experimental]

Mon May 30 23:48:29 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/macpkg.rb: add PACKAGE_NAME information of Tcl/Tk
	  Extension.

	* ext/tk/lib/tk/msgcat.rb: ditto.

	* ext/tk/lib/tk/winpkg.rb: ditto.

	* ext/tk/lib/tkextlib/*: ditto.

Sat May 28 16:39:21 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/openssl/test_x509store.rb: add test for expired CRL
	  and refine some assertions.

Sat May 28 05:15:44 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_set_time): should
	  not set internal flag directory.

Sat May 28 02:00:11 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI::Socket#request_line):
	  ENV["REQUEST_URI"] is better to get correct Request-URI
	  than ENV["SCRIPT_NAME"] + ENV["PATH_INFO"].  [ruby-dev:26235]

Fri May 27 16:32:04 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/mkmf.rb: use the semicolon as the path separator
	  in the environment of MSYS.  fixed: [ruby-dev:26232]

Thu May 26 20:31:21 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (remove_entry_secure): add documentation.

	* lib/fileutils.rb (remove_entry_secure): should not invoke
	  unlink(2) against a directory.

Thu May 26 08:29:19 2005  Akiyoshi, Masamichi  <akiyoshi@hp.com>

	* vms/vmsruby_private.c, vms/vmsruby_private.h: private routines
	  for VMS port are added.

	* eval.c (ruby_init): change to call VMS private intialization routine.

Thu May 26 07:39:07 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (rm_r): use lchown(2), not chown(2).
	  [ruby-dev:26226]

	* lib/fileutils.rb (cd): remove :noop option. (feature change)

	* lib/fileutils.rb (cp_r): should copy symlink as symlink, for
	  also tree root. (feature change)

	* lib/fileutils.rb (cp_r): new option :dereference_root.

	* lib/fileutils.rb: new method remove_entry.

	* lib/fileutils.rb: new method remove_entry_secure.

	* lib/fileutils.rb: add documentation.

Thu May 26 06:08:11 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: add shortcut-methods of tk_call + tk_split_list

Wed May 25 20:06:27 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: TkComm#tk_split_*list fail to split a kind of SJIS
	  strings. To avoid the trouble, add arguments to control converting
	  encoding, and do split on a UTF8 string.

	* ext/tk/lib/multi-tk.rb: modify to attend encoding.

	* ext/tk/lib/remote-tk.rb: ditto.

	* ext/tk/lib/tk/itemconfig.rb: ditto.

	* ext/tk/lib/tk/listbox.rb: ditto.

	* ext/tk/lib/tk/namespace.rb: ditto.

	* ext/tk/lib/tk/panedwindow.rb: ditto.

	* ext/tk/lib/tk/text.rb: ditto.

	* ext/tk/lib/tk/textmark.rb: ditto.

	* ext/tk/lib/tk/texttag.rb: ditto.

	* ext/tk/lib/tk/variable.rb: ditto.

	* ext/tk/lib/tk/winfo.rb: ditto.

	* ext/tk/lib/tkextlib/iwidgets/scrolledlistbox.rb: ditto.

	* ext/tk/lib/tkextlib/iwidgets/scrolledtext.rb: ditto.

	* ext/tk/lib/tk.rb: add TkWindow#lower_window/raise_window and
	  Tk#lower_window/raise_window by reason of method-name conflict

	* ext/tk/lib/tk/canvas.rb: bug fix on TkCanvas#delete when given
	  non-TkcItem arguments.

	* ext/tk/lib/tkextlib/iwidgets/scrolledcanvas.rb: ditto.

Wed May 25 19:48:12 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (rm_r): does chown(2). [ruby-dev:26199]

Wed May 25 12:59:48 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI::Meta::RE_QUOTED_STRING): a content of
	  quoted-string should be zero or more characters.

Tue May 24 23:42:16 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (fix_pow): support Fixnum ** Float case directly
	  without coercing.  [ruby-talk:142697] [ruby-talk:143054]

Tue May 24 16:57:24 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.c (require_libraries): caused SEGV when continuation jumped
	  in to the required library code.

Tue May 24 17:45:59 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* test/readline/test_readline.rb: do not test libedit.
	  fixed: [ruby-dev:26217]

Tue May 24 06:45:31 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-font-lock-syntactic-keywords): string
	  literals to be matched non-greedy.

Tue May 24 00:39:14 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/calc: method name 'set' was able to crash with a class Set.
	  [ruby-dev:26210]

	* test/wsdl/document/test_rpc.rb: dateTime comparison failed under
	  TZ=right/Asia/Tokyo (with leap second.) [ruby-dev:26208]

Mon May 23 16:23:06 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: Framework support on MacOS X Tiger.

	* ext/tk/README.tcltklib: add description of Framework support options.

Mon May 23 15:07:34 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub ($(PROGRAM)): add dependency on $(LIBRUBY_SO).
	  [experimental]

Mon May 23 12:21:37 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (make_regexp): should not return junk address during
	  compile time.  [ruby-dev:26206]

Sun May 22 21:54:06 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/{soap,wsdl,xsd}, test/{soap,wsdl,xsd}: imported soap4r/1.5.4.

	  == SOAP client and server ==

	  === for both client side and server side ===

	  * improved document/literal service support.
	    style(rpc,document)/use(encoding, literal) combination are all
	    supported.  for the detail about combination, see
	    test/soap/test_style.rb.

	  * let WSDLEncodedRegistry#soap2obj map SOAP/OM to Ruby according to
	    WSDL as well as obj2soap.  closes #70.

	  * let SOAP::Mapping::Object handle XML attribute for doc/lit service.
	    you can set/get XML attribute via accessor methods which as a name
	    'xmlattr_' prefixed (<foo name="bar"/> -> Foo#xmlattr_name).

	  === client side ===

	  * WSDLDriver capitalized name operation bug fixed.  from
	    1.5.3-ruby1.8.2, operation which has capitalized name (such as
	    KeywordSearchRequest in AWS) is defined as a method having
	    uncapitalized name. (converted with GenSupport.safemethodname
	    to handle operation name 'foo-bar').  it introduced serious
	    incompatibility; in the past, it was defined as a capitalized.
	    define capitalized method as well under that circumstance.

	  * added new factory interface 'WSDLDriverFactory#create_rpc_driver'
	    to create RPC::Driver, not WSDLDriver (RPC::Driver and WSDLDriver
	    are merged).  'WSDLDriverFactory#create_driver' still creates
	    WSDLDriver for compatibility but it warns that the method is
	    deprecated.  please use create_rpc_driver instead of create_driver.

	  * allow to use an URI object as an endpoint_url even with net/http,
	    not http-access2.

	  === server side ===

	  * added mod_ruby support to SOAP::CGIStub.  rename a CGI script
	    server.cgi to server.rb and let mod_ruby's RubyHandler handles the
	    script.  CGIStub detects if it's running under mod_ruby environment
	    or not.

	  * added fcgi support to SOAP::CGIStub.  see the sample at
	    sample/soap/calc/server.fcgi.  (almost same as server.cgi but has
	    fcgi handler at the bottom.)

	  * allow to return a SOAPFault object to respond customized SOAP fault.

	  * added the interface 'generate_explicit_type' for server side
	    (CGIStub, HTTPServer).  call 'self.generate_explicit_type = true'
	    if you want to return simplified XML even if it's rpc/encoded
	    service.

	  == WSDL ==

	  === WSDL definition ===

	  * improved XML Schema support such as extension, restriction,
	    simpleType, complexType + simpleContent, ref, length, import,
	    include.

	  * reduced "unknown element/attribute" warnings (warn only 1 time for
	    each QName).

	  * importing XSD file at schemaLocation with xsd:import.

	  === code generation from WSDL ===

	  * generator crashed when there's '-' in defined element/attribute
	    name.

	  * added ApacheMap WSDL definition.

	* sample/{soap,wsdl}: removed.

Sun May 22 19:11:35 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::SSL::SSLServer#initialize):
	  should initialize session id context. [ruby-core:4663]

	* ext/openssl/ossl_ssl.c (ossl_sslctx_setup): add session id support.

Sun May 22 12:30:58 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h, parse.y (ruby_pragma): removed.  fixed: [ruby-dev:26198]

	* parse.y (parser_pragma): pragma name was ignored.

Sun May 22 02:39:57 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (rm_r): new option :secure to avoid
	  time-to-check-to-time-to-use security problem.  [ruby-dev:26100]

	* lib/fileutils.rb (remove_file, remove_dir): try chmod(700) only
	  on Windows.

	* lib/fileutils.rb: does not depend on find.rb.

	* lib/fileutils.rb: new method chmod_R.

	* lib/fileutils.rb (chown_R): did not work.

Sat May 21 10:23:21 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/Makefile.sub: tds files were not deleted when DESTDIR
	  included '\' path delimiter. [ruby-dev:26193]

Fri May 20 15:52:18 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  return 2 items if completion_proc returns only 1 item (for libedit).

Fri May 20 01:24:33 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/readline/extconf.rb: check rl_vi_editing_mode() and
	  rl_emacs_editing_mode().

Thu May 19 23:33:09 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/readline/readline.c: supported libedit. fixed: [ruby-core:4858]

	* ext/readline/extconf.rb: added new option --enable-libedit.

	* test/readline/test_readline.rb: added assertions for
	  Readline::HISTORY.

	* lib/irb/input-method.rb: do not use Readline::HISTORY.pop.

Wed May 18 23:42:25 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (exc_exception): reverted to call Exception#initialize
	  directly.  fixed: [ruby-dev:26177]

Wed May 18 17:38:51 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* dir.c (glob_helper): check whether path is "" before calling
	  do_opendir.  [ruby-dev:26183]

Wed May 18 13:40:48 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (NtInitialize): fix typo.

Wed May 18 11:07:47 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_helper): get rid of using String.  [ruby-dev:26180]

	* eval.c (ruby_options), win32/win32.c (NtInitialize): move argument
	  intialization back.  [ruby-dev:26180]

Tue May 17 11:49:18 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (unixtime_to_filetime): use localtime() instead of
	  gmtime() when using FileLocalTimeToFileTime().

Mon May 16 22:42:52 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.h, {bcc32,win32,wince}/Makefile.sub: moved rb_[ugp]id_t
	  to get rid of redefinition warnings on mingw.

	* class.c (rb_class_init_copy): singleton class is disallowed to copy,
	  from its definition.  fixed: [ruby-talk:142749]

	* parse.y (pragma_encoding): add prototype to suppress false warning
	  by VC.

	* process.c (proc_spawn_v): use rb_w32_aspawn on Win32.

Mon May 16 03:29:01 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.{h,c}: define rb_[pgu]id_t.

Mon May 16 00:21:02 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#unlink): use SystemCallError instead of
	  Errno::EISDIR because EISDIR is not portable.
	  [ruby-core:5001]

Sun May 15 22:28:10 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (DRbObject#method_missing): use raise(exception).
	  [ruby-dev:26164]

Sun May 15 18:56:35 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, ruby.h: define rb_[pgu]id_t macros instead of typedefs
	  to get rid of types which might not be defined yet.  [ruby-dev:26165]

Sun May 15 14:35:46 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#unlink): unlink a symlink to a directory
	  was failed.  [ruby-core:4992]

Sun May 15 09:57:30 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (unixtime_to_filetime): deal with DST.
	  [ruby-talk:141817]

Sat May 14 23:59:11 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (exc_exception, {exit,name_err,syserr}_initialize): call
	  Execption#initialize.  fixed: [ruby-talk:142593]

Sat May 14 23:56:41 2005  Erik Huelsmann  <ehuels@gmail.com>

	* configure.in: Check for the availability of pid_t, gid_t and uid_t and
	  remove AC_TYPE_UID_T.  fixed: [ruby-core:04745]

	* defines.h: Remove pid_t typedef.

	* ruby.h: Define rb_pid_t, rb_gid_t and rb_uid_t in accordance with
	 the available system types.

	* process.c: Change instances of pid_t and gid_t to their rb_*
	 counterparts.

	* ext/pty/pty.c: Change pid_t to rb_pid_t.

	* vms/config.h: Define HAVE_{P,G,U}ID_T to 1.

	* win32/Makefile.sub: Remove #define for {g,u}id_t.

	* win32/win32.c: Change pid_t to rb_pid_t.

	* wince/Makefile.sub: Remove #define for {g,u}id_t.

	* wince/sys/types.h: Remove definitions of {p,g,u}id_t.

Sat May 14 11:47:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h (ruby_pragma): prototype.  [ruby-core:04881]

	* parse.y (parser_pragma): parse Emacsen hack.

	* parse.y (parser_prepare): deal with specific syntax at the top.

	* ruby.c (load_file): read the first line iff it started with shebang.

Fri May 13 23:44:22 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: keep srcdir unexpanded.

	* lib/mkmf.rb (create_makefile): quote topdir and hdrdir if necessary.
	  fixed: [ruby-core:04932]

	* lib/mkmf.rb (configuration), {bcc32,win32,wince}/Makefile.sub: make
	  also INSTALL_PROG and INSTALL_DATA system dependent.
	  fixed: [ruby-core:04931]

Fri May 13 23:32:55 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (unknown_node): add volatile directive to prototype.

Fri May 13 17:50:49 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* variable.c (generic_ivar_get): rb_attr_get should not warn.
	  [ruby-dev:26010]

Thu May 12 17:41:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: follow nkf 2.0.5

Thu May 12 16:50:40 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/rdoc/parsers/parse_c.rb: more readability for mixing
	  progress "c..." and warning message.

Thu May 12 15:50:56 2005  Tilman Sauerbeck  <tilman@code-monkey.de>

	* lib/rdoc/parsers/parse_c.rb: show parsing progress for C files.
	  [ruby-core:4341]

Thu May 12 09:53:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* version.c (ruby_show_version): flush for non-tty stdout.

Thu May 12 01:23:55 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (unknown_node): ignore broken NODE to get rid of accessing
	  possibly inaccessible address.  fixed: [ruby-dev:26122]
	  should emit more useful information like [ruby-dev:26126], though.

Wed May 11 15:58:39 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (break_jump): break should not cross functions.
	  [ruby-list:40818]

Wed May 11 10:41:54 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/tempfile.rb (Tempfile#unlink): fixed typo.

Wed May 11 01:03:36 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (TMP_ALLOC): use macro NEW_NODE() to get rid of warnings on
	  platforms which have no alloca().  fixed: [ruby-talk:141301]

Sun May  8 23:17:47 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/timer.rb: fix typo.

Sun May  8 21:00:50 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* hash.c (Init_Hash): remove custom "hash" and "eql?".
	  (ported from 1.8) [ruby-dev:26132]

Sun May  8 16:50:25 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/profiler.rb: fixed "undefined method `[]' for nil:NilClass"
	  [ruby-core:4775] [ruby-talk:140401] [ruby-dev:26118]

Sat May  7 22:58:00 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_var): no libs argument is given.

Fri May  6 08:08:37 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c:rb_hash_hash_i() should be static.  [ruby-core:04815]

	* re.c should include regint.h for declarations of oniguruma
	  functions.  [ruby-core:04815]

Sun May  1 09:15:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_sflag): replace '-' in variable names with '_'.
	  [ruby-dev:26107]

	* eval.c (rb_eval), parse.y (arg): reduce fixnum range literal at
	  parser.  fixed: [ruby-dev:26113]

Sat Apr 30 11:59:25 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_FUNC_ATTRIBUTE): check for function attribute.
	  [ruby-dev:26109]

	* eval.c, gc.c: moved noinline to configure.in.

	* rubyio.h (DEPRECATED): moved to configure.in.

	* ruby.h (DEPRECATED, NOINLINE): default definition.

	* win{32,ce}/Makefile.sub (config.h): deprecated and noinline for
	  __declspec() are available for VC++7 or later.

Sat Apr 30 06:57:39 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb: new methods WEBrick::CGI#[], WEBrick::CGI#logger
	  and WEBrick::CGI#config.  these are necessary to use an instance of
	  WEBrick::CGI as the first argument of HTTPServlet#get_instance.
	  (suggested by Tatsuki Sugiura)

	* lib/webrick/cgi.rb
	  (WEBrick::CGI#initalize): set a dummy to @config[:ServerSoftware]
	  if SERVER_SOFTWARE environment variable is not given.
	  (WEBrick::CGI#start): req.path_info must be a String.
	  (WEBrick::CGI::Socket#request_line): treat REQUEST_METHOD, PATH_INFO
	  and SCRIPT_NAME to run in console.

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils.escape_path): should
	  not use String#split("/"). it removes trailing empty path component.

Thu Apr 28 08:21:51 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (set_arg0): use also environment variable space for setting
	  $0.  [ruby-core:04774]

Wed Apr 27 23:42:22 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (OPTFLAGS): default global optimization to
	  disabled only for VC++6.

Tue Apr 26 22:58:00 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_invoke_core): call Tcl's "::unknown"
	  command when can't get information of target command.

Mon Apr 25 13:54:55 2005  speakillof  <speakillof@yahoo.co.jp>

	* lib/rexml/encodings/SHIFT-JIS.rb: encoding and decoding were
	  swapped. [ruby-core:4772]

Mon Apr 25 01:18:43 2005  Tanaka Akira  <akr@m17n.org>

	* oniguruma.h (OnigWarnFunc): add a variadic argument.
	  [ruby-core:4751]

Sat Apr 23 19:49:21 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c (ip_RubyExitCommand): exit with status code
	  via TclTkIp#_eval didn't work. [ruby-talk:139390]

Sat Apr 23 11:45:29 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_provided): should check also path name to be loaded.
	  fixed: [ruby-dev:26093]

Fri Apr 22 16:55:35 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tcltklib.c (ip_set_exc_message): fixed memory leak.

	* ext/tk/tcltklib.c: eTkCallbackReturn was not initialized.

Thu Apr 21 06:45:28 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_incpush_expand, proc_options): expand relative path
	  given with -I option.  [ruby-dev:26090]

	* configure.in, lib/mkmf.rb, {bcc32,win32,wince}/Makefile.sub: improve
	  C++ support.  [ruby-dev:26089]

Thu Apr 21 01:53:09 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: add rdoc.

Thu Apr 21 00:07:50 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): support platforms have file separator
	  other than /.

	* {bcc32,win32,wince}/Makefile.sub (BUILD_FILE_SEPARATOR): separator
	  of building platform.

	* {bcc32,win32,wince}/Makefile.sub (CP, INSTALL): use COPY command.

Wed Apr 20 23:22:39 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.mk: miniruby depends on MINIOBJS.

	* dmydln.c (dln_load): dummy function to raise LoadError.

	* cygwin/GNUmakefile.in, {bcc32,win32,wince}/Makefile.sub: miniruby
	  can't load extensions on Windows.

Wed Apr 20 23:01:35 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/ifchange.bat: delete testing files.

Wed Apr 20 22:54:54 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: new method Net::HTTP.post_form.

	* lib/net/http.rb: new method Net::HTTPHeader#set_form_data and
	  its alias #form_data=.

	* lib/net/http.rb: Net::HTTPHeader#add_header -> add_field
	  (adjustted to Ruby 1.8).

Wed Apr 20 10:53:30 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/rdoc/parsers/parse_rb.rb (lex_init): use IRB module.
	  [ruby-core:04737]

Wed Apr 20 07:27:18 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {bcc32,win32,wince}/configure.bat, {bcc32,win32,wince}/setup.mak:
	  add extout option.

	* bcc32/setup.mak: make configuration variables overridable.

Tue Apr 19 23:37:09 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/ftools.rb (File.safe_unlink): do not modify a symlinked file.

Tue Apr 19 23:02:40 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (search_required): deal with features with path too.

	* intern.h (rb_file_expand_path): prototype.  fixed: [ruby-dev:26082]

Tue Apr 19 08:38:07 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (search_required, rb_require_safe): expand path in
	  rb_features.  [ruby-dev:26079]

	* file.c (rb_find_file_ext): return absolute path.

	* ext/extmk.rb: expand path for ext/**/extconf.rb.

	* eval.c (search_required): handle static linked extensions.

Mon Apr 18 15:37:35 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_attr): attribute name check added.

	* numeric.c (flo_plus): small typo fix.

Mon Apr 18 11:25:14 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/zlib/zlib.c (zstream_run): fixed SEGV. [ruby-core:4712]

Sun Apr 17 23:57:49 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake, parse_args): do not expand destdir.

	* ext/extmk.rb (relative_from): treat mere drive letter as an absolute
	  path.

Sat Apr 16 17:01:16 2005  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/tdiary_plugin/rss-recent.rb (rss_recent_cache_rss):
	  use the first date information of items as site date information
	  if channel doesn't have date information.

Sat Apr 16 15:27:03 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_PROG_INSTALL): not add -p option to INSTALL.
	  files need timestamps to be kept are only ar-archive on a few
	  platforms, and be installed by instruby.rb but not INSTALL.
	  fixed: [ruby-core:04721]

	* mkconfig.rb: purge autoconf value variables.

Sat Apr 16 10:33:48 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/Makefile.sub: quick hack... prepend DESTDIR.
	  still have restriction on DESTDIR ("", "/", "e:")

Sat Apr 16 03:59:42 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: check for OPENSSL_cleanse.

	* ext/openssl/openssl_missing.h: ditto.

Fri Apr 15 22:40:19 2005  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/tests/testWIN32OLE.rb: add test for WIN32OLE.codepage=

	* ext/win32ole/tests/testOLETYPELIB.rb: correct expected message.

Fri Apr 15 22:04:07 2005  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c(ole_invoke): retry after converting Qnil
	  to VT_EMPTY.

Thu Apr 14 19:05:06 2005  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper] (regexp): dispatch regexp option.
	  [ruby-Bugs:1688]

	* ext/ripper/lib/core.rb: regenerated (interface changed).

Thu Apr 14 18:59:43 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (remove_file): ignore exceptions caused by
	  chmod.

	* lib/fileutils.rb (remove_dir): try to get rights to rmdir.
	  [ruby-Bugs:1502]

Thu Apr 14 18:51:02 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/ruby-lex.rb, lib/irb/slex.rb: bug fix of [ruby-Bugs-1745]

	* lib/irb/ext/loader.rb, lib/irb/ext/save-history.rb:
	  fix location of @RCS_ID

	* lib/irb/cmd/help.rb: a lost of release IRB 0.9.5.

Thu Apr 14 15:10:30 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* lib/irb/notifier.rb, lib/irb/output-method.rb, lib/irb/ext/history.rb
	  fixed warning of 'ruby -w'

Thu Apr 14 05:35:45 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* doc/irb/irb.rd.ja: a lost  of release IRB 0.9.5.

	* lib/irb/slex.rb: bug fix by [ruby-core:04707].

Thu Apr 14 00:20:31 2005  Keiju Ishitsuka  <keiju@ruby-lang.org>

	* bin/irb lib/irb.rb lib/irb/...: IRB 0.9.5.

Wed Apr 13 23:40:21 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::VERSION): 0.1.3 -> 0.1.4.

	* lib/rss/rss.rb (RSS::Element#converter): fixed converter
	  transmission bug.

Wed Apr 13 22:12:16 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#order!): call handlers iff matches
	  non-switch.

Wed Apr 13 21:20:35 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (mingw32): extract msvcr*.dll from objdump result.

Wed Apr 13 19:25:31 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (mingw32): use actual runtime DLL name as ruby DLL
	  name and default load path.

	* win32/Makefile.sub, win32/setup.mak: ditto.

Tue Apr 12 19:30:36 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#make_switch, OptionParser#order!):
	  added non-option and end-of-args handler.  [ruby-talk:136878]
	  [EXPERIMENTAL]

Tue Apr 12 15:33:09 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_finalize): better modification than the
	  previous commit [ruby-dev:26029].

Tue Apr 12 12:38:06 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_finalize): fix SEGV when Tcl_GlobalEval()
	  modifies the argument string to eval.

Tue Apr 12 02:21:55 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_finalize): add existence check of
	  Tcl commands before calling Tcl_GlobalEval().

Mon Apr 11 23:36:04 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: [druby-ja:123] fix: When reference of my object is
	  loaded, the object is tainted.

	* test/drb/test_drb.rb: ditto.

Mon Apr 11 22:18:23 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* dir.c, file.c (lstat): avoid warnings for mingw.

Mon Apr 11 20:11:06 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (ip_finalize): adhoc patch to avoid SEGV when exit
	  on Tcl/Tk8.3.x.

Mon Apr 11 15:24:20 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (configuration): shouldn't output hdrdir twice.

Sat Apr  9 18:20:31 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/image.rb: support to create TkImage object without
	  creating a new image object on Tk.

	* ext/tk/lib/tk/menu.rb: use TkCommandNames on create_self()

	* ext/tk/lib/tk/root.rb: TkRoot.to_eval() returns '.'.

	* ext/tk/lib/tk/text.rb: add methods to create a TkText::IndexString
	  from (x, y) coords.

	* ext/tk/lib/tkextlib/tile/: add demo and update support status.

Sat Apr  9 14:42:29 2005  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/tdiary_plugin/rss-recent.rb: supported configuration
	  via Web browser.

Fri Apr  8 20:17:48 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): hdrdir needs to be defined also in
	  Config::CONFIG.

	* lib/mkmf.rb (configuration, create_makefile): get rid of recursive
	  macro reference.

Fri Apr  8 01:55:20 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/demos-{en,jp}/goldberg.rb: reduced window size.
	  [ruby-dev:25992]

Thu Apr  7 23:58:40 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): keep directory names in Makefile as macros.

	* lib/mkmf.rb (configuration, create_makefile): ditto.

	* lib/mkmf.rb (CXX_EXT): separate C++ extensions.

Thu Apr  7 17:24:17 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* eval.c (rb_call0): "return" event hook should be always executed
	  if event_hooks is set.

Thu Apr  7 14:33:09 2005  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_maker_dc.rb (test_date): added a test for #date=
	  and #dc_date=.

Thu Apr  7 11:49:53 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/dublincore.rb: _really_ supported multiple Dublin
	  Core items.

	* test/rss/rss-assertions.rb (assert_multiple_dublin_core): added
	  an assertion for testing multiple Dublin Core items.

	* test/rss/test_maker_dc.rb (test_rss10_multiple): added a test
	  for making multiple Dublin Core items.

Wed Apr  6 16:06:30 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_env.rb (test_key): should test ENV.key instead of
	  ENV.index. [ruby-dev:25994]

Tue Apr  5 16:01:12 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/*: refactored.
	  - gave a name to 'x'.
	  - undef_method -> remove_method for avoiding a warning in ruby 1.6.

Tue Apr  5 15:45:33 2005  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/tdiary_plugin/rss-recent.rb:
	  new option: @options['rss-recent.use-image-link']:
	  use image as link instread of text if available.

	* sample/rss/tdiary_plugin/rss-recent.rb (RSS_RECENT_VERSION):
	  0.0.5 -> 0.0.6.

Tue Apr  5 15:15:26 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/dublincore.rb: supported multiple Dublin Core items.

	* lib/rss/parser.rb: added class name registry for complex model
	  elements. (ex. have childlen elements, have some attributes and
	  a child element and so on.)

	* lib/rss/maker/base.rb: added default current_element implementation.

	* lib/rss/maker/dublincore.rb: supported multiple Dublin Core
	  items.

	* lib/rss/maker/image.rb: supproted new Dublin Core API.

	* lib/rss/trackback.rb (RSS::TrackBackUtils.new_with_value_if_need):
	  moved to RSS::Utils.

	* lib/rss/utils.rb (RSS::Utils.new_with_value_if_need):
	  moved from RSS::TrackBackUtils.

	* lib/rss/maker/image.rb: fixed invalid argument of
	  add_need_initialize_variable bug.

	* lib/rss/maker/trackback.rb: ditto.

	* lib/rss/rss.rb (Hash#merge): added for ruby 1.6.

	* lib/rss/rss.rb (RSS::BaseModel.date_writer): changed to accept nil
	  for date value.

	* test/test_dublincore.rb: added tests for plural accessor and
	  multiple Dublin Core items.

	* test/test_setup_maker_1.0.rb: fixed swapped actual and expected
	  values.

Mon Apr  4 23:17:52 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb (TkComm#array2tk_list): accept enc-mode argument to
	  decide whether convert encoding of each element or not.

	* ext/tk/lib/tk/variable.rb (TkVariable#value=): fail to convert the
	  encoding of array elements when assign an array to an TkVariable
	  object.

Mon Apr  4 10:26:48 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/lib/tk/dialog.rb: fixed typo.

Sat Apr  2 23:38:54 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (CP, INSTALL): get rid of less portable options.

	* lib/mkmf.rb (configuration, create_makefile): correct configuration
	  variable.

	* wince/configure.bat, wince/setup.mak: add prefix, extstatic and
	  rdoc options.

	* lib/mkmf.rb (create_makefile): ensure library directories get made
	  before copying libraries there.

Sat Apr  2 16:59:46 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: forgot to update RELEASE_DATE

	* ext/tk/lib/tk/variable.rb: fix namespace trouble when autoloading

	* ext/tk/lib/tk/palette.rb: define Tcl variable 'tkPalette' as global

	* ext/tk/lib/tk/dialog.rb: use array2tk_list method when calling
	  Tk.ip_eval.

	* ext/tk/lib/tk/autoload.rb: add autoload entry 'TkDialogObj' and
	  'TkWarningObj'

Sat Apr  2 13:23:17 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* hash.c (env_key): ENV.index is deprecated as well as Hash#index.
	  use ENV.key instead. [ruby-dev:25974]

Sat Apr  2 02:19:11 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb (TkWindow.initialize): accept 'without_creating'
	  option without 'widgetname' option to allow creating a widget object
	  which is used as an argument of Tcl/Tk's widget allocation commands.

	* ext/tk/lib/tk/image.rb (TkImage.initialize): accept 'imagename'
	  option to create a image object by the given name.

Thu Mar 31 22:23:51 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (SRC_EXT): exclude just case different suffixes on case
	  insensitive file system platforms.

	* README.EXT, README.EXT.ja (Appendix C): utility functions.

Thu Mar 31 14:08:43 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_engine.c (ossl_engine_s_load): should return
	  value. [ruby-dev:25971]

Thu Mar 31 11:07:50 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb: @@setter -> @@setters.

	* lib/rss/parser.rb
	  (RSS::BaseListener.register_uri)
	  (RSS::BaseListener.uri_registered?)
	  (RSS::BaseListener.install_get_text_element):
	  swapped the first argument and the second argument.

	* lib/rss/taxonomy.rb: swapped the first argument and the second
	  argument for RSS::BaseListener.install_get_text_element.
	* lib/rss/image.rb: ditto.
	* lib/rss/syndication.rb: ditto.
	* lib/rss/dublincore.rb: ditto.
	* lib/rss/parser.rb: ditto.
	* lib/rss/1.0.rb: ditto.
	* lib/rss/2.0.rb: ditto.
	* lib/rss/0.9.rb: ditto.
	* lib/rss/content.rb: ditto.

Thu Mar 31 11:00:36 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb
	  (RSS::BaseListener.install_setter)
	  (RSS::BaseListener.register_uri): changed fallback way.

Thu Mar 31 08:25:40 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RUBYOPT): clear for the environment RubyGems installed.

	* common.mk (clean-local): keep $(PREP) files till distclean.

	* common.mk (check): do all tests.

Thu Mar 31 06:00:20 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_engine.c (ossl_engine_s_load): should not raise
	  error even if the specified engine could not be loaded. (Dynamic
	  engines don't have fixed name to load.)

Wed Mar 30 17:41:48 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: add TclTkIp#_create_console() method to create
	  a Tcl/Tk's console window.

	* ext/tk/lib/multi-tk.rb: support TclTkIp#_create_console() method.

	* ext/tk/lib/remote-tk.rb: ditto.

	* ext/tk/lib/tk/console.rb: ditto.

	* ext/tk/lib/tk.rb: update RELEASE_DATE

	* ext/tk/sample/demo-*/check2.rb: use 'return' in the Proc object.

	* ext/tk/sample/tkextlib/**: ditto.

Tue Mar 29 22:20:49 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb: use DRbObject.new_with instead of reinit.
	  [ruby-dev:25961]

Tue Mar 29 00:04:57 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: move method DRbObject#reinit to DRbObject.new_with.
	  extract method DRbObject.prepare_backtrace. add DRb.regist_server,
	  remove_server, fetch_server. change server in thread variable if
	  in-proc server. [druby-ja:113]

	* lib/drb/gw.rb: ditto.

Mon Mar 28 20:53:44 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): nothing to be removed when no file
	  was deleted.

	* ext/extmk.rb (extmake): restore srcdir.

Mon Mar 28 08:39:49 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_create): Iconv::Failure requires 3
	  arguments.  (pointed out by NaHi)

Sun Mar 27 00:56:58 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (remove_file): ignore Errno::E* if force option
	  is set. [ruby-dev:25944]

Sat Mar 26 22:51:33 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb (_callback_entry_class?): add for checking whether
	  a class is available for a callback entry.

	* ext/tk/lib/tk.rb (after_cancel): add Tk.after_cancel(afterID) method.

	* ext/tk/lib/tk.rb (array2tk_list): change from private module method
	  of TkComm to public module method.

	* ext/tk/lib/tk.rb (cget): add check that slot argument is not
	  empty string.

	* ext/tk/lib/tk.rb (configinfo): ditto.

	* ext/tk/lib/tk/itemconfig.rb (itemcget): add check that slot argument
	  is not empty string.

	* ext/tk/lib/tk/itemconfig.rb (itemconfiginfo): ditto.

	* ext/tk/lib/tk/entry.rb: add TkEntry#icursor and icursor= (alias of
	  cursor and cursor= method).

	* ext/tk/lib/tk/font.rb: improve font treatment when the font name is
	  empty string.

	* ext/tk/lib/tk/variable.rb: add :variable, :window and :procedure
	  type.

	* ext/tk/lib/tk/variable.rb: improve treatment of array-type
	  tkvariable.

	* ext/tk/lib/tkextlib/blt.rb: add commands for zooming.

	* ext/tk/lib/tkextlib/blt/*: bug fix.

	* ext/tk/lib/tkextlib/treectrl/tktreectrl.rb: bug fix and add methods
	  to call TreeCtrl commands for bindings.

	* ext/tk/sample/tkextlib/blt/*: new sample scripts.

	* ext/tk/sample/tkextlib/treectrl/*: ditto.

Fri Mar 25 10:53:16 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (WIN32_LEAN_AND_MEAN): removed because a lot of
	  troubles.  [ruby-list:40721]

Thu Mar 24 23:10:44 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (macro_defined?): try to compile for an old compiler
	  which doesn't bail out at #error directive.  [ruby-dev:25818]

	* lib/mkmf.rb (check_sizeof): refine logging messages.

Wed Mar 23 19:08:10 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/utils.rb (WEBrick::Utils.create_listeners):
	  - should raise ArgumentError if no port is specified.
	  - even if the specified port is 0, all TCPServers should be
	    initialized with the port given to the first one.

	* lib/webrick/server.rb (WEBrick::GenericServer#initialize): if :Port
	  parameter is 0, it should be updated with the port number which
	  ectually listened.

Wed Mar 23 16:12:40 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* parse.y (primary): fix lineno of rescue and ensure.

Wed Mar 23 00:39:05 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* test/ruby/test_settracefunc.rb (test_event): added tests for
	  "class" and "end" and "raise".

Sun Mar 20 22:51:19 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (mkmf_failed): check if Makefile is created without
	  create_makefile.

Sat Mar 19 23:48:10 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg): returned true always.
	  fixed: [ruby-list:40683]

Sat Mar 19 00:41:02 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/font.rb: add some TkFont class methods to get font
	  information without creating a TkFont object.

	* ext/tk/lib/tkextlib/treectrl/tktreectrl.rb: bug fix and define some
	  classes for components of Tk::TreeCtrl

Thu Mar 17 17:42:13 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (make_struct): allow non local-id field
	  names. [ruby-core:04575]

	* struct.c (inspect_struct): ditto.

Wed Mar 16 23:39:13 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* test/ruby/test_settracefunc.rb: added test for c-return.

Wed Mar 16 22:57:43 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* eval.c (rb_call0): call_cfunc() should be protected.

	* eval.c (rb_add_event_hook): use K&R style.

	* eval.c (rb_remove_event_hook): ditto.

Wed Mar 16 22:03:15 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* eval.c (rb_add_event_hook): new function to add a hook function for
	  interpreter events.

Wed Mar 16 18:08:32 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): reorganize "return" event post.

	* eval.c (return_jump): no need to post "return" event here.

Tue Mar 15 23:49:19 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Init_iconv): InvalidEncoding also should include
	  Iconv::Failure.

Tue Mar 15 23:12:36 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (recursive_check, recursive_push): more restrictive check.
	  fixed: [ruby-dev:25916]

Tue Mar 15 16:38:31 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tkutil/tkutil.c (ary2list): give wrong arguments to hash2kv()

Mon Mar 14 19:39:33 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/timer.rb (TkTimer): forgot to clear @return_value
	  when restarting

	* ext/tk/lib/tk/sample/cd_timer.rb: new sample of TkRTTimer

Mon Mar 14 12:21:03 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/timer.rb (TkRTTimer): forgot to reset the callback
	  time. So, 'continue' do all callbacks between 'stop' and 'continue'.

Mon Mar 14 08:14:56 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (str_to_id): raise ArgumentError for NUL containing
	  strings.

Mon Mar 14 00:13:49 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/timer.rb (TkRTTimer): correct calculation of offset
	  value. get a little better accuracy.

	* ext/tk/sample/demos-en/widget: use a binding with no local variables
	  when eval a sample script.

	* ext/tk/sample/demos-en/bind.rb: ditto.

	* ext/tk/sample/demos-en/tcolor: ditto.

	* ext/tk/sample/demos-jp/widget: ditto.

	* ext/tk/sample/demos-jp/bind.rb: ditto.

	* ext/tk/sample/demos-jp/tcolor: ditto.

Sun Mar 13 22:19:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (recursive_pop): raise TypeError instead of fatal error.
	  fixed: [ruby-dev:25843]

Sun Mar 13 10:09:17 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb: remove test_gc. [ruby-dev:25871]

Sun Mar 13 02:32:54 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_tmp_dh_callback): should get DH
	  parameter from the current SSL object.

Sun Mar 13 02:09:03 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_pkey_dh.c (ossl_create_dh): fix typo.
	  patch from IWATSUKI Hiroyuki. [ruby-dev:25867]

	* ext/openssl/ossl_ssl.c (ossl_tmp_dh_callback): ditto.
	  (ossl_call_tmp_dh_callback): ditto

Fri Mar 11 03:24:59 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (primary): wrong var node was set for NODE_LAMBDA.
	  [ruby-core:04555]

Thu Mar 10 19:10:29 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (lib_eventloop_ensure): mis-delete a timer handler
	  when exit from a recursive called eventloop

	* ext/tk/lib/tk/timer.rb: new TkRTTimer class, which can works for a
	  realtime operation

	* ext/tk/sample/tkrttimer.rb: sample of TkRTTimer class

	* ext/tk/lib/tk/textmark.rb: move  TkTextMark#+ and TkTextMark#- to
	  TkText::IndexModMethods

	* ext/tk/lib/tk/text.rb: improve TkTextMark#+ and TkTextMark#-, and
	  add them to TkText::IndexModMethods module

	* ext/tk/sample/tktextio.rb: add test part of "seek by text index
	  modifiers"

Thu Mar 10 08:10:11 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (make_regexp): need to free internal regexp structure when
	  compilation fails.  [ruby-talk:133228]

Thu Mar 10 01:08:20 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (bv_decl): remove initialize rule from block local
	  variable declaration.

Wed Mar  9 23:55:34 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb (PP::PPMethods#guard_inspect_key): support
	  __recursive_key__.  [ruby-dev:25821]

Wed Mar  9 19:42:21 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c: OpenSSL::SSL::SSLContexts suports callbacks:
	  - SSLContext#client_cert_cb is a Proc. it is called when a client
	    certificate is requested by a server and no certificate was yet
	    set for the SSLContext. it must return an Array which includes
	    OpenSSL::X509::Certificate and OpenSSL::PKey::RSA/DSA objects.
	  - SSLContext#tmp_dh_callback is called in key exchange with DH
	    algorithm. it must return an OpenSSL::PKey::DH object.

	* ext/openssl/ossl_ssl.c:
	  (ossl_sslctx_set_ciphers): ignore the argument if it's nil.
	  (ossl_start_ssl, ossl_ssl_write): call rb_sys_fail if errno isn't 0.
	  [ruby-dev:25831]

	* ext/openssl/ossl_pkey.c
	  (GetPrivPKeyPtr, ossl_pkey_sign): should call rb_funcall first.
	  (DupPrivPKeyPtr): new function.

	* ext/openssl/ossl_pkey_dh.c: add default DH parameters.

	* ext/openssl/ossl_pkey.h: ditto.

	* ext/openssl/lib/openssl/cipher.rb: fix typo. [ruby-dev:24285]

Wed Mar  9 18:09:51 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (gettable_gen): warns if VCALL name is used as
	  out-of-scope block local variable.  [EXPERIMENTAL]

	* parse.y (opt_bv_decl): add explicit block local variable
	  declaration.  raises error for name conflicts.  [EXPERIMENTAL]

Wed Mar  9 13:37:57 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tktextio.rb: fix bug of handling 'end' position.
	  support initial text, overwrite setting and pos_gravity control.

Tue Mar  8 18:16:55 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tktextio.rb: New sample script. TkTextIO class in this
	  sample supports to use a text widget as if it is a I/O stream (such
	  like as StringIO class).

Tue Mar  8 13:39:25 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/mkconstants.rb: workaround for some of 4.4BSD-Lite
	  derived OSs.

Tue Mar  8 12:36:17 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c: document from Sam Roberts
	  <sroberts@uniserve.com> for getsockopt and setsockopt is merged.
	  [ruby-doc:824]

Tue Mar  8 10:48:53 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (rb_exec_recursive): declaration should precede statements
	  before C99.

Tue Mar  8 10:05:40 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (errno_missing): Errno.const_missing to allow references
	  to SyscallError exceptions not defined on the platform.
	  [ruby-core:04522]

	* error.c (Init_syserr): Errno::NOERROR(0) for fallback exception.

Tue Mar  8 01:19:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: follow nkf 1.66
	  fixed: [ruby-dev:25828]

Mon Mar  7 21:29:40 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/server.rb (WEBrick::GenericServer#start): should
	  restore @token if accept failure. suggested by Dominique Brezinski.
	  [ruby-core:04518]

	* sample/webrick/httpsd.rb: fix typo in comment. suggested by
	  Kazuhiko Shiozaki.

Mon Mar  7 21:01:37 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_require_safe): get actual path string under safe level
	  when requested.  fixed: [ruby-dev:25815]

Mon Mar  7 16:46:02 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_start_ssl, ossl_ssl_read,
	  ossl_ssl_write): need to set errno on Win32 platform.

Mon Mar  7 14:55:43 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (block_pass): should not push unique number if a block is
	  not an orphan.  [ruby-dev:25808]

Mon Mar  7 14:13:23 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/buffering.rb (Buffering#initialize):
	  should set @eof and @rbuffer.

Mon Mar  7 10:28:00 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (inspect_obj): unintended space removal.
	  [ruby-dev:25810]

	* eval.c (rb_exec_recursive): should not use NODE in disclosed
	  context.  [ruby-dev:25812]

	* io.c (rb_f_open): need not to check if to_open value is a
	  T_FILE.  [ruby-dev:25812]

Mon Mar  7 01:21:01 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tkutil/tkutil.c: follow the change of st.c (committed
	  at Fri, 4 Mar 2005 15:47:47 +0900 by matz)

Mon Mar  7 00:01:55 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: fail to call TclTkLib.mainloop when $SAFE==4

Sun Mar  6 13:04:10 2005  Dee Zsombor  <zsombor@ruby-lang.org>

	* misc/ruby-electric.el: added.
	* misc/Readme: updated.

Sun Mar  6 11:47:10 2005  Sam Roberts  <sroberts@uniserve.com>

	* lib/pp.rb: rdoced.  [ruby-core:4490]

Sun Mar  6 11:36:37 2005  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb (File::Stat#pretty_print): Etc.getpwuid and Etc.getgrgid
	  may return nil.  [ruby-talk:129826]
	  reported by Daniel Berger.

Sun Mar  6 06:34:31 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_start_ssl): should wait for that
	  the underlying IO become readable or writable if the error was
	  SSL_ERROR_WANT_READ or SSL_ERROR_WANT_WRITE. [ruby-dev:25795]

	* ext/openssl/ossl_ssl.c (ossl_ssl_read, ossl_ssl_write): ditto.

	* ext/openssl/lib/openssl/buffering.rb
	  (Buffering#consume_rbuf): pointless eof flag resetting is deleted.
	  (Buffering#read): should return an empty string if the specified
	  size is zero.
	  (Buffering#readpartial): new method.
	  (Buffering#readline): fix typo.
	  (Buffering#getc): return the first character of string correctly.
	  (Buffering#readchar): fix typo.
	  (Buffering#eof?): should read again it the input buffer is empty.
	  (Buffering#do_write): should rescue Errno::EAGAIN.
	  (Buffering#puts): use "\n" as the output field separator.

	* ext/openssl/extconf.rb: get rid of GNUmakefile generation.

	* text/openssl/test_pair.rb: test for IO like methods.

	* test/ruby/ut_eof.rb: test about empty file.

Sat Mar  5 17:48:31 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (rb_glob): fixed mismatch of argument.

	* dir.c (fnmatch): removed unnecessary code. (by string.c 1.219)

	* win32/win32.c (NtInitialize): ditto. (by numeric.c 1.117)

Sat Mar  5 16:50:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: follow nkf 1.65

Sat Mar  5 16:29:26 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: freeze callback-entry objects

	* ext/tk/lib/tkextlib/tile.rb: support tile-0.6

Sat Mar  5 12:52:08 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): allow putting spaces between target
	  and colon in depend file.

Sat Mar  5 02:41:00 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (eaccess): workaround for VC++8 runtime.

	* win32/win32.c (ioinfo): VC++8 support.

Fri Mar  4 19:39:55 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser#do_includes): replace
	  also locally defined modules.

	* ext/iconv/iconv.c: rdocified.

	* ext/strscan/strscan.c: moved misplaced rdoc.

Fri Mar  4 16:11:20 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (rb_exec_recursive): matched the declaration to prototype.

	* ext/curses/curses.c: don't need to check HAVE_WCOLOR_SET excluding
	  window_color_set().

	* ext/tk/tcltklib.c: fixed commit mistakes.

Fri Mar  4 12:45:17 2005  Tilman Sauerbeck  <tilman@code-monkey.de>

	* lib/rdoc/parsers/parse_c.rb: allow whitespace after function names.
	  [ruby-core:4296]

	* lib/rdoc/parsers/parse_simple.rb: adds support for private comments
	  in the "simple" parser. [ruby-core:4301]

Fri Mar  4 12:45:17 2005  Charles Mills  <cmills@freeshell.org>

	* lib/rdoc/parsers/parse_c.rb: adds support for constants
	  (rb_define_const), accessors (rb_define_attr), and makes a
	  couple fixes. [ruby-core:4307]

Fri Mar  4 12:45:17 2005  Florian Gross  <florgro@gmail.com>

	* lib/rdoc/parsers/parse_rb.rb: Logic for def Builtin.method() end
	  [ruby-core:4302]

Fri Mar  4 12:45:17 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c: replace rb_protect_inspect() and rb_inspecting_p() by
	  rb_exec_recursive() in eval.c.

	* eval.c (rb_exec_recursive): new function.

	* array.c (rb_ary_join): use rb_exec_recursive().

	* array.c (rb_ary_inspect, rb_ary_hash): ditto.

	* file.c (rb_file_join): ditto.

	* hash.c (rb_hash_inspect, rb_hash_to_s, rb_hash_hash): ditto.

	* io.c (rb_io_puts): ditto.

	* object.c (rb_obj_inspect): ditto

	* struct.c (rb_struct_inspect): ditto.

Fri Mar  4 10:15:30 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/set.rb (SortedSet::setup): a hack to shut up warning.
	  [ruby-talk:132866]

Fri Mar  4 09:37:12 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (install-nodoc, pre-install-doc, post-install-doc):
	  fix some omissions.

Fri Mar  4 08:09:12 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/time.rb (Time::strptime): add new function.  inspired by
	  [ruby-talk:132815].

	* lib/parsedate.rb (ParseDate::strptime): ditto.

Fri Mar  4 07:07:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: follow nkf 1.63

Thu Mar  3 23:24:00 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: follow nkf 1.62

Thu Mar  3 18:47:18 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* {bcc32,win32,wince}/Makefile.sub (config.h): check if affected
	  when makefiles are modified.

	* {bcc32,win32,wince}/Makefile.sub (config.status): add variables
	  for tests.

	* win32/ifchange.bat: try to update a file only if modified.

	* win32/resource.rb: more descriptions.

	* common.mk: add {pre,post}-install targets.

	* instruby.rb (install?): install particular part.

	* bcc32/Makefile.sub (post-install-ext): remove debug information
	  files after installation.

	* ext/tk/tcltklib.c (ip_rbUpdateCommand, ip_rb_threadUpdateCommand):
	  get rid of warnings with Tcl/Tk 8.3 or former.

Thu Mar  3 11:49:51 2005  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/tdiary_plugin/rss-recent.rb: added site information.

Wed Mar  2 19:53:44 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (parse_args): return false if nothing matched.

Wed Mar  2 17:15:08 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (lib_eventloop_core): fix typo

Wed Mar  2 16:59:50 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* eval.c (ruby_native_thread_kill): call pthread_kill() to send a
	  signal to ruby's native thread

	* ruby.h: add definition of ruby_native_thread_kill()

	* signal.c (sigsend_to_ruby_thread): send the signal to ruby's
	  native thread ([ruby-dev:25744], [ruby-dev:25754]), and set
	  signal mask to the current native thread

Wed Mar  2 16:03:08 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: enforce thread-check and exception-handling to
	  avoid SEGV trouble.

	* ext/tk/tkutil/tkutil.c: fix a bug on converting a SJIS string array
	  to a Tcl's list string.

	* ext/tk/tcltklib.c: wrap Tcl's original "namespace" command to
	  protect from namespace crash.

	* ext/tk/lib/multi-tk.rb: enforce exception-handling.

	* ext/tk/lib/multi-tk.rb: catch IRB_EXIT to work on irb.

	* ext/tk/lib/tk.rb: ditto.

	* ext/tk/tcltklib.c: add TclTkLib.mainloop_thread?

	* ext/tk/lib/multi-tk.rb: (bug fix) callback returns a value.

	* ext/tk/lib/tk/canvas.rb (delete): bug fix when multiple arguments.

	* ext/tk/lib/clock.rb: fix 'no method error'.

	* ext/tk/lib/clock.rb (self.clicks): accept a Symbol argument.

	* ext/tk/lib/variable.rb: be able to set default_value_type; :numeric,
	  :bool, :string, :symbol, :list, :numlist or nil (default; same to
	  :string). If set a type, TkVariable#value returns a value of the
	  type.

	* ext/tk/lib/tkextlib/tclx/tclx.rb: add Tk::TclX.signal to warn the
	  risk of using TclX extension's 'signal' command.

	* ext/tk/sample/irbtk.rb: irb with Ruby/Tk.

	* ext/tk/sample/demos-*/anilabel.rb: bug fix on 'show code'

	* ext/tk/sample/demos-*/aniwave.rb: new Ruby/Tk animation demo.

	* ext/tk/sample/demos-*/pendulum.rb: ditto.

	* ext/tk/sample/demos-*/goldberg.rb: ditto.

	* ext/tk/sample/demos-*/widget: add entries of animation demos.

Wed Mar  2 12:21:18 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): [EXPERIMENTAL] NODE_LAMBDA implemented.
	  [ruby-dev:25780]

	* node.h (NODE_LAMBDA): for literal Proc object.

	* parse.y (expr): interpret mere do...end block as proc object.

	* parse.y (primary): ditto, for brace block.

Tue Mar  1 21:16:54 2005  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* regcomp.c (optimize_node_left): uninitialized member
	  (OptEnv.backrefed_status) was used. [ruby-dev:25778]

Tue Mar  1 16:50:37 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regparse.c: move st_*_strend() functions from st.c.  fixed some
	  potential memory leaks.

Tue Mar  1 00:40:35 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/tuplespace.rb (Rinda::TupleSpace): improved keeper thread.

	* test/rinda/test_rinda.rb: ditto.

Mon Feb 28 23:10:13 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/socket/socket.c (Init_socket): IPv6 is not supported although
	  AF_INET6 is defined on bcc32. (rev1.108 again)

	* ext/socket/mkconstants.rb: ditto.

Mon Feb 28 21:55:49 2005  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* ext/strscan/strscan.c (strscan_s_allocate):
	  use onig_region_init().

	* ext/strscan/strscan.c (adjust_registers_to_matched):
	  use onig_region_set().

Mon Feb 28 15:12:06 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/socket/socket.c (Init_socket): ported more Socket::Constants
	  from ruby_1_8, and made it easy to add new constants.
	  [ruby-dev:25771]

	* ext/socket/depend: ditto.

	* ext/socket/mkconstants.rb: ditto. (added)

Mon Feb 28 11:42:23 2005  Ian Macdonald  <ian@caliban.org>

	* exception error messages updated.  [ruby-core:04497]

Mon Feb 28 09:03:09 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (Init_socket): add bunch of Socket
	  constants.  Patch from Sam Roberts <sroberts@uniserve.com>.
	  [ruby-core:04409]

Sun Feb 27 05:55:38 2005  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: fix typo. [ruby-core:04494]

Sat Feb 26 16:58:20 2005  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* parse.y, re.c, regex.h, LEGAL, ext/strscan/strscan.c:
	  remove oniggnu.h (GNU regex API).

Wed Feb 23 22:08:16 2005  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* st.c, st.h: imported additional file changes on
	  Oniguruma 3.7.0.

Wed Feb 23 21:45:29 2005  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* ascii.c, euc_jp.c, oniggnu.h, oniguruma.h, regcomp.c,
	  regenc.c, regenc.h, regerror.c, regexec.c, regint.h,
	  regparse.c, regparse.h, sjis.c, utf8.c: imported Oni Guruma
	  3.7.0.

Wed Feb 23 15:04:32 2005  akira yamada  <akira@ruby-lang.org>

	* lib/uri/generic.rb (split_userinfo): should split ":pass" into ""
	  and "pass".  [ruby-dev:25667]

Wed Feb 23 08:00:18 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_s_create): no need for negative argc check.
	  [ruby-core:04463]

	* array.c (rb_ary_unshift_m): ditto.

Wed Feb 23 01:53:29 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (initialize): handle certs correctly. Thanks,
	  NABEYA Kenichi.

Wed Feb 23 00:37:34 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/mkmf.rb (mkmf_failed): fixed typo.

Tue Feb 22 23:52:45 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, lib/mkmf.rb: use simple commands if available.

	* mkconfig.rb: remove autoconf internal variables from rbconfig.rb.

	* lib/mkmf.rb (create_makefile): substitute implicit rules in depend
	  file.

	* {bcc32,win32,wince}/Makefile.sub (COMPILE_RULES, RULE_SUBST):
	  include $(topdir) and $(hdrdir) to search path.

Tue Feb 22 23:51:45 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c: get rid of warnings caused by a bug of VC.

Tue Feb 22 23:50:26 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (ruby_signal, ruby_nativethread_signal): must be valid as
	  expressions, not only statements.

Tue Feb 22 12:54:13 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_thread_start_0): update curr_thread before raising
	  TAG_THREAD.  [ruby-dev:25712]

Tue Feb 22 07:24:57 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): identifier after dot must not be a variable.

Mon Feb 21 18:31:12 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* signal.c: Standard signal handlers ignore signals on non-Ruby native
	  threads. When a handler is entried with ruby_signal() (like as the
	  standard signal handlers), the handler for the signal is marked as
	  it cannot accept non-Ruby native threads. If a handler can treat all
	  signals on all native threads, please use ruby_nativethread_signal()
	  to entry it.

Sun Feb 20 00:48:48 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::FTP#buffer_open): access mechanism
	  re-implemented according to RFC 1738.
	  reported by Guillaume Marcais.  [ruby-talk:131650]

Sat Feb 19 18:46:56 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (DRbObject#respond_to?): take two arguments.
	  [ruby-dev:25722]

	* test/drb/drbtest.rb: ditto.

Sat Feb 19 13:52:02 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb: call OpenSSL::SSL::SSLSocket#post_connection_check
	  after connection is made.

Sat Feb 19 13:31:28 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): remove no longer existing installed
	  files.

	* lib/mkmf.rb (install_dirs): return installation directory list.

	* lib/mkmf.rb (create_makefile): reverted wrongly removed lines.

Sat Feb 19 01:28:56 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/bigdecimal/lib/bigdecimal/newton.rb: resolved LoadError.
	  [ruby-dev:25685]

	* ext/bigdecimal/sample/linear.rb: ditto.

	* ext/bigdecimal/sample/nlsolve.rb: ditto.

	* ext/bigdecimal/lib/bigdecimal/nlsolve.rb: removed because this file
	  is sample script and same file exists in ext/bigdecimal/sample.

Fri Feb 18 17:14:00 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/xmlrpc/parser.rb (XMLRPC::FaultException): make it subclass
	  of StandardError class, not Exception class.  [ruby-core:04429]

Fri Feb 18 04:06:41 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (fcall_gen): lvar(arg) will be evaluated as
	  lvar.call(arg) when lvar is a defined local variable. [new]

Thu Feb 17 22:15:34 2005  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* ext/strscan/strscan.c: calls Oniguruma API directly.

Thu Feb 17 21:53:12 2005  K.Kosako  <sndgk393 AT ybb.ne.jp>

	* common.mk, LEGAL: remove reggnu.c.

Thu Feb 17 21:53:12 2005  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* gc.c, re.c: now ruby calls Oniguruma API directly, bypassing
	  GNU compatible APIs.

Thu Feb 17 20:09:23 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/drb/drb.rb (DRbServer.default_safe_level): fix typo.

Thu Feb 17 20:09:23 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/digest/test_digest.rb: separate test case for each algorithms.
	  [ruby-dev:25412]

Thu Feb 17 14:31:52 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_class_initialize): call inherited method before
	  calling initializing block.

	* eval.c (rb_thread_start_1): initialize newly pushed frame.
	  fixed: [ruby-dev:25707]

Thu Feb 17 13:46:00 2005  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/collector.rb (collect_file): now deletes paths added
	  to $LOAD_PATH instead of restoring it verbatim.

	* lib/test/unit/autorunner.rb (AutoRunner.run): fixed so that
	  'ruby -rtest/unit -rtest1 -rtest2 -e0' will use the objectspace
	  collector again. Also tried to simplify the calling convention.

	* test/runner.rb: adjusted for new AutoRunner semantics.

	* lib/test/unit.rb: ditto.

Thu Feb 17 04:21:47 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/open3.rb (Open3::popen3): $? should not be EXIT_FAILURE.
	  fixed: [ruby-core:04444]

Thu Feb 17 00:31:21 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/test_drb.rb, ut_safe1.rb: port from 1.8

Thu Feb 17 00:02:27 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (is_defined): NODE_IASGN is an assignment.

Wed Feb 16 23:54:14 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_start_1): outer block variables wasn't linked to
	  threads.  fixed: [ruby-dev:25700]

Wed Feb 16 15:11:43 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::Nonblock#initialize):
	  native win32 platform doesn't have F_GETFL.

Wed Feb 16 02:47:45 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_read, ossl_ssl_write): should
	  call rb_sys_fail instead of raising SSLError if SSL_ERROR_SYSCALL
	  occurred.

	* ext/openssl/lib/openssl/buffering.rb (Buffering#fill_rbuff):
	  should rescue Errno::EAGAIN.

	* ext/openssl/lib/openssl/buffering.rb (Buffering#each): fix typo.
	  suggested by Brian Ollenberger.

	* ext/openssl/lib/openssl/ssl.rb: set non-blocking flag to the
	  underlying IO.

Tue Feb 15 22:14:34 2005  sheepman  <sheepman@tcn.zaq.ne.jp>

	* ext/readline/readline.c (Readline.readline): use rl_outstream
	  and rl_instream.  [ruby-dev:25699]

Mon Feb 14 23:58:17 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb (RSS::ListenerMixin::tag_end):
	  fixed invalid namespace handling bug.

Mon Feb 14 13:12:38 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb
	  (OpenSSL::SSL::SSLSocket#post_connection_check): new method.

Mon Feb 14 00:10:17 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (DRbServer): add default_safe_level, safe_level,
	  config[:safe_level] ([druby-ja:120])

	* test/drb/test_drb.rb, ut_eval.rb, ut_safe1.rb: ditto.

Sun Feb 13 23:13:46 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/dublincore.rb (RSS::DublicCoreModel#date{,=}): added
	  convenient methods.

	* lib/rss/0.9.rb (RSS::Rss::Channel#date{,=}): ditto.

	* lib/rss/2.0.rb (RSS::Rss::Channel::Item#date{,=}): ditto.

	* test/rss/: added tests for the convenient methods.

Sun Feb 13 23:12:47 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_start_0): restore prot_tag before rewinding.

Sun Feb 13 16:56:52 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI.start): should set reason-phrase
	  to the value of status header field. ([ruby-dev:40617])

Sun Feb 13 11:38:40 2005  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regparse.c (type_cclass_hash): (Thanks Nobu) fixed
	  overrun. ([ruby-dev:25676]).

Sun Feb 13 10:53:08 2005  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* oniggnu.h, oniguruma.h, regcomp.c, st.c: imported
	  Oni Guruma 3.6.0.

Sun Feb 13 01:33:19 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/erb.rb (ERB::Util.h, u): make it module_function.

Sat Feb 12 22:17:11 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (TAG_THREAD): to start a new thread.

	* eval.c (ruby_init, ruby_options, ruby_cleanup, rb_protect,
	  rb_load_protect, rb_thread_start_0): make thread anchor.

	* eval.c (proc_alloc): clone proc object if klass is not Proc or
	  created in different thread.

	* eval.c (rb_block_pass): call a function with a block.  [new]

	* eval.c (rb_f_throw): raise NameError in main thread.

Sat Feb 12 17:29:19 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI.open_loop): send authentication only for
	  the URI directly specified.

Sat Feb 12 15:07:23 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rand_init): suppress warning.

Sat Feb 12 14:10:24 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI.open_http): reject userinfo explicitly.

Sat Feb 12 13:54:03 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb: support https if the platform provides CA
	  certificates.

Sat Feb 12 06:18:28 2005  URABE Shyouhei  <shyouhei@ice.uec.ac.jp>

	* ext/etc/etc.c (Init_etc): sGroup needs HAVE_ST_GR_PASSWD check
	  [ruby-dev:25675]

Fri Feb 11 17:37:50 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_default_paths):
	  new method OpenSSL::X509::Store#set_default_paths.

Fri Feb 11 11:33:53 2005  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::HTTP#proxy_open): new option supported:
	  :http_basic_authentication.
	  suggested by Kent Sibilev.  [ruby-core:4392]

Fri Feb 11 06:30:07 2005  George Ogata  <g_ogata@optushome.com.au>

	* misc/ruby-mode.el: ignore parenthesis inside heredoc.
	  [ruby-core:04415]

Fri Feb 11 04:54:13 2005  Tilman Sauerbeck  <tilman@code-monkey.de>

	* lib/rdoc/generators/html_generator.rb: [ruby-core:04412]

	* lib/rdoc/generators/ri_generator.rb: ditto.

Thu Feb 10 13:52:42 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (LIBS, COMMON_HEADERS): use
	  winsock2 on mswin32/mingw.

	* ext/socket/extconf.rb: ditto.

	* win32/win32.c (StartSockets): ditto.

	* win32/win32.h: ditto.

Thu Feb 10 12:09:16 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): default to true if not compiled
	  previously.

	* ext/extmk.rb (extmake): create dummy makefile if extconf failed.

Thu Feb 10 12:07:10 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (init_stdhandle): assign standard file handles.

	* bcc32/Makefile.sub (COMMON_LIBS): add libraries included in
	  import32.lib.

	* lib/mkmf.rb (create_makefile): restrict prefixing with srcdir to
	  rule lines, add search path to implicit rules, and set Borland make
	  special macros for search path.

	* win32/win32.c, win32/win32.h (read): avoid a BCC runtime bug.

Thu Feb 10 00:47:25 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (make_struct): fixed: [ruby-core:04402]

Wed Feb  9 16:33:05 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (wait_connectable): fixed wrong condition.

Wed Feb  9 14:42:28 2005  URABE Shyouhei  <shyouhei@ice.uec.ac.jp>

	* eval.c (scope_dup): add volatile not to optimize tbl.

Wed Feb  9 10:02:02 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/tk/make-tkutil, ext/tk/tkutil/subconf.rb: no longer used.

	* ext/tk/tkutil/extconf.rb: need to compile tkutil. [ruby-dev:25607]

Wed Feb  9 08:07:08 2005  Paul Duncan  <pabs@pablotron.org>

	* ext/curses/curses.c (window_color_set): [ruby-core:04393]

Tue Feb  8 23:48:36 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: reject :instance_eval, :class_eval, :module_eval
	  [druby-ja:117]

Tue Feb  8 22:38:28 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* keywords, parse.y: separate EXPR_VALUE from EXPR_BEG.
	  fixed: [ruby-core:04310], [ruby-core:04368]

Tue Feb  8 13:06:12 2005  Sam Roberts  <sroberts@uniserve.com>

	* ext/socket/socket.c (Init_socket): SO_REUSEPORT added.
	  [ruby-talk:130092]

Tue Feb  8 00:19:02 2005  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb (Resolv::DNS::Name#subdomain_of?): new method.
	  (Resolv::DNS::Name#inspect): ditto.
	  Suggested by Sam Roberts.  [ruby-talk:129086]

Mon Feb  7 23:14:11 2005  Tanaka Akira  <akr@m17n.org>

	* io.c (io_getc): flush rb_stdout before read from stdin, which is
	  connected to a tty.  [ruby-core:4378]

	* rubyio.h (FMODE_TTY): renamed from FMODE_LINEBUF.

Mon Feb  7 10:06:30 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c: [ruby-doc:818]

Mon Feb  7 02:13:05 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb (sockaddr_storage): winsock2.h have the
	  definition of struct sockaddr_storage, but socket.c doesn't
	  include it because this version of ruby still has binary level
	  compatibility with winsock1.

Mon Feb  7 01:22:50 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): extract previously collected
	  informations from existing Makefile.

	* ext/socket/extconf.rb: check if getaddrinfo() works fine only when
	  wide-getaddrinfo option is not given.  fixed: [ruby-dev:25422]

	* ext/tk/extconf.rb: separate tkutil configuration.

	* lib/mkmf.rb ($extmk): check if under ext directory.

	* lib/mkmf.rb (Logging.postpone): allow recursive operation.

	* lib/mkmf.rb (try_constant): make sure if really a constant, reduce
	  the number of times of compile.

	* lib/mkmf.rb (have_macro, have_var, byte_order): new functions.

	* lib/mkmf.rb (find_library): allow directory list with separators.

	* lib/mkmf.rb (arg_config): manage provided configuration options.

	* lib/mkmf.rb (dir_config): accept arrays of directory names as
	  default values.

	* lib/mkmf.rb (with_cppflags, with_cflags, with_ldflags): keep flags
	  modified if the block returned true.

Sun Feb  6 19:20:05 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (stack_extend): add prototype because VC++8 doesn't
	  accept __declspec(noinline) with K&R style function definitions.

Sun Feb  6 13:56:19 2005  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (new_with_hash): changed messages of exception.

	* lib/date/format.rb (str[fp]time): undocumented conversion
	  specifications %[1-3] are now deprecated.

Sun Feb  6 11:27:37 2005  Tanaka Akira  <akr@m17n.org>

	* ext/dl/dl.c (Init_dl): function declaration should precede
	  statements before C99.

Sun Feb  6 03:24:20 2005  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb (Resolv::DNS::Resource::TXT): multiple strings was not
	  handled.
	  (Resolv::DNS::Resource::TXT#strings): new method to return all
	  strings.
	  (Resolv::DNS::Message::MessageEncoder#put_string_list): new method.
	  (Resolv::DNS::Message::MessageDecoder#get_string_list): ditto.
	  based on [ruby-talk:129732] by Sam Roberts.

Sat Feb  5 02:24:06 2005  Minero Aoki  <aamine@loveruby.net>

	* test/ripper/test_scanner_events.rb: fix test.

Fri Feb  4 18:44:35 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/lib/ripper/lexer.rb: last Lexer fix was incomplete;
	  test all green.

Fri Feb  4 15:57:06 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (open_args): fix too verbose warnings for the space
	  before argument parentheses.  [ruby-dev:25492]

	* parse.y (parser_yylex): ditto.

Fri Feb  4 14:33:25 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/lib/ripper/filter.rb: ripper/tokenizer ->
	  ripper/lexer. [ruby-dev:25632]

Fri Feb  4 00:24:15 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss: supported Image module.
	  http://web.resource.org/rss/1.0/modules/image/

Thu Feb  3 23:42:36 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_close, strio_close_read, strio_close_write):
	  should return nil instead of self as well as IO.  [ruby-dev:25623]

	* ext/stringio/stringio.c (strio_extend, strio_putc): fill with zero
	  extended portion.  [ruby-dev:25626]

Thu Feb  3 16:12:57 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (parser_yylex): the first expression in the parentheses
	  should not be a command.  [ruby-dev:25492]

Thu Feb  3 03:31:20 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: follow original v 1.57

	* ext/nkf/nkf-utf8/utf8tbl.c: follow original v 1.8

	* ext/nkf/nkf-utf8/config.h: follow original v 1.7

Wed Feb  2 23:52:53 2005  sheepman  <sheepman@tcn.zaq.ne.jp>

	* ext/stringio/stringio.c (strio_truncate): should MEMZERO an extended
	  part.  [ruby-dev:25618]

Wed Feb  2 21:56:01 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::Element#convert): added.

	* lib/rss/rss.rb: convert -> need_convert.

	* lib/rss/1.0.rb: ditto.

	* lib/rss/0.9.rb: ditto.

	* lib/rss/2.0.rb: ditto.

	* lib/rss/trackback.rb: ditto.

Wed Feb  2 03:30:58 2005  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/lib/ripper/tokenizer.rb -> lexer.rb.

	* ext/ripper/lib/ripper/lexer.rb: new method Ripper.slice.
	  [experimental]

	* ext/ripper/lib/ripper/sexp.rb: new file. [experimental]

	* ext/ripper/lib/ripper.rb: require ripper/lexer and ripper/sexp.

Tue Feb  1 21:49:24 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (DRb::DRbObject#respond_to?): check marshal_dump and
	  _dump.

Tue Feb  1 00:20:23 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, configure.in: made EXTOUT configurable.

	* ext/extmk.rb (extmake), lib/mkmf.rb: keep topdir as relative style.

	* lib/mkmf.rb: make extensions in depth order.  [ruby-dev:25522]

	* configure.in (aix): fix linker flags on AIX.  [ruby-talk:125460]

Mon Jan 31 13:16:39 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: add tkutil configuration step (remove old schema)

	* ext/tk/depend: remove the information of tkutil

	* ext/tk/make-tkutil: sub-part of Makefile to compile tkutil

	* ext/tk/tkutil/tkutil.c: move tkutil.c to subdirectory

	* ext/tk/tkutil/subconf.rb: configuration file for tkutil.c

	* ext/tk/tkutil/depend: ditto

Mon Jan 31 13:13:35 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: add invalid namespace check

	* ext/tk/lib/multi-tk.rb: add invalid_namespace? method

	* ext/tk/lib/remote-tk.rb: ditto

Mon Jan 31 10:29:18 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/context.rb (IRB::Context::initialize): [ruby-core:04330]

Mon Jan 31 09:44:03 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (Init_Object): remove Object#type.  [ruby-core:04335]

Sat Jan 29 09:42:12 2005  Sam Roberts  <sroberts@uniserve.com>

	* lib/resolv.rb (Resolv::DNS::Resource::IN::SRV): Added RFC2782 SRV
	  resource record for specifying location of services.

Sat Jan 29 00:10:33 2005  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* ascii.c, euc_jp.c, hash.c, oniggnu.h, oniguruma.h, regcomp.c,
	  regenc.c, regenc.h, regerror.c, regexec.c, reggnu.c, regint.h,
	  regparse.c, regparse.h, sjis.c, st.c, st.h, utf8.c: imported
	  Oni Guruma 3.5.4.

Fri Jan 28 17:16:55 2005  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb (Resolv::DNS::Config.parse_resolv_conf):
	  parse options line for ndots option.
	  (Resolv::Hosts#lazy_initialize): return self.
	  (Resolv::DNS#lazy_initialize): ditto.
	  (Resolv::DNS::Config#lazy_initialize): ditto.
	  Suggested by Sam Roberts.

Thu Jan 27 17:15:03 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/tk/extconf.rb: support new tk scheme on bccwin32.
	  fixed: [ruby-dev:25546]

Thu Jan 27 13:18:03 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* st.c (st_foreach): report success/failure by return value.
	  [ruby-Bugs-1396]

Thu Jan 27 00:12:19 2005  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb (setup): support BSD style
	  directory group inheritance (again).

Thu Jan 27 00:02:40 2005  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb (setup): support BSD style
	  directory group inheritance. [ruby-dev:25440]

	* test/fileutils/fileasserts.rb (assert_same_entry): show entry
	  difference.

Wed Jan 26 17:12:50 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: forgot to initialize parser struct.  [ruby-dev:25492]

	* parse.y (parser_yylex): no tLABEL on EXPR_BEG.
	  [ruby-talk:127711]

Wed Jan 26 14:12:58 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/Setup*: remove tcltklib.

Wed Jan 26 12:45:16 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/tk/extconf.rb: support new tk scheme on mswin32.
	 fixed: [ruby-dev:25535]

Wed Jan 26 10:45:19 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (flock_winnt, flock_win95): unlock file even if
	  LOCK_NB is specified.

Tue Jan 25 23:10:48 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk: merge tcltklib for Ruby/Tk installation control

	* ext/tcltklib: remove

Tue Jan 25 17:05:15 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (proc_options): correct -T option in RUBYOPT.
	  fixed: [ruby-dev:25512]

Tue Jan 25 14:05:52 2005  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: fix SEGV bug; trouble on canceling remained
	  after scripts [ruby-dev:25479]: NULL current namespace when deleting
	    Tk interpreter [ruby-talk:126225]

	* ext/tcltklib/extconf.rb: bug fix; TCL_ENABLE_THREAD flag is inverted
	  [ruby-talk:126360]

	* ext/tcltklib/extconf.rb: add yet another native-thread check

	* ext/tk/tkutil.c: fix SEGV bug; NULL string pointer when finalize
	  Ruby interpreter

	* ext/tk/lib/multi-tk.rb: avoid warning for deleted safeTk ip frame

	* ext/tk/lib/tk/bindtag.rb: bug fix; new method of named bindtag
	  doesn't return the created object [ruby-dev:25479]

	* ext/tk/lib/tk/menu.rb: bug on treating arguments [ruby-dev:25479]

	* ext/tk/lib/tk.rb: bug fix; cannot accept a callback ID string for
	  a command argument [ruby-dev:25479]

	* ext/tk/lib/multi-tk.rb: ditto

	* ext/tk/lib/tk/*.rb: ditto

	* ext/tk/lib/tkextlib/*.rb: ditto

	* ext/tk/sample/demos-jp/anilabel.rb: new demo script

	* ext/tk/sample/demos-en/anilabel.rb: ditto

	* ext/tk/sample/tkHTML/ss.rb: local variable scope bug fix
	  [ruby-dev:25479]

Mon Jan 24 16:00:53 2005  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (guess_old): not use NKF.guess_old
	  but NKF.guess1. fixed: [ruby-dev:25491]

Mon Jan 24 15:44:25 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* document updates - [ruby-core:04296], [ruby-core:04301],
	  [ruby-core:04302], [ruby-core:04307]

Sun Jan 23 12:38:01 2005  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/wsdlDriver.rb: from 1.5.3-ruby1.8.2, operation which has
	  capitalized name (such as KeywordSearchRequest in AWS) is defined as
	  a method having uncapitalized name. (converted with
	  GenSupport.safemethodname to handle operation name 'foo-bar').  it
	  introduced serious incompatibility; in the past, it was defined as a
	  capitalized.

	  define capitalized method as well under that circumstance.

Sun Jan 23 05:24:42 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ocsp.c (ossl_ocspreq_to_der): should call
	  GetOCSPReq at first.

Sat Jan 22 22:59:08 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/ssl.rb (accept): rescue SSLError. [druby-ja:110]

Sat Jan 22 22:27:28 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/unix.rb: fail if UNIXFileOwner is set. [druby-ja:111]

Fri Jan 21 20:07:02 2005  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb (Resolv::DNS::Config.resolv): don't raise ResolvError.
	  reported by Sam Roberts.  [ruby-talk:127133]

Fri Jan 21 17:09:44 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (decode_utf7): use pack("U*") to encode UTF-8.

	* lib/net/imap.rb (encode_utf7): use unpack("U*") to decode UTF-8.

	* test/net/imap/test_imap.rb: added tests for Net::IMAP.

Fri Jan 21 16:58:10 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (rb_push_glob): should work for NUL delimited patterns.

	* dir.c (rb_glob2): should aware of offset in the pattern.

Fri Jan 21 13:58:37 2005  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (u8tou16): fixed typo. fixed: [ruby-list:40546]

Fri Jan 21 00:37:09 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/syck/rubyext.c (syck_parser_bufsize_set): avoid VC++ warning
	  "local variable 'size' used without having been initialized".

Thu Jan 20 11:42:02 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_new4): should propagate taintedness.

	* env.h: rename member names in struct FRAME; last_func -> callee,
	  orig_func -> this_func, last_class -> this_class.

	* struct.c (rb_struct_set): use original method name, not callee
	  name, to retrieve member slot.  [ruby-core:04268]

	* time.c (time_strftime): protect from format modification from GC
	  finalizers.

Thu Jan 20 02:01:10 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (Init_Object): remove rb_obj_id_obsolete()

Wed Jan 19 18:02:19 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/ipaddr.rb (to_s, test_to_s): too many colons with some cases.

Wed Jan 19 01:16:30 2005  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb (Resolv::DNS::Config.parse_resolv_conf): ignore
	  domain and search directive without an argument.
	  reported by Sam Roberts.  [ruby-talk:126781]

Mon Jan 17 23:33:46 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (aix): fix typo.  [ruby-talk:126401]

Mon Jan 17 07:08:51 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c: suppress warnings.

	* lib/irb/extend-command.rb (IRB::ContextExtender.def_extend_command):
	  ditto.

	* lib/irb/ext/history.rb (IRB::Context::set_last_value): ditto.

	* lib/irb/ext/history.rb (IRB::Context::eval_history): ditto.

	* lib/irb/locale.rb (IRB::Locale::real_load): ditto.

	* lib/irb/slex.rb (SLex::Node::create_subnode): remove garbage.

Mon Jan 17 00:09:42 2005  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/uri/common.rb (PORT): typo fix. fixed: [ruby-core:04256]

Sat Jan 15 14:57:22 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): ignore trailing CRs at the end of short
	  options as well as long options.  fixed: [ruby-core:04232]

Sat Jan 15 13:44:22 2005  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::VERSION): 0.1.2 -> 0.1.3.

	* lib/rss/rss.rb: accept inheritance. [ruby-talk:126104]

Wed Jan 12 12:29:28 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_mod_define_method): incomplete subclass check.
	  [ruby-dev:25464]

	* class.c (rb_make_metaclass): class of metaclasses should be
	  plain Class.  [ruby-list:40524]

Tue Jan 11 20:58:52 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (remain_size): use buffered data instead of unreading to avoid
	  inconsistency of text mode.  fixed: [ruby-dev:25446]

Tue Jan 11 09:37:53 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* numeric.c (Init_Numeric): turn off floating point exceptions
	  on bcc32. "1e300".to_f had crashed by overflow.

Mon Jan 10 15:28:51 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI::Socket#request_line): should
	  escape SCRIPT_NAME and PATH_INFO before being parsed as a URI.

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils#escape_path): add
	  new method to escape URI path component.

	* lib/webrick/ssl.rb (WEBrick::Config::SSL): the default value
	  of :SSLEnable is false.

	* test/webrick/{test_cgi.rb,webrick.cgi}: new file.

	* test/webrick/utils.rb: require "webrick/https.h".

Mon Jan 10 01:22:55 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (rb_data_object_alloc): klass may be NULL.
	  [ruby-list:40498]

Sun Jan  9 14:12:17 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_f_select): IO list could be altered.  [ruby-dev:25312]

Sun Jan  9 04:08:40 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* test/webrick/test_server.rb (test_daemon): delete an assertion
	  which has possibility to fail by race condition.

Sun Jan  9 03:22:46 2005  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb (test_copy_entry): copy_entry
	  copies only file type, not mtime. [ruby-dev:25383]

Sat Jan  8 04:38:47 2005  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml.rb: Kernel#y requires an argument.

Fri Jan  7 21:12:29 2005  TAMURA Takashi  <sheepman@tcn.zaq.ne.jp>

	* random.c (rand_init): use ALLOC_N instead of ALLOCA_N
	  [ruby-dev:25426]

Fri Jan  7 20:01:31 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpproxy.rb (WEBrick::HTTPProxyServer#proxy_service):
	  should delete trailing LF from the result of pack("m*").

	* lib/webrick/httpproxy.rb (WEBrick::HTTPProxyServer#proxy_connect):
	  - should delete trailing LF from the result of pack("m*").
	  - clear Request-Line not to send the response by HTTPServer#run.

	* lib/webrick/httputils (WEBrick::HTTPUtils.parse_qvalues):
	  refine regexp (and change the name of a local variable).

	* lib/webrick/server.rb (WEBrick::Daemon.start): prepared stdio
	  don't allow changing its mode.

	* test/webrick/*, sample/webrick/httpproxy.rb: add new files.

Fri Jan  7 18:03:35 2005  Tanaka Akira  <akr@m17n.org>

	* gc.c (mark_locations_array): avoid core dump with -O3.
	  [ruby-dev:25424]

Thu Jan  6 20:29:18 2005  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (zstream_end): should return value.

Thu Jan  6 19:59:03 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.c (rb_w32_close): didn't close socket handle.
	  [ruby-dev:25414]

	* win32/win32.c (rb_w32_open_osfhandle): bcc32's _open_osfhandle
	  never set EMFILE.

Thu Jan  6 17:22:41 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* random.c (random_seed): O_NONBLOCK isn't defined on some
	  platforms. [ruby-dev:25417]

Thu Jan  6 13:45:35 2005  Tanaka Akira  <akr@m17n.org>

	* lib/time.rb: recognize +00:00 and GMT as a localtime.

Thu Jan  6 07:58:28 2005  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/usage.rb (RDoc::RDoc.usage_no_exit): Allow for colons
	  in path names on DOS machines. (thanks to Johan Nilsson)

Thu Jan  6 00:02:35 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb: use MockClock.sleep instead of Kernel.sleep
	  [ruby-dev:25387]

Wed Jan  5 20:16:32 2005  Tanaka Akira  <akr@m17n.org>

	* random.c (limited_big_rand): didn't work if SIZEOF_BDIGITS == 2.
	  [ruby-dev:25408]

	* random.c (random_seed): refined.

Wed Jan  5 16:39:54 2005  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* parse.y (BITSTACK_POP): workaround for bcc32 compiler's bug.
	  shift assignment operator '>>=' for __int64 in struct may
	  generate collapsed code. [ruby-dev:25342]

	* win32/win32.[ch]: failed to compile on bcc32 (and probably wince)
	  [ruby-dev:25306]

Wed Jan  5 12:49:39 2005  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_initialize): Thread objects cannot be initialized
	  again.  fixed: [ruby-core:04067]

Wed Jan  5 02:30:11 2005  Tanaka Akira  <akr@m17n.org>

	* random.c (init_by_array): imported from mt19937ar-cok.tgz.
	  (genrand_int32): ditto.
	  (genrand_real): replaced with genrand_res53 in mt19937ar-cok.
	  (rand_init): support bignum for longer seed.
	  (random_seed): generate longer seed.
	  (make_mask): new function.
	  (limited_rand): ditto.
	  (limited_big_rand): ditto.
	  (rb_f_rand): call limited_rand and limited_big_rand.
	  [ruby-dev:25403]

Tue Jan  4 23:25:29 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_rand): should return positive random number.
	  [ruby-dev:25401]

Tue Jan  4 21:25:43 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/{test_drbssl.rb,test_drbunix.rb,ut_drb.rb}: use
	  DRbService.ext_service. reduce sleep.

Mon Jan  3 14:01:54 2005  Tanaka Akira  <akr@m17n.org>

	* random.c (random_seed): don't use /dev/urandom if it is not
	  character device.

Mon Jan  3 11:37:42 2005  Tanaka Akira  <akr@m17n.org>

	* random.c (random_seed): use /dev/urandom if available.
	  [ruby-dev:25392]

Tue Jan  4 11:15:29 2005  TAMURA Takashi  <sheepman@tcn.zaq.ne.jp>

	* bignum.c (rb_big_rand): do not use rb_big_modulo to generate
	  random bignums.  [ruby-dev:25396]

Mon Jan  3 11:03:37 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/test_drb.rb: move TestDRbReusePort to new file.
	  [ruby-dev:25238]

	* test/drb/drbtest.rb: change timeout.

	* test/drb/ignore_test_drb.rb: new file.

Mon Jan  3 07:27:46 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpauth/htpasswd.rb (WEBrick::Htpasswd#reload):
	  raise NotImplementedError if password is encrypted by digest
	  algorithms. This patch is contributed by sheepman. [ruby-list:40467]

	* lib/webrick/httpauth/digestauth.rb
	  (WEBrick::HTTPAuth::DigestAuth#_authenticate): fix digest calculation.
	  This patch is contributed by sheepman. [ruby-list:40482]

	* lib/webrick/{httpauth.rb,httpauth/basicauth.rb,httpproxy.rb}: use
	  pack/unpack-template char "m" instead of lib/base64.rb to do base64
	  encoding/decoding. fixed: [ruby-dev:25336]

	* test/webrick/test_httpauth.rb: new file.

Sun Jan  2 15:42:10 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: add lazy stop_service.

	* lib/drb/extserv.rb: ditto.

Sun Jan  2 01:17:17 2005  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/drbtest.rb: add method DRbService.ext_service.

	* test/drb/test_drb.rb: ditto.

	* test/drb/test_drbssl.rb: ditto.

Sat Jan  1 20:23:02 2005  Tanaka Akira  <akr@m17n.org>

	* io.c (argf_readpartial): new method ARGF.readpartial.
	  (io_getpartial): extracted from io_readpartial.
	  (io_readpartial): call io_getpartial.

Sat Jan  1 17:44:54 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (each_capitalized): should join header field
	  value.  This patch is contributed sheepman [ruby-list:40478]

	* test/net/http/test_httpheader.rb: test it.

Sat Jan  1 16:21:29 2005  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (copy_stream): use read/write instead of
	  sysread/syswrite, which allows duck typing. [ruby-dev:25369]

	* lib/fileutils.rb (copy_stream): does NOT support nonblocking IO.
	  [ruby-dev:25370]

	* lib/fileutils.rb (copy_entry): could not copy symlink.

	* test/fileutils/test_fileutils.rb: test copy_entry, copy_file,
	  copy_stream.

Sat Jan  1 04:20:23 2005  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ns_spki.c (ossl_spki_set_challenge): should call
	  StringValue before GetSPKI. fixed: [ruby-dev:25359].

Sat Jan  1 01:13:28 2005  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_autoload): [ruby-dev:25373]

Fri Dec 31 14:10:43 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_formatter.rb (RI::TextFormatter::display_flow_item):
	  Fix problem if heading contains formatting.

Fri Dec 31 00:08:02 2004  Tanaka Akira  <akr@m17n.org>

	* configure.in (HAVE_RLIM_T): removed because not used.

Thu Dec 30 22:45:39 2004  Tanaka Akira  <akr@m17n.org>

	* rubyio.h: don't deprecate rb_read_check.

	* io.c (STDIO_READ_DATA_PENDING): reverted from old READ_DATA_PENDING
	  to check stdio read buffer.
	  (rb_read_check): use STDIO_READ_DATA_PENDING.
	  (rb_read_pending): ditto.
	  (rb_getc): ditto.

Thu Dec 30 05:39:35 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y: eliminate unused members in struct parser_params.
	  [ruby-dev:25258] (again)

	* parse.y: make parser_new() static.

Thu Dec 30 00:41:42 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (svalue_to_avalue): [ruby-dev:25366]

	* string.c (rb_str_justify): [ruby-dev:25367]

Wed Dec 29 11:07:07 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/template/html/kilmer.rb: Update to use new
	  sections.

Tue Dec 28 22:31:46 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_justify): create buffer string after argument type
	  conversion.  fixed: [ruby-dev:25341]

Tue Dec 28 17:18:17 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/net/telnet.rb (preprocess): remove NULL unless binmode.
	  fixed: [ruby-list:40320]

Tue Dec 28 15:41:48 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c (reinit): should initialize all static
	  variables.  fixed: [ruby-list:40445]

Tue Dec 28 15:25:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (Kconv::RegexpEucjp): second byte is up to
	  0xfe.

	* ext/nkf/lib/kconv.rb (Kconv#kconv): should handle UTF8 and UTF16
	  properly.

Tue Dec 28 13:35:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (rb_deflate_s_deflate, rb_inflate_s_inflate): ensure
	  freeing internal zstreams.  fixed: [ruby-dev:25309]

	* ext/zlib/zlib.c (rb_deflate_init_copy): replace rb_deflate_clone.

Mon Dec 27 20:02:14 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: fix SEGV bug when deleting Tk interp

	* ext/tk/lib/multi-tk.rb: ditto

Mon Dec 27 16:54:05 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509name.c (Init_ossl_x509name): should use
	  rb_hash_new to get exactly a Hash. fix [ruby-dev:25325].

Mon Dec 27 15:29:12 2004  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb (cp_r): tested wrong file name.
	  [ruby-dev:25339]

Mon Dec 27 15:15:18 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mv): should raise error when moving a
	  directory to the (empty) directory. [ruby-talk:124368]

	* lib/fileutils.rb (mv): wrongly did not overwrite file on Win32
	  platforms.

Mon Dec 27 14:36:20 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (NUM2RLIM, RLIM2NUM): Without SIZEOF_RLIM_T is not error.
	  fixed: [ruby-dev:25346]

Sun Dec 26 16:21:39 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (Net::IMAP::PlainAuthenticator): added a new class
	  to support the PLAIN authentication mechanism. Thanks, Benjamin
	  Stiglitz.

Sat Dec 25 01:28:23 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_select): [ruby-dev:25312]

Fri Dec 24 23:27:18 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/image.rb: TkPhotoImage#cget bug fix

Fri Dec 24 03:06:13 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_reopen, rb_io_reopen): prohibit to change access mode for
	  special IO ports.  [ruby-dev:25225]

	* io.c (next_argv): reduce use of stdio.

Fri Dec 24 02:22:53 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (syck_loader_transfer): check type conversion.

	* ext/syck/rubyext.c (syck_parser_assign_io, rb_new_syck_node): duck
	  typing.

	* ext/syck/rubyext.c (syck_parser_s_alloc, syck_parser_initialize):
	  allocation framework.

	* ext/syck/rubyext.c (syck_emitter_s_alloc, syck_emitter_initialize):
	  ditto.

Fri Dec 24 01:21:00 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkextlib/blt.rb: add BLT extension support

	* ext/tk/lib/tkextlib/blt/*.rb: ditto

	* ext/tk/lib/tkextlib/blt/tile/*.rb: ditto

Thu Dec 23 23:43:24 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_setgroups): check if the argument length is
	  modified.  fixed: [ruby-dev:25285]

	* process.c (SIZEOF_RLIM_T): err if size of rlim_t is not set.

Thu Dec 23 19:08:41 2004  Tanaka Akira  <akr@m17n.org>

	* rubyio.h: rename FMODE_UNSEEKABLE to FMODE_DUPLEX.

	* io.c (io_check_tty): extracted function to set FMODE_LINEBUF and
	  FMODE_DUPLEX.

Thu Dec 23 13:13:33 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: define TclTkLib::COMPILE_INFO and
	  RELEASE_DATE

	* ext/tcltklib/extconf.rb: ditto

	* ext/tk/tkutil.c: define TkUtil::RELEASE_DATE

	* ext/tk/lib/tk.rb: define Tk::RELEASE_DATE

Thu Dec 23 00:16:32 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (bsdi): use $(CC) for LDSHARED.  fixed [ruby-dev:25270]

Wed Dec 22 11:14:55 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_mode_modenum): replace O_ACCMODE with O_RDWR.
	  fixed: [ruby-dev:25273]

Wed Dec 22 08:34:32 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/sym.c (rb_dlsym_initialize): extract internal pointers after
	  all argument conversion.  fixed: [ruby-dev:25271]

Tue Dec 21 16:15:21 2004  Michael Neumann  <mneumann@ruby-lang.org>

	* lib/xmlrpc/client.rb: use "" instead of "." if prefix argument is
	  nil in proxy methods. nil is default value.

	* test/xmlrpc/test_webrick_server.rb, test/xmlrpc/webrick_testing.rb:
	  use threads instead of forking. this should fix issue #1208
	  (http://rubyforge.org/tracker/?func=detail&atid=1698&aid=1208&group_id=426).
	  removed testing of SSL enabled servlet as this hangs.

Wed Dec 22 00:05:10 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/*, test/soap/*, sample/soap/authheader/*: eval cleanup.

Tue Dec 21 22:07:41 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode_all): use rb_str_new4
	  to avoid SEGV.

	* ext/openssl/ossl_asn1.c (ossl_asn1_traverse, ossl_asn1_decode,
	  ossl_asn1_decode_all): temporary value should be marked volatile.

Tue Dec 21 12:42:34 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_traverse, ossl_asn1_decode):
	  use rb_str_new4 to avoid SEGV. fix [ruby-dev:25261]

	* test/openssl/test_asn1.rb: add tests for OpenSSL::ASN1.

Tue Dec 21 12:10:04 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/grid.rb: rescue bug of 'grid configure' on Tcl/Tk8.3-

Mon Dec 20 22:52:29 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* added samples for the previous soap4r's commit.

Mon Dec 20 22:56:39 2004  Tanaka Akira  <akr@m17n.org>

	* gc.c (set_stack_end): gcc noinline attribute is available since
	  gcc-3.1.

Mon Dec 20 22:40:31 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* added files:
	  * lib/soap/mapping/wsdl*.rb
	  * lib/wsdl/soap/element.rb
	  * lib/wsdl/xmlSchema/simpleContent.rb

	* modified files:
	  * lib/soap/*
	  * lib/wsdl/*
	  * lib/xsd/*
	  * test/soap/*
	  * test/wsdl/*
	  * test/xsd/*

	* summary
	  * imported from the soap4r repository.  Version: 1.5.3-ruby1.8.2

	  * added several XSD basetype support: nonPositiveInteger,
	    negativeInteger, nonNegativeInteger, unsignedLong, unsignedInt,
	    unsignedShort, unsignedByte, positiveInteger

	  * HTTP client connection/send/receive timeout support.

	  * HTTP client/server gzipped content encoding support.

	  * improved WSDL schema definition support; still is far from
	    complete, but is making step by step improvement.

Mon Dec 20 14:45:19 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/net/https.rb: delete descriptions about key_file and cert_file.
	  fixed: [ruby-dev:25243]

	* ext/openssl/lib/net/telnets.rb: ditto.

Mon Dec 20 14:07:02 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: supports new features of Tcl/Tk8.5a2

	* ext/tk/lib/tk/clock.rb: ditto

	* ext/tk/lib/tk/text.rb: ditto

	* ext/tk/lib/tk/panedwindow.rb: ditto

Mon Dec 20 13:51:40 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_s_getservbyport): [ruby-talk:124072]

Mon Dec 20 10:51:58 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (special_local_set): prevent the parser object from GC.
	  fixed: [ruby-dev:25252]

Mon Dec 20 03:30:40 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session#initialize): empty session id was
	  used if request had no session key.  fixed: [ruby-core:03981]

Mon Dec 20 01:51:01 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (make_struct): [ruby-dev:25249]

Mon Dec 20 00:16:54 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/encodings/SHIFT_JIS.rb: fixed LoadError bug.
	  [ruby-core:3958]

Sun Dec 19 17:24:59 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (enable_rpath): use rpath flag to embed the library
	  path into extensions on ELF environment.  [ruby-dev:25035]

Sun Dec 19 11:01:25 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb: use standalone runner for -e.

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner#options): accept
	  multiple -p and -x options.

	* lib/test/unit/collector/dir.rb (Test::Unit::Collector::Dir#recursive_collect):
	  ditto.

Sat Dec 18 16:36:23 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (rb_deflate_s_deflate, rb_inflate_s_inflate):
	  disallow interrupt by type conversion.  fixed: [ruby-dev:25226]

Sat Dec 18 15:09:02 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/httpauth.rb,
	  lib/webrick/httpauth/{basicauth.rb,digestauth.rb}: use
	  pack/unpack-template char "m" instead of lib/base64.rb to do base64
	  encoding/decoding.

Sat Dec 18 10:51:01 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_open_dir): new function.  [ruby-dev:25242]

	* io.c (rb_f_open): add type check for return value from to_open.

Fri Dec 17 16:44:26 2004  Tanaka Akira  <akr@m17n.org>

	* configure.in (ac_cv_sizeof_rlim_t): set 8 for BSD/OS.
	  Reported by OHARA Shigeki.  [ruby-dev:25236]

Fri Dec 17 16:28:12 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fix bug on setting up system encoding

	* ext/tk/lib/tk/event.rb: fix error on require process

	* ext/tk/lib/tk/font.rb: fix abnormal termination error on Windows

	* ext/tk/lib/tk/virtevent.rb: TkVirtualEvent::PreDefVirtEvent.new()
	  accepts event-sequence arguments

	* ext/tk/lib/tk/text.rb: fail to dump embedded images

	* ext/tk/lib/tk/text.rb: tag_nextrange and tag_prevrange returns wrong
	  types of values

	* ext/tk/lib/tk/texttag.rb: nextrange and prevrange returns wrong
	  types of values

	* ext/tk/lib/tk/text.rb: add TkText::IndexModMethods module and
	  TkText::IndexString class to treat text index modifiers

	* ext/tk/lib/tk/texttag.rb: use TkText::IndexModMethods module

	* ext/tk/lib/tk/textmark.rb: ditto

	* ext/tk/lib/tk/textimage.rb: ditto

	* ext/tk/lib/tk/textwindow.rb: ditto

	* ext/tk/lib/tk/textimage.rb: wrong gravity of text mark for embedded
	  image

	* ext/tk/lib/tk/textwindow.rb: wrong gravity of text mark for
	  embedded window

Fri Dec 17 13:33:58 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session#initialize): control adding
	  session_id hidden fields.  fixed: [ruby-talk:123850]

Fri Dec 17 00:01:48 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_proc_arity, rb_node_arity, rb_mod_method_arity,
	  rb_obj_method_arity): new functions to obtain method arity.
	  [ruby-dev:25143]

Thu Dec 16 23:31:13 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): create RUBYARCHDIR also when no extension
	  is installed.  fixed: [ruby-dev:25215]

Thu Dec 16 22:36:57 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/test_drb.rb: adjust and reduce sleep.

Thu Dec 16 18:37:08 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.c (ossl_raise): refine message format.

Thu Dec 16 16:29:44 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/demos-en/widget: modify version check for
	  supporting features

Thu Dec 16 16:03:50 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/bindtag.rb: bug fix [ruby-talk: 123667]

	* ext/tk/lib/tk/timer.rb: accept :idle for the interval argument

	* ext/tk/lib/tk.rb: add TkComm._callback_entry?()

	* ext/tk/lib/multi-tk.rb: add MultiTkIp.cb_entry_class

	* ext/tk/lib/tk/canvas.rb: use TkComm._callback_entry?()

	* ext/tk/lib/tk/canvastag.rb: ditto

	* ext/tk/lib/tk/dialog.rb: ditto

	* ext/tk/lib/tk/optiondb.rb: ditto

	* ext/tk/lib/tk/text.rb: ditto

	* ext/tk/lib/tk/texttag.rb: ditto

	* ext/tk/lib/tk/textwindow.rb: ditto

	* ext/tk/lib/tk/timer.rb: ditto

	* ext/tk/lib/tk/validation.rb: ditto

	* ext/tk/lib/tkextlib/*: ditto

Thu Dec 16 04:02:28 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/extconf.rb: bison is not needed if ripper.c exists.
	  [ruby-dev:25191]

Thu Dec 16 03:27:10 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: remove junk.

Thu Dec 16 00:57:30 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/syck/rubyext.c (rb_syck_io_str_read): [ruby-core:03973]

Thu Dec 16 00:43:29 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: changed default binded address family to use an
	  available address family of host name. [druby-ja:101]

	* lib/drb/ssl.rb: ditto

Wed Dec 15 17:47:17 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/server.rb (WEBrick::GenericServer#start_thread):
	  should log about all accepted socket. [ruby-core:03962]

	* lib/webrick/accesslog.rb (WEBrick::AccessLog#setup_params):
	  "%%" and "%u" are supported. [webricken:135]

	* lib/webrick/httpservlet/filehandler.rb
	  (WEBrick::HTTPServlet::FileHandler#check_filename):
	  :NondisclosureName is acceptable if it is Enumerable.

	* lib/webrick/config.rb (WEBrick::Config::FileHandler):
	  default value of :NondisclosureName is [".ht*", "*~"].

Wed Dec 15 16:10:23 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_obj_id_obsolete): warn always.

Wed Dec 15 15:31:02 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/set.rb (Set#==): [ruby-dev:25206]

Wed Dec 15 14:32:18 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_fdisset): check whether the handle is valid.

Wed Dec 15 10:30:37 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/openssl/ossl_digest.c (ossl_digest_initialize): [ruby-dev:25198]

Tue Dec 14 19:17:15 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* utf8.c (utf8_is_mbc_ambiguous): [ruby-talk:123561]

	* utf8.c (utf8_mbc_to_normalize): ditto.

Tue Dec 14 17:08:15 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_close): need to reset osfhnd().

Tue Dec 14 14:03:57 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.c (ossl_raise): avoid buffer overrun.
	  [ruby-dev:25187]

Tue Dec 14 12:36:04 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session::initialize): generate new
	  session if given session_id does not exist.  [ruby-list:40368]

Tue Dec 14 08:47:45 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_eval): should mark ruby_eval_tree.  [ruby-dev:25189]

Mon Dec 13 18:13:52 2004  Tanaka Akira  <akr@m17n.org>

	* gc.c (set_stack_end): new function to obtain stack end address.
	  set_stack_end obtains a stack end address by an address of local
	  variable in the function.
	  (SET_STACK_END, STACK_END): use set_stack_end.  don't use alloca.
	  This makes the conservative garbage collector to scan a stack frame
	  of the garbage_collect function itself.  This is required because
	  callee-save registers may be stored in the frame.
	  [ruby-dev:25158]

Mon Dec 13 02:45:51 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/curses/curses.c (window_subwin): call NUM2INT() before
	  GetWINDOW(). fixed: [ruby-dev:25161]

Mon Dec 13 00:58:02 2004  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (cleanpath_aggressive): make it private.
	  (cleanpath_conservative): ditto.
	  Suggested by Daniel Berger.  [ruby-core:3914]

Sun Dec 12 21:32:14 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_super.rb (TestSuper#test_define_method): now methods
	  from procs can call super.

Sun Dec 12 10:35:10 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/template/html/html.rb (RDoc::Page): Don't
	  show an accessor's r/w flag if none was specified

Sun Dec 12 10:14:03 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/rdoc.rb (RDoc::RDoc::parse_files): Never exclude files
	  explicitly given on the command line.

Sat Dec 11 21:10:16 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: add DRbRemoteError. [ruby-list:40348],
	  [ruby-list:40390]

	* test/drb/drbtest.rb: ditto.

	* test/drb/ut_drb.rb: ditto.

Sat Dec 11 13:08:28 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sample/optparse/subcommand.rb: a sample for sub commands like
	  cvs.  contributed by Minero Aoki.

Fri Dec 10 08:39:48 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (sock_listen): get OpenFile just before calling
	  listen(2).

Thu Dec  9 16:28:35 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/sdbm/init.c (GetDBM): typo.

Thu Dec  9 16:21:51 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI#setup_header): avoid
	  SecurityError. [ruby-dev:24970]

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#run): should wait
	  for reading request till data arrive. [ruby-talk:121068]

Thu Dec  9 14:38:35 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): escape # which starts an expression
	  substitution.  fixed: [ruby-core:03922]

	* string.c (rb_str_dump): not escape # which isn't a substitution.

Thu Dec  9 12:31:53 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* io.c (pipe_open): should set prog if argc != 0.

Thu Dec  9 10:54:36 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/dbm/dbm.c (fdbm_select): [ruby-dev:25132]

	* ext/sdbm/init.c: ditto.

	* ext/gdbm/gdbm.c: ditto.

Thu Dec  9 10:19:18 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/socket/test_socket.rb (test_setsockopt): use SO_LINGER instead
	  of SO_BINDTODEVICE.  fixed: [ruby-dev:25133]

Thu Dec  9 03:08:36 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (ip_init): set root-win title to "ruby" when
	  the running script is '-e one-liner' or '-' (stdin).

	* ext/tcltklib/extconf.rb: add find_library("#{lib}#{ver}",..) for
	  stub libs

	* ext/tk/lib/tk/textmark.rb: TkTextMarkCurrent and TkTextMarkAnchor
	  have a wrong parent class.

	* ext/tk/lib/tk/dialog.rb: rename TkDialog2 --> TkDialogObj and
	  TkWarning2 --> TkWarningObj (old names are changed to alias names)

	* ext/tk/lib/tk/dialog.rb: bug fix of treatment of 'prev_command'
	  option and hashes for configuration

	* ext/tk/lib/tk/dialog.rb: add TkDialogObj#name to return the
	  button name

	* ext/tk/lib/tk/radiobutton.rb: rename enbugged method value() ==>
	  get_value() and value=(val) ==> set_value(val).

	* ext/tk/lib/tk/menu.rb: add TkMenu.new_menuspec

	* ext/tk/lib/tk/menu.rb: add alias (TkMenuButton = TkMenubutton,
	  TkOptionMenuButton = TkOptionMenubutton)

	* ext/tk/lib/tk/event.rb: new method aliases (same as option keys of
	  event_generate) for Event object

	* ext/tk/lib/tk/font.rb: configinfo returns proper types of values

	* ext/tk/lib/tk.rb: bind methods accept subst_args + block

	* ext/tk/lib/tk/canvas.rb: ditto

	* ext/tk/lib/tk/canvastag.rb: ditto

	* ext/tk/lib/tk/frame.rb: ditto

	* ext/tk/lib/tk/text.rb: ditto

	* ext/tk/lib/tk/texttag.rb: ditto

	* ext/tk/lib/tk/toplevel.rb: ditto

	* ext/tk/lib/tkextlib/*: ditto and bug fix

Wed Dec  8 23:54:29 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/template/html/html.rb (RDoc::Page): Typo
	  meant that h2 tag was invisible.

Wed Dec  8 22:10:02 2004  Tanaka Akira  <akr@m17n.org>

	* rubyio.h, io.c, ext/dl/dl.c, ext/pty/pty.c, ext/socket/socket.c:
	  create FILE object only when required: popen(3) and DL's IO#to_ptr.
	  [ruby-dev:25122]

	* io.c (rb_io_binmode): use setmode for Human68k.  [ruby-dev:25121]

Wed Dec  8 20:13:06 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* process.c (rb_spawn): support for DJGPP.

	* lib/mkmf.rb (VPATH): specify the implicit path separator for DJGPP.

Wed Dec  8 17:48:22 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): merge Guy Decoux's argument preserve
	  patch in [ruby-core:03874].

Wed Dec  8 17:37:33 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_pipe_exec): need to close original socket
	  handle.

Wed Dec  8 14:31:36 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): [ruby-dev:25104]

Wed Dec  8 13:49:46 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_pipe_exec): must close original handle
	  before exec. fixed: [ruby-dev:25112]

Wed Dec  8 11:46:26 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (string_content): get rid of segfault at empty evstr.
	  fixed: [ruby-dev:25113]

Wed Dec  8 03:26:51 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_bio.c (ossl_obj2bio): should not use fptr->f.
	  [ruby-dev:25101]

Wed Dec  8 03:26:41 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* runruby.rb: prepend LIBRUBY_SO to LD_PRELOAD as well as rubytest.rb.

Wed Dec  8 01:35:44 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (is_socket): reorder of function definitions.

Wed Dec  8 00:44:31 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (pipe_open): win32 bidirectional pipe support.

	* win32/win32.[ch] (rb_w32_pipe_exec): ditto.

	* win32/win32.[ch] (socketpair): new function. POSIX socketpair
	  emulation.

	* win32/win32.c (socketpair_internal): ditto.

Wed Dec  8 00:25:07 2004  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_version.rb: added version check test.
	  [ruby-dev:25053]

Tue Dec  7 15:40:38 2004  Tanaka Akira  <akr@m17n.org>

	* io.c (io_fwrite): avoid context switch before writing to stderr.
	  [ruby-dev:25080]

	* rubyio.h: refine deprecated declaration.

	* configure.in, file.c, io.c: remove useless check: fseeko, etc.

Tue Dec  7 13:42:07 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* dir.c (dir_s_mkdir): win32 special processing doesn't need any
	  longer.

	* win32/win32.[ch] (rb_w32_mkdir): new function. POSIX.1 compatible
	  interface.

	* win32/win32.[ch] (rb_w32_rmdir): new function.

Tue Dec  7 00:27:37 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (proc_setgroups): [ruby-dev:25081]

Mon Dec  6 23:07:57 2004  Tanaka Akira  <akr@m17n.org>

	* configure.in: check -lsocket for socketpair and shutdown.
	  reported by Ville Mattila.  [ruby-core:03903]

Mon Dec  6 23:00:45 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (ac_cv_sizeof_rlim_t): setup for DJGPP.

	* io.c (is_socket, shutdown): define dummy macros for DJGPP.

	* process.c: use SIZEOF_RLIM_T instead of HAVE_RLIM_T for DJGPP.

Mon Dec  6 21:19:40 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (is_socket): fix typos. [ruby-core:03900]

Mon Dec  6 20:13:28 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (is_socket): new function.

	* io.c (rb_io_close_read, rb_io_close_write): use is_socket().

	* io.c (rb_io_fptr_finalize): need to check fptr->f before calling
	  rb_io_fptr_cleanup().

	* io.c (pipe_open): win32 pipe support (experimental).

	* win32/win32.[ch] (rb_w32_pipe_exec): return file descriptors
	  instead of FILE structure objects.

	* win32/win32.[ch] (rb_w32_is_socket): new function.

Mon Dec  6 19:40:40 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* Makefile.in (.y.c): simplify the rule.

Mon Dec  6 18:08:10 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (rb_reg_eqq): document fix.  [ruby-talk:122541]

Mon Dec  6 17:49:30 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (run_trap_eval): add prototype for Microsoft compiler.

Mon Dec  6 17:32:38 2004  Tanaka Akira  <akr@m17n.org>

	* rubyio.h, intern.h, io.c, file.c, process.c, ext/socket/socket.c,
	  ext/pty/pty.c, ext/io/wait/wait.c, ext/openssl/ossl_ssl.c:
	  Use own buffering mechanism instead of stdio.  [ruby-dev:25056]

	* io.c, ext/stringio/stringio.c, test/ruby/ut_eof.rb:
	  EOF flag removed.

Mon Dec  6 17:15:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/socket/test_socket.rb (TestBasicSocket#test_setsockopt):
	  BasicSocket#setsockopt dumps core.  [ruby-dev:25039]

	* test/socket/test_tcp.rb (TestTCPSocket#test_recvfrom):
	  TCPSocket#recvfrom dumps core.  [ruby-dev:24705]

	* test/socket/test_udp.rb (TestUDPSocket#test_connect):
	  UDPSocket#connect dumps core.  [ruby-dev:25045]

	* test/socket/test_udp.rb (TestUDPSocket#test_bind):
	  UDPSocket#bind dumps core.  [ruby-dev:25057]

Mon Dec  6 09:59:23 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_fread): take VALUE argument.

	* ext/socket/socket.c (sock_connect): use rb_str_new4().
	  [ruby-dev:25052]

	* eval.c (rb_yield_0): [ruby-dev:25051]

Mon Dec  6 01:32:31 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_pkey_rsa.c (ossl_rsa_public_encrypt,
	  ossl_rsa_public_decrypt, ossl_rsa_private_encrypt,
	  ossl_rsa_private_decrypt): should take an optional argument
	  to specify padding mode. [ruby-talk:122539]

	* ext/openssl/ossl_pkey_rsa.c (Init_ossl_rsa): add new constants
	  PKCS1_PADDING, SSLV23_PADDING, NO_PADDING and PKCS1_OAEP_PADDING
	  under OpenSSL::PKey::RSA.

	* test/openssl/test_pkey_rsa.rb: new file.

Sun Dec  5 19:39:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Completion#complete): new parameter
	  to direct case insensitiveness.

	* lib/optparse.rb (OptionParser#order!): ignore case only for long
	  option.  [ruby-dev:25048]

Sun Dec  5 00:54:32 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* mkconfig.rb: setup library paths before requiring library.
	  [ruby-core:03892]

Sat Dec  4 22:54:15 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_write): remove rb_str_locktmp().  [ruby-dev:25050]

	* io.c (io_fwrite): takes VALUE string as an argument.
	  [ruby-dev:25050]

	* ext/socket/socket.c (sock_connect): remove rb_str_locktmp().
	  [ruby-dev:25050]

	* ext/socket/socket.c (udp_connect): [ruby-dev:25045]

	* ext/socket/socket.c (udp_bind): ditto.

	* ext/socket/socket.c (udp_send): ditto.

	* ext/socket/socket.c (bsock_send): ditto.

	* ext/socket/socket.c (s_recvfrom): ditto.

	* hash.c (rb_hash_hash): should provide "hash" method where "eql?"
	  is redefined.  [ruby-talk:122482]

Sat Dec  4 21:29:05 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb: (In previous commit) new method chown.

	* lib/fileutils.rb: (In previous commit) new method chown_R.

	* lib/fileutils.rb: (In previous commit) new method chmod_R
	  wrongly added.  Removed now.

Sat Dec  4 20:45:52 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mkdir, mkdir_p): should chmod explicitly.
	  [ruby-core:03881]

Sat Dec  4 18:54:09 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: removed empty lines from output.

Sat Dec  4 18:49:09 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::VERSION): 0.1.1 -> 0.1.2

	* lib/rss/rss.rb: #item=/#set_item and so on are obsolete.

Sat Dec  4 14:28:56 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/code_objects.rb (RDoc::Context::Section::set_comment):
	  Section comments may now be bracketed by lines which are
	  ignored. You can now write
	      # -----------
	      # :section: Dave's Section
	      # comment material
	      # -----------
	   The lines before :section: are removed, and identical lines at the end are
	   also removed if present.

Sat Dec  4 00:35:08 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (bsock_setsockopt): [ruby-dev:25039]

Fri Dec  3 12:25:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.h: fix prototype for C++.

Fri Dec  3 01:55:24 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: widget configuration by TkWindow#method_missing
	  returns proper object. "widget.option = val" returns val, and
	  "widget.option(val)" returns self.

	* ext/tk/lib/tk/font.rb: TkFont#replace accepts only one font argument.

	* ext/tk/lib/tk/radiobutton.rb: add TkRadiobutton#value and
	  TkRadiobutton#value=(val).

	* ext/tk/lib/tk/spinbox.rb: callback substitution support on
	  command option.

	* ext/tk/sample/demos-en/widget: bug fix (wrong image height)

	* ext/tk/sample/demos-jp/widget: ditto.

Fri Dec  3 00:21:05 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): prepare to pass a block from "call" method
	  to a Proc generated by Method#to_proc.  [ruby-dev:25031]

	* eval.c (rb_yield_0): actually passes a block given to "call".

	* object.c (convert_type): use rb_respond_to() again.  this fix is
	  based on [ruby-dev:25021]

	* eval.c (rb_respond_to): funcall respond_to? if it's redefined.
	  [ruby-dev:25021]

Thu Dec  2 15:13:53 2004  Michael Neumann  <mneumann@ruby-lang.org>

	* test/xmlrpc/test_parser.rb, test/xmlrpc/data/*.expected: Expected
	  values are now stored in YAML instead of using #inspect. This fixes
	  false hash order.

Fri Dec  3 00:11:48 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_file_initialize): [ruby-dev:25032]

Thu Dec  2 16:41:03 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_protect): prevent continuations created inside from being
	  called from the outside.  [ruby-dev:25003]

	* eval.c (rb_callcc, rb_cont_call): prohibit calling from different
	  signal contexts.  [ruby-dev:25022]

Thu Dec  2 10:45:02 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* test/readline/test_readline.rb: fix for NetBSD.

Thu Dec  2 09:57:24 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct::Marshaler): OpenStruct can be
	  marshaled again.  [ruby-core:03862]

Thu Dec  2 09:30:58 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (thread_mark): mark thread group.  [ruby-dev:25020]

	* eval.c (thgroup_add): check whether the argument is really a Thread.

Thu Dec  2 07:57:16 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_ctl): [ruby-dev:25019]

Wed Dec  1 06:13:00 2004  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf.c: add constant NKF::VERSION

	* ext/nkf/nkf.c(guess): this becomes an alias of guess2

	* ext/nkf/test.rb: add --no-cp932

	* ext/nkf/nkf-utf8/nkf.c: original nkf2 revision 1.47

Wed Dec  1 02:21:02 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* signal.c (sighandler): call handler immediately only for default
	  handlers.  [ruby-dev:25003]

Tue Nov 30 23:49:12 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): errno should be preserved for rb_sys_fail() when
	  fork failed.

Tue Nov 30 16:18:50 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_fread): need not to null terminate.  [ruby-dev:24998]

	* eval.c (rb_eval): should check previous frame for ZSUPER.

	* io.c (read_all): remove unnecessary rb_str_resize().
	  [ruby-dev:24996]

	* io.c (io_readpartial): ditto.

	* io.c (io_read): ditto.

Tue Nov 30 14:58:33 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* instruby.rb (install): add arguments explicitly to "super".

Tue Nov 30 00:49:08 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (PUSH_FRAME): flags should have been initialized.

	* eval.c (rb_eval): [ruby-core:03856]

	* io.c (rb_io_sysread): use temporary lock.  [ruby-dev:24992]

Tue Nov 30 00:12:57 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regparse.c: now handles many alternatives (over 500000)
	  in regexp. [ruby-dev:24773]

Mon Nov 29 16:06:04 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_write): insufficiently filled string
	  being extended when overwriting.  [ruby-core:03836]

Mon Nov 29 15:59:05 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct::method_missing): check method
	  duplication for -d.

	* lib/ostruct.rb (OpenStruct::initialize): ditto.

Mon Nov 29 15:22:28 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/io/nonblock/test_flush.rb: abandon tests when io/nonblock is
	  not supported.

Mon Nov 29 13:37:54 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fptr_finalize): must not use FILE after fclose().
	  [ruby-dev:24985]

Mon Nov 29 13:13:13 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): push back the last space before next
	  loop because CharNext() eats it.

Mon Nov 29 03:08:30 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (convert_type): [ruby-core:03845]

	* eval.c (rb_funcall_rescue): new function.

	* object.c (rb_Array): avoid using rb_respond_to().

	* object.c (rb_Integer): ditto.

	* eval.c (get_backtrace): no conversion for nil.

	* parse.y (reduce_nodes): empty body should return nil.

Mon Nov 29 01:18:18 2004  Tanaka Akira  <akr@m17n.org>

	* io.c (rb_io_check_writable): call io_seek regardless of
	  NEED_IO_SEEK_BETWEEN_RW.  [ruby-dev:24986]

Sun Nov 28 15:57:58 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::Element#tag): not use block_given? for
	  working with ruby 1.6 again.

	* lib/rss/{0.9,2.0,trackback}.rb, lib/rss/maker/base.rb:
	  undef -> remove_method for working with ruby 1.6 again.

Sun Nov 28 15:51:40 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::NotSetError): added.

	* lib/rss/maker/{1.0,0.9,2.0}.rb: changed RSS Maker to raise
	  RSS::NotSetError if required values of maker.channel are not
	  set. [ruby-talk:120061]

	* test/rss/test_maker_{1.0,0.9,2.0}.rb: changed tests to check RSS
	  Maker raises or not.

Sun Nov 28 12:14:47 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regparse.c (fetch_token): fixed test failure on HP-UX ia64
	  ([ruby-dev:24859]).

Sun Nov 28 12:08:15 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regparse.c, test/ruby/test_regexp.rb: fixed problem with UTF-8
	  characters that have U+00FE or invalid characters.

Sun Nov 28 12:07:04 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regexec.c, test/ruby/test_regexp.rb: fixed segmentation fault
	  ([ruby-dev:24887]).

Sun Nov 28 12:05:48 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regcomp.c, regint.h: fixed PLATFORM_UNALIGNED_WORD_ACCESS
	  problem ([ruby-dev:24802] and [ruby-core:3733])

Sat Nov 27 23:43:39 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_initialize): [ruby-dev:24972]

Sat Nov 27 21:43:39 2004  Tanaka Akira  <akr@m17n.org>

	* io.c: avoid data lost with nonblocking fd and
	  stdio buffering in sync mode.  [ruby-dev:24966]
	  based on matz's patch [ruby-dev:24967]
	  (io_fwrite): new primitive writing function which writes
	  directly if sync mode.
	  (rb_io_fwrite): wrapper for io_fwrite now.
	  (io_write): call io_fwrite instead of rb_io_fwrite.

Sat Nov 27 17:43:21 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/{0.9,1.0,2.0,trackback,xml-stylesheet}.rb: added
	  #setup_maker.

	* test/rss/test_setup_maker_*.rb: added tests for #setup_maker.

	* lib/rss/maker/base.rb(RSS::Maker::Items#max_size=): supported
	  output item size limitation.

	* sample/rss/blend.rb: added sample for RSS Maker.

Sat Nov 27 17:41:35 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/0.9.rb: supported RSS::Maker.make("0.91"). Now,
	  "0.9" is just alias of "0.91."

	* test/rss/test_maker_0.9.rb: make("0.9") -> maker("0.91").

	* test/rss/test_to_s.rb: ditto.

Sat Nov 27 17:21:30 2004  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/list_description.rb: untabified.

	* sample/rss/rss_recent.rb: ditto.

Sat Nov 27 14:44:15 2004  Kent Sibilev  <ksibilev@bellsouth.net>

	* lib/cgi/session.rb (CGI::Session::initialize): [ruby-core:03832]

Sat Nov 27 09:41:21 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_fread): old rb_io_fread with file closing checking.
	  (rb_io_fread): wrapper for io_fread now.
	  [ruby-dev:24964]

Fri Nov 26 18:02:44 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: Tk.destroy uses TkWindow#epath

	* ext/tk/lib/tk/image.rb: bug fix

	* ext/tk/lib/tk/wm.rb: add 'iconphoto' method(Windows only)

	* ext/tk/lib/tkextlib/*: some methods uses TkWindow#epath

Fri Nov 26 14:29:39 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_initialize): uninitialized fd was checked to see open
	  mode.  [ruby-dev:24963]

	* io.c (rb_io_initialize): uninitialized fd was used.  [ruby-dev:24962]

Fri Nov 26 13:49:06 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_initialize): should retrieve flags from copying file
	  descriptor. [ruby-dev:24961]

	* eval.c (method_missing): raise TypeError for classes do not
	  have allocators.  [ruby-core:03752]

	* lib/erb.rb: add RDoc by James Edward Gray II.  [ruby-core:03786]

Fri Nov 26 13:29:02 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::look_for_directives_in): Break
	  out of preprocessing when we find a :section: directive (previously cleared out the
	  comment, but this apparently now generates an error in gsub!)

Fri Nov 26 00:17:40 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_read): move StringValue() check before GetOpenFile().
	  [ruby-dev:24959]

Thu Nov 25 20:14:57 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/thwait.rb (ThreadsWait#join_nowait): abnormally terminated
	  threads should be also processed.  [ruby-talk:121320]

Thu Nov 25 18:06:37 2004  Tanaka Akira  <akr@m17n.org>

	* configure.in: AC_CHECK_SIZEOF(rlim_t) to include stdio.h to fix
	  problem with autoconf 2.52 or earlier.
	  revert AC_PREREQ to 2.50.
	  [ruby-core:3809]

Thu Nov 25 07:59:41 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: AC_PREREQ(2.53) [ruby-core:03800]

	* io.c (read_all): stringify non-nil buffer argument, and always
	  taint the result.  [ruby-dev:24955]

Wed Nov 24 01:01:31 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_read): integer conversion should be prior to
	  GetOpenFile().  [ruby-dev:24952]

	* configure.in, io.c: cancel [ ruby-Patches-1074 ].

Tue Nov 23 08:09:50 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/menu.rb: improve usability of TkOptionMenubutton

Tue Nov 23 02:00:21 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_file_chown): integer conversion should be prior to
	  GetOpenFile().  [ruby-dev:24949]

Tue Nov 23 00:10:48 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_file_chown): integer conversion should be prior to
	  GetOpenFile().  [ruby-dev:24947]

	* file.c (rb_file_truncate): ditto.

	* file.c (rb_file_s_truncate): ditto.

	* dir.c (dir_seek): use NUM2OFFT().

	* misc/ruby-mode.el (ruby-non-block-do-re): [ruby-core:03719]

Mon Nov 22 22:33:02 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::parse_require): Don't use names
	  of variables or constants when parsing 'require'

Mon Nov 22 00:13:35 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_seek): should retrieve dir_data after NUM2INT().
	  [ruby-dev:24941]

Sat Nov 20 23:57:33 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/README (et al): Add a new directive, :section:, and
	  change the output format to accommodate. :section: allows to to
	  group together methods, attributes, constants, etc under
	  headings in the output. If used, a table of contents is
	  generated.

Sat Nov 20 23:56:54 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/options.rb (Options::parse): Force --inline-source if
	  --one-file option given

Sat Nov 20 23:55:19 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_splice): should place index wrapping after
	  possible modification.  [ruby-dev:24940]

Sat Nov 20 23:25:12 2004  Minero Aoki  <aamine@loveruby.net>

	* io.c (rb_io_getline): f.gets("") did not work. [ruby-core:03771]

	* test/ruby/test_io.rb (test_gets_rs): test it.

Sat Nov 20 22:55:09 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* test/runner.rb (CROSS_COMPILING): need to require rbconfig.rb before
	  using CROSS_COMPILNG.

Sat Nov 20 20:42:42 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/depend: fix ripper.o dependency.

Sat Nov 20 17:48:29 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* io.c (io_reopen): work around problem with Cygwin fseeko
	  returning ESPIPE.

Sat Nov 20 05:34:24 2004  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: original nkf.c rev:1.40

	* ext/nkf/test.rb: add test for mime encode/decode

Sat Nov 20 01:45:04 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* test/xmlrpc/test_webrick_server.rb: move `requrie "webrick/https"'
	  into #setup_http_server method to avoid soap test errors.

Sat Nov 20 01:37:34 2004  Johan Holmberg  <holmberg@iar.se>

	* eval.c (error_print): nicer traceback at interrupt.
	  [ruby-core:03774]

Sat Nov 20 00:07:16 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): internal buffer should not be listed by
	  ObjectSpace.each_object() by String#gsub.  [ruby-dev:24931]

Fri Nov 19 22:44:43 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/test/unit/collector/dir.rb: better support for -p/-x option.

Fri Nov 19 17:46:56 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/0.9.rb (RSS::Maker::RSS09::Image#have_required_values):
	  changed /rss/channel/image to be optional. [ruby-Bugs:1047]

	* test/rss/test_maker_0.9.rb: added tests for the above.

Fri Nov 19 17:18:17 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb (RSS::VERSION): 0.1.0 -> 0.1.1.

	* lib/rss: #to_s used #tag.

	* test/rss/test_to_s.rb: added.

	* lib/rss/maker.rb (RSS::Maker.make): changed API. It's not
	  received modules which is used as the second argument.

	* lib/rss/xml-stylesheet.rb (RSS::XMLStyleSheet#alternate):
	  changed return value type which is not String but Boolean.

	* lib/rss/2.0.rb (RSS::Rss::Channel#ttl): changed return value
	  type which is not String but Integer.

	* lib/rss/0.9.rb (RSS::Rss::Channel): <skipDays> has <day>s and
	  <skipHours> has <hour>s.

	* lib/rss/maker/0.9.rb (RSS::Maker::RSS09::Channel): ditto.

	* lib/rss/0.9.rb (RSS::Rss::Channel::Item): <item> has <category>s.

	* lib/rss/maker/2.0.rb (RSS::Maker::Rss20::Channel::Item): ditto.

	* lib/rss/2.0.rb (RSS::Rss::Channel): <channel> has <category>s.

	* lib/rss/maker/2.0.rb (RSS::Maker::RSS20::Channel): ditto.

	* lib/rss/trackback.rb: parent element has <trackback:about>s.

	* lib/rss/maker/trackback.rb: ditto.

Fri Nov 19 11:10:16 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/test/unit/collector/dir.rb: add support for directory name
	  with -p/-x options.

	* test/testunit/collector/test_dir.rb: ditto.

	* lib/xmlrpc/datetime.rb (XMLRPC::DateTime#==): should use Array()
	  instead of to_a.

Fri Nov 19 10:32:36 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/readline/readline.c (readline_s_set_completion_append_character):
	  accept nil.  [ruby-core:03765]

Fri Nov 19 01:20:22 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session::FileStore::initialize): raise
	  exception if data corresponding to session specified from the
	  client does not exist.

Fri Nov 19 00:59:31 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): internal buffer should not be listed by
	  ObjectSpace.each_object().  [ruby-dev:24919]

Thu Nov 18 23:42:36 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/depend: Never regenerate lib/ripper/core.rb
	  automatically. [ruby-dev:24911]

Thu Nov 18 20:47:24 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.[ch] (rb_w32_isatty): new function to replace MSVCRT's
	  isatty because it never sets errno.

Thu Nov 18 18:41:08 2004  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_stringchar.rb (test_bang): added.

	* string.c (rb_str_upcase_bang, rb_str_capitalize_bang)
	  (rb_str_swapcase_bang): missing rb_str_modify().

Thu Nov 18 17:05:01 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (f_rest_arg): store rest args into invisible local variable
	  in order to get rid of SEGV at ZSUPER.  [ruby-dev:24913]

Thu Nov 18 15:39:52 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_f_getenv): prohibit for $SAFE=4. [ruby-dev:24908]

Thu Nov 18 14:58:42 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/readline/readline.c: check $SAFE.

	* test/readline/test_readline.rb: added tests for readline.

Thu Nov 18 00:21:15 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (proc_getpgrp): prohibit for $SAFE=2.
	  [ruby-dev:24899]

	* process.c (get_pid): ditto.  [ruby-dev:24904]

	* process.c (get_ppid): ditto.

	* array.c (rb_ary_delete): defer rb_ary_modify() until actual
	  modification.  [ruby-dev:24901]

Thu Nov 18 10:10:14 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c, rubyio.h (rb_io_modenum_flags): exported.

	* ext/stringio/stringio.c (strio_initialize): allow Fixnum as mode as
	  well as IO.new does.  [ruby-dev:24896]

Wed Nov 17 23:47:30 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_settracefunc.rb: added.  [ruby-dev:24884]

Wed Nov 17 18:59:16 2004  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* process.c (proc_getrlimit, proc_setrlimit): add rb_secure(2) to
	  methods of Process.{getrlimit,setrlimit}

Wed Nov 17 13:56:57 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (newline_node): should not use FL_SET. [ruby-dev:24874]

	* parse.y (string_content): should not use FL_UNSET.

	* node.h (NODE_NEWLINE): remove unused bit to utilize flag field
	  in nodes.

Wed Nov 17 13:05:10 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (rb_push_glob): fix overrun.  [ruby-dev:24886]

Wed Nov 17 11:48:17 2004  Michael Neumann  <mneumann@ruby-lang.org>

	* lib/xmlrpc/parser.rb, test/xmlrpc/test_features.rb: fixed "assigning
	  to constants" warnings

Wed Nov 17 09:38:18 2004  Johan Holmberg  <holmberg@iar.se>

	* re.c (rb_reg_initialize_m): should raise exception instead of
	  compile error.  [ruby-core:03755]

Wed Nov 17 03:42:45 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_splice): move rb_str_modify() after
	  StringValue(), which may alter the receiver.  [ruby-dev:24878]

	* error.c (rb_error_frozen): now raise RuntimeError instead of
	  TypeError.

Tue Nov 16 21:22:47 2004  Michael Neumann  <mneumann@ruby-lang.org>

	* lib/xmlrpc/server.rb (CGIServer): fixed bug when client sends
	  "Content-typ: text/xml; ..."

Tue Nov 16 23:45:07 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_divmod): protect float values from GC by
	  assignment to local variables.  [ruby-dev:24873]

Tue Nov 16 14:31:54 2004  Michael Neumann  <mneumann@ruby-lang.org>

	* test/xmlrpc/*: imported and refactored original test cases.

	* test/xmlrpc/test_webrick_server.rb, test/xmlrpc/webrick_testing.rb:
	  added test case that starts up a WEBrick XML-RPC server and performs
	  some tests on it (both http and https servers are started).

	* lib/xmlrpc/create.rb (XMLWriter::each_installed_writer),
	  lib/xmlrpc/parser.rb (XMLParser::each_installed_parser):
	  added methods to simply original test cases

	* lib/xmlrpc/parser.rb, lib/xmlrpc/datetime.rb: applied patch by
	  MoonWolf <moonwolf@moonwolf.com> to allow parsing datetime.iso8601
	  (e.g. 20041105T01:15:23Z).

	* lib/xmlrpc/server.rb: fixed issue #998
	  (http://rubyforge.org/tracker/?func=detail&atid=1700&aid=998&group_id=426)

	* lib/xmlrpc/create.rb, lib/xmlrpc/utils.rb: when marshalling/loading
	  user-defined data structures, use Class#allocate instead of defining
	  an empty #initialize method. module XMLRPC::Marshallable is now only
	  used for tagging.

	* lib/xmlrpc/.document, lib/xmlrpc/README.rdoc: added howto

Tue Nov 16 16:26:12 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32,wince}/setup.mak (-epilogue-): remove config.h and
	  config.status to force updating them.

Tue Nov 16 16:20:45 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): position was ignored when a
	  buffer was passed.  http://www.yo.rim.or.jp/~nov/d/?date=20041116#p03

Tue Nov 16 13:35:54 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner::options): add
	  new option --exclude (-x) to skip some tests. [ruby-core:3363],
	  [ruby-dev:24865]

	* lib/test/unit/collector/dir.rb (Test::Unit::Collector::Dir.exclude):
	  ditto.

Tue Nov 16 11:19:07 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner::options): use
	  Regexp conversion.

Tue Nov 16 01:41:31 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_mod_check): frozen check should be separated.
	  [ruby-core:3742]

	* array.c (rb_ary_update): pedantic check to detect
	  rb_ary_to_ary() to modify the receiver.  [ruby-dev:24861]

Mon Nov 15 18:58:05 2004  Tanaka Akira  <akr@m17n.org>

	* configure.in: check rlim_t more portably. [ruby-core:3735]

Mon Nov 15 11:50:32 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-special-char-p, ruby-parse-partial): handle
	  operator symbols.  [ruby-talk:120177]

Mon Nov 15 08:58:55 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_Proc): make proc as an alias to Proc.new.
	  [ruby-dev:24848]

Mon Nov 15 00:46:03 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_yield_0): lambda{}.call(1) should raise exception.
	  [ruby-talk:120253]

Mon Nov 15 00:33:40 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_clear): avoid revealing NULL pointer.
	  [ruby-dev:24766]

	* string.c (str_gsub): add paranoid check. [ruby-dev:24827]

	* string.c (str_mod_check): check frozen status as well.
	  [ruby-dev:24801]

Sun Nov 14 18:59:03 2004  Tanaka Akira  <akr@m17n.org>

	* process.c (proc_getrlimit): new function for Process.getrlimit.
	  (proc_setrlimit): new function for Process.setrlimit.
	  [ruby-dev:24834]

	* configure.in: check rlim_t and its size.  check setrlimit.

	* ruby.h (NUM2ULL): new macro.

Sun Nov 14 13:27:03 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pp.rb (PP#object_address_group): remove odd number of 'f'
	  prefixed to negative address.

Sun Nov 14 10:48:21 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/mathn.rb (Integer::gcd2): faster implementation by
	  <erlercw@siu.edu>. [ruby-talk:120232]

Sun Nov 14 08:46:33 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/logger/test_logger.rb: Logger just expects
	  Logger#datetime_format to be used for Time#strftime independently of
	  locale. [ruby-dev:24828]

Fri Nov 12 17:32:07 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bcc32/README.bcc32, win32/README.win32: need bison instead of
	  byacc.

Fri Nov 12 15:15:06 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (ruby_options): now we cannot call rb_glob() before
	  ruby_init(), so call rb_w32_cmdvector() at ruby_options().

	* win32/win32.{c,h} (rb_w32_cmdvector): rename make_cmdvector() and
	  export it.

Fri Nov 12 14:08:01 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/event.rb: remove $LOADED_FEATURES trick

	* ext/tk/lib/tk.rb: ditto

Fri Nov 12 00:31:05 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/gdbm/gdbm.c (fgdbm_store): StringValue() may alter string
	  pointer.  [ruby-dev:24783]

Thu Nov 11 17:58:19 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (rb_glob): should have called rb_glob_caller().
	  [ruby-dev:24773]

Thu Nov 11 16:56:10 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_file.rb (test_truncate_wbuf): we want to test
	  only File#truncate, not behavior of seek(2).

Thu Nov 11 01:52:52 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (syserr_initialize): use stringified object.
	  [ruby-dev:24768]

Wed Nov 10 22:49:01 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/delegate.rb (SimpleDelegator::dup): wrong number of
	  arguments.

	* lib/delegate.rb (DelegateClass::dup): ditto.

Wed Nov 10 19:47:55 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_helper): path is a string object now.

Wed Nov 10 12:31:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT (Example): extconf.rb is indispensable now.

Wed Nov 10 03:33:36 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: fix SEGV when compiled with Tcl/Tk8.3.x
	  or older

	* ext/tk/lib/tkextlib/tile/style.rb: bug fix

Tue Nov  9 22:24:07 2004  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf: original nkf.c rev:1.38

	* ext/nkf/nkf.c: fix bug: can't parse long-name options

	* ext/nkf/test.rb: fix bug: mime tests fail

Tue Nov  9 14:27:18 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Officious): moved from DefaultList.

Tue Nov  9 00:50:06 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/rdoc.rb: Change version numbering of RDoc and ri

Tue Nov  9 01:05:04 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (rb_glob2): do not allocate buffer from heap to avoid
	  memory leaks.  use string object for buffering instead.
	  [ruby-dev:24738]

	* dir.c (join_path): ditto.

	* io.c (io_read): external input buffer may be modified even after
	  rb_str_locktmp().  [ruby-dev:24735]

	* dir.c (fnmatch): p or s may be NULL.  [ruby-dev:24749]

Tue Nov  9 00:36:26 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/extservm.rb: add DRb::ExtServManager#uri=.
	  [ruby-dev:24743]

Mon Nov  8 22:20:19 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_class):
	  Fix bug where parent class wasn't being detected if the
	  child class was defined using the A::B notation.

Mon Nov  8 00:14:13 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: add setup for mingw32 cross compiling.
	  [ruby-talk:119413]

Sun Nov  7 23:49:26 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: bind-event methods accept multi substitution
	  arguments.

	* ext/tk/lib/tk/canvas.rb: ditto.

	* ext/tk/lib/tk/canvastag.rb: ditto.

	* ext/tk/lib/tk/text.rb: ditto.

	* ext/tk/lib/tk/texttag.rb: ditto.

	* ext/tk/lib/tkextlib: ditto.

Sat Nov  6 20:40:16 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: rename WIN32OLE#ole_obj_help to
	  WIN32OLE#ole_type. alias ole_obj_help to ole_type.

	* ext/win32ole/tests/testWIN32OLE.rb: ditto.

Sat Nov  6 11:18:59 2004  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (_parse): checks whether zone was given.

Sat Nov  6 00:46:27 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_locktmp): check STR_TMPLOCK flag before
	  locking.  [ruby-dev:24727]

Fri Nov  5 19:07:16 2004  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf: follow CVS Head of original nkf.

Fri Nov  5 18:12:42 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/scrollable.rb: divide Scrollable module into
	  X_Scrollable and Y_Scrollable

	* ext/tk/lib/tk/entry.rb: include X_Scrollable instead of Scrollable

	* ext/tk/lib/tk/autoload.rb: define autoload for X_Scrollable and
	  Y_Scrollable

Fri Nov  5 16:05:32 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: TkComm._at() supprts both of "@x,y" and "@x"

Fri Nov  5 13:22:58 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/text.rb: sorry. bug fix again.

Fri Nov  5 13:17:54 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/text.rb: bug fix

Fri Nov  5 08:52:48 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_mark): stricter GC stack check.

Fri Nov  5 08:34:43 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): should have removed rb_str_unlocktmp(str).
	  [ruby-dev:24708]

	* ext/socket/socket.c (s_recvfrom): buffer modification check.
	  [ruby-dev:24708]

Thu Nov  4 23:54:21 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regexec.c, regparse.c, regint.h: fixed conflicts between
	  vendor branch.

Thu Nov  4 23:41:55 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* ascii.c, euc_jp.c, oniggnu.h, oniguruma.h, regcomp.c,
	  regenc.c, regenc.h, regerror.c, regexec.c, reggnu.c,
	  regint.h, regparse.c, regparse.h, sjis.c, utf8.c:
	  imported Oni Guruma 3.4.0.

	* parse.y, re.c: Now mbclen() takes unsigned char as
	  its argument.

Thu Nov  4 21:25:38 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): string modify check no longer based on
	  tmplock.  [ruby-dev:24706]

Thu Nov  4 21:13:48 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c(typelib_file_from_typelib): search "win16"
	  entry to get library path.

	* ext/win32ole/win32ole.c(oletypelib_path): ditto.

	* ext/win32ole/win32ole.c(ole_typedesc2val): add VT_LPWSTR, VT_LPSTR,
	  VT_ERROR case.

Thu Nov  4 15:02:14 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb: forget to initialize instance_variables
	  of TkVarAccess objects

Thu Nov  4 09:11:35 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_mark): enable GC stack checking.

Thu Nov  4 03:11:33 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): lock strings temporarily.  [ruby-dev:24687]

	* ext/socket/socket.c (s_recvfrom): tmplock input buffer.
	  [ruby-dev:24705]

Wed Nov  3 22:24:17 2004  Daigo Moriwaki  <techml@sgtpepper.net>

	* lib/webrick/httpauth/digestauth.rb: use Base64.encode64 to
	  avoid warnings.

Wed Nov  3 17:19:59 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_uniq_bang): do not push frozen string from hash
	  table.  [ruby-dev:24695]

	* array.c (rb_ary_and): ditto.

	* array.c (rb_ary_or): ditto.

Wed Nov  3 17:02:48 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: support to use different Tcl commands between
	  configure and configinfo

	* ext/tk/lib/font.rb: ditto.

	* ext/tk/lib/itemconfig.rb: support to use different Tcl commands
	  between item_configure and item_configinfo

	* ext/tk/lib/itemfont.rb: ditto.

	* ext/tk/extconf.rb: install SUPPORT_STATUS

	* ext/tk/lib/tkextlib: some bug fixes (see ext/tk/ChangeLog.tkextlib)

Wed Nov  3 15:38:28 2004  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/*.rb: removed tab width configuration headers.

	* test/rss/test_maker_{0.9,1.0}.rb: sort -> do_sort.

	* lib/rss/maker/*.rb: changed API to RSS version independence.

	* lib/rss/maker/base.rb
	  (RSS::Maker::XMLStyleSheets::XMLStyleSheet): checked required
	  (pseudo) attributes.

	* lib/rss/maker/base.rb (RSS::Maker::Items): sort -> do_sort.

	* lib/rss/rss.rb (RSS::BaseModel.install_date_element): avoided
	  warning.

	* lib/rss/0.9.rb (RSS::Rss#textinput): added convenience method.

Tue Nov  2 16:35:57 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/enumerator/enumerator.c (each_cons_i): pass copy of an
	  internal consequent array.  [ruby-talk:118691]

Tue Nov  2 14:54:02 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (pipe_open): need to set cmd if argc == 0 (win32).

Tue Nov  2 01:20:09 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (pipe_open): IO.popen should take array as 1st argument for
	  a command line.  [ruby-dev:24678]

	* eval.c (proc_invoke): nail down dyna_var node when Proc object
	  or continuation is created.  [ruby-dev:24671]

	* io.c (rb_io_s_popen): do not expand argv array.  [ruby-dev:24670]

Mon Nov  1 22:25:56 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/base.rb: changed xml-stylesheet's API of RSS Maker
	  like to item's one.

	* lib/rss/xml-stylesheet.rb (RSS::XMLStyleSheet#guess_type): fixed
	  regular expression bug.

	* test/rss/test_maker_xml-stylesheet.rb: updated tests for
	  xml-stylesheet.

Mon Nov  1 13:59:28 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/extmk.rb (MANIFEST): do not use anymore, use extconf.rb instead.

	* ext/enumerator/extconf.rb, ext/fcntl/extconf.rb,
	  ext/stringio/extconf.rb: added.

	* MANIFEST, ext/**/MANIFEST: removed.

	* README.EXT, README.EXT.ja: remove MANIFEST stuff.

Mon Nov  1 11:52:18 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (pipe_open): avoid conflict of variable name. [ruby-dev:24662]

Mon Nov  1 11:46:19 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* process.c (rb_f_exec): should check whether prog is NULL.

Mon Nov  1 09:37:19 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker.rb: added entry point of RSS Maker.

Mon Nov  1 03:14:14 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_get_method_body): store ICLASS in the cache.
	  [ruby-core:03672]

	* eval.c (rb_provided): should return true for loading library
	  too for autoloading.  [ruby-core:03655]

Mon Nov  1 01:14:52 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_open): create copy of popen specifier.  [ruby-dev:24656]

	* string.c (rb_str_locktmp): lock string temporarily.

	* string.c (str_independent): add tmplock check.

	* io.c (io_write): lock output string temporarily.
	  [ruby-dev:24649]

	* io.c (io_write): use rb_str_locktmp().

	* io.c (read_all): ditto.

Sun Oct 31 23:37:00 2004  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c: on NetBSD don't use setruid() and setrgid().

Sun Oct 31 23:12:10 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker/*.rb: added RSS Maker.

	* test/rss/test_maker_*.rb: added tests for RSS Maker.

Sun Oct 31 16:58:12 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE.codepage, WIN32OLE.codepage=.

	* ext/win32ole/tests/testWIN32OLE.rb: ditto.

Sun Oct 31 14:35:26 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: add "\075?UTF-8?Q?" for Gmail.

Sun Oct 31 14:18:56 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: emit lexer-event values to the parser
	  (still incomplete).

Sat Oct 30 15:24:41 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add WIN32OLE_TYPELIB class. add
	  WIN32OLE#ole_typelib method.

	* ext/win32ole/tests/testOLETYPELIB.rb: add WIN32OLE_TYPELIB class.

Sat Oct 30 06:53:24 2004  Peter Vanbroekhoven  <peter.vanbroekhoven@cs.kuleuven.ac.be>

	* eval.c (rb_eval): NODE_XSTR should pass copy of literal string.

Sat Oct 30 00:19:40 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_update): a[n,m]=nil no longer works as element
	  deletion.

	* enum.c (enum_sort_by): protect continuation jump in.
	  [ruby-dev:24642]

	* eval.c (rb_eval), gc.c (gc_mark_children), node.h (NEW_ALIAS,
	  NEW_VALIAS), parse.y (fitem): allow dynamic symbols to
	  NODE_UNDEF and NODE_ALIAS.

Fri Oct 29 21:27:51 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_check_initialized): new function to check uninitialized
	  object.  [ruby-talk:118234]

	* file.c (rb_file_path), io.c (rb_io_closed): check if initialized.

Fri Oct 29 19:05:33 2004  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf: follow nkf2.0.

Fri Oct 29 17:18:22 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (ripper_s_allocate): add prototype for Microsoft compiler.

	* range.c (range_step, range_each): need cast.

Fri Oct 29 16:34:19 2004  Daiki Ueno  <ueno@unixuser.org>

	* misc/ruby-mode.el (ruby-parse-partial): Parse the rest of the
	  line after opening heredoc identifier.  [ruby-dev:24635]

Fri Oct 29 11:35:04 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_parser_append_print, rb_parser_while_loop): body node
	  can be empty.  [ruby-dev:24628]

Fri Oct 29 10:00:30 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_thread_start_0): forget to free some memory chunks.
	  [ruby-core:03611]

	* eval.c (ruby_cleanup): ruby_finalize_1 may cause exception,
	  should be wrapped by PUSH_TAG/POP_TAG().  [ruby-dev:24627]

Thu Oct 28 08:42:02 2004  Tanaka Akira  <akr@m17n.org>

	* io.c (argf_forward): use ANSI style.
	  (argf_read): call argf_forward with argv argument.
	  [ruby-dev:24624]

Wed Oct 27 09:17:30 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_gsub): use a string object for exception safeness.
	  [ruby-dev:24601]

Wed Oct 27 07:38:55 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* node.h (NODE_TYPESHIFT): allow 4 more bits for line numbers.
	  [ruby-talk:117841]

	* ruby.h (FL_ABLE): nodes are not subject for flag operations.

	* io.c (ARGF_FORWARD): should have specified argv explicitly,
	  since we no longer have frame->argv saved.  [ruby-dev:24602]

Tue Oct 26 23:30:39 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/code_objects.rb (RDoc::Context::add_class_or_module):
	  Restore correct :nopdoc: behavior with nested classes and modules.

Tue Oct 26 18:21:29 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (RESIZE_CAPA): check string attribute before modifying
	  capacity member of string structure.  [ruby-dev:24594]

Tue Oct 26 11:33:26 2004  David G. Andersen  <dga@lcs.mit.edu>

	* ext/zlib/zlib.c (gzreader_gets): use memchr() to to gain
	  performance.  [ruby-talk:117701]

Tue Oct 26 10:56:55 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): raise ArgumentError for extra
	  arguments, unless (digit)$ style used.

Mon Oct 25 18:35:39 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* win32/win32.c (isUNCRoot): should check NUL after '.'.
	  [ruby-dev:24590]

	* win32/win32.c (isUNCRoot): fixed buffer overrun.

Mon Oct 25 08:03:26 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (get_backtrace): ignore illegal backtrace.  [ruby-dev:24587]

Sun Oct 24 00:40:50 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_load, search_required, rb_require_safe, rb_require): use
	  frozen shared string to avoid outside modification.  [ruby-dev:24580]

Sat Oct 23 23:40:34 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_fptr_finalize): leave stdin/stdout/stderr open in
	  interpreter termination.  [ruby-dev:24579]

Sat Oct 23 22:18:32 2004  Guy Decoux  <ts@moulon.inra.fr>

	* eval.c (frame_free): Guy Decoux solved the leak problem.
	  Thanks.  [ruby-core:03549]

Sat Oct 23 00:20:55 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/zlib/zlib.c (zstream_append_input): clear klass for z->input
	  to avoid potential vulnerability.

	* ext/zlib/zlib.c (zstream_run): always use zstream_append_input()
	  to avoid SEGV.  [ruby-dev:24568]

Fri Oct 22 12:02:28 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_alias): was warning for wrong condition.
	  [ruby-dev:24565]

Fri Oct 22 10:36:37 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#meta_vars):
	  should check if path_info is not nil.

Fri Oct 22 00:22:31 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/zlib/zlib.c (zstream_shift_buffer): should restore class
	  field of a buffer.  [ruby-dev:24562]

Fri Oct 22 00:20:33 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_include): should not treat char as negative value.
	  [ruby-dev:24558]

Thu Oct 21 21:32:30 2004  IWATSUKI Hiroyuki  <don@na.rim.or.jp>

	* lib/pstore.rb (PStore#transaction): Use the empty content when a
	  file is not found.  [ruby-dev:24561]

Thu Oct 21 19:06:15 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpresponse.rb (WEBrick::HTTPResponse#send_body_io):
	  ensure to close @body. (http://bugs.debian.org/277520)

Thu Oct 21 13:11:31 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* io.c (pipe_open): variable name "fpw" is conflicted.

Thu Oct 21 00:36:41 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_alias): should warn on method discarding.
	  [ruby-dev:24546]

	* ext/zlib/zlib.c (zstream_expand_buffer_into): hide internal
	  string buffer by clearing klass.  [ruby-dev:24548]

	* parse.y (lex_getline): should not touch ruby_debug_lines if
	  RIPPER is defined.  [ruby-dev:24547]

Wed Oct 20 19:45:13 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_gsub): 	reentrant check.  [ruby-dev:24432]

Wed Oct 20 12:42:53 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_getline): rs modification check should not interfere
	  in the loop.

Wed Oct 20 10:31:33 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (lex_getline): should update ruby_debug_lines.

Wed Oct 20 04:17:55 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/dbm/dbm.c (fdbm_delete_if): should check if deleting element
	  is a string.  [ruby-dev:24490]

	* ext/sdbm/init.c (fsdbm_delete_if): ditto.

Wed Oct 20 01:37:18 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_times): Array#* should return an instance of
	  the class of right operand.  [ruby-dev:24526]

	* ext/zlib/zlib.c (zstream_detach_buffer): should not expose
	  class-less object to Ruby world. [ruby-dev:24530]

	* eval.c (proc_dup): provide Proc#dup as well.  [ruby-talk:116915]

	* eval.c (ruby_exec): stack marking position may be higher than
	  expected.  thanks to Guy Decoux.  [ruby-core:03527]

Wed Oct 20 00:25:41 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (search_required): required name must not be changed before
	  loading.  [ruby-dev:24492]

Tue Oct 19 23:59:46 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_require_safe): provide the feature after loaded.
	  [ruby-list:40085]

Tue Oct 19 22:43:12 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_attr): If
	  we come across 'attr' in a context where it isn't
	  followed by a symbol, just issue a warning.

Tue Oct 19 20:32:50 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole.c(ole_invoke): retrieve the result value when
	  retrying the IDispatch::invoke.

Tue Oct 19 17:24:11 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (read_all): block string buffer modification during
	  rb_io_fread() by freezing it temporarily. [ruby-dev:24479]

	* dir.c (rb_push_glob): block call at once the end of method.
	  [ruby-dev:24487]

	* ext/enumerator/enumerator.c (enum_each_slice): remove
	  rb_gc_force_recycle() to prevent potential SEGV.
	  [ruby-dev:24499]

	* ext/zlib/zlib.c (zstream_expand_buffer): hide internal string
	  buffer by clearing klass.  [ruby-dev:24510]

Tue Oct 19 08:47:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_upto): method result must be checked.  [ruby-dev:24504]

	* eval.c (error_print): ditto.  [ruby-dev:24519]

Mon Oct 18 23:37:05 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): check inheritance by the internal function.
	  [ruby-dev:24515]

Mon Oct 18 11:29:32 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_flags_mode, rb_io_mode_flags): distinguish whether file
	  not existing is created.  [ruby-dev:24505]

Mon Oct 18 07:26:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_truncate): discard read buffer before truncation.
	  [ruby-dev:24197]

Mon Oct 18 01:56:03 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#initialize):
	  initial value of accpet-* should be array.

Mon Oct 18 00:42:45 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_s_getservbyaname): protocol string
	  might be altered.  [ruby-dev:24503]

	* string.c (rb_str_upto): check if return value from succ is a
	  string.  [ruby-dev:24504]

Sun Oct 17 23:03:48 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/timer.rb: TkTimer#start and restart accept a block

Sun Oct 17 12:53:46 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (fole_func_methods): correct argument mismatch.
	* ext/win32ole/win32ole.c (fole_get_methods): ditto.
	* ext/win32ole/win32ole.c (fole_put_methods): ditto.
	* ext/win32ole/tests/testWIN32OLE.rb: add test for WIN32OLE#ole_func_methods
	  WIN32OLE#ole_get_methods, WIN32OLE#ole_put_methods

Sat Oct 16 14:45:28 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/0.9.rb (RSS::Rss#to_s): removed garbage.

Sat Oct 16 13:42:49 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/: untabified.
	* test/rss/: untabified.
	* lib/rss/0.9.rb (RSS::Rss#to_s): inent -> indent.

Sat Oct 16 13:34:56 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss: supported prety print.
	* test/rss/test_1.0.rb: added test for calculating default indent size.

Sat Oct 16 10:56:36 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): install-rb is needed for statically
	  linked extensions.  [ruby-dev:24491]

Fri Oct 15 18:07:08 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509store.c
	  (ossl_x509stctx_initialize): setup OpenSSL::X509::StoreContext with
	  ossl_x509stctx_* functions instead of X509_STORE_CTX_*.
	  (ossl_x509store_set_time): add OpenSSL::X509::Store#time=.
	  (ossl_x509stctx_set_time): add OpenSSL::X509::StoreContext#time=.

	* test/openssl/ossl_x509store.rb: test certificate validity times.

Fri Oct 15 18:04:35 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/timer.rb: TkTimer.new(interval, loop){ ... } is
	  acceptable. Add TkTimer.start ( == new + start ).

Fri Oct 15 12:43:09 2004  Tanaka Akira  <akr@m17n.org>

	* eval.c (Init_stack): make prototype declaration consistent with
	  the definition in gc.c.

Thu Oct 14 13:33:59 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: added link to Tutorial.

Tue Oct 12 21:22:50 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/config.rb:
	  add WEBrick::Config::FileHandler[:AcceptableLanguages].

	* lib/webrick/httpservlet/filehandler.rb
	  (WEBrick::HTTPServlet::FileHandler#set_filename): search files
	  having suffix of language-name which Accept-Language header field
	  includes if :AcceptableLanguages options is present.

	* lib/webrick/httpservlet/filehandler.rb
	  (WEBrick::HTTPServlet::FileHandler#get_servlet): new method to
	  search servlet correspond to the suffix of filename.

	* lib/webrick/httprequest.rb: add attributes access methods: accept,
	  accept_charset, accept_encoding, accept_language, content_length
	  and content_type.

	* lib/webrick/httpresponse.rb: add attribute access methods:
	  content_length, content_length=, content_type and content_type=.

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils.mime_types):
	  use the second suffix to detect media type. (the first suffix
	  may be a language name.)

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils.parse_qvalues):
	  add method to parse Accept header field. it returns an Array of
	  values sorted by the qvalues.

Tue Oct 12 15:05:32 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* io.c (MODE_BINMODE, MODE_BINARY): fixed reversed condition.

Mon Oct 11 17:51:34 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_popen): get mode string via rb_io_flags_mode() to
	  avoid mode string modification.  [ruby-dev:24454]

	* io.c (rb_io_getline_fast): should take delim as unsigned char to
	  distinguish EOF and '\377'.  [ruby-dev:24460]

	* io.c (rb_io_getline): add check for RS modification.
	  [ruby-dev:24461]

	* enum.c (enum_sort_by): use qsort() directly instead using
	  rb_iterate().  [ruby-dev:24462]

	* enum.c (enum_each_with_index): remove rb_gc_force_recycle() to
	  prevent access to recycled object (via continuation for
	  example).  [ruby-dev:24463]

Mon Oct 11 13:48:20 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/*: untabify

Sun Oct 10 12:32:08 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::parse_require): Allow 'require'
	  to be used as a variable name

Sun Oct 10 02:49:14 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/lib/ripper/filter.rb: require ripper/tokenizer.

	* ext/ripper/lib/ripper/filter.rb (parse): argument is optional.

Sun Oct 10 02:43:13 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: \n between two comments disappeared.

Sat Oct  9 21:23:37 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/converter.rb: changed to try to use Iconv for default
	  conversion.

	* lib/rss/rss.rb: 0.0.9 -> 0.1.0.

Sat Oct  9 19:50:36 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_getline): should not treat char as negative value.
	  [ruby-dev:24460]

Sat Oct  9 00:25:39 2004  Tanaka Akira  <akr@m17n.org>

	* io.c (rb_io_fread): rb_thread_wait_fd() was lost.
	  [ruby-dev:24457]

Fri Oct  8 21:36:56 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (fu_traverse): return value of Dir.entries is
	  reliable. (pass $SAFE=1)

	* lib/fileutils.rb (remove_dir): return value of Dir.foreach is
	  reliable. (pass $SAFE=1)

Fri Oct  8 09:49:32 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): pointer modification check before each
	  iteration.  [ruby-dev:24445]

Fri Oct  8 01:13:05 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/optiondb.rb: make it more secure

Thu Oct  7 23:47:57 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/scrollbar.rb: When 'set' operation, a scrollbar
	  cannot propagate view port information from the source widget
	  (that calls 'set') to other assigned widgets.

Thu Oct  7 17:36:25 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: When CHILDKILLED and so on, Tk.errorCode returns
	  a Fixnum for 2nd element (it's pid) of the return value.

Thu Oct  7 12:55:04 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (io_read): should freeze buffer before thread context
	  switch. [ruby-dev:24442]

	* pack.c (pack_unpack): string conversion should at the top of the
	  method.  [ruby-dev:24439]

	* io.c (io_read): buffer should be frozen only after the length
	  check.  [ruby-dev:24440]

Thu Oct  7 02:56:43 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c: use FMODE_APPEND.

Thu Oct  7 01:05:33 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: add Tk.errorInfo and Tk.errorCode

Thu Oct  7 00:08:37 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_s_sysopen): preserve path in the buffer allocated by
	  ALLOCA_N() to prevent modification.  [ruby-dev:24438]

Wed Oct  6 09:21:00 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_mode_flags): preserve append mode flag.
	  [ruby-dev:24436]

	* io.c (rb_io_modenum_mode): do not use external output buffer.

	* string.c (rb_str_justify): differ pointer retrieval to prevent
	  padding string modification.  [ruby-dev:24434]

	* range.c (range_each_func): allow func to terminate loop by
	  returning RANGE_EACH_BREAK.

	* range.c (member_i): use RANGE_EACH_BREAK. [ruby-talk:114959]

Tue Oct  5 09:53:22 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_fopen): mode string copy at the lowest level.

	* io.c (rb_io_flags_mode): requires output buffer no more.  no
	  allocation needed.

	* array.c (rb_ary_index): takes a block to compare items in an
	  array.  [ruby-talk:113069] [Ruby2]

	* array.c (rb_ary_rindex): ditto.

Mon Oct  4 14:03:40 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_file_open_internal, rb_io_reopen): fname might be altered
	  while GC.  [ruby-dev:24408]

Mon Oct  4 12:53:45 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/optiondb.rb: support definition of command
	  resources on widgets

	* ext/tk/lib/tk/image.rb: bug fix

Sun Oct  3 21:16:05 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (TEXT_REGEXP): allow 8-bit characters for the german
	  version of Microsoft Exchange Server.

	* lib/net/imap.rb (RTEXT_REGEXP): ditto.

	* lib/net/imap.rb (CTEXT_REGEXP): ditto.

Sat Oct  2 20:34:05 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (local_vars): moved to struct parser_params.
	  [ruby-dev:24391]

	* parser.y (stmts): remove suspicious NODE_BEGIN.  [ruby-dev:24390]

	* node.h (NEW_DVAR): extra semicolon.

Sat Oct  2 00:42:20 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_byte): retrieve pointer from string value for each
	  time.  [ruby-dev:24404]

	* marshal.c (r_bytes0): ditto.

	* enum.c (sort_by_i): re-entrance check added.  [ruby-dev:24399]

	* io.c (io_read): should freeze all reading buffer.
	  [ruby-dev:24400]

	* string.c (rb_str_sum): should use bignums when bits is greater
	  than or equals to sizeof(long)*CHAR_BITS. [ruby-dev:24395]

	* eval.c (specific_eval): defer pointer retrieval to prevent
	  unsafe sourcefile string modification.  [ruby-dev:24382]

	* string.c (rb_str_sum): wrong cast caused wrong result.
	  [ruby-dev:24385]

	* enum.c (enum_sort_by): hide temporary array from
	  ObjectSpace.each_object.  [ruby-dev:24386]

	* string.c (rb_str_sum): check was done with false pointer.
	  [ruby-dev:24383]

	* string.c (rb_str_sum): string may be altered.  [ruby-dev:24381]

Fri Oct  1 11:40:14 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_eval): defer pointer retrieval to prevent unsafe
	  sourcefile string modification.  [ruby-dev:24373]

	* io.c (io_read): block string buffer modification during
	  rb_io_fread() by freezing it temporarily. [ruby-dev:24366]

	* io.c (rb_io_s_popen): mode argument may be altered.
	  [ruby-dev:24375]

	* file.c (rb_file_s_basename): ext argument may be altered.
	  [ruby-dev:24377]

	* enum.c (enum_sort_by): use NODE instead of 2 element arrays.
	  [ruby-dev:24378]

	* string.c (rb_str_chomp_bang): StringValue() may change the
	  receiver.  [ruby-dev:24371]

Fri Oct  1 11:25:20 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/grid.rb: revive TkGrid.grid

	* ext/tk/lib/tk/pack.rb: revive TkPack.pack

	* ext/tk/lib/tk/place.rb: revive TkPlace.place

Thu Sep 30 00:50:44 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (ip_init): bug fix

	* ext/tk/tkutil.c (get_eval_string_core): accept a Regexp object

	* ext/tk/lib/multi-tk.rb: fix bug on 'exit' operation

	* ext/tk/lib/tk/text.rb: 'tksearch' accepts a Regexp object as a
	  matting pattern argument

Wed Sep 29 10:58:07 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (sort_by_i): internally used object must not be changed
	  outside.  [ruby-dev:24368]

Mon Sep 27 21:25:12 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_call0): invoke finalizers periodically.

	* gc.c (gc_sweep): defer running finalizers.  [ruby-dev:24354]

	* gc.c (rb_gc_finalize_deferred): run deferred finalizers.

Mon Sep 27 15:01:59 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: missing ';'.

Mon Sep 27 13:46:45 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h, struct.c (rb_struct_s_members, rb_struct_members): public
	  accessors.  [ruby-dev:24342]

	* marshal.c (w_object, r_object0): use accessors.

Mon Sep 27 09:14:03 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_delete): comparison may change the capacity.
	  [ruby-dev:24348]

	* array.c (rb_ary_fill): fill should honor length argument.
	  [ruby-dev:24346]

	* array.c (rb_ary_replace): should not use ptr from shared array.
	  [ruby-dev:24345]

	* ext/socket/socket.c (s_accept): don't retry for EWOULDBLOCK.
	  [ruby-talk:113807]

Sun Sep 26 08:05:10 2004  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: provides {Time,Date,DateTime}#to_{time,date,datetime}.

	* sample/cal.rb: uses getoptlong instead of getopts.

Sat Sep 25 18:39:22 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (flatten): element size might change during comparison.
	  [ruby-dev:24343]

Sat Sep 25 01:52:49 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_s_members): wrong call of struct_members.
	  [ruby-dev:24333]

Fri Sep 24 16:09:42 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): propagate DVAR_DONT_RECYCLE on termination
	  to avoid double call to rb_gc_force_recycle(). [ruby-dev:24311]

Fri Sep 24 08:29:45 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (rb_parser_append_print): should handle prelude.
	  [llama@u01.gate0]

	* parse.y (rb_parser_while_loop): ditto.

	* array.c (rb_ary_subseq): original object might be modified after
	  sharing data creation.  [ruby-dev:24327]

	* array.c (rb_ary_replace): ditto.

	* array.c (ary_make_shared): freeze shared array. [ruby-dev:24325]

	* struct.c (struct_members): always check struct size and size of
	  members list in the class.  [ruby-dev:24320]

Thu Sep 23 19:48:14 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/Makefile.dev: removed.

	* ext/ripper/ripper.rb.in: moved to lib/ripper/core.rb.in.

	* ext/ripper/lib/ripper/core.rb: new file.

	* ext/ripper/lib/ripper/core.rb.in: new file.

	* ext/ripper/tools/generate-ripper_rb.rb: change comment.

	* test/ripper/*.rb: on__scan event removed.

	* test/ripper/*.rb: event name is changed: on__XXX -> on_XXX.

Thu Sep 23 09:29:14 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_sub_bang): check if string is not modified
	  during iteration.  [ruby-dev:24315]

	* hash.c (rb_hash_rehash): replace st_foreach() by its deep
	  checking counterpart.  [ruby-dev:24310]

Wed Sep 22 14:21:54 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: on__scan event removed.

	* parse.y [ripper]: event name is changed: on__XXX -> on_XXX.

	* ext/ripper/eventids2.c: ditto.

	* ext/ripper/ripper.rb.in: ditto.

	* ext/ripper/lib/ripper.rb: sync with ripper.rb.in.

	* ext/ripper/lib/ripper/tokenizer: ditto.

	* ext/ripper/lib/ripper/filter: new file.

	* sample/ripper/colorize.rb: new file.

	* sample/ripper/strip-comment.rb: new file.

Wed Sep 22 13:50:49 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (hash_alloc): was using tbl pointer without
	  initialization.

Wed Sep 22 13:38:12 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_rehash): add iteration check.  [ruby-dev:24301]

	* st.c (st_foreach): add deep check.

	* hash.c (rb_hash_fetch): returns KeyError instead of IndexError.

	* hash.c (env_fetch): ditto.

Wed Sep 22 13:02:02 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_call_handler): workaround for Ctrl-C.

Wed Sep 22 09:04:41 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y: remove global variables ruby_eval_tree and
	  ruby_eval_tree_begin.

	* array.c (rb_ary_collect_bang): element size might change during
	  comparison.  [ruby-dev:24300]

	* array.c (rb_ary_reject_bang): ditto. [ruby-dev:24300]

	* array.c (rb_ary_eql): ditto. [ruby-dev:24300]

Wed Sep 22 00:11:12 2004  Dave Thomas  <dave@pragprog.com>

	* process.c: Add documentation for fork()

Tue Sep 21 18:29:49 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_uniq_bang): element size might change during
	  comparison.  [ruby-dev:24298]

Mon Sep 20 17:46:51 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/lib/ripper/tokenizer.rb: fix typo.

Mon Sep 20 17:38:43 2004  Minero Aoki  <aamine@loveruby.net>

	* test/ripper/test_scanner_events.rb: tokens must be reordered.

	* ext/ripper/lib/ripper/tokenizer.rb: ditto.

Mon Sep 20 16:58:16 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: do not delay dispatching.

	* ext/ripper/lib/ripper/tokenizer.rb: sort tokens by right order.

Mon Sep 20 15:17:47 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/lib/ripper/tokenizer.rb: new file.

Mon Sep 20 15:13:52 2004  Minero Aoki  <aamine@loveruby.net>

	* test/ripper/test_scanner_events.rb: test #lineno and #column.

Mon Sep 20 14:50:17 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: delayed heredocument events should be
	  dispatched after EOF.

Mon Sep 20 14:39:42 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: adjust lineno and columns for multi-line
	  strings.

	* parse.y [ripper]: delay heredocument events until seeing
	  end-of-line.

	* parse.y [ripper]: event on__heredoc_contentn ->
	  on__tstring_content.

	* ext/ripper/eventids2.c: ditto.

	* ext/ripper/lib/ripper.rb: sync with eventids2.c.

	* test/ripper/test_scanner_events.rb: test it.

	* ext/ripper/tools/generate-ripper_rb.rb: show basename of input.

	* ext/ripper/Makefile.dev: support objdir build.

Mon Sep 20 13:22:55 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: remove Ripper#pos.

	* parse.y [ripper]: Ripper#column should return the column of the
	  current token.

Mon Sep 20 12:02:41 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: unify old_lex_p and token_head.

	* test/ripper/test_scanner_events.rb: now \r\n is saved correctly.

	* parse.y: new macro lex_goto_eol() for next change.

Mon Sep 20 11:01:55 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: adjust line number for heredoc.  [ruby-dev:24272]

Mon Sep 20 04:49:22 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/ripper.rb.in: new const Ripper::PARSER_EVENT_TABLE.

	* ext/ripper/ripper.rb.in: new const Ripper::SCANNER_EVENT_TABLE.

	* ext/ripper/lib/ripper.rb: sync with ripper.rb.in.

Mon Sep 20 04:13:00 2004  Minero Aoki  <aamine@loveruby.net>

	* test/ripper/test_scanner_events.rb: test spaces before heredoc
	  mark.

Mon Sep 20 03:46:54 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: spaces before heredoc marker was lost.
	  [ruby-dev:24272]

	* keywords: rb_reserved_word() should be defined only in ruby
	  core.  [ruby-dev:24272]

	* lex.c: sync with keywords.

	* ext/ripper/ripper.rb.in (parse): fix typo.

	* ext/ripper/lib/ripper.rb: sync with ripper.rb.in.

Mon Sep 20 03:37:59 2004  Tanaka Akira  <akr@m17n.org>

	* ext/zlib/zlib.c (gzfile_read_raw): call readpartial at first.
	  (Zlib::GzipReader#readpartial): new method.

Mon Sep 20 00:24:19 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_sort_by): do not use qsort directly.  use
	  rb_ary_sort_bang() instead.  [ruby-dev:24291]

	* enum.c (enum_sort_by): pedantic type check added.
	  [ruby-dev:24291]

	* hash.c (rb_hash_foreach_iter): check iter_lev after each
	  iteration.  [ruby-dev:24289]

	* array.c (rb_ary_and): element size might change during
	  comparison.  [ruby-dev:24290]

	* array.c (rb_ary_or): ditto. [ruby-dev:24292]

	* array.c (rb_ary_equal): wrong fix. [ruby-dev:24286]

Sat Sep 18 15:02:22 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_equal): element size might change during
	  comparison.  [ruby-dev:24254]

	* array.c (rb_ary_diff): ditto. [ruby-dev:24274]

	* array.c (rb_ary_select): ditto. [ruby-dev:24278]

	* array.c (rb_ary_delete): ditto. [ruby-dev:24283]

	* array.c (rb_ary_rindex): ditto. [ruby-dev:24275]

	* array.c (rb_ary_initialize): element size might change during
	  initializing block.  [ruby-dev:24284]

Sat Sep 18 14:10:23 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_s_chdir): avoid memory leak and unnecessary chdir to
	  the original directory when exception has caused in changing
	  direcotry or within block.  thanks to Johan Holmberg
	  <holmberg@iar.se> [ruby-core:03446]

Fri Sep 17 20:29:33 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y: add prototypes for Microsoft compiler.

	* ext/ripper/depend (parse.obj): lex.c exists at hdrdir.

	* {bcc32,win32,wince}/Makefile.sub (YACC, YFLAGS, parse.c):
	  use bison.

Fri Sep 17 17:11:08 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_delete): element comparison might change array
	  size. [ruby-dev:24273]

	* parse.y: make ruby parser reentrant. merge ripper parser to the
	  real one.  this change makes ruby require bison.

	* file.c (rb_file_truncate): clear stdio buffer before truncating
	  the file.  [ruby-dev:24191]

	* ext/digest/digest.c: use rb_obj_class() instead of CLASS_OF
	  which might return singleton class.  [ruby-dev:24202]

Fri Sep 17 16:07:09 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: improve exit operation

Fri Sep 17 15:01:57 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: fix SEGV when (thread_)vwait or
	  (thread_)tkwait

	* ext/tk/lib/tk.rb: add alias wait_window to wait_destroy

	* ext/tk/lib/multi-tk.rb: support calling 'mainloop' on slave
	  interpreters (however, the 'real' eventloop must be run on the
	  Default Master IP)

	* ext/tk/lib/remote-tk.rb: follow the changes of ext/tk/lib/multi-tk.rb

	* ext/tk/sample/remote-ip_sample2.rb: ditto

	* ext/tk/sample/tkoptdb-safeTk.rb: ditto

Thu Sep 16 18:12:13 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI#start): should set REMOTE_USER
	  to request.user attribute.

	* lib/webrick/httpservlet/filehandler.rb
	  (WEBrick::HTTPServlet::FileHandler#initialize): should expand
	  the pathname of document root directory.

Thu Sep 16 15:49:28 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_intern): protect string argument from GC.
	  [ruby-core:03411]

Wed Sep 15 20:22:23 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tkoptdb-safeTk.rb: fix a bug depend on the changes
	  of MultiTkIp

Tue Sep 14 23:54:11 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: MultiTkIp#eval_string was en-bugged by
	  the previous changes.

Tue Sep 14 23:45:44 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_formatter.rb (RI::TextFormatter::TextFormatter.for):
	  Add Eric Hodel's simpleformatter.

Tue Sep 14 22:11:08 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: Add rdoc.

Tue Sep 14 20:24:49 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y [ripper]: space event is on__sp, not on__lwsp.
	  [ruby-dev:24257]

	* ext/ripper/eventids2.c: ditto.

	* ext/ripper/lib/ripper.rb: ditto.

	* ext/ripper/depend (ripper.o): No action is needed.
	  [ruby-dev:24260]

	* ext/ripper/depend: Borland make does not accept pipes in
	  Makefile rules. [ruby-dev:24589]

	* ext/ripper/depend: separate rules for developpers.

	* ext/ripper/Makefile.dev: new file.

	* ext/ripper/MANIFEST: add Makefile.dev.

	* ext/ripper/tools/generate-eventids1.rb: read from file, not
	  stdin.

	* ext/ripper/extconf.rb: clean ripper.E.

	* ext/ripper/tools/generate-ripper_rb.rb: #include ids1/ids2
	  function was lost.

	* ext/ripper/tools/generate-ripper_rb.rb: SCANNER_EVENTS wrongly
	  contained parser events.

	* ext/ripper/lib/ripper.rb: ditto.

Tue Sep 14 16:59:37 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: fix SEGV

	* ext/tk/lib/multi-tk.rb: improve safe-level handling of argument proc

	* ext/tk/sample/multi-ip_sample.rb: rename of old 'safe-tk.rb'

	* ext/tk/sample/safe-tk.rb: new sample script

Mon Sep 13 21:33:40 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509name.c (ossl_x509name_to_s): add optional
	  second argument to specify the output format (see also
	   X509_NAME_print_ex).

	* ext/openssl/ossl_x509name.c (ossl_x509name_init): new constants:
	  OpenSSL::X509::Name::COMPAT, OpenSSL::X509::Name::RFC2253,
	  OpenSSL::X509::ONELINE, OpenSSL::X509::MULTILINE.

	* ext/openssl/lib/openssl/x509.rb (OpenSSL::X509::Name::RFC2253DN):
	  new module to provide the parse for RFC2253 DN format.

	* ext/openssl/lib/openssl/x509.rb (OpenSSL::X509::Name.parse_rfc2253):
	  new method to parse RFC2253 DN format.

Mon Sep 13 19:16:33 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* eval.c (blk_copy_prev): need frame_dup().  [ruby-dev:24103]

Mon Sep 13 16:23:27 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: MultiTkIp.new_master and new_slave accept
	  safe-level value argument

Mon Sep 13 10:48:37 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getpid): don't need to use _getpid() on
	  mswin32 and mingw32.

Mon Sep 13 10:22:05 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* object.c (nil_inspect): fix typo.

Mon Sep 13 09:29:58 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/depend: (nmake hack) prepend "./" to ripper.c to
	  avoid {$(srcdir)}.

Mon Sep 13 06:43:42 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper/tools/list-parse-event-ids.rb: does not use getopts.

	* ext/ripper/tools/list-scan-event-ids.rb: ditto.

Mon Sep 13 02:42:28 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/Setup: add ripper.

	* ext/Setup.atheos: ditto.

	* ext/Setup.dj: ditto.

	* ext/Setup.emx: ditto.

	* ext/Setup.nt: ditto.

	* ext/Setup.x68: ditto.

Mon Sep 13 02:26:31 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/ripper: ripper extension added.

	* ext/ripper/MANIFEST: new file.

	* ext/ripper/README: new file.

	* ext/ripper/depend: new file.

	* ext/ripper/extconf.rb: new file.

	* ext/ripper/eventids2.c: new file.

	* ext/ripper/ripper.rb.in: new file.

	* ext/ripper/lib/ripper.rb: new file.

	* ext/ripper/test/check-event-arity.rb: new file.

	* ext/ripper/test/check-event-coverage.sh: new file.

	* ext/ripper/test/check-scanner-event-coverage.rb: new file.

	* ext/ripper/test/list-called-events.rb: new file.

	* ext/ripper/test/src_rb: new file.

	* ext/ripper/test/validate.rb: new file.

	* ext/ripper/tools/generate-eventids1.rb: new file.

	* ext/ripper/tools/generate-param-macros.rb: new file.

	* ext/ripper/tools/generate-ripper_rb.rb: new file.

	* ext/ripper/tools/list-parse-event-ids.rb: new file.

	* ext/ripper/tools/list-scan-event-ids.rb: new file.

	* ext/ripper/tools/preproc.rb: new file.

	* ext/ripper/tools/strip.rb: new file.

	* test/ripper: ripper tests added.

	* test/ripper/dummyparser.rb: new file.

	* test/ripper/test_parser_events.rb: new file.

	* test/ripper/test_scanner_events.rb: new file.

Mon Sep 13 01:03:02 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: improve control of preserv/release tcltkip

	* ext/tcltklib/tcltklib.c: store original 'exit' command

	* ext/tk/tkutil.c: fix(?) SEGV

Mon Sep 13 00:22:53 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y: fix file header.

Mon Sep 13 00:20:39 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y: ripper merged.

	* lex.c: ditto.

	* keywords: ditto.

Sun Sep 12 23:53:17 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* util.c (ruby_strdup): remove unnecessary code. (xmalloc never
	  returns NULL.)

	* util.c (ruby_getcwd): fix memory leak on failure.

Sun Sep 12 02:41:58 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: add TclTkIp#allow_ruby_exit? and
	  allow_ruby_exit=

	* ext/tk/lib/multi-tk.rb: ditto.

	* ext/tk/lib/remote-tk.rb: ditto.

	* ext/tcltklib/MANUAL.euc: ditto.

	* ext/tcltklib/MANUAL.eng: ditto.

	* ext/tcltklib/tcltklib.c: fix some reasons of SEGV

	* ext/tk/tkutil.c: ditto.

	* ext/tk/lib/multi-tk.rb: ditto.

	* ext/tk/lib/tk/timer.rb: ditto.

Sat Sep 11 16:09:46 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb: Fix up cross-file class merging.

Fri Sep 10 20:18:05 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tcltklib/tcltklib.c (lib_merge_tklist): fix suspicious
	  pointer conversion.

Fri Sep 10 19:16:24 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/Makefile.sub: bccwin32 port starts to use RTL dll.
	  (need to rebuild all) [ruby-dev:24138]

	* win32/win32.{h,c}: ditto.

Fri Sep 10 15:55:59 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mkdir_p): should pass mode argument to
	  Dir.mkdir. [ruby-dev:24242]

	* test/fileutils/test_fileutils.rb: test it.

Fri Sep 10 02:43:54 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/template/kilmer.rb: James Buck's
	  patch for call-seq.

Thu Sep  9 13:58:56 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (ip_init): change flag value for setting
	  'argv' and 'argv0' variable

	* ext/tk/lib/remote-tk.rb: follow changes of multi-tk.rb

Thu Sep  9 11:46:18 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::do_classes): Allow
	  spaces aroun parameter to define_method_under (James Buck)

Wed Sep  8 18:44:03 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_write): zero fill a gap if exsts.
	  [ruby-dev:24190]

Wed Sep  8 15:19:49 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (ip_init): cannot create a IP at level 4

	* ext/tk/lib/multi-tk.rb: improve 'exit' operation, security check,
	  and error treatment

	* ext/tk/lib/multi-tk.rb: allow a trusted slave IP to create slave IPs

	* ext/tk/lib/tk/listbox.rb: add TkListbox#value, value=, clear,	and
	  erase

	* ext/tk/lib/tk/text.rb: add TkText#clear and erase

Tue Sep  7 15:17:49 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (ruby_connect): break immediately if a
	  socket is non-blocking.  [ruby-talk:111654]

Tue Sep  7 12:48:22 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32,wince}/Makefile.sub (config.h): add fcntl.

	* win32/win32.[ch] (fcntl): ditto.

	* win32/win32.c (rb_w32_connect): support nonblocking mode.

	* ext/socket/socket.c (wait_connectable, ruby_connect): support
	  nonblocking connect on various platforms.

Mon Sep  6 11:00:47 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (dir_s_chdir): the patch to shut up false warning when
	  exception occurred within a block.  a patch was given from Johan
	  Holmberg <holmberg at iar.se>.  [ruby-core:03292]

Mon Sep  6 10:57:40 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/lib/tk/menu.rb(TkOptionMenubutton#insert): call correct method

Mon Sep  6 07:51:42 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (cvar_cbase): singletons should refer to outer cvar scope.
	  [ruby-dev:24223]

	* eval.c (rb_load): should preserve previous ruby_wrapper value.
	  [ruby-dev:24226]

Sat Sep  4 01:14:57 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (cvar_cbase): class variables cause SEGV in
	  instance_eval() for fixnums and symbols. [ruby-dev:24213]

Fri Sep  3 17:47:58 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (make_struct): remove redefining constant when
	  conflict.  [ruby-dev:24210]

Fri Sep  3 11:31:44 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: Tk.after makes TkCore::INTERP.tk_cmd_tbl grow
	  [ruby-dev:24207]

Fri Sep  3 02:12:48 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: fix typo [ruby-talk:111266]

	* ext/tk/lib/tk/text.rb: fix typo

	* ext/tk/lib/multi-tk.rb: improve safe-level treatment on slave IPs

Fri Sep  3 01:54:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): extact target prefix from Makefiles.

	* ext/extmk.rb: already built-in libraries satisfy dependencies.
	  [ruby-dev:24028]

Wed Sep  1 21:16:50 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/lib/tk/spinbox.rb: fix typo

Wed Sep  1 19:28:37 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_proc_exec): label cannot precede variable declarations.

Tue Aug 31 18:20:49 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/tk/tkutil.c (cbsubst_init): fix memory leak

	* ext/tk/tkutil.c (cbsubst_get_all_subst_keys): fix SEGV

Tue Aug 31 16:04:22 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (ip_delete): when a tcltkip is deleted,
	  destroy its root widget

Tue Aug 31 12:30:36 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (del_root): fix SEGV

Mon Aug 30 21:50:14 2004  Dave Thomas  <dave@pragprog.com>

	* object.c: Add RDoc for Module.included.

Mon Aug 30 23:11:06 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_driver.rb (and others): ri now merges documentation
	  if it finds the same class in multiple places.

Mon Aug 30 22:40:30 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: 'restart' method accepts arguments

Mon Aug 30 15:10:46 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (GNU/k*BSD): fixed FTBFS on GNU/k*BSD. [ruby-dev:24051]

Sun Aug 29 14:08:56 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: compile error on bcc32 [ruby-dev:24081]

	* ext/tk/lib/multi-tk.rb: MultiTkIp#eval_string does not work

Sat Aug 28 23:04:41 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_and): protect parameters from GC.
	  [ruby-talk:110664]

Fri Aug 27 12:13:50 2004  Tanaka Akira  <akr@m17n.org>

	* ext/stringio/stringio.c (Init_stringio): add StringIO#readpartial as
	  an alias for StringIO#sysread.

Fri Aug 27 10:14:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_proc_exec): strip trailing spaces.  [ruby-dev:24143]

	* win32/win32.c (CreateChild): ditto.

Thu Aug 26 04:38:29 2004  Dave Thomas  <dave@pragprog.com>

	* eval.c (return_jump): Minor typo in error message. Now reads
	  "return can't jump across threads".

Wed Aug 25 15:18:52 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_longjmp): Exception#to_str is no longer defined.

Wed Aug 25 11:39:10 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (exc_equal): exceptions are equal if they share same
	  class, message and backtrace. [ruby-talk:110354]

	* error.c (name_err_mesg_equal): ditto.

Tue Aug 24 16:41:48 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session::FileStore#initialize): do not
	  use a session id as a filename.

	* lib/cgi/session/pstore.rb (CGI::Session::PStore#initialize): ditto.

	* lib/cgi/session/pstore.rb (CGI::Session::PStore#initialize): use
	  Dir::tmpdir.

Tue Aug 24 14:32:17 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session::FileStore#initialize): untaint
	  session id after check.

Tue Aug 24 08:57:51 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509attr.c (ossl_x509attr_initialize): d2i
	  functions may replace the pointer indicated by the first argument.

	* ext/openssl/ossl_x509ext.c (ossl_x509ext_initialize): ditto.

	* ext/openssl/ossl_x509name.c (ossl_x509name_initialize): ditto.

Mon Aug 23 12:43:32 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/resolv.rb (Config.default_config_hash): when multiple domains
	  are set, Win32::Resolv.get_resolv_info returns Array.

Sun Aug 22 16:27:38 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_read):
	  - should return an empty string if specified length to read is 0.
	  - should check for pending data and wait for fd before reading.
	  - call underlying IO's sysread if SSL session is not started.
	  [ruby-dev:24072], [ruby-dev:24075]

	* ext/openssl/ossl_ssl.c (ossl_ssl_write):
	  - call underlying IO's syswrite if SSL session is not started.

	* ext/openssl/ossl_ssl.c (ossl_ssl_pending): new method
	  OpenSSL::SSL#pending.

	* ext/openssl/lib/openssl/buffering.rb: should not use select.

Sun Aug 22 01:10:36 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpproxy.rb (WEBrick::HTTPProxyServer#proxy_connect):
	  should call :ProxyContentHandler before finishing CONNECT.

Sat Aug 21 06:41:16 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tcltklib/extconf.rb (find_tcl, find_tk): find stub library.

	* lib/mkmf.rb (arg_config, with_config): deal with '-' and '_'
	  uniformly.  [ruby-dev:24118]

Fri Aug 20 14:49:42 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_check_writable): no need to check read buffer if
	  already changed to write mode.

Fri Aug 20 11:46:43 2004  UENO Katsuhiro  <katsu@blue.sky.or.jp>

	* ext/zlib/zlib.c: GzipReader#ungetc caused crc error.

Thu Aug 19 16:29:45 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: Fail to treat a hash value of 'font' option.

	* ext/tk/lib/tk.rb: bindinfo cannot return '%' substiturion information.

	* ext/tk/lib/menu.rb: typo bug.

Thu Aug 19 15:15:24 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c (free_dir): fix memory leak.  reported by yamamoto
	  madoka.

Thu Aug 19 09:19:27 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (LIBS): need to link shell32
	  library for SH* functions on mswin32 and mingw32.

	* wince/Makefile.sub (LIBS): need to link ceshell library for SH*
	  functions on mswince.

Thu Aug 19 03:07:00 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/baseemitter.rb: folding now handles double-quoted strings,
	  fixed problem with extra line feeds at end of folding, whitespace
	  opening scalar blocks.

	* lib/yaml/rubytypes.rb: subtelties in handling strings with
	  non-printable characters and odd whitespace patterns.

Wed Aug 18 23:44:20 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/protocol.rb (rbuf_fill): OpenSSL::SSLSocket has its own
	  buffer, select(2) might not work. [ruby-dev:24072]

Wed Aug 18 17:10:12 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/tcltklib/stubs.c (ruby_tcltk_stubs): need to call
	  Tcl_FindExecutable() for Tcl/Tk 8.4.

Wed Aug 18 12:52:55 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_obj_instance_eval): evaluates under special singleton
	  classes as for special constants.

Wed Aug 18 11:22:52 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (init_env): initialize HOME and USER environment
	  variables unless set.

Wed Aug 18 10:17:21 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (bind_eval): new method. [RCR 251]

	* string.c (rb_str_clear): new method. [ruby-dev:24104]

Tue Aug 17 17:20:59 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_reopen): should clear allocated OpenFile.  pointed
	  out by Guy Decoux. [ruby-core:03288]

Tue Aug 17 01:36:32 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/usage.rb: Remove extra indent. Tidy 'ri' option
	  parsing so RDoc::usage plays better with OptionParser.

Sat Aug 14 02:48:16 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/usage.rb: Added. Allows command line programs
	  to report usage using their initial RDoc comment.

Sat Aug 14 01:25:48 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/token.c: re2c no longer compiled with bit vectors.  caused
	  problems for non-ascii characters. [ruby-core:03280]
	* ext/syck/implicit.c: ditto.
	* ext/syck/bytecode.c: ditto.

Fri Aug 13 12:55:20 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils.parse_range_header):
	  fix regex for range-spec.

	* lib/webrick/httpservlet/filehandler.rb
	  (WEBrick::HTTPServlet::DefaultFileHandler#make_partial_content):
	  multipart/byteranges response was broken.

	* lib/xmlrpc/server.rb: refine example code.

Thu Aug 12 10:54:17 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* rubyio.h (rb_eof_error): should mark as NORETURN.

	* win32/win32.c (make_cmdvector): adjust escaped successive
	  double-quote handling.

Thu Aug 12 01:53:10 2004  Tanaka Akira  <akr@m17n.org>

	* io.c (read_buffered_data): extracted from rb_io_fread.
	  (io_readpartial): new method IO#readpartial.
	  [ruby-dev:24055]

Wed Aug 11 17:17:50 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (RPATHFLAG): stop setting RPATHFLAG on Interix.

Mon Aug  9 15:03:20 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservlet/erbhandler.rb
	  (WEBrick::HTTPServlet::ERBHandler#do_GET): should select media type
	  by suffix of script filename.

Mon Aug  9 12:51:43 2004  Dave Thomas  <dave@pragprog.com>

	* dir.c (dir_s_glob): Roll in Austin Ziegler's Dir.glob and
	  fnmatch updates.

Mon Aug  9 06:33:06 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (cp_r): copies symlink to symlink, except
	  root entries of cp_r.

	* lib/fileutils.rb: new method FileUtils.copy_entry.

	* test/fileutils/test_fileutils.rb: more cp_r tests.

Sun Aug  8 00:43:31 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/implicit.c: added sexagecimal float#base60.

	* ext/syck/rubyext.c (yaml_org_handler): ditto.

	* lib/token.c: indentation absolutely ignored when processing flow
	  collections.  plain scalars are trimmed if indentation follows in
	  an ambiguous flow collection.

Sat Aug  7 03:08:21 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (proc_daemon): new method.  should be modified for
	  platforms without /dev/null.

Sat Aug  7 00:50:01 2004  Tanaka Akira  <akr@m17n.org>

	* ext/zlib/zlib.c: Zlib::GzipReader#read(0) returns "" instead of nil.

Wed Aug  4 13:26:00 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_bytes0): optimize out read(0). [ruby-talk:108276]

Tue Aug  3 13:49:12 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/namespace.rb: bug fix

	* ext/tk/lib/tkextlib/treectrl/tktreectrl.rb: add Tk::TreeCtrl.loupe

Mon Aug  2 23:33:48 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_file.rb (test_fnmatch): added more tests.

Mon Aug  2 18:04:21 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/msgcat.rb (set_translation): bug fix (fail to set
	  trans_str to the same as src_str when trans_str is not given.)

Mon Aug  2 17:40:44 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (blk_free): fixed serious memory leak. [ruby-dev:24013]

Mon Aug  2 11:53:06 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/code_objects.rb (RDoc::Context::find_symbol): Fix infinite recursion
	  looking up some top level symbols (batsman)

Mon Aug  2 11:48:29 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::do_methods): Allow '.'s in
	  variable names to support SWIG generated files (Hans Fugal)

Sat Jul 31 23:08:00 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (is_defined): stupid mistakes fixed. [ruby-dev:24006]

Sat Jul 31 17:39:47 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg, ruby-parse-partial,
	  ruby-calculate-indent, ruby-move-to-block, ruby-forward-sexp,
	  ruby-backward-sexp): keywords must match word-wise.

Sat Jul 31 13:37:51 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (is_defined): avoid unnecessary method invocations.

Sat Jul 31 05:35:37 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/rubytypes.rb: exceptions were using an older
	  YAML.object_maker. [ruby-core:03080]

	* ext/syck/token.c (sycklex_yaml_utf8): using newline_len to
	  handline CR-LFs.  "\000" was showing up on folded blocks which
	  stopped at EOF.

Sat Jul 31 01:25:11 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (is_defined): call is_defined() before invoking
	  rb_eval().  [ruby-talk:107867]

Fri Jul 30 16:10:54 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (lib_fromUTF8_core): raise ArgumentError when
	  the unknown encoding name is given.

	* ext/tcltklib/tcltklib.c (lib_toUTF8_core): ditto.

	* ext/tk/lib/tk.rb (Tk::Encoding.encoding_convertfrom): bug fix.

	* ext/tk/lib/tk.rb (Tk::Encoding.encoding_convertto): ditto.

Wed Jul 28 18:59:17 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::initialize): remove at_exit code for CGI_PARAMS
	  and CGI_COOKIES.  they will no longer be used.

Wed Jul 28 15:44:08 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): should call rb_call_super() directly for
	  visibility overriding.  [ruby-dev:23989]

Wed Jul 28 01:04:44 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* env.h: remove argv from ruby_frame.

	* eval.c (rb_eval): no more copy on write.

	* eval.c (assign): ditto.

	* eval.c (rb_call0): can receive *rest by specifying negative
	  argc.  (-1 means 0 arg and *rest, -2 means 1 arg and *rest...)

	* eval.c (rb_call0): properly set frame's argc counter.

	* gc.c (rb_gc_mark_frame): need not to mark frame's argv

	* gc.c (run_final): wrong order of data. [ruby-dev:23984]

Tue Jul 27 07:05:04 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): copy on write for argument local variable
	  assignment.

	* eval.c (assign): ditto.

	* eval.c (rb_call0): update ruby_frame->argv with the default
	  value used for the optional arguments.

	* object.c (Init_Object): "===" calls rb_obj_equal() directly.
	  [ruby-list:39937]

Mon Jul 26 11:22:55 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils.escape): should
	  escape space.

Sun Jul 25 10:56:28 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* win32/win32.{h,c} (rb_w32_{f,fd,fs}open): workaround for bcc32's
	  {f,fd,fs}open bug. set errno EMFILE and EBADF. [ruby-dev:23963]

	* test/drb/drbtest.rb: fix method duplication.

Sat Jul 24 13:32:47 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (rb_range_beg_len): returns Qnil only when "beg" points
	  outside of a range.  No boundary check for "end".

Fri Jul 23 16:40:25 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (define_final): should not disclose NODE* to Ruby world.
	  [ruby-dev:23957]

Fri Jul 23 08:52:22 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (disconnected?): new method.

Thu Jul 22 16:41:54 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi/session.rb (CGI::Session::FileStore#update): sets the
	  permission of the session data file to 0600.

	* lib/cgi/session/pstore.rb (CGI::Session::Pstore#initialize):
	  ditto.

Mon Jul 19 00:53:46 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservlet/cgihandler.rb
	  (WEBrick::HTTPServlet::CGIhandler#do_GET): set SystemRoot environment
	  variable to CGI process on Windows native platforms. [ruby-dev:23936]

Sun Jul 18 16:14:29 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/msgcat.rb (TkMsgCatalog.callback): bug fix
	  ( wrong number of argument )

Sun Jul 18 08:13:58 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): remove extra sign digit.

Sun Jul 18 03:19:14 2004  Akinori MUSHA  <knu@iDaemons.org>

	* dir.c (bracket): use NULL instead of 0.

Sun Jul 18 02:35:30 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (receive_responses): return if a LOGOUT response
	  received.

Sat Jul 17 23:59:01 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (send_string_data): wait command continuation
	  requests before sending octet data of literals.

Sat Jul 17 23:54:59 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/variable.rb: TkVariable#ref returns a TkVariable object

Sat Jul 17 22:04:44 2004  akira yamada  <akira@ruby-lang.org>

	* lib/uri/ldap.rb: method hierarchical? should be in URI::LDAP.

Sat Jul 17 18:29:07 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): not to show same error messages twice.

Sat Jul 17 14:18:11 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_match_m): String#match should also take
	  optional argument.  [ruby-core:03205]

	* re.c (rb_reg_match_m): add optional second argugment "pos" to
	  specify match start point.  [ruby-core:03203]

Sat Jul 17 13:13:32 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex::identify_string): %s string do not
	  process expression interpolation.  [ruby-talk:106691]

Sat Jul 17 05:26:27 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/diagram.rb: Incorporate Micheal Neumann's
	  client-side imagemao patch

Sat Jul 17 01:57:03 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (THREAD_ALLOC): th->thread should be initialized to NULL.
	  [ruby-talk:106657]  The solution was found by Guy Decoux.

Fri Jul 16 22:30:28 2004  Michael Neumann  <mneumann@ntecs.de>

	* file.c (rb_stat_dev_major): new methods File::Stat#dev_major and
	  #dev_minor. [ruby-core:03195]

Fri Jul 16 11:17:38 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (exit_initialize): use EXIT_SUCCESS instead of 0.
	  [ruby-dev:23913]

	* error.c (exit_success_p): new method SystemExit#success?.
	  [ruby-dev:23912]

	* error.c (syserr_initialize): initialization for subclasses.
	  [ruby-dev:23912]

Thu Jul 15 23:53:38 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#warn, OptionParser#abort): Exception
	  no longer has to_str method.

Thu Jul 15 22:59:48 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/readline/extconf.rb: added dir_config for curses, ncurses,
	  termcap.

Thu Jul 15 20:44:46 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* class.c: rdoc patch

Thu Jul 15 14:12:34 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml.rb (YAML::load_file, YAML::parse_file): added.

	* ext/syck/token.c: re2c compiled with bit vectors now.
	* ext/syck/implicit.c: ditto.
	* ext/syck/bytecode.c: ditto.

Thu Jul 15 10:15:04 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/, ext/tcltklib/: bug fix

	* ext/tk/lib/tk.rb: better operation for SIGINT when processing
	  callbacks.
	* ext/tk/lib/tk/msgcat.rb: ditto.
	* ext/tk/lib/tk/variable.rb: ditto.
	* ext/tk/lib/tk/timer.rb: ditto.

	* ext/tk/lib/tk/validation.rb: add Tk::ValidateConfigure.__def_validcmd
	  to define validatecommand methods easier

	* ext/tk/lib/tk.rb (_genobj_for_tkwidget): support autoload Tk ext
	  classes

	* ext/tk/lib/tk/canvas.rb and so on: remove the parent widget type
	  check for items (e.g. canvas items; depends on the class) to
	  avoid some troubles on Tk extension widget class definition.

	* ext/tk/lib/tkextlib/: add Iwidget and TkTable extension support

	* ext/tk/sample/tkextlib/: add samples of Iwidget and TkTable

Wed Jul 14 23:49:30 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_min_by): new method Enum#min_by.  added Enum#max_by
	  as well.

Wed Jul 14 18:05:21 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1cons_to_der): fix type of
	  argument. [ruby-dev:23891]

	* test/openssl/test_x509store.rb: prune tests for CRL checking
	  unless X509::V_FLAG_CRL_CHECK is defined.

Wed Jul 14 12:20:05 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* util.c (ruby_strtod): should not convert string in the form of
	  "-I.FE-X" which both "I" and "F" are omitted. [ruby-dev:23883]

	* test/ruby/test_float.rb (test_strtod): add test for bug fix.

Wed Jul 14 00:33:48 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* array.c: rdoc patch. merged patch from Johan Holmberg
	  <holmberg@iar.se> [ruby-core:3170]

Tue Jul 13 19:39:12 2004  akira yamada  <akira@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic#merge_path):
	  "URI('http://www.example.com/foo/..') + './'" should return
	  "URI('http://www.example.com/')".  [ruby-list:39838]
	  "URI('http://www.example.com/') + './foo/bar/..'" should return
	  "URI('http://www.example.com/foo/')".  [ruby-list:39844]

	* test/uri/test_generic.rb (TestGeneric#test_merge): added tests.

Tue Jul 13 15:48:56 2004  Akinori MUSHA  <knu@iDaemons.org>

	* lib/mkmf.rb (init_mkmf): Do not add $(libdir) to $LIBPATH in
	   extmk mode.

	* lib/mkmf.rb (dir_config): Prepend a new library path instead of
	  appending so it is tried first.

Tue Jul 13 00:50:48 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb: Support call-seq: for Ruby files.

Mon Jul 12 21:20:51 2004  Dave Thomas  <dave@pragprog.com>

	* html_generator.rb: Support hyperlinks of the form {any text}[xxx]
	  as well as stuff[xxx]

Sat Jul 10 09:30:24 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/marshal/test_struct.rb: use qualified built-in class name
	  (::Struct) to avoid name crash.

Sat Jul 10 04:21:56 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: better operation for SIGINT when processing
	  callbacks.
	* ext/tk/lib/tk/msgcat.rb: ditto.
	* ext/tk/lib/tk/variable.rb: ditto.
	* ext/tk/lib/tk/timer.rb: ditto.

	* ext/tk/lib/tk/validation.rb (__def_validcmd):  add a module
	  function of Tk::ValidateConfigure to define validatecommand
	  methods easier

Fri Jul  9 22:18:59 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* array.c, enum.c, pack.c: rdoc patch from Johan Holmberg
	  <holmberg@iar.se> [ruby-core:3132] [ruby-core:3136]

	* numeric.c: rdoc patch.

Fri Jul  9 19:26:39 2004  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::HTTPS#proxy_open): raise ArgumentError to
	  notice https is not supported.

Fri Jul  9 14:28:54 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_raise): accept third argument as well as
	  Kernel#raise, and evaluate the arguments to create an exception in
	  the caller's context.  [ruby-talk:105507]

Fri Jul  9 01:47:08 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib: bug fix
	* ext/tk/lib/tkextlib/itcl: add [incr Tcl] support
	* ext/tk/lib/tkextlib/itk: add [incr Tk] support
	* ext/tk/lib/tkextlib/iwidgets: midway point of [incr Widgets] support
	* ext/tk/sample/tkextlib/iwidgets: very simple examples of
	  [incr Widgets]

Thu Jul  8 19:27:16 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_stack_end_address): detect stack end address
	  variable supplied by system.  [ruby-core:03115]

	* gc.c (Init_stack): use system provided address if possible.

Thu Jul  8 00:05:23 2004  akira yamada  <akira@ruby-lang.org>

	* lib/tempfile.rb (Tempfile::initialize): got out code of
	  generating tmpname.  [ruby-dev:23832][ruby-dev:23837]

Wed Jul  7 02:31:41 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/{rss,parser,0.9,1.0,2.0}.rb: supported RSS 0.9x/2.0
	  validation and validation which disregard order of elements.
	* test/rss/test_parser.rb: added tests for RSS 0.9x/2.0
	  validation.
	* test/rss/{test_trackback,rss-testcase}.rb: fixed no good method
	  name.

Wed Jul  7 00:48:34 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/tk/lib/tkextlib/tktrans.rb,
	  ext/tk/lib/tkextlib/treectrl.rb: fix syntax errors.

Tue Jul  6 18:38:45 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib: improve framework of developping Tcl/Tk extension
	  wrappers

Mon Jul  5 23:56:42 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/{trackback,syndication,dublincore,content}.rb: worked
	  with ruby 1.6 again.

	* test/rss/rss-assertions.rb: ditto.

Mon Jul  5 22:54:39 2004  Tanaka Akira  <akr@m17n.org>

	* lib/uri/common.rb (Kernel#URI): new global method for parsing URIs.

Mon Jul  5 09:02:52 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_yield, rb_f_catch): 4th argument to rb_yield_0()
	  is a set of bit flags.  [ruby-dev:23859]

Mon Jul  5 01:20:17 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* lib/drb/drb.rb(DRbConn self.open): If socket pool is full, close
	  the socket whose last-access-time is oldest. (and add new one)
	  [ruby-dev:23860]

Sun Jul  4 12:24:50 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/rss.rb: added copyright header.

Sat Jul  3 22:25:27 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* added files:
	  * lib/soap/header/*
	  * lib/soap/rpc/httpserver.rb
	  * lib/wsdl/soap/cgiStubCreator.rb
	  * lib/wsdl/soap/classDefCreator.rb
	  * lib/wsdl/soap/classDefCreatorSupport.rb
	  * lib/wsdl/soap/clientSkeltonCreator.rb
	  * lib/wsdl/soap/driverCreator.rb
	  * lib/wsdl/soap/mappingRegistryCreator.rb
	  * lib/wsdl/soap/methodDefCreator.rb
	  * lib/wsdl/soap/servantSkeltonCreator.rb
	  * lib/wsdl/soap/standaloneServerStubCreator.rb
	  * lib/wsdl/xmlSchema/enumeration.rb
	  * lib/wsdl/xmlSchema/simpleRestriction.rb
	  * lib/wsdl/xmlSchema/simpleType.rb
	  * lib/xsd/codegen/*
	  * lib/xsd/codegen.rb
	  * sample/soap/authheader/*
	  * sample/soap/raa2.4/*
	  * sample/soap/ssl/*
	  * sample/soap/swa/*
	  * sample/soap/whois.rb
	  * sample/wsdl/raa2.4/*
	  * test/soap/header/*
	  * test/soap/ssl/*
	  * test/soap/struct/*
	  * test/soap/swa/*
	  * test/soap/wsdlDriver/*
	  * test/wsdl/multiplefault.wsdl
	  * test/wsdl/simpletype/*
	  * test/wsdl/test_multiplefault.rb

	* modified files:
	  * lib/soap/baseData.rb
	  * lib/soap/element.rb
	  * lib/soap/generator.rb
	  * lib/soap/netHttpClient.rb
	  * lib/soap/parser.rb
	  * lib/soap/property.rb
	  * lib/soap/soap.rb
	  * lib/soap/streamHandler.rb
	  * lib/soap/wsdlDriver.rb
	  * lib/soap/encodingstyle/handler.rb
	  * lib/soap/encodingstyle/literalHandler.rb
	  * lib/soap/encodingstyle/soapHandler.rb
	  * lib/soap/mapping/factory.rb
	  * lib/soap/mapping/mapping.rb
	  * lib/soap/mapping/registry.rb
	  * lib/soap/mapping/rubytypeFactory.rb
	  * lib/soap/mapping/wsdlRegistry.rb
	  * lib/soap/rpc/cgistub.rb
	  * lib/soap/rpc/driver.rb
	  * lib/soap/rpc/proxy.rb
	  * lib/soap/rpc/router.rb
	  * lib/soap/rpc/soaplet.rb
	  * lib/soap/rpc/standaloneServer.rb
	  * lib/wsdl/data.rb
	  * lib/wsdl/definitions.rb
	  * lib/wsdl/operation.rb
	  * lib/wsdl/parser.rb
	  * lib/wsdl/soap/definitions.rb
	  * lib/wsdl/xmlSchema/complexContent.rb
	  * lib/wsdl/xmlSchema/complexType.rb
	  * lib/wsdl/xmlSchema/data.rb
	  * lib/wsdl/xmlSchema/parser.rb
	  * lib/wsdl/xmlSchema/schema.rb
	  * lib/xsd/datatypes.rb
	  * lib/xsd/qname.rb
	  * sample/soap/sampleStruct/server.rb
	  * sample/wsdl/amazon/AmazonSearch.rb
	  * sample/wsdl/amazon/AmazonSearchDriver.rb
	  * test/soap/test_property.rb
	  * test/soap/calc/test_calc_cgi.rb
	  * test/wsdl/test_emptycomplextype.rb

	* summary
	  * add SOAP Header mustUnderstand support.

	  * add HTTP client SSL configuration and Cookies support (works
	    completely with http-access2).

	  * add header handler for handling sending/receiving SOAP Header.

	  * map Ruby's anonymous Struct to common SOAP Struct in SOAP Object
	    Model.  it caused error.

	  * add WSDL simpleType support to restrict lexical value space.

Sat Jul  3 17:19:44 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/tk/lib/tkextlib/tkDND.rb: fix syntax error.

Thu Jul  1 18:36:08 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tcltklib: bug fix

	* ext/tk/lib/tk: bug fix and add Tcl/Tk extension support libraries

Thu Jul  1 18:31:31 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pstore.rb (PStore#transaction): get rid of opening in write mode
	  when read only transaction.  [ruby-dev:23842]

Thu Jul  1 00:44:42 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_encrypt, ossl_cipher_decrypt):
	  re-implemnt (the arguments for this method is ).

	* ext/openssl/ossl_cipher.c (ossl_cipher_pkcs5_keyivgen): new method
	  OpenSSL::Cipher::Cipher#pkcs5_keyivgen. it calls EVP_BytesToKey().

	* ext/openssl/ossl_cipher.c (ossl_cipher_set_key_length): new method
	  OpenSSL::Cipher::Cipher#key_len=.

Wed Jun 30 19:48:09 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: check for EVP_CIPHER_CTX_copy, ENGINE_add,
	  EVP_CIPHER_CTX_set_padding, EVP_CipherFinal_ex, EVP_CipherInit_ex,
	  EVP_DigestFinal_ex and EVP_DigestInit_ex.

	* ext/openssl/openssl_missing.c (EVP_CIPHER_CTX_copy): new function.

	* ext/openssl/openssl_missing.h (EVP_DigestInit_ex, EVP_DigestFinal_ex,
	  EVP_CipherInit_ex, EVP_CipherFinal_ex, HMAC_Init_ex): new macro for
	  OpenSSL 0.9.6.

	* ext/openssl/ossl_cipher.c (ossl_cipher_alloc, ossl_cipher_initialize,
	  ossl_cipher_copy, ossl_cipher_reset, ossl_cipher_encrypt,
	  ossl_cipher_decrypt, ossl_cipher_final, ossl_cipher_set_key,
	  ossl_cipher_set_iv): replace all EVP_CipherInit and
	  EVP_CipherFinal into EVP_CipherInit_ex and EVP_CipherFinal_ex.
	  and EVP_CIPHER_CTX_init should only be called once.

	* ext/openssl/ossl_cipher.c (ossl_cipher_set_padding): check for
	  EVP_CIPHER_CTX_set_padding.

	* ext/openssl/ossl_cipher.c (Init_ossl_cipher): Cipher#<< is deprecated.

	* ext/openssl/ossl_digest.c: replace all EVP_DigestInit and
	  EVP_DigestFinal into EVP_DigestInit_ex and EVP_DigestFinal_ex.
	  and EVP_MD_CTX_init should only be called once.

	* ext/openssl/ossl_digest.c (digest_final): should call
	  EVP_MD_CTX_cleanup to avoid memory leak.

	* ext/openssl/ossl_hmac.c (ossl_hmac_initialize): repalce HMAC_init
	  into HMAC_init_ex. and HMAC_CTX_init is moved to ossl_hmac_alloc.

	* ext/openssl/ossl_hmac.c (hmac_final): should call
	  HMAC_CTX_cleanup to avoid memory leak.

	* test/openssl/test_cipher.rb, test/openssl/test_digest.rb,
	  test/openssl/test_hmac.rb: new file.

Wed Jun 30 16:59:39 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_file.rb (test_fnmatch): some tests for File.fnmatch
	  are added.

Wed Jun 30 11:38:51 2004  Mikael Brockman  <phubuh@phubuh.org>

	* parse.y (primary): should not be NULL.  [ruby-core:03098]

Wed Jun 30 02:41:10 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c (syck_emitter_new): set buffer after
	  Data_Wrap_Struct to avoid possible GC. [ruby-talk:104835]

Tue Jun 29 10:31:19 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval_cmd, rb_thread_trap_eval): restore safe level.

	* gc.c (define_final, run_final): preserve and restore safe level for
	  finalizers.  [ruby-core:03058]

	* signal.c (signal_exec, rb_trap_exit, trap): preserve and restore
	  safe level for signal handlers.  [ruby-dev:23829]

Mon Jun 28 14:57:56 2004  Jeff Mitchell  <quixoticsycophant@yahoo.com>

	* configure.in, lib/mkmf.rb (LIBPATHFLAG): use double quotes due to
	  DOSISH compilers.  [ruby-core:03107]

Mon Jun 28 00:35:29 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* sample/drb/*.rb: using 'DRb.thread.join' instead of 'gets'

Sun Jun 27 22:36:47 2004  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/tdiary_plugin/rss-recent.rb: supported Hiki.

Sat Jun 26 15:17:11 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_mod_class_variables): class variables are no longer
	  inherited.  [ruby-dev:23808]

Sat Jun 26 11:07:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (aix): -b must come at the start of the command line,
	  and -e must not appear while testing libraries.  [ruby-talk:104501]

	* lib/mkmf.rb (find_header, dir_config): quote directory names if
	  necessary.  [ruby-talk:104505]

Sat Jun 26 00:13:08 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_fopen, rb_fdopen, rb_io_reopen): setvbuf() may return
	  positive value on failure.  [ruby-dev:23792]

Fri Jun 25 18:07:15 2004  Michal Rokos  <michal@ruby-lang.org>

	* gc.c: bring back _stklen for DJGPP [ruby-core:3084]

Fri Jun 25 15:33:01 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/extconf.rb: check stricter.  [ruby-talk:104501]

Fri Jun 25 01:58:01 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* {bcc32,win32,wince}/setup.mak: remove RUBY_EXTERN lines when
	  including version.h. [ruby-talk:104456]

Thu Jun 24 14:23:29 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_fread): return already read data when system call is
	  interrupted.  [ruby-talk:97206]

Thu Jun 24 01:25:21 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* version.h: added declarations of ruby_version,
	  ruby_release_date, ruby_platform.

Thu Jun 24 01:07:15 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_sockaddr): Socket#gethostbyname()
	  should give us packed address, not struct sockaddr.
	  [ruby-core:03053]

Wed Jun 23 22:19:10 2004  Dave Thomas  <dave@pragprog.com>

	* ext/socket/socket.c (sock_s_gethostbyaddr): Work around problem
	  with OS X not returning 'from' parameter to recvfrom for
	  connection-oriented sockets.

Wed Jun 23 22:16:16 2004  Michal Rokos  <michal@ruby-lang.org>

	* io.c: io_seek()'s retval should be checked [ruby-core:03045]

Wed Jun 23 21:48:27 2004  Michal Rokos  <michal@ruby-lang.org>

	* time.c: Fix indentation.

	* main.c: Remove _stklen, and _CRT_glob. Move _stacksize for
	  __human68k__ to gc.c where the others are.

	* gc.c: put _stacksize in place and clean the #ifdefs macros.

Wed Jun 23 17:37:54 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: added new option --ssl.

Wed Jun 23 01:45:27 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RubyLex::identify_quotation):
	  Fix problem with the 'r' being dropped from %r{xxx}

Wed Jun 23 00:10:17 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ext/win32ole/win32ole.c (ole_hresult2msg): remove trailing
	  CRs and LFs. (doesn't depend on CR+LF) [ruby-dev:23749]

Wed Jun 23 00:00:25 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (return_jump, break_jump): raise unexpected local jump
	  exception directly.  [ruby-dev:23740]

	* io.c (rb_io_initialize): should check fcntl result.  [ruby-dev:23742]

Tue Jun 22 23:35:43 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): support FZERO and FSPACE with NaN/Inf.

	* test/ruby/test_sprintf.rb (test_nan, test_inf): add tests.

Tue Jun 22 21:11:36 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (OLE_FREE): should not call CoFreeUnuse-
	  dLibraries().

	* ext/win32ole/win32ole.c (ole_event_free): ditto.

	* ext/win32ole/win32ole.c (ole_hresult2msg): truncate error message
	  before CR.

Tue Jun 22 19:24:59 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): unify output of NaN, Inf and -Inf with
	  "%f" or etc on all platform. [ruby-dev:23704], [ruby-dev:23747]

Tue Jun 22 15:28:12 2004  Michal Rokos  <michal@ruby-lang.org>

	* compar.c: Remove explicit NIL_P() checks since rb_cmpint() does it
	  again in the exactly same manner.

Tue Jun 22 01:32:40 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_pkey_dh.c (ossl_dh_initialize): should create
	  empty pkey object if no argument is passed. [ruby-talk:103328]

	* ext/openssl/ossl_pkey_dsa.c (ossl_dsa_initialize): ditto.

	* ext/openssl/ossl_pkey_rsa.c (ossl_rsa_initialize): ditto.

	* ext/openssl/ossl_pkey_dh.c: add new methods: OpenSSL::PKey::DH#p,
	  OpenSSL::PKey::DH#p=, OpenSSL::PKey::DH#g, OpenSSL::PKey::DH#g=,
	  OpenSSL::PKey::DH#pub_key, OpenSSL::PKey::DH#pub_key=,
	  OpenSSL::PKey::DH#priv_key and OpenSSL::PKey::DH#priv_key=.

	* ext/openssl/ossl_pkey_dsa.c: add new methods: OpenSSL::PKey::DSA#p,
	  OpenSSL::PKey::DSA#p=, OpenSSL::PKey::DSA#q, OpenSSL::PKey::DSA#q=,
	  OpenSSL::PKey::DSA#g, OpenSSL::PKey::DSA#g=,
	  OpenSSL::PKey::DSA#pub_key, OpenSSL::PKey::DSA#pub_key=,
	  OpenSSL::PKey::DSA#priv_key and OpenSSL::PKey::DSA#priv_key=.

Mon Jun 21 09:24:51 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_opendir): should set errno if error occurs
	  when calling OS API.

Sun Jun 20 21:12:54 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (binary=): send TYPE commands only once.

Sat Jun 19 13:27:01 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (method_call): allow changing $SAFE.  [ruby-dev:23713]

	* eval.c (proc_set_safe_level, proc_invoke, rb_mod_define_method): not
	  set $SAFE for methods defined from Proc.  [ruby-dev:23697]

Sat Jun 19 01:10:12 2004  Kouhei Sutou  <kou@cozmixng.org>

	* sample/rss/tdiary_plugin/rss-recent.rb: added more information.

Fri Jun 18 23:12:22 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (proc_save_safe_level, rb_set_safe_level, safe_setter): limit
	  safe level.

Wed Jun 16 23:05:57 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_mod_freeze): prepare string representation before
	  freezing. [ruby-talk:103646]

Wed Jun 16 19:57:24 2004  Michal Rokos  <michal@ruby-lang.org>

	* test/ruby/test_array.rb: extend testcase to check #first, #last,
	  #shift, #unshift, #pop, #push

Wed Jun 16 16:05:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_new): move alloc behind checks.  [ruby-core:02982]

	* array.c (rb_ary_pop_m, rb_ary_shift_m): take arg to behave as push
	  and unshift.

	* array.c (rb_ary_first, rb_ary_last): make shared array for result
	  array, and correct doc for Array#first(n) and Array#last(n)

	* array.c (rb_ary_select): not accept any arg.

Wed Jun 16 16:03:59 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_class_inherited_p): singleton class inherits Class
	  rather than its object's class.  [ruby-dev:23690]

Wed Jun 16 16:01:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (stack_grow_direction): memoize the direction.

	* gc.c (Init_stack): should always move to end of VALUE.

Tue Jun 15 12:10:04 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: bug fix (TkWindow#grab)

Mon Jun 14 18:23:27 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/remote-tk.rb: bug fix

Sun Jun 13 00:23:04 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/extconf.rb: [EXPERIMENTAL] MacOS X (darwin) support

	* ext/tcltklib/tcltklib.c: fix thread trouble on callback proc, and
	  eliminate warning about instance variable access

	* ext/tk/lib/tk/menubar.rb: improve supported menu_spec

	* ext/tk/lib/tk/menuspec.rb: [add] menu_spec support library

	* ext/tk/lib/tk/root.rb: add menu_spec support

	* ext/tk/lib/tk/text.rb: bug fix

	* ext/tk/lib/tk/toplevel.rb: add menu_spec support

	* ext/tk/sample/menubar?.rb: [add] sample of menu_spec usage

Sat Jun 12 14:15:20 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c: RDOC for File::FNM_CASEFOLD was missed.

Sat Jun 12 11:15:53 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (target_os): strip -gnu suffix on Linux.

Fri Jun 11 22:08:50 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c: remove #indexes, #indices.

	* hash.c: ditto.

	* ext/dbm/dbm.c: remove #indexes, #indices, "values_at" warning
	  from #select.

	* ext/gdbm/gdbm.c: ditto.

	* ext/sdbm/init.c: ditto.

	* ext/dbm/dbm.c (Init_dbm): set VERSION constant as "unknown" when
	  DB_VERSION_STRING is not available.

Thu Jun 10 19:19:41 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/sdbm/init.c (fsdbm_store): sdbm should use StringValue().
	  [ruby-talk:103062]

Wed Jun  9 16:09:01 2004  akira yamada  <akira@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic::merge,
	  URI::Generic::route_from): accepts non-hierarchical URI.
	  [ruby-dev:23631]

	* test/uri/test_generic.rb (TestGeneric::test_route,
	  TestGeneric::test_merge): added tests for above changes.

Wed Jun  9 15:39:55 2004  Akinori MUSHA  <knu@iDaemons.org>

	* configure.in: Add support for DragonFly BSD.

Wed Jun  9 15:07:06 2004  Akinori MUSHA  <knu@iDaemons.org>

	* config.guess, config.sub: Update to a more recent version as of
	  2004-01-20.

Wed Jun  9 11:20:05 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c: remove unused functions and variables.

Wed Jun  2 20:16:03 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_new4): should share shared instance if it already
	  exists.  [ruby-dev:23665]

Wed Jun  2 12:41:53 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_gets_m): set lastline ($_) even when read line is
	  nil.  [ruby-dev:23663]

Fri May 28 11:20:31 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): bad influence on frame node.

	* eval.c (eval): reverted wrongly removed condition.  [ruby-dev:23638]

Thu May 27 21:37:50 2004  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#initialize): fix pathname initialization
	  by pathname.

Thu May 27 20:02:09 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* io.c (rb_io_fwrite): check all case errno != 0 [ruby-dev:23648]

Thu May 27 15:54:02 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/ftp.rb (MDTM_REGEXP): fix for demon's ftp server.
	  Thanks, Rutger Nijlunsing.

Thu May 27 14:53:13 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* io.c (rb_io_fwrite): workaround for bcc32's fwrite bug.
	  add errno checking.  [ruby-dev:23627]

	* io.c (rb_io_fwrite): should check if errno == ENOENT, too.

Thu May 27 11:25:03 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/csv/test_csv.rb: illegal require module name (../lib/csv.rb).

Wed May 26 23:12:13 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb (CSV.read, CSV.readlines): added.  works as IO.read and
	  IO.readlines in CSV format.

	* lib/csv.rb (CSV.parse): [CAUTION] behavior changed.  in the past,
	  CSV.parse accepts a filename to be read-opened (it was just a
	  shortcut of CSV.open(filename, 'r')).  now CSV.parse accepts a
	  string or a stream to be parsed e.g.
	  CSV.parse("1,2\n3,r") #=> [['1', '2'], ['3', '4']]

	* test/csv/test_csv.rb: follow above changes.

Wed May 26 14:19:42 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval, eval): make line number consistent on eval with
	  Proc.  [ruby-talk:101253]

Wed May 26 13:59:17 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::skip_for_variable): Allow for
	  'do' after for statement

Wed May 26 13:56:03 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb (Generators::MarkUp::style_url): Fix
	  relative path to code CSS file

Wed May 26 13:14:52 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_init_copy): copy also positions.  [ruby-talk:100910]

Wed May 26 00:00:00 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/syck.c (syck_new_parser): clear parser on init.
	  thanks, ts. [ruby-core:02931]

	* ext/syck/token.c (sycklex_yaml_utf8): buffer underflow.
	  thanks, ts. [ruby-core:02929]

	* lib/yaml/baseemitter.rb (indent_text): simpler flow block code.

Tue May 25 11:54:13 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_yield_0, proc_invoke, proc_arity): allow passing a block
	  to a Proc.  [ruby-dev:23533]

	* parse.y (block_par, block_var): ditto.

Tue May 25 01:50:17 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (ossl_i2d_ASN1_TYPE, ossl_ASN1_TYPE_free):
	  workaround for the versions earlier than OpenSSL-0.9.7.

Mon May 24 10:46:26 2004  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/rdoc/generators/template/html/html.rb: SYSTEM identifiers
	  must be absolute URIs

Sun May 23 04:53:50 2004  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/pstore.rb (transaction): allow overriding dump and load.
	  [ruby-dev:23567]

	* lib/yaml/store.rb: follow lib/pstore.rb's change.

Sat May 22 11:54:10 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* MANIFEST: add test/openssl/test_x509store.rb.

	* ext/tk/MANIFEST: add recent files.

Sat May 22 05:37:11 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/remote-tk.rb: (NEW library) control Tk interpreters
	  on the other processes by Tcl/Tk's 'send' command

Fri May 21 09:22:05 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_method_parameters):
	  Add ()'s around parameters that don't have them

Fri May 21 02:21:11 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb: fixed a few bugs around multi char record/field separator.

	* test/csv/test_csv.rb: added boundary test for above feature.

Thu May 20 17:02:03 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (check_sizeof): define result size.  [ruby-core:02911]

	* lib/mkmf.rb (create_header): macro name should not include equal
	  sign.

Thu May 20 14:35:52 2004  Tanaka Akira  <akr@m17n.org>

	* ext/socket/socket.c: check SCM_RIGHTS macro addition to
	  the msg_control field to test existence of file descriptor passing
	  by msg_control.

Thu May 20 12:38:06 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_eq): always check if operands are NaN.
	  [ruby-list:39685]

Thu May 20 12:34:39 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_visibility):
	  At Ryan Davis' suggestion, honor visibility modifers if guarded by a
	  statement modifier

Thu May 20 12:22:13 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_type): do not check pointer to incomplete type,
	  which always get compiled.
	  [ruby-list:39683]

Wed May 19 23:45:43 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/inlinetest.rb (InlineTest::loadtest): requiring library with
	  replaced $0 can make $0 == __FILE__ block be evaluated twice.

	* test/ruby/envutil.rb (EnvUtil::rubybin): give priority to
	  environment variable.  [ruby-dev:23538]

Wed May 19 11:08:10 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: change permition of TkObject#tk_send from
	  private to public

Wed May 19 02:29:36 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: support TRACE.

Wed May 19 02:21:53 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: do not use class variables.

Tue May 18 21:21:43 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb: writes lines with "\n" when row separator is not given.
	  formerly it was "\r\n".

	* lib/csv.rb: [CAUTION] API change

	  * CSV::Row removed.  a row is represented as just an Array.  since
	    CSV::Row was a subclass of Array, it won't hurt almost all programs
	    except one which depended CSV::Row#match.

	  * CSV::Cell removed.  a cell is represented as just a String or
	    nil(NULL).  this change will cause widespread destruction.

	      CSV.open("foo.csv", "r") do |row|
		row.each do |cell|
		  if cell.is_null       # Cell#is_null
		    p "(NULL)"
		  else
		    p cell.data		# Cell#data
		  end
		end
	      end

	    must be just;

	      CSV.open("foo.csv", "r") do |row|
		row.each do |cell|
		  if cell.nil?
		    p "(NULL)"
		  else
		    p cell
		  end
		end
	      end

	* lib/csv.rb: [CAUTION] record separator(CR, LF, CR+LF) behavior
	  change.  CSV.open, CSV.parse, and CSV,generate now do not force
	  opened file binmode.  formerly it set binmode explicitly.

	  with CSV.open, binmode of opened file depends the given mode
	  parameter "r", "w", "rb", and "wb".  CSV.parse and CSV.generate open
	  file with "r" and "w".

	  setting mode properly is user's responsibility now.

	* lib/csv.rb: accepts String as a fs (field separator/column separator)
	  and rs (record separator/row separator)

	* lib/csv.rb: added CSV.foreach(path, rs = nil, &block).  CSV.foreach
	  now does not handle "| cmd" as a path different from IO.foreach.
	  needed?

	* test/csv/test_csv.rb: updated.

Tue May 18 14:24:20 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml.rb: added rdoc to beginning of lib.

Tue May 18 14:00:46 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (NEW_DSTR): adjust list length.

	* parse.y (literal_concat): ditto.

Tue May 18 09:30:25 2004  SASADA Koichi  <ko1@atdot.net>

	* eval.c (rb_method_node): search cache entry first.

Mon May 17 16:04:06 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* numeric.c (flo_to_s): it's preferable that "p 0.0" outputs "0.0"
	  instead of "0.0e+00". [ruby-dev:23480]

	* numeric.c (flo_to_s): it's preferable that "p 0.00000000000000000001"
	  outputs "1.0e-20" instead of "9.999999999999999e-21". (the precision
	  is considered, but there is assumption DBL_DIG == 15 in current
	  implementation)

Mon May 17 10:13:33 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (setup_domain_and_type): honor duck typing.
	  [ruby-dev:23522]

	* ext/socket/socket.c (sock_s_getnameinfo): ditto.

Mon May 17 00:36:21 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/baseemitter.rb (indent_text): was forcing a mod value
	  of zero at times, which kept some blocks from getting indentation.

Mon May 17 00:07:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/drb/drb.rb: Cosmetic documentation changes.

Sun May 16 20:55:49 2004  Tanaka Akira  <akr@m17n.org>

	* ext/dbm/dbm.c (fdbm_initialize): accept optional 3rd argument to
	  specify an open flag.
	  (Init_dbm): define open flags: DBM::READER, DBM::WRITER, DBM::WRCREAT
	  and DBM::NEWDB.

Sat May 15 17:52:24 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_float.rb(test_strtod): Add test for signed 0.000...1

Sat May 15 14:20:13 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/syck/depend: add ruby's headers.

Sat May 15 13:38:33 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/MANIFEST, ext/syck/depend: new file.

	* lib/yaml/rubytypes.rb: range of exponential floats.  [ruby-core:02824]

	* test/yaml/test_yaml.rb: tests for strings start with colon and some
	  round trip.

Sat May 15 12:04:58 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml.rb: removed fallback to pure Ruby parser.

	* lib/yaml/baseemitter.rb (node_text): rewriting folded scalars.

	* ext/syck/syck.h: reports style of scalars now, be they plain, block
	  single-, or double-quoted.

	* ext/syck/syck.c: ditto.

	* ext/syck/gram.c: ditto.

	* ext/syck/node.c: ditto.

	* ext/syck/token.c: ditto.

	* ext/syck/rubyext.c (yaml_org_handler): symbols loaded only
	  if scalar style is plain.

	* test/yaml/test_yaml.rb (test_perl_regexp): updated test to
	  match new regexp serialization.

Sat May 15 01:41:34 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (eval): forgot to restore $SAFE value before evaluating
	  compiled node.  [ruby-core:02872]

Sat May 15 01:33:12 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* range.c (range_each_func): terminates loop if generating value
	  is same to @end.  [ruby-talk:100269]

Fri May 14 22:08:38 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_new4): should not reuse frozen shared string if
	  the original is not an instance of String. [ruby-talk:100193]

Fri May 14 21:29:26 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_mdump): preserve GMT bit in the marshal data.
	  [ruby-talk:100213]

Fri May 14 18:37:49 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/canvas.rb: improve coords support for canvas
	  items. Now, supports all of the followings.
	       TkcLine.new(c, 0, 0, 100, 100, :fill=>'red')
	       TkcLine.new(c, [0, 0, 100, 100], :fill=>'red')
	       TkcLine.new(c, [0, 0], [100, 100], :fill=>'red')
	       TkcLine.new(c, [[0, 0], [100, 100]], :fill=>'red')
	       TkcLine.new(c, :coords=>[0, 0, 100, 100], :fill=>'red')
	       TkcLine.new(c, :coords=>[[0, 0], [100, 100]], :fill=>'red')

Fri May 14 13:30:39 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* test/ruby/test_float.rb: Add test for util.c revision 1.42.

Fri May 14 12:13:46 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* util.c (ruby_strtod): strtod("0", &end); => end should point '\0'.
	 [ruby-dev:23498]

Thu May 13 15:47:30 2004  akira yamada  <akira@ruby-lang.org>

	* lib/net/telnet.rb (Net::Telnet::login): "options" can specify
	  regexps for login prompt and/or password prompt.

Thu May 13 14:17:57 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c (yaml_org_handler): some empty strings were
	  loaded as symbols.

Thu May 13 11:04:08 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_pack): always add with null for 'Z'.

	* pack.c (pack_unpack): terminated by null for 'Z'.  [ruby-talk:98281]

Wed May 12 19:59:43 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_type, check_sizeof): replace unusable characters.
	  [ruby-talk:99788]

Wed May 12 17:41:42 2004  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb (Resolv::DNS::Config): make it configurable without
	  external file such as /etc/resolv.conf.

Wed May 12 14:37:27 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509name.c: attribute value of DC (short name of
	  domainComponent) should be IA5String.

Wed May 12 13:20:19 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk/composite.rb: improve configure methods (based on
	  the proposal of [ruby-talk:99671]).

Wed May 12 11:51:08 2004  Dave Thomas  <dave@pragprog.com>

	* class.c (rb_obj_singleton_methods): fix rdoc

Tue May 11 07:09:42 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (is_defined): do not protect exception during receiver
	  evaluation.

Mon May 10 22:28:14 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/protocol.rb (each_crlf_line): remove junk line.

Mon May 10 21:44:42 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb: Change scheme for
	  looking up symbols in  HTML generator.

Mon May 10 16:45:21 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (eval): warning during eval should not cause deadlock.
	  [ruby-talk:98651]

	* eval.c (rb_eval): raise TypeError exception for superclass
	  mismatch.  [ruby-list:39567]

Mon May 10 12:11:37 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb: Hack to search parents
	  for unqualified constant names.

Mon May 10 01:18:15 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/pop.rb (logging): append "\n".

Sun May  9 23:38:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/net/ftp.rb: ported documentation improvement from 1.8 branch

	* lib/net/imap.rb:   ditto

	* lib/net/pop.rb:    ditto

	* lib/net/smtp.rb:   ditto

	* lib/net/telnet.rb: ditto

Sun May  9 23:34:51 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_float.rb: added test_strtod to test Float("0").

Sun May  9 13:24:24 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/yaml/store.rb: use FileUtils::copy.

Sun May  9 12:34:26 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regex.c: removed unused file.

Sat May  8 10:53:30 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_open): open should not ignore block when "to_open"
	  method is used.  [ruby-dev:23478]

Fri May  7 22:07:39 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mv): new option `force'. [ruby-talk:99457]

	* lib/fileutils.rb: new method for command option reflection:
	  FileUtils.commands, .options, .have_option?, .options_of,
	  .collect_methods.

	* lib/fileutils.rb: module Verbose, NoWrite, DryRun do not have
	  option flags @fileutils_verbose and @fileutils_noop, they make no
	  sense.

Fri May  7 21:50:21 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::parse_include): Allow
	  multiple arguments to 'include'

Fri May  7 21:03:51 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (fu_list): Array() breaks pathes including "\n".
	  [ruby-core:02843]

	* test/fileutils/test_fileutils.rb (mkdir): test "\n" in path.

Fri May  7 20:53:25 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/dbm/dbm.c (fdbm_modify): typo fixed. [ruby-dev:23473]

Fri May  7 11:17:27 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* util.c (ruby_strtod): "0.0000000000000000001" should be converted
	  to 1.0e-19 instead of 0.0. (leading zeros aren't significant digits)
	  [ruby-talk:99318] [ruby-dev:23465]

Thu May  6 22:27:32 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* ext/socket/socket.c (ippaddr): use NUMERICHOST if can not resolve
	  hostname.

Thu May  6 22:09:29 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tkutil.c (get_eval_string_core): bug fix. [ruby-dev:23466]

Thu May  6 14:22:29 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/rubytypes.rb (to_yaml): added instance variable handling
	  for Ranges, Strings, Structs, Regexps.

	* lib/yaml/rubytypes.rb (to_yaml_fold): new method for setting a
	  String's flow style.

	* lib/yaml.rb (YAML::object_maker): now uses Object.allocate.

	* ext/syck/gram.c: fixed transfer methods on structs, broke it
	  last commit.

Thu May  6 14:38:02 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (rb_push_glob): simplified code (not change behavior)

Thu May  6 13:32:44 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: get rid of side effect of Config.expand, patched by
	  <tttt01@infoseek.jp>  (ruby-bugs:PR#597)

Thu May  6 11:40:28 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (string): accept NIL.

	* lib/net/imap.rb (body_type_basic): allow body-fields omissions.

Thu May  6 01:59:04 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb (Generators::HtmlMethod::params):
	  Don't include the &block parameter if we have explicit
	  yield parameters.

Wed May  5 03:52:31 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/ring.rb: use recv instead of recvfrom.

Wed May  5 00:38:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/gserver.rb: documented
	* lib/xmlrpc/README.txt: introduced for documentation purposes

Mon May  3 09:47:24 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_method_or_yield_parameters):
	  Fix parsing bug if yield called within 1 line block

Sun May  2 21:56:48 2004  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb (rm_f, rm_r): test :force flag.

Sun May  2 01:04:38 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib, ext/tk: renewal Ruby/Tk

Fri Apr 30 20:08:41 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* time.c (SIZEOF_TIME_T): support SIZEOF_TIME_T == SIZEOF_INT.

Wed Apr 28 01:26:11 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* oniguruma.h, regparse.c: imported Oni Guruma 2.2.8.

Wed Apr 28 01:16:23 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* oniguruma.h, regparse.c: imported Oni Guruma 2.2.7.

Tue Apr 27 14:43:32 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk: LIBURUBY_A is needed for extconf.rb even when
	  cross-compiling.

Tue Apr 27 13:33:50 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (string_content): turn off NODE_NEWLINE flag to avoid
	  unnecessary line trace for inlined expression.
	  (ruby-bugs PR#1320)

Tue Apr 27 08:15:13 2004  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/rubytypes.rb: passing Range tests.

	* ext/syck/syck.h: version 0.44.

	* ext/syck/gram.c: transfers no longer open an indentation.
	  fixed transfers which precede blocks.

	* ext/syck/token.c: ditto.

	* ext/syck/syck.c: fixed segfault if an anchor has been released already.

	* ext/syck/node.c (syck_free_members): organized order of free'd nodes.

	* ext/syck/rubyext.c (syck_emitter_write_m): test for proper string with
	  StringValue.

Mon Apr 26 23:56:54 2004  Daniel Kelley  <news-1082945587@dkelley.gmp.san-jose.ca.us>

	* README.EXT, README.EXT.ja: fixed wrong function signature.
	  [ruby-talk:98349]

Mon Apr 26 21:40:09 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/code_objects.rb (RDoc::Context::add_alias): Only alias
	  to instance methods.

Sun Apr 25 18:26:23 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (ac_cv_func_fork): set to no on DJGPP.

Sat Apr 24 14:32:03 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* re.c: applied stack error handling patch. [ruby-dev:23431]

Sat Apr 24 10:38:31 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/markup/simple_markup.rb (SM::SimpleMarkup::group_lines):
	  Fix bug where consecutive headings are merged.

Fri Apr 23 23:24:47 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: $hdrdir should not contain macros, for backward
	  compatibility.  [bruby-dev:28]

	* lib/mkmf.rb (create_makefile): in the case of extout, just copy
	  script files, without comparison.

Fri Apr 23 16:38:46 2004  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb: sync taint/freeze flag between
	  a pathname object and its internal string object.

Fri Apr 23 14:52:14 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt, arg, aref_args): should not make sole splat into
	  array, in aref_args other than aref with op_asgn.

Fri Apr 23 14:14:38 2004  Tanaka Akira  <akr@m17n.org>

	* lib/resolv.rb: don't use Regexp#source to embed regexps.
	  [ruby-dev:23432]

Thu Apr 22 18:25:10 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk, ext/extmk.rb: make ext and .ext get removed by distclean.

Thu Apr 22 10:07:01 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* */Makefile.sub (distclean-local): should remove $(RBCONFIG).

Thu Apr 22 04:17:57 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_mod_define_method): allow binding methods to modules.
	  [ruby-dev:23410]

	* parse.y (aref_args): should pass expanded list.  [ruby-core:02793]

Thu Apr 22 01:12:57 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (flo_to_s): tweak output string based to preserve
	  decimal point and to remove trailing zeros.  [ruby-talk:97891]

	* string.c (rb_str_index_m): use unsigned comparison for T_FIXNUM
	  search.  [ruby-talk:97342]

Wed Apr 21 23:04:42 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/rinda.rb, test/rinda/test_rinda.rb: check Hash tuple size.

Wed Apr 21 20:05:00 2004  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::HTTP#proxy_open): set Host: field explicitly.
	  [ruby-list:39542]

Wed Apr 21 18:39:46 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb: merge SMTP-TLS patch.  This patch is
	  contributed by Daniel Hob. [ruby-core:02789]

Wed Apr 21 18:23:45 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb: change coding style: def m( a ) -> def m(a).

Wed Apr 21 18:01:47 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/pop.rb: do not use class variables.

	* lib/net/pop.rb (do_start): ensure to clean up connection when
	  authentication failed.

Wed Apr 21 17:23:59 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (HTTP#connect): CONNECT must precede SSL connect.
	  [ruby-dev:23379]

	* lib/net/http.rb (HTTP.new): class variables are not inherited
	  now.

Wed Apr 21 15:56:43 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/ui/console/testrunner.rb (test_started): restore $0
	  after changing process title.  [ruby-talk:97426]

Wed Apr 21 10:18:06 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* process.c(rb_spawn): fix SEGV at "p system('command line here')"
	 (may happen only in bccwin32) [ruby-dev:23380]

Mon Apr 19 20:58:44 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c: Updated RDocs.

Mon Apr 19 18:11:15 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_equal): returns true if two hashes have same set
	  of key-value set.  [ruby-talk:97559]

	* hash.c (rb_hash_eql): returns true if two hashes are equal and
	  have same default values.

Mon Apr 19 08:19:11 2004  Doug Kearns  <djkea2@mugca.its.monash.edu.au>

	* dln.c, io.c, pack.c, lib/benchmark.rb, lib/cgi.rb, lib/csv.rb,
	  lib/date.rb, lib/ftools.rb, lib/getoptlong.rb, lib/logger.rb,
	  lib/matrix.rb, lib/monitor.rb, lib/set.rb, lib/thwait.rb,
	  lib/timeout.rb, lib/yaml.rb, lib/drb/drb.rb, lib/irb/workspace.rb,
	  lib/net/ftp.rb, lib/net/http.rb, lib/net/imap.rb, lib/net/pop.rb,
	  lib/net/telnet.rb, lib/racc/parser.rb, lib/rinda/rinda.rb,
	  lib/rinda/tuplespace.rb, lib/shell/command-processor.rb,
	  lib/soap/rpc/soaplet.rb, lib/test/unit/testcase.rb,
	  lib/test/unit/testsuite.rb: typo fix.

Mon Apr 19 08:14:18 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::find_body): Allow for
	  #ifdef HAVE_PROTOTYPES

Fri Apr 16 17:04:07 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_equal): always returns true or false, never
	  returns nil. [ruby-dev:23404]

Fri Apr 16 12:38:48 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/drb/drb.rb (DRb::DRbUnknown::initialize): Exception#to_str is
	  deprecated.

	* lib/drb/drb.rb (DRb::DRbServer::InvokeMethod::perform): multiple
	  value class changed.

	* lib/drb/invokemethod.rb (DRb::DRbServer::InvokeMethod18Mixin::block_yield):
	  ditto.

Fri Apr 16 08:27:08 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: skip linking when libraries to be preloaded not
	  compiled.  [ruby-list:39561]

Thu Apr 15 19:57:11 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (pst_success_p): new method Process::Status#success?.
	  [ruby-dev:23385]

	* rubytest.rb: do nothing while cross-compiling, return status in
	  system independent style.

Thu Apr 15 19:26:54 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (rb_push_glob): Dir.glob() should return nil if block is given.
	  (http://www.ruby-lang.org/ja/man/index.cgi?cmd=view;name=Dir)

	* dir.c (push_braces): Dir.glob() should handle '{ }' nested more than
	  3 times.

	* dir.c (push_braces, rb_push_glob): Dir.glob() should handle escaped
	  '{' and '}' and ','.

	  [ruby-dev:23376]

Thu Apr 15 17:12:13 2004  Tanaka Akira  <akr@m17n.org>

	* ext/gdbm/gdbm.c (Init_gdbm): define GDBM::READER, GDBM::WRITER,
	  GDBM::WRCREAT and GDBM::NEWDB.
	  (fgdbm_initialize): use specified read/write flag.

Wed Apr 14 13:06:09 2004  Doug Kearns  <djkea2@mugca.its.monash.edu.au>

	* array.c, enum.c, eval.c, file.c, io.c, numeric.c, object.c, prec.c,
	  process.c, re.c, string.c: typos in RDoc comments.  [ruby-core:02783]

Wed Apr 14 11:29:56 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* numeric.c (flo_eq): workaround for bcc32's bug.
	  (ruby-bugs-ja:PR#594)

Wed Apr 14 11:06:38 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::scan): Changed
	  behavior of :enddoc: -- it now unconditionally terminates
	  processing of the current file.

Wed Apr 14 10:57:40 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* defines.h: include <net/socket.h> to get fd_set definition in BeOS.

Tue Apr 13 23:00:55 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/rinda.rb: change pattern matching.
	  a === b -> a == b || a === b. [druby-ja:98]

	* test/rinda/test_rinda.rb: ditto.

Tue Apr 13 21:50:57 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bcc32/Makefile.sub (PHONY): Borland make disallows empty command
	  rules.

Tue Apr 13 17:55:16 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (begin_transport): should not overwrite HTTP
	  request header. [ruby-list:39543]

Tue Apr 13 16:48:00 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/pop.rb: merge POP3S patch.  This patch is contributed by
	  Daniel Hobe.

Tue Apr 13 02:56:29 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* common.mk: changed the order of ascii.c alphabetically.

Mon Apr 12 19:11:21 2004  Eric Hodel  <drbrain@segment7.net>

	* gc.c (rb_gc_copy_finalizer): typo.  [ruby-core:02774]

Mon Apr 12 18:45:58 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509name.c (ossl_x509name_init_i): should return
	  a value.

Mon Apr 12 10:39:50 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (rb_glob2, rb_glob, push_globs, push_braces, rb_push_glob):
	  fix memory leak. (leaked when block was interrupted)

Sun Apr 11 19:10:13 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (require_libraries): restore source file/line after
	  statically linked extensions initialized.  [ruby-dev:23357]

Sun Apr 11 10:47:04 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/code_objects.rb (RDoc::TopLevel::add_class_or_module): Toplevel
	  classes and modules are a special case too... (handle extending existing
	  classes with or without :enddoc:)

Sat Apr 10 23:51:13 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/code_objects.rb (RDoc::Context::add_to): Implementation of :enddoc:
	  made one too many assumptions...

Sat Apr 10 00:00:19 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/markup/simple_markup/inline.rb: Fix problem
	  with \_cat_<b>dog</b>

Fri Apr  9 17:05:21 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (has_magic, find_dirsep): incomplete '[' matches no character
	  in Dir.glob. (follows File.fnmatch's behavior)

	* dir.c (fnmatch_helper): incomplete escape is ignored in File.fnmatch.
	  (follows Dir.glob's behavior)

	* dir.c (find_dirsep): '/' between '[' and ']' is ignored in Dir.glob.
	  (follows File.fnmatch with File::FNM_PATHNAME 's behavior)

	* dir.c (find_dirsep): escaped slash '\/' loses its meaning as
	  directory separator in Dir.glob.

	  [ruby-dev:23291]

Thu Apr  8 20:25:19 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): skip uncompiled extensions.

	* lib/mkmf.rb (create_makefile): emit no rules for static library if
	  $static is nil, e.g., outside of ext/.

	* lib/test/unit/ui/console/testrunner.rb (test_started): show test
	  name via $0.

	* runruby.rb: set environments to use the compiled binary.

	* test/runner.rb: do nothing while cross-compiling.

	* test/drb/drbtest.rb, test/soap/calc/test_calc_cgi.rb: use envutil to
	  know ruby binary, and restore $: after require.

	* test/ruby/envutil.rb: give priority to RUBY environment variable to
	  use just compiled binary and libraries.

Thu Apr  8 19:03:33 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_binmode): inverted condition.  [ruby-dev:23349]

Thu Apr  8 18:22:00 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_s_list): return encoding list if no block
	  is given.  [ruby-dev:23063]

Wed Apr  7 15:29:24 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): use NUM2INT() instead of num2i32().

Wed Apr  7 12:32:02 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb, lib/rss/1.0.rb: accepted rdf:resource or
	  resource attribute in rdf:li.
	* test/rss/test_parser.rb: added test for above change.

	* lib/rss/dublincore.rb: reverted style.

	* lib/rss/xmlparser.rb: normalized XMLParser class hierarchy.

Wed Apr  7 10:43:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, common.mk, */Makefile.sub (ext/extinit.o): OUTFLAG
	  doesn't work for object files on VC.

	* */Makefile.sub (config.h): need SIZEOF_TIME_T now.

Wed Apr  7 00:24:34 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/rinda.rb: fix hash tuple bug.

	* lib/rinda/tuplespace.rb: ditto.

	* test/rinda/test_rinda.rb

Tue Apr  6 18:24:18 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_get_path): get path string via "to_path" method if
	  path object is not a string. [Ruby2]

	* gc.c (rb_gc_call_finalizer_at_exit): do not free threads in the
	  exit finalizers.

	* io.c (rb_io_reopen): should use rb_io_check_io().

Tue Apr  6 16:46:09 2004  Tanaka Akira  <akr@m17n.org>

	* configure.in: check the size of time_t.

	* time.c (time_add): new function.
	  (time_plus): use time_add.
	  (time_minus): use time_add.

Tue Apr  6 13:11:48 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (raise_socket_error): never return.

	* ext/socket/socket.c (make_hostent): must return value.

Tue Apr  6 00:14:43 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (Init_Exception): remove Exception#to_str. [Ruby2]

	* eval.c (error_print): should no call "to_str" anymore use
	  "message" method instead.

	* io.c (rb_f_open): Kernel#open() calls "to_open" if the first
	  argument responds to it. [Ruby2]

Tue Apr  6 00:13:43 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/rinda.rb: add require 'drb/drb'

Mon Apr  5 22:25:32 2004  Tanaka Akira  <akr@m17n.org>

	* test/zlib/test_zlib.rb: new file.
	  (TestZlibGzipWriter#test_new_nil): test for [ruby-dev:23228].

Mon Apr  5 22:16:23 2004  Minero Aoki  <aamine@loveruby.net>

	* parse.y (assoc_list): {a: 1, b: 2} should be allowed.
	  [ruby-dev:23328]

Mon Apr  5 19:43:40 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regexec.c: imported Oni Guruma 2.2.6.

Mon Apr  5 19:39:10 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* regparse.c, oniguruma.h: imported Oni Guruma 2.2.6.

Mon Apr  5 12:12:09 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (raise_socket_error): some platforms don't have
	  EAI_SYSTEM.

Mon Apr  5 08:18:23 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/rdoc.rb: Remove leading ./ from file names so that cross
	  references work properly.

Sun Apr  4 14:01:20 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/options.rb (Options::parse): Allow multiple -x options to
	  RDoc. Fix bug where files weren't being excluded properly

Sat Apr  3 09:36:38 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/syck.h: version 0.43.

Sat Apr  3 08:28:47 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/lib/gram.c: allow root-level inline collections.
	  [ruby-talk:94922]

	* lib/yaml/rubytypes.rb (Symbol#to_yaml): emit symbols as implicits.
	  [ruby-talk:94930]

Fri Apr  2 19:28:48 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bcc32/Makefile.sub (OUTFLAG): needed for static-linked-ext.

Fri Apr  2 18:00:05 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): extract necessary variables for static link
	  from Makefile.

	* lib/mkmf.rb (create_makefile): save preload and libpath for next
	  compile.

Fri Apr  2 17:27:17 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (top_include): include in the wrapped load is done for
	  the wrapper, not for a singleton class for wrapped main.
	  [ruby-dev:23305]

Fri Apr  2 15:13:44 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_eq): use temporary double variable to save the
	  result (internal float register may be bigger than 64 bits, for
	  example, 80 bits on x86).  [ruby-dev:23311]

Fri Apr  2 14:35:26 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (block_pass): should generate unique identifier of the
	  pushing block.  [ruby-talk:96363]

Fri Apr  2 11:36:20 2004  Minero Aoki  <aamine@loveruby.net>

	* eval.c (Init_load): make $LOADED_FEATURES built-in.
	  [ruby-dev:23299]

	* ruby.c (ruby_prog_init): make $PROGRAM_NAME built-in.

	* lib/English.rb: remove $LOADED_FEATURES and $PROGRAM_NAME.

Fri Apr  2 07:31:38 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c: mistakingly removed do_not_reverse_lookup.
	  [ruby-list:39475]

	* ext/socket/socket.c (make_hostent): fix memory leak, based on
	  the patch from HORIKAWA Hisashi <vzw00011@nifty.ne.jp>.

Thu Apr  1 22:55:33 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb: Allow rdoc comments in
	  =begin rdoc/=end

	* lib/rdoc/parsers/parse_rb.rb: Fix problem with comment in
	  top-level method being taken as file comment.

Thu Apr  1 22:55:04 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_options.rb: Fix undefined variable warning.

Thu Apr  1 19:58:37 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/mapping/{factory.rb,registry.rb}: fixed illegal mapped URI
	  object with soap/marshal.
	  added URIFactory class for URI mapping.  BasetypeFactory checks
	  instance_variables when original mapping is not allowed (ivar must
	  be empty).  Instance of URI have instance_variables but it must be
	  llowed whenever original mapping is allowed or not.

Wed Mar 31 19:06:23 2004  Tanaka Akira  <akr@m17n.org>

	* time.c (year_leap_p): new function.
	  (timegm_noleapsecond): ditto.
	  (search_time_t): use timegm_noleapsecond instead of
	  mktime for first guess.

Wed Mar 31 12:05:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/delegate.rb (DelegateClass): define internal methods of the
	  result class, but not metaclass of the caller.  [ruby-talk:96156]

	* intern.h: provide proper prototypes.  [ruby-core:02724]

	* ruby.h: missing.h is now prerequisite to intern.h.

Wed Mar 31 11:17:16 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): raises RangeError if uv is out of UTF8 value
	  range.  [ruby-dev:23281]

	* io.c (rb_io_binmode): stdio buffer should be empty when calling
	  IO#binmode.  [ruby-talk:96155]

Tue Mar 30 20:25:34 2004  Tanaka Akira  <akr@m17n.org>

	* time.c (search_time_t): limit guess range by mktime if it is
	  available.  [ruby-dev:23274]

Tue Mar 30 18:19:00 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): fix SEGV at retry in iterator's receiver.
	  [ruby-dev:23227]

Mon Mar 29 20:17:16 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_exec): follow older behavior if close-on-exec is not
	  available.

	* process.c (rb_fork): protect from exceptions while waiting failed
	  process, if status is given.

Sun Mar 28 16:25:37 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (clean-local, distclean-local): remove
	  work files.

	* win32/Makefile.sub (clean-local): ditto.

Sun Mar 28 14:23:02 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/pop.rb: def m( arg ) -> def m(arg).

Sun Mar 28 14:09:13 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/pop.rb (auth): failed when account/password include "%".
	  [ruby-talk:95933]

Sat Mar 27 21:40:41 2004  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb: permit extra semicolon in content-type field.

Sat Mar 27 10:40:48 2004  Tanaka Akira  <akr@m17n.org>

	* (lib/pp.rb, lib/prettyprint.rb): define seplist in PP::PPMethods
	  instead of PrettyPrint.

Sat Mar 27 01:47:09 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: trim tail space of each line.  no user visible change.

	* lib/rss/dublincore.rb: fixed class definition mismatch.

	* sample/openssl/gen_csr.rb: fixed wrong usage text.

Thu Mar 25 23:15:24 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_options.rb (RI::Options::show_version):
	  Add --version option

Thu Mar 25 21:45:00 2004  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c: Bug in + and - reported by Bret Jolly
	  fixed.

Thu Mar 25 21:01:32 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* version.c (ruby_show_copyright): obtain copyright year from
	  RUBY_RELEASE_YEAR.

	* win32/resource.rb: ditto.

Thu Mar 25 19:37:35 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/resource.rb: default rubyw icon to ruby.ico, and let DLL also
	  include them.

	* win32/resource.rb: include winver.h for older WindowsCE.

Thu Mar 25 14:01:03 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk, */Makefile.sub (lib, dll): phony targets.

	* configure.in (ruby, miniruby): ditto.

	* cygwin/GNUmakefile.in (rubyw): ditto.

Thu Mar 25 04:16:18 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_options.rb (RI::Options): Add the --list-names option,
	  which dumps our all known names

Thu Mar 25 03:57:47 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_util.rb (NameDescriptor::initialize): No longer
	  allow nested classes to be designated using "."--you must
	  now use "::"

Thu Mar 25 02:00:18 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/template/html/one_page_html.rb (Page):
	  Fix to work with C modules.

Wed Mar 24 20:49:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/uri.rb: Documented (thanks Dmitry V. Sabanin).
	* lib/uri/common.rb: Ditto.
	* lib/uri/ftp.rb: Ditto.
	* lib/uri/generic.rb: Ditto.
	* lib/uri/http.rb: Ditto.
	* lib/uri/https.rb: Ditto.
	* lib/uri/ldap.rb: Ditto.
	* lib/uri/mailto.rb: Ditto.

Wed Mar 24 18:48:05 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb ($ruby, $topdir, $hdrdir): should not be affected by
	  DESTDIR after installed.

	* lib/mkmf.rb (dummy_makefile): default file lists to be cleaned.

Wed Mar 24 12:32:56 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::handle_class_module):
	  Don't document methods if we don't know for sure the
	  class or module.

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_class):
	  Don't store documentation for singleton classes if we
	  don't know the real class.

Wed Mar 24 11:11:26 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb (Generators::HTMLGenerator::load_html_template):
	  Allow non-RDoc templates by putting a slash in the template name

Wed Mar 24 10:05:22 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/tempfile.rb (Tempfile::_close): should not clear @tmpname
	  until the file is really removed. [ruby-core:02684]

Wed Mar 24 04:12:44 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_mod_cvar_get): new method Module#class_variable_get.

	* object.c (rb_mod_cvar_set): ditto (Module#class_variable_set).

Tue Mar 23 17:45:22 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_thread_atfork): 1.9 warns no more for thread
	  termination.  [ruby-dev:23212]

Tue Mar 23 14:46:10 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, */Makefile.sub, common.mk (clean-local, distclean-local):
	  separate files under directories due to directory separator.

	* */Makefile.sub (MKFILES): common.mk and */Makefile.sub should not be
	  removed.

	* win32/Makefile.sub, wince/Makefile.sub: $* cannot appear in explicit
	  rules.

	* cygwin/GNUmakefile.in: some mingw stuffs were missed.

	* lib/mkmf.rb (create_makefile): Borland make wrongly removes braces
	  from command lines.

	* bcc32/Makefile.sub: needs bcc32/mkexports.rb.

Mon Mar 22 08:21:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, */Makefile.sub, common.mk: extract common portions.

	* Makefile.in, cygwin/GNUmakefile.in, */Makefile.sub (RBCONFIG):
	  separated time stamp file for rbconfig.rb.

	* configure.in: append common.mk to Makefile.

	* mkconfig.rb: keep mtime of rbconfig.rb if unchanged.

	* win32/rm.bat: remove multiple files.

	* wince/mkconfig_wce.rb: use fake.rb instead.

Sun Mar 21 22:17:35 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#virtual_host):
	  sort @virtual_hosts in address, port, host order.

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#lookup_server):
	  hostname should not be match if :ServerAlias is not given.

Sun Mar 21 21:11:16 2004  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/shell/*: bug fix for Shell#system(command_line_string).

Sun Mar 21 21:04:42 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ruby.1: add -width option to .Bl for old groff.

Sun Mar 21 18:57:37 2004  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/*: Test::Unit::TestCase -> RSS::TestCase and
	  Test::Unit::Assertions -> RSS::Assertions.

Sun Mar 21 18:48:20 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/{rss,dublincore,syndication}.rb: handled W3CDTF correctly.

Sun Mar 21 18:15:29 2004  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_xml-stylesheet.rb: added tests for xml-stylesheet.

	* lib/rss/xml-stylesheet.rb: added xml-stylesheet parsing
	  function.

Sat Mar 20 23:51:03 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* eval.c (rb_require_safe): preserve old ruby_errinfo.
	  [ruby-talk:95409]

	* eval.c (rb_f_raise): should not clear backtrace information if
	  exception object already have one.

Sat Mar 20 21:21:03 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/extmk.rb: rm -rf $extout, not extout.

Sat Mar 20 15:25:36 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/template/html/html.rb (RDoc::Page): Force
	  page background to white.

Sat Mar 20 09:33:36 2004  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb, lib/date/format.rb: _parse() now accepts fractional
	  part of second minute that follows a comma or a full stop.

Fri Mar 19 21:06:21 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (assoc_list): allow {sym: val} style Hash. [Ruby2]
	  this change is done by Nobuyoshi Nakada <nobu@ruby-lang.org>.

Fri Mar 19 15:15:15 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_cvar_set): class variables become private to the
	  particular class/module. [Ruby2]

	* variable.c (rb_cvar_get): ditto.

	* variable.c (rb_cvar_defined): ditto.

Fri Mar 19 11:31:32 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb ($beos, $solaris): add OS flags.

	* lib/mkmf.rb (RUBY): / is not recognized as path separator on
	   nmake/bmake. [ruby-list:39388]

	* lib/mkmf.rb (CLEANLIBS, CLEANOBJS): should remove *.exp with *.so.

Fri Mar 19 01:55:57 2004  Mauricio Fernandez  <batsman.geo@yahoo.com>

	* io.c (rb_io_sync): need not to check writable. [ruby-core:02674]

Thu Mar 18 19:47:44 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* instruby.rb, rubytest.rb: do not depend on srcdir.

Thu Mar 18 18:50:06 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: no longer embed srcdir and compile_dir into
	  rbconfig.rb.

	* ext/extmk.rb, lib/mkmf.rb: obtain top_srcdir and topdir from library
	  paths.

Thu Mar 18 17:46:35 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: do not undef :to_a.

Thu Mar 18 16:22:38 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_eq): avoid false positive by using scope and
	  dyna_vars.  no longer use frame.uniq.

	* eval.c (proc_arity): arity is now defined as number of
	  parameters that would not be ignored. i.e. Proc.new{}.arity
	  returns zero.  update test suites too.

Thu Mar 18 15:27:25 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c: remove specialized version of rb_Array().  use simple
	  one defined in object.c.

	* object.c (Init_Object): remove Kernel#to_a.

	* enum.c (enum_zip): use "to_a" instead of "to_ary".

Wed Mar 17 00:22:03 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* oniguruma.h: imported Oniguruma 2.2.5.
	* regparse.c: ditto.

Tue Mar 16 11:14:17 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (fnmatch_helper): File.fnmatch('\.', '.') should return true.
	  (Rev1.112 lost compatibility)

	* dir.c (fnmatch_helper): File.fnmatch('\/', '/', File::FNM_PATHNAME)
	  should return true. (Rev1.112 lost compatibility)

	* dir.c (fnmatch): File.fnmatch('**/.boo', '.foo/.boo',
	  File::FNM_PATHNAME) should return false because of leading period.

Mon Mar 15 17:01:07 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (exc_initialize): calling 'to_str' each time just for
	  type checking is too heavy.  [ruby-core:02661]

Mon Mar 15 10:14:51 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb (OpenSSL::SSL::SocketForwarder):
	  add do_not_reverse_lookup.

Mon Mar 15 07:39:13 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_yield_0): should not re-submit TAG_BREAK if this
	  yield is not break destination. [ruby-dev:23197]

Sun Mar 14 22:07:38 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_raise): err at unstarted thread.  (PR#1302)

Sat Mar 13 14:56:32 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/ut_drb.rb: use 'druby://localhost:0'. [ruby-dev:23078]

	* test/drb/ut_eval.rb: ditto.

	* test/drb/ut_large.rb: ditto.

	* test/drb/ut_safe1.rb: ditto.

	* test/drb/ut_drb_drbssl.rb: use 'drbssl://localhost:0'.

Fri Mar 12 23:52:56 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (fnmatch): directory recursion '**/' can be used with
	  File::FNM_PATHNAME. [ruby-dev:22901]

	* dir.c (fnmatch, fnmatch_helper): only '/' is accepted as path
	  separator even in DOSISH environment. [ruby-dev:22974]
	  [ruby-list:39337]

	* dir.c (fnmatch_helper): faster '*' matching.

Fri Mar 12 20:19:16 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_noreturn): default for platforms not support
	  prototypes.

	* ruby.c (ruby_init_loadpath): buffer for path name should have
	  MAXPATHLEN.

	* lib/mkmf.rb (configuration): include topdir and hdrdir in VPATH.

	* lib/mkmf.rb (create_makefile): default dependency rule.

Fri Mar 12 07:35:36 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/config.rb (WEBrick::Config::General): add
	  :DoNotReverseLookup.

	* lib/webrick/server.rb (WEBrick::GenericServer#accept): call
	  do_not_reverse_lookup for each socket if :DoNotReverseLookup
	  is set.  [ruby-code:02357]

Wed Mar 10 22:26:25 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (remove_dir): should handle symlink correctly.
	  This patch is contributed by Christian Loew.  [ruby-talk:94635]

Wed Mar 10 16:28:42 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (return_jump): set return value to the return
	  destination.  separated from localjump_destination().

	* eval.c (break_jump): break innermost loop (or thread or proc).

	* eval.c (rb_yield_0): set exit_value for block break.

Wed Mar 10 16:00:14 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* struct.c (rb_struct_s_def): Struct::new executes block with
	  generated struct class. [ruby-talk:02606]

Wed Mar 10 15:58:43 2004  Ryan Davis  <ryand-ruby@zenspider.com>

	* eval.c (eval): Only print backtrace if generating the backtrace
	  doesn't generate an exception.  [ruby-core:02621]

Wed Mar 10 10:15:16 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (opt_W_getter): get rid of warning.

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub:
	  fixed dependency.

Tue Mar  9 13:04:26 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_ungetc): raise IOError instead of calling
	  rb_sys_fail().  [ruby-talk:23181]

Tue Mar  9 10:03:40 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub:
	  replaced regex.c entry with Oniguruma files.

Tue Mar  9 01:09:46 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* Makefile.in: replaced regex.c entry with Oniguruma files.

Mon Mar  8 23:16:07 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: HTTPHeader did not initialized correctly.

	* lib/net/http.rb (connect): does same debug output.

Mon Mar  8 21:38:18 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (add_header): remove warning. [ruby-dev:23170]

Mon Mar  8 21:09:39 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (range): Cancel change for incomplete '['. More discussion
	  is needed.

Mon Mar  8 19:35:13 2004  akira yamada  <akira@arika.org>

	* lib/uri/common.rb (URI::REGEXP::PATTERN::HOSTPORT): (?:#{PORT})
	  -> (?::#{PORT}).  [ruby-dev:23170]

Mon Mar  8 15:03:24 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (range): treat incomplete '[' as ordinary character (like
	  has_magic does). fix buffer overrun at incomplete escape like '[\'.

Mon Mar  8 13:35:32 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* regparse.c (parse_exp): need to separate initialization for bcc32.
	  [ruby-dev:23169]

	* oniguruma.h (ONIG_EXTERN): check __GNUC__ instead of __CYGWIN__.

Mon Mar  8 01:05:55 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/config.rb (WEBrick::Config::HTTP): rename :RequestHander
	  to :RequestCallback and add new option :ServerAlias.

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#run): use
	  :RequestCallback and warn if :RequestHandler is in server's option.

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#run): should print
	  error message for WEBrick::HTTPSataus::Error.

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#lookup_server):
	  lookup for hostname from :ServerAlias if the req.host is not match
	  to :ServerName.

	* lib/webrick/httpservlet.rb (WEBrick::HTTPServlet::CGIHandler#do_GET):
	  use $?.exitstatus and refine log message.

Sun Mar  7 16:22:26 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* Makefile.in (lex.c): use $? instead of $<.

	* lib/pstore.rb (commit_new): use FileUtils.copy_stream for Cygwin.
	  [ruby-dev:23157]

Sun Mar  7 05:34:42 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: HTTPHeader keeps its header fields as an array.

	* lib/net/http.rb: new method HTTPHeader#add_header, get_fields.

	* lib/net/http.rb: new method HTTPHeader#content_length=.

	* lib/net/http.rb: new method HTTPHeader#content_type, main_type,
	  sub_type, type_params, content_type=, set_content_type.

	* lib/net/http.rb (HTTPHeader#basic_encode): result of pack(m) may
	  contain multiple LFs.

Sun Mar  7 03:11:00 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: new method Net::HTTPRequest#body(=).

	* lib/net/http.rb: new method Net::HTTPRequest#body_stream(=).

Sun Mar  7 02:06:07 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: spin off https code again.

	* lib/net/https.rb: new file.

	* ext/openssl/lib/net/https.rb: removed.  moved to net/https with
	  slight modifications.

	* ext/openssl/lib/net/protocols.rb: removed.  merged with net/http.

	* lib/net/protocol.rb: new class BufferedIO.

	* lib/net/protocol.rb: InternetMessageIO < BufferedIO.

	* lib/net/protocol.rb: BufferedIO.new takes an IO.

	* lib/net/smtp.rb: follow InternetMessageIO's change.

	* lib/net/pop.rb: ditto.

Sun Mar  7 00:55:03 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/protocol.rb: remove method: InternetMessageIO#address,
	  port, ip_address, read_timeout(=), socket.

	* lib/net/protocol.rb: simplify code.

	* lib/net/protocol.rb: apply latest coding style.

Sat Mar  6 15:15:05 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/strscan/depend: depends on re.h and regex.h.

	* ext/strscan/strscan.c: no version check needed.

	* ext/strscan/strscan.c (strscan_init_copy): struct re_registers must
	  not be bitwise copied.

Sat Mar  6 11:14:33 2004  David Black  <dblack@wobblini.net>

	* lib/scanf.rb: refixed the previous fix in IO#block_scanf

Sat Mar  6 10:49:40 2004  David Black  <dblack@wobblini.net>

	* lib/scanf.rb: fixed a logic glitch in IO#block_scanf

Sat Mar  6 02:00:19 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: net/https is merged.

	* ext/openssl/lib/net/https.rb: ditto.

Sat Mar  6 00:39:21 2004  Kazuo Saito  <ksaito@uranus.dti.ne.jp>

	* oniggnu.h: imported from Oniguruma library.
	* oniguruma.h: ditto.
	* regcomp.c: ditto.
	* regenc.c: ditto.
	* regenc.h: ditto.
	* regerror.c: ditto.
	* regex.c: ditto.
	* regexec.c: ditto.
	* reggnu.c: ditto.
	* regint.h: ditto.
	* regparse.c: ditto.
	* regparse.h: ditto.
	* ascii.c: ditto.
	* euc_jp.c: ditto.
	* sjis.c: ditto.
	* utf8.c: ditto.

	* MANIFEST: added Oniguruma files listed above.

	* LEGAL: added Oniguruma license.

	* regex.h: now includes oniggnu.h.

	* re.c: applied Oniguruma patch.

Fri Mar  5 23:13:08 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: support WebDAV methods, PROPPATCH, LOCK,
	  UNLOCK, OPTIONS, PROPFIND, DELETE, MOVE, COPY, MKCOL.
	  This patch is contributed by Tatsuki Sugiura.

Fri Mar  5 20:58:37 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: Net::HTTPResponse#response is obsolete.
	  [ruby-core:02592]

	* lib/net/http.rb: Net::HTTPResponse#header is obsolete.

	* lib/net/http.rb: Net::HTTPResponse#read_header is obsolete.

Fri Mar  5 20:10:57 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c: new method StringScanner#initialize_copy
	  to allow #dup and #clone.

	* test/strscan/test_strscan.rb: test StringScanner#dup.

Fri Mar  5 19:42:09 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (HTTPResponse#to_ary): should return an object
	  which does not respond to #to_ary.  It causes infinite loop in
	  puts. [ruby-core:02578]

Fri Mar  5 00:51:35 2004  Dave Thomas  <dave@pragprog.com>

	* lib/test/unit.rb: Move RDoc documentation so that you can
	  now say 'ri Test::Unit'

Thu Mar  4 22:31:40 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in: miniruby is not needed for cross compile.

	* configure.in (PREP): miniruby for native compile.

Thu Mar  4 11:46:32 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/drb/extservm.rb (DRb::ExtServManager#invoke_service_command):
	  detach server processes to get rid of zombies.

Thu Mar  4 10:41:25 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ruby.h (T_MASK): save 1 bit in flags bits by shifting T_xxx
	  values.

Thu Mar  4 08:08:36 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c: get rid of warnings.

	* lib/rss/taxonomy.rb: ditto.

	* lib/rdoc/ri/ri_formatter.rb: ditto.

	* test/ruby/test_assignment.rb: ditto.

Thu Mar  4 01:17:28 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/ri_display.rb (DefaultDisplay::page): wait until the
	  pager terminates.

Wed Mar  3 13:10:56 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (method_hash): new method. [ruby-talk:93968]

	* eval.c (proc_eq): do not compare dyna_vars.

	* eval.c (proc_hash): new method.

	* eval.c (rb_yield_0): protect break/return from within orphan (or
	  lambda) Proc object.

Wed Mar  3 09:52:05 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb ($topdir): use compile_dir only when not installed yet.
	  [ruby-talk:94098]

Wed Mar  3 01:18:52 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/converter.rb: handled Uconv::Error.

	* lib/rss/dublincore.rb: DublincoreModel -> DublinCoreModel

Wed Mar  3 00:59:30 2004  David Black  <dblack@wobblini.net>

	* lib/scanf.rb: soak_up_spaces only ungetc's non-space last
	  character

	* lib/scanf.rb: IO#block_scanf now returns partial last iteration
	  array if format string matches partly

Tue Mar  2 16:30:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): erred program name should be reported by
	  exceptions, instead of the first argument.

	* process.c (rb_spawn): ditto.

	* process.c (proc_spawn_v): use first argument as program name.

	* win32/win32.c (rb_w32_aspawn): ditto.

	* win32/win32.c (CreateChild): search executable file if no program
	  name given.

	* lib/drb/extservm.rb (invoke_service_command): use Process.spawn.
	  [ruby-dev:23103]

	* lib/rdoc/ri/ri_display.rb (setup_pager): use IO.popen.
	  [ruby-dev:23086], [ruby-dev:23103]

	* lib/rdoc/diagram.rb (convert_to_png): ditto.

	* lib/rdoc/generators/chm_generator.rb (compile_project): ditto.

Tue Mar  2 12:24:03 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub, wince/Makefile.sub (config.h): shouldn't check
	  defined? NORETURN. [ruby-dev:23100]

Tue Mar  2 11:28:40 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_iterator.rb (test_ljump): cannot use
	  assert_nothing_raised due to passing block.

Tue Mar  2 06:23:14 2004  David Black  <dblack@wobblini.net>

	* lib/scanf.rb: fixed Kernel#scanf to propagate code block

Mon Mar  1 23:25:40 2004  David Black  <dblack@wobblini.net>

	* lib/scanf.rb: Partial fix so STDIN#scanf works with new
	 STDIN#pos behavior

Mon Mar  1 19:42:05 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/setup.mak: configure's default is "--enable-install-doc"

	* win32/setup.mak: ditto.

Mon Mar  1 12:24:10 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_alias):
	  Allow aliases to have parentheses

Sun Feb 29 23:14:53 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_class):
	  Handle :nodoc: on singleton classes.

Sat Feb 28 21:50:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bcc32/Makefile.sub, bcc32/README.bcc32, bcc32/configure.bat,
	  bcc32/setup.mak: new configure scheme. use ``configure --prefix=dir''
	  instead of ``make DESTDIR=dir install''.
	  --with-static-linked-ext support on bccwin32. [ruby-dev:23034]

Sat Feb 28 21:50:20 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/setup.mak: "configure --disable-install-doc" is now working.

	* win32/setup.mak: ditto.

Sat Feb 28 15:09:49 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/configure.bat: append missing label ":exit".

	* bcc32/configure.bat: fix typo.

Sat Feb 28 10:31:03 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* MANIFEST: add test_erb.rb

	* lib/erb.rb, test/erb/test_erb.rb: don't forget filename,
	  if both filename and safe_level given. [ruby-dev:23050]

Sat Feb 28 01:08:40 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (yylex): should not allow symbol for invalid global
	  variable (e.g. `:$-)`). [ruby-core:02518]

Fri Feb 27 20:37:09 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): no orphan block check is needed when pcall
	  is true.

	* eval.c (localjump_destination): update localjump condition.

Fri Feb 27 02:10:49 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (localjump_destination): lambda should not interfere
	  return from the yielded block.

Fri Feb 27 00:53:49 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb, test/drb/drbtest.rb: require drb/eq.rb by default

Thu Feb 26 12:15:02 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (make_cmdvector): adjust successive double-quote
	  handling.

Thu Feb 26 09:42:56 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (delete_if_i): use st_delete_safe() (via
	  rb_hash_delete()) instead of returning ST_DELETE.

Thu Feb 26 02:35:10 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_f_exec): get rid of SEGV when exec failed for command
	  in single string.

Wed Feb 25 21:17:33 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (obj_free), io.c (rb_io_fptr_finalize), rubyio.h (OpenFile):
	  sharing OpenFile.

	* io.c (rb_io_initialize): accept IO instance.  [ruby-dev:22195]

Wed Feb 25 21:16:10 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (with_destdir): should return the given argument if no
	  DESTDIR is given.

	* instruby.rb: use path name expansion of cmd.exe.

Wed Feb 25 20:44:45 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/cgi-lib.rb, lib/getopts.rb, lib/importenv.rb, lib/parsearg.rb:
	  warn with caller position.

	* test/rss/test_content.rb, test/rss/test_dublincore.rb,
	  test/rss/test_syndication.rb, test/rss/test_trackback.rb: use cgi
	  instead of cgi-lib.

Tue Feb 24 18:42:03 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (glob_helper): '**/' should not match leading period
	  unless File::FNM_DOTMATCH is set. (like '*/') [ruby-dev:23014]

Tue Feb 24 18:03:14 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_file.rb (test_fnmatch): test for dir.c:1.108.

Tue Feb 24 17:07:17 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (fnmatch): File.fnmatch with File::FNM_PATHNAME was broken
	  for the pattern including '*' followed by '/'.

Tue Feb 24 13:22:21 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/rdoc.rb (RDoc::RDoc::normalized_file_list): Attempt to get better
	  heuristics on which files to include and exclude. Now only include
	  non-standard files if they are explicitly named in ARGV.

Tue Feb 24 07:23:30 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb: Deal with :stopdoc: when
	  choosing a default main page to display (ie. don't select a page
	  if we don't have documentation for it).

Tue Feb 24 06:40:14 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RubyLex::identify_identifier): Handle
	  class variables in code listings

Tue Feb 24 06:32:27 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::do_aliases): Handle
	  aliases in C files.

Tue Feb 24 06:16:22 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/rdoc.rb (RDoc::RDoc::document): Now create op dir _before_
	  parsing files.

Tue Feb 24 06:08:47 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_constant):
	  Start collecting text of constant values earlier: was missing
	  values in output if there was no space after '='

Tue Feb 24 06:08:25 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb: Escape contant values.

Tue Feb 24 03:45:06 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_config.c (ossl_config_each): add new method
	  OpenSSL::Config#each. it iterates with section name, field name
	  and value.

	* ext/openssl/ossl_config.c (Init_ossl_config): include Enumerable.

Mon Feb 23 09:09:44 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* instruby.rb (parse_args): use optparse instead of getopts.

	* instruby.rb (DOSISH): embedded path in batch files should not be
	  prefixed by DESTDIR.  [ruby-core:02186]

Sun Feb 22 14:58:04 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: $extstatic is Array or nil now.  [ruby-talk:93383]

	* Makefile.in, bcc32/Makefile.sub, win32/Makefile.sub: terminate options.

	* lib/mkmf.rb (init_mkmf): $INCFLAGS also should be lazy-evaluated.

Sun Feb 22 13:05:37 2004  akira yamada  <akira@ruby-lang.org>

	* lib/uri/mailto.rb (URI::MailTo::to_s): should include fragment.

Sun Feb 22 12:58:35 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: use optparse instead of getopts.

	* Makefile.in, bcc32/Makefile.sub, win32/Makefile.sub: ditto.

Sun Feb 22 09:51:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* re.c: corrected documentation format (rb_reg_initialize_m)

Sat Feb 21 22:41:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* ext/zlib/zlib.c: documented, but needs more effort.

Sat Feb 21 14:33:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: prefer relative path.  [ruby-talk:93037]

Sat Feb 21 11:12:08 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/os2.c, missing/x68.c: typo fix.  pointed out by greentea.

Fri Feb 20 19:11:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct#initialize_copy): should not share
	  members.  [ruby-dev:22966]

Fri Feb 20 18:59:47 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/init.rb (IRB::IRB.parse_opts): add -I option to
	  irb. [ruby-dev:39243]

Fri Feb 20 12:55:27 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): fix typo.

	* win32/win32.c (CreateChild): first argument to CreateProcess() must
	  have path, not just basename.

Thu Feb 19 23:24:16 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb (Generators::HtmlClass::build_attribute_list):
	  Support visibility modifiers for attributes

Thu Feb 19 22:39:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/ostruct.rb: documented

Thu Feb 19 22:39:04 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/rinda/test_rinda.rb: DRb.start_service only once in testsuites.
	  DRb.start_service could handle this.

Thu Feb 19 22:24:04 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/mapping/rubytypeFactory.rb: should not dump singleton class.
	  [ruby-dev:22588]
	  c = class << Object.new; class C; self; end; end; SOAPMarshal.dump(c)

Thu Feb 19 18:08:18 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* ext/strscan/strscan.c: improved documentation

Thu Feb 19 18:08:18 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c, win32/win32.h: fixed prototypes.

	* win32/win32.c (wait): same as waitpid() with -1.

Thu Feb 19 02:34:28 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/markup/simple_markup/preprocess.rb (SM::PreProcess::include_file):
	  Only strip comment markers if all lines start with comments.

Thu Feb 19 03:05:49 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c: StringScanner#restsize is obsolete;
	  use #rest_size instead.

	* ext/strscan/strscan.c: StringScanner#matchedsize is obsolete;
	  use #matched_size instead.

Thu Feb 19 02:42:19 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c: don't use rb_eval_string, it defines
	  classes under the module when required in module clauses.
	  [ruby-dev:22951]

Thu Feb 19 02:37:28 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c: merge documentation from 1.8 branch.
	  Thanks Gavin Sinclair.

Thu Feb 19 00:20:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/cgi-lib.rb:   deprecated after 1.8.1

	* lib/getopts.rb:   ditto

	* lib/importenv.rb: ditto

	* lib/parsearg.rb:  ditto

Thu Feb 19 00:11:05 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/markup/simple_markup/preprocess.rb (SM::PreProcess::handle):
	  Strip extraneous space from filenames in :include:

Wed Feb 18 22:53:41 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/unix.rb: remove O_NONBLOCk, thanks \ay

Wed Feb 18 22:42:19 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb: improt test_rinda.rb

Wed Feb 18 22:03:11 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/*: should not depend on $KCODE.

Wed Feb 18 18:07:09 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_sprintf.rb: added tests.

Wed Feb 18 17:18:01 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/win32ole/win32ole.c: need to include <olectl.h> on Cygwin.

Wed Feb 18 10:40:38 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): sign bit extension should not be done
	  if FPLUS flag is specified.  [ruby-list:39224]

	* sprintf.c (rb_f_sprintf): do not prepend dots for negative
	  numbers if FZERO is specified.  [ruby-dev:39218]

Wed Feb 18 10:23:34 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): clean up.

Tue Feb 17 23:40:34 2004  Guy Decoux  <ts@moulon.inra.fr>

	* sprintf.c (rb_f_sprintf): preserve original val for
	  format_integer. [ruby-talk:92975]

Tue Feb 17 23:28:45 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/marshal/test_marshal.rb, test/ruby/test_marshal.rb: do $:
	  trick to share the testcase test/ruby/marshaltestlib.rb.

Tue Feb 17 23:13:23 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/marshaltestlib.rb: common marshal testcase added.

	* test/ruby/test_marshal.rb: use above testsuite.

	* test/soap/marshal/test_marshal.rb: ditto.

	* test/soap/marshal/cmarshal.rb: removed (not used).

Tue Feb 17 19:34:26 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): $extout_prefix doesn't vary for libraries.

	* ext/extmk.rb (extmake): remove compile directory if empty.

	* ext/extmk.rb (parse_args) lib/mkmf.rb (create_makefile): move
	  initialization of $extout_prefix from lib/mkmf.rb.  [ruby-dev:22928]

	* ext/extmk.rb: clear ext and extout directory when cleaning.

	* lib/mkmf.rb (CLEANLIBS): should be under $(arch) directory.

Tue Feb 17 18:02:10 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c: ScanError may be (wrongly) garbage
	  collected. (thanks Gavin Sinclair)

	* ext/strscan/strscan.c: move ::ScanError to StringScanner::Error.
	  ::ScanError is also defined for backward compatibility.

	* ext/strscan/strscan.c: #peep is obsolete, use #peek.

	* ext/strscan/strscan.c: #empty? is obsolete, use #eos?.

	* ext/strscan/strscan.c: #clear is obsolete, use #terminate.

	* ext/strscan/strscan.c: #getbyte is obsolete, use #get_byte.

Tue Feb 17 12:12:47 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (parse_args): delay expanding $(extout) until invoking
	  make.

	* lib/mkmf.rb (CLEANLIBS): should remove files have specific
	  extensions.

Tue Feb 17 11:33:30 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rss/rexmlparser.rb: REXML version may be 4 digits.

Tue Feb 17 10:45:59 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/syck/rubyext.c (syck_emitter_end_object): takes only one arg.

Tue Feb 17 07:48:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rexml/encodings/SHIFT_JIS: wrong library name.

Tue Feb 17 01:35:28 2004  Tanaka Akira  <akr@m17n.org>

	* eval.c (rb_eval): care that another thread replace NODE_DREGX_ONCE
	  to NODE_LIT.  [ruby-dev:22920]

Tue Feb 17 01:20:57 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb: new module FileUtils::DryRun.

Mon Feb 16 23:28:14 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb: document reduction.  [ruby-core:02429]

	* test/yaml/test_yaml.rb: added 0..1 test with "0".."1" on display.
	  it should be defined that the specification about what kind of Range
	  is supported in ruby's custom type in YAML.

Mon Feb 16 22:22:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/generator.rb: corrected doc format

	* lib/rinda/rinda.rb: added documentation (from Hugh Sasse)

	* lib/rinda/tuplespace.rb: ditto

	  [Note: rinda files actually committed Wed Feb 18 07:27:00 2004]

Mon Feb 16 20:28:52 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/Makefile.sub: show more warnings. (referring to mingw)

	* bcc32/setup.mak: ditto.

Mon Feb 16 18:35:58 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.status): should create *.pdb on ext/,
	  not .ext/.

	* win32/Makefile.sub (config.status): convert the name of import
	  library.

	* lib/mkmf.rb (create_makefile): now don't need to remove
	  $(TARGET).lib.

Mon Feb 16 15:45:22 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check functions, fork spawnv.

	* io.c (rb_io_s_popen): accept argv not only single command line.

	* process.c (rb_proc_exec_n): export.

	* process.c (rb_check_argv): check if arguments are safe to invoke.

	* process.c (rb_fork): retry to fork.

	* process.c (rb_spawn): spawn child process asynchronously.

	* process.c (rb_f_system): raise an exception if the command could not
	  execute.

	* win32/win32.c (rb_w32_argv_size): count necessary size for joined
	  arguments.

	* win32/win32.c (rb_w32_join_argv): join arguments with quoting.

	* win32/win32.c (rb_w32_pipe_exec, rb_w32_spawn, rb_w32_aspawn):
	  accept program name adding to command line.

Mon Feb 16 15:18:33 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/racc/parser.rb: add note for Racc full package.

Mon Feb 16 15:13:01 2004  Minero Aoki  <aamine@loveruby.net>

	* ext/racc/cparse/README: new file.

	* ext/racc/cparse/MANIFEST: add README.

Mon Feb 16 12:29:10 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_s_list): new method Iconv.list
	  (libiconv only).

Mon Feb 16 10:29:52 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (CompareImpl): File.fnmatch and Dir.glob get better performance
	  in Win32. This is achieved by calling downcase() for single-byte
	  characters. (CharLower() is slower than downcase())

Mon Feb 16 02:14:29 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* bcc32/Makefile.sub: should warn suspicious pointer conversion.

	* bcc32/setup.mak: ditto.

Sun Feb 15 20:56:22 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (push_braces): remove wrong const. [ruby-dev:22891]

Sun Feb 15 20:41:15 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* sample/soap/calc/httpd.rb, sample/soap/exchange/httpd.rb,
	  sample/soap/sampleStruct/httpd.rb, sample/wsdl/googleSearch/httpd.rb:
	  use soap/property instead of getopts for configuring DocumentRoot
	  and port# of httpd.  see samplehttpd.conf below.

	* sample/soap/calc/samplehttpd.conf,
	  sample/soap/exchange/samplehttpd.conf,
	  sample/soap/sampleStruct/samplehttpd.conf,
	  sample/wsdl/googleSearch/samplehttpd.conf: added.

Sun Feb 15 19:13:33 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/tuplespace.rb: read(tpl,0), raise RequestExpiredError
	  if not found.

Sun Feb 15 15:48:57 2004  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c: add IDispatch wrapper in val2variant.
	  Thanks, arton.

Sun Feb 15 15:23:29 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* ruby.h, dir.c (rb_glob): add const.

Sun Feb 15 01:46:05 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/mkmf.rb: absolute path of ruby is assigned to $(RUBY).
	  [ruby-dev:22870]

Sat Feb 14 23:59:11 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* mkconfig.rb: use fileutils.rb instead of ftools.rb.

	* bcc32/Makefile.sub, win32/Makefile.sub (config.h): define
	  STACK_GROW_DIRECTION.

	* bcc32/Makefile.sub (config.h): add newer checks.

	* wince/Makefile.sub (config.h): define NEED_IO_SEEK_BETWEEN_RW.

Sat Feb 14 23:26:27 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/un.rb: use OptionParser instead of getopts.

Sat Feb 14 11:28:14 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* sample/drb/*: import lib/drb/sample

Sat Feb 14 11:14:12 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: add pretty_print, thanks gotoken.

Fri Feb 13 21:51:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/fileutils.rb: slightly improved documentation (sync with 1.8)

Fri Feb 13 19:57:01 2004  Kouhei Sutou  <kou@cozmixng.org>

	* test/rss/test_trackback.rb: added tests for TrackBack with RSS
	  2.0.

	* test/rss/common.rb: added methods make RSS 2.0.

	* lib/rss/trackback.rb: TrackBack API is decided.

	* lib/rss/rss.rb: RSS::VERSION 0.0.7 -> 0.0.8.

	* lib/rss/parser.rb, lib/rss/rss.rb: replaced $DEBUG by RSS::DEBUG.

	* lib/rss/2.0.rb: removed RSS 2.0 URI. Because RSS 2.0 doesn't
	  have URI.

Fri Feb 13 14:41:00 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: en-bugged at last commit (Feb 11 23:24:22 2004)

Fri Feb 13 12:26:37 2004  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb: rescue SystemCallError instead
	  of EINVAL.  File.link may raise EACCES on network file systems.

Fri Feb 13 05:18:58 2004  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb: File.link raises EINVAL on
	  Win9x. [ruby-dev:22713]

Thu Feb 12 21:49:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/ftools.rb: documented

Thu Feb 12 21:19:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/base64.rb: added and tidied documentation

Thu Feb 12 20:45:01 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/protocol.rb (WriteAdapater#puts): must append "\n" to
	  the string, don't prepend. (ruby-bugs:PR#1280)

Thu Feb 12 20:31:43 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_tmpsrc): cpp32 of Borland C++ ignores #error
	  directives in DOS line-ending files at all.

Thu Feb 12 15:23:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rparen): ignore preceding newlines to right parentheses.
	  (ruby-bugs:PR#1221) [ruby-dev:22858]

Thu Feb 12 14:17:43 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: set ac_cv_func_link to yes to enable link() on MinGW.
	  [ruby-dev:22241]

Thu Feb 12 13:32:49 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (link): raise NotImplementedError on Win9X.
	  contributed by Tietew. [ruby-dev:22713]

	* win32/win32.c, win32/win32.h (link): add const.

Thu Feb 12 09:56:19 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/lib/tk.rb (TkComm::tk_split_list): suppress a warning.

Thu Feb 12 02:23:56 2004  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb: use assert_raise instead of assert_raises.

	* lib/pp.rb: ditto.

	* lib/time.rb: ditto.

	* lib/tsort.rb: ditto.
	  use TSortHash and TSortArray instead of Hash and Array in test.

Wed Feb 11 23:24:22 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: properly treat a Tcl/Tk's string with escaping
	  special characters.

Tue Feb 10 20:49:07 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (method_proc): return bound Proc object.  [ruby-dev:22854]

	* eval.c (rb_mod_define_method): bind method body itself for Method
	  object.

	* node.h (NODE_DMETHOD): deprecated.

	* object.c (rb_class_inherited_p): export.

Tue Feb 10 16:43:50 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (umethod_bind): purge unused check.  [ruby-dev:22850]

Tue Feb 10 14:33:08 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* string.c (rb_str_match): raise TypeError when both arguments are
	  strings. [ruby-dev:22851]

	* string.c (rb_str_match2): removed.

	* Makefile.in, bcc32/Makefile.sub, win32/Makefile.sub,
	  wince/Makefile.sub (string.c): now not depend on version.h.

Mon Feb  9 17:46:07 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in, bcc32/Makefile.sub, win32/Makefile.sub, configure.in,
	  runruby.rb: run rdoc, test and so on with compiled extension
	  libraries.  [ruby-dev:22688]

	* ext/extmk.rb, lib/mkmf.rb: make extension libraries in separated
	  directory, similar to the actual directory structure.

	* lib/fileutils.rb (FileUtils.copy_file): use the mode of the original
	  file to create new file.

	* lib/rdoc/ri/ri_paths.rb (RI::Paths::SYSDIR): get rid of unexpected
	  influence by environment variable.

	* bcc32/configure.bat, win32/configure.bat: add install-doc options.

	* win32/win32.c, win32/win32.h (rb_w32_fstat): fix Borland C runtime
	  bug which returns wrong mode.  [ruby-dev:22846]

Mon Feb  9 16:30:12 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (detach_process_watcher): return the last status.
	  [ruby-dev:22841]

Sun Feb  8 16:46:08 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pp.rb (PP::PPMethods::object_address_group): suppress negative
	  sign for higher heap areas.

Sun Feb  8 16:18:27 2004  akira yamada  <akira@ruby-lang.org>

	* test/yaml/test_yaml.rb (YAML_Unit_Tests::test_range_cycle):
	  added tests.

Sun Feb  8 15:51:57 2004  akira yamada  <akira@ruby-lang.org>

	* test/ruby/test_file.rb (TestFile::test_fnmatch): added tests for
	  File.fnmatch. [ruby-dev:22815][ruby-dev:22819]

Sun Feb  8 15:41:45 2004  akira yamada  <akira@ruby-lang.org>

	* test/yaml/test_yaml.rb (YAML_Unit_Tests::test_range_cycle):
	  added tests. [ruby-core:02306] [ruby-core:02311]

Sun Feb  8 14:24:35 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (HTTP#request): should not overwrite Connection
	  header. (ruby-bugs:PR#1274)

Sun Feb  8 10:11:21 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (glob_helper): Dir.glob('**/') did not work. [ruby-dev:22832]

Sun Feb  8 00:29:26 2004  Hirokazu Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (fnmatch): File.fnmatch('*?', 'a') should return true.
	  [ruby-dev:22815]

	* dir.c (fnmatch): File.fnmatch('\[1\]' , '[1]') should return true.
	  [ruby-dev:22819]

	* dir.c: Did some styles (no change to behavior)

Sat Feb  7 19:56:11 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/init.rb (IRB.rc_files): yield possible rc file names.

	* lib/irb/input-method.rb (IRB::ReadlineInputMethod::initialize):
	  load and save history automatically.  [ruby-core:02352]

Fri Feb  6 22:48:16 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb (gen_url): Support
	  https in RDoc hyperlinks

Fri Feb  6 22:41:22 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/pp.rb (PPInspectTest#test_to_s_with_iv): rollback the previous
	  commit.  [ruby-dev:22813]

Fri Feb  6 22:22:50 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/pp.rb (PPInspectTest#test_to_s_with_iv): remove instance
	  variable which is defined in the test.

Fri Feb  6 18:54:18 2004  akira yamada  <akira@ruby-lang.org>

	* test/ruby/test_proc.rb (TestProc::test_eq): added a
	  test.  [ruby-dev:22599]

Fri Feb  6 18:26:00 2004  akira yamada  <akira@ruby-lang.org>

	* test/ruby/test_proc.rb (TestProc::test_eq): added tests for
	  Proc#==.  [ruby-dev:22592], [ruby-dev:22601]

Fri Feb  6 10:12:06 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (bsock_do_not_reverse_lookup): control reverse
	  lookup for every instance.  [ruby-core:02346]

Fri Feb  6 09:15:11 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/extend-command.rb: add irb_help command.  [ruby-talk:91610]

	* lib/irb/cmd/help.rb (IRB::ExtendCommand::Help): show RDoc.

Fri Feb  6 00:48:37 2004  Tanaka Akira  <akr@m17n.org>

	* lib/prettyprint.rb (PrettyPrint#first?): obsoleted.

Thu Feb  5 23:56:55 2004  Tanaka Akira  <akr@m17n.org>

	* lib/prettyprint.rb (PrettyPrint#seplist): added.

	* lib/pp.rb (PPMethods#pp_object): use seplist.
	  (PPMethods#pp_hash): ditto.
	  (Array#pretty_print): ditto.
	  (Struct#pretty_print): ditto.
	  (MatchData#pretty_print): ditto.

	* lib/set.rb (Set#pretty_print): use seplist.

Wed Feb  4 22:39:46 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_stat_mode): should not sign-expand, so backout.

Wed Feb  4 02:12:06 2004  Tanaka Akira  <akr@m17n.org>

	* file.c (test_l): fix wrong method name in document.
	  (test_S): ditto.
	  (test_b): ditto.
	  (test_c): ditto.
	  (test_suid): ditto.
	  (test_sgid): ditto.
	  (test_sticky): ditto.

Tue Feb  3 22:36:25 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/2.0.rb, lib/rss/content.rb, lib/rss/dublincore.rb,
	  lib/rss/rss.rb, lib/rss/syndication.rb: removed warnings.

	* lib/rss/converter.rb: removed handling load error of nkf.

	* test/rss/test_syndication.rb, test/rss/test_trackback.rb,
	  test/rss/test_dublincore.rb, test/rss/test_content.rb: replaced
	  'require "rss/parser"' by 'require "rss/1.0"'.

	* test/rss/test_parser.rb, test/rss/test_accessor.rb: removed
	  'require "rss/parser"'.

Tue Feb  3 11:23:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (reduce_nodes): remove tail returns.  [ruby-talk:90934]

Tue Feb  3 08:04:57 2004  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb (Struct#pretty_print_cycle): follow 1.8 style.

Mon Feb  2 22:06:31 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (block_append, new_evstr, void_expr0): remove no longer used
	  labels.

Mon Feb  2 18:45:50 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* dln.c (dln_load): don't specify RTLD_GLOBAL on Interix,
	  because it caused SEGV when running runner.rb.

Mon Feb  2 01:54:00 2004  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb (Struct#pretty_print): make it 1.8 style.
	  (Numeric#pretty_print, FalseClass#pretty_print)
	  (TrueClass#pretty_print, Module#pretty_print): fix pp for objects
	  with instance variables.  [ruby-talk:91157]

	* lib/open-uri.rb (URI::Generic#find_proxy): return nil on loopback
	  address.

	* lib/resolv-replace.rb (BasicSocket#send): don't replace because
	  it has no hostname argument.
	  (IPSocket.getaddress): raise SocketError instead of
	  Resolv::ResolvError for errors.
	  (TCPSocket#initialize, UDPSocket#bind, UDPSocket#connect)
	  (SOCKSSocket#initialize): use IPSocket.getaddress instead of
	  Resolv.getaddress.
	  (UDPSocket#send): recognize 3 arguments form.  try all addresses on
	  4 arguments form.

Sun Feb  1 23:00:00 2004  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal.c: Bug in BigDecimal("1e#{n}").add BigDecimal('.5'),n)
	  reported and fixed by Javier Goizueta.

Sun Feb  1 18:21:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	  From ruby_1_8 branch:
	* lib/test/unit.rb: rearranged documentation for RDoc's sake.
	* lib/matrix.rb: improved documentation.
	* lib/net/http.rb: slight documentation formatting improvement.

Sun Feb  1 05:30:06 2004  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::Generic#find_proxy): warn HTTP_PROXY.
	 raise an error on non-http proxy URI.
	 (OpenURI::Buffer#<<): make a tempfile binmode.  [ruby-talk:90793]

Sun Feb  1 00:57:41 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/parser.rb (RSS::Parser): added @@default_parser. Used
	  XML parser became selectable.
	* test/rss/test_parser.rb: added tests for
	  RSS::Parser.default_parser.

Sat Jan 31 02:28:15 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (RPATHFLAG): set to -Wl,-R like NetBSD on Interix.

Sat Jan 31 01:09:41 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: leading 0 padding of timestamp usec part.

Fri Jan 30 18:53:23 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* re.c (KR_REHASH): wrong hash value on sizeof(long) > sizeof(int).

Thu Jan 29 23:11:57 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (DLEXT2): removed.  Ruby does not treat
	  ".dll" as a extension library anymore.

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub (DLEXT2):
	  ditto.

	* util.c (mblen): fix overrun.  [ruby-dev:22672]

Thu Jan 29 22:41:53 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb: Allow 'link:' in Tidylinks.
	  THis means you can write "see f1[link:files/f1_rb.html]".

Thu Jan 29 22:24:47 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* sample/openssl/gen_csr.rb: follow OpenSSL::X509::Name change.
	  ASN.1 type of subject DN elements were wrong.

Thu Jan 29 22:19:51 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/*: remove $: trick.  [ruby-dev:22763]  use test/runner.rb to
	  run test.

Thu Jan 29 19:28:16 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (Request#initialize): reject only when a path is
	  empty. [ruby-dev:22771]

Thu Jan 29 18:54:08 2004  H.Yamamoto  <ocean@m2.ccsnet.ne.jp>

	* dir.c (glob_helper): infinite loop bug in win32 code.
	  [ruby-dev:22770]

Thu Jan 29 17:03:49 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c: merge tuning from H.Yamamoto <ocean@m2.ccsnet.ne.jp>.
	  [ruby-dev:22761]

Thu Jan 29 11:32:14 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/rss/test_*: do $: trick while searching a module in the current
	  directory.

	* test/xsd/test_xmlschemaparser.rb, test/wsdl/test_emptycomplextype.rb,
	  test/soap/helloworld/test_helloworld.rb,
	  test/soap/calc/{test_calc.rb,test_calc2.rb}: do File.expand_path
	  before using __FILE__.

	* test/yaml/test_yaml.rb: assert_equals -> assert_equal.

Thu Jan 29 01:56:02 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c: usec round-tripping skew. [ruby-core:2305]

	* lib/yaml/rubytypes.rb: character Range now round-trips. [ruby-core:2306]

	* test/yaml/test_yaml.rb: add Time and Range tests.

Thu Jan 29 00:00:46 2004  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss: rss/parser.rb is always required.

Wed Jan 28 15:09:14 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rss/*.rb: remove "test/" prefix.

Wed Jan 28 13:07:02 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/extconf.rb: include iconv.h for libiconv.  [ruby-dev:22715]

Wed Jan 28 12:43:07 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/rss: rss library imported. [ruby-dev:22726]

Wed Jan 28 04:29:41 2004  Eric Schwartz  <emschwar@fc.hp.com>

	* lib/cgi/session.rb: use LOCK_SH to read, and a few other
	  improvements.  [ruby-core:02328]

Tue Jan 27 15:00:14 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el: better support for general delimited
	  strings.  [ruby-dev:22695]

Tue Jan 27 11:04:40 2004  FUKUMOTO Atsushi  <fukumoto@nospam.imasy.or.jp>

	* ext/socket/socket.c (s_recvfrom): sending length should be an
	  invariant while retrying on EAGAIN.  [ruby-talk:89962]

Tue Jan 27 10:31:28 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/win32ole/win32ole.c (set_argv): fix condition.

Tue Jan 27 02:26:31 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (WEBrick:HTTPUtils::parse_header):
	  refine regex for header-name.

Mon Jan 26 22:53:04 2004  Dave Thomas  <dave@pragprog.com>

	* io.c: Remove documentation references to $defout.

Mon Jan 26 14:41:46 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/weakref.rb (WeakRef::initialize): set up @__id before
	  calling "super".

	* lib/delegate.rb (Delegator::initialize): preserve
	  singleton_method_added method [ruby-dev:22685]

	* lib/delegate.rb (Delegator::initialize): use Kernel::raise
	  instead of mere raise.  [ruby-dev:22681]

Mon Jan 26 12:45:23 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: define CONST84 when TCL_MAJOR_VERSION == 7

Mon Jan 26 11:30:58 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: Makefiles should depend on also rbconfig.rb.
	  (ruby-bugs:PR#1256)

	* ext/win32ole/win32ole.c (set_argv): set real arguments to
	  WIN32OLE::ARGV.  [ruby-list:39073]

Sun Jan 25 18:25:26 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509name.c (ossl_x509name_add_entry): third
	  argument become optional.

	* ext/openssl/ossl_x509name.c (ossl_x509name_initialize): ditto.

	* ext/openssl/ossl_x509name.c (Init_x509name): emailAddress and
	  domainComponent should be IA5String.

Sun Jan 25 01:45:38 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#run): support
	  virtual host.

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#virtual_host): add
	  new method to register virtual hosting server.

	* lib/webrick/httpserver.rb (WEBrick::HTTPServer#lookup_server): add
	  new method to lookup virtual hosting server.

Sat Jan 24 13:06:26 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509hame.c (ossl_x509name_initialize): change
	  second argument. it expected to be a Hash not an Integer.

	* ext/openssl/ossl_x509name.c (ossl_x509name_add_entry): add new
	  function for OpenSSL::X509::Name#add_entry.

	* ext/openssl/ossl_x509name.c (Init_ossl_x509name): add constants
	  OpenSSL::X509::Name::DEFAULT_OBJECT_TYPE and OBJECT_TYPE_TEMPLATE.

	* ext/openssl/lib/openssl/x509.rb (OpenSSL::X509::Name#initialize):
	  second argument takes OBJECT_TYPE_TEMPLATE by default.

Fri Jan 23 02:26:30 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (num2i32): pack should not raise RangeError.
	  [ruby-dev:22654]

	* pack.c (pack_pack): do not auto convert nil to zero.

Thu Jan 22 22:54:53 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (BEG_REGEXP): allow 8-bit characters in quoted
	  strings for Novell GroupWise Internet Agent.

	* lib/net/imap.rb (DATA_REGEXP): ditto.

Thu Jan 22 18:35:49 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/e2mmap.rb (VERSION): remove unnecessary version checking.

Thu Jan 22 16:21:02 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (string_content): reset lexical states at the beginning of
	  string contents.  [ruby-list:39061]

Thu Jan 22 08:08:50 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (opt_rescue): use NODE_ERRINFO() instead of
	  NODE_GVAR("$!"), to avoid confusion from variable aliasing.
	  [ruby-talk:90074]

	* version.c (Init_version): remove obsolete constants VERSION
	  etc.  [ruby-dev:22643]

Thu Jan 22 01:46:32 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (newline_node): do not use NODE_NEWLINE node anymore,
	  use NEWLINE flag instead.

Thu Jan 22 01:12:12 2004  Siena.  <siena@faculty.chiba-u.jp>

	* missing/os2.c (chdir, getcwd):
	  use _chdir2 and _getcwd2 supporting multiple drives in OS/2 with EMX.

Thu Jan 22 00:33:52 2004  Siena.  <siena@faculty.chiba-u.jp>

	* configure.in: check availability of link(). [ruby-dev:22237]
	* file.c (rb_file_s_link): raise an exception when link() is unavailable.
	* missing/os2.c (link): removed. File#link isn't supported.
	* bcc32/Makefile.sub: define HAVE_LINK to enable link(). [ruby-dev:22241]
	* win32/Makefile.sub: ditto.

Thu Jan 22 00:26:25 2004  Siena.  <siena@faculty.chiba-u.jp>

	* ChangeLog: typo: RUBY_MBCHAR_MAX was RUBY_MBCHAR_MAXSIZE.

Thu Jan 22 00:12:51 2004  Siena.  <siena@faculty.chiba-u.jp>

	* defines.h: define RUBY_MBCHAR_MAX instead of MB_CUR_MAX.
	* dir.c (Next, emx_mblen): use RUBY_MBCHAR_MAX for mblen().
	* file.c (CharNext): ditto.
	* ruby.c (translate_char): ditto.
	* util.c (__crt0_glob_function): ditto.

Thu Jan 22 00:10:01 2004  Dave Thomas  <dave@pragprog.com>

	* lib/base64.rb: :nodoc: the Deprecated module

Wed Jan 21 23:52:39 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: Interix(SFU) support.

Wed Jan 21 23:03:45 2004  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: remove O_NONBLOCK, thanks \ay
	* lib/drb/extserv.rb: typo

Wed Jan 21 17:57:56 2004  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (envelope): allow NIL.
	* lib/net/imap.rb (body): ditto.
	* lib/net/imap.rb (number): ditto.
	* lib/net/imap.rb (ensure_nz_number): show a detailed error
	  message.

Wed Jan 21 16:44:15 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (merge_libs): squeeze successive same libraries.
	  [ruby-dev:22652]

Wed Jan 21 16:10:36 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/base64.rb: enclosed in a module.  [ruby-core:02285]

Wed Jan 21 16:01:26 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/digest/rmd160/extconf.rb: have_library appends found library.

Wed Jan 21 11:36:00 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (sock_gethostbyname): returns host if
	  ai_canonname is NULL. (ruby-bugs PR#1243)

	* parse.y (block_append): update nd_end for "real" head node.
	  [ruby-list:39058]

Tue Jan 20 14:48:28 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: should check <openssl/conf_api.h> instead
	  of OPENSSL_VERSION_NUMBER. [ruby-list:39056]

Tue Jan 20 14:43:17 2004  Dave Thomas  <dave@pragprog.com>

	* lib/base64.rb: Add RDoc

Tue Jan 20 14:25:51 2004  Dave Thomas  <dave@pragprog.com>

	* lib/abbrev.rb: Add RDoc

Tue Jan 20 13:22:39 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb: Document aliases at
	  top-most level.

	* lib/English.rb: Document English.rb.

Tue Jan 20 04:41:58 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_marshal.rb (MarshalTestLib::test_exception): test
	  for [ruby-dev:22604].

	* test/ruby/test_marshal.rb (MarshalTestLibtest_singleton): test
	  for [ruby-dev:22588].

Tue Jan 20 02:38:13 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_class): should not dump singleton class.
	  [ruby-dev:22631]

Tue Jan 20 02:49:22 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: add check for OpenSSL version.
	  [ruby-list:39054]

Mon Jan 19 23:56:20 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (name_err_mesg_to_str): inverted condition for result of
	  inspection.  [ruby-dev:22628]

Mon Jan 19 22:24:28 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* sample/exyacc.rb: escape '}' to avoid warning.

	* lib/rdoc/parsers/parse_c.rb: escape '{' and '}' to avoid warnings.

Mon Jan 19 21:28:06 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/digest/defs.h, win32/win3.c, win32/win32.h, file.c: remove
	  useless casts for Borland C.

Mon Jan 19 17:39:38 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (NameError::message): internal use only.

	* eval.c (rb_method_missing): use hidden constant.

Mon Jan 19 16:30:53 2004  akira yamada  <akira@ruby-lang.org>

	* test/ruby/test_time.rb: added tests for [ruby-dev:22614] and
	  [ruby-dev:22617].

Mon Jan 19 13:09:21 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/extmk.rb, win32/Makefile.sub, win32/configure.bat,
	  win32/setup.mak: --with-static-linked-ext support on mswin32.

Mon Jan 19 06:49:07 2004  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: zone was wrong when it was behind UTC.
	  Thanks Mark J. Reed.

	* lib/date/format.rb: %z is now always replaced by four digits
	  with a leading plus or minus sign.

	* sample/cal.rb: added a class, anyway.

Mon Jan 19 01:08:39 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c, error.c, eval.c, intern.h, object.c, variable.c:
	  do not set path if it is a singleton class.  [ruby-dev:22588]

	* lib/cgi.rb (CGI::QueryExtension): give extended string, not a
	  delegater object.

Sun Jan 18 23:59:44 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/charset_alias.rb: prefer us_EN locale encodings or
	  former.  [ruby-dev:22609]

	* ext/iconv/iconv.c (iconv_create): raise InvalidEncoding
	  exception when EINVAL.

Sun Jan 18 23:16:34 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c, error.c, file.c, io.c, numeric.c, object.c, re.c, struct.c,
	  time.c: marked init_copy functions nodoc.

Sun Jan 18 20:47:35 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ruby.c: use translate_char() on Cygwin.

Sun Jan 18 20:00:16 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/wsdlDriver.rb, lib/wsdl/soap/operation.rb: add support of
	  "parts" attribute of soap:body element in WSDL.

	* lib/wsdl/xmlSchema/schema.rb: friendly warning message for
	  simpleType element which is not supported for now.

	* test/wsdl/soap/{soapbodyparts.wsdl,test_soapbodyparts.wsdl}: new
	  files.

Sun Jan 18 16:46:48 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (time_overflow_p): should return results.  [ruby-dev:22614]

Sun Jan 18 12:07:24 2004  Siena.  <siena@faculty.chiba-u.jp>

	* test/ruby/test_time.rb: new test case to test Time#[+-].

	* time.c (time_plus, time_minus): fix RangeError for a negative
	  argument in environments whose time_t is unsigned. [ruby-dev:22608]

Sun Jan 18 02:33:26 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* defines.h (_WIN32): undef _WIN32 on Cygwin before defining DOSISH.

Sun Jan 18 00:23:55 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (class2path): check anonymous class/module before
	  checking referable, and allow singleton classes.

Sat Jan 17 23:58:51 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (NameError::Message): new class for lazy evaluation of
	  message to ensure replaced before marshalling.  [ruby-dev:22604]

	* eval.c (rb_method_missing): use NameError::Message.

Sat Jan 17 21:49:50 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/time.rb (test_rfc2822, test_rfc3339, test_encode_xmlschema):
	  should not expect that all platforms handle negative time_t value.

Fri Jan 16 23:53:09 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (proc_eq): compare also arguments and environment
	  (including local variables).  [ruby-dev:22590]

Fri Jan 16 14:33:35 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (class2path): get class path and check referable.
	  [ruby-dev:22588]

Thu Jan 15 12:58:26 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_read): do not append EOF.  (ruby-bugs-ja:PR#585)

	* io.c (rb_io_fwrite): ad-hockery hack to get rid of HP-UX stdio
	  weird behavior.  [ruby-dev:22424]

Wed Jan 14 21:13:06 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/inlinetest.rb (InlineTest::eval_part): eval under the top
	  level environment.

Wed Jan 14 17:54:17 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/inlinetest.rb (InlineTest::loadtest): require instead of
	  load, to get rid of multiple loading.

Wed Jan 14 13:30:52 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/extconf.rb: wrapper iconv.rb is dependent on platform.

Wed Jan 14 09:32:02 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* MANIFEST: add test/net/test_httpheader.rb. (commit miss?)

Wed Jan 14 00:58:35 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_Proc): move SystemStackError from under
	  StandardError to Exception.  [ruby-talk:89782]

Tue Jan 13 18:03:02 2004  Ian Macdonald  <ian@caliban.org>

	* file.c (rb_stat_wr, rb_stat_ww): New functions
	  implementing new methods (File::Stat#world_readable?,
	  File::Stat#world_writable?).

Tue Jan 13 16:53:25 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c: omission of Date library code caused
	  test suite failure. [ruby-core:2251]

Tue Jan 13 16:50:03 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: use $0 as the default application class name.

Tue Jan 13 14:48:00 2004  Ian Macdonald  <ian@caliban.org>

	* lib/pathname.rb: New methods (Pathname#world_readable?,
	  Pathname#world_writable?).

Tue Jan 13 14:48:01 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (primary): allow no "when" case. [ruby-dev:22578]

	* ruby.h (rb_class_of): reduce branch. [ruby-dev:22577]

	* ruby.h (rb_type): ditto.

Tue Jan 13 14:26:59 2004  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/test/unit/ui/testrunnerutilities.rb (TestRunnerUtilities):
	  moved run method which allows output level.  [ruby-dev:22554]

Tue Jan 13 13:04:24 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/test_*.rb: Pathname#parent -> Pathname#dirname.

Tue Jan 13 11:38:58 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/yaml/test_yaml.rb (YAML_Unit_Tests::test_spec_type_{int,float}):
	  fix syntax error.

Tue Jan 13 07:52:40 2004  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/bytecode.c: turn off default implicit typing.

	* ext/syck/implicit.c: detect base60 integers.

	* ext/syck/rubyext.c: handle base60, as well as hex and octal
	  with commas.  implicit typing of ruby symbols.

	* test/yaml/test_yaml.rb: add test.

Tue Jan 13 04:29:52 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_driver.rb (RiDriver::report_method_stuff):
	  Show fully-qualified class names in class list.

Tue Jan 13 01:24:17 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (test_wr): Rdoc fix.  [ruby-core:02225]

Tue Jan 13 01:04:37 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_paths.rb (RI::Paths): First attempt at
	  incorporating DESTDIR in the rdoc installation.

Mon Jan 12 23:26:21 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (primary): fix position after FCALL.  [ruby-dev:22574]

Mon Jan 12 18:00:11 2004  Ian Macdonald  <ian@caliban.org>

	* file.c (test_wr, test_ww): New functions implementing new
	  methods (File::world_readable?, File::world_writable?).

	* file.c (S_IRUGO, S_IGUGO): New macros.

Mon Jan 12 12:07:22 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::do_methods):
	  Someone changed the "// in eval.c" comments to "/*...*/" style,
	  so the parsing of the source file name broke.

	* object.c: Remove spurious space in TrueClass documentation.

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::find_body): Fix
	  bad regexp: if the code before a documented method contained
	  a comment that wasn't terminated by whitespace, that comment
	  and all intervening code was included in the following
	  method's documentation.

	* lib/rdoc/ri/ri_formatter.rb (RI::HtmlFormatter::break_to_newline):
	  HTML formats need explicit line breaks.

Mon Jan 12 02:24:07 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_formatter.rb (RI::HtmlFormatter): Add HTML
	  generation support to ri (Elliot Hughes)

Sun Jan 11 23:54:41 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* env.h (ruby_frame, ruby_scope, ruby_in_eval, ruby_class,
	  ruby_dyna_vars): export.  [ruby-dev:22566]

Sun Jan 11 02:35:53 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (make_hostent): a bug in brace position.

	* configure.in: install rdoc by default. if you do not want to
	  install rdoc, specify --disable-install-doc.

Sun Jan 11 02:07:47 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_options.rb (RI::Options::OptionList::OptionList):
	  Also accept command line options via the 'RI' environment variable.

Sat Jan 10 21:27:41 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (eval): need to add message delimiter. [ruby-dev:22561]

Sat Jan 10 01:54:50 2004  Eric Sunshine  <sunshine@sunshineco.com>

	* defines.h (__NeXT__): Ensure that all standard S_IRUSR, S_IWGRP,
	  S_IRWXO, etc. macros are defined since future code might require
	  them (even though present code only requires a subset).

	* defines.h (__NeXT__): Bug fix: WORDS_BIGENDIAN was not being set
	  correctly on Rhapsody when -arch compiler flag was used (via
	  configure's --enable-fat-binary option).

Sat Jan 10 23:01:41 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBPATHFLAG, RPATHFLAG): enclose paths with single
	  quotes.  [ruby-dev:22564]

	* lib/mkmf.rb (libpathflag): do not enclose with quotes always.

	* {bcc32,win32,wince}/Makefile.sub (LIBPATHFLAG): quoted.

Sat Jan 10 22:46:18 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_inspect): new method, Dir#inspect.  [ruby-dev:22562]

Fri Jan  9 17:36:51 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/socket.c (make_hostent): getaddrinfo(3) on BSD do not
	  fill ai_canonname if serv is not supplied.  (ruby-bugs PR#1243)

Fri Jan  9 13:14:59 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/test/unit/collector/dir.rb: do not ignore exceptions(LoadError
	  and SystemExitError) while loading a testcase.  smell of bug.

	* test/testunit/collector/test_dir.rb: add new test of the LoadError.

	* test/drb/{test_drbssl.rb,test_drbunix.rb}: do not define testcase if
	  openssl is not installed.

	* test/testunit/collector/test_dir.rb: assert_raises -> assert_raise.

Fri Jan  9 11:52:16 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* rubysig.h: <errno.h> is needed to use errno which may be a macro.

Fri Jan  9 11:20:24 2004  Siena.  <siena@faculty.chiba-u.jp>

	* ext/extmk.rb (extmake): should not reduce necessary libraries.
	  [ruby-dev:22440]

	* lib/mkmf.rb (merge_libs): merge libraries according to
	  dependency.

Fri Jan  9 10:05:23 2004  Siena.  <siena@faculty.chiba-u.jp>

	* lib/mkmf.rb (libpathflag): use single quotes.  [ruby-dev:22440]

Thu Jan  8 23:49:21 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (RDOCTARGET): new macro.  if you want to install
	  rdoc documentation, you need to run configure with
	  --enable-install-doc.

Thu Jan  8 21:17:43 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_pkey.c (ossl_pkey_to_der): removed; it returns
	  public key only.

	* ext/openssl/ossl_pkey_dh.c (ossl_dh_to_der): new function for
	  OpenSSL::PKey::DH#to_der.

	* ext/openssl/ossl_pkey_dsa.c (ossl_dsa_to_der): new function for
	  OpenSSL::PKey::DSA#to_der.

	* ext/openssl/ossl_pkey_rsa.c (ossl_rsa_to_der): new function for
	  OpenSSL::PKey::RSA#to_der.

Thu Jan  8 18:25:29 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_helper): should not recurse in exceptional status.

Thu Jan  8 16:51:04 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/wsdl/datetime/test_datetime.rb: fixed a stupid testcase which
	  dumps "E" at month-end.

Thu Jan  8 11:20:01 2004  WATANABE Hirofumi  <eban@ruby-lang.org>

	* eval.c, object.c, process.c, re.c: don't use C++ style comments.

Thu Jan  8 08:46:14 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (yaml_org_handler): lazy-load Date for
	  static-ext.

Thu Jan  8 07:06:30 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: preserve order in Setup.  [ruby-dev:22503]

	* ext/extmk.rb: move dependent libraries just after depended
	  libraries.

	* ext/digest/*/extconf.rb: depend on digest.

Thu Jan  8 04:36:17 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (WEBrick::CGI#initialize): should create
	  @config[:Logger] if it was not given.

Wed Jan  7 22:28:12 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_helper): fix memory leak.

Wed Jan  7 21:15:07 2004  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* sample/webrick/*: new files.

	* MANIFEST: add sample/webrick/*

Wed Jan  7 20:51:51 2004  Minero Aoki  <aamine@loveruby.net>

	* test/net/test_httpheader.rb: new file.

	* MANIFEST: add test/net/test_httpheader.rb.

Wed Jan  7 20:42:06 2004  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (HTTPHeader#content_length): should return nil
	  unless header exists. [ruby-dev:22519]

Wed Jan  7 14:26:05 2004  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb (TkPanedWindow): use epath for embedded windows.

	* ext/tk/lib/tktext.rb: use epath for embedded windows.

	* ext/tk/lib/tkcanvas.rb: use epath for window items.

Wed Jan  7 14:24:04 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/{attachment.rb,mimemessage.rb}: added from soap4r/1.5.2.

Wed Jan  7 13:00:18 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/ri/ri_driver.rb: Fix problem where ri was
	  being too eager to find matches of ambiguous method
	  names (such as "ri Thread.join" would return both
	  Thread.join and ThreadsWait.join)

Wed Jan  7 12:35:41 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/debug.rb: revert command parse regexps.  [ruby-list:39014] by
	  Shirai,Kaoru.

Wed Jan  7 08:21:04 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parserfactory.rb: Check for shebang
	  line in files that would otherwise be treated as
	  plain text.

Tue Jan  6 22:13:34 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_mod_modfunc): should break if m has no super class.
	  [ruby-dev:22498]

Tue Jan  6 21:51:37 2004  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fptr_finalize): should save errno just after failure.
	  [ruby-dev:22492]

Tue Jan  6 20:51:10 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb(Logger#msg2str): no special treatment for the object
	  which responds to :to_str.

	* lib/logger.rb(LogDevice#initialize): remove type checking if the
	  given object is a String.  Kernel.open handles it correctly.

	* test/logger/test_logger.rb: follow above change (ArgumentError ->
	  TypeError.)

Tue Jan  6 14:53:14 2004  Dave Thomas  <dave@pragprog.com>

	* bin/ri: split out the display side, making it pluggable. Added
	  new ri_driver and ri_display files in lib/rdoc/ri.

Tue Jan  6 11:29:43 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/inlinetest.rb, test/{test_generator.rb,test_ipaddr.rb,
	  test_pathname.rb,test_pp.rb,test_prettyprint.rb,test_set.rb,
	  test_time.rb,test_tsort.rb: added.

Tue Jan  6 09:38:27 2004  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* import soap4r/1.5.2;

	* lib/soap/{attachment.rb,baseData.rb,encodingstyle/soapHandler.rb}:
	  introduce SOAPExternalReference class as a referenct to SOAPEnvelope
	  external content.

	* lib/soap/{attachment.rb,mimemessage.rb}: great SwA (SOAP messages
	  with Attachments) support code by Jamie Herre.

	* lib/soap/{element.rb,marshal.rb,parser.rb,processor.rb,
	  streamHandler.rb,wsdlDriver.rb}: SwA support.

	* lib/soap/rpc/{cgistub.rb,driver.rb,element.rb,proxy.rb,router.rb,
	  soaplet.rb}: SwA support and refactoring.

	* lib/soap/generator.rb, lib/soap/mapping/mapping.rb: follow
	  SOAPReference#initialize signature change.

	* lib/soap/mapping/factory.rb: deleted unused methods.

	* lib/soap/mapping/rubytypeFactory.rb: do no ignore case while xsi:type
	  string <-> Ruby class name matching.

	* lib/xsd/datatypes.rb: check the smallest positive non-zero
	  single-precision float exactly instead of packing with "f".
	  [ruby-talk:88822]

	* test/soap/test_basetype.rb, test/xsd/test_xsd.rb: use 1.402e-45, not
	  1.4e-45.  1.4e-45 is smaller than 2 ** -149...

	* test/soap/test_basetype.rb, test/soap/marshal/test_marshal.rb,
	  test/xsd/test_xsd.rb: use "(-1.0 / (1.0 / 0.0))" instead of "-0.0".

	* test/soap/test_streamhandler.rb: revert to the previous test that
	  warns "basic_auth unsupported under net/http".

Tue Jan  6 06:37:53 2004  Dave Thomas  <dave@pragprog.com>

	* bin/rdoc: Add --ri-system switch

	* lib/.document: Update with list of files that seem to have
	  documentation

	* lib/test/unit.rb: Reorder comment to make it RDoc friendly.

	* Makefile.in: add install-nodoc target, and make it
	  generate RDoc on default install.

	* lib/rdoc/ri/ri_options.rb (RI::Options::parse): Add
	  --doc-dir option to ri.

Tue Jan  6 00:04:40 2004  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_method_or_yield_parameters):
	  fix parsing if there are braces in a method parameter list

Tue Jan  6 01:01:04 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/dir.h, win32/win32.c: fix patch miss.

	* win32/Makefile.sub: fix file dependency.

Mon Jan  5 20:32:00 2004  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/logger.rb: enhanced documentation.

Mon Jan  5 18:58:47 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c: merge tuning from H.Yamamoto <ocean@m2.ccsnet.ne.jp>.
	  [ruby-dev:22486]

	* pack.c (pack_unpack): unpack requires big endian offet (OFF16B
	  and OFF32B).  The patch is from Minero Aoki in [ruby-dev:22489]

	* pack.c (OFF16B): add big-endian offset again.

Mon Jan  5 03:00:53 2004  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_pack.rb: new test test_unpack_N.

Mon Jan  5 01:47:53 2004  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): remove duplicated object files
	  from $objs on DOSISH platforms.

Sat Jan  3 02:44:48 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* rubysig.h (TRAP_END): preserve errno before switching context.
	  [ruby-core:02137]

Sat Jan  3 01:18:08 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* dir.c: merge tuning from H.Yamamoto <ocean@m2.ccsnet.ne.jp>.
	  [ruby-dev:22476]

Fri Jan  2 14:54:11 2004  Dave Thomas  <dave@pragprog.com>

	* bin/ri: Add new --classes option, and arrange for
	  help messages to be paged too.

	* bin/rdoc: Add statistics.

	* process.c: (MG) Added Process documentation

	* lib/rdoc/ri/ri_formatter.rb (RI::AttributeFormatter::wrap):
	  Fix problem with labels not displaying in RI labeled
	  lists using BS and ANSI modes.

Fri Jan  2 01:50:13 2004  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_eof): ARGF.eof? should not have any side effect.
	  [ruby-dev:22469]

Thu Jan  1 09:03:20 2004  Dave Thomas  <dave@pragprog.com>

	* bin/ri (report_class_stuff): Fix problem with ambiguous nested
	  classes not matching.

Wed Dec 31 17:25:17 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_each_byte): should return self.  [ruby-dev:22465]

Wed Dec 31 15:05:00 2003  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/pathname.rb: Corrected small coding error.

Wed Dec 31 15:00:00 2003  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/pathname.rb: Completed documentation.

Wed Dec 31 11:20:34 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::do_methods): Make
	  file referenced in "// in sss.c" relative to current file.

Wed Dec 31 11:17:37 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/generators/html_generator.rb: Fix problem when
	  a public method was aliased, but the alias is then
	  made private, and hence doesn't appear in RDoc output.

Wed Dec 31 01:33:05 2003  Dave Thomas  <dave@pragprog.com>

	* array.c, error.c, eval.c, io.c, prec.c, range.c, re.c,
	  string.c, time.c: Add RDoc for Kernel functions, and tidy.

Tue Dec 30 19:39:14 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_readline): should raise EOFError at the end of
	  files.  [ruby-dev:22458]

	* io.c (argf_read): should concatenate input files when length
	  argument is nil. [ruby-dev:22450]

	* io.c (argf_read): should update supplied string buffer (2nd
	  argument) even when IO#read is called multiple times.

	* io.c: should initialize lineno by zero. [ruby-dev:22460]

Tue Dec 30 12:30:30 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/code_objects.rb (RDoc::Context::find_symbol): If a
	  class and a method have the same name, finding Xxx.abc was trying
	  to find 'abc' in method 'Xxx', not class 'Xxx'.

Tue Dec 30 08:32:32 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_rb.rb (RDoc::RubyParser::parse_method):
	  Handle undoing nsting of yield parameters correctly for:

	    def each_entry(&b) Dir.foreach(@path) {|f| yield P.new(f) } end

Tue Dec 30 07:30:00 2003  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/pathname.rb: Added documentation.

Mon Dec 29 20:08:17 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (GenericRequest#initialize): check if path
	  begins with '/'.

	* lib/net/http.rb: def m( arg ) -> def m(arg)

Mon Dec 29 12:51:02 2003  Dave Thomas  <dave@pragprog.com>

	* eval.c: Add RDoc for Kernel global functions.

Mon Dec 29 11:00:16 2003  Dave Thomas  <dave@pragprog.com>

	* array.c: Tidy up RDoc loose ends.

Mon Dec 29 05:05:51 2003  Dave Thomas  <dave@pragprog.com>

	* struct.c, random: Add RDoc comments

Mon Dec 29 02:25:00 2003  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/optparse.rb: Improved documentation.

Mon Dec 29 02:20:54 2003  Dave Thomas  <dave@pragprog.com>

	* eval.c: Add RDoc for class Proc, Method, UnboundMethod

Mon Dec 29 02:20:26 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* instruby.rb: fix install directory if destdir and compile_dir are
	  not in the same drive.

	* ext/extmk.rb: ditto. [ruby-list:39009]

	* win32/Makefile.sub, win32/README.win32, win32/configure.bat,
	  win32/setup.mak: new configure scheme. use ``configure --prefix=dir''
	  instead of ``nmake DESTDIR=dir install''.

Mon Dec 29 00:41:44 2003  Dave Thomas  <dave@pragprog.com>

	* math.c: Add RDoc comments

Sun Dec 28 20:19:11 2003  Tanaka Akira  <akr@m17n.org>

	* ext/stringio/stringio.c (strio_sysread): StringIO.new.sysread didn't
	  raise EOFError.

	* ext/zlib/zlib.c (gzreader_gets): don't increment lineno when
	  gzfile_read_all returns "".

Sun Dec 28 15:25:08 2003  Dave Thomas  <dave@pragprog.com>

	* class.c,object.c,parse.y,sprintf.c,variable.c: Document classes
	  Object, Module, etc...

Sun Dec 28 11:55:29 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/csv/test_csv.rb: generate bom.csv and mac.csv files on the fly.
	  [ruby-talk:88852]

	* test/csv/{bom.csv,mac.csv}: removed.

Sun Dec 28 08:56:51 2003  Dave Thomas  <dave@pragprog.com>

	* eval.c: Thead[Group] RDoc (thanks to MG)

Sun Dec 28 03:50:05 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::find_override_comment):
	  Escape method names used in regexp

Sun Dec 28 01:46:02 2003  Dave Thomas  <dave@wireless_3.local.thomases.com>

	* lib/rdoc/ri/ri_formatter.rb (RI::TextFormatter::display_flow_item):
	  Add support for rules in 'ri' output.

Sun Dec 28 01:35:35 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::find_body):
	  Sometimes the Ruby source aliases two otherwise
	  unrelated methods (for example Kernel#object_id and
	  Kernel#hash are both the same C function). Provide a
	  facility to allow the methods to be documented
	  separately.

Sun Dec 28 01:05:31 2003  Dave Thomas  <dave@pragprog.com>

	* marshal.c, signal.c: RDoc collemts added by Elliott Hughes

Sun Dec 28 00:46:25 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/parsers/parse_c.rb (RDoc::C_Parser::find_class_comment):
	  Some Ruby source uses lower-case class names for the
	  Init_Xxx C function name.

Sat Dec 27 23:41:46 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: fix "test: too many arguments" error.

Sat Dec 27 15:32:40 2003  Dave Thomas  <dave@wireless_3.local.thomases.com>

	* time.c: Add RDoc comments for Time class.

Sat Dec 27 15:07:26 2003  Dave Thomas  <dave@pragprog.com>

	* object.c: Add RDoc comments for Symbol class.

Sat Dec 27 14:39:53 2003  Dave Thomas  <dave@pragprog.com>

	* numeric.c (Init_Numeric): Add RDoc comments.

Sat Dec 27 00:44:00 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (next_argv): warn always for stdin on inplace edit mode.

	* io.c (read_all): need to check string value.

	* io.c (argf_read): allow ARGF.read(nil).  [ruby-dev:22433]

Fri Dec 26 23:02:09 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_backquote): need not to check nil result.
	  [ruby-core:02078]

	* io.c (rb_io_getline): should return nil when read_all gives
	  empty string, even when nil rs is specified. [ruby-core:02077]

Fri Dec 26 18:33:54 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check if getcontext and setcontext are available.

	* eval.c: use presence of getcontext/setcontext.

Fri Dec 26 16:40:53 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (PathnameTest#test_plus): add 2 assertions.

Fri Dec 26 14:05:13 2003  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_pack.rb: new test test_pack_N.

Fri Dec 26 12:53:26 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): add sign check for 'i', and 'l'.
	  [ruby-dev:22427]

	* bignum.c (rb_quad_pack): add range check for 'quad int'.

Fri Dec 26 10:58:58 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* MANIFEST: add vms/config.h and remove vms/config.h_in.

Fri Dec 26 10:42:00 2003  AKIYOSHI, Masamichi  <masamichi.akiyoshi@hp.com>

	* io.c: [VMS] "rfm=stmlf" is specified for open() and fopen().

Thu Dec 25 22:29:53 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* string.c (rb_str_update): don't return any value.

Thu Dec 25 15:30:17 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_update): call rb_str_modify().

Thu Dec 25 05:08:09 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (search_required): search actual file name once when no
	  extension specified.

Thu Dec 25 04:00:44 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* stable version 1.8.1 released.

Thu Dec 25 00:17:53 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* configure.in: check for nanosleep, -lrt if required.
	  [ruby-core:02059]

	* eval.c (thread_timer): use select(2) if nanosleep(2) is not
	  available.

	* eval.c: check __stub_getcontext for glibc on some platforms.
	  [ruby-list:38984]

Wed Dec 24 23:48:04 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/test_basetype.rb, test/soap/marshal/test_marshal.rb
	  test/xsd/test_xsd.rb: use "(-1.0 / (1.0 / 0.0))" instead of "-0.0"
	  to express -0.0.  [ruby-talk:88786]

Wed Dec 24 23:29:30 2003  Tanaka Akira  <akr@m17n.org>

	* lib/tsort.rb (test_orphaned_break): removed.

Wed Dec 24 20:53:06 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tkmulticolumnlist.rb: new sample

	* ext/tk/sample/tkmultilistframe.rb: bug fix

Wed Dec 24 20:37:37 2003  Eric Sunshine  <sunshine@sunshineco.com>

	* configure.in (LDSHARED): Fixed typographical error in assignment of
	  LDSHARED for Rhapsody which caused linking of extension modules to
	  fail.

Wed Dec 24 17:51:18 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_thread_flock): enable thread support again.

Wed Dec 24 16:46:08 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (catch_timer): do not call rb_thread_schedule() inside to
	  avoid pthread_mutex_lock() deadlock.  interrupts to system calls
	  are detected by TRAP_END via EINTR error.

	* eval.c (thread_timer): do not post signal unless it is
	  absolutely necessary.

	* rubysig.h (TRAP_END): add CHECK_INTS to switch thread.

	* regex.c (re_compile_pattern): check if nextp is smaller than
	  pend.  [ruby-dev:22372]

	* eval.c (umethod_bind): remove method overridden check.
	  [ruby-dev:22366]

Wed Dec 24 16:13:05 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_read): should check for error
	  status by SSL_get_error().

	* ext/openssl/ossl_ssl.c (ossl_ssl_write): ditto.

Wed Dec 24 14:23:27 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): clear the buffer argument
	  when returning nil.  [ruby-dev:22363]

	* test/ruby/ut_eof.rb (TestEOF::test_eof_0, TestEOF::test_eof_1):
	  add buffer argument tests.

Wed Dec 24 14:07:55 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb: Modules are allowed to rescue.

	* lib/test/unit/autorunner.rb: show output_level in order.

	* lib/test/unit/collector/dir.rb: get rid of successive same
	  directories in load path.

	* test/testunit/test_assertions.rb (test_assert_nothing_raised,
	  test_assert_raise): test for modules.

Wed Dec 24 13:43:34 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (authenticate): remove "\n" from base64 encoded
	  strings.

Wed Dec 24 11:26:41 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/fileutils/test_fileutils.rb: should not create any
	  files or directories in current directory.  [ruby-talk:88724]

Wed Dec 24 10:29:53 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): never return nil at
	  unlimited read.  [ruby-dev:22334]

	* ext/stringio/stringio.c (strio_read): support second
	  argument.  [ruby-dev:22350]

Wed Dec 24 09:38:49 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (arg): should return 0 after error.  [ruby-dev:22360]

Wed Dec 24 00:56:54 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (read_all): do not return nil at the end of file.
	  [ruby-dev:22334]

	* io.c (argf_read): do not depend on nil at eof behavior of
	  IO#read().

	* eval.c (rb_thread_join): dup exception before re-raising it.

	* io.c (rb_io_eof): call clearerr() to prevent side effect.  this
	  patch is supplied by Masahiro Sakai <sakai@tom.sfc.keio.ac.jp>.
	  [ruby-dev:22234]

	* pack.c (OFF16): get offset for big endian machines.

	* pack.c (pack_pack): use OFF16 instead of OFF16B.
	  [ruby-dev:22344]

	* pack.c (pack_unpack): ditto.

Tue Dec 23 22:47:14 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_io_check_readable): set FMODE_RBUF always, even if
	  NEED_IO_SEEK_BETWEEN_RW is not defined. [ruby-dev:22340]

	* io.c (rb_io_check_writable): clear FMODE_RBUF before writing
	  something.

Tue Dec 23 22:25:00 2003  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/optparse.rb: incomplete RDoc documentation added in place of
	  existing RD comments.  Tabs converted to spaces.

Tue Dec 23 19:44:47 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/test_streamhandler.rb (test_basic_auth): removed.
	  soap4r + basic_auth is not officially supported in ruby/1.8.1 even
	  though soap4r + basic_auth + http-access2 should run fine.

Tue Dec 23 19:42:59 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_ungetc): raise an exception at unread stream to
	  avoid unspecified behavior.  [ruby-dev:22330]

	* test/ruby/test_system.rb (test_syntax): glob relatively from
	  __FILE__.

Tue Dec 23 18:09:40 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (pack_pack): remove unnecessary negative value check.
	  [ruby-dev:22329]

Tue Dec 23 17:26:55 2003  KONISHI Hiromasa  <konishih@fd6.so-net.ne.jp>

	* bcc32/Makefile.sub (config.h): bcc has finite(). [ruby-list:38940]

Tue Dec 23 16:08:16 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/rexml/encodings/US-ASCII.rb: typo.  [ruby-talk:88650]

	* test/ruby/test_system.rb: num of asserts depended on running dir.

	* test/xsd/test_noencoding.rb: rexml + without iconv/uconv cannot
	  handle euc-jp.  install iconv, uconv or xmlscan.

Tue Dec 23 14:13:51 2003  akira yamada  <akira@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic::check_userinfo,
	  URI::Generic::check_user, URI::Generic::check_password): tests
	  conflicts/depends with other components closely.

	* test/uri/test_generic.rb (TestGeneric::test_set_component):
	  added tets.

Tue Dec 23 11:08:34 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/xsd/test_noencoding.rb: rescue Errno::EINVAL and do not test.
	  "euc-jp" might not be in supported encoding name list.
	  [ruby-talk:88650]

Tue Dec 23 06:10:31 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb (CGI): add support for mod_ruby.

	* lib/webrick/cgi.rb (CGI::Socket): add check for existence of
	  OpenSSL module in all HTTPS related methods.

	* lib/webrick/cgi.rb (CGI::Socket#cipher): should create similar
	  value to OpenSSL::SSLSocket#cipher.

	* lib/webrick/httpresponse.rb (HTTPResponse#setup_header): should
	  set "connection: close" if @keep_alive is false.

	* lib/webrick/https.rb (HTTPrequest#meta_vars): add supprt for
	  SSL_PROTOCOL, SSL_CIPHER_USEKEYSIZE and SSL_CIPHER_ALGKEYSIZE.

Mon Dec 22 23:00:05 2003  akira yamada  <akira@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic::check_opaque): fixed typo.

Mon Dec 22 21:59:24 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (map_charset): always ensure code is a String.

Mon Dec 22 21:15:29 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_mod_init_copy): always copy singleton class.
	  [ruby-dev:22325]

Mon Dec 22 20:44:36 2003  akira yamada  <akira@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic#route_from): accepts urls which
	  has no host-part.

	* test/uri/test_generic.rb (TestGeneric::test_route): added a test.

Mon Dec 22 20:38:44 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/cgi.rb: reduce eval.

	* lib/cgi.rb (CGI::QueryExtension::read_multipart): alias path to
	  local_path.  [ruby-list:38883]

Mon Dec 22 20:09:31 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/test_property.rb: remove duplicated test method.

Mon Dec 22 18:22:04 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bcc32/Makefile.sub, win32/Makefile.sub (config.h): remove
	  HAVE_ISINF definition to follow previous commits of missing.h
	  and win32/win32.h.

Mon Dec 22 17:23:42 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ac_cv_func_setitimer): moved from defines.h

	* defines.h, rubysig.h, signal.c: removed macro handling which
	  should be done in configure.

	* configure.in (intrinsics.h): check if present.

	* ruby.h: include intrinsics.h if available.

	* bignum.c, marshal.c: include ieeefp.h if available.

	* missing.h (isinf): define as a macro if finite() and isnan()
	  are available.  [ruby-core:02032]

Mon Dec 22 17:07:31 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in (mingw): set isnan, finite and isinf to yes.

Mon Dec 22 13:40:19 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/property.rb: passing block by reference.

Mon Dec 22 00:32:43 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_with_disable_interrupt): use ENABLE_INTS instead of
	  ALLOW_INTS which may switch context.  [ruby-dev:22319]

	* ext/syck/emitter.c (syck_emitter_write): str bigger than
	  e->bufsize causes buffer overflow.  [ruby-dev:22307]

Sun Dec 21 17:29:00 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_check_inheritable): new function.  [ruby-dev:22316]

	* intern.h: add prototype.

	* eval.c (superclass): use rb_check_inheritable().

	* object.c (rb_class_initialize): check argument validity.

Sun Dec 21 16:25:10 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#+): re-implemented to resolve ".." in
	  beginning of the argument.
	  (Pathname#join): concatenate from the last argument.
	  (Pathname#parent): just use Pathname#+.

Sun Dec 21 00:12:37 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: add new methods (TkScrollbar#assign, assign_list)

	* ext/tk/sample/tkmultilistframe.rb: use TkScrollbar#assign method

Sat Dec 20 21:59:03 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httprequest.rb (HTTPRequest#meta_vars): refine regexp.

	* lib/webrick/cgi.rb (CGI#start): NPH scripts return status line
	  instead of Status: header field.

	* lib/webrick/cgi.rb (CGI::Socket): refine some coditions.

Sat Dec 20 16:07:14 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Completion::complete): wrong
	  Regexp for word boundary.  pointed out by Gavin Sinclair.

	* lib/optparse.rb (OptionParser::make_switch): [no-] prefix was
	  missing.

Sat Dec 20 11:40:10 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/yaml.rb (YAML::YAML): adjust Marshal version.

Sat Dec 20 03:56:02 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_with_disable_interrupt): prohibit thread context
	  switch during proc execution.  [ruby-dev:21899]

Sat Dec 20 02:41:02 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/cgi.rb: add file. (yet another CGI library)

	* MANIFEST: add lib/webrick/cgi.rb.

Sat Dec 20 02:18:31 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* misc/ruby-mode.el (ruby-calculate-indent): proper indentation
	  inside of parentheses.  [ruby-dev:22308]

Fri Dec 19 21:24:22 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httprequest.rb (HTTPRequest#meta_vars): should not set
	  HTTP_CONTENT_TYPE and HTTP_CONTENT_LENGTH.

	* lib/webrick/https.rb (HTTPRequest#parse): should check presence
	  of cert() method to detect SSLSocket.

Fri Dec 19 22:56:46 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/property.rb (SOAP::Property#load): new method for loading
	  property value into existing property tree.

	* test/soap/test_property.rb: add test.

Fri Dec 19 19:21:49 2003  akira yamada  <akira@ruby-lang.org>

	* lib/runit/cui/testrunner.rb (RUNIT::CUI::TestRunner::run):
	  should use Test::Unit::UI::{PROGRESS_ONLY,VERBOSE}.

Fri Dec 19 17:36:49 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tkmultilistbox.rb: bug fix

	* ext/tk/sample/tkmultilistframe.rb: new sample script

Fri Dec 19 03:44:27 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (parse_form_data): should return an
	  empty Hash if the body is empty.

Thu Dec 18 21:47:35 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): should remove deffile if it's
	  made by miniruby. based on nobu's patch.

Thu Dec 18 21:44:21 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (stack_extend): ignore inline optimization on VC7.

	* win32/Makefile.sub (OS, RT): can override.

	* win32/Makefile.sub (LDFLAGS): ditto. shouldn't use pdb:none
	  option. based on Tietew's patch [ruby-dev:22289]

Thu Dec 18 16:38:44 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (fnmatch): unlike find_dirsep(), rb_path_next() never
	  return NULL.

Thu Dec 18 15:27:59 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/ipaddr.rb (IPSocket::getaddress): merge usa's patch.
	  [ruby-dev:21678]

Wed Dec 17 15:15:30 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/cgi.rb (CGI::QueryExtension::Value::[]): should work like
	  String#[] if more than one arguments are specified.

	* lib/delegate.rb: avoid using common instance name as "@obj".

	* lib/cgi.rb (CGI::QueryExtension::Value): Value is no longer
	  subclass of String, but DelegateClass(String).

	* ext/curses/extconf.rb: restore function check for init_color.
	  [ruby-list:38905]

	* Makefile.in: need to specify $(MAINLIBS) for the miniruby
	  generation rule.

	* configure.in: better FreeBSD -lc_r support.

Wed Dec 17 00:16:14 2003  Minero Aoki  <aamine@loveruby.net>

	* ext/strscan/strscan.c: new method
	  StringScanner#beginning_of_line? (alias #bol?)

	* ext/strscan/strscan.c: new method StringScanner#concat and #<<.

	* ext/strscan/strscan.c: StringScanner#new(str) does not duplicate
	  nor freeze STR (allow destructive modification).

	* test/strscan/test_stringscanner.rb: test new methods above.

	* test/strscan/test_stringscanner.rb: test destructive string
	  modification.

Tue Dec 16 21:20:47 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pp.rb: don't use local variable `pp'.

	* lib/prettyprint.rb: ditto.

Tue Dec 16 13:20:43 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: condition bug of if statement on
	  {pack,grid}_propagate methods

Tue Dec 16 03:17:29 2003  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/rubytypes.rb: comments in strings. [ruby-talk:88012]

	* test/yaml/test_yaml.rb: add test.

Tue Dec 16 01:14:44 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (catch_timer): check rb_thread_crtical in main native
	  thread.

	* eval.c (thread_timer): just sends signals periodically, to
	  prevent main native thread from receiving them in critical
	  section.  [ruby-core:01959]

Mon Dec 15 13:32:22 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (check_dirname): check string safety and remove extraneous
	  trailing directory separators.  [ruby-dev:22279]

	* file.c: renamed and externalized rb_path_next,
	  rb_path_skip_prefix, rb_path_last_separator, rb_path_end.

	* intern.h: prototypes for rb_path_next, rb_path_skip_prefix,
	  rb_path_last_separator, rb_path_end.

Mon Dec 15 09:27:46 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_pkcs12.c (ossl_pkcs12_initialize): first argument
	  of rb_protect should take an argument of VALUE.

Sun Dec 14 18:46:48 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/socket/socket.c (Init_socket): IPv6 is not supported although
	  AF_INET6 is defined on MinGW.

	* lib/ipaddr.rb (AF_INET6): workaround in the environment which does
	  not support IPv6.

Sat Dec 13 18:55:16 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/charset_alias.rb: preserve original order.

	* ext/iconv/extconf.rb: remove wrapper file at clean.

Sat Dec 13 18:09:42 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (thread_timer): use timer by sub-thread and nanosleep.
	  [ruby-talk:87519]

	* gc.c (Init_stack): no stack adjustment for THREAD_SAFE.

Sat Dec 13 17:17:59 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (proc_alloc): cache the created object at first time.
	  [ruby-talk:61288], [ruby-dev:22240]

Sat Dec 13 09:01:23 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check ucontext.h.

	* eval.c: use getcontext/setcontext() instead of setjmp/longjmp()
	  on ia64 or with native thread enabled.  [ruby-core:01932]

Sat Dec 13 03:09:14 2003  why the lucky stiff  <why@ruby-lang.org>

	* lib/yaml/rubytypes.rb: anonymous struct fix. [ruby-core:01946]

	* test/yaml/test_yaml.rb: add test.

Fri Dec 12 22:36:44 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb: add Cell#to_str and Cell#to_s for /.../ =~ aCell,
	  "#{aCell}" and so on.

	* test/csv/test_csv.rb: add tests.

Fri Dec 12 19:33:06 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mkdir): remove trailing `/' from pathes.

	* lib/fileutils.rb (rmdir): ditto. [ruby-dev:22238]

	* lib/fileutils.rb (rmdir_r): ditto.

	* lib/fileutils.rb (fu_copy_dir): check if it is a directory after
	  mkdir(2).

Fri Dec 12 06:06:09 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (proc_invoke): fix class name in warning message for
	  define_method.  [ruby-dev:22235]

Thu Dec 11 21:24:43 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_pkcs12.[ch]: new files. add OpenSSL::PKCS12.

	* ext/openssl/ossl.[ch]: ditto.

	* ext/openssl/MANIFEST: add ossl_pkcs12.[ch].

Thu Dec 11 20:54:28 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mkdir_p): remove trailing `/' befere mkdir(2).
	  mkdir("nonexistdir/") does not work on NetBSD/Alpha 1.6.1.

	* lib/fileutils.rb (fu_list): call to_str for all arguments.

Thu Dec 11 20:07:01 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/ftools.rb (makedirs): sync with fileutils.

Thu Dec 11 19:53:03 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mkdir_p): catch all SystemCallErrors.
	  (mkdir("C:\") causes EACCESS on Windows 2000/NTFS)

Thu Dec 11 19:08:02 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (mkdir_p): check if it is a directory after
	  mkdir(2) instead of before mkdir(2), to avoid race condition.
	  [ruby-talk:87730]
	  Refer: mkinstalldirs sh script, GNU mkdir(1) (coreutils 5.0)

Thu Dec 11 18:49:30 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb: def m( arg ) -> def m(arg).

Thu Dec 11 11:39:43 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ieeefp.h), numeric.c: needed for finite() on
	  Solaris.  [ruby-core:01921]

	* file.c (rb_stat_inspect): adjust format specifier.

	* parse.c (arg_prepend): nodetype() is for debug use.

	* ruby.h (ISASCII, etc): cast to int to get rid of warning.

	* ruby.h (alloca.h): include even in GCC.  [ruby-core:01925]

	* ext/bigdecimal/bigdecimal.c (GetVpValue): adjust format
	  specifier.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_prec, BigDecimal_coerce,
	  BigDecimal_divmod): use rb_assoc_new() to suppress memory usage.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_split): ditto.

	* ext/dl/sym.c (rb_dlsym_guardcall): guard itself should be
	  volatile.

	* ext/iconv/iconv.c (iconv_convert): ensure actual parameter with
	  format specifier.

	* ext/pty/pty.c (MasterDevice, SlaveDevice, deviceNo): do not
	  define unless used.

	* ext/pty/pty.c (getDevice): get rid of warning.

	* ext/socket/socket.c (port_str, sock_s_getaddrinfo,
	  sock_s_getnameinfo): FIX2INT() now returns long.

	* ext/socket/socket.c (init_inetsock_internal): uninitialized
	  variable.

	* ext/syck/rubyext.c (syck_parser_assign_io): add prototype.

	* ext/syck/rubyext.c (rb_syck_mktime, yaml_org_handler): use
	  ISDIGIT() instead of isdigit() to avoid warnings and for
	  platforms which don't support non-ascii charater.

Wed Dec 10 19:28:56 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): set EOF flag at short read.
	  [ruby-dev:22223], [ruby-dev:22224]

Wed Dec 10 18:07:25 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/erb.rb: new method ERB#filename(=). [ruby-dev:22208]

Wed Dec 10 17:54:51 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): do not set EOF flag when
	  requested length is zero.  [ruby-dev:22214]

Wed Dec 10 17:17:18 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (read_all): should return given string even if data read is
	  empty.  [ruby-dev:22207]

Wed Dec 10 17:16:06 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): adjust behavior at reading
	  beyond EOF to IO.  [ruby-dev:22205]

	* test/ruby/ut_eof.rb (TestEOF::Seek): test behaviors at reading
	  beyond EOF.

	* test/ruby/test_file.rb, test/stringio/test_stringio.rb: include
	  TestEOF::Seek test case.

Wed Dec 10 15:01:19 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* test/monitor/test_monitor.rb (test_cond): use Queue#deq
	  instead of sleep.

Wed Dec 10 14:45:39 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/pty/pty.c (HAVE_SYS_IOCTL_H): need to include <sys/ioctl.h>
	  for TIOCSCTTY on *BSD.  based on gotoyuzo's patch.
	  (ruby-bugs:PR#1211)

	* ext/pty/pty.c (establishShell): should close descriptors if fork
	  failed.

Wed Dec 10 12:53:05 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* win32/win32.h: define execv() using do_aspawn().

	* process.c (proc_exec_v): remove #ifdef's which stopped needing.

Tue Dec  9 23:32:23 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb, ext/tk/lib/tkcanvas.rb, ext/tk/lib/tkdialog.rb,
	  ext/tk/lib/tkentry.rb, ext/tk/lib/tkscrollbox.rb, ext/tk/lib/tktext.rb,
	  ext/tk/sample/tkalignbox.rb, ext/tk/sample/tkcombobox.rb,
	  ext/tk/sample/tkmultilistbox.rb, ext/tk/sample/tkoptdb.rb, ext/tk/sample/tktextframe.rb,
	  ext/tk/sample/demos-en/dialog1.rb, ext/tk/sample/demos-en/dialog2.rb,
	  ext/tk/sample/demos-jp/dialog1.rb, ext/tk/sample/demos-jp/dialog2.rb:
	  overrided instance methods, which are private methods on the super
	  class, are changed to 'private'

Tue Dec  9 19:53:02 2003  akira yamada  <akira@ruby-lang.org>

	* lib/uri/generic.rb (URI::Generic#route_from0): make case insensitive
	  for host-part.

	* test/uri/test_generic.rb (test_route): added tests for the above
	  change.

Tue Dec  9 14:10:48 2003  Tanaka Akira  <akr@m17n.org>

	* io.c (rb_io_check_readable): don't call io_seek if EOF flag is set,
	  to avoid clearing EOF flag.
	  (rb_io_check_writable): ditto.

Tue Dec  9 02:53:55 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tkalignbox.rb: new sample script

Tue Dec  9 00:45:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: renamed #assert_raises to #assert_raise
	  and made the former call the latter. [ruby-core:01890]

	* test/testunit/test_assertions.rb: ditto.

Tue Dec  9 00:07:35 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/rpc/standaloneServer.rb: add 'shutdown' and 'status'
	  methods as delegates to WEBrick.

	* test/soap/calc/{test_calc.rb,test_calc2.rb},
	  test/soap/helloworld/test_helloworld.rb,
	  test/wsdl/datetime/test_datetime.rb, test/wsdl/raa/test_raa.rb:
	  follow the change.

Mon Dec  8 22:48:03 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/autorunner.rb: remove dependency to a particular
	  runner.  [ruby-core:01901], [ruby-list:38869]

	* lib/test/unit/ui/testrunnerutilities.rb: moved output level
	  constants from Console.

	* lib/test/unit/ui/console/testrunner.rb: ditto.

	* lib/test/unit/ui/{fox,gtk,gtk2,tk}/testrunner.rb (initialize):
	  accept output_level.

Mon Dec  8 15:03:30 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/syck.c (syck_io_str_read): get rid of buffer overflow.

Mon Dec  8 13:02:11 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/uri/common.rb: new method URI.regexp. [ruby-dev:22121]

	* test/uri/test_common.rb: add test for URI.regexp.

Mon Dec  8 12:44:14 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c: define swap16 and swap32 only if they are not
	  defined. OpenBSD defines these macros. [ruby-dev:22181]

Sun Dec  7 20:54:17 2003  Tanaka Akira  <akr@m17n.org>

	* ext/iconv/iconv.c (map_charset): make case sensitive.
	  ext/iconv/charset_alias.rb (charset_alias): don't ignore
	  config.charset's information.  sort aliases.

Sat Dec  6 22:58:03 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_start_ssl): new function to wrap
	  SSL_connect and SSL_accept; if SSL_connect (or SSL_accept) returned
	  but not finished the handshake process, we should retry it.

	* ext/openssl/ossl_ssl.c (ossl_ssl_connect): call ossl_start_ssl.

	* ext/openssl/ossl_ssl.c (ossl_ssl_accept): ditto.

	* ext/openssl/ossl_ssl.c (ossl_ssl_read): allow signal traps.

Sat Dec  6 21:45:10 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* io.c (flush_before_seek): flush before seek on any platform.

	* configure.in: ditto.

Sat Dec  6 17:23:00 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/soap.rb(SOAP::Env.getenv): allow upcase environment variable
	  as well as downcase one.

	* lib/soap/netHttpClient.rb(SOAP::NetHttpClient#proxy=): check URI.

Fri Dec  5 23:22:30 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions::assert_raises,
	  Test::Unit::Assertions::assert_nothing_raised): use the last
	  argument as message unless class object.

	* test/testunit/test_assertions.rb (test_assert_raises): test for
	  multiple exception list.  [ruby-core:01891]

	* test/testunit/test_assertions.rb (test_assert_nothing_raised): test
	  for non-exception classes.

Fri Dec  5 22:23:04 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/netHttpClient.rb: proxy support did not work.  fixed.

	* lib/soap/property.rb: add class methods for loading property from
	  stream/file/propertyfile.  propertyfile is a file which is located at
	  somedir in $:.

	* lib/soap/soap.rb, lib/soap/wsdlDriver.rb, lib/soap/rpc/driver.rb,
	  lib/wsdl/importer.rb: load property from propertyfile 'soap/property'
	  e.g. /usr/local/lib/ruby/site_ruby/1.8/soap/property.

	* test/soap/test_property.rb, test/soap/test_streamhandler.rb: new file.

Fri Dec  5 17:26:23 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_exec_end_proc): maintain tmp_end_procs.
	  [ruby-dev:22154]

Fri Dec  5 13:36:59 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_exec_end_proc): should not clear end_procs and
	  ephemeral_end_procs before execution. [ruby-dev:22144]

	* eval.c (rb_obj_extend): call Module#extended hook after
	  extended_object.  [ruby-list:38866]

	* object.c (Init_Object): Module#extended defined.

Fri Dec  5 13:17:30 2003  Tanaka Akira  <akr@m17n.org>

	* test/ruby/test_pipe.rb: use IO.pipe instead of IO.popen.

Fri Dec  5 11:54:45 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): follow IO#read.

	* test/ruby/ut_eof.rb, test/ruby/test_file.rb, test/ruby/test_pipe.rb,
	  test/stringio/test_stringio.rb: add EOF test.

Fri Dec  5 02:49:35 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions::assert_raises):
	  allow multiple exception list.  [ruby-core:01884]

	* lib/test/unit/assertions.rb (Test::Unit::Assertions::assert_nothing_raised):
	  check whether arguments are subclass of Exception.

Thu Dec  4 23:54:00 2003  Rick Ohnemus  <rick.ohnemus@systemware.com>

	* dln.c (aix_loaderror): should not use member named 'errno' which
	  might be a macro (e.g. on AIX).

Thu Dec  4 23:32:26 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (read_all): do not depend on lseek position.
	  [ruby-dev:22026]

Thu Dec  4 22:37:26 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): preserve $! value when retry happens in the
	  rescue clause.  [ruby-talk:86697]

Thu Dec  4 21:50:07 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/drb/drb.rb (DRb::DRbMessage::send_request, send_reply):
	  should rescue errors and re-raise DRbConnError on write too.
	  [ruby-dev:22132]

Thu Dec  4 16:41:17 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (exc_list): allow expanding list.  [ruby-dev:22134]

Thu Dec  4 14:09:24 2003  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb (test_cp): test if the error is
	  kind of SystemCallError.  It is needless details that which errno
	  is set on each systems.

Thu Dec  4 13:24:13 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb: use Object#__send__ instead of Object#send.

Thu Dec  4 13:17:45 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/streamHandler.rb: support latest released version of
	  http-access2.

Thu Dec  4 13:04:44 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/soap.rb: add SOAP::Env module for environment repository
	  such as HTTP_PROXY.

	* lib/soap/property.rb: property implementation.

	* lib/soap/streamHandler.rb, lib/soap/wsdlDriver.rb,
	  lib/soap/rpc/driver.rb: use soap/property.rb.

	* lib/wsdl/importer.rb, lib/soap/wsdlDriver.rb, lib/soap/rpc/driver.rb:
	  use SOAP::Env.

	* lib/soap/netHttpClient.rb: add basic_auth, ssl_config, and cookie
	  management interface, but ignored for now.

	* lib/xsd/charset.rb: add XSD::Charset.encoding= interface to set
	  wiredump charset explicitly.  it was fixed to 'utf-8' when iconv or
	  uconv module was found.

Thu Dec  4 10:43:58 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/sym.c (rb_dlsym_guardcall): __declspec(noinline) is VC7
	  feature.

Thu Dec  4 10:27:12 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: update hyperlink to the Japanese document.

Thu Dec  4 09:12:43 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (asn1time_to_time): should check that
	  the underlying value of ASN1_TIME isn't NULL. [ruby-core:01881]

Thu Dec  4 08:29:43 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/server.rb (GenericServer#start): should rescue
	  Exception to avoid unexpected aborting. [ruby-core:01853]

	* lib/webrick/server.rb (GenericServer#start_thread): should check
	  that peeraddr isn't nil before printing.

	* lib/webrick/httpresponse.rb (HTTPResponse#start_thread): should
	  rescue Exception to avoid unexpected aborting of thread.

Thu Dec  4 03:48:59 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#link, Pathname#symlink): obsoleted.
	  (Pathname#make_link, Pathname#make_symlink): new method.

Thu Dec  4 01:45:24 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (argf_read): should not terminate on empty string; wait
	  until real EOF.  [ruby-dev:21969]

	* io.c (argf_read): should adjust length to read, when length is
	  specified and read spans command line argument files.

Wed Dec  3 19:38:36 2003  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: correct fcntl parameter. [ruby-dev:22120]

Wed Dec  3 13:49:07 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: 'format'==>'Kernel.format' (avoid override trouble)

	* ext/tk/lib/tkafter.rb: ditto.

	* ext/tk/lib/tkcanvas.rb: ditto.

	* ext/tk/lib/tkdialog.rb: ditto.

	* ext/tk/lib/tktext.rb: ditto.

Wed Dec  3 13:28:13 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (lex.c): try gperf first, and copy from the source
	  directory if failed.  [ruby-dev:22123]

	* ext/extmk.rb (MTIMES): let makefiles depend to mkmf.rb.

	* lib/mkmf.rb (configuration): DLDFLAGS was duplicated.

Tue Dec  2 23:18:12 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: wrote the warning about HTTP_PROXY environment
	  variable.

Tue Dec  2 21:31:42 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bin/testrb: new test runner.  [ruby-core:01845]

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner.run,
	  Test::Unit::AutoRunner#process_args): take test list to run and
	  options.

	* lib/test/unit/autorunner.rb (Test::Unit::AutoRunner::RUNNERS,
	  Test::Unit::AutoRunner#run): should not exit inside a library,
	  just return the result instead.

	* lib/test/unit.rb: ditto.

	* test/runner.rb: exit with the test result.

Tue Dec  2 20:18:48 2003  Eric Sunshine  <sunshine@sunshineco.com>

	* configure.in (AC_PROG_YACC): AC_DEFINE(OLD_YACC) if Yacc is found
	  instead of Bison or byacc.

	* parse.y: If OLD_YACC is defined, ensure that YYMAXDEPTH is at least
	  10000 (Bison's default) since some old versions of Yacc define it as
	  low as 150 by default, which is too low for Ruby to parse some files,
	  such as date/format.rb.  Among other issues, the parse problem causes
	  "make test" to fail.

Tue Dec  2 20:03:20 2003  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb: check if Pathnames are usable
	  for arguments.

Tue Dec  2 04:22:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: fixed #assert_no_match message.

	* test/testunit/test_assertions.rb: ditto.

Tue Dec  2 00:43:00 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/syck.c: string buffering bug.  decrementing by full
	  max_size now. [ruby-core:01834]

Mon Dec  1 21:33:08 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* numeric.c (num_sadded): prohibit singleton method definition for
	  Numerics.  fill yet another gap between Fixnum and Bignum.

Mon Dec  1 17:33:47 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (htov16): converts endian using swap16. htov32(), hton16,
	  hton32 as well. [ruby-talk:85377]

	* pack.c (swap16): swap 2 bytes no matter how big short is on the
	  platform.  swap32() is also prepared.

	* numeric.c (rb_num2int): returns long to preserve information.
	  rb_fix2int(), rb_num2uint(), rb_fix2uint() as well.
	  [ruby-talk:85377]

	* numeric.c (rb_num2uint): should not check for value range if the
	  source value is negative.

Mon Dec  1 17:14:34 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sample/optparse/opttest.rb: added.

Mon Dec  1 16:10:52 2003  Dave Thomas  <dave@pragprog.com>

	* lib/rdoc/rdoc.rb: (etc) initial merge into main tree.

Mon Dec  1 14:17:49 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (fu_each_src_dest0): call #to_str to allow
	  Pathname for arguments. [ruby-core:01795]

	* test/fileutils/test_fileutils.rb: does much strict test on
	  "same" files detecting.

Mon Dec  1 09:28:14 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub
	  (XCFLAGS): re-export $(XCFLAGS).

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub
	  (ARCH_FLAG): export $(ARCH_FLAG) (perhaps empty value).

Mon Dec  1 01:03:27 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/mkmf.rb (TRY_LINK, link_command): added support for DLDFLAGS
	  and ARCH_FLAG.  [ruby-dev:22085]

Sun Nov 30 20:18:07 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: keep ARCH_FLAG separate. export ARCH_FLAG.
	  [ruby-core:01819]

	* Makefile.in: add ARCH_FLAG to CFLAGS.

	* Makefile.in: add @CPPFLAGS@ to CPPFLAGS.

	* lib/mkmf.rb (link_command, cc_command): use ARCH_FLAG.

	* lib/mkmf.rb (configuration): add ARCH_FLAG to DLDFLAGS.

	* Makefile.in: add ARCH_FLAG to DLDFLAGS.

	* configure.in: should put getcwd in AC_CHECK_FUNCS, not
	  AC_REPLACE_FUNCS.  [ruby-core:01826]

Sun Nov 30 18:22:48 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: do not override CCDLDFLAGS, LDFLAGS, XLDFLAGS,
	  DLDFLAGS and LDSHARED.

	* configure.in: XCFLAGS for compiling ruby itself.  ARCH_FLAG is
	  reflected in CFLAGS.

	* lib/mkmf.rb: ditto.  do not import XCFLAGS from config.status.

Sun Nov 30 17:37:36 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: bug fix [ruby-talk:86746]

Sun Nov 30 13:02:00 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/encodingstyle/soapHandler.rb: refactoring - Simplifying
	  Conditional Expressions.

	* lib/wsdl/soap/definitions.rb: refactoring - Move Method.

	* test/xsd/{test_noencoding.rb,noencoding.xml}: new files.  test for
	  encoding unspecified XML file parsing.

	* test/wsdl/{test_fault.rb,map,datetime}: new files.  test of
	  SOAPFault, dateTime and Apache's Map.

Sun Nov 30 09:35:14 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_update): get rid of SEGV at just allocated String.
	  [ruby-core:01812]

Fri Nov 28 23:19:34 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_mark): explicitly check mark recursion levels, instead
	  of unreliable stack length.

Fri Nov 28 22:49:56 2003  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/rinda/rinda.rb: fix TupleSpaceProxy#read, read_all.

Fri Nov 28 21:44:40 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* test/fileutils/test_fileutils.rb (test_ln_s): should be a file, not
	  a directory for FreeBSD.

Fri Nov 28 19:37:56 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (env_has_value, env_index): must match exactly.

	* test/ruby/test_env.rb (test_has_value, test_index): condition for
	  aboves.

Fri Nov 28 17:59:20 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_env.rb: add tests for ENV.

Fri Nov 28 17:47:46 2003  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (DRbMessage#load): rescue Errno::* and raise
	  DRbConnError.

Fri Nov 28 15:41:15 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#realpath): obsolete the force_absolute
	  argument.

Fri Nov 28 14:41:52 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/streamHandler.rb: drop unused http parameters.

	* lib/soap/encodingstyle/soapHandler.rb, lib/soap/mapping/factory.rb,
	  lib/soap/mapping/mapping.rb, lib/soap/mapping/registry.rb,
	  lib/wsdl/soap/complexType.rb: ApacheSOAP's map support was broken
	  under WSDL dynanic client environment.  fixed.

	* test/wsdl/raa/*: add tests.

	* lib/xsd/datatypes.rb: dateTime precision bug fix (at least, I hope.)
	  bug of soap4r.  XSDDateTimeImple.to_time passed a Float to
	  Time.local/Time.gm as an usec, and NUM2LONG(rb_num2long for Float)
	  causes rounding error.

	* test/soap/test_basetype.rb, test/xsd/test_xsd.rb: add tests.

Fri Nov 28 04:15:24 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (method_arity): used wrong Proc object.  [ruby-talk:86504]

Fri Nov 28 00:47:29 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_f_exit), process.c (rb_f_exit_bang): treat true as
	  success, false as failure.  [ruby-dev:22067]

	* eval.c (rb_f_abort, rb_thread_switch), process.c (rb_f_system): use
	  ANSI macro instead of hard coded value.

	* eval.c (rb_f_exit), process.c (rb_f_exit_bang): use VALUEs not but
	  TYPEs.

Thu Nov 27 22:05:48 2003  Akinori MUSHA  <knu@iDaemons.org>

	* eval.c, gc.c: FreeBSD/ia64 currently does not have a way for a
	  process to get the base address for the RSE backing store, so
	  hardcode it for the moment.
	  [submitted by: Marcel Moolenaar <marcel@FreeBSD.org>]

Thu Nov 27 17:36:42 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkafter.rb: bug fix on TkTimer#cancel_on_exception=(mode).
	  TkTimer#wait receives the exception of the callback.
	  The exception is kept on @return_value.

Thu Nov 27 16:58:48 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* win32/win32.c (rb_w32_stat): remove _fullpath() for NUL: device.

Wed Nov 26 15:38:47 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* test/fileutils/test_fileutils.rb (test_ln_s): should take the
	  existing symbolic link for OpenBSD.

Wed Nov 26 04:48:42 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/token.c: removed YYTOKTMP references which
	  were causing buffer overflows on large block scalars,
	  comments, quoted scalars and plain scalars.

	* ext/syck/rubyext.c: dynamic changing of buffer size.

	* ext/syck/syck.h: default buffer size of 4k.

Wed Nov 26 00:55:30 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpresponse.rb: add HTTPResponse#keep_alive=.

	* lib/webrick/httpserver.rb (HTTPServer#run): should pass the
	  request's keep_alive flag to the response.

Tue Nov 25 21:41:35 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* defines.h (ENV_IGNORECASE): should define when DOSISH without
	  human68k. [ruby-dev:22047]

	* hash.c (env_has_value, env_index): don't ignore case of value.
	  [ruby-dev:22048]

Tue Nov 25 21:39:37 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (path_check_1): honor sticky bits always.
	  [ruby-talk:86273]

Tue Nov 25 20:02:14 2003  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb: do test in more deep
	  directory.

	* test/fileutils/test_nowrite.rb: ditto.

Tue Nov 25 19:04:23 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::Generic#find_proxy): ENV case sensitivity test
	  refined.

Tue Nov 25 18:13:30 2003  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb: chdir Dir.tmpdir before each
	  test. [ruby-dev:22045]

	* test/fileutils/test_nowrite.rb: ditto.

Tue Nov 25 17:52:11 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::Generic#find_proxy): use http_proxy under CGI
	  if the environment variable is case sensitive.

Tue Nov 25 16:41:33 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/wsdl/multiplefault.wsdl, test/wsdl/test_multiplefault.rb:
	  removed.  this test requires extra libraries in soap4r/1.5.*.

Tue Nov 25 16:24:42 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/**/*.rb, lib/wsdl/**/*.rb, lib/xsd/**/*.rb: changed license;
	  GPL2 -> Ruby's.

	* lib/soap/rpc/driver.rb, lib/soap/wsdlDriver.rb,
	  lib/soap/streamHandler.rb: add interface to streamhandler.

	* lib/soap/marshal.rb: raise error if parse fails.

	* lib/soap/netHttpClient.rb: add https support.  Patched by
	  Oliver M. Bolzer.

	* lib/soap/netHttpClient.rb: dump HTTP response message body by itself.

	* lib/soap/rpc/driver.rb, lib/soap/rpc/proxy.rb,
	  lib/soap/wsdlDriver.rb: add driver#mandatorycharset interface to foce
	  using charset for parsing response from buggy server.

	* lib/soap/encodingstyle/soapHandler.rb: support Apache Axis's half
	  typed multi-ref array.

	* lib/soap/mapping/factory.rb, lib/soap/mapping/registry.rb: map
	  SOAPStruct which has multi-accessors which name are the same, to an
	  array.

	* lib/soap/rpc/element.rb: fixed illegal parameter order.

	* lib/soap/rpc/element.rb: element name of response message could have
	  the name other than 'return'.

	* lib/wsdl/operation.rb, lib/wsdl/operationBinding.rb,
	  lib/wsdl/soap/classDefCreator.rb, lib/wsdl/soap/methodDefCreator.rb,
	  lib/wsdl/soap/methodDefCreatorSupport.rb: WSDL/1.1 allows plural
	  fault definition in a operation. [ruby-talk:84948]

	* test/wsdl/multiplefault.wsdl, test/wsdl/test_multiplefault.rb: add
	  test for above fix.

	* lib/wsdl/soap/complexType.rb: support WSDL array definition with
	  maxOccures="unbound".

	* lib/xsd/charset.rb: use cp932 under emx.  Patched by
	  Siena. / SHINAGAWA, Norihide in [ruby-dev:21972]

	* lib/xsd/xmlparser/parser.rb: set @charset nil by default.  Nil means
	  'follow encoding declaration in XML'.

	* sample/soap/digraph.rb, sample/wsdl/amazon/wsdlDriver.rb,
	  sample/wsdl/googleSearch/sampleClient.rb,
	  sample/wsdl/googleSearch/wsdlDriver.rb,
	  test/wsdl/test_emptycomplextype.rb,
	  test/wsdl/marshal/test_wsdlmarshal.rb,
	  test/xsd/test_xmlschemaparser.rb: use File.open(...) { |f| f.read }
	  instead of File.open(...).read. [ruby-dev:21964]

	* test/wsdl/emptycomplextype.wsdl, test/wsdl/test_emptycomplextype.rb:
	  simplify the test case.

	* test/wsdl/axisArray/*: add tests for axis's array encoding.

Tue Nov 25 16:15:29 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ruby.h: don't treat Cygwin as Windows.

Tue Nov 25 15:18:28 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* configure.in: change default value of --enable-pthread (default: no)

Tue Nov 25 07:31:16 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (primary): allow newlines just before right argument
	  parenthesis.  (ruby-bugs:PR#1221)

Mon Nov 24 23:32:06 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI.open_loop, URI::HTTP#proxy_open): use
	  catch/throw for redirection instead of exception.
	  (OpenURI.open_loop, OpenURI.redirectable?): restrict redirection.

Mon Nov 24 19:59:48 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (URI::Generic#find_proxy): use CGI_HTTP_PROXY
	  instead of HTTP_PROXY in the CGI environment.

Mon Nov 24 19:32:55 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/etc/extconf.rb: check for pw_passwd in struct passwd and
	  gr_passwd in struct group for DJGPP.

	* ext/etc/etc.c: ditto.

	* ext/Setup.dj: support for curses, etc, zlib.

Mon Nov 24 17:00:00 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb: validate option names.
	  :content_length_proc and :progress_proc option implemented.

Mon Nov 24 14:53:10 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub
	  (XCFLAGS): output empty value instead of `-DRUBY_EXPORT'.

Sat Nov 22 23:09:45 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: set enable_pthread to no on MinGW.

Sat Nov 22 22:56:20 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* configure.in: add --enable-pthread option (default: yes)

Sat Nov 22 22:48:46 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: add Tk.grab_release and fix bug of TkComposite

	* ext/tk/lib/tkafter.rb: bug fix of TkAfter#start

	* ext/tk/sample/tkcombobox.rb: new sample script

	* ext/tcltklib/tcltklib.c: add native thread check

Sat Nov 22 18:49:47 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/curses/curses.c (window_nodelay): nodelay() of NetBSD's
	  libcruses returns no value, just like keypad().

Sat Nov 22 17:36:36 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub
	  (HAVE_GETCWD): output to config.h.

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub
	  (XCFLAGS): output to config.status.

Sat Nov 22 13:10:10 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (have_st_ino?): djgpp has valid st_ino.

Sat Nov 22 11:28:48 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (Init_stack): stack region is far smaller than usual if
	  pthread is used.

Sat Nov 22 07:30:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/util/backtracefilter.rb: fixed a bug that occurred
	  when an exception had no backtrace.

	* test/testunit/util/test_backtracefilter.rb: ditto.

Fri Nov 21 16:44:18 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tkentry.rb: fix the encoding trouble of percent
	  substitutions on validatecommand option of TkEntry widget

	* ext/tk/lib/tk.rb: fix bug on {pack|grid}_propagate() method

Fri Nov 21 16:12:11 2003  Akinori MUSHA  <knu@iDaemons.org>

	* ruby.1: Fix markups and grammar.

Fri Nov 21 14:49:42 2003  Minero Aoki  <aamine@loveruby.net>

	* ruby.1: wrote about ruby related environment variables.

Fri Nov 21 12:28:03 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_extended): singleton methods should not be checked
	  when dumping via marshal_dump() or _dump(). [ruby-talk:85909]

Fri Nov 21 01:40:00 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* configure.in: check <pthread.h>

	* ruby.h: include pthread.h if existence.
	  define is_ruby_native() macro when not HAVE_NATIVETHREAD

	* eval.c: undef is_ruby_native() function when not HAVE_NATIVETHREAD

Fri Nov 21 00:43:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: use #__send__ instead of #send.

	* lib/test/unit/testcase.rb: ditto.

Thu Nov 20 19:19:22 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in: don't find the Cygwin's pthread library on MinGW.

Thu Nov 20 19:15:50 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (have_st_ino?): emx (OS/2 with EMX) does not
	  have st_ino (always 0). [ruby-dev:21972]

	* lib/fileutils.rb (rename_cannot_overwrite_file?): emx does not
	  allow overwriting files by rename(2).

	* test/fileutils/test_fileutils.rb: windows? ->
	  have_drive_letter?, have_file_perm?

Thu Nov 20 17:50:58 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/tkballoonhelp.rb: new sample script

	* ext/tk/sample/tkmultilistbox.rb: ditto

	* ext/tk/sample/tktextframe.rb: ditto

Thu Nov 20 13:37:34 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ruby.h: define is_ruby_native_thread() for no native thread
	  environment

	* eval.c: ditto

Thu Nov 20 12:42:47 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* configure.in: always check existence of the pthread library

	* ruby.h: define macros for ruby's native thread check

	* eval.c: add ruby's native thread check

	* gc.c: ditto

Wed Nov 19 14:45:18 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (to_ary): print more friendly warning message.

Wed Nov 19 14:32:08 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (fu_same?): add djgpp and wince.

	* lib/fileutils.rb (cannot_overwrite_file?): add wince.

Wed Nov 19 11:04:47 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/fileutils.rb (cannot_overwrite_file?, have_st_ino?): bccwin32
	  is same as mswin32.

Wed Nov 19 07:54:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit.rb: do not run tests if $! is set.

	* lib/test/unit/assertionfailederror.rb: extend StandardError instead
	  Exception (irb catches the former but not the latter).

Tue Nov 18 23:31:36 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* missing/memmove.c (memmove): take void *, not char *.

	* missing.h (memmove): ditto.

	* missing.h (strchr, strrchr): return char *, not int.

Tue Nov 18 22:20:10 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (fu_same?): temporal fix for windows.

Tue Nov 18 19:05:04 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (fu_same?): check by inode instead of path
	  name, to detect two hard links pointing to the same content.

	* test/fileutils.rb: did not create correctly looped symlinks.

Tue Nov 18 18:23:05 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): behave as IO at empty string.
	  [ruby-dev:21939], [ruby-dev:21941]

	* ext/stringio/stringio.c (strio_getc, strio_getline): set EOF flag.

	* ext/stringio/stringio.c (strio_rewind, strio_seek, strio_ungetc):
	  clear EOF flag.

	* test/stringio/test_stringio.rb: imported from [ruby-dev:21941].

Tue Nov 18 14:06:35 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/fileutils.rb (fu_each_src_dest): raise if src==dest.
	  [ruby-talk:85344] [ruby-core:01699]

	* lib/fileutils.rb: use Object#is_a? instead of Class#=== to allow
	  e.g. remote objects for receivers.

	* lib/fileutils.rb: FileTest -> File.

	* lib/fileutils.rb: put parentheses for arguments of File.xxxx?

	* test/fileutils/test_fileutils.rb (test_cp): test "cp a a".

	* test/fileutils/test_fileutils.rb (test_mv): test "mv a a".

	* test/fileutils/test_fileutils.rb (test_ln): test "ln a a".

	* test/fileutils/test_fileutils.rb (test_ln_s): test "ln_s a a".

	* test/fileutils/test_fileutils.rb (test_install): test "install a a".

	* test/fileutils/fileasserts.rb: new method assert_symlink.

	* test/fileutils/fileasserts.rb: assert_is_directory -> assert_directory.

Mon Nov 17 19:38:49 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (getcwdofdrv): avoid using getcwd() directly, use
	  my_getcwd() instead.

	* merged NeXT, OpenStep, Rhapsody ports patch from Eric Sunshine
	  <sunshine@sunshineco.com>.  [ruby-core:01596]

Mon Nov 17 10:50:27 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Completion::complete): allow least
	  common completion for three or more candidates.

Mon Nov 17 09:41:38 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/ui/tk/testrunner.rb,
	  lib/test/unit/ui/gtk/testrunner.rb:
	  run GUI main loop in sub thread.

	* lib/test/unit/ui/gtk2/testrunner.rb: imported from rough.

	* lib/test/unit/autorunner.rb (keyword_display): sort keywords.

Sun Nov 16 18:10:57 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): iterator should return value from next inside
	  begin/rescue/end.  (ruby-bugs:PR#1218)

Sun Nov 16 13:26:07 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_object): LINK check earlier than anything else,
	  i.e. do not dump TYPE_IVAR for already dumped objects.
	  (ruby-bugs:PR#1220)

	* eval.c (rb_eval): call "inherited" only when a new class is
	  generated; not on reopening.

	* eval.c (eval): prepend error position in evaluating string to
	  "mesg" attribute string only when it's available and is a
	  string.

Sun Nov 16 12:16:10 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/protocol.rb: logging response body. [experimental]
	  [ruby-list:38800]

Sun Nov 16 10:49:38 2003  Gavin Sinclair  <gsinclair@soyabean.com.au>

	* lib/thread.rb (Thread.exclusive): wrap method definition in
	  class Thread to enable rdoc to process.

Sun Nov 16 09:45:23 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (set_debug_output): warn if method is called
	  after #start.  [ruby-dev:38798]

Sun Nov 16 04:41:33 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (eval): do not re-raise exception to avoid unnecessary
	  exception copying, instead modify exception and internal
	  information to adjust eval().

	* eval.c (backtrace): can return the current frame information
	  only if lev < -1.

Sat Nov 15 22:16:42 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* /ext/openssl/ossl_x509ext.c (ossl_x509extfactory_create_ext):
	  refine error message.

Sat Nov 15 10:05:40 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI.open_loop, OpenURI::HTTP#proxy_open):
	  refactored to support options.
	  (Buffer): maintain size by this class.

Sat Nov 15 07:40:14 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_method_node): new API to retrieve method body.

Fri Nov 14 13:21:30 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: fix (en-bugged at 2003/11/07)

	* ext/tk/lib/tkdialog.rb: TkDialog.new accepts a parent widget
	  argument [ruby-talk:85066]

Thu Nov 13 20:53:35 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (Kernel[#.]open): hard coded URI schemes removed.
	  [ruby-ext:02251]

Thu Nov 13 19:17:00 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* lib/test/unit/ui/tk/testrunner.rb: use grid and panedwindow
	  (if available)

Thu Nov 13 17:56:41 2003  Tanaka Akira  <akr@m17n.org>

	* lib/open-uri.rb (OpenURI.open_uri): use File::RDONLY.
	  reported by Take_tk <ggb03124@nifty.ne.jp>.
	  [ruby-ext:02245]

Thu Nov 13 16:45:53 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509req.c (ossl_x509req_to_der): add function for
	  X509::Request#to_der.

Thu Nov 13 11:31:14 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Completion#complete): prior shorter
	  name to containing longer name.

Thu Nov 13 06:08:54 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: stop freezing some classes

	* ext/tk/lib/multi-tk.rb: ditto.

Wed Nov 12 17:32:49 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_throws, assert_nothing_thrown):
	  uncaught throw in sub thread raises ThreadError.

	* lib/test/unit/ui/tk/testrunner.rb (setup_ui): "expand" is not
	  necessary.

Wed Nov 12 14:09:43 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* test/monitor/test_monitor.rb: fix the timing problem by Queue.

Wed Nov 12 12:59:44 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* test/monitor/test_monitor.rb: added.

Wed Nov 12 10:14:28 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb: refactored. Thanks, Gennady Bystritsky.

Wed Nov 12 06:11:39 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.c (ossl_x509_sk2ary, ossl_x509crl_sk2ary):
	  add functions to convert STACK into Array.

	* ext/openssl/ossl.h: add prototypes.

	* ext/openssl/ossl_pkcs7.c (ossl_pkcs7_set_certificates,
	  ossl_pkcs7_get_certificates, ossl_pkcs7_get_crls,
	  ossl_pkcs7_set_crls): add functions for PKCS7#certificates=
	  PKCS7#certificates, PKCS7#crls= and PKCS7#crls.

Wed Nov 12 00:47:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/ui/testrunnermediator.rb: should require 'test/unit'.

Tue Nov 11 23:54:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/ui/gtk/testrunner.rb: added a rescue clause to handle
	  the case when the requested font is not available.

Tue Nov 11 22:44:08 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (appendline): file may not end with newline.  a bug if
	  READ_DATA_PENDING_PTR is defined. [ruby-talk:84925]

Tue Nov 11 10:42:41 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: raise an exception when creating TkWindow
	  object, because TkWindow class is an abstract class.

Tue Nov 11 03:30:43 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/ext/openssl/ossl_conf.c (ossl_config_get_value): return nil
	  if the specified value doesn't exist.

	* lib/ext/openssl/ossl_conf.c (ossl_config_get_section): return
	  a empty hash if the specified section doesn't exist.

Mon Nov 10 11:40:29 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb (wait): return true on signal/broadcastfalse and
	  false on timeout. Thanks Gennady Bystritsky.

Mon Nov 10 00:07:10 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (primary): primary_value may be 0 when syntax error.
	  [ruby-talk:84893]

Sun Nov  9 02:05:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: un-deprecated #assert_not_nil to
	  maintain symmetry with #assert_nil. Also added better output for
	  #assert_kind_of.

	* test/testunit/tc_assertions.rb: ditto.

Sat Nov  8 18:50:20 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/wsdl/raa/*: add new testcase for WSDL loading, parsing and
	  reading.

	* test/soap/marshal/*: backport from soap4r/1.5.1.  all differences are
	  for ruby/1.6.

	* lib/soap/*: backport from soap4r/1.5.1.  all differences are for
	  ruby/1.6.

	* lib/wsdl/data.rb, lib/wsdl/xmlSchema/data.rb: move definition of
	  ArrayTypeAttrName from ::WSDL::XMLSchema::* to ::WSDL::*.
	  [ruby-talk:84813]

	* lib/wsdl/soap/definitions.rb: element name typo in custom exception
	  struct definition which is needed for wsdlDriver; camelCase ->
	  underscore_name.

Sat Nov  8 13:49:50 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* configure.in: improvement of pthread check

Sat Nov  8 13:28:46 2003  Takaaki Tateishi  <ttate@ttsky.net>

	* ext/dl/sym.c: Add DL.win32_last_error and DL.last_error.
	  Thanks, Kaoru Shirai.

Sat Nov  8 06:19:38 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: To fix 'pthread-enabled Tcl/Tk' problem,
	  TclTkIp#_eval calls Tcl_Eval() on the mainloop thread only
	  (queueing a handler to the EventQueue).

	* ext/tcltklib/README.1st: edit the description of '--with-pthread-ext'

Fri Nov  7 23:23:04 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (Pathname#+): if self or the argument is `.', return
	  another.
	  (Pathname#parent): if self is `.', return `..'.
	  (Pathname#children): if self is `.', don't prepend self for a
	  pathname in a result.
	  (Pathname#join): re-implemented using Pathname#+.
	  (Pathname#find): if self is `.', remove `./' prefix of yielding
	  pathname.

Fri Nov  7 10:23:24 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (make_hostent): get rid of SEGV on aliases
	  lookup failure.  (ruby-bugs:PR#1215)

Fri Nov  7 04:08:05 2003  UENO Katsuhiro  <katsu@blue.sky.or.jp>

	* ext/zlib/zlib.c (Init_zlib): define Zlib::GzipReader#each_line as
	  an alias of Zlib::GzipReader#each.

Fri Nov  7 01:03:16 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_load): save and restore rb_prohibit_interrupt.
	  [ruby-dev:21857]

Thu Nov  6 18:05:07 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_inspect): show the path also at a closed file.
	  [ruby-dev:21851]

Thu Nov  6 11:42:07 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_set_string, strio_reopen): check
	  tainted.

	* ext/stringio/stringio.c (strio_copy, strio_ungetc, strio_write,
	  strio_putc): add infection.

	* ext/stringio/stringio.c (strio_path): just nil.  [ruby-dev:21846]

	* ruby.c (proc_options): reserve searched script path in the
	  source file name table.  [ruby-list:38765]

	* lib/optparse.rb (OptionParser::Completion#complete): default not to
	  ignore case on completion.  [ruby-talk:84726]

	* win32/win32.c (make_cmdvector): process backslashes even if a quote
	  is not enclosed.

Wed Nov  5 23:49:45 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* sample/openssl/gen_csr.rb: there (at least) is a CA which does not
	  accept DN in UTF8STRING format.  it's a sample.

Wed Nov  5 22:55:16 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* configure.in, eval.c, signal.c: : add '--with-pthread-ext'
	  option to fix the pthread trouble on 'tcltklib'

	* ext/tcltklib/README.1st: add the description of '--with-pthread-ext'

	* ext/tk/lib/tktext.rb: add TkText#text_copy, text_cut, text_paste
	  to support Tcl/Tk8.4's tk_textCopy, tk_textCut, tk_textPaste

	* ext/tk/lib/tk.rb: add TkMenu#set_focus support Tcl/Tk's
	  tk_menuSetFocus

Wed Nov  5 17:33:45 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_load): allow interrupt during loaded program
	  evaluation.  [ruby-dev:21834]

	* hash.c (rb_hash_fetch): always warn if default argument and a
	  block are supplied at the same time. [ruby-dev:21842]

	* hash.c (env_fetch): ditto.

	* array.c (rb_ary_fetch): ditto.

Wed Nov  5 19:08:47 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Switch::PlacedArgument::parse):
	  do not remove next argument if empty value is placed.

	* test/optparse: added.

Wed Nov  5 17:05:18 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/ui/gtk/testrunner.rb: typo.

Wed Nov  5 11:13:32 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* string.c: add #include "version.h". this file still depends on it.

	* Makefile.in, bcc32/Makefile.sub, win32/Makefile.sub,
	  wince/Makefile.sub: add version.h dependency to string.c.

Wed Nov  5 09:14:23 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb: revert to the previous revision.

Wed Nov  5 08:39:51 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/https.rb (HTTPRequest#parse): set @client_cert_chain.

	* lib/webrick/https.rb (HTTPRequest#meta_vars): create
	  SSL_CLIENT_CERT_CHAIN_n from @client_cert_chain.

	* ext/openssl/ossl_ssl.c (ossl_ssl_get_peer_cert_chain): return nil
	  if no cert-chain was given.

Tue Nov  4 23:44:48 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bcc32/Makefile.sub, win32/Makefile.sub, wince/Makefile.sub:
	  remove needless version.h dependency.

Tue Nov  4 23:38:43 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* class.c, hash.c, string.c: remove #include "version.h".

	* Makefile.in: remove needless version.h dependency.

Tue Nov  4 06:54:52 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (read_all): fptr->f may be NULL, if IO is closed in the
	  signal handler.

	* io.c (io_read): ditto.

	* string.c (get_pat): remove 1.8.0 warning code.

	* string.c (rb_str_match): extend warning until 1.8.2.

	* string.c (rb_str_match2): ditto.

	* class.c (class_instance_method_list): remove 1.8.0 warnings.
	  method_list now recurs.  [ruby-dev:21816]

	* class.c (rb_obj_singleton_methods): ditto.

	* array.c (rb_ary_select): remove select with block.
	  [ruby-dev:21824]

	* hash.c (rb_hash_select): ditto.

	* hash.c (env_select): ditto.

	* re.c (match_select): ditto.

	* struct.c (rb_struct_select): ditto.

Mon Nov  3 22:53:21 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/racc/parser.rb: synchronize with Racc 1.4.4.

	* ext/racc/cparse/cparse.c: ditto.

	* ext/racc/cparse/cparse.c (parse_main): should abort when
	  the length of LR state stack <=1, not ==0.

Mon Nov  3 08:50:47 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* process.c (check_uid_switch): remove duplicated error messages.

	* process.c (check_gid_switch): ditto.

Sun Nov  2 02:28:33 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/ssl.rb: new option :SSLExtraChainCert.

Sun Nov  2 01:02:04 2003  Akinori MUSHA  <knu@iDaemons.org>

	* string.c (rb_str_hash): Update the HASH_PERL alternative hash
	  algorithm in sync with Perl 5.8.

	* st.c (strhash): Ditto.

Sat Nov  1 18:21:09 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_peer_cert_chain): add new method
	  SSLSocket#peer_cert_chain.

	* ext/openssl/ossl_x509req.c (GetX509ReqPtr): new function
	  which returns underlying X509_REQ.

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_set_issuer_cert,
	  ossl_x509extfactory_set_subject_cert, ossl_x509extfactory_set_crl,
	  ossl_x509extfactory_set_subject_req, ossl_x509extfactory_set_config):
	  use underlying C struct without duplication not to leak momory.

Sat Nov  1 01:49:03 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/mapping/factory.rb: mark marshalled basetype objects when
	  @allow_original_mapping is true.  multi-referencing basetype node is
	  prohibited in SOAP/1.1 encoding but soap4r's original ruby object
	  mapping requires basetype to be marked to detect self referencing
	  loop.  e.g. o = 1; o.instance_eval { @iv = o }  soap4r's original
	  mapping is only used through soap/marshal API.

	* test/soap/marshal/test_marshal.rb: add tests for self referencing
	  immutable objects.

	* test/soap/calc/test_calc_cgi.rb: fix test name.

Fri Oct 31 22:26:29 2003  Takaaki Uematsu  <uema2x@jcom.home.ne.jp>

	* wince/string_wce.c (strrchr): should decrement pointer.

	* wince/Makefile.sub: correct a range of isdigit().

Fri Oct 31 12:55:24 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in, lib/mkmf.rb: add RPATHFLAG for NetBSD.
	  [ruby-dev:21791]

	* bcc32/Makefile.sub, win32/Makefile.sub, win32/Makefile.sub: ditto.

Fri Oct 31 01:38:14 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* wince/Makefile.sub, win32/Makefile.sub (.y.c): allow white spaces
	  at the beginning of line to remove by sed. (ruby-bugs-ja:PR#580)

Fri Oct 31 01:02:24 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* compar.c (cmp_equal): protect exceptions from <=> comparison
	  again.  returns nil if any exception or error happened during
	  comparison.

	* eval.c (search_required): should update *featurep when DLEXT2 is
	  defined. (ruby-bugs-ja:PR#581)

Thu Oct 30 23:41:04 2003  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: add DRbArray

	* lib/drb/invokemethod.rb: fix Hash#each problem. [ruby-dev:21773]

	* lib/drb/unix.rb: add LoadError. [ruby-dev:21743]

Thu Oct 30 23:19:11 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/generator.rb: better XML pretty printing.

	* lib/soap/encodingstyle/soapHandler.rb: remove unnecessary namespace
	  assignment in the element which has "encodingStyle" attribute, and
	  add necessary namespace assignment for "arrayType" attribute.

	* test/soap/calc/test_calc_cgi.rb: take over $DEBUG to ruby process
	  through CGI.

Thu Oct 30 22:59:39 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/yaml2byte.c: HASH const too long.  Thanks, matz.

Thu Oct 30 19:13:53 2003  Akinori MUSHA  <knu@iDaemons.org>

	* ext/syck/MANIFEST: Add yamlbyte.h.

Thu Oct 30 14:25:31 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (READ_DATA_BUFFERED): new macro to detect whether stdio
	  buffer filled.

	* io.c (rb_io_fptr_cleanup): move path deallocation to
	  rb_io_fptr_finalize (finalizer called by GC).

Thu Oct 30 13:23:39 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (logop): left may be NULL. [ruby-talk:84539]

	* eval.c (rb_eval): NODE_CASE nd_head may be NULL.

Thu Oct 30 10:14:51 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/test/unit/autorunner.rb: make fox runner work.

Thu Oct 30 09:32:26 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (rb_f_system): fixed lack of security check before
	  calling do_spawn() on win32. [ruby-talk:84555]

Thu Oct 30 02:46:35 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): single array value to normal Proc#call
	  (i.e. not via lambda call), should be treated just like yield.
	  [ruby-dev:21726]

Thu Oct 30 02:25:48 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/buffering.rb (Buffering#initialize):
	  add new method to inherit @sync from @io.sync.

	* ext/openssl/lib/net/protocols.rb (SSLIO#ssl_connect): no need to
	  set sync flag explicitly.

	* ext/openssl/ossl_ssl.c (ossl_sslctx_initialize): call super.

	* ext/openssl/ossl_ssl.c (ossl_sslctx_setup): set extra chain
	  certificates in @extra_chain_cert.

Wed Oct 29 22:02:04 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/drb/drbtest.rb: use rbconfig.rb to make the path of ruby
	  interpreter to exec, instead of test/ruby/envutil.rb,

Wed Oct 29 19:58:59 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/tcltklib/tcltklib.c (CONST84): define CONST84 when it is not
	  defined and TCL_MAJOR_VERSION >= 8.

	* ext/tcltklib/tcltklib.c (VwaitVarProc, WaitVariableProc,
	  rb_threadVwaitProc): use CONST84 instead of CONST.

	* ext/tcltklib/tcltklib.c (ip_rbTkWaitCommand,
	  ip_rb_threadTkWaitCommand): use CONST84 always.

Wed Oct 29 17:27:05 2003  Tanaka Akira  <akr@m17n.org>

	* re.c (rb_reg_s_union, Init_Regexp): new method `Regexp.union'.

	* lib/pathname.rb (realpath): examine Dir.pwd because it may have
	  symlinks.

Wed Oct 29 17:16:31 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_longjmp): must not disturb original jump.
	  [ruby-dev:21733]

Wed Oct 29 15:28:34 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_Proc): taint preallocated exception object
	  sysstack_error. [ruby-talk:84534]

Wed Oct 29 11:27:39 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (ret_args): node may be NULL. [ruby-talk:84530]

Tue Oct 28 15:20:12 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/tcltklib/tcltklib.c (VwaitVarProc, ip_rbVwaitObjCmd,
	  WaitVariableProc, WaitVisibilityProc, WaitWindowProc,
	  ip_rbTkWaitObjCmd, ip_rbTkWaitCommand, rb_threadVwaitProc,
	  rb_threadWaitVisibilityProc, rb_threadWaitWindowProc,
	  ip_rb_threadVwaitObjCmd, ip_rb_threadTkWaitObjCmd): prototype;
	  avoid VC++ warnings.

Mon Oct 27 19:19:55 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_longjmp): ignore reentering error while warning.
	  [ruby-dev:21730]

Mon Oct 27 00:23:50 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (ip_ruby): bug fix on Win : hang-up when
	  calling 'exit' in the Tk callback procedure. [ruby-list:38656]

Sat Oct 25 09:18:04 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_method_missing): protect exception from within
	  "inspect".  (ruby-bugs:PR#1204)

Fri Oct 24 23:26:34 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* hash.c (rb_hash_each): Hash#each should yield single value.
	  [ruby-talk:84420]

	* hash.c (env_each): ditto for ENV.each.

Thu Oct 23 20:25:32 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/server.rb (GenericServer#start): should rescue
	  IOError from IO::accept. [ruby-dev:21692]

Thu Oct 23 17:59:36 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): initialize stack bottom for embedding.
	  [ruby-dev:21686]

	* ext/dl/extconf.rb: move list of files to clean from DEPEND file,
	  to get rid of macro redefinitions.

Thu Oct 23 13:44:00 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y: integrate operations for stack_type.  [ruby-dev:21681]

Thu Oct 23 00:41:45 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/calc/*, test/soap/helloworld/*: set logging threshold
	  to ERROR.

Wed Oct 22 12:53:31 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/collector/dir.rb (Test::Unit::Collector::Dir#collect_file):
	  ignore tests which raised LoadError.

	* test/drb/drbtest.rb, test/ruby/test_beginendblock.rb,
	  test/ruby/test_system.rb: avoid requiring same file twice.

	* test/drb/test_drbssl.rb, test/drb/test_drbunix.rb: should not use
	  ARGV unless invoked directly.  do not create test cases unless
	  required libraries are available.

Wed Oct 22 02:31:34 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (ruby_cleanup): should not ignore exit_value in END
	  execution. [ruby-dev:21670]

Tue Oct 21 23:16:26 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (ruby_cleanup): call finalizers and exit procs before
	  terminating threads.

	* eval.c (ruby_cleanup): preserve ruby_errinfo before ruby_finalize_0().

Tue Oct 21 15:57:11 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/collector/dir.rb (Test::Unit::Collector::Dir#collect_file):
	  prepend the directory of target file to the load path.

Tue Oct 21 15:08:53 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (do_spawn, do_aspawn): should wait child process even
	  if callded with P_OVERLAY.

	* win32/win32.c (do_spawn, do_aspawn): should return child's exit
	  status to parent.

Tue Oct 21 00:35:02 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/calc/*, test/soap/helloworld/*: catch the exception from
	  test server thread and recover.

Tue Oct 21 00:22:57 2003  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/drb/*: import drb/runit.

Mon Oct 20 23:55:47 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): set current node after arguments evaluation.
	  [ruby-dev:21632]

	* eval.c (rb_yield_0): set current node and keep it at local jump.

Mon Oct 20 22:01:18 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_cleanup): keep thread group for main thread.
	  [ruby-dev:21644]

Mon Oct 20 18:28:10 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_catch): backout.

Mon Oct 20 17:31:46 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (PUSH_FRAME): generate unique number to be TAG_JUMP()
	  destination.

	* eval.c (localjump_destination): use unique number in ruby_frame
	  for localjump destination.

Mon Oct 20 11:31:44 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_signal.rb (test_signal): restore old trap.

Mon Oct 20 11:00:46 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (gc_sweep): loosen page free condition to avoid add_heap()
	  race condition. [ruby-dev:21633]

	* gc.c (gc_sweep): do not update malloc_limit when malloc_increase
	  is smaller than malloc_limit.

Mon Oct 20 09:45:12 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/debug.rb (debug_command): remove debug print.

Sun Oct 19 13:12:30 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (foreachline, dir_foreach): add obsolete warning.

Sun Oct 19 00:14:22 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/calc/*, test/soap/helloworkd/*: changed port# of test
	  server. (17171)

Sat Oct 18 23:01:32 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* missing/acosh.c (DBL_MANT_DIG): typo fix(ifdef -> ifndef).

Sat Oct 18 05:48:59 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c: YAML::Syck::compile method.

	* ext/syck/syck.c: Buffer edge bug.

	* ext/syck/yaml2byte.c: YAML to bytecode converter.

	* ext/syck/yamlbyte.h: Ditto.

	* ext/syck/bytecode.c: Bytecode parser fixes to empty collections
	  and empty strings.

	* ext/syck/token.c: Ditto.

Fri Oct 17 23:07:38 2003  Akinori MUSHA  <knu@iDaemons.org>

	* ext/enumerator/enumerator.c, ext/enumerator/enumerator.txt:
	  Provide Kernel#to_enum as an alias for Kernel#enum_for.  Maybe
	  this is a better name.

Fri Oct 17 23:00:30 2003  Akinori MUSHA  <knu@iDaemons.org>

	* lib/generator.rb: Add rdoc documentation.

Fri Oct 17 22:16:42 2003  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb: Reword and fix Overview.

	* lib/set.rb: It is not necessary to require
	  'test/unit/ui/console/testrunner'.

Fri Oct 17 11:15:22 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_range.rb: added.

	* MANIFEST: add test/ruby/test_range.rb.

Fri Oct 17 03:21:23 2003  William Sobel  <will.sobel@barra.com>

	* ext/socket/socket.c (make_hostent): h_aliases may be NULL.
	  (ruby-bugs:PR#1195)

	* ext/socket/socket.c (sock_s_gethostbyaddr): ditto.

Fri Oct 17 00:12:41 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: (bug fix) instance variable @frame was used
	  without initializing on TkComposite module.

Thu Oct 16 23:51:04 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: If $DEBUG == true and some exception is caused
	  in a callback operation, Ruby/Tk shows a (verbose) backtrace
	  information on the callback process.

Thu Oct 16 17:09:19 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/debug.rb (DEBUGGER__::Context::debug_command): do not call
	  debug_silent_eval() when $1 is not set. (ruby-bugs:PR#1194)

Thu Oct 16 16:54:57 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (rb_str_upto): ("a"..."a").to_a should return [].
	  [ruby-core:01634]

Thu Oct 16 16:40:51 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb:
	  Add Tk::EncodedString and Tk::UTF8_String class to support
	  characters using the \uXXXX escape to the UNICODE string.

	* ext/tk/sample/{demos-en,demos-jp}/unicodeout.rb
	  new demo-scripts (samples of Tk::UTF8_String)

	* ext/tk/sample/{demos-en,demos-jp}/widget
	  add entries for 'unicodeout.rb'

Thu Oct 16 08:38:06 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/digest/test_digest.rb (test_eq): show failed class.

	* test/ruby/test_iterator.rb (test_break, test_return_trace_func):
	  test localjump destination.

Wed Oct 15 20:22:31 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/netHttpClient.rb: use URI::HTTP#request_uri instead of
	  instance_eval('path_query').  [ruby-list:38575]

Wed Oct 15 17:24:45 2003  URABE Shyouhei  <root@mput.dip.jp>

	* lib/cgi.rb (CGI::Cookie): tiny typo fix.

Wed Oct 15 15:00:54 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_run): just return FAILURE instead of parse error
	  count.  [ruby-list:38569]

Wed Oct 15 13:17:02 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/digest/digest.c (rb_digest_base_alloc): need to initialize
	  buffer. [ruby-dev:21622]

Wed Oct 15 11:23:05 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_object): dump extended modules as well.

	* marshal.c (r_object0): TYPE_USRMARSHAL should restore extended
	  modules before invoking marshal_load.  these two fixes are done
	  by Masatoshi Seki <m_seki@mva.biglobe.ne.jp>.

Wed Oct 15 09:30:34 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/enumerator/enumerator.c (enumerator_each): avoid VC++ warning.

	* ext/syck/syck.h: include stdio.h for definition of FILE.

Wed Oct 15 08:09:07 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/bytecode.c: Checkin of YAML bytecode support.

	* ext/syck/gram.c: Ditto.

	* ext/syck/syck.c: Ditto.

	* ext/syck/token.c: Ditto.

	* ext/syck/handler.c: Ditto.

	* ext/syck/handler.c: Now using 'tag' rather than 'taguri' in type URIs.

	* ext/syck/rubyext.c: Ditto (on both counts).

Wed Oct 15 05:05:53 2003  Akinori MUSHA  <knu@iDaemons.org>

	* lib/generator.rb: A new library which converts an internal
	  iterator to an external iterator.

	* lib/abbrev.rb: A new library which creates an abbreviation table
	  from a list.

Wed Oct 15 04:31:51 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/sample/demos-en/entry3.rb, ext/tk/sample/demos-jp/entry3.rb:
	  new demo-scripts

	* ext/tk/sample/demos-en/widget, ext/tk/sample/demos-jp/widget:
	  add entries for 'entry3.rb'

Wed Oct 15 04:31:47 2003  Akinori MUSHA  <knu@iDaemons.org>

	* test/digest/test_digest.rb: Moved from ext/digest/test.rb.

Wed Oct 15 03:53:20 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fixed trouble on auto-load Tcl commands (enbug
	  on the last commit).

Wed Oct 15 00:25:00 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (yylex): argument parentheses preceded by spaces should
	  be warned; not error.  [ruby-talk:84103]

Wed Oct 15 00:20:15 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c: replace Tcl/Tk's vwait and tkwait to
	  switch on threads smoothly and avoid seg-fault.

	* ext/tcltklib/tcltklib.c: add TclTkIp._thread_vwait and
	  _thread_tkwait for waiting on a thread. (Because Tcl/Tk's vwait
	  and tkwait command wait on an eventloop.)

	* ext/tk/lib/multi-tk.rb: support TclTkIp._thread_vwait and
	  _thread_tkwait.

	* ext/tk/lib/tk.rb: now, TkVariable#wait has 2 arguments.
	  If 1st argument is true, waits on a thread. If false, waits on
	  an eventloop. If 2nd argument is true, checks existence of
	  rootwidgets. If false, doesn't. Default is wait(true, false).

	* ext/tk/lib/tk.rb: add TkVariable#tkwait(arg) which is equal to
	  TkVariable#wait(arg, true). wait_visibility and wait_destroy
	  have an argument for waiting on a thread or an eventloop.

	* ext/tk/lib/tk.rb: improve of accessing Tcl/Tk's special variables.

	* ext/tk/lib/tkafter.rb: support 'wait on a thread' and 'wait on
	  an eventloop'.

Wed Oct 15 00:10:24 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/baseData.rb: Introduce SOAPType as the common ancestor of
	  SOAPBasetype and SOAPCompoundtype.

	* lib/soap/generator.rb, lib/soap/element.rb, lib/soap/encodingstyle/*:
	  Encoding methods signature change.  Pass SOAPGenerator as a parameter.

	* lib/soap/mapping/*, test/soap/marshal/test_marshal.rb: Refactoring
	  for better marshalling/unmarshalling support.  Now I think SOAP
	  marshaller supports all kind of object graph which is supported by
	  Ruby's original marshaller.  Of course there could be bugs as always.
	  Find it.  :-)

	* lib/soap/rpc/standaloneServer.rb: Set severity threshould to INFO.
	  DEBUG is too noisy.

	* lib/xsd/datatypes.rb: DateTime#of is obsoleted.  Use DateTime#offset.

	* test/wsdl/emptycomplextype.wsdl, test/xsd/xmlschema.xml: Avoid
	  useless warning.

Tue Oct 14 19:09:35 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_finalize_0): return the given exit status unless
	  SystemExit got raised.

Tue Oct 14 11:53:49 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h (ruby_stop): never return.

	* ruby.h (ruby_run): ditto.

Tue Oct 14 04:43:55 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (realpath): make ELOOP check bit more robust.
	  (children): prepend self by default.
	  (chroot): obsoleted.

Tue Oct 14 02:29:31 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_require_safe): segfault after loading .so.

Tue Oct 14 02:05:23 2003  Akinori MUSHA  <knu@iDaemons.org>

	* ext/Setup*, ext/enumerator/*: Add ext/enumerator, a helper
	  module for the Enumerable interface.

Mon Oct 13 23:55:59 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* test/ruby/envutil.rb: use Config::CONFIG["ruby_install_name"],
	  not "ruby".

Mon Oct 13 23:57:29 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_feature_p): match by classified suffix.

	* eval.c (rb_require_safe): require library in the specified safe
	  level.

	* variable.c (rb_autoload, rb_autoload_load): restore safe level
	  when autoload was called.  [ruby-dev:21338]

	* intern.h: prototypes; rb_require_safe.

	* test/runner.rb: accept non-option arguments.

Mon Oct 13 20:49:51 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_new4): should not preserve FL_TAINT status in the
	  internal shared string. [ruby-dev:21601]

	* string.c (rb_str_new4): ditto.

	* eval.c: use EXIT_SUCCESS and EXIT_FAILURE for exit values.

	* process.c: ditto. [ruby-list:38521]

Mon Oct 13 19:51:02 2003  Koji Arai  <jca02266@nifty.ne.jp>

	* lib/debug.rb (debug_command): should enter emacs mode when
	  assigned any value to the environment variable "EMACS".
	  On Meadow, (getenv "EMACS") is "meadow".

Sun Oct 12 14:45:03 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/win32ole/extconf.rb: check "windows.h", not "windows".
	  [ruby-talk:84051]

Sat Oct 11 20:41:03 2003  Corinna Vinschen  <corinna@vinschen.de>

	* file.c (eaccess): Use access(2) on Cygwin.

Sat Oct 11 17:09:21 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/rexml/quickpath.rb (REXML::QuickPath::match):
	  escape '[' to avoid warning.

Sat Oct 11 16:08:41 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (realpath): check existence of the file.

	* lib/pathname.rb (realpath): re-implemented.
	  (realpath_root?, realpath_rec): removed

Sat Oct 11 10:19:39 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/monitor.rb: handle exceptions correctly. Thanks, Gennady
	  Bystritsky.

Fri Oct 10 07:50:54 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (is_defined): inheritance line adjustment as like as
	  rb_call_super().

Fri Oct 10 01:19:00 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_x509name.c (ossl_x509name_initialize): add
	  optional argument to specify the DirectoryString type
	  (ASN1::UTF8STRING by default). RFC3280 deprecates PrintableString
	  for DirectoryString, and strongly requires to use UTF8String for
	  all certificates issued after December, 31 2003.

	* ext/openssl/lib/openssl/x509.rb (X509::Name::parse): ditto.

Thu Oct  9 23:50:21 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_start_0): prevent thread from GC.
	  [ruby-dev:21572]

Thu Oct  9 19:11:44 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_start_0): non-volatile should be restored from
	  volatile.

Thu Oct  9 17:43:36 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (proc_save_safe_level, proc_get_safe_level,
	  proc_set_safe_level): save/restore safe level 1..4.

Thu Oct  9 16:33:23 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (r_object0): remove unnecessary iv restoration for
	  USRMARSHAL. [ruby-dev:21582]

	* marshal.c (w_object): dump generic instance variables from
	  a string from '_dump'.

	* variable.c (rb_generic_ivar_table): return 0 if obj's FL_EXIVAR
	  is not set.

	* time.c (time_dump): copy instance variables to dumped string, to
	  be included in the marshaled data.

	* bignum.c (rb_big2ulong): add range check to ensure round trip.

Thu Oct  9 15:45:27 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* pack.c (uv_to_utf8): change message to "out of range", since
	  negative values are not "too big". [ruby-dev:21567]

Thu Oct  9 14:05:38 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_set_end_proc, rb_exec_end_proc): restore safe level.
	  [ruby-dev:21557]

Thu Oct  9 10:51:04 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_yield_0): no error if block is empty.

Thu Oct  9 06:43:33 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (localjump_error): id should be ID.

	* eval.c (rb_eval): nd_rval is set in copy_node_scope().

	* eval.c (rb_yield_0): unused variable.

	* eval.c (rb_yield_0): nothing to do for empty node.

	* eval.c (call_end_proc, proc_invoke): adjust backtrace in END.
	  [ruby-dev:21551]

	* eval.c (rb_thread_start_0): set the value by break as the result.
	  [ruby-dev:21552]

	* eval.c (rb_thread_start_0, rb_thread_raise, rb_callcc): save
	  variables across THREAD_SAVE_CONTEXT.

Thu Oct  9 12:05:46 2003  Eric Sunshine  <sunshine@sunshineco.com>

	* configure.in: revived NextStep, OpenStep, and Rhapsody ports which
	  had become unbuildable; enhanced --enable-fat-binary option so that
	  it accepts a list of desired architectures (rather than assuming a
	  fixed list), or defaults to a platform-appropriate list if user does
	  not provide an explicit list; made the default list of architectures
	  for MAB (fat binary) more comprehensive; now uses -fno-common even
	  when building the interpreter (in addition to using it for
	  extensions), thus allowing the interpreter to be embedded into a
	  plugin module of an external project (in addition to allowing
	  embedding directly into an application); added checks for
	  <netinet/in_systm.h> (needed by `socket' extension) and getcwd(); now
	  ensures that -I/usr/local/include is employed when extensions'
	  extconf.rb scripts invoke have_header() since extension checks on
	  NextStep and OpenStep will fail without it if the desired resource
	  resides in the /usr/local tree; fixed formatting of --help message.

	* Makefile.in: $(LIBRUBY_A) rule now deletes the archive before
	  invoking $(AR) since `ar' on Apple/NeXT can not "update" MAB archives
	  (see configure's --enable-fat-binary option); added rule for new
	  missing/getcwd.c.

	* defines.h: fixed endian handling during MAB build (see configure's
	  --enable-fat-binary option) to ensure that all portions of the
	  project see the correct WORDS_BIGENDIAN value (some extension modules
	  were getting the wrong endian setting); added missing constants
	  GETPGRP_VOID, WNOHANG, WUNTRACED, X_OK, and type pid_t for NextStep
	  and OpenStep; removed unnecessary and problematic HAVE_SYS_WAIT_H
	  define in NeXT section.

	* dir.c: do not allow NAMLEN() macro to trust dirent::d_namlen on
	  NextStep since, on some installations, this value always resolves
	  uselessly to zero.

	* dln.c: added error reporting to NextStep extension loader since the
	  previous behavior of failing silently was not useful; now ensures
	  that NSLINKMODULE_OPTION_BINDNOW compatibility constant is defined
	  for OpenStep and Rhapsody; no longer includes <mach-o/dyld.h> twice
	  on Rhapsody since this header lacks multiple-include protection,
	  which resulted in "redefinition" compilation errors.

	* main.c: also create hard reference to objc_msgSend() on NeXT
	  platforms (in addition to Apple platforms).

	* lib/mkmf.rb: now exports XCFLAGS from configure script to extension
	  makefiles so that extensions can be built MAB (see configure's
	  --enable-fat-binary option); also utilize XCFLAGS in cc_command()
	  (but not cpp_command() because MAB flags are incompatible with
	  direct invocation of `cpp').

	* ext/curses/extconf.rb: now additionally checks for presence of these
	  curses functions which are not present on NextStep or Openstep:
	  bkgd(), bkgdset(), color(), curs(), getbkgd(), init(), scrl(), set(),
	  setscrreg(), wattroff(), wattron(), wattrset(), wbkgd(), wbkgdset(),
	  wscrl(), wsetscrreg()

	* ext/curses/curses.c: added appropriate #ifdef's for additional set of
	  curses functions now checked by extconf.rb; fixed curses_bkgd() and
	  window_bkgd() to correctly return boolean result rather than numeric
	  result; fixed window_getbkgd() to correctly signal an error by
	  returning nil rather than -1.

	* ext/etc/etc.c: setup_passwd() and setup_group() now check for null
	  pointers before invoking rb_tainted_str_new2() upon fields extracted
	  from `struct passwd' and `struct group' since null pointers in some
	  fields are common on NextStep/OpenStep (especially so for the
	  `pw_comment' field) and rb_tainted_str_new2() throws an exception
	  when it receives a null pointer.

	* ext/pty/pty.c: include "util.h" for strdup()/ruby_strdup() for
	  platforms such as NextStep and OpenStep which lack strdup().

	* ext/socket/getaddrinfo.c: cast first argument of getservbyname(),
	  gethostbyaddr(), and gethostbyname() from (const char*) to non-const
	  (char*) for older platforms such as NextStep and OpenStep.

	* ext/socket/socket.c: include "util.h" for strdup()/ruby_strdup() for
	  platforms such as NextStep and OpenStep which lack strdup(); include
	  <netinet/in_systm.h> if present for NextStep and OpenStep; cast first
	  argument of gethostbyaddr() and getservbyname() from (const char*) to
	  non-const (char*) for older platforms.

	* ext/syslog/syslog.c: include "util.h" for strdup()/ruby_strdup() for
	  platforms such as NextStep and OpenStep which lack strdup().

Wed Oct  8 22:19:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit.rb: removed installation instructions.

	* lib/test/unit/ui/testrunnermediator.rb: moved the run flag to a more
	  central location.

	* lib/test/unit.rb: ditto.

	* lib/test/unit.rb: extracted the running code in to AutoRunner.

	* lib/test/unit/autorunner.rb: added.

	* lib/test/unit/collector/objectspace.rb: extracted common test
	  collection functionality in to a module.

	* lib/test/unit/collector.rb: ditto; added.

	* test/testunit/collector/test_objectspace.rb: ditto.

	* lib/test/unit/collector/dir.rb: added. Supports collecting tests out
	  of a directory structure.

	* test/testunit/collector/test_dir.rb: added.

	* test/runner.rb: simplified to use the new capabilities.

Tue Oct  7 15:23:09 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_beginendblock.rb: add tests for nested BEGIN/END.

	* test/ruby/beginmainend.rb: add tests for nested BEGIN/END.

	* test/ruby/endblockwarn.rb: new file added to test of END-in-method
	  warning.

Tue Oct  7 12:23:47 2003  Tanaka Akira  <akr@m17n.org>

	* ext/fcntl/fcntl.c (Init_fcntl): define Fcntl::O_ACCMODE.

	* ext/socket/extconf.rb: useless assignment removed.

Tue Oct  7 09:13:24 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_beginendblock.rb (test_endinmethod): END{} is now
	  allowed in eval.

Tue Oct  7 04:15:25 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): should not expand mrhs if lhs is solely starred.

Tue Oct  7 02:57:53 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (stmt): rhs of multiple assignment should not be
	  expanded using "to_a". [ruby-dev:21527]

Tue Oct  7 01:42:34 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_get_asn1type): use appropriate
	  free function for ASN1_OBJECT.

	* ext/openssl/ossl_asn1.c (ossl_asn1obj_get_sn): add new function for
	  ASN1::ObjectId#sn; it returns short name text representation of OID.

	* ext/openssl/ossl_asn1.c (ossl_asn1obj_get_ln): add new function for
	  ASN1::ObjectId#ln; it returns long name text representation of OID.

	* ext/openssl/ossl_asn1.c (ossl_asn1obj_get_oid): add new function for
	  ASN1::ObjectId#oid; it returns numerical representation of OID.

Mon Oct  6 22:59:46 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb (IOReader, BasicWriter): call binmode when a given IO
	  respond_to?(:binmode).  record separator was wrong when you gave
	  text mode IO to Reader.parse and Writer.generate.

	* test/csv/test_csv.rb: add tests for above change.

Mon Oct  6 16:23:38 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object): wrong method name in the message.

Mon Oct  6 16:02:05 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (stmt): END in method should cause warning.
	  [ruby-dev:21519]

Mon Oct  6 15:17:23 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_iterator.rb (test_block_argument_without_paren):
	  added. (follows sample/test.rb)

Mon Oct  6 11:57:06 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_beginendblock.rb, test/ruby/beginmainend.rb: added
	  test for eval-ed BEGIN END order.

Mon Oct  6 09:19:54 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_object): should pass "weak" value to next level.
	  [ruby-dev:21496]

	* eval.c (proc_alloc): should not use cached object if klass is
	  different. [ruby-talk:83685]

Sun Oct  5 23:27:09 2003  Tanaka Akira  <akr@m17n.org>

	* ext/socket/extconf.rb: check recvmsg even if sendmsg is exists.

	* ext/socket/socket.c (thread_read_select): restored.

	* lib/pathname.rb: version information is added in document.

Sun Oct  5 23:07:03 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_f_END): block should be given.  [ruby-dev:21497]

Sun Oct  5 22:51:23 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/ext/openssl/extconf.rb: add check for some engine functions
	  unavailable in OpenSSL-0.9.6.

	* lib/ext/openssl/ossl_engine.c: ditto.

Sun Oct  5 17:56:30 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): fix evaluation order.  [ruby-list:38431]

Sun Oct  5 15:05:06 2003  akira yamada  <akira@ruby-lang.org>

	* test/uri/*: translated RUNIT to Test::Unit.

Sun Oct  5 14:37:39 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/xsd/datatypes.rb: Rational -> Decimal string bug fix.

	* test/soap/marshal/test_marshal.rb: ditto.

	* test/soap/calc/test_calc_cgi.rb: add Config::CONFIG["EXEEXT"] to
	  RUBYBIN.

Sun Oct  5 13:47:22 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_beginendblock.rb, test/ruby/beginmainend.rb: add tests
	  about scope, order and allowed syntax.

Sun Oct  5 11:54:29 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/envutil.rb: added.  split "rubybin" from test_system.rb.

	* test/ruby/test_system.rb: use envutil.rb

	* test/ruby/test_beginendblock.rb: added.

	* test/ruby/beginmainend.rb: added.  used in test_beginendblock.rb.

Sun Oct  5 11:23:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* test/testunit/runit/test_testresult.rb: removed some unnecessary
	  cruft.

Sun Oct  5 11:14:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/rubyunit.rb: aliasing TestCase into the top level is
	  problematic.

	* lib/runit/assert.rb: fixed a couple of bugs caused by recent
	  refactoring in Test::Unit.

	* test/testunit/runit/*: added.

Sun Oct  5 10:55:29 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/open-uri.rb (URI::Generic#find_proxy): no_proxy support did not
	  work.  [ruby-dev:21484]

Sun Oct  5 09:52:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: will use pp for output if available.
	  Can be disabled by setting Assertions.use_pp = false.

	* test/testunit/test_assertions.rb: made a small change to exception
	  formatting.

Sun Oct  5 07:42:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: made small improvements to assertion
	  messages. Deprecated Assertions#assert_not_nil; use #assert instead.

	* test/testunit/test_assertions.rb: ditto.

	* test/testunit/util/test_procwrapper.rb: use #assert instead of
	  #assert_not_nil.

Sun Oct  5 04:10:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: refactored message building.

Sun Oct  5 03:40:22 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.h: global symbols should be declared
	  as external.

Sun Oct  5 03:03:20 2003  akira yamada  <akira@ruby-lang.org>

	* test/ruby/test_exception.rb (test_else): added.

Sun Oct  5 02:12:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: changed assertion messages to rely more
	  heavily on #inspect. Added backtrace filtering for exceptions in
	  assertion messages.

	* test/testunit/test_assertions.rb: ditto.

Sun Oct  5 02:12:00 2003  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/acl.rb, lib/drb/ssl.rb: added.

	* lib/drb/drb.rb: exit from a thread using 'break'.

Sat Oct  4 21:49:14 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* gc.c (Init_stack): the type of space is changed to unsigned int
	  from double.  [ruby-dev:21483]

Sat Oct  4 17:52:59 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/netHttpClient.rb: follow http-access2.  hosts which matches
	  ENV['no_proxy'] or ENV['NO_PROXY'] are not proxyed.
	  - [,:] separated. ("ruby-lang.org:rubyist.net")
	  - no regexp. (give "ruby-lang.org", not "*.ruby-lang.org")
	  - if you want specify host by IP address, give full address.
	    ("192.168.1.1, 192.168.1.2")

	* lib/soap/rpc/cgistub.rb: return "Status: XXX MMM" line.

	* test/runner.rb: give testsuite name.

Sat Oct  4 15:16:02 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_object): instance variable dump do not cause error
	  for objects that cannot be dumped, if they traversed from
	  marshal_dump.  they are just ignored.

	* gc.c (Init_stack): cast "space" (doble value) into unsigned
	  int.  should run on PowerPC.

	* eval.c (rb_eval): should not execute else part if any exception
	  is caught. [ruby-dev:21482]

	* parse.y (f_args): should allow unparenthesized block argument.

	* parse.y (f_rest_arg): should allow unparenthesized rest
	  argument.

Sat Oct  4 14:59:51 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (initialize): raise ArgumentError if argument has
	  '\0' character.
	  (relative_path_from): new method.
	  (each_entry): new method for replacement of dir_foreach.
	  (foreach, foreachline, dir_foreach, chdir): obsoleted.

Sat Oct  4 12:58:48 2003  akira yamada  <akira@ruby-lang.org>

	* test/uri/* (6 files): added.

Sat Oct  4 12:44:45 2003  akira yamada  <akira@ruby-lang.org>

	* lib/uri/ftp.rb, lib/uri/mailto.rb: renamed to #to_s from #to_str.

Sat Oct  4 07:33:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/testsuite.rb: changed #<< to return self, and added
	  #delete.

	* test/testunit/test_testsuite.rb: ditto. Also slightly refactored
	  #test_size.

	* lib/test/unit/collector/objectspace.rb: collector now preserves the
	  hierarchy of suites.

	* test/testunit/collector/test_objectspace.rb: ditto.

Sat Oct  4 04:48:49 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c: default keys handled.

	* ext/syck/syck.h: lowered default buffer size to 16k for increased
	  performance.

	* test/yaml: checkin of basic unit tests.

Sat Oct  4 04:24:19 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/extconf.rb: add check for X509V3_set_nconf.

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_set_config):
	  cannot implement if X509V3_set_nconf doesn't exist.

Sat Oct  4 02:12:44 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/xsd/datatypes.rb: dump sign by itself.  under the problematic
	  platform, sprintf("%+.10g", -0.0) => +0.  sigh.

	* sample/wsdl/amazon/*: update schema ver2 to ver3.

Sat Oct  4 01:33:46 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb (initialize): duplicate and freeze argument.
	  (to_s): return duplicated string.
	  (children): new method.
	  (each_line): new alias to foreachline.

Fri Oct  3 16:13:19 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_asn1.c: add DER encoder and decoder.

	* ext/openssl/ossl_asn1.h: add OpenSSL::ASN1 module.

	* ext/openssl/ossl.c (Init_openssl): call Init_ossl_asn1.

	* ext/openssl/extconf.rb: check if X509_ATTRIBUTE has field "single".

	* ext/openssl/ossl_x509attr.c (ossl_x509attr_set_value): accept
	  DER encoded data argument.

	* ext/openssl/ossl_x509attr.c (ossl_x509attr_get_value): return
	  DER encoded data in OpenSSL::ASN1 types.

Fri Oct  3 13:02:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit.rb: refactored to use optparse.

	* lib/test/unit.rb: added support for selecting the output
	  level from the command-line.

	* lib/test/unit.rb: added a command-line switch to stop processing
	  the command-line, allowing arguments to be passed to tests.

	* lib/test/unit.rb: changed the method for specifying a runner or a
	  filter from the command-line.

	* lib/test/unit/collector/objectspace.rb: fixed a bug causing all
	  tests to be excluded when the filter was set to an empty array.

	* test/testunit/collector/test_objectspace.rb: ditto.

Fri Oct  3 08:14:32 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex::identify_identifier): support
	  'class ::Foo' syntax. [ruby-talk:83514]

Fri Oct  3 08:01:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: added a default message for #assert,
	  #assert_block, and #flunk.

	* test/testunit/test_assertions.rb: ditto.

	* lib/test/unit/failure.rb: failures now show a better trace of where
	  they occurred.

	* test/testunit/test_failure.rb: ditto (added).

	* lib/test/unit/testcase.rb: ditto.

	* test/testunit/test_testcase.rb: ditto.

	* lib/test/unit/util/backtracefilter.rb: added.

	* test/testunit/util/test_backtracefilter.rb: added.

	* lib/test/unit/error.rb: changed to use BacktraceFilter and improved
	  output.

	* test/testunit/test_error.rb: ditto.

Thu Oct  2 20:33:49 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_failure_initialize): conform with
	  orthodox initialization method.

	* ext/iconv/iconv.c (iconv_fail): initialize exception instance
	  from the class, and do not share instance variables with the
	  others.  [ruby-dev:21470]

Thu Oct  2 18:20:27 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (Init_Time): define initialize.  [ruby-dev:21469]

Thu Oct  2 17:39:38 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_engine.c: add a new module OpenSSL::Engine.
	  it supports OpenSSL hardware cryptographic engine interface.

	* ext/openssl/ossl_engine.h: ditto.

	* ext/openssl/MANIFEST: add ossl_engine.c and ossl_engine.h.

	* ext/openssl/extconf.rb: add check for openssl/engine.h.

	* ext/openssl/ossl.c: call Init_ossl_engine().

	* ext/openssl/ossl.h: include openssl/engine.h.

	* ext/openssl/ossl_pkey_{rsa,dsa,dh}.c: check if underlying
	  EVP_PKEY referes engine.

Thu Oct  2 17:22:37 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_load): restore instance variables (if any) before
	  loading from marshaled data.

Thu Oct  2 14:19:15 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (iconv_fail): now yield erred substring, and
	  set error object to $!.

	* ext/iconv/iconv.c (iconv_convert): error handler block should
	  return appended part and the rest.  if rest is nil, the
	  conversion stops.

Thu Oct  2 12:00:18 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_const_defined_0): look up constants in Object as
	  well.  [ruby-dev:21458]

	* test/ruby/test_defined.rb (TestDefined::test_defined): test for
	  constants.

Thu Oct  2 11:17:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/assertions.rb: should not capture an
	  AssertionFailedError unless explicitly requested.

	* test/testunit/test_assertions.rb: ditto.

	* test/testunit/collector/test_objectspace.rb: fixed a test failure
	  caused by methods being returned in different orders on different
	  platforms by moving test sorting from TestSuite into the locations
	  where suites are constructed. [ruby-talk:83156]

	* lib/test/unit/testcase.rb: ditto.

	* lib/test/unit/testsuite.rb: ditto.

	* lib/test/unit/collector/objectspace.rb: ditto.

Thu Oct  2 03:25:01 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* eval.c (rb_thread_raise): prototype; avoid VC++ warning.

Thu Oct  2 01:37:34 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* time.c (time_mdump): new marshal dumper. _dump is still
	  available for compatibility.

	* time.c (time_mload): new marshal loader.

	* marshal.c (w_object): preserve instance variables for objects
	  with marshal_dump.

	* marshal.c (r_object0): restore instance variables before calling
	  marshal_load.

	* error.c (rb_warn_m): always return nil.

Thu Oct  2 01:32:46 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_block_given_p): real required condition is
	  ruby_frame->prev->iter == ITER_CUR.

	* eval.c (rb_block_given_p): ditto.

	* eval.c (block_pass): update ruby_frame->iter only when previous
	  value is ITER_NOT.

Thu Oct  2 01:02:35 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_const_defined_at): should exclude constants from
	  Object when TYPE(klass) == T_MODULE *and* exclude is on.
	  [ruby-dev:21458]

	* variable.c (rb_const_get_0): do not lookup constants from Object
	  when TYPE(klass) == T_MODULE *and* exclude is on.

Thu Oct  2 00:21:11 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/logger/test_logger.rb: unlinking file before close causes
	  problem under win32 box.

	* lib/xsd/datatypes.rb(XSDFloat, XSDDouble): add +/- sign explicitly
	  when stringified and embedded into XML instance.  Ruby's sprintf may
	  format -0.0 as "0.0" (no minus sign) depending on underlying C
	  sprintf implementation.

	* test/xsd/test_xsd.rb, test/soap/test_basetype.rb: follow above change.

	* test/soap/calc/*: give httpd config param "CGIInterpreter".
	  "/usr/bin/env ruby" thing does not work under non-Unix boxes.

Thu Oct  2 00:25:21 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (ruby_signal_name): adjust to the prototype.

	* process.c (pst_inspect): ditto.

	* ext/etc/etc.c (etc_getgrent, Init_etc): typo.

Wed Oct  1 20:49:41 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (heaps): manage slots and limits together.  [ruby-dev:21453]

	* gc.c (add_heap): should not clear heaps slot even if realloc()
	  failed.

Wed Oct  1 20:36:49 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* MANIFEST: add wince/mkconfig_wce.rb.

Wed Oct  1 17:22:33 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/etc/etc.c: add new functions: setpwent, getpwent, endpwent,
	  setgrent, getgrent, endgrent.

	* ext/socket/socket.c (sock_s_gethostbyname): do not reverse lookup.

Wed Oct  1 17:01:30 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_load): Object scope had priority over required file
	  scope.  [ruby-dev:21415]

Wed Oct  1 14:09:53 2003  Takaaki Uematsu  <uema2x@jcom.home.ne.jp>

	* wince/mkconfig_wce.rb: sorry, forget to commit.

Wed Oct  1 10:08:42 2003  Takaaki Uematsu  <uema2x@jcom.home.ne.jp>

	* wince/setup.mak: add sigmarionIII SDK support.

	* wince/Makefile.sub: ditto.

	* wince/mkexports.rb: fix linker error in SH4.

	* wince/mkconfig_wce.rb: camouflage RUBY_PLATFORM for compiling ext.

Wed Oct  1 08:02:52 2003  Takaaki Uematsu  <uema2x@jcom.home.ne.jp>

	* wince/time_wce.c (time): add zero check.

Tue Sep 30 16:11:05 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* Makefile.in: copy lex.c from $(srcdir) if it's not the current
	  directory.  [ruby-dev:21437]

Tue Sep 30 11:29:23 2003  Tanaka Akira  <akr@m17n.org>

	* process.c (pst_inspect): describe stopped process "stopped".

Tue Sep 30 09:31:56 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/runner.rb: glob for directories.

Tue Sep 30 09:11:43 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): while/until should not capture break unless
	  they are destination of the break.

Tue Sep 30 03:12:02 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (finish): revert to 1.93.

	* lib/net/pop.rb (finish): revert to 1.60.

	* lib/net/smtp.rb (finish): revert to 1.67.

	* lib/net/http.rb (do_start): ensure to close socket if failed to
	  start session.

	* lib/net/pop.rb (do_start): ditto.

	* lib/net/smtp.rb (do_start): ditto.

	* lib/net/smtp.rb: SMTP#started? wrongly returned false always.

Tue Sep 30 02:54:49 2003  Minero Aoki  <aamine@loveruby.net>

	* test/ruby/test_iterator.rb: new test
	  test_break__nested_loop[123].

Mon Sep 29 23:39:13 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb (finish): does not raise IOError even if
	  !started?, to allow closing socket which was opened before
	  session started.

	* lib/net/pop.rb (finish): ditto.

	* lib/net/smtp.rb (finish): ditto.

Mon Sep 29 19:06:51 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/win32ole/extconf.rb: add windows.h checking.
	  (ruby-bugs:PR#1185)

Mon Sep 29 16:18:30 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: check if the given logdevice object respond_to :write
	  and :close, not is_a? IO.  duck duck.

	* test/logger/test_logger.rb: self IO.pipe reading/writing may be
	  locked by the flood.  use tempfile.

	* lib/wsdl/xmlSchema/data.rb: wrong constant reference.

Mon Sep 29 16:11:23 2003  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb: clean up temporary symlink.
	  Patched by NaHi.  [ruby-dev:21420]

Mon Sep 29 11:16:55 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_thread_atfork): wrong format specifier.
	  [ruby-dev:21428]

	* process.c (pst_inspect): better description.

Mon Sep 29 02:31:44 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/utils.rb (Utils::su): use setgid and setuid to
	  set real and effective IDs. and setup group access list by
	  initgroups.

Sun Sep 28 11:14:19 2003  Koji Arai  <jca02266@nifty.ne.jp>

	* ext/digest/digest.c (Init_digest): `copy_object' was deprecated.
	  `initialize_copy' should be defined.

	* ext/stringio/stringio.c (Init_stringio): ditto.

Sat Sep 27 18:25:13 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/xsd/charset.rb: XSD::Charset.is_ces did return always true under
	  $KCODE = "NONE" environment.  check added.

	* test/xsd/test_xsd.rb: add tests for above fix.

Sat Sep 27 15:58:50 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/rpc/cgistub.rb: make logging severity threshold higher.

	* lib/soap/rpc/standaloneServer.rb: defer WEBrick server start to give
	  a chance to reset logging severity threshold.

	* test/soap/calc/test_*, test/soap/helloworld/test_helloworld.rb: run
	  silent.

Sat Sep 27 09:44:18 2003  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/test_fileutils.rb: clear all errors on Windows.
	  [ruby-dev:21417]

	* test/fileutils/test_nowrite.rb: ditto.

Sat Sep 27 04:57:07 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_file.rb: new file.  only asserts unlink-before-close
	  behaviour now.

	* test/soap/marshal/test_digraph.rb: should close before unlink.
	  unlink-before-close pattern is not needed here.

Sat Sep 27 03:32:37 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/soap/*, test/wsdl/*, test/xsd/*: move TestCase classes into
	  each module namespace.  TestMarshal in
	  test/soap/marshal/test_marshal.rb crashed with
	  test/ruby/test_marshal.rb.

Sat Sep 27 01:30:59 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/socket.c (ruby_connect): on win32, type of the 4th
	  argument of getsockopt is char *.

Fri Sep 26 18:35:40 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/resolv-replace.rb: 1.8 compliance.  [ruby-talk:82946]

Fri Sep 26 17:39:27 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_marshal.rb: add test for ruby's objects.

Fri Sep 26 09:52:44 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* defines.h (flush_register_windows): use volatile only for gcc on
	  Solaris.  [ruby-dev:21403]

	* lib/mkmf.rb (xsystem): use system directly to honor shell meta
	  charaters.

Fri Sep 26 00:10:13 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/README: updated.

Thu Sep 25 17:48:10 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl.c (ossl_buf2str): fix type of 1st argument for
	  rb_protect.

	* ext/openssl/ossl_hmac.c (ossl_hmac_digest): should return meaningful
	  value.

Thu Sep 25 09:00:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/ostruct.rb: Added OpenStruct#==.

	* test/ostruct/test_ostruct.rb: Added.

Thu Sep 25 07:55:26 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/win32ole/win32ole.c, ext/openssl/ossl_pkey_dsa.c,
	  ext/openssl/ossl_pkey_rsa.c, ext/bigdecimal/bigdecimal.h: must
	  not use C++ or C99 style comment yet.  (ruby-bugs:PR#1184)

Thu Sep 25 00:23:22 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* MANIFEST: add SOAP4R.

Thu Sep 25 00:13:15 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/soap/* (29 files): SOAP4R added.

	* lib/wsdl/* (42 files): WSDL4R added.

	* lib/xsd/* (12 files): XSD4R added.

	* test/soap/* (16 files): added.

	* test/wsdl/* (2 files): added.

	* test/xsd/* (3 files): added.

	* sample/soap/* (27 files): added.

	* sample/wsdl/* (13 files): added.

Wed Sep 24 02:08:11 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpservlet/cgihandler.rb: conform to mswin32.
	  [ruby-talk:82735], [ruby-talk:82748], [ruby-talk:82818]

Tue Sep 23 23:10:16 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: add Logger#<<(msg) for writing msg without any
	  formatting.

	* test/logger/test_logger.rb: ditto.

Tue Sep 23 20:47:51 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* error.c (rb_warn_m): should not warn if -W0 is specified.
	  [ruby-talk:82675]

Mon Sep 22 21:28:57 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* MANIFEST: updated.

Mon Sep 22 19:22:26 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* configure.in (AC_CHECK_FUNCS): add setuid and setgid.

Mon Sep 22 12:34:55 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* util.c (ruby_strtod): skip preceding zeros before counting
	  digits in the mantissa. (ruby-bugs:PR#1181)

Sun Sep 21 04:12:36 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ocsp.c (ossl_ocspreq_initialize): the argument
	  should be a String.

	* ext/openssl/ossl_ocsp.c (ossl_ocspres_initialize): ditt.

	* ext/openssl/ossl_x509attr.c (ossl_x509attr_initialize): ditto.

	* ext/openssl/ossl_x509ext.c (ossl_x509ext_initialize): ditto.

	* ext/openssl/ossl_x509ext.c (ossl_x509ext_set_value): ditto.

Sat Sep 20 11:49:05 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: typo fixed.

	* test/logger/test_logger.rb: new file.

Fri Sep 19 11:39:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* test/testunit/*: Added.

	* lib/test/unit.rb: Documentation update.

	* lib/test/unit/ui/console/testrunner.rb (TestRunner#initialize):
	  Ditto.

	* lib/test/unit.rb: Factored out an ObjectSpace collector.

	* lib/test/unit/collector/objectspace.rb: Ditto.

	* sample/testunit/*: Added.

Fri Sep 19 01:00:48 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/log.rb (BasicLog#log): get rid of as ineffectual
	  condition.

	* lib/webrick/log.rb (BasicLog#format): add "\n" to message.

Thu Sep 18 22:43:20 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): should push PROT_PCALL tag for orphans.

	* eval.c (proc_invoke): should update "result" for orphans.

Thu Sep 18 20:33:03 2003  Tietew  <tietew-ml-ruby-list@tietew.net>

	* parse.y (str_xquote): do not prepend escapes in
	  backqoute literals.  [ruby-list:38409]

Thu Sep 18 20:30:17 2003  Tanaka Akira  <akr@m17n.org>

	* lib/pathname.rb: update document.

Thu Sep 18 15:27:05 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: new file.  Logger, formerly called devel-logger or
	  Devel::Logger.

	* sample/logger/*: new file.  samples of logger.rb.

Wed Sep 17 23:41:45 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (localjump_destination): should not raise ThreadError
	  exception for "break". [ruby-dev:21348]

	* eval.c (proc_invoke): use result instead of prot_tag->retval.
	  retval is no longer propagated to the ancestors.

Wed Sep 17 20:34:00 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (tokadd_string, parse_string, yylex): escaped terminator
	  is now interpreted as is.  [ruby-talk:82206]

Wed Sep 17 18:52:36 2003  Minero Aoki  <aamine@loveruby.net>

	* test/fileutils/fileassertions.rb: new file.

	* test/fileutils/test_fileutils.rb: new file.

	* test/fileutils/test_nowrite.rb: new file.

Wed Sep 17 18:51:02 2003  Minero Aoki  <aamine@loveruby.net>

	* test/strscan/test_stringscanner.rb: require test/unit.

Wed Sep 17 18:35:34 2003  Minero Aoki  <aamine@loveruby.net>

	* test/strscan/test_stringscanner.rb: new file.

Wed Sep 17 18:03:30 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl: all files are reviewed to simplify and avoid memory leak.

	* ext/openssl/extconf.rb: add check for assert.h.

	* ext/openssl/ossl.c (ossl_buf2str): new function to convert
	  C buffer to String and free buffer.

	* ext/openssl/ossl.c (ossl_x509_ary2sk): new function to convert
	  Array of OpenSSL::X509 to STACK_OF(X509) with exception safe.

	* ext/openssl/ossl.c (ossl_to_der, ossl_to_der_if_possible): new
	  functions to convert object to DER string.

	* ext/openssl/ossl.h: ditto.

	* ext/openssl/ossl_bio.c (ossl_membio2str): new function to convert
	  BIO to String object and free BIO.

	* ext/openssl/ossl_bio.h: ditto.

	* ext/openssl/ossl_pkcs7.c (ossl_pkcs7_to_der): add for "to_der".

	* ext/openssl/ossl_x509name.c (ossl_x509name_to_der): ditto.

	* ext/openssl/ossl_x509ext.c (ossl_x509ext_to_der): ditto.

	* ext/openssl/ossl_x509ext.c (create_ext_from_array): removed
	  and reimplement in openssl/x509.rb.

	* ext/openssl/ossl_x509attr.c: reimplemented and disable some
	  method temporarily. this class doesn't work fine without ASN.1
	  data support;-) I'll rewrite in near future.

	* ext/openssl/lib/openssl/x509.c (X509::Attribute): get rid off
	  unused code.

	* ext/openssl/lib/openssl/x509.c (X509::ExtensionFactory): refine all.

Tue Sep 16 22:25:06 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/csv/test_csv.rb: add negative tests of row_sep.

Tue Sep 16 18:02:36 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* regex.c (re_compile_pattern): should not translate character
	  class range edge. [ruby-list:38393]

Tue Sep 16 16:47:56 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* MANIFEST: add test/csv/mac.csv.

	* win32/Makefile.sub, bcc32/Makefile.sub (test): add phony NUL target.

Mon Sep 15 19:02:52 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/csv.rb: add extra pamameter to specify row(record) separater
	  character.  To parse Mac's CR separated CSV, do like this.
	    CSV.open("mac.csv", "r", ?,, ?\r) { |row| p row.to_a }
	  The 3rd parameter in this example ?, is for column separater and the
	  4th ?\r is for row separater.  Row separater is nil by default.  Nil
	  separater means "\r\n" or "\n".

	* test/csv/test_csv.rb: add tests for above feature.

	* test/csv/mac.csv: added.  Sample CR separated CSV file.

Fri Sep 12 22:41:48 2003  Michal Rokos  <m.rokos@sh.cvut.cz>

	* ext/openssl/ossl.c: move ASN.1 stuff to ossl_asn1.[ch]

	* ext/openssl/ossl.c: move BIO stuff to ossl_bio.[ch]

	* ext/openssl/ossl_asn1.[ch]: new files

	* ext/openssl/ossl_bio.[ch]: new files

Fri Sep 12 12:30:41 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* intern.h (rb_disable_super, rb_enable_super): replace with dummy
	  expressions instead of prototypes.  the functions remain yet for
	  binary compatibility.  [ruby-talk:81758]

Fri Sep 12 12:09:54 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (rb_big_and): convert argument using 'to_int'.

	* bignum.c (rb_big_or): ditto.

	* bignum.c (rb_big_xor): ditto.

Fri Sep 12 07:06:14 2003  David Black  <dblack@superlink.net>

	* lib/scanf.rb: Took out useless @matched_item variable; some small
	  refactoring.

Thu Sep 11 08:43:44 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_require): allow "require" on $SAFE>0, if feature
	  name is not tainted.

	* lib/rexml/parsers/baseparser.rb (REXML::Parsers::BaseParser::stream):
	  Supports StringIO.

Wed Sep 10 22:47:30 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.h: add a workaround for win32 platform.
	  libeay32.dll doesn't export functions defined in conf_api.h.

	* ext/openssl/ossl_config.c (ossl_config_initialize): ditto.

	* ext/openssl/ossl_config.c (ossl_config_add_value): ditto.

	* ext/openssl/ossl_config.c (set_conf_section_i): should check
	  if the argument is Array.

Wed Sep 10 22:41:54 2003  Tietew  <tietew@tietew.net>

	* eval.c (win32_get_exception_list): avoid VC7 warning.
	  [ruby-win32:577]

Tue Sep  9 10:39:51 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (struct tag): dst should be VALUE.

	* eval.c (localjump_destination): stop at the scope where the current
	  block was created.  [ruby-dev:21353]

Tue Sep  9 05:17:04 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_config.rb: avoid compile error in OpenSSL-0.9.6.

Tue Sep  9 02:41:35 2003  Michal Rokos  <m.rokos@sh.cvut.cz>

	* ext/openssl/ossl_config.c: Refine compatibility.

Tue Sep  9 01:50:45 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httpserver.rb (HTTPServer#access_log): add "\n" to
	  the message.

	* lib/webrick/log.rb (BasicLog#log): add "\n" only if needed.

Mon Sep  8 22:15:33 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: modify security check at creating
	  a new interpreter

Mon Sep  8 20:00:12 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb, lib/optparse/version.rb: search also all
	  capital versions.

Mon Sep  8 19:26:33 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl.h: include openssl/conf.h and openssl/conf_api.h.

	* ext/openssl/ossl_config.c: refine all with backward compatibility.

	* ext/openssl/ossl_config.h: export GetConfigPtr() and DupConfigPtr().

	* ext/openssl/ossl_x509.c: added new constants under X509 module.
	  DEFAULT_CERT_AREA, DEFAULT_CERT_DIR, DEFAULT_CERT_FILE,
	  DEFAULT_CERT_DIR_ENV, DEFAULT_CERT_FILE_ENV and DEFAULT_PRIVATE_DIR.

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_free): don't free
	  the members of the struct. it's left to GC.

	* ext/openssl/ossl_x509ext.c (ossl_x509_set_config): add for config=.

	* ext/openssl/ossl_x509ext.c (Xossl_x509extfactory_initialize):
	  add attr readers: issuer_certificate, subject_certificate,
	  subject_request, crl and config.

Mon Sep  8 18:26:41 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/accesslog.rb (AccessLog::setup_params): use req.port
	  instead of config[:Port] or req.request_uri.port.

	* lib/webrick/httprequest.rb (HTTPRequest#meta_vars): ditto.

	* lib/webrick/httpservlet/filehandler.rb (FileHandler#dir_list): ditto.

	* lib/webrick/config.rb: :Listen option never be used.

	* lib/webrick/server.rb (GenericServer#initialize): don't use :Listen
	  option and add warning message.

	* lib/webrick/log.rb (BasicLog#<<): shortcut of log(INFO, ...).

	* lib/webrick/httpserver.rb (HTTPServer#accesslog): use << for logging.

Sun Sep  7 16:08:28 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (lib_mainloop_core): fixed signal-trap bug

	* ext/tk/lib/*.rb: Ruby/Tk works at $SAFE == 4

Sat Sep  6 02:26:34 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_*.rb: assert_same, assert_match, and so on.

Sat Sep  6 18:45:46 2003  Mauricio Fernandez  <batsman.geo@yahoo.com>

	* parse.y (assignable): call rb_compile_error(), not rb_bug().
	  [ruby-core:01523]

Sat Sep  6 17:40:41 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ruby_missing.c: rid of unnecessary backward
	  compatibility stuff. and remove DEFINE_ALLOC_WRAPPER from
	  all sources.

	* ext/openssl/ossl_x509ext.c (X509::Extension.new): new method.

	* ext/openssl/ossl_x509ext.c (X509::Extension#oid=): new method.

	* ext/openssl/ossl_x509ext.c (X509::Extension#value=): new method.

	* ext/openssl/ossl_x509ext.c (X509::Extension#critical=): new method.

Sat Sep  6 01:23:22 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): need to quote cmd if RUBYSHELL is set.

	* win32/win32.c (CreateChild): fix condition about whether to call
	  shell or not.

Sat Sep  6 00:36:20 2003  Nobuyoshi Nakada  <nobu.nokada@softhome.net>

	* Makefile.in (test): phony target.

	* lib/mkmf.rb (have_library, find_library): configure by library
	  name.

	* lib/optparse.rb (OptionParser#order, #permute, #parse): allow an
	  array as argument.

	* test/ruby/test_*.rb: moved invariants to left side in
	  assert_equal, and use assert_nil, assert_raises and so on.

	* win32/win32.c (isInternalCmd): distinguish command.com and
	  cmd.exe.

	* win32/win32.c (make_cmdvector): a character just after wildcard
	  was ignored.  [ruby-core:01518]

Fri Sep  5 20:27:08 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_*.rb: replace 'assert(a == b)' with assert_equal(a, b)'

Fri Sep  5 18:00:51 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/x509.rb: new method X509::Name::parse.

	* ext/openssl/ossl_digest.c: add ossl_digest_new().

	* ext/openssl/ossl_digest.h: ditto.

	* ext/openssl/ossl_cipher.c: add ossl_cipher_new().

	* ext/openssl/ossl_cipher.h: ditto.

Fri Sep  5 15:32:04 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-font-lock-maybe-here-docs): should not
	  search delimiter forward if found in backward.

Fri Sep  5 13:32:48 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/runner.rb: arguments should be keys.

Fri Sep  5 12:09:55 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* test/ruby/test_system.rb (test_system): check existence of ruby
	  interpreter.

Fri Sep  5 11:32:17 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (--version): fix assignment/reference order.

	* lib/optparse.rb (OptionParser#help): new; OptionParser#to_s may
	  be deprecated in future.

	* lib/optparse/version.rb (OptionParser#show_version): hide Object.

	* test/runner.rb: fix optparse usage.

	* test/runner.rb: glob all testsuits if no tests given.

Fri Sep  5 10:42:58 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/runner.rb: added.  gets testcases from command line and runs it.

	* test/ruby/test_gc.rb: remove useless part which was for dumping test
	  result.

Fri Sep  5 09:28:59 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby/test_gc.rb: added.  splitter.rb which I made to split
	  sample/test.rb into test/ruby/test_* kindly removed GC test (the
	  last section in the original test) to reduce things to be worried.

Fri Sep  5 03:00:04 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_iterator.rb (test_block_in_arg): add no block
	  given tests.

	* test/ruby/test_iterator.rb (test_ljump): uncomment LocalJumpError
	  test.

Fri Sep  5 01:10:11 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/ruby: tests for ruby itself.

	* test/ruby/test_*.rb: split sample/test.rb into 28 test/unit testcases.
	  some tests could not be translates...  search '!!' mark to see it.

	* test/csv/test_csv.rb: should require 'csv', not '../lib/csv'.  test
	  runner should set load path correctly.

Fri Sep  5 01:03:59 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/csv/test_csv.rb: close opened files for CSV::IOBuf explicitly.
	  opened file cannot be removed under win32 box.

Thu Sep  4 23:59:40 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (tokadd_string): newlines have no special meanings in
	  %w/%W, otherwise they are ignored only when interpolation is
	  enabled.  [ruby-dev:21325]

Thu Sep  4 19:38:25 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/io/wait/.cvsignore: added.

	* ext/openssl/.cvsignore: added.

Thu Sep  4 19:28:24 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* sample/openssl: added.  Sample of standard distribution library
	  should be locate in sample/{module_name}/*.

	* ext/openssl/sample/*: removed.  move to sample/openssl/*.

Thu Sep  4 18:02:15 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/csv/test_csv.rb: use remove_const to reduce warnings.  use
	  Dir.tmpdir to locate working files.

Thu Sep  4 17:41:31 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-here-doc-beg-re): underscore also is
	  valid delimiter.

	* misc/ruby-mode.el (ruby-here-doc-end-match): must quote
	  arbitrary string to use as regexp.

	* misc/ruby-mode.el (ruby-font-lock-maybe-here-docs): must not
	  call `ruby-here-doc-end-match' unless `ruby-here-doc-beg-re'
	  matched.

Thu Sep  4 15:40:07 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/csv/test_csv.rb: run on test/unit original layer.

Thu Sep  4 12:54:50 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/token.c: headerless documents with root-level spacing now
	  honored.

Thu Sep  4 00:06:14 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (mark_frame_adj): need to adjust argv pointer if using
	  system's alloca. [ruby-core:01503]

Wed Sep  3 21:33:20 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test: add test directory.  Test::Unit aware testcases and needed
	  files should be located in this directory.  dir/file name convention;
	    test/{module_name}/test_{testcase_name}.rb
	    test/{module_name}/{needed_files}
	  someday, someone will write testrunner which searches test_*.rb and
	  run testcases automatically.

	* test/csv/*: add testcase for lib/csv.rb.

Wed Sep  3 01:37:09 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (rb_f_gets): should call next_argv() before type check
	  current_file. [ruby-list:38336]

Tue Sep  2 20:37:15 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/net/protocols.rb (SSLIO#ssl_connect): warning
	  for skipping server verification.

Tue Sep  2 23:36:57 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (proc_invoke): should retrieve retval when pcall is true.

Tue Sep  2 14:09:20 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* ext/socket/extconf.rb: check s6_addr8 in in6_addr (Tru64 UNIX).
	  the patch is submitted by nmu <nmu@users.sourceforge.jp>.

	* ext/socket/getaddrinfo.c (getaddrinfo): should use in6_addr8 on
	  some platforms.

	* ext/socket/getnameinfo.c (getnameinfo): ditto.

Tue Sep  2 14:02:19 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tcltklib/tcltklib.c (ip_invoke): fixed bug on passing a exception

	* ext/tk/lib/{tk.rb, tkcanvas.rb, tkfont.rb, tktext.rb}:
	  bug fix and improvement of font control

Tue Sep  2 09:51:36 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): should not handle exceptions within rescue
	  argument.  [ruby-talk:80804]

Tue Sep  2 00:44:37 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* re.c (rb_memsearch): fix overrun.  [ruby-talk:80759]

Tue Sep  2 00:41:27 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (map_charset): use lower case keys.

	* ext/iconv/iconv.c (iconv_fail): just yield error and return the
	  result if a block is given.

	* ext/iconv/iconv.c (iconv_convert): yield error and append the
	  result if a block is given.

	* ext/iconv/charset_alias.rb (charset_alias): optional third
	  argument.

	* ext/iconv/charset_alias.rb (charset_alias): use CP932 instead of
	  SHIFT_JIS on cygwin.

Mon Sep  1 18:34:25 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval): make tail recursion in ELSE clause of
	  RESCUE a jump.

Mon Sep  1 18:00:02 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (aref_args): forgot to call NEW_SPLAT(). reported by
	  Dave Butcher.

	* eval.c (Init_Thread): protect thgroup_default.  suggested by Guy
	  Decoux in [ruby-talk:80623]

Mon Sep  1 16:59:10 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_thread_switch): add RESTORE_EXIT; exit by another
	  thread termination.

	* eval.c (rb_thread_start_0): should not error_print() within
	  terminated thread, because $stderr used by it might be
	  overriden now.  [ruby-dev:21280]

Sun Aug 31 22:46:55 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* eval.c (TAG_DST()): take no argument.

	* process.c (p_gid_sw_ensure): return VALUE.

Sun Aug 31 22:27:10 2003  Hidetoshi NAGAI  <nagai@dumbo.ai.kyutech.ac.jp>

	* process.c (p_gid_sw_ensure): lack of function type

Sun Aug 31 12:25:06 2003  Nobuyoshi Nakada  <nobu.nokada@softhome.net>

	* lib/optparse.rb: --version takes an optional argument; "all" or
	  a list of package names.

Sun Aug 31 10:17:02 2003  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/format.rb: yyyy/mm is not an acceptable format.

	* lib/time.rb: follow above.

Sat Aug 30 14:25:43 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_iter_break): should not call TAG_JUMP directly.

Sat Aug 30 03:58:21 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (struct BLOCK): remove BLOCKTAG, use scope instead.

	* eval.c (POP_TAG): no longer propagate retval.  retval is now set
	  directly by localjump_destination().

	* eval.c (localjump_destination): new function to cast
	  return/break local jump.

	* eval.c (rb_yield_0): stop TAG_RETURN/TAG_BREAK escaping.

Fri Aug 29 22:35:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* bigdecimal.c *.html: The 2nd arg. for add,sub,mult, and div is 0,
	  then result will be the same as +,-,*,/ respectively.

Fri Aug 29 17:30:15 2003  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* process.c: bug fix

	* process.c: add rb_secure(2) to methods of Process::{UID,GID,Sys}

	* process.c: deny handling IDs during evaluating the block given to
	  the Process::{UID,GID}.switch method

	* ext/tcltklib/tcltklib.c: some methods have no effect if on slave-IP

	* ext/tcltklib/tcltklib.c: can create a interpreter without Tk

	* ext/tcltklib/tcltklib.c: bug fix on handling exceptions

	* ext/tcltklib/MANUAL.euc: modify

	* ext/tk/lib/tk.rb: freeze some core modules

	* ext/tk/lib/multi-tk.rb: more secure

	* ext/tk/lib/tk.rb: TkVariable.new(array) --> treat the array as the
	  Tk's list

	* ext/tk/lib/tk.rb: improve accessibility of TkVariable object

	* ext/tk/lib/tk.rb, ext/tk/lib/tkfont.rb, ext/tk/lib/tkcanvas.rb,
	  ext/tk/lib/tktext.rb: fix bug of font handling

	* ext/tk/lib/tkfont.rb: TkFont.new() accepts compound fonts

Thu Aug 28 22:07:12 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_autoload_load): call const_missing if autoloading
	  constant is not defined to allow hook.

	* eval.c (rb_eval): use rb_const_get_from() instead of
	  rb_const_get_at().

	* eval.c (is_defined): forgot to check NODE_COLON3.

Thu Aug 28 17:30:24 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_const_get_0): should check constants defined in
	  included modules, if klass is Object. [ruby-talk:79302]

	* numeric.c (check_uint): check should be done using UINT_MAX, not
	  INT_MAX. this fix is submitted by Lyle Johnson
	  <lyle@knology.net> in [ruby-core:01486]

Thu Aug 28 05:02:52 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (singleton): typo fixed (ruby-bugs-ja:PR#562)

Thu Aug 28 02:37:45 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_eval): *a = [1,2] now assigns [[1,2]] to a.
	  consistent with *a = [1], which set [[1]] to a.

	* node.h: merge NODE_RESTARY to NODE_SPLAT.

	* parse.y: rules simplified a bit by removing NODE_RESTARY.

	* sample/test.rb: updated for new assignment behavior.

Wed Aug 27 22:33:24 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_bug): should not use other methods; this function is
	  not for ordinary use.  [ruby-dev:21259]

Wed Aug 27 15:07:57 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/smtp.rb (check_response): AUTH CRAM-MD5 returns 334
	  response. [ruby-list:38279]

Wed Aug 27 05:10:15 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (map_errno): support winsock error.

	* win32/win32.c (pipe_exec, CreateChild, poll_child_status, waitpid,
	  kill, link, rb_w32_rename, unixtime_to_filetime, rb_w32_utime):
	  pass errno to map_errno().

	* win32/win32.c (rb_w32_select, rb_w32_accept, rb_w32_bind,
	  rb_w32_connect, rb_w32_getpeername, rb_w32_getsockname,
	  rb_w32_getsockopt, rb_w32_ioctlsocket, rb_w32_listen, rb_w32_recv,
	  rb_w32_recvfrom, rb_w32_send, rb_w32_sendto, rb_w32_setsockopt,
	  rb_w32_shutdown, rb_w32_socket, rb_w32_gethostbyaddr,
	  rb_w32_gethostbyname, rb_w32_gethostname, rb_w32_getprotobyname,
	  rb_w32_getprotobynumber, rb_w32_getservbyname, rb_w32_getservbyport,
	  rb_w32_fclose, rb_w32_close): use map_errno().

	* win32/win32.h: add winsock errors.

Tue Aug 26 23:53:23 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct::method_missing): prohibit modifying
	  frozen OpenStruct. [ruby-talk:80214]

Tue Aug 26 20:03:50 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_tmpsrc): add the hook for source.
	  [ruby-list:38122]

Tue Aug 26 15:59:53 2003  why the lucky stiff  <why@ruby-lang.org>

	* implicit.c (syck_type_id_to_taguri): corrected detection of
	  x-private types.

Sun Aug 24 01:02:48 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): performance improvement.
	  [ruby-talk:79748]

Sat Aug 23 23:41:16 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* file.c (rb_file_s_expand_path): avoid calling rb_scan_args() for
	  apparent cases. [ruby-talk:79748]

Sat Aug 23 18:56:53 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/nkf/nkf.c (rb_nkf_putchar): should use rb_str_resize() to just
	  resize a string, rb_str_cat() disallows NULL.  [ruby-dev:21237]

Sat Aug 23 16:48:41 2003  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/ruby-lex.rb: bug fix for "foo" !~ /bar/. [ruby-talk:79942]

Sat Aug 23 15:59:58 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_eval, rb_iterate, block_pass): reduce PUSH/POP_TAG and
	  EXEC_TAG() for retry.  [ruby-dev:21216]

Sat Aug 23 02:32:33 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_yield_splat): should check if "values" is array.

	* enum.c (each_with_index_i): typo.

Fri Aug 22 17:07:05 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (inject_i): use rb_yield_values.

	* enum.c (each_with_index_i): ditto.

	* eval.c (rb_yield_splat): new function to call "yield *values".

	* string.c (rb_str_scan): use rb_yield_splat().

Fri Aug 22 06:13:22 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/rubyext.c: refactoring of the transfer method
	  dispatch.  added yaml_org_handler for faster dispatch of
	  transfers to base types.

	* lib/yaml/rubytypes.rb: removed handling of builtins from
	  Ruby library.

	* ext/syck/token.c: quoted and block scalars are now implicit !str

	* ext/syck/implicit.c: empty string detected as !null.

Fri Aug 22 01:00:31 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (block_pass): improve passing current block.

Fri Aug 22 00:13:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c: Int. overflow bug in multiplication
	  fixed, and VpNmlz() speed up.

Wed Aug 20 16:44:49 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/socket.c (ruby_connect): many systems seem to have
	  a problem in select() after EINPROGRESS.  [ruby-list:38080]

Wed Aug 20 01:31:17 2003  why the lucky stiff  <why@ruby-lang.org>

	* ext/syck/syck.h: Parser definition problems on HP-UX.
	  [ruby-talk:79389]

	* ext/syck/handler.c (syck_hdlr_get_anchor): Memory leak.

	* ext/syck/syck.s (syck_io_file_read): Bad arguments to fread.

	* ext/syck/rubyext.c: Tainting issues.

Tue Aug 19 23:20:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c .h .html: to_s("+") implemented.

	* ext/bigdecimal/lib/bigdecimal/math.rb: E implemented.

Tue Aug 19 11:19:33 2003  Shugo Maeda  <shugo@ruby-lang.org>

	* io.c (next_argv): should not call GetOpenFile() if rb_stdout is
	  not a IO (T_FILE).

Tue Aug 19 07:47:10 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/ssl.rb: new file; SSL/TLS enhancement for GenericServer.

	* lib/webrick/https.rb: SSLSocket handling is moved to webrick/ssl.rb.

	* lib/webrick/compat.rb (File::fnmatch): remove old migration code.

	* lib/webrick/httpserver.rb (HTTPServer#run): ditto.

	* lib/webrick/server.rb (GenericServer#listen): the body of this
	  method is pull out as Utils::create_lisnteners.

	* lib/webrick/utils.rb (Utils::create_lisnteners): new method.

	* lib/webrick/server.rb (GenericServer#start): should rescue
	  unknown errors. and refine comments.

	* ext/openssl/lib/openssl/ssl.rb (SSLServer#accept): should close
	  socket if SSLSocket raises error.

Tue Aug 19 07:47:09 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/ossl_ssl.c: sync_close is moved to SSLSocket as
	  a builtin.

	* ext/openssl/lib/openssl/buffering.rb (Buffering#close): ditto.

	* ext/openssl/lib/openssl/buffering.rb (Buffering#puts): should
	  add a return to the tails of each line.

	* ext/openssl/lib/openssl/ssl.rb: new class OpenSSL::SSL::SSLServer.

	* ext/openssl/lib/net/protocols.rb (SSLIO#ssl_connect): use sync_close.

	* ext/openssl/sample/echo_svr.rb: use SSLServer.

	* ext/openssl/sample/echo_cli.rb: add example of SSLSocket#sync_close.

Tue Aug 19 01:24:34 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/curses/curses.c (_XOPEN_SOURCE_EXTENDED): Mac OS X standard
	  headers are inconsistent at this macro.  [ruby-core:01432]

	* ext/curses/extconf.rb: check if _XOPEN_SOURCE_EXTENDED breaks.

	* ext/tcltklib/stubs.c: Status macro in X11/Xthreads.h bothers
	  winspool.h

	* instruby.rb: make list at first instead of iterator.
	  [ruby-talk:79347]

Mon Aug 18 11:23:11 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_helper): preserve raw order for **.

Sun Aug 17 23:39:55 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/extconf.rb (HAVE_VA_ARGS_MACRO): need to compile.

Sun Aug 17 17:10:03 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/ssl.rb (SSLSocket#sync_close=): add a
	  method to specify if the underlying IO will be closed in
	  SSLSocket#close.

	* ext/openssl/lib/openssl/buffering.rb: add forwarders to
	  setsockopt, getsockopt and fcntl.

	* ext/openssl/lib/net/protocols.rb: enable sync for SSLSocket.

Sun Aug 17 11:32:04 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): should not force to remake Makefile when
	  installation and so on.

Sat Aug 16 23:58:18 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_symbol, w_object): get rid of warnings.

	* re.c (rb_memsearch): ditto.

	* time.c (time_dump): ditto.

	* ext/extmk.rb (extmake): not continue making when extconf.rb
	  failed.

	* ext/openssl/extconf.rb: check __VA_ARGS__ macro more precisely.

	* ext/openssl/ossl.h: remove version.h dependency.

	* ext/openssl/ruby_missing.h: ditto.

	* lib/mkmf.rb (pkg_config): use --libs output except with
	  only-L for other options.  [ruby-list:38099]

	* lib/mkmf.rb (create_makefile): separate rule for static
	  library from shared object.

	* win32/Makefile.sub, bcc32/Makefile.sub, wince/Makefile.sub:
	  define exec_prefix and libdir.

Fri Aug 15 23:15:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c .h: Bug in combination of limit & div
	  method fixed.

	* ext/bigdecimal/lib/bigdecimal/math.rb: atan() & sqrt() added.

Fri Aug 15 12:01:44 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (HUGE_ST_INO): check whether struct stat.st_ino
	  is larger than long.  [ruby-dev:21194]
	  http://www.geocities.co.jp/SiliconValley-PaloAlto/1409/ruby/beos.html

	* error.c (syserr_eqq): errno might exceed Fixnum limit.

	* error.c (Init_Exception): moved base initialization from
	  init_syserr().

	* inits.c (rb_call_inits): postpone initializing errnos until
	  Bignum is available.

Fri Aug 15 12:01:43 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/curses/curses.c (_XOPEN_SOURCE_EXTENDED): needed to let
	  keyname() and so on be declared.

	* ext/curses/curses.c (curses_resizeterm, window_resize):
	  arguments conflicted with macros in term.h.

	* ext/curses/curses.c (Curses module methods): ensure
	  initialized.  [ruby-dev:21191]

Fri Aug 15 02:08:53 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (id2ref): recycle check should be done by klass == 0.
	  [ruby-core:01408]

Fri Aug 15 01:34:23 2003  Michal Rokos  <m.rokos@sh.cvut.cz>

	* ext/openssl/ossl_pkey.c: move generate_cb here

	* ext/openssl/ossl_pkey_{dh|dsa|rsa}.c: adapt to this cb

	* ext/openssl/openssl_missing.[ch]: add (0.9.6x, x<j) missing BN funcs

	* ext/openssl/ossl_bn.c: use supplied funcs from openssl_missing.c

Fri Aug 15 00:38:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c: Bug in div method fixed.

	* ext/bigdecimal/lib/bigdecimal/math.rb: Newly added.

	* ext/bigdecimal/sample/pi.rb: Changed so as to use math.rb.

Thu Aug 14 21:19:14 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (Init_Thread): Continuation#[] added.  [ruby-talk:79028]

Thu Aug 14 20:03:34 2003  Masaki Suketa  <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (OLE_FREE): should not call
	  ole_message_loop.

	* ext/win32ole/win32ole.c (ole_event_free): ditto.

	* ext/win32ole/win32ole.c (ole_initialize): stop calling
	  OleUninitialize at exit.

Thu Aug 14 11:27:37 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (rb_data_object_alloc): check type of 1st argument.
	  [ruby-dev:21192]

Thu Aug 14 00:21:14 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (mlhs_node): should allow "::Foo" (colon3) as lhs.

	* parse.y (lhs): ditto.

	* parse.y (yylex): should return tCOLON3 right after kCLASS.
	  [ruby-talk:78918]

	* error.c (exc_initialize): was converting argument to string too
	  eagerly.  Only check was needed. [ruby-talk:78958]

Wed Aug 13 23:31:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c .h .html: Ambiguity of
	  BigDecimal::limit removed.

Wed Aug 13 19:21:34 2003  Christian Neukirchen  <chneukirchen@yahoo.de>

	* lib/webrick/https.rb (HTTPServer#run): should set syncing-mode
	  to SSLSocket. [ruby-talk:78919]

Wed Aug 13 18:13:49 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (POP_BLOCK): turn on BLOCK_LEFT flag when leaving block.

	* eval.c (proc_invoke): unpack return/break destination when block
	  is already left.

Wed Aug 13 15:58:31 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* object.c (rb_class_s_alloc): add function prototype to avoid VC++
	  warning.

Wed Aug 13 13:50:59 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/Win32API/Win32API.c (Win32API_initialize): should pass some
	  class to first argument of Data_Wrap_Struct(). (ruby-bugs:PR#1109)

Tue Aug 12 16:55:11 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in: static link libraries to LIBRUBY_SO with static linked
	  ext.  [ruby-dev:21157]

	* ext/extmk.rb (extmake): sort extension library initialization order.

	* ext/extmk.rb (extmake): compact $extlibs.

Tue Aug 12 02:48:56 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (THREAD_SAVE_CONTEXT): should explicitly turn off the
	  flag before calling getcontext(2).

	* eval.c (struct thread): add member to save backing store on
	  IA64. (ruby-bugs PR1086)

	* eval.c (thread_mark): mark IA64 backing store region.

	* eval.c (thread_free): free saved IA64 backing store.

	* eval.c (rb_thread_save_context): save IA64 backing store as well.

	* eval.c (rb_thread_restore_context): restore IA64 backing store.

	* eval.c (THREAD_ALLOC): initialize IA64 members.

Mon Aug 11 22:31:50 2003  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/debug.rb(debug_command): inspection command should inspect
	  resulting value even if it's nil.  [ruby-dev:21180] by OMAE, jun
	  <jun66j5@ybb.ne.jp>.

	* lib/debug.rb(debug_command): incomplete regexp.

Mon Aug 11 17:33:07 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call_super): do not use rb_block_given_p() for
	  check. [ruby-talk:78656]

	* eval.c (BEGIN_CALLARGS): push ITER_NOT only when ITER_PRE.

Sun Aug 10 10:43:05 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* ext/openssl/lib/openssl/buffering.rb: increase BLOCK_SIZE
	  from 1k to 16k bytes. [ruby-talk:78603]

	* ext/openssl/ossl_ssl.c (ossl_sslctx_s_alloc): enable
	  partial write to allow interruption in SSLSocket#write.

Sun Aug 10 00:34:16 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* cygwin/GNUmakefile: remove unnecessary '--drive-name=$(CC)'
	  for ccache.

Sat Aug  9 10:36:21 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* marshal.c (w_object): do not dump generic instance variable when
	  marshal_dump is defined.

Sat Aug  9 00:35:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal.c: F style output(like 1234.56789) implemented
	  to to_s method.
	* ext/bigdecimal_??.html: F style output(like 1234.56789)
	  implemented to to_s method.

Fri Aug  8 12:33:17 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* bcc32/Makefile.sub: rubyw.exe should be a Windows GUI program.
	  add the -aa option to WLDFLAGS.

Fri Aug  8 11:29:26 2003  Koji Arai  <jca02266@nifty.ne.jp>

	* marshal.c (w_object): should set `c_arg' at first.

Fri Aug  8 03:22:28 2003  GOTOU Yuuzou  <gotoyuzo@notwork.org>

	* lib/webrick/httputils.rb (FormData#list): should not take
	  a side effect for the receiver.

Thu Aug  7 14:40:37 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* cygwin/GNUmakefile: better --disbale-shared option support.

	* cygwin/GNUmakefile: add forwarding DLL target for cygwin.

Thu Aug  7 14:21:05 2003  Corinna Vinschen  <vinschen@redhat.com>

	* configure.in: Fix Cygwin specific naming of libraries to
	  be net distribution compliant. (ruby-bugs:PR#1077)
	  cygwin-ruby18.dll -> cygruby18.dll

Thu Aug  7 12:51:38 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_at_exit): should not be called without a block.
	  block_given check added.

Thu Aug  7 06:46:06 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_call0): forgot to pop ruby_class.

	* eval.c (rb_call0): update ruby_class as well as ruby_cref.
	  (ruby-bugs-ja:PR#540)

Thu Aug  7 04:52:50 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_yield_0): remove ruby_frame->cbase and unify to
	  ruby_cref.  [ruby-talk:78141]

Thu Aug  7 04:19:15 2003  Akinori MUSHA  <knu@iDaemons.org>

	* gc.c: FreeBSD/ia64's mcontext_t is a bit different from that of
	  Linux/ia64.  This makes gc.c compile but miniruby coredumps for
	  the moment.

Thu Aug  7 00:15:00 2003  Shigeo Kobayashi  <shigek@ruby-lang.org>

	* ext/bigdecimal.c: Comparison results adjusted to Float's.
	* ext/bigdecimal.c: Use rb_num_coerce_????(x,y) instead of own.

Wed Aug  6 22:58:00 2003  Nathaniel Talbott  <ntalbott@ruby-lang.org>

	* lib/test/unit/testcase.rb: Added equality checking.
	* lib/test/unit/testsuite.rb: Added equality checking.
	* lib/test/unit/assertions.rb: Fixed a warning.

Wed Aug  6 17:28:10 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): pass LIBPATH to make ruby.  [ruby-dev:21137]

	* ext/extmk.rb (extmake): set library name as source file name in
	  Init_ext().  [ruby-dev:21137]

	* lib/mkmf.rb (Logging::postpone): postpone logging messages after
	  heading message as the result of the block.

	* lib/mkmf.rb (macro_defined?): append newline to src unless ended
	  with it.

	* lib/mkmf.rb (have_library): treat nil function name as "main".
	  (ruby-bugs:PR#1083)

	* lib/mkmf.rb (pkg_config): should append additional libraries to
	  $libs but not $LIBS.  [ruby-dev:21137]

	* ext/io/wait/extconf.rb: check DOSISH macro instead of platform.

	* ext/digest/sha1/extconf.rb: have_library already appends library
	  name.

Wed Aug  6 17:23:57 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c: initialize /* OK */ variables by Qnil to stop warnings.

Wed Aug  6 04:58:32 2003  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/Setup*: add io/wait and openssl.

Wed Aug  6 01:13:38 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* eval.c (rb_f_autoload): use ruby_cbase instead of ruby_class.

	* eval.c (rb_f_autoload_p): ditto.

	* class.c (rb_mod_init_copy): no longer implements independent
	  clone and dup methods.  override "initialize_copy" instead.
	  [ruby-core:01352]

	* object.c (rb_class_s_alloc): define Class allocation function.
	  this makes Classes to follow clone framework that uses
	  initialize_copy.

	* object.c (rb_class_initialize): separate instantiation and
	  initialization.

	* object.c (rb_obj_alloc): prohibit instantiation from
	  uninitialized class.

	* object.c (rb_class_superclass): check uninitialized class.

	* array.c (rb_ary_fill): wrong index processing with block.  this
	  fix was done by Koji Arai <JCA02266@nifty.ne.jp> [ruby-list:38029]

	* marshal.c (w_object): should preserve generic ivar for nil,
	  true, false, symbols, and fixnums.

	* marshal.c (w_uclass): base_klass check should be done after
	  rb_class_real().

Wed Aug  6 01:18:50 2003  Minero Aoki  <aamine@loveruby.net>

	* lib/net/http.rb: update document.

	* lib/net/pop.rb: ditto.

	* lib/net/protocol.rb: ditto.

Wed Aug  6 00:48:37 2003  Koji Arai  <jca02266@nifty.ne.jp>

	* marshal.c (w_object): should recommend marshal_dump rather than
	  _dump_data.

Tue Aug  5 17:58:57 2003  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/fileutils.rb (install): should preserve timestamp only.

Tue Aug  5 17:31:59 2003  Ian Macdonald  <ian@caliban.org>

	* lib/shell/command-processor.rb (Shell::CommandProcessor::rmdir):
	  simple typo.

Tue Aug  5 15:47:34 2003  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_load): should preserve current source file/line.

Tue Aug  5 10:04:42 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* string.c (str_new4): ptr may refer to null_str.

Mon Aug  4 17:25:18 2003  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* stable version 1.8.0 released.

For the changes before 1.8.0, see doc/ChangeLog-1.8.0

Local variables:
add-log-time-format: (lambda ()
  (let* ((time (current-time))
	 (system-time-locale "C")
	 (diff (+ (cadr time) 32400))
	 (lo (% diff 65536))
	 (hi (+ (car time) (/ diff 65536))))
  (format-time-string "%a %b %e %H:%M:%S %Y" (list hi lo) t)))
indent-tabs-mode: t
tab-width: 8
end:
