Fri Mar 23 21:21:17 2012  Sambasiva Rao Suda  <sambasivarao@gmail.org>

	* time.c (time_init_1): Time.new will accept seconds as string or int.
	  [ruby-core:43569] [Bug #6193]

Sun Mar 18 13:23:28 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): return ASCII-8BIT even if 2nd string
	  is ascii only string. [ruby-core:42354] [Bug #5968]

Tue Mar  6 18:55:37 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_send, assert_not_send):
	  parenthesize non-empty arguments.

Tue Mar  6 18:55:37 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_send): make arguments in
	  the default message clearer.

Tue Mar  6 12:48:08 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (set_rawmode): clear ECHOE and ECHOK
	  bits too.

	* ext/io/console/console.c (echo_p): ignore ECHOE and ECHOK bits.
	  [ruby-dev:45309] [Bug #6116]

	* ext/io/console/console.c (console_raw): fix rdoc.

	* ext/io/console/console.c (console_set_echo): mentioned about
	  platform dependency.

Tue Mar  6 12:40:08 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_raw, console_set_raw)
	  (console_getch): optional parameters.  [EXPERIMENTAL]

Tue Mar  6 12:39:27 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_cooked, console_set_cooked):
	  new methods to reset cooked mode.  [EXPERIMENTAL]

Tue Mar  6 12:31:47 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (io_getch): default delegating method
	  for StringIO.  https://github.com/nobu/io-console/issues/4

	* ext/stringio/stringio.c: moved some methods to hidden modules.

Tue Mar  6 12:29:34 2012  Eric Hodel  <drbrain@segment7.net>

	* io.c (Init_IO):  Mention io/console methods.  [Ruby 1.9 - Bug #5602]
	* ext/io/console/console.c:  Mention that io/console must be required
	  similar to lib/time.rb

Tue Mar  6 11:42:52 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/lib/syck/rubytypes.rb (Exception.yaml_new): fix bug
	  that causes YAML serialization problem for Exception.
	  Exception#initialize doesn't use visible instance variable for
	  the exception message, so call the method with the message.
	  patched by Jingwen Owen Ou <jingweno AT gmail.com>.
	  http://github.com/ruby/ruby/pull/41

Fri Mar  2 22:09:03 2012  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* .travis.yml: Backport TravisCI configuration from trunk.

Thu Mar  1 18:39:44 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_join): honor input encodings than ASCII-8BIT.
	  [ruby-core:40338] [Bug #5483]

Tue Feb 28 11:56:52 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (debugflags): check if -ggdb is accepted.
	  [ruby-core:42875][Bug #6080]

Mon Feb 27 17:25:40 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): since methods
	  can be overridden, so should not make an assumption on the type
	  of results.  [ruby-core:42969][Bug #6093]

Mon Feb 27 02:28:17 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (add_code_range_to_buf0): wrong condition of duplicated
	  warnings.

Sun Feb 26 12:26:26 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): call on special object instead of
	  self.  since stabby lambda is a syntax, so it should not be
	  affected by the context.  [ruby-core:42349][Bug #5966]

	* insns.def (send): no special deal for FCALL.  self should be put
	  on TOS instead.

Sat Feb 25 23:47:49 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (utime_internal): fix a variable missed to replace.
	  [ruby-core:42864] [Bug #6077]

Sat Feb 25 21:29:09 2012  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_literal.rb (TestRubyLiteral#test_special_const):
	  test for https://bugs.php.net/bug.php?id=61095

Sat Feb 25 21:29:09 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c, file.c, io.c (rb_sys_fail_path): use rb_sys_fail_str.

	* error.c: new functions to deal exceptions with string instances.

	* dir.c, file.c, io.c: use rb_sys_fail_path.

Sat Feb 25 21:18:12 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_inspect), io.c (rb_io_inspect): keep encoding of path.
	  [Bug #6072]

Sat Feb 25 21:18:12 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_initialize): keep path in original encoding.

	* error.c (syserr_initialize): prefer the encoding of message over
	  locale.  [ruby-dev:45279][Bug #6071]

Sat Feb 25 17:10:51 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/fileutils.rb: use chomp(?/) instead of sub to optimize and avoid
	  to regexping invalid string.

Sat Feb 25 16:39:13 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* complex.c (nucomp_marshal_load): raise error on invalid data.
	  reported by John Firebaugh [ruby-core:42860] [Bug #6076]

Fri Feb 24 23:49:05 2012  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/ostruct.rb (delete_field): Bug fix so previous value is
	  returned. Patch by Nick Recobra [Bug #6063]

Fri Feb 24 08:53:28 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_string, parser_yylex): insert a backslash
	  if the next character is non-ascii.  [ruby-dev:45278] [Bug #6069]

Thu Feb 23 14:44:36 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_regexp):
	  use \A \z instead of ^ $. [Bug #5843]

Thu Feb 23 08:08:23 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_uchmod): typo.  [Bug#5671] [ruby-dev:44898]

	* test/ruby/test_file.rb (TestFile#test_chmod_m17n): test of above bug.

Wed Feb 22 23:27:52 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/iconv/test_option.rb: enabled.  [ruby-core:42802][Bug #6061]

Wed Feb 22 22:04:15 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_s_foreach): argument check before making Enumerator.
	  [ruby-dev:31525]

Wed Feb 22 22:04:15 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_s_foreach): return enumerator including kerword
	  arguments.  [ruby-dev:45267][Bug #6054]

Wed Feb 22 21:42:16 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: remove workaround replacement from gcc to gcc-4.2.
	  [Backport #6043]

Wed Feb 22 08:11:06 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c : remove gc_clear_mark_on_sweep_slots() and use
	  rest_sweep() instead of it, because some dead objects might be
	  marked in next the mark phase by false pointers.
	  [ruby-core:42672]

Sun Feb 19 12:27:24 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: ignore all warnings from an arbitrary
	  header in /usr/local/include.

Fri Feb 17 12:51:25 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_header): log the content of header.

Fri Feb 17 12:26:15 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/readline/test_readline.rb (test_completion_proc_empty_result):
	  ensure clearance of Readline's line_buffer after the test.

Fri Feb 17 11:46:39 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/readline/test_readline.rb (test_line_buffer__point): use
	  lambda not to exit entire method by "return".  or "next" for
	  proc.  [ruby-dev:45042] [Bug #5802]

Fri Feb 17 10:15:54 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: check _DB_H_ macro unavailable except
	  Berkeley DB library.

Fri Feb 17 10:14:47 2012  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb: fix skip condition for libgdbm 1.8.0 or prior.
	  reported by Bohuslav Kabrda.
	  [ruby-core:42685] [ruby-trunk - Bug #6036]

Fri Feb 17 09:53:46 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/transcode-tblgen.rb (import_ucm): don't use \h because the
	  script should work with ruby 1.8.

	* tool/enc-unicode.rb: ditto.

Thu Feb 16 17:54:14 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dbm/extconf.rb: merge trunk's ext/dbm/extconf.rb and
	  related functions of lib/mkmf.rb. [Backport #6021]

Thu Feb 16 09:25:52 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in (enable_pthread): use -pthread on OpenBSD without
	  explicit option. patched by Jeremy Evans. [ruby-core:38572]

Thu Feb 16 07:34:34 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (rb_fiber_reset_root_local_storage): add a new function to
	  restore rb_thread_t::local_storage.

	* cont.c (rb_obj_is_fiber): add a new function to tell finalizer to
	  prevent fibers from destroy.

	* gc.c (rb_objspace_call_finalizer): don't sweep fibers at finalizing
	  objspace.

	* internal.h (rb_fiber_reset_root_local_storage, rb_obj_is_fiber):
	  add prototypes.

	* vm.c (ruby_vm_destruct): reset main thread's local_storage before
	  free main thread. rb_thread_t::local_storage is replaced by fiber's
	  local storage when forked from fiber, and it should be already freed
	  when the fiber was destroyed. [ruby-core:41456] [Bug #5700]

	* test/ruby/test_fiber.rb (test_fork_from_fiber): add test for fork
	  from fiber.

Thu Feb 16 06:30:37 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/fiddle/closure.c (callback): deal with unsinged integers.
	  [ruby-core:42458][Bug #5991][Bug #6022]

	* ext/fiddle/conversions.c (value_to_generic, generic_to_value):
	  ditto.

	* ext/fiddle/closure.c (callback): same as r34506.

Wed Feb 15 10:35:43 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (FIXNUM_P): simple flag should be int.

Wed Feb 15 10:33:41 2012  Eric Hodel  <drbrain@segment7.net>

	* vm_eval.c (check_funcall):  Call respond_to? with matching arity for
	  legacy single-argument implementations.  [ruby-trunk - Bug #6000]

Wed Feb 15 10:25:22 2012  Naohisa Goto  <ngotogenome@gmail.com>

	* vm_eval.c (check_funcall): set array elements one-by-one to fix
	  compile error with Fujitsu C Compiler 5.6 on Solaris 10 on Sparc.

Wed Feb 15 10:25:22 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_object.rb: tests that respond_to? returns false.

Wed Feb 15 10:25:22 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (check_funcall): try respond_to? first if redefined.
	  [Bug #5158]

Wed Feb 15 07:15:50 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (defined_expr): guard the whole expression.
	  [ruby-dev:45021][Bug#5786]

Wed Feb 15 05:08:25 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cptr.c (rb_dlptr_s_to_ptr): use rb_check_funcall.

	* ext/dl/cfunc.c (dlcfunc_mark), ext/dl/cptr.c (dlptr_mark):
	  workaround to mark wrapped object.  this is not a true fix,
	  because [Bug #4929] is caused by the interface design of DL.

Wed Feb 15 05:04:47 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cptr.c (rb_dlptr_aref, rb_dlptr_aset): check NULL pointer
	  dereference.

	* test/rinda/test_rinda.rb: decrease the code that depends on timing.
	  [Bug #372] [Bug #4160]

Wed Feb 15 05:03:41 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/rinda/test_rinda.rb (test_remote_array_and_hash):
	  add local variables to protect objects from GC. [ruby-dev:44253]
	  [Bug #5104]

Wed Feb 15 05:02:43 2012  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_err_in_callback.rb (test_err_in_callback): 
	  skip test if ADODB.connection is not available.

Wed Feb 15 04:49:23 2012  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (debug_lines, coverage): set file path encoding for coverage
	  result.  [ruby-dev:44950]

Tue Feb 14 16:57:11 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rake/file_list.rb (Rake::FileList#egrep): there is no need to
	  open files in binary mode.
	  see more details in https://github.com/jimweirich/rake/issues/74

Tue Feb 14 16:52:17 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/encoding.rb (RDoc::Encoding.read_file): fixup newline chars
	  on Windows.
	  see https://github.com/rdoc/rdoc/issues/87

	* test/rdoc/test_rdoc_markup_pre_process.rb
	  (TestRDocMarkupPreProcess#test_include_file, 
	  TestRDocMarkupPreProcess#test_include_file_encoding_incompatible):
	  follow above change.

Tue Feb 14 16:34:11 2012  Shota Fukumori  <sorah@tubusu.net>

	* test/rubygems/test_gem_commands_help_command.rb: Add one
	  `require` because if run test-all with test/unit parallel
	  running, sometimes this test fails by some constants not found.
	  The error reason is some worker doesn't require the file needed by
	  this test. This issue is related to [ruby-core:36168].

Tue Feb 14 15:58:31 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (initial_params): pack in a struct.

	* gc.c (rb_gc_set_params): set parameters always.
	  [ruby-dev:44648] [Bug #5467]

Tue Feb 14 15:44:42 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/irb/test_completion.rb: skip if cannot load irb/completion
	  (maybe readline does not exist).

Tue Feb 14 15:07:23 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (build_message): skip escaped
	  question marks.

Mon Feb 13 12:06:29 2012  Loren Segal  <lsegal@soen.ca>

	* io.c (Init_IO): use directive hack to make ARGF documentable
	  in other tools.  [ruby-core:42515][Bug #6007]

Sun Feb 12 16:57:56 2012  Akinori MUSHA  <knu@iDaemons.org>

	* misc/rdoc-mode.el (rdoc-imenu-create-index): Add imenu support
	  to rdoc-mode.

	* misc/rdoc-mode.el (rdoc-mode): Fix regexp patterns containing
	  "\s " where CR/LF is not supposed to match.

Sun Feb 12 16:56:23 2012  Akinori MUSHA  <knu@iDaemons.org>

	* misc/rdoc-mode.el (rdoc-mode): Add provide so that requiring
	  this library succeeds.

Sun Feb 12 16:53:18 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/tempfile.rb (Tempfile#unlink, Tempfile::Remover#call): Just
	  call File.unlink and ignore ENOENT because existence check
	  before unlinking does not help in terms of race condition.

	* lib/tempfile.rb (Tempfile#unlink, Tempfile::Remover#call): My
	  comment about thread safeness is obsolete.

Sun Feb 12 16:50:28 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/shellwords.rb: Fix rdoc markups.

Sun Feb 12 16:50:28 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/shellwords.rb (Shellwords#shellsplit): Fix a bug where
	  consecutive backslashes in double quotes are all removed except
	  the one at the tail.

Sun Feb 12 16:38:13 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/shellwords.rb (Shellwords#shellescape): Drop the //n flag
	  that only causes warnings with no real effect.  [Bug #5637]

Sun Feb 12 16:34:55 2012  Akinori MUSHA  <knu@iDaemons.org>

	* tool/merger.rb (#default_merge_branch): Add support for
	  Subversion 1.7 which adopted a whole new working directory
	  structure.

Sun Feb 12 09:38:46 2012  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (rb_add_method): should not call method_added hook
	  for undef operation. [Bug #5015]

Sun Feb 12 09:29:28 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regint.h (PLATFORM_UNALIGNED_WORD_ACCESS): Power PC does not
	  allow unaligned word access.

	* st.c (UNALIGNED_WORD_ACCESS): x86_64 allows unaligned word
	  access as well as i386.

Sat Feb 11 08:06:12 2012  Tanaka Akira  <akr@fsij.org>

	* test/openssl/test_ssl.rb (test_multibyte_read_write): start server
	  for each length to avoid race condition.

Sat Feb 11 06:13:07 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (fnmatch): The * needs to be escaped to avoid formatting in
	  fnmatch comment.
	  patched by @dalton. https://github.com/ruby/ruby/pull/91

Sat Feb 11 03:38:48 2012  Hiroshi Shirosaki <h.shirosaki@gmail.com>

	* io.c (rb_sys_fail_path): move the definition.
	  Move above for using it in set_binary_mode_with_seek_cur().

	* io.c (set_binary_mode_with_seek_cur): fix improper seek cursor.
	  Seeking file cursor with setting binary mode has possibility to
	  cause infinite loop. Fixed the bug and refined error handling.
	  Introduced at r34043.

	  And cleanups as below.
	  Remove unnecessary parentheses of `fptr`.
	  Use return value of setmode().

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_seek_with_setting_binmode): add a test for abobe.
	  [ruby-core:41671] [Bug #5714]

Sat Feb 11 03:38:48 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_{read_with_binmode_and_get[cs]}): only for Windows.

Sat Feb 11 03:38:48 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (rb_w32_fd_is_text): new function.

	* win32/win32.c (init_stdhandle): set default mode of stdin as binmode.

	* io.c (set_binary_mode_with_seek_cur): new function to replace
	  SET_BINARY_MODE_WITH_SEEK_CUR macro.  now returns previous mode of the
	  fd and take care of LF in rbuf.

	* io.c (do_writeconv): set text mode when needed.

	* io.c (io_read): need to change the mode of the IO to binmode
	  temporally when the length for IO#read, because IO#read with length
	  must behave so.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#test_{read_with_length,
	  read_with_length_binmode,get[cs]_and_read_with_binmode,
	  read_with_binmode_and_get[cs],read_write_with_binmode}): tests for
	  above changes.

	all patches are written by Hiroshi Shirosaki. [ruby-core:41496]
	[Feature #5714]

Sat Feb 11 03:37:56 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rexml/test_order.rb (OrderTester#test_more_ordering): use
	  GZip::GzReader.open instead of GZip::GzReader.new with File.new.
	  fixed a test error on Windows introduced at r33946.

Sat Feb 11 03:37:34 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (rb_gzreader_initialize): revert a part of r33937.
	  1st, to change the mode of an IO is very sensitive problem, so
	  fixed test errors on Windows introduced at r33953.
	  the maintainer of this library should judge it.
	  2nd, usually Zlib::GzReader.new is not called directly.  #initialize
	  is called via .open, and in the method the I/O is opened in binary
	  mode, so there is no problem without changing the mode in #initialize.

	  fixed test errors on Windows introduced at r33947.
Sat Feb 11 03:23:58 2012  Luis Lavena  <luislavena@gmail.com>

	* ext/zlib/zlib.c (rb_gzreader_initialize): use binary mode by default
	  under Windows. Patch by Hiroshi Shirosaki. [ruby-core:40706]
	  [Feature #5562]

	* include/ruby/encoding.h (void rb_econv_binmode): define NEWLINE
	  decorator.

	* io.c (rb_cloexec_fcntl_dupfd): Introduce NEED_READCONV and
	  NEED_WRITECONV to replace universal newline decorator by CRLF only
	  when required to improve file reading and writing under Windows.
	  Patch by Hiroshi Shirosaki. [ruby-core:40706] [Feature #5562]
	* io.c (do_writeconv): adjust binary mode if required.
	* io.c (read_all, appendline, swallow, rb_io_getline_1): ditto.
	* io.c (io_getc, rb_io_each_codepoint, rb_io_ungetc): ditto.
	* io.c (rb_io_binmode, rb_io_ascii8bit_binmode): ditto.
	* io.c (rb_io_extract_modeenc, rb_sysopen): ditto.
	* io.c (pipe_open, prep_stdio, io_encoding_set): ditto.
	* io.c (rb_io_s_pipe, copy_stream_body): ditto.

	* test/ruby/test_io_m17n.rb (EOT): add test for pipe and stdin in
	  binary mode.

	* win32/win32.c (init_stdhandle): remove O_BINARY from stdhandle
	  initialization.
	* win32/win32.c (rb_w32_write): use FTEXT mode accordingly.

Sat Feb 11 03:20:22 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (argf_next_argv): wrong timing of setting ecflags.
	  fixed the failure of TestArgf#test_textmode introduced at r33662.

Sat Feb 11 03:19:45 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_default_stdout_stderr_mode): new test for
	  r33627-33629.  see [backport #5565]
Sat Feb 11 03:20:22 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/encoding.h (ECONV_NEWLINE_DECORATOR_READ_MASK,
	  ECONV_NEWLINE_DECORATOR_WRITE_MASK): new macro.

	* io.c (rb_io_extract_modeenc, pipe_open, prep_stdio, argf_next_argv):
	  set TEXTMODE_NEWLINE_DECORATOR_ON_WRITE for textmode on creating IO
	  if the flag is available.

	* io.c (make_writeconv): drop decorators for reading.

	* io.c (make_readconv): drop decorators for writing.

	* io.c (do_writeconv): existing writeconv is not the condition to raise
	  ArgumentError.  should check textmode or not.

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_{cr,lf,crlf}_decorator_on_stdout): test above
	  changes.


Sat Feb 11 03:19:45 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb (TestIO_M17N#test_{default_mode_on_dosish,
	  default_mode_on_unix,text_mode,binary_mode}): sorry for wrong test
	  committed in r33144.  I'd misunderstood the spec of ruby's universal
	  newline.

Sat Feb 11 03:17:41 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb (TestIO_M17N#test_{default_mode_on_dosish,
	  default_mode_on_unix,text_mode,binary_mode}): tests for [Bug #5164].

Sat Feb 11 03:13:27 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c: enabled econv newline option.

Sat Feb 11 02:39:09 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* variable.c (set_const_visibility): clear inine-cache when constant's
	  visibility is modified. [ruby-dev:44929]

	* test/ruby/test_module.rb (test_private_constants_clear_inlinecache):
	  add test for it.

Sat Feb 11 02:39:09 2012  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): print a warning when no argument
	  is passwd to Module#private_constant.  [ruby-list:48558]

	* vm_method.c (set_method_visibility): ditto for
	  Module#private_class_method.

Sat Feb 11 02:39:09 2012  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): Module#private_constant has
	  changed the visibility of only the first argument.  Now it changes
	  all of them.  [ruby-list:48558]

	* test/ruby/test_module.rb: add a test for above.

Sat Feb 11 02:39:09 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* variable.c (set_const_visibility): clear inine-cache when constant's
	  visibility is modified. [ruby-dev:44929]

	* test/ruby/test_module.rb (test_private_constants_clear_inlinecache):
	  add test for it.

Sat Feb 11 02:39:09 2012  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): print a warning when no argument
	  is passwd to Module#private_constant.  [ruby-list:48558]

	* vm_method.c (set_method_visibility): ditto for
	  Module#private_class_method.

Sat Feb 11 02:39:09 2012  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): Module#private_constant has
	  changed the visibility of only the first argument.  Now it changes
	  all of them.  [ruby-list:48558]

	* test/ruby/test_module.rb: add a test for above.

Sat Feb 11 02:26:51 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* lib/openssl/buffering.rb: Force multi-byte strings to be treated as
	  binary data.
	* test/openssl/test_ssl.rb: Add test for it.

	Thanks to Niklas Baumstark for reporting the issue!

	[Ruby 1.9 - Bug #5233] [ruby-core:39120]

Fri Feb 10 17:25:28 2012  Tanaka Akira  <akr@fsij.org>

	* lib/set.rb (SortedSet.setup): remove old_init after initialize
	  method is redefined.  The remove before redefinition makes the
	  warning prevention fragile.  [ruby-dev:44892]

Fri Feb 10 17:02:12 2012  okkez  <okkez000@gmail.com>

	* thread_pthread.c (rb_thread_create_timer_thread): fix memory
	  leak. [ruby-dev:44904] [Bug #5688]

Fri Feb 10 05:22:32 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (fiber_setcontext): Use longjmp() instead of swapcontext() on
	  FreeBSD 9. [ruby-dev:41316] [Bug #3295] [Bug #5526]

Fri Feb 10 05:13:12 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* object.c: Added examples for Object#is_a? and
	  Object#instance_of? patcheed from Manoj Kumar.
	  [Bug #5880] [ruby-core:42057]

Fri Feb 10 05:11:43 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (argf_next_argv): reset ARGF.next_p on ARGV.replace.
	  r34409 breaks replacing ARGV.
	  [ruby-dev:45160] [Bug #5952]

Fri Feb 10 05:11:43 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_close): skip stdin, which should be readable again.
	  [ruby-dev:45160] [Bug #5952]

	* io.c (argf_readlines): reinitialize after all read to be
	  readable again.

Fri Feb  9 01:36:19 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r34482 from trunk

	* ext/openssl/ossl_ssl.c: Add SSL constants and allow to unset SSL
	  option to prevent BEAST attack. See [Bug #5353].

	  In OpenSSL, OP_DONT_INSERT_EMPTY_FRAGMENTS is used to prevent
	  TLS-CBC-IV vulunerability described at
	  http://www.openssl.org/~bodo/tls-cbc.txt
	  It's known issue of TLSv1/SSLv3 but it attracts lots of attention
	  these days as BEAST attack. (CVE-2011-3389)

	  Until now ossl sets OP_ALL at SSLContext allocation and call
	  SSL_CTX_set_options at connection.  SSL_CTX_set_options updates the
	  value by using |= so bits set by OP_ALL cannot be unset afterwards.
	  This commit changes to call SSL_CTX_set_options only 1 time for each
	  SSLContext. It sets the specified value if SSLContext#options= are
	  called and sets OP_ALL if not.

	  To help users to unset bits in OP_ALL, this commit also adds several
	  constant to SSL such as
	  OpenSSL::SSL::OP_DONT_INSERT_EMPTY_FRAGMENTS.  These constants were
	  not exposed in Ruby because there's no way to unset bits in OP_ALL
	  before.

	  Following is an example to enable 0/n split for BEAST prevention.

	    ctx.options = OP_ALL & ~OP_DONT_INSERT_EMPTY_FRAGMENTS

	* test/openssl/test_ssl.rb: Test above option exists.

Thu Feb  9 17:08:20 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (cont_mark): mark original Thread object from saved_thread.
	  [ruby-dev:44567] [Bug #5386]

Thu Feb  9 17:05:07 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (HAVE_GETCONTEXT): see getcontext(3) because DragonFly BSD
	  x64 port doesn't have it.

Thu Feb  9 16:19:04 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/memory_status.rb (Memory::Win32): 64bit support.

Thu Feb  9 16:19:04 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/lib/value.rb (DL::ValueUtil.{unsigned_value,signed_value}):
	  currenly pack/unpack does not accept "q!" and "Q!".

Thu Feb  9 16:19:04 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/fiddle/conversions.c (value_to_generic): src is not guranteed as
	  a Bignum if the type is LONG_LONG.  it may be a Fixnum if the value
	  is small.

Thu Feb  9 16:19:04 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/lib/types.rb: Win64 support.

Thu Feb  9 11:11:15 2012  Hiroshi Shirosaki <h.shirosaki@gmail.com>

	* ext/dbm/dbm.c (Init_dbm): fix a build error on mswin32.
	  use `extern __declspec(dllimport)` for dll link with VC.
	  [ruby-core:41996] [Bug #5869]

Thu Feb  9 11:11:15 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c: use db_version() instead of DB_VERSION_STRING to
	  detect runtime Berkeley DB version.
	  use dpversion instead of _QDBM_VERSION to detect runtime QDBM
	  version.
	  [ruby-dev:44948]

Thu Feb  9 11:11:15 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: detect gdbm_version in libgdbm.

	* ext/dbm/dbm.c: make DBM::VERSION more informative for gdbm, qdbm and
	  Berkeley DB 1.x.  [ruby-dev:44944]

Thu Feb  9 07:32:40 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_enc_uint_char): raise RangeError when added codepoint
	  is invalid. [Feature #5855] [Bug #5863] [Bug #5864]

	* string.c (rb_str_concat): ditto.

	* string.c (rb_str_concat): set encoding as ASCII-8BIT when the string
	  is US-ASCII and the argument is an integer greater than 127.

	* regenc.c (onigenc_mb2_code_to_mbclen): rearrange error code.

	* enc/euc_jp.c (code_to_mbclen): ditto.

	* enc/shift_jis.c (code_to_mbclen): ditto.

Thu Feb  9 07:28:43 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/pathname/test_pathname.rb: not read but binread.
	  patched by Benoit Daloze, [ruby-core:42440] [Bug #5984]

Wed Feb  8 22:29:59 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_modify_expand): fix memory leak.

Wed Feb  8 10:58:45 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  respect encodings.  [Bug #5941]

Wed Feb  8 10:56:00 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  fix compile error.

Wed Feb  8 10:56:00 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  empty completion result does not mean memory error.

Wed Feb  8 10:54:49 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_readline): check if outstream
	  is closed to get rid of a bug of readline 6.  [ruby-dev:45043]
	  [Bug #5803]

Wed Feb  8 10:52:51 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (Init_readline): like r18313, libedit's
	  replace_history_entry may use offset instead of which.
	  so introduce history_replace_offset_func and initialize it.

	* ext/readline/readline.c (hist_set): use history_replace_offset_func.

Wed Feb  8 10:52:36 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (Init_readline): fix wrong condition.

Wed Feb  8 10:50:11 2012  Naohisa Goto  <ngotogenome@gmail.com>

	* test/ruby/test_rubyoptions.rb (test_script_from_stdin): slave pty
	  should be manipulated because master pty may not be a tty on some
	  environment (e.g. Solaris). [Bug:#5222] [ruby-dev:44420]

Wed Feb  8 10:38:36 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (CFLAGS): append ARCH_FLAG.

	* configure.in (ARCH_FLAG): exclude from CFLAGS.

Wed Feb 08 09:19:00 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_cipher.c: Add warning about key as IV.

Wed Feb  8 10:37:31 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_cipher.c: Update and complete documentation.

Wed Feb 08 09:57:33 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Call INT2NUM only once for GeneralString.
	  Thanks to Mantas Mikulenas for noticing and providing a patch!
	  [ruby-core:42358] [Bug #5972]

Wed Feb  8 10:34:59 2012  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  in Readline module with GNU Readline 6 case, Readline module
	  resets completion_append_character to " ", after it executes
	  completion. So, Readline module stores
	  completion_append_character, and Readline module always sets it
	  after Readline module executes completion. [ruby-dev:43456]
	  [Feature #4635]

Wed Feb  8 09:47:52 2012  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_sleep.rb (test_sleep_5sec): 0.1sec tolerance is too
	  small for busy environment.

Wed Feb  8 09:45:23 2012  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb: split tests for read only database.

	* test/gdbm/test_gdbm.rb: ditto.

Wed Feb  8 09:43:48 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* error.c (name_err_mesg_to_str): clear rb_thread_t::errinfo when
	  ignore exception under rb_protect(). [ruby-core:41612] [Bug #5755]

	* test/ruby/test_exception.rb (test_exception_in_name_error_to_str):
	  add a corresponding test.

Wed Feb  8 09:36:42 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (require_enc): reject only loading from untrusted
	  load paths.  [ruby-dev:44541] [Bug #5279]

	* transcode.c (load_transcoder_entry): ditto.

Wed Feb  8 09:36:42 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (load_encoding): predefined encoding names are safe.
	  [ruby-dev:44469] [Bug #5279]

	* transcode.c (load_transcoder_entry): ditto.

Tue Feb  7 14:29:16 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_foreach): should not yield same pair when checking
	  after unpacking.

Tue Feb  7 14:03:45 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/tempfile.rb (Tempfile#_close): clear @tempfile and @data[1] even
	  when exception is raised at @tempfile.close. [ruby-dev:45113]

	* lib/tempfile.rb (Tempfile#unlink): fix a typo.

Tue Feb  7 14:02:32 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_io.rb (test_autoclose_true_closed_by_finalizer,
	  test_autoclose_true_closed_by_finalizer): skip if IO objects are
	  not recycled yet. [ruby-dev:45098] [Bug #5850]

Tue Feb  7 13:59:26 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (run_finalizer): clear rb_thread_t::errinfo when ignore
	  an exception under rb_protect(). [ruby-dev:45113]

Mon Feb  6 15:34:47 2012  Tanaka Akira  <akr@fsij.org>

	* ruby.c (fill_standard_fds): use fstat() instead of fcntl(F_GETFD)
	  for MinGW.  reported by Luis Lavena.  [ruby-core:40526] [Bug #5516]

Mon Feb  6 15:34:47 2012  Tanaka Akira  <akr@fsij.org>

	* ruby.c (fill_standard_fds): new function to open closed standard
	  file descriptors.
	  (ruby_sysinit): call fill_standard_fds.

Mon Feb  6 15:19:17 2012  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_fsync,rb_io_fdatasync): release GVL during fsync().
	  fsync() and fdatasync() may take a long time on slow disks and/or
	  if there is much dirty data.
	  Patch by Eric Wong. [Feature #5665] [ruby-core:41247]

Mon Feb  6 15:01:55 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (vm_call0): should pass block to enumerators.  patched
	  by Kazuki Tsujimoto.  [ruby-dev:44961][Bug #5731]

	* vm_eval.c (method_missing), vm_insnhelper.c (vm_call_method):
	  ditto.  patched by satoshi shiba.

Mon Feb  6 21:52:20 2012  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (INSTRUBY_ARGS): added --mantype to apply mdoc2man.rb
	  to man pages.  Fixes #5598.
	  (do-install-nodoc, do-install-local, do-install-man,
	  dont-install-nodoc, dont-install-local, dont-install-man):
	  No longer needs --mantype.

	  Reported by Rainer Orth <ro AT cebitec.uni-bielefeld.de>,
	  patch by George Koehler <xkernigh AT netscape.net>.

Mon Feb  6 21:21:46 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/unit/assertions.rb (MINI_DIR): quick dirty hack to get rid of
	  warnings when using assert/assert_respond_to.

Mon Feb  6 20:38:19 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_expand_path): reset coderange after expanding path.

Mon Feb  6 20:32:17 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strptime.c: moved detector of leftover.

Mon Feb  6 20:32:17 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: [ruby-core:42173].

Mon Feb  6 20:31:35 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: uses to_integer instead.
	* test/date/test_switch_hitter.rb: added a test.

Mon Feb  6 20:31:35 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (wholenum): fix the type of the return value.

Mon Feb  6 20:31:35 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c:  [ruby-dev:45008].

Mon Feb  6 16:38:56 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (unixtime_to_filetime): should check the return value
	  of localtime().  reported by snowjail at gmail.com.
	  [ruby-dev:44838] [Bug #5596]

Mon Feb  6 16:36:25 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_update_max_fd): fstat(2) can fail with other than
	  EBADF.  [ruby-dev:44837] [Bug #5593].  Cf.
	  http://pubs.opengroup.org/onlinepubs/9699919799/functions/fstat.html

Mon Feb  6 16:31:16 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_fwrite): call rb_w32_write_console() only if FMODE_TTY is
	  set.  this is the one of the reason of IO writing slowness of Windows
	  in 1.9.3 or later.

Mon Feb  6 16:21:57 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_expand_path): reset coderange after expanding path.

Mon Feb  6 00:06:39 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/parser/parser.rl (json_string_unescape): workaround fix
	  for over optimization of GCC 4.7. [ruby-core:42085] [Bug #5888]
	  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=51862

Fri Feb  3 16:16:10 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (EnvUtil.invoke_ruby): yield also child pid
	  in block form.

Fri Feb  3 16:16:10 2012  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/ruby/test_thread.rb
	  (TestThreadGroup#test_thread_timer_and_interrupt): skip exit status
	  assertion because we cannot get signal status on Windows.

	* win32/win32.c (CreateChild): create process group to receive the
	  signal by GenerateConsoleCtrlEvent().

	* win32/win32.c (kill): use CTRL_BREAK_EVENT instead of CTRL_C_EVENT
	  if a process group is specified. CTRL_C_EVENT signal cannot be
	  generated for process groups for the specification.
	  [ruby-dev:45149] [Bug #5812]

Fri Feb  3 16:16:10 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/envutil.rb (invoke_ruby): remove :timeout option before
	  pass it to Kernel#spawn.

Fri Feb  3 10:10:02 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread_pthread.c (ping_signal_thread_list): remove return value.
	* thread_pthread.c (check_signal_thread_list): add a new function to
	  check if signal thread list is empty.
	* thread_pthread.c (thread_timer): check signal thread list after
	  timer_thread_function(). main thread might be added into signal thread
	  list during timer_thread_function().

Fri Feb  3 10:10:02 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (ubf_select): call rb_thread_wakeup_timer_thread()
	  only when it is not timer_thread. [Bug #5757] [ruby-dev:44985]
	  patched by Tomoyuki Chikanaga.

Wed Feb  1 09:50:10 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* doc/re.rdoc (Repetition): fix typo.  reported by Ori Avtalion
	  and patched by Zachary Scott.  [Bug #5947]

Tue Jan 24 11:38:05 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form_component): initialize on
	  requiring to support JRuby, which runs parallel multithreads.
	  [ruby-core:42222] [Bug #5925]

	* lib/uri/common.rb (URI.decode_www_form_component): initialize on

Sat Jan 28 05:53:34 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/completion.rb (IRB::InputCompletor::CompletionProc):
	  ignore non-string name modules.  [ruby-core:42244][Bug #5938]

Mon Jan 23 18:18:58 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): fix segv on symbols.
	  [ruby-core:42204] [Bug #5921]

Tue Jan 17 17:18:41 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SPT_TYPE): enable as SPT_REUSEARGV on Darwin.

	* missing/setproctitle.c (ruby_init_setproctitle): changed prefix.

Mon Jan 16 16:41:53 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (Regexp): fix incorrect options when casting to
	  a Regexp, and suppress encoding option warnings.
	  https://github.com/ruby/ruby/pull/82

Fri Jan 13 15:22:43 2012  Tanaka Akira  <akr@fsij.org>

	* time.c (TIME_COPY_GMT): copy vtm.utc_offset and vtm.zone too.
	  patch by Tomoyuki Chikanaga.
	  [ruby-dev:44827] [Bug #5586]

Thu Jan 12 13:52:13 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (cont_restore_0): prevent optimizing out `sp'. sp is used for
	  reserving a memory space with ALLOCA_N for restoring machine stack
	  stored in cont->machine_stack, but clang optimized out it (and
	  maybe #5851 is also caused by this).
	  This affected TestContinuation#test_check_localvars.

	* cont.c (cont_restore_1): revert workaround introduced in r32201.

Thu Jan 12 01:40:33 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#test_autoclose): Tempfile.new doesn't
	  accept the block argument.

Sat Jan  7 22:46:36 2012  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/parsers/baseparser.rb: use private instead of _xxx
	  method name. This is Ruby code not Python code.
	  refs #5696

Tue Jan 03 23:57:37 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/rexml/parsers/baseparser.rb: rexml BaseParser uses
	  instance_eval unnecessarily on listener add.
	  patch from Charles Nutter. [Bug #5696] [ruby-core:41437]

Tue Jan 03 19:13:05 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/rexml/test_sax.rb: add require 'rexml/document'.
	  [Backport #5834] [ruby-dev:45079]

Tue Jan  3 19:05:42 2012  Naohisa Goto  <ngotogenome@gmail.com>

	* include/ruby/defines.h (FLUSH_REGISTER_WINDOWS): move sparc asm code
	  to a separete file sparc.c for preventing inlining optimization.
	  Patched by Jurij Smakov. [Bug #5244] [ruby-core:40685]
	* sparc.c (rb_sparc_flush_register_windows): ditto.
	* configure.in: ditto.

Mon Jan  2 23:52:20 2012  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (Init_readline): libedit check
	  rl_getc_function only when rl_initialize() is called, and
	  using_history() call rl_initialize(). This assignment should be
	  placed before using_history(). [ruby-core:40641] [Bug #5539]

Mon Jan  2 23:47:58 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (install_recursive, bin-comm): split mere
	  string not path name.  [ruby-core:40462] [Bug #5492]

Mon Jan  2 23:41:57 2012  Tajima Akil <artonx@yahoo.co.jp>

	* win32/Makefile.sub (CONFIG_H): have stdint.h if VC2010.
	  [Bug #5243]

Mon Jan  2 21:40:45 2012  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* tool/merger.rb (#version_up): version.h date should be Japanese
	  locale date.

Mon Jan  2 21:36:56 2012  Luis Lavena  <luislavena@gmail.com>

	* configure.in: check -fno-omit-frame-pointer acceptance and usage
	  under MinGW. [ruby-core:39957] [Bug #5407]

Mon Jan  2 20:05:10 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/ruby.h (SIZE_MAX): define SIZE_MAX if not defined.
	  patched by The Written Word Inc. [ruby-core:40422] [Bug #5489]

Mon Jan  2 20:00:01 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (pty_check): should return nil until the child
	  terminates or stops.  [ruby-dev:44600] [Bug #2642]

Mon Jan  2 19:27:18 2012  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (update_coverage): skip coverage count up if the current
	  line is out of the way.  rb_sourceline() is unreliable when source
	  code is big.  [ruby-dev:44413]

	* test/coverage/test_coverage.rb: add a test for above.

Mon Jan  2 19:08:54 2012  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_yield): don't prevent concurrent sched_yield().
	  [Bug #5130] [ruby-core:38647]

Mon Jan  2 18:54:52 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/configure.bat: disable delayed expansion of enironment variable.
	  [Bug #5517] [ruby-core:40531]

Wed Dec 28 11:22:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::Entry_#entries): use utility method
	  instead of typoed regexp.  [ruby-core:41829] [Bug #5817]

Thu Dec 15 10:44:54 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_reject_bang, rb_ary_delete_if): update rdoc.
	  documentation from Thomas Leitner <t_leitner AT gmx.at> in
	  [ruby-core:41616].  [Bug #5752]

Wed Dec 14 15:28:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (str_encode): about the extension of :fallback
	  option since 1.9.3.

Tue Oct  4 06:43:47 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: update psych version.
	* ext/psych/psych.gemspec: generate new gemspec for new version.

Tue Oct  4 06:29:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: calling `yaml` rather than `to_yaml`.
	* ext/psych/lib/psych/nodes/node.rb: Rename `to_yaml` to just `yaml`
	  in order to avoid YAML::ENGINE switching from replacing this method.
	* test/psych/helper.rb: fix tests for method name change.
	* test/psych/test_document.rb: ditto
	* test/psych/visitors/test_emitter.rb: ditto

Tue Oct  4 06:20:19 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: Match values against the
	  floating point spec defined in YAML to avoid erronious parses.
	* test/psych/test_numeric.rb: corresponding test.

Tue Oct  4 05:59:24 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: ToRuby visitor can be
	  constructed with a ScalarScanner.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: ScalarScanner can be
	  passed to the YAMLTree visitor.

Tue Oct  4 05:47:23 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Define Regexp::NOENCODING
	  for 1.9.2 backwards compatibility.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Fix Date string
	  generation for 1.9.2 backwards compatibility.

Fri Sep  2 04:05:25 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: emit strings tagged as
	  ascii-8bit as binary in YAML.
	* test/psych/test_string.rb: corresponding test.

Wed Dec  7 19:04:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rpath): fix typo in the help string.  a patch from
	  Yuji Yamano <yyamano AT kt.rim.or.jp> in [ruby-list:48568].

Wed Nov 30 18:22:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c (nucomp_rationalize): fix function.  [ruby-core:40667]
	  [Bug #5546]

Thu Nov 17 10:36:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb (load_file): make sure opened yaml files are
	  also closed. [ruby-core:41088]

Wed Nov 30 02:58:46 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (dbl2ival): Fix Float#divmod and #round for 32 bit
	  platform. part 1 of [bug #5276]

Wed Nov 30 02:58:46 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (flo_round): Fix criteria for 32 bits platform
	  part 2 of [bug #5276]

Wed Nov 30 02:37:32 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (flo_round): Make Float#round round big values [bug
	  #5272]

Wed Nov 30 02:37:32 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): substitute machine dependent magic number.

Wed Nov 30 02:28:22 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (int_round): Integer#round always returns an Integer [Bug
	  #5271]

Fri Nov  4 01:56:30 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (make_writeconv): unversal_newline converter is for reading.
	  so, if the io is text mode and has ECONV_UNIVERSAL_NEWLINE_DECORATOR
	  flag, use crlf_newline converter for writing.
	  this change fixes the problem about the luck of CR up Kernel.p and
	  Kernel.puts to stdout/stderr on Windows.

Mon Nov  7 23:39:23 2011  Tajima Akio <artonx@yahoo.co.jp>

	* io.c (io_fflush): remove fsync().
	* io.c (rb_io_flush, rb_io_rewind): fsync() here.
	  These pathces are backports of trunk r33651 for [Bug #5585]

Mon Oct 10 22:33:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/-ext-/old_thread_select/test_old_thread_select.rb:
	  select() with timeout may return early in old Linux kernels
	  with 250 Hz tickrate and no dynticks, so skip everything older
	  than 2.6.32 (which has long term support).
	  And, Make the timing assertions consistently use assert_operator with
	  timing difference in error message
	  Patch by Eric Wong. [Bug #5335] [ruby-core:39618]

Tue Oct  4 16:17:50 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/time.rb (Time.strptime): use Time.at if d[:seconds] is set.
	  Reported by Christopher Eberz. [ruby-core:39903] Bug #5399

Tue Oct  4 11:44:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (rb_gc_set_params): ruby_verbose can be Qnil, so use RTEST.

Mon Oct  3 23:56:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (rb_gc_set_params): output GC parameter change messages only
	  if -w/-v options are specified. these messages are output to stderr,
	  not to stdout. [ruby-core:39795] [Bug #5380]

	* test/ruby/test_gc.rb (test_gc_parameter): add test for it.

Wed Sep 28 09:14:16 2011  Nobuyoshi Nakada  <>

	* configure.in (pthread_np.h): needs pthread.h to be included
	  previously on OpenBSD.  a patch by George Koehler <xkernigh AT
	  netscape.net> at [ruby-core:39752].  [Bug #5376]

Tue Sep 13 15:02:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pstore.rb (PStore): always open in binary mode even if
	  default encodings are set.  [Bug #5311] [ruby-core:39503]

Sat Oct  8 07:31:42 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_join_1): should not copy the encoding of non-string
	  element after string element.  [ruby-core:39776] [Bug #5379]

Sat Oct  8 06:51:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Update to RubyGems 1.8.11.  Move Deprecate into the
	  Gem namespace.

Sat Oct  8 06:37:08 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (rb_gc_set_params): output GC parameter change messages only
	  if -w/-v options are specified. these messages are output to stderr,
	  not to stdout. [ruby-core:39795] [Bug #5380]

	* test/ruby/test_gc.rb (test_gc_parameter): add test for it.

Sat Oct  8 06:26:24 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (add_heap_slots, init_heap): reset heaps_inc zero when
	  heap slots are expanded by environment variable RUBY_HEAP_MIN_SLOTS.
	  [ruby-core:39777] [Bug #5380]

	* test/ruby/test_gc.rb (test_gc_parameter): add test for it.

	* test/ruby/envutil.rb (assert_normal_exit): add :child_env option to
	  enable pass environemnt variables to child process.

Sat Oct  8 05:45:28 2011  Eric Hodel  <drbrain@segment7.net>

	* proc.c (proc_call):  Update documentation to match argument handling
	  of proc/Proc.new/lambda/->()

Sat Oct  8 05:38:29 2011  Eric Hodel  <drbrain@segment7.net>

	* proc.c (proc_call):  Fix documentation of Proc#call vs Proc#===.
	  [Ruby 1.9 - Bug #5349]

Tue Sep 27 13:05:39 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: fix int_ossl_asn1_decode0_cons when being
	  fed arbitrary string values.
	  Clearly distinguish between the cases "universal, infinite and
	  not a SEQUENCE or SET" and "universal SEQUENCE or SET, possibly
	  infinite". Raise error for universal tags that are not infinite.
	* test/openssl/test_asn1.rb: add a test for this.

	  Thanks to Hiroshi Yoshida for reporting this bug.
	  [Bug #5363] [ruby-dev:44542]

Sat Sep 17 23:34:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_data_type): inherit the core type in ripper so
	  that checks in core would work.  [ruby-core:39591] [Bug #5331]

Fri Sep 23 14:15:01 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c
	  ext/openssl/ossl_pkey.c: Remove unused variables.

Fri Sep 23 06:54:44 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r33315 from trunk.

	* test/openssl/test_ssl_session.rb: execute test_session_exts_read
	  only for OpenSSL versions >= 0.9.8k. Thanks, Eric Wong, for
	  reporting this.
	  [Bug #4961] [ruby-core:37726]

Fri Sep 23 12:18:52 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r33311 from trunk.

	* test/openssl/test_ssl_session.rb: ensure server calls callbacks in
	  test_ctx_server_session_cb. Thanks to Eric Wong for the patch.
	  [Bug #5336] [ruby-core:39619]

Thu Sep 22 19:45:22 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread_pthread.c (ubf_select): activate timer thread when interrupt
	  blocking thread.
	  A patch created by Koichi Sasada. [ruby-core:39634] [Bug #5343]
	  to cover race condition, timer thread periodically send SIGVTARLM to
	  threads in signal thread list. so you should activate timer thread
	  when interrupt a thread.

Wed Sep 21 16:57:03 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/io/wait/test_io_wait.rb (TestIOWait#setup): of course, the
	  behavior of mingw is just same with mswin.

Sat Sep 17 22:21:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_vm_make_env_object, rb_vm_get_sourceline): export as a
	  workaround for ruby-debug19 for the time being.
	  [ruby-core:38972] [Bug #5193]

Fri Sep 16 01:08:19 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* NEWS: cosmetic changes.

Wed Sep 14 12:39:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: do not use gcc-4.2 as the default compiler.

	* NEWS: describe the issue about Xcode.

Wed Sep 14 11:46:30 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_rcopy): added an argument guard.
	  Patch by NAKAMURA Usaku. [Bug #5306] [ruby-core:39435]

Tue Sep 13 09:28:58 2011  Koichi Sasada  <ko1@atdot.net>

	* NEWS: wrote about rb_reserved_fd_p() and objspace.

Mon Sep 12 20:47:52 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_select): fix a typo to initialize efds
	  properly.  [Bug #5299] [ruby-core:39380]

Mon Sep 12 20:41:20 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_select): fix to ignore an argument
	  modification of rb_thread_fd_select().
	  based on a patch by Eric Wong. [Bug #5306] [ruby-core:39435]
	* thread.c (rb_fd_rcopy): New. for reverse fd copy.

	* test/-ext-/old_thread_select/test_old_thread_select.rb
	(test_old_select_false_positive): test for bug5306.

	* ext/-test-/old_thread_select/old_thread_select.c (fdset2array):
	  New. convert fdsets to array.
	* ext/-test-/old_thread_select/old_thread_select.c (old_thread_select):
	  return 'read', 'write', 'except' argument of rb_thread_select()
	  to ruby script.

Tue Sep  6 13:15:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (load_encoding): predefined encoding names are safe.
	  [ruby-dev:44469] [Bug #5279]

	* transcode.c (load_transcoder_entry): ditto.

Fri Sep  9 16:02:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* insns.def (concatstrings): don't use initial ASCII-8BIT string.
	  [ruby-core:38635] [Bug #5126]

Thu Sep  8 21:17:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: import nkf 2.1.2 (be9c280)
	  Bump version number/release date only.

Wed Sep  7 23:42:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_next_argv): open in default text mode.
	  [ruby-core:39234] [Bug #5268]

Mon Sep  5 15:06:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rubygems/test_gem_security.rb
	  (test_class_build_self_signed_cert): reset opt[:trust_dir] to apply
	  temporary Gem.user_home.

Sun Sep  4 00:56:58 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* backport r33177 from trunk.

	* test/ruby/test_fiber.rb (TestFiber#test_no_valid_cfp):
	  add a test. Unlike TestThread#test_no_valid_cfp,
	  this test succeeds even if win32ole is required (see r33153).

Fri Sep  2 21:11:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (validate_enc_binmode, prep_stdio): default to text mode on
	  dosish platforms.  [ruby-core:38822] [Bug #5164]

	* transcode.c (rb_econv_prepare_options): keep default ecflags
	  unchanged if no options.

Fri Sep  2 14:36:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_search_const_defined_class): search
	  ancestors only when global scope.  [ruby-core:39227] [Bug #5264]

Fri Sep  2 09:58:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_string, parser_yylex): ignore a backslash
	  which prefixes an non-ascii character, which has no escape
	  syntax.  [ruby-core:39222] [Ruby 1.9 - Bug #5262]

Thu Sep  1 17:31:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defineclass), vm_insnhelper.c (vm_get_cvar_base): see
	  also inherited constants for classes without superclass and
	  modules.  [ruby-core:37698] [Bug #3423]

Thu Sep  1 14:11:16 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_thread.rb (TestThread#test_no_valid_cfp): skip when
	  win32ole is required.  in such case, win32ole redefines
	  Thread#initialize, and the block argument becomes to be not the top
	  of the thread, then this testcase always fails.

Wed Aug 31 16:02:45 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Merge json gem v1.5.4 (3dab4c5a6a97fac03dac).

Wed Aug 31 13:19:31 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (flo_round): Avoid overflow by optimizing for trivial
	  cases
	  [Bug #5227]

Wed Aug 31 06:45:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: fix r32835. $withval can't be used outer AC_ARG_WITH().

Wed Aug 31 05:29:03 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_select_with_thread): and my typo. we all must
	  be more careful.

Wed Aug 31 05:28:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (rb_thread_select): critical typo in r33117.

Wed Aug 31 05:28:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/-ext-/old_thread_select/test_old_thread_select.rb
	  (TestOldThreadSelect#test_old_select_read_timeout): if the machine
	  is fast enough, the time used by code around IO.select may be smaller
	  than Time implement threshold.

Wed Aug 31 05:27:59 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/-test-/old_thread_select/old_thread_select.c (old_thread_select):
	  typo.

	* test/-ext-/old_thread_select/test_old_thread_select.rb
	  (TestOldThreadSelect#test_old_select_signal_safe): use SIGINT instead
	  of SIGUSR1 because the former is general and the latter is platform
	  dependent.

Wed Aug 31 05:26:30 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/intern.h (rb_w32_fd_copy): implement
	  for rb_thread_select() in thread.c.  the use of rb_fd_copy() is
	  introduced in r33117.
	  [Bug #5229] [ruby-core:39102]

	* thread.c (rb_thread_select): must call rb_fd_init() before using
	  rb_fdset_t.  see the implementations of rb_fd_init()s if you want to
	  know the reason.

Tue Aug 30 11:25:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Merge json gem 1.5.4+ (2149f4185c598fb97db1).
	  [Bug #5173] [ruby-core:38866]

Tue Aug 30 09:53:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_entry): fix stack allocation failure on Debian
	  GNU/kFreeBSD.
	  Patch by Lucas Nussbaum <lucas at lucas-nussbaum dot net>.
	  [Bug #5241] [ruby-core:39147]

Tue Aug 30 09:52:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* backport r33117 from trunk.

	* thread.c (rb_thread_select): rewrite by using
	  rb_thread_fd_select(). old one is EINTR unsafe.
	  Patch by Eric Wong. [Bug #5229] [ruby-core:39102]

	* test/-ext-/old_thread_select/test_old_thread_select.rb:
	  a testcase for rb_thread_select().
	* ext/-test-/old_thread_select/old_thread_select.c: ditto.
	* ext/-test-/old_thread_select/depend: ditto.
	* ext/-test-/old_thread_select/extconf.rb: ditto.

Tue Aug 30 09:16:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: fix a build failure on GNU Hurd.
	  Patch by Samuel Thibault <sthibault at debian dot org>. Thank you!
	  [Bug #5250] [ruby-core:39185]

Sun Aug 28 15:38:17 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* backport r33106 from trunk.

	* ext/date/date_parse.c (date_zone_to_diff): keep a temporary string
	  stored in variable while the contents buffer is beeing used.

	* ext/date/date_parse.c (date_zone_to_diff): get rid of out of bounds
	  memory read. [ruby-dev:44409] [Bug #5213]

Sun Aug 28 05:29:50 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* backport r33102 from trunk.

	* lib/minitest/*: Imported minitest 2.5.1 (r6596)
	* test/minitest/*: ditto

Sat Aug 27 20:54:54 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* backport r33099 from trunk.

	* vm.c (rb_vm_rewrite_dfp_in_errinfo): change return type
	  to suppress a warning.

	* vm_core.h: ditto.

Sat Aug 27 19:03:44 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* backport r33096 from trunk.

	* proc.c (proc_new): force to rewrite errinfo when calling Proc.new in ensure.
	  [Bug #5234] [ruby-core:39125]

	* vm.c (rb_vm_rewrite_dfp_in_errinfo): new function.

	* vm.c (vm_make_env_each): changed accordingly.

	* vm_core.h: ditto.

	* bootstraptest/test_flow.rb: add tests for above.

Sat Aug 27 08:59:12 2011  Eric Hodel  <drbrain@segment7.net>

	* NEWS:  Update version of rake to 0.9.2.2.

Sat Aug 27 08:44:58 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33087 from trunk

	* lib/rdoc:  Import RDoc 3.9.4.  Typo and grammar fixes by Luke Gruber.
	  [Ruby 1.9 - Bug #5203]

Sat Aug 27 07:53:34 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33087 from trunk.

	* lib/open-uri.rb:  Fix indentation of OpenURI::OpenRead#open.  Use ++
	  instead of `' for method arguments in open-uri.rb

Sat Aug 27 07:22:07 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33086 from trunk.

	* ext/pathname/lib/pathname.rb:  Fix typos and grammar mistakes.  Patch
	  by Luke Gruber.  [#5203]
	* ext/pty/lib/expect.rb:  ditto
	* lib/mathn.rb:  ditto
	* lib/net/http.rb:  ditto
	* lib/open-uri.rb:  ditto
	* lib/ostruct.rb:  ditto
	* lib/tempfile.rb:  ditto
	* lib/thread.rb:  ditto
	* lib/weakref.rb:  ditto
	* sample/webrick/httpproxy.rb:  ditto

Fri Aug 26 10:10:37 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33074 from trunk.

	* lib/rubygems:  Update to RubyGems 1.8.10.  Fixes security issue in
	  creating ruby-format gemspecs.  Fixes Gem.dir not being at the front
	  of Gem.path to fix uninstall and cleanup commands.  Fixes gem
	  uninstall stopping on the first missing gem.

Wed Aug 24 09:49:10 2011  Koichi Sasada  <ko1@atdot.net>

	* backport r33045 from trunk.

	* insns.def (defined): fix to checking class variable.
	  A patch by Magnus Holm <judofyr@gmail.com>.  Thanks!

Fri Aug 26 08:21:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/ruby/test_variable.rb: add a test for above.

Thu Aug 25 09:43:16 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33066 from trunk.

	* ext/openssl/lib/openssl/bn.rb:  Hide copyright info from RDoc.
	* ext/openssl/lib/openssl/digest.rb:  ditto
	* ext/openssl/lib/openssl/cipher.rb:  ditto

Thu Aug 25 09:25:48 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33065 from trunk.

	* ext/openssl/ossl_digest.c:  Document OpenSSL::Digest::digest and add
	  an example to OpenSSL::Digest.  Patch by Sylvain Daubert.
	  [Ruby 1.9 - Bug #5166]
	* ext/openssl/lib/openssl/digest.rb (module OpenSSL):  ditto

Thu Aug 25 08:19:43 2011  Koichi Sasada  <ko1@atdot.net>

	* vm.c (vm_make_env_each): work around to solve Bug #2729.
	  fixes: Bug #2729
	  a patch from Kazuki Tsujimoto <kazuki@callcc.net>
	  This problem is caused by changing dfp (dynamic env pointer)
	  from saved dfp.  Saved dfp is pointed env in VM stack.  However,
	  the dfp can be moved because VM copies env from VM stack to
	  the heap.  At this copying, dfp was also changed.  To solve this
	  problem, I'll try to change throw mechanism (not save target dfp,
	  but save target cfp).

	* bootstraptest/test_flow.rb: add a test for above.

Thu Aug 25 08:04:08 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (int_round): Fix Integer#round [ruby-core:39096]

Thu Aug 25 06:51:08 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: Fixing psych version number.

Thu Aug 25 06:11:35 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/nodes/node.rb: default `to_yaml` encoding to be
	  UTF-8.
	* test/psych/test_encoding.rb: test yaml dump encoding.

Wed Aug 24 08:53:06 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33043 from trunk.

	* lib/rdoc:  Update to RDoc 3.9.3.  Fixes RDoc with `ruby -Ku`.  Allows
	  HTTPS image paths to be turned into <img> tags.  Prevents special
	  markup inside <tt> from being processed.

Wed Aug 24 07:57:43 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33040 from trunk.

	* lib/rubygems:  Update to RubyGems 1.8.9.  Fixes uninstalling multiple
	  gems and gem cleanup.

Wed Aug 24 06:45:20 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* backport r33036 from trunk.

	* lib/minitest/*: Imported minitest 2.5.0 (r6557)
	* test/minitest/*: ditto

Tue Aug 23 15:23:56 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r33027 from trunk.

	* load.c (rb_f_require):  Improve documentation of Kernel#require.
	  [Ruby 1.9 - Bug #5210]

Tue Aug 23 15:11:48 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r33023 from trunk.

	* ext/zlib/zlib.c (gzfile_read_header): Ensure that each section of
	  gzip header is readable to avoid SEGV.

	* test/zlib/test_zlib.rb (test_corrupted_header): Test it.

Mon Aug 22 23:43:33 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* backport r33021 from trunk.

	* sprintf.c (rb_str_format): add RB_GC_GUARD to prevent temporary
	  strings from GC.

Sun Aug 21 17:58:38 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* backport r33019 from trunk.

	* iseq.c (iseq_s_disasm): remove variable which is no longer used
	  since r33013.

Sun Aug 21 14:20:58 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* configure.in: use LD_LIBRARY_PATH_64 on 64-bit Solaris.

Sun Aug 21 11:13:54 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* backport r32895 from trunk.

	* ext/fiddle/conversions.c (generic_to_value): ffi_arg and ffi_sarg
	  should be used to handle shorter return value. fix [Bug #3861]
	  [ruby-core:32504]

	* ext/fiddle/closure.c (callback): ditto

	* ext/fiddle/conversions.h (fiddle_generic): ditto

	* ext/fiddle/conversions.c (value_to_generic): char, short and int
	  are strictly distinguished on big-endian CPU, e.g. sparc64.

Sat Aug 20 13:28:32 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* backport r33013 from trunk.

	* iseq.c (iseq_s_disasm): fix a bug that may cause SEGV.

	* test/ruby/test_method.rb (test_body): add a test for the above change.

Sat Aug 20 10:43:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): return new string if nil
	  is explicitly given as a buffer ([Bug #5207]), otherwise set the
	  encoding.  also removed dead code.

Fri Aug 19 14:25:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_spawn_v, proc_spawn): should not wait the
	  spawned process.

	* process.c (proc_spawn_v): fix missing argument, and try with
	  /bin/sh only if failed with ENOEXEC.

Fri Aug 19 14:12:57 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* backport r33007 from trunk.

	* lib/net/imap.rb (idle): raises a Net::IMAP::Error when the
	  connection is closed.  based on the patch by Hugo Barauna.
	  [Bug #5190] [ruby-core:38930]

Fri Aug 19 11:28:58 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* backport r33001 from trunk.

	* lib/net/imap.rb (msg_att): accepts extra space before ')'.
	  based on the patch by art lussos.  [Bug #5163] [ruby-core:38820]

Wed Aug 17 15:27:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* backport r32996 from trunk.

	* ext/bigdecimal/bigdecimal.c (cannot_be_coerced_into_BigDecimal):
	  add a new function for raising error when an object cannot coerce
	  into BigDecimal.  [Bug #5172]

	* ext/bigdecimal/bigdecimal.c (BigDecimalValueWithPrec): use
	  cannot_be_coerced_into_BigDecimal function.

	* ext/bigdecimal/bigdecimal.c (BigMath_s_exp): ditto.

	* ext/bigdecimal/bigdecimal.c (BigMath_s_log): ditto.

	* test/bigdecimal/test_bigdecimal.rb: test for the avobe changes.

	* test/bigdecimal/testbase.rb (under_gc_stress): add a new utility
	  method to run tests under the condition of GC.stress = true.

Wed Aug 17 10:16:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* backport r32994 from trunk.

	* rational.c (nurat_coerce): Rational#coerce should converts itself
	  into Complex if the argument is a Complex with non-zero imaginary
	  part.  [Bug #5020] [ruby-dev:44088]

	* test/ruby/test_rational.rb (test_coerce): test for the above change.

Wed Aug 17 06:33:19 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r32992 from trunk.

	* ext/openssl/ossl_x509cert.c: Add class documentation for
	  OpenSSL::X509::Certificate.

Wed Aug 17 05:02:25 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r32987 from trunk.

	* ext/openssl/ossl_pkey.c: corrected docs, OpenSSL::PKey::DH does
	  *not* support #sign/verify.

Tue Aug 16 18:56:54 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_threadptr_data_type): rename to hide.
	  [ruby-core:38972]

Tue Aug 16 18:52:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/mkexports.rb (Exports::Mswin#each_export): exclude Init_
	  and _threadptr_ functions, as well as mingw.

Tue Aug 16 09:38:37 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r32981 and r32982 from trunk.

	* ext/dl:  Add documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #5192]

	* ext/.document (fiddle):  Remove duplicate entry

	* ext/fiddle:  Complete documentation of Fiddle.  Patch by Vincent
	  Batts.  [#5192]

Tue Aug 16 08:00:15 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r32977 from trunk

	* ext/socket:  Make Socket documentation appear.  Add documentation for
	  Socket, TCPServer, SOCKSSocket.  Patch by Sylvain Daubert.
	  [Ruby 1.9 - Feature #5182]

Mon Aug 15 10:16:55 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>
	* backport r32973 from trunk.

	* ext/openssl/ossl_ssl.c: Support disabling OpenSSL compression.

	* test/openssl/test_ssl.rb: Add a test for it.
	  Thanks to Eric Wong for the patch.
	  [Ruby 1.9 - Feature #5183] [ruby-core:38911]

Sat Aug 13 22:17:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb: do not make the entries related to sitedir and
	  verdordir if disabled by --without options.  [ruby-core:38922]
	  [Bug #5187]

Sat Aug 13 17:06:57 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: [ruby-core:38861]

Sat Aug 13 16:59:51 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_*.rb: added tests.

Sat Aug 13 09:36:19 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/date/date_parse.c (parse_ddd_cb): fix r32896. RB_GC_GUARD
	  insertion position was mistaken. [ruby-dev:44337] [Bug #5152]

Sat Aug 13 09:26:24 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/core_ext.rb: Make Kernel#y private.
	  [ruby-core:38913]

	* test/psych/test_yaml.rb: corresponding test.

Sat Aug 13 09:15:16 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_strftime_alloc): followed the change
	  of r32885.

	* NEWS: followed the above change.

Sat Aug 13 08:49:05 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: [ruby-core:38855].

Sat Aug 13 03:41:37 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r32953 from trunk.

	* lib/uri/common.rb:  Fix documentation of URI::Parser.new.  Patch by
	  Steve Klabnik.  [Ruby 1.9 - Bug #5177]

Sat Aug 13 02:19:57 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r32950 from trunk.

	* ext/digest/digest.c:  Add documentation for the Digest module.  Patch
	  by Sylvain Daubert.  [Ruby 1.9 - Bug #5167]

Fri Aug  5 13:32:43 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* backport r32856 from trunk.

	* lib/xmlrpc/client.rb, lib/xmlrpc/server.rb: should use
	  String#bytesize instead of String#size.

Fri Aug 12 13:53:03 2011  Narihiro Nakamura  <narihiro@netlab.jp>

	* backport r32894 from trunk.

	* gc.c (gc_lazy_sweep): if sweep target slots are not found, we
	  try heap_increment() because it might be able to expand the
	  heap. [Bug #5127] [ruby-dev:44285]

	* gc.c (gc_clear_mark_on_sweep_slots): if a sweeping was
	  interrupted, we expand the heap if at all possible.

Fri Aug 12 12:28:17 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake:  Update to Rake 0.9.2.2.  Prevent pollution of toplevel
	  namespace by Commands.  Remove unused variable and debugging
	  statement in tests.

Fri Aug 12 09:00:24 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r32941 from trunk

	* lib/rubygems:  Import RubyGems 1.8.8.  Fixes encoding of YAML gemspec
	  from gems.  Github Issue #149

Fri Aug 12 03:24:35 2011  Eric Hodel  <drbrain@segment7.net>

	* backport r32935 from trunk

	* lib/rdoc:  Import RDoc 3.9.2.  Fixes TIDYLINK for HTML output.

Tue Aug  2 22:04:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* backport r32815 from trunk.

	* gc.c (init_heap): allocate sigaltstack after heaps are allocated.
	  [ruby-dev:44315] [Bug #5139]

	* vm.c (thread_free): use free because objspace is not ready.

	* vm.c (th_init): use malloc because objspace is not ready.

Thu Aug 11 19:04:38 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r32931 from trunk.

	* variable.c (autoload_delete): An autoload entry is still in a
	  RCLASS_IV_TBL, not in a RCLASS_CONST_TBL, so take back the table
	  changed in r29600. And an autoload entry keeps not a
	  rb_const_entry_t but a NODE so remove rb_const_entry_t thing added
	  in r29602.

Thu Aug 11 15:07:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (link_command): use LIBRUBYARG in rbconfig for
	  unbundled extensions.  [ruby-core:38802] [Bug #5147]

	* lib/mkmf.rb (init_mkmf): revert r32902.  [ruby-core:38903]

Wed Aug 10 19:30:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* backport r32903 from trunk.

	* complex.c (nucomp_rationalize): calls rationalize of real part if
	  imaginary part is exactly zero.  The patch is made by Marc-Andre
	  Lafortune.  fixes [Bug #5178] [ruby-core:38885]

	* test/ruby/test_complex.rb (test_rationalize): add a test for the
	  above change.

	* complex.c (nucomp_to_r): fix RDoc comment.  The patch is made by
	  Marc-Andre Lafortune.

Wed Aug 10 14:11:07 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (init_mkmf): set $LIBRUBYARG regardless of shared
	  option.  [ruby-core:38802] [Bug #5147]

Wed Aug 10 02:57:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: come back autoload. OpenSSL constant is used
	  some places, so it leads mistakes like HTTP.start.

Tue Aug  9 22:57:45 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/date/date_parse.c (date_zone_to_diff): add RB_GC_GUARD.
	  [ruby-dev:44337] [Bug #5152]

	* ext/date/data_parse.c (parse_ddd_cb): ditto.

Tue Aug  9 12:20:33 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* test/fiddle/helper.rb (libc_so, libm_so): Solaris support added.
	  [ruby-core:38853] [Bug #5168]

	* test/dl/test_base.rb (libc_so, libm_so): on Solaris, remove libc
	  and libm version numbers for detecting default libc and libm.

Tue Aug  9 10:49:52 2011  Igor Zubkov  <igor.zubkov@gmail.com>

	* array.c: Fix typo. https://github.com/ruby/ruby/pull/36

Mon Aug  8 00:10:45 2011  Akinori MUSHA  <knu@iDaemons.org>

	* test/test_syslog.rb (TestSyslog#test_log): Do not be too
	  specific about the log line format.  Fixes #5081.

Sun Aug  7 23:39:44 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* time.c (rb_strftime_alloc): raise ERANGE if width is too large.
	  Patch by Nobuyoshi Nakada. [Bug #4457] [ruby-dev:43285]

	* test/ruby/test_time.rb (class TestTime): add a test for the
	  above change.

Sun Aug  7 14:15:10 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* backport r32876 from trunk.

	* ext/objspace/objspace.c: fix typos in a document.

Sun Aug  7 04:42:36 2011  Eric Hodel  <drbrain@segment7.net>

	* marshal.c (w_object):  Fix exception message when _dump_data
	  is not defined on a T_DATA object.

Sat Aug  6 06:14:20 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to 3.9.1.  Fixes === lines in verbatim sections.
	  Fixes :nodoc: on class aliases.  Fixes :stopdoc: creating references
	  to Object.  Fixes spacing when class comments are merged in ri.
	  Fixes `ri []` crash.  Fixes bug report URL when rdoc crashes.  Adds
	  :doc: and :nodoc: to allow hiding of implementation details in ruby.
	  Makes `rdoc` and `ri` gem-aware.

Sat Aug  6 03:19:45 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Import RubyGems 1.8.7:
	  Added missing require for `gem uninstall --format-executable`.

	  The correct name of the executable being uninstalled is now displayed
	  with --format-executable.

	  Fixed `gem unpack uninstalled_gem` default version picker.

	  RubyGems no longer claims a nonexistent gem can be uninstalled.

	  `gem which` no longer claims directories are requirable files.

	  `gem cleanup` continues cleaning up gems if one can't be uninstalled
	  due to permissions.  Issue #82.

	  Gem repository directories are no longer created world-writable.
	  Patch by Sakuro OZAWA.  [Ruby 1.9 - Bug #4930]

Fri Aug  5 23:08:39 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* backport r32845 from trunk.

	* configure.in: when Solaris cc, use $(CC) to link shared libs.

Fri Aug  5 22:16:20 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* numeric.c (rb_infinity, rb_nan): use WORDS_BIGENDIAN to get endian.
	  fix [Bug #5160] [ruby-dev:44356]

Fri Aug  5 15:57:10 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* complex.c (f_signbit): fix compile error in gcc4 on Solaris with
	  CFLAGS="-std=gnu99".  [ruby-dev:44355] fix [Bug #5159]

	* math.c: ditto.

Thu Aug  5 10:09:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* backport r32846 from trunk.

	* thread_pthread.c (native_cond_signal): retry to call pthread_cond_signal
	  and pthread_cond_broadcast if they return EAGAIN in
	  native_cond_signal and native_cond_broadcast, respectively.
	  It is for the pthread implementation of Mac OS X 10.7 (Lion).
	  fixes #5155.  [ruby-dev:44342].

	* thread_pthread.c (native_cond_broadcast): ditto.

	* thread_pthread.c (struct cached_thread_entry): stop using
	  pthread_cond_t and its functions directly.

	* thread_pthread.c (register_cached_thread_and_wait): ditto.

	* thread_pthread.c (use_cached_thread): ditto.

Fri Aug  5 07:35:00 2011  Luis Lavena  <luislavena@gmail.com>

	* lib/rubygems/installer.rb (class Gem): Correct path check on Windows
	  Possible fix for [Ruby 1.9 - Bug #5111]

	* test/rubygems/test_gem_installer.rb (load Gem): ditto
	  Backported from trunk r32804

Fri Aug  5 07:00:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/io/console/test_io_console.rb (test_noctty): daemon() on
	  Fedora Rawhide seems not to detach the controlling terminal,
	  when the argument noclose is non-zero.  ref: [Bug #5135]

Wed Aug  4 02:35:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: use build_os variable for checking C and C++ compilers
	  matching.

	* configure.in: use clang++ if clang is used.

Thu Aug  4 02:21:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (link_command): use static library only for bundled
	  extensions.  [Bug #5147]

Wed Aug  3 00:11:08 2011  Tanaka Akira  <akr@fsij.org>

	* lib/prettyprint.rb: update document.  [ruby-core:36776]


Tue Aug  2 20:10:16 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb: pass "--ruby" option to
	  test/testunit/tests_for_parallel/runner.rb. [Bug #5132] [ruby-dev:44303]
	  Backported from trunk r32812.

Tue Aug  2 12:03:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (recursive_hash): hash value of emptied hash should be
	  equal to an empty hash.  [ruby-core:38650]

Tue Aug  2 11:42:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_enc_symname2_p): :! is valid symbol.  [Bug #5136]

Tue Aug  2 03:26:02 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rake/test_rake_directory_task.rb (TestRakeDirectoryTask#
	  test_directory_win32): fixed wrong test.
	  backported r32670 from trunk.

Mon Aug  1 15:45:23 2011  Eric Hodel  <drbrain@segment7.net>

	* test/rake/test_rake_functional.rb:  Don't assume the binary name of
	  ruby is "ruby".  [Ruby 1.9 - Bug #5114]
	* test/rake/helper.rb:  ditto

Mon Aug  1 05:21:42 2011  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* cont.c (cont_save_thread): fix missing semicolon.

Sun Jul 31 22:57:16 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* enc/Makefile.in (ECHO1): Same as the recent fix in common.mk.
	  ":" in a make variable replacement cause a syntax error with
	  /usr/ccs/bin/make on Solaris.  Uses $(NULLCMD) instead.

Sun Jul 31 22:44:08 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* configure.in: fix typos.

Sun Jul 31 21:19:51 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mkmf.rb (configuration:ECHO1): Same as the recent fix in
	  common.mk.
	  ":" in a make variable replacement cause a syntax error with
	  /usr/ccs/bin/make on Solaris.  Uses $(NULLCMD) instead.

Sun Jul 31 21:16:02 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* complex.c (f_signbit): gcc4 on Solaris DOES have signbit but does
	  not have it on header.

	* math.c: ditto.

Sun Jul 31 21:09:04 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (node_name.inc): Use $(Q) for consistency.

	* Makefile.in (INSNS): ditto.

Sun Jul 31 20:39:12 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (ECHO1): nmake does not allow parenthesis in make variable
	  replacement.

Sun Jul 31 20:21:36 2011  "Yuki Sonoda (Yugui)"  <yugui@yugui.jp>

	* common.mk (ECHO1): ":" in a make variable replacement cause a syntax
	  error with /usr/ccs/bin/make on Solaris.  Uses $(NULLCMD) instead.

	* configure.in (NULLCMD): new check.

	* Makefile.in (NULLCMD): Reflects checking in configure.

	* win32/Makefile.sub (NULLCMD): new assignment.

Sun Jul 31 11:31:07 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* backport r32768 from trunk.

	* vm.c: check if cfp is valid. [Bug #5083] [ruby-dev:44208]

Sat Jul 31 01:23:45 2011  Kenta Murata  <mrkn@mrkn.jp>

	* backport r32762 from trunk.

	* test/bigdecimal/test_bigdecimal.rb (test_version): removed.

Sat Jul 30 23:51:44 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (cbrt): should return a real number if possible.

Sat Jul 30 23:48:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: an issue that is same as  [ruby-dev:44071].

	* ext/date/date_strftime.c: identical to [ruby-dev:44112].

Sat Jul 30 23:19:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* defs/default_gems: separate from tool/rbinstall.rb.

Sat Jul 30 23:14:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_each_byte): rbuf can be refreshed during yield.
	  [Bug #5119]

Sat Jul 30 22:35:50 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* strftime.c (NEEDS): avoid SEGV due to integer overflow in
	  sparc-solaris2.10 and i686-linux.  fix [Bug #4456] [ruby-dev:43284]

Sat Jul 30 14:27:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* backport r32754 from trunk.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_version): version 1.1.0.

	* ext/bigdecimal/bigdecimal.gemspec: turn into a default gem.

	* tool/rbinstall.rb: ditto.

Sat Jul 30 13:52:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (Rational#to_d):
	  revive zero and implicit precision support as a deprecated feature.

	* test/bigdecimal/test_bigdecimal_util.rb: modify a test for the above
	  change.

	* NEWS: describes the above change.

Sat Jul 30 10:58:10 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm.c (th_init): preallocate alternative stack.
	  NoMemoryError is better than rb_bug, of course.
	  Patch by Eric Wong. [ruby-core:38572][ruby-core:38594].

	* signal.c (rb_register_sigaltstack): ditto.

	* vm_core.h: moved ALT_STACK_SIZE definition from signal.c.

	* vm.c (thread_free): use xfree() instead of free().

Sat Jul 30 07:20:49 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (udp_server_sockets): unused variable
	  removed.
	  patch by Jeremy Evans.  [ruby-core:38600]

Fri Jul 29 23:56:32 2011  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb: call OpenSSL::Random.seed at the
	  SecureRandom.random_bytes call.
	  based on the patch by Masahiro Tomita.  [ruby-dev:44270]

Fri Jul 29 20:48:39 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: fix typos.

Fri Jul 29 20:28:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: use whitespaces as a separator.

Fri Jul 29 18:59:07 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: add documents for constants.
	  patch by Eric Hodel.  [ruby-core:37853] [Bug #4989]

Mon Jul 25 23:51:01 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* backport r32671 from trunk.

	* proc.c: pre-allocate the unlinked_method_entry_list_entry struct to
	  avoid memory allocation during GC.  based on a patch from Eric Wong.
	  [ruby-core:38498]

Mon Jul 25 22:36:11 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* backport r32669 from trunk.

	* proc.c (struct METHOD), gc.c (gc_marks), vm_method.c
	  (rb_gc_mark_unlinked_live_method_entries): fix SEGV bug.
	  rb_method_entry_t was free'd even when the method is still on the
	  stack if it is BMETHOD (i.e., Method#call).  This is because
	  rb_method_entry_t is embedded in struct METHOD.  This commit
	  separates them and marks the live method entries.
	  See [ruby-core:38449] in detail.  fix [Bug #5047] [ruby-core:38171]

Thu Jul 28 23:36:28 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/fiddle/closure.c (callback): use rb_ary_tmp_new() instead of
	  xmalloc() to allocate an array for arguments of callback procedure,
	  to prevent arguments from being swept by GC. [ruby-core:38546]
	  [Bug #4929]

Thu Jul 28 22:51:27 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r32723 from trunk.

	* ext/openssl/ossl_cipher.c (ossl_cipher_initialize): Avoid possible
	  SEGV from AES encryption/decryption. Processing data by
	  Cipher#update without initializing key (meaningless usage of Cipher
	  object since we don't offer a way to export a key) could cause SEGV.

	  In OpenSSL, the EVP which has EVP_CIPH_RAND_KEY flag (such as DES3)
	  allows uninitialized key, but other EVPs (such as AES) does not
	  allow it. Calling EVP_CipherUpdate() without initializing key causes
	  SEGV so we set the data filled with "\0" as the key by default. See
	  #2768.

	* test/openssl/test_cipher.rb: test it.

Thu Jul 28 04:53:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/delegate.rb:  Move file-level documentation to the appropriate
	  classes.

Thu Jul 28 00:33:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/fileutils/test_fileutils.rb: add OpenBSD case.
	  patched by Jeremy Evans [ruby-core:38530] see #5097

	* test/ruby/test_process.rb: ditto.

Wed Jul 27 17:59:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/missing.h: define __syscall if the platform has
	  __syscall in the library but doesn't define it in headers
	  for example Mac OS X.

Wed Jul 27 15:39:14 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c:  Add usage documentation for BasicObject.  Based on patch
	  by Thomas Sawyer.  [Ruby 1.9 - Bug #5067]

Wed Jul 27 12:24:17 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/uninstaller.rb:  Add missing require and update
	  messaging to avoid confusion with uninstall --format-executable.
	  [Ruby 1.9 - Bug #4062]

Wed Jul 27 10:47:57 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Update to RubyGems 1.8.6.1.

Wed Jul 27 10:04:06 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r32690 from trunk.

	* test/openssl/test_pkcs12.rb: Add test and intermediate certificates.
	  [ Ruby 1.9 - Feature #3793 ] [ruby-core:32088]

Sat Jul 27 01:26:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: add changes of bigdecimal and bigdecimal/util.

Wed Jul 27 01:13:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (Rational#to_d):
	  zero or negative precision is error.  fixes #5098.
	  [ruby-dev:44210]

	* ext/bigdecimal/lib/bigdecimal/util.rb (Float#to_d): modified for
	  specifying precision.  fixes #5098.  [ruby-dev:44210]

	* ext/bigdecimal/lib/bigdecimal/util.rb (Integer#to_d): added
	  for symmetry to BigDecimal() function with an Integer.
	  fixes #5098.  [ruby-dev:44210]

	* ext/bigdecimal/lib/bigdecimal/util.rb (BigDecimal#to_d): added
	  for adapting other Numeric subclasses.  [ruby-dev:44245]

	* test/bigdecimal/test_bigdecimal_util.rb: add tests for the above
	  changes.

Wed Jul 27 00:54:38 2011  Kenta Murata  <mrkn@mrkn.jp>

	* bigdecimal/bigdecimal.c (VpDup) a new function for duplicating
	  a BigDecimal.

	* bigdecimal/bigdecimal.c (BigDecimal_new): support generating a new
	  BigDecimal from another BigDecimal using BigDecimal global function
	  or constructor.  [ruby-dev:44245]

Mon Jul 25 22:24:09 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r32666 from trunk.

	* lib/xmlrpc/client.rb: Fix possible HTTP header formatting failure by
	  'Basic' header. Long username caused the base64 String truncation in
	  HTTP header which is not allowed. See #5046.

	* test/xmlrpc/test_webrick_server.rb: test it.

Mon Jul 25 15:36:07 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/{x509.rb,ssl.rb}: Add deprecation warning
	  for openssl/{x509,ssl} usage. Users should require "openssl" instead
	  of "openssl/ssl" and "openssl/x509". Start of transition period
	  introduced by [ruby-dev:38018].

Mon Jul 25 13:50:33 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r32662 from trunk.

	* ext/openssl/lib/openssl/x509.rb: Cosmetic change: move definition
	  introduced in r30152 to x509-internal.rb.

Mon Jul 25 13:35:20 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r32658 from trunk.

	* ext/openssl/ossl_ssl.c (ossl_ssl_shutdown): Avoid randomly generated
	  SSLError from SSLSocket just after invoking SSLSocket#close.
	  OpenSSL's SSL_shutdown could try to send alert packet and it might
	  set SSLerr(global error stack) as the result. It causes the next
	  SSL read/write operation to fail by unrelated reason.

	  By design, we're ignoring any error at SSL_shutdown() so we clear
	  global error stack after SSL_shutdown is called. See #5039.

Sun Jul 24 20:29:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: refine the recvmsg test.

Sun Jul 24 20:02:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: fix the recvmsg test.

Sun Jul 24 08:42:51 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test recvmsg allocates file descriptors for
	  fd passing even with MSG_PEEK.

	* ext/socket/ancdata.c: use the above test result.

Sun Jul 24 01:24:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/specification.rb:  Restore behavior of
	  Gem::Specification#loaded.  [Ruby 1.9 - Bug #5032]

Sun Jul 24 01:14:49 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rake/test_rake_functional.rb (setup): Use __FILE__ for the base
	  directory. Current directory is not the top source directory when
	  the building process runs on other than there.

	* test/rake/test_rake_rake_test_loader.rb: ditto.

	* test/rake/test_rake_task_argument_parsing.rb
	  (test_terminal_width_using_hardcoded_80): hardcoded 80 is used
	  when app.unix? is false.

Sun Jul 24 00:42:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: change the default compiler to gcc-4.2 if target os
	  is OS X 10.7 (Lion).

Sat Jul 23 17:06:25 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_update_max_fd): validate fd.

	* ext/socket/rubysocket.h (rsock_discard_cmsg_resource): add
	  msg_peek_p argument for the declaration.

	* ext/socket/ancdata.c (discard_cmsg): add msg_peek_p argument.
	  assume FreeBSD, NetBSD and MacOS X doesn't generate passed fd
	  when MSG_PEEK.
	  (rsock_discard_cmsg_resource): add msg_peek_p argument.
	  (bsock_recvmsg_internal): call rsock_discard_cmsg_resource with
	  msg_peek_p argument.

	* ext/socket/unixsocket.c (unix_recv_io): call
	  rsock_discard_cmsg_resource with msg_peek_p argument.

Sat Jul 23 14:38:28 2011  Eric Hodel  <drbrain@segment7.net>

	* test/rake*: Remove dependencies on flexmock and session gems.
	  [Ruby 1.9 - Bug #4987]

Fri Jul 22 21:46:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_insnhelper.c (vm_call_cfunc): added volatile for a workaround
	  of cfp consistency error problem on OS X 10.7 (Lion). It's
	  suspected llvm optimization bug.
	  [Bug #5076] [ruby-dev:44185]

Fri Jul 22 21:50:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/generic.rb (WFKV_): unroll the loop of regexp.

	* lib/uri/generic.rb (URI.decode_www_form_component): ditto.

Fri Jul 22 21:49:48 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enum.c (enum_inject): remove empty line to notify rdoc
	  Enumerable#reduce is alias. patched by milki@github.
	  https://github.com/ruby/ruby/pull/26

Fri Jul 22 21:49:28 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#each):
	  Allow HTTP/0.9 request which doesn't has any header or body.
	  patched by Felix Jodoin. [ruby-core:38040] [Bug #5022]

Fri Jul 22 21:45:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl/handle.c (dlhandle_sym): clear previous error with dlerror()
	  before calling dlsym(). [ruby-dev:44091] [Bug #5021]

Fri Jul 22 19:05:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_enc_symname2_p): get rid of potential out-of-bound
	  access.

Fri Jul 22 13:55:59 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Net::HTTP#finish is used to manually close
	  connections.  [Ruby 1.9 - Bug #5045]

Fri Jul 22 13:51:29 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/readline/readline.c:  Add examples for Readline.completion_proc=.
	  [Ruby 1.9 - Bug #5057]

Fri Jul 22 13:20:33 2011  Eric Hodel  <drbrain@segment7.net>

	* tool/rbinstall.rb (default gems):  Install executables into the fake
	  gem dir for Gem.bin_path.  [Ruby 1.9 - Bug #4485]

Fri Jul 22 13:03:12 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r32609 from trunk.

	* ext/openssl/ossl_hmac.c: Revert checking return type of
	  HMAC_Init_ex as it is not compatible with OpenSSL < 1.0.0.

Fri Jul 22 11:22:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r32606 from trunk.

	* ext/openssl/ossl_digest.c: Check return value of EVP_DigestInit_ex.
	* ext/openssl/ossl_hmac.c: Check return value of HMAC_Init_ex.
	  Thanks, Jared Jennings, for the patch.
	  [ Ruby 1.9 - Bug #4944 ] [ruby-core:37670]

Fri Jul 22 09:17:43 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r32604 from trunk.

	* ext/openssl/ossl_engine.c: Avoid double free of ENGINE reference.
	* test/openssl/test_engine.rb: Add a test for it.
	  Thanks to Ippei Obayashi for providing the patch.
	  [ Ruby 1.9 - Bug #5062 ] [ruby-dev:44173]

Fri Jul 22 06:39:34 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/csv.rb: Do not modify CSV.generate's argument [ruby-core:38356]

Thu Jul 21 20:02:11 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (set_trace_func, thread_set_trace_func_m): reset tracing
	  state when set_trace_func hook is removed.  This is workaround patch
	  to force to reset tracing state that is broken by continuation call.
	  a patch from James M. Lawrence.  [Feature #4347] [ruby-core:34998]

	* test/ruby/test_continuation.rb (class TestContinuation): add a test
	  for above.  a patch from James M. Lawrence.

Thu Jul 21 20:59:59 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (discard_cmsg): workaround for MacOS X Lion.


Thu Jul 21 07:07:57 2011  Tanaka Akira  <akr@fsij.org>

	* backport r32579, r32581, r32587 by akr and r32588 by kazu.

	r32579:

	* io.c (rb_update_max_fd): new function.

	* internal.h (rb_update_max_fd): declare rb_update_max_fd.

	* thread_pthread.c (rb_thread_create_timer_thread): update max fd when
	  timer thread pipe is created.

	r32581:

	* io.c (UPDATE_MAXFD): removed.

	r32587:

	* include/ruby/intern.h (rb_update_max_fd): declaration moved from
	  internal.h.

	* file.c: ditto.

	* io.c: call rb_update_max_fd for each new fds.

	* process.c: ditto.

	* random.c: ditto.

	* ruby.c: ditto.

	* ext/io/console/console.c: ditto.

	* ext/openssl/ossl_bio.c: ditto.

	* ext/pty/pty.c: ditto.

	* ext/socket/init.c: ditto.

	* ext/socket/socket.c: ditto.

	* ext/socket/ancdata.c: ditto.

	* ext/socket/unixsocket.c: ditto.

	r32588:

	* io.c (rb_update_max_fd): remove parentheses. they are not in
	  macro.

Sun Jul 17 08:07:31 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* backport r32563 from trunk

	* test/openssl/test_ssl_session.rb: add PEM SSL session without TLS
	  extensions. Use this as the default for the tests to ensure
	  compatibility with OpenSSL 0.9.7.
	  [ Ruby 1.9 - Bug #4961 ] [ruby-core:37726]

Sat Jul 16 17:29:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_UNIVERSAL_ARCH): restore arch flag.
	  Bug #4977

Sat Jul 16 11:18:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak: support to build x64-mswin64 on Windows7 (and Vista,
	  perhaps).
	  backported r32521 from trunk

Sat Jul 16 06:31:23 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/uri/common.rb (module): Remove optional parser argument to
	  Kernel#URI
	  [ruby-core:38061]

	* lib/uri/generic.rb (module): ditto

Sat Jul 16 01:15:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* time.c (time_dup): used rb_obj_class() instead of CLASS_OF().
	  The patch is made by Kazuki Tsujimoto. [Bug #5012] [ruby-dev:44071]

	* test/ruby/test_time.rb (TestTime#test_getlocal_dont_share_eigenclass):
	  added a new test for eigenclass of time object.

Fri Jul 15 19:11:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* bignum.c (bigsub_int): add RB_GC_GUARD.  This patch is made by
	  Makoto Kishimoto.  fixes #4223 [ruby-dev:42907]

	* bignum.c (bigadd_int): ditto.

Fri Jul 15 09:59:12 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r32546 from trunk.

	* ext/digest/sha2/sha2.c (SHA256_Update, SHA512_Update): avoid Bus
	  Error caused by unalignment access on Sparc-Solaris (and possibly on
	  other similar environment.) This patch just do memcpy always instead
	  of checking architecture. I see no perf drop on my 64bit env. For
	  more details, see #4320.

	* test/digest/test_digest.rb: add test for unalignment access.


Thu Jul 14 12:40:07 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* backport r32537 from trunk.

	* ext/openssl/ossl.c (ossl_verify_cb): trap the exception from
	  verify callback of SSLContext and X509Store and make the
	  verification fail normally. Raising exception directly from callback
	  causes orphan resources in OpenSSL stack. Patched by Ippei Obayashi.
	  See #4445.

	* test/openssl/test_ssl.rb
	  (test_exception_in_verify_callback_is_ignored): test it.

Wed Jul 13 08:20:08 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Options#process_args): Fix bug.
	  Fix process_args didn't return `@option` after r30939. Backported
	  r32526 from trunk.

Mon Jul 11 23:50:39 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* time.c: can't compile time.c on AIX due to missing declaration for
	  ffs(). It is declared in strings.h on AIX. backported r32518 from
	  trunk.

Mon Jul 11 23:47:00 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* thread_pthread.c (get_stack):  need to adjust stack addr for
	  [Bug #1813] on AIX. backported r32511 from trunk.

Mon Jul 11 15:17:03 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (rb_num2ull): use FIX2LONG instead of FIX2ULONG. see
	  rb_num2ulong(). fixed the problem of ObjectSpace._id2ref of IL32LLP64
	  platforms, introduced at r32433.
	  backported r32512 from trunk.

Sun Jul 10 23:58:55 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* version.h: 1.9.3 is no longer trunk.

Sun Jul 10 23:24:29 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* class.c (rb_mix_module): reverted r31873.
	  (check_mix_method_i, do_mix_method_i) reverted r31917.

	* test/ruby/test_module.rb (TestModule#test_mix_const): reverted
	  r31918.

Sun Jul 10 22:50:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (rmpd_power_by_big_decimal): fix
	  precision treatment errors.

	* test/bigdecimal/test_bigdecimal.rb: add tests for the above change.
	  fix precision treatment errors.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_power): precision argument
	  should be optional for its compatibility.

Sun Jul 10 22:38:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (var_ref): distinguish vcall from local variable
	  references.  based on a patch by Michael Edgar michael.j.edgar
	  AT dartmouth.edu.  Bug #5002

Sun Jul 10 21:51:29 2011  Koichi Sasada  <ko1@atdot.net>

	* internal.h: add comments (cautions).

Sun Jul 10 20:59:38 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add new class variable `@@testfile_prefix`.
	  This is for changing test name prefix. (For testing)

	* test/testunit/tests_for_parallel/ptest_first.rb: Renamed from
	  test_first.rb

	* test/testunit/tests_for_parallel/ptest_second.rb: Renamed from
	  test_second.rb

	* test/testunit/tests_for_parallel/ptest_third.rb: Renamed from
	  test_third.rb

	* test/testunit/tests_for_parallel/ptest_forth.rb: Renamed from
	  test_forth.rb

	* test/testunit/tests_for_parallel/runner.rb: Remove misc.rb

	* test/testunit/tests_for_parallel/ptest_first.rb: ditto.

	* test/testunit/tests_for_parallel/ptest_second.rb: ditto.

	* test/testunit/tests_for_parallel/ptest_third.rb: ditto.

	* test/testunit/tests_for_parallel/ptest_forth.rb: ditto.

	* test/testunit/tests_for_parallel/misc.rb: Removed because no longer
	  needed.

	* test/testunit/test_parallel.rb: Fix assertions for above.

Sun Jul 10 16:57:08 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_throw): check a class frame.
	  Fixes Bug #4648.
	  The patch is contributed by Kazuki Tsujimoto.

	* bootstraptest/test_proc.rb: add tests for above.

Sun Jul 10 17:28:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (mutex_debug): use exit(EXIT_FAILURE) instad of
	  exit(1).
	* thread_pthread.c (add_signal_thread_list): ditto.
	* thread.c (rb_thread_call_with_gvl): ditto.
	* util.c (Bug): ditto.

Sun Jul 10 15:58:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Merge json gem 1.5.4+ (f7f78896607b6f6226cd).
	  [Bug #4700]

Sun Jul 10 16:41:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (typedef struct rb_vm_struct): create a new
	  'inhibit_thread_creation' field.
	* thread.c (rb_thread_terminate_all): set inhibit_thread_creation.
	* thread.c (thread_s_new): don't permit to create new thread
	  if the VM is under destruction. Otherwise evil finalizer code
	  can make SEGV. [Bug #4992][ruby-core:37858]

	* bootstraptest/test_objectspace.rb: new test for this fix.

Sun Jul 10 16:06:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sigsegv): use abort() instead of exit() when nested
	  SEGV was happen. Because unnested SEGV use abort().
	  [Bug #5013][ruby-dev:44078]

Sun Jul 10 15:30:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* load.c (rb_f_autoload): prevent to autoload for singleton
	  classes.  fixes [Bug #4886] [ruby-dev:43816]

	* bootstraptest/test_autoload.rb: add tests for the above change.

Sun Jul 10 15:09:17 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/assertions.rb: Import documentation patch by Justin
	  Collins. [ruby-core:37225] [Feature #4903]

Sun Jul 10 14:57:36 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: canonicalizes nth and sf.

Sun Jul 10 14:13:50 2011  Koichi Sasada  <ko1@atdot.net>

	* internal.h (rb_thread_call_with_gvl, rb_thread_call_without_gvl):
	  make them visible as experimental C APIs.  fixes Feature #4328.

Sun Jul 10 12:18:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_power): support non-integral
	  exponent.  fixes [Bug #3271]

	* ext/bigdecimal/bigdecimal.c (rmpd_power_by_big_decimal): ditto.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_power_op): add a function to
	  only use for "**" operator.

	* test/bigdecimal/test_bigdecimal.rb: add a bunch of tests for the
	  above changes.

	* ext/bigdecimal/bigdecimal.c (is_integer): add an utility function.

	* ext/bigdecimal/bigdecimal.c (is_negative): ditto.

	* ext/bigdecimal/bigdecimal.c (is_positive): ditto.

	* ext/bigdecimal/bigdecimal.c (is_zero): ditto.

	* ext/bigdecimal/bigdecimal.c (is_one): ditto.

	* ext/bigdecimal/bigdecimal.c (is_even): ditto.

Sun Jul 10 12:08:39 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (when_vals): when a string literal is written on when
	  clause, skip string creation to make it faster.  [ruby-dev:44068]
	  [Feature #5000]

Sun Jul 10 11:35:29 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (reduce_nodes_gen): NODE_RETURN in rescue body must not be
	  reduced when there is an else clause.  This caused bizarre behavior
	  in [Bug #4473] [ruby-core:35629] [ruby-core:37884].

Sun Jul 10 09:46:14 2011  Masaya Tarui  <tarui@ruby-lnag.org>

	* range.c (range_max): fix behavior with excluded end value.
	  [Bug #4591]

Sun Jul 10 09:13:18 2011  Eric Hodel  <drbrain@segment7.net>

	* NEWS:  Fix RubyGems version.  [Ruby 1.9 - Bug #5004]

Sat Jul  9 20:01:59 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* internal.h: rb_rational_reciprocal is defined in rational.c.

Sat Jul  9 19:48:31 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* internal.h: added declarations.
	* complex.c: followed the above change.

Sat Jul  9 17:24:41 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* NEWS: bigdecimal is not a builtin.

Sat Jul  9 17:17:53 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: some improvements for performance.

Sat Jul  9 16:56:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* atomic.h (ATOMIC_OR): _InterlockedOr is unavailable in VC6.

	* numeric.c (ULLONG_MAX): fallback definition.

Sat Jul  9 15:59:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_{read,write}): should be signed.
	  Bug #5001

Sat Jul  9 14:02:20 2011  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/core.rb: fix multipart form parsing bug. [Bug #3866]

Sat Jul  9 11:41:03 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Add Vector#normalize [ruby-dev:43829]

Sat Jul  9 09:25:06 2011  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c:  Remove "enumeration sequenced by".
	  [Ruby 1.9 - Bug #4757]

Sat Jul  9 09:14:56 2011  Eric Hodel  <drbrain@segment7.net>

	* io.c:  Note that methods other than IO#gets may increase IO#lineno.
	  [Ruby 1.9 - Bug #4902]

Sat Jul  9 08:39:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RUN_OPT): disable gems.

Sat Jul  9 08:37:05 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_close): close(2) on a fd which is being read by
	  another thread causes deadlock on Mac OS X 10.5

Fri Jul  8 21:20:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: use USE_ELF instead of __ELF__ because Solaris
	  doesn't define it. USE_ELF is already provided by configure.
	  patched by Naohisa Goto. [ruby-dev:44066] [Bug #4998]

	* addr2line.h: ditto.

	* vm_dump.c: ditto.

Fri Jul  8 16:40:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/parser/parser.rl (convert_encoding): should not modify
	  the argument.

	* ext/json/parser/parser.rl (convert_encoding): no needs to use
	  force_encoding.

Fri Jul  8 15:53:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_bug): get rid of segfault after all threads
	  disposed.

Fri Jul  8 15:01:06 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl.h: include openssl/e_os2.h before checking the
	  definition of OPENSSL_SYS_WIN32.

Fri Jul  8 14:40:39 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (wunlink): reverted a part of r32426. it was mistakenly
	  mixed.

Fri Jul  8 14:29:47 2011  Narihiro Nakamura  <authornari@gmail.com>

	* configure.in: can't subtract void *.

Fri Jul  8 14:33:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (config.h): define GC_MARK_STACKFRAME_WORD.
	  fixed build problem of r32438.  the value (30) is temporary value.
	  maybe it's enough by 20~24 according to my observation.

Fri Jul  8 13:47:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_unlock_all): folded into
	  rb_threadptr_unlock_all_locking_mutexes.
	* thread.c (rb_threadptr_unlock_all_locking_mutexes) ditto.

Fri Jul  8 13:36:02 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_unlock_all_locking_mutexes): rename to
	  rb_threadptr_unlock_all_locking_mutexes and remove static.
	* vm_core.h: add rb_threadptr_unlock_all_locking_mutexes declaration.
	* thread.c (thread_start_func_2): adjust the above rename.

	* eval.c (ruby_cleanup): call rb_threadptr_unlock_all_locking_mutexes
	  again after finalizer. [Bug #4988] [ruby-dev:44049]

Fri Jul  8 13:06:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (FIBER_MACHINE_STACK_ALLOCATION_SIZE): Fiber stack size
	  don't need to keep multiple number of sizeof(VALUE).

Fri Jul  8 11:39:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (sudo-precheck): true command is not standard on
	  Windows.

Fri Jul  8 10:39:52 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_destroy): fix cond_t leak.

Fri Jul  8 09:17:59 2011  Eric Hodel  <drbrain@segment7.net>

	* gc.c:  Improve documentation

Thu Jul  7 23:35:31 2011  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: change water_mark value that may call
	  gc_mark(lev <= GC_LEVEL_MAX) in gc_mark().
	  In ruby_stack_check(), water_mark is a value that may call some
	  C function. Fixes Bug #3781

	* configure.in: define GC_MARK_STACKFRAME_WORD that approximate
	  size of gc_mark() and gc_mark_children() stackframes.

Thu Jul  7 17:55:05 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/testunit/test_parallel.rb (TestParallelWorker#teardown): wait
	  the child process even if the communication pipe is broken.

Thu Jul  7 15:44:42 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_enc_set_index, rb_enc_associate_index): should
	  check if frozen.

	* parse.y (rb_intern3), ruby.c (process_options, ruby_script):
	  defer freezing after associating encodings.

Thu Jul  7 15:16:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num2ull): use own switch sentence.
	  Current implementation can't convert 18446744073709551615.

Thu Jul  7 06:56:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (FIBER_STACK_FLAGS): workaround fix for r32420 on FreeBSD.

Thu Jul  7 06:46:12 2011  Eric Hodel  <drbrain@segment7.net>

	* benchmark/driver.rb:  Add difference column to report that averages
	  across all runs of a benchmark.  [Ruby 1.9 - Feature #4982]

Thu Jul  7 06:19:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems.rb:  Reduce requires to improve `make benchmark`.
	  [#4962]
	* lib/rubygems/specification.rb:  Delay initialization of rubygems
	  until require is called.

Thu Jul  7 04:31:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (arg): rescue_mod is in inverse order from other
	  modifiers.  patched by michael.j.edgar AT dartmouth.edu at
	  [ruby-core:36248].  fixed #4716.

Thu Jul  7 00:40:16 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (kill): check that the process exited or not before
	  terminating it. [Bug #4943]

Wed Jul  6 23:13:19 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (opt_call_args): allow trailing comma after assoc
	  argument e.g. 'foo(bar:1,)'.  fixed #3456

Wed Jul  6 22:11:12 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Validate date in
	  "Date:" header

Wed Jul  6 21:29:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): cleanup pointer arithmetic.
	  "size/sizeof(VALUE)" is ugly and easy confusing.
	* cont.c (fiber_initialize_machine_stack_context): ditto.

Wed Jul  6 21:24:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): fix mprotect misuse. A stack
	  guard page should have PROT_NONE.
	* cont.c (fiber_initialize_machine_stack_context):
	  th->machine_stack_maxsize shouldn't be included guard pages size.
	  [Bug #4983][ruby-dev:44043]

Wed Jul  6 21:23:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): use MAP_STACK if it's provided.

Wed Jul  6 21:22:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): use MAP_FAILED instead of -1.

Wed Jul  6 21:21:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_machine_stack_alloc): remove unnecessary cast.

Wed Jul  6 18:10:13 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Adding space after
	  comma.

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Remove variable
	  `now`. Suppress warning.

Wed Jul  6 12:18:09 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/cgi/test_cgi_header.rb(test_cgi_header_nph): Fix bug depends to
	  time. The test fails if time past 1 second in line 136-145

Tue Jul  5 15:28:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_here_document): should dispatch heredoc_end
	  scanner event on an empty here document.  fixed Bug#4543.

Tue Jul  5 13:49:26 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* addr2line.c: fix r32407 to check HAVE_ALLOCA_H.

Tue Jul  5 14:05:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httpauth/digestauth.rb (_authenticate):
	  Literal texts in HTTP ABNF is case-insensitive (RFC2616 2.1),
	  and a sample implementation in RFC2617 also ignores the case
	  of algorithms. So now this ignores those cases.
	  [ruby-dev:43965] [Feature #4936]

	* lib/webrick/httpauth/digestauth.rb (initialize):
	  Because of above, opera_hack is useless and removed.

Tue Jul  5 01:30:01 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread_pthread.c (native_sleep): cut the waiting time up to
	  100,000,000 because Solaris cond_timedwait() return EINVAL if an
	  argument is greater than current_time + 100,000,000.  This is
	  considered as a kind of spurious wakeup.  The caller to native_sleep
	  should care about spurious wakeup.

Tue Jul  5 01:24:26 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c: disable FIBER_USE_NATIVE on Solaris because resuming any
	  Fiber caused SEGV.  I haven't follow up the issue deeply, but it
	  works when disabling the feature.

Tue Jul  5 01:22:46 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* addr2line.c: include <alloca.h> to fix a build issue on Solaris.

Tue Jul  5 00:49:05 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/coverage/coverage.c: resurrect r32071 + add GC guard for
	  rb_coverages. [ruby-core:37352] [Bug #4927]
	  [ruby-core:36539] [Feature #4796]

	* test/coverage/test_coverage.rb resurrect r32071.

Mon Jul  4 22:24:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_stack): For NetBSD/FreeBSD, use
	  pthread_attr_getstack() if possible. and, remove an assumption
	  of stack growing direction.

Mon Jul  4 20:42:31 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/coverage/coverage.c: revert r32071.  The commit caused SEGV on
	  some minor nonfree OS.  I have no means of debugging the bug.  My
	  personal opinion is that such OS should be unsupported unless there
	  is an active maintainer.  [ruby-core:37352]

	* test/coverage/test_coverage.rb: ditto.

Mon Jul  4 07:14:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (get_stack): the return address of get_stack
	  must be the highest address of the current thread's stack.

Mon Jul  4 06:37:22 2011  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/intern.h, thread_pthread.c (rb_reserved_fd_p,
	  RB_RESERVED_FD_P): added.  This C API is to limit to access
	  fds which are used by RubyVM internal.  In this version of
	  CRuby, return 1 if fd is communication pipe.
	  If your application needs to close all file descriptors to
	  present resource leak, skip internal fds using this C API.
	  We also define a macro RB_RESERVED_FD_P(fd).  So you can write
	    #ifndef RB_RESERVED_FD_P
	    #define RB_RESERVED_FD_P(fd) 0
	    #endif
	  for Ruby 1.9.2 or previous version to write compatible extensions.
	  See [ruby-core:37727]

	* thread_win32.c (rb_reserved_fd_p): added (return 0 for any fds).

	* io.c (rb_io_initialize): raise ArgumentError if given fd is reserved by Ruby.

Sun Jul  3 23:43:56 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/extmk.rb (extmake): suppresses outputs from extconf.rb.
	  (extmake) warns a failure in extconf.rb.

Sun Jul  3 13:44:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_reject_bang): should not remove elements which are
	  not yielded.  [Bug #2545]

Sun Jul  3 06:10:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_stack): pthread_attr_getstack() doesn't
	  return stack start address, but stack base address. Thus,
	  we need to add stack size for getting stack start address.
	  And, we don't have to decrease guard size twice.
	* thread_pthread.c (thread_start_func_1): don't use inaccurate
	  stack start guess if native_thread_init_stack() can be used.
	  [Bug #1813] [ruby-core:24540]

Sun Jul  3 04:50:08 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_stack): add to a care of guard page on Mac
	  OS X. [Bug #1813] [ruby-core:24540]
	* signal.c (ruby_signal): SIGBUS use alternative stack too.
	* signal.c (sigbus): On Mac, thread stack overflow makes SIGBUS
	  instead of SIGSEGV. thus, added stackoverflow check.
	* signal.c (default_handler): get rid of compilation warning.
	* signal.c (Init_signal): ditto.

Sat Jul 02 08:59:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_ocsp.rb
	* test/openssl/test_x509_cert.rb: Perform SHA-256 tests only if
	  supported by the available OpenSSL version. Versions < 0.9.8 don't
	  support it. [ruby-core:37724]

Sat Jul  2 07:17:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_reject_bang, rb_ary_delete_if): rejected
	  elements should be removed.  fixed [Bug #2545]

Sat Jul  2 01:57:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: remove a description of Kernel#respond_to? because it has
	  been reverted at revision 28564.

Sat Jul  2 00:58:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: describe a change of multiplication of Bignum.

Fri Jul  1 18:52:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_app_erb.rb: increase loop count. too short
	  measurement time makes less accuracy.
	* benchmark/bm_app_factorial.rb: ditto.
	* benchmark/bm_app_mandelbrot.rb: ditto.
	* benchmark/bm_app_strconcat.rb: ditto.

	* benchmark/bm_io_file_create.rb: ditto.
	* benchmark/bm_io_file_read.rb: ditto.
	* benchmark/bm_io_file_write.rb: ditto.

	* benchmark/bm_so_concatenate.rb: ditto.
	* benchmark/bm_so_lists.rb: ditto.
	* benchmark/bm_so_matrix.rb: ditto.
	* benchmark/bm_so_random.rb: ditto.
	* benchmark/bm_so_sieve.rb: ditto.

	* benchmark/bm_vm_thread_mutex1.rb: ditto.
	* benchmark/bm_vm_thread_mutex2.rb: ditto.
	* benchmark/bm_vm_thread_mutex3.rb: ditto.

	* benchmark/bm_vm1_block.rb: cleanup.
	* benchmark/bm_vm1_const.rb: cleanup.
	* benchmark/bm_vm1_ensure.rb: cleanup.
	* benchmark/bm_vm1_ivar.rb: cleanup.
	* benchmark/bm_vm1_length.rb: cleanup.
	* benchmark/bm_vm1_neq.rb: cleanup.
	* benchmark/bm_vm1_not.rb: cleanup.
	* benchmark/bm_vm1_rescue.rb: cleanup.
	* benchmark/bm_vm1_simplereturn.rb: cleanup.
	* benchmark/bm_vm1_swap.rb: cleanup.

	* benchmark/bm_vm2_array.rb: cleanup.
	* benchmark/bm_vm2_case.rb: cleanup.
	* benchmark/bm_vm2_defined_method.rb: cleanup.
	* benchmark/bm_vm2_eval.rb: cleanup.
	* benchmark/bm_vm2_method.rb: cleanup.
	* benchmark/bm_vm2_mutex.rb: cleanup.
	* benchmark/bm_vm2_poly_method.rb: cleanup.
	* benchmark/bm_vm2_poly_method_ov.rb: cleanup.
	* benchmark/bm_vm2_proc.rb: cleanup.
	* benchmark/bm_vm2_regexp.rb: cleanup.
	* benchmark/bm_vm2_send.rb: cleanup.
	* benchmark/bm_vm2_super.rb: cleanup.
	* benchmark/bm_vm2_unif1.rb: cleanup.
	* benchmark/bm_vm2_zsuper.rb: cleanup.

	* benchmark/bm_vm_thread_alive_check1.rb: cleanup.

Fri Jul  1 15:23:00 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix: Add LUP decomposition

Fri Jul  1 15:21:14 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Allow non integer exponents for Matrix#**

Fri Jul  1 15:13:25 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix: Add Eigenvalue Decomposition

Fri Jul  1 15:10:22 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix: Add Matrix#round

Fri Jul  1 11:41:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_trans): free heap ptr when the str is not embedded.
	  patched by Eric Wong. [Bug #4956] [ruby-core:37708]

Fri Jul  1 11:07:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): fix memory leak.
	  Patch by Eric Wong. Thank you! [Bug #4953] [ruby-core:37702]

Fri Jul  1 08:21:28 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_getivar): check vm state version
	  to invalidate inline cache (ivar index).
	  fixes Bug #4926.

	* vm_insnhelper.c (vm_setivar): ditto.

Fri Jul  1 08:03:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c, thread_pthread.c (WRITE_CONST): suppress warnings
	  `ignoring return value'.

Fri Jul  1 06:41:36 2011  Koichi Sasada  <ko1@atdot.net>

	* thread.c (rb_threadptr_check_signal): only wake up main thread.

	* thread.c (rb_threadptr_execute_interrupts_common): check signal
	  delivery if it is main thread.
	  fixes [ruby-dev:44005] [Ruby 1.9 - Bug #4950]

	* bootstraptest/test_fork.rb: add a test for above.

	* signal.c (rb_get_next_signal): skip if signal_buff is empty.
	  (check signal_buff.size first)

	* vm_core.h: remove unused variable rb_thread_t::exec_signal.

	* thread.c (rb_thread_check_trap_pending): check
	  rb_signal_buff_size() because rb_thread_t::exec_signal
	  is no longer available.

Fri Jul  1 03:28:25 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* class.c (Init_class_hierarchy): should name BasicObject
	  explicitly.

	* variable.c (rb_const_defined_0): should not check for
	  superclasses as const_get.

Fri Jul  1 03:24:03 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: mathn is still alive (should die soon).

Thu Jun 30 23:50:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* misc/ruby-mode.el (ruby-indent-beg-re): Fix broken regular
	  expression.  Fixes #4546

Thu Jun 30 23:43:30 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl.c/.h: Added ossl_x509_name_sk2ary.
	* ext/openssl/ossl.c: Replaced ossl_x509_ary2k by generic macro to
	  simplify future conversions.
	* ext/openssl/ossl_ssl.c: Implement SSLSocket#client_ca.
	* test/openssl/test_ssl.rb: Add test for SSLSocket#client_ca.
	  Thanks to Ippei Obayashi for providing the patch!
	  [ Ruby 1.9 - Feature #4481 ] [ruby-core:35461]

Thu Jun 30 22:38:58 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm2_defined_method.rb: added to measure performance of
	  bmethod (method defined by define_method()).

Thu Jun 30 22:17:04 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.c (vm_call_bmethod): fix to hook call/return event
	  for methods defined by define_method().  fixes Bug #4613.

	* thread.c (call_trace_proc): Fix to skip if class is not given (0).
	  Note that ID and Class object are passed for call/return event
	  if the called method was defined by define_method().
	  If you are author of tracer/profiler/debugger, this may be an
	  important change.  You should check passed class as zero or
	  non-zero instead of checking the event type.

	* test/ruby/test_settracefunc.rb: add a test for above.

Thu Jun 30 21:18:35 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* configure.in: Add warnflags for XL/C on AIX during configure
	  to avoid [Bug #3971]. See [ruby-core:32859]

Thu Jun 30 21:16:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (m_ajd): refers a constant.

Thu Jun 30 20:54:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	  * ext/io/console/io-console.gemspec: spin-off gem for 1.9.2.

Thu Jun 30 20:36:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: trivial changes.

Thu Jun 30 20:12:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_module.rb: tests for [Bug #3422] and [Bug #3423].

Thu Jun 30 20:03:39 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified doc.

Thu Jun 30 19:09:19 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (thread_timer): ignore unknown errno.
	  (we observed that select(2) was canceled by errno=514 on
	  boron == Linux/Xen environment)

Thu Jun 30 17:33:25 2011  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (ObjectSpace.count_tdata_objects):
	  Fix rdoc.  Fixes Bug #3892.

	* ext/objspace/objspace.c (ObjectSpace.count_tdata_objects):
	  Change key type if the klass of a object is zero (internal object).
	  Read rdoc for details.

	* internal.h: export rb_objspace_data_type_name().

Thu Jun 30 17:25:08 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (ping_signal_thread_list, thread_timer):
	  fix to keep polling state if there are any ping-tasks.

Thu Jun 30 12:25:34 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (rb_thread_create_timer_thread): allocate
	  machine stack for the timer thread at least 12KB.  FreeBSD 8.2
	  AMD64 causes machine stack overflow (SIGSEGV) only with
	  PTHREAD_STACK_MIN (maybe defined as 2KB).

Thu Jun 30 09:36:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/weakref.rb:  Attach documentation to WeakRef and add missing
	  documentation

Thu Jun 30 09:30:14 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/yaml.rb:  Document toplevel YAML and YAML::ENGINE to describe
	  Psych vs Syck engines.

Thu Jun 30 09:21:52 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Hide handle_no_method_error from RDoc.
	* error.c:  Document or hide undocumented error classes.

Thu Jun 30 07:49:04 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c:  Document ENV

Thu Jun 30 06:37:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): ensure RUBYLIB_PREFIX stored
	  before RUBYLIB, even if MANGLED_PATH is enabled.  fixed #1679.
	  MANGLED_PATH is disabled by the default and will be removed
	  completely in the future.

Thu Jun 30 06:32:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/drb/drb.rb:  Hide deprecated toplevel DRb constants.

Thu Jun 30 06:17:02 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/cmath.rb (CMath.log): second argument: b can be nil.

Thu Jun 30 06:23:28 2011  Eric Hodel  <drbrain@segment7.net>

	* thread.c (ruby_thread_s_pass):  Fix typo.

Thu Jun 30 06:16:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 3.8 which contains fixes for documentation
	  in trunk.

Thu Jun 30 02:53:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_threadptr_execute_interrupts_common): remove
	  meaningless native_thread_yield(). It never close a race.

Thu Jun 30 02:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_limits): minor optimization.
	  eliminate machine context saving when running time is enough small.

Thu Jun 30 02:28:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_rec): move interrupt_flag check to
	  rb_thread_schedule().
	  And also rename to rb_thread_schedule_limits() and remove
	  sched_depth argument. It's no longer called recursive.
	* thread.c (rb_thread_schedule): add to check interrupt_flag as
	  above explained.

	* thread.c (rb_threadptr_execute_interrupts_rec): rename to
	  rb_threadptr_execute_interrupts_common() and remove sched_depth
	  argument. It's no longer called recursive.

	* thread.c (rb_thread_sleep): adapt the renaming.
	* thread.c (rb_threadptr_execute_interrupts): ditto.
	* thread.c (rb_thread_execute_interrupts): ditto.

Thu Jun 30 01:31:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_s_pass): change RDoc description and remove
	  a sample code. The actual implementation never behave as explained by
	  an example. It's a documentation bug.

Thu Jun 30 00:54:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_stop): change RDoc sample code. The old
	  example is buggy and may cause deadlock. The patch is
	  suggested by Heesob Park <phasis@gmail.com>. Thank you!
	  [Bug #3606][ruby-core:31454]

Thu Jun 30 00:49:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_wakeup): change RDoc sample code. The old
	  example is buggy and may not display anything by a race.
	  The patch is suggested by Heesob Park <phasis@gmail.com>.
	  Thank you! [Bug #3606][ruby-core:31454]

Thu Jun 30 00:43:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_run): change RDoc. The old example is buggy
	  and may cause deadlock. The patch is suggested by Heesob Park
	  <phasis@gmail.com>. Thank you! [Bug #3606][ruby-core:31454]

Thu Jun 30 00:30:15 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/cmath.rb: make same exception for Math. fix [Bug #3137].

Thu Jun 30 00:03:20 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/completion.rb: complement correctly string literal. fix
	  [Bug #1145].

Wed Jun 29 23:42:51 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: avoided using timev.
	* ext/date/date_strftime.c: ditto.
	* ext/date/date_tmx.h: ditto.

Wed Jun 29 23:17:57 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/openssl/ossl.h (OPENSSL_SYS_WIN32): support for mingw(msys).

Wed Jun 29 23:09:14 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ext/tk/extconf.rb (intptr_t, uintptr_t): support for the latest ActiveTcl with mingw.

Wed Jun 29 22:49:10 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/cmd/help.rb: support RDoc 3.7. fix [Bug #3760].

Wed Jun 29 22:04:14 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/tracer.rb: Tracer.on only if required by -r command-line option.
	  and consider --disable-gems option.
	* test/test_tracer.rb: add tests for it.

Wed Jun 29 13:55:36 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* variable.c (rb_const_get_0): should not look for superclasses if
	  the second optional argument is given for #const_get().
	  fix [Bug #3422] [Bug #3423]

Wed Jun 29 12:07:27 2011  Eric Hodel  <drbrain@segment7.net>

	* math.c:  Attach documentation for Math.
	* object.c:  Document NIL, TRUE, FALSE.
	* io.c:  Improve grammar in ARGF comment.  Document STDIN/OUT/ERR.
	  Document ARGF global constant.
	* lib/rake:  Hide deprecated toplevel constants from RDoc (import from
	  rake trunk).
	* lib/thwait.rb:  Document ThWait.
	* lib/mathn.rb:  Hide Math redefinition from RDoc
	* lib/sync.rb:  Add a basic comment for Sync_m, Synchronizer_m, Sync,
	  Synchronizer.
	* parse.y:  Document SCRIPT_LINES__.
	* hash.c:  Document ENV class and global constant.
	* vm.c:  Document TOPLEVEL_BINDING.
	* version.c:  Document RUBY_* constants.
	* ruby.c:  Document DATA and ARGV.

Wed Jun 29 10:13:12 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Matrix.zero can build rectangular matrices.
	  Vector#r should be called #magnitude

Wed Jun 29 10:11:08 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Add Matrix#diagonal?, hermitian?, normal?,
	  orthogonal?
	  permutation?, symmetric?, {lower|upper}triangular?, unitary?, zero?

Wed Jun 29 10:09:35 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Specialize Matrix#find_index to return [row, col]
	  and accept the same optional argument as #each

Wed Jun 29 10:07:32 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Matrix#each{_with_index} can iterate over a subset
	  of the Matrix

Wed Jun 29 06:21:02 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_stop_timer_thread): skip to close
	  communication pipe to avoid timing bug (process termination timing).
	  The communication pipe will closed by OS.

Wed Jun 29 06:09:54 2011  Koichi Sasada  <ko1@atdot.net>

	* error.c (rb_async_bug_errno): async-safe bug report function.
	  In timer thread, signal handler should use it.
	  The patch is contributed by Eric Wong <normalperson@yhbt.net>.
	  Refs: [ruby-core:37644] and [ruby-core:37647]

	* thread_pthread.c: use rb_async_bug_errno().
	  And replace all fprintf() to write().

	* internal.h (rb_async_bug_errno): add decl. of above func.

Tue Jun 28 23:46:08 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/tracer.rb: count only non-internal libraries in stack trace,
	  ignoring custom_require.

Tue Jun 28 21:44:58 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/ruby-lex.rb: recognize '\char' in ruby statement.

Tue Jun 28 20:39:29 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/debug.rb (var_list): Command 'var *' did not work on 1.9(!).
	  global_variables, local_variables, and instance_variables returns
	  Symbols from 1.9 and need to stringify before evaling it.
	  See #4931.

Tue Jun 28 19:23:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c: Now, USE_TRAP_SIGMASK depend on HAVE_PTHREAD_SIGMASK.
	  The code have already depended on pthread_sigmask since r27464.

Tue Jun 28 15:09:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/benchmark.rb: merge eregon/benchmark.
	  https://github.com/eregon/ruby/tree/benchmark
	  patched by Benoit Daloze. [ruby-core:37593] [Bug #4940]

	* lib/benchmark (Benchmark#bmbm): bmbm should be consistent with bm
	  for the return value.

	* test/benchmark: remove preemptive test instead of skipping
	  I removed the preemptive test I wrote for Feature #4197.
	  I'll add it back when the implementation will be able to satisfy it.

	* lib/benchmark (Benchmark#bmbm): remove useless explicit call,
	  #format is an alias of #to_s test/benchmark: add a test for
	  format of long time.

	* lib/benchmark: fix label width: always add 1 to ensure there is a
	  space delimiter even with times over 100s
	  When I asked for Feature #4197, I wanted to make delimiting spaces
	  consistent for #bm and #bmbm.
	  But with times over 100s, the output contains no space between the
	  label and the first time (user).
	  Now both ensure there is always a space, even if that means 3 spaces
	  with times under 10s (because it is formatted as %10.6f)

	* test/benchmark: let labels be a constant
	  lib/benchmark (Benchmark#realtime): avoid creating an unused Proc
	  lib/benchmark (Benchmark#benchmark): use ensure clause to restore
	  STDOUT.sync, as in #bmbm

Tue Jun 28 13:41:51 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (native_stop_timer_thread): fixed commit miss of
	  r32244.  grep sources before changing the signature of a function.

Tue Jun 28 11:49:14 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (consume_communication_pipe):
	  Make "buff" as static.  (Maybe) "buff" can be shared between
	  any caller (any threads) because no one use the read values.
	  "buff" (1024 byte) on stack may cause stack overflow on
	  several environment (we found a crash on FreeBSD).
	  And remove const value "buff_size", and define CCP_READ_BUFF_SIZE
	  macro.

Tue Jun 28 11:45:30 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake:  Update rake to fix some bugs and hide deprecated features
	  from RDoc.
	* lib/rake/version.rb:  Bump version to 0.9.2.1 to distinguish it from
	  the released version.
	* NEWS:  ditto

Tue Jun 28 11:17:28 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 3.7 (final)
	* NEWS:  ditto

Tue Jun 28 10:18:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (rb_daemon): fix wrong #endif position.

Tue Jun 28 07:50:32 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c (Init_Object):  Teach RDoc what Init_class_hierarchy does to
	  hook up ri for BasicObject, Object, Module and Class.

Tue Jun 28 05:03:32 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* thread.c (rb_thread_local_aref): RDoc fix. Thread#[] example
	  had a race. See #4480.

Tue Jun 28 01:22:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigMath_s_log): move BigMath.log from
	  bigdecimal/math.rb.

	* ext/bigdecimal/lib/bigdecimal/math.rb: ditto.

	* test/bigdecimal/test_bigdecimal.rb: move test for BigMath.log from
	  test/bigdecimal/test_bigmath.rb.

	* test/bigdecimal/test_bigmath.rb: ditto.

Tue Jun 28 01:19:52 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/ruby-lex.rb: fix [Bug #4232].

Tue Jun 28 00:14:13 2011  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb: fix [Bug #4409]. add DRbServer#here?.

	* test/drb/test_drb.rb: ditto.

	* test/drb/drbtest.rb: ditto.

	* test/drb/ut_eq.rb: ditto.

Tue Jun 28 00:08:43 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/workspace.rb: fix BUG#4793.

Mon Jun 27 22:06:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (consume_communication_pipe): don't use C99
	  style variable length array.

Mon Jun 27 22:04:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (consume_communication_pipe): change return
	  type to void. caller doesn't use it.

Mon Jun 27 21:29:50 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.h (rb_global_vm_lock_struct): add volatile to
	  gvl->waiting. now thread_timer() access it w/o lock.

Mon Jun 27 21:16:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: s/__gvl_acquire/gvl_acquire_common/ and
	  s/__gvl_release/gvl_release_common/.

Mon Jun 27 11:41:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (rb_thread_create_timer_thread):
	  the type of return value of write(2) is ssize_t.

Mon Jun 27 09:57:02 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (rb_thread_create_timer_thread):
	  Fixes missing initialization of oflags.

Mon Jun 27 09:07:42 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c: Stop polling in the timer thread when there are
	  no waiting thread.  If there are 2 or more runnable threads,
	  the timer thread does polling.  Avoid polling makes power save
	  for several computers (0.2W per a Ruby process, when I measured).
	  If outside-event such as signal or Thread#kill was occurred
	  when the timer thread does not do polling, then wake-up
	  the timer thread using communication-pipe (the timer thread
	  waits this communication-pipe with select(2)).
	  The discussion about this modification can be found from the post
	  [ruby-core:33456] and other related posts.
	  Note that Eric Wong and KOSAKI Motohiro give us the huge
	  contributions for this modification.  Thanks.

	* thread_pthread.c (rb_thread_wakeup_timer_thread): add a function.
	  This function wakes up the timer thread using communication-pipe.

	* thread.c (rb_thread_stop_timer_thread): add a parameter which
	  specify closing communication-pipe or not.

	* thread.c (rb_thread_terminate_all): do not stop timer thread here
	  (ruby_cleanup() terminate timer thread).

	* signal.c: wake up timer thread using
	  rb_thread_wakeup_timer_thread() from signal handler.

	* eval.c (ruby_cleanup): use rb_thread_stop_timer_thread(1).

	* process.c: use rb_thread_stop_timer_thread(0)
	  (reuse communication-pipe).

	* thread_win32.c (rb_thread_wakeup_timer_thread): add a dummy
	  function.

	* vm_core.h: add and fix decl. of functions.

Mon Jun 27 08:01:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: should use ALLOCA_N.

Mon Jun 27 01:34:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/etc/test_etc.rb (TestEtc#test_get{pw,gr}nam): skip entries
	  start with + sign, which means NIS.  these are returned in the
	  case that passwd and group entries in /etc/nsswitch.conf are set
	  to use "nis" explicitly on Debian.  fixed #3683

Mon Jun 27 00:44:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (rb_parser_end_seen_p): fix documentation about return
	  value. patched by Sho Hashimoto. [Bug #4511]

Mon Jun 27 00:40:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* hash.c (rb_hash_reject): add documentation that Hash#reject
	  without block returns enumerator.
	  patched by Michael Edgar [Bug #4847] [ruby-core:36800]

Sun Jun 26 23:49:21 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_switch_hitter.rb: added a test.

 Sun Jun 26 22:21:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: refactoring.

Sun Jun 26 18:03:30 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* parse.y: comma at the end of line is no longer allowed.
	  A patch from Yukihiro Matsumoto  <matz AT ruby-lang.org>.
	  (fixed #3456).

Sun Jun 26 13:35:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_dump.c (rb_vm_bugreport): change CrashReporter suggestion messages
	  on Mac. It should be placed after "-- C level backtrace" line.
	  Suggested by Endoh-san.

	  <before>
	  -- See Crash Report log file under ~/Library/Logs/CrashReporter or ---------
	  -- /Library/Logs/CrashReporter, for the more detail of ---------------------
	  -- C level backtrace information -------------------------------------------

	<after>
	  -- C level backtrace information -------------------------------------------

	     See Crash Report log file under ~/Library/Logs/CrashReporter or
	     /Library/Logs/CrashReporter, for the more detail of.

Sun Jun 26 10:08:28 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/extconf.rb
	* ext/openssl/ossl_missing.h/.c: add ASN1_put_eoc if missing.

	* ext/openssl/ossl_asn1.c: introduce ossl_asn1_object_size and
	  ossl_asn1_put_object to wrap functionality depending on OpenSSL
	  version in use.
	  Fixes	[ Ruby 1.9 - Bug #4916 ] reported by Hiroshi Nakamura.
	  [ruby-core:37286]

Sun Jun 26 01:00:15 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_strftime_internal): removed meaningless braces.
	* ext/date/date_core.c (gengo): the value should be int.

Sat Jun 25 23:45:30 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_insnhelper.c (vm_search_superclass): avoid control frame
	  stack overrun. currently super() in Proc created in a method
	  defined by Module#define_method raise NoMethodError. [Bug #4881]
	* test/ruby/test_method.rb t_super_in_proc_from_define_method):
	  add test for it.

Sat Jun 25 23:23:14 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (sleep_forever): now Kernel#sleep don't wakeup by
	  signal handler execution. [Bug #4072]

Sat Jun 25 23:14:47 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (rb_threadptr_check_signal): remove unnecessary th->status
	  backup. fix race condition which may results unexpected main thread's
	  status transition. see #4072

Fri Jun 24 19:57:30 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/webrick/httprequest.rb (setup_forwarded_info): Parsing request
	  header failed when the request is from 2 or more Apache reverse
	  proxies. It's said that all X-Forwarded-* headers will contain more
	  than one (comma-separated) value if the original request already
	  contained one of these headers.  Since we could use these values as
	  Host header, we choose the initial(first) value. See #4922.

	* test/webrick/test_httprequest.rb (test_forwarded): Test it.

Fri Jun 24 17:06:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_daemon): should not start timer thread
	  twice.  fixed Bug#4920.

Fri Jun 24 15:54:14 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_shutdown): Try to shutdown SSL
	  connection more gracefully. Call SSL_shutdown() max 4 times until it
	  returns 1 (success). Bi-directional SSL close has several states but
	  SSL_shutdown() kicks only 1 transition per call. Max 4 is from
	  mod_ssl.c of Apache httpd that says 'max 2x pending + 2x data = 4'.
	  See #4237.

Fri Jun 24 07:24:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake/version.rb:  Fixed VERSION to work with tool/rbinstall.rb
	* bin/rake:  Import bin/rake from 0.9.2
	* tool/rbinstall.rb (install):  Rake::VERSION is now in
	  lib/rake/version.rb.  Fixes `make install`

Fri Jun 24 07:11:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake: Import Rake 0.9.2

Fri Jun 24 00:44:15 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (c_valid_{julian,gregorian}_p): fixed the range of month.

Fri Jun 24 00:14:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: trivial changes on text.

Thu Jun 23 22:46:57 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_x509name.c: Add X509::Name#hash_old as a wrapper
	  for X509_NAME_hash_old in OpenSSL 1.0.0. See #4805

	* test/openssl/test_x509name.rb (test_hash): Make test pass with
	  OpenSSL 1.0.0.

	* NEWS: Add it.

Thu Jun 23 19:30:53 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_set_time): Check
	  argument type with NUM2LONG if the arg is not a Time object.
	  See #4919.

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_set_timeout): Check
	  type with NUM2LONG. Time as an arg is not allowed. See #4919.

	* test/openssl/test_ssl_session.rb (test_session_time,
	  test_session_timeout): Test it.

Wed Jun 23 13:30:30 2011  Shota Fukumori  <sorah@tubusu.net>

	* signal.c(ruby_atomic_exchange): Fix definition style.

Wed Jun 22 22:34:05 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_sslctx_session_new_cb): Return 0 to
	  OpenSSL from the callback for SSL_CTX_sess_set_get_cb().
	  Returning 0 means to OpenSSL that the session is still valid
	  (since we created Ruby Session object) and was not freed by us with
	  SSL_SESSION_free(). Call SSLContext#remove_session(sess) in
	  session_get_cb block if you don't want OpenSSL to cache the session
	  internally.
	  This potential issue was pointed by Ippei Obayashi. See #4416.

	* test/openssl/test_ssl_session.rb (test_ctx_server_session_cb): Test
	  it.

Wed Jun 22 22:21:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ssl_session.c: Respect T_BIGNUM time values. Patch by
	  Tomoyuki Chikanaga.
	  [ Ruby 1.9 - Bug #4919 ] [ruby-dev:43869]

Wed Jun 22 21:29:25 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/depend (SOCK_HEADERS): use $(top_srcdir) instead of
	  $(topdir). sorry!

Wed Jun 22 19:47:03 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (cont_capture): add volatile.
	  On clang -O, it is needed to avoid the optimization.
	  With this and llvm/clang's recent fix, clang 3.0 can
	  build ruby-trunk with -O option.

	* cont.c (cont_capture): use for-loop.

	* array.c (rb_ary_each): add volatile and use it.

	* vm_insnhelper.c (vm_call_cfunc): ditto.

Wed Jun 22 18:20:46 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_sslctx_session_remove_cb):
	  OpenSSL::SSL::SSLContext#session_remove_cb was broken. It wrongly
	  tried to call the session_*new*_cb callback.

	* test/openssl/test_ssl_session.rb (class OpenSSL): Test it.

Wed Jun 22 17:37:49 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl.h: Introduced OSSL_BIO_reset macro for PEM/DER
	  fallback scenarios.

	* ext/openssl/ossl_pkey_dsa.c
	* ext/openssl/ossl_x509req.c
	* ext/openssl/ossl_pkey_rsa.c
	* ext/openssl/ossl_pkey_ec.c
	* ext/openssl/ossl_ssl_session.c
	* ext/openssl/ossl_x509crl.c
	* ext/openssl/ossl_pkey.c
	* ext/openssl/ossl_pkey_dh.c
	* ext/openssl/ossl_x509cert.c
	* ext/openssl/ossl_pkcs7.c: Use OSSL_BIO_reset.

	* ext/openssl/ossl_ssl.c
	* ext/openssl/ossl_cipher.c
	* ext/openssl/ossl_pkey_ec.c
	* ext/openssl/ossl_pkcs12.c
	* ext/openssl/ossl_ssl_session.c: Replace rb_raise occurrences by
	  ossl_raise. This automatically flushes OpenSSL's error queue.

	* ext/openssl/ossl_pkcs7.c: Raise error if DER fallback for parsing
	  fails.

	* test/openssl/test_pkey_ec.rb
	* test/openssl/test_pkey_dsa.rb
	* test/openssl/test_pkey_rsa.rb: Add assertions that OpenSSL.errors is
	  empty.

	* test/openssl/test_pkey_rsa.rb: Remove initial OpenSSL.errors call in
	  test_new.
	  [ Ruby 1.9 - Bug #4885 ] [ruby-core:37134]

Wed Jun 22 15:01:24 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ssl.c: Use SSL_MODE_RELEASE_BUFFERS if available.
	  Thanks, Eric Wong, for providing the patch.
	  [ Ruby 1.9 - Feature #4672 ] [ruby-core:36127]

Wed Jun 22 14:47:53 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_buffering.rb
	* test/openssl/test_pkcs12.rb: Inherit from Test::Unit::TestCase
	  instead of MiniTest::Unit::TestCase. [ruby-core:37275]

Wed Jun 22 12:41:03 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl_session.c (ossl_ssl_session_to_der):
	  OpenSSL::SSL::Session#to_der was broken. Fix buffer handling.

	* test/openssl/test_ssl_session.rb (test_session): Test it.

Wed Jun 22 12:38:52 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/openssl/test_ssl_session.rb: Split out SSL::Session related
	  tests from test_ssl.rb

Wed Jun 22 03:20:52 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Fix cyclic references of
	  objects.  Thanks to CvX for reporting the bug and a test case.
	* test/psych/test_object.rb: test for cyclic object references.

Wed Jun 22 02:39:54 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP.post_form): Do not ignore query part of
	  the given URI to post. See #655.

	* test/net/http/test_http.rb, test/net/http/utils.rb: Test it.

Wed Jun 22 01:28:13 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/openssl/test_x509store.rb (test_set_errors): Redhat is
	  distributing a patched version of OpenSSL that allows multiple CRL
	  for a key (multi-crl.patch.) Make test pass on such env. See #4122,
	  #4554.

Tue Jun 21 21:50:37 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/webrick/httpresponse.rb (HTTPResponse#setup_header): Close
	  HTTP/1.1 connection when returning an IO object as response body
	  without setting HTTPResponse#chunked to true. See #855 no.1.

	* test/webrick/test_httpserver.rb: Test it.

Tue Jun 21 21:27:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* internal.h: move rb_thread_io_blocking_region() declaration
	  from intern.h to internal.h. It's still experimental API and
	  need more discussion. [ruby-dev:43698]
	* include/ruby/intern.h: ditto.

	* ext/socket/rubysocket.h: include internal.h.
	* ext/socket/depend: add internal.h dependency.
	* ext/socket/extconf.rb: add $INCFLAGS to topdir.

Tue Jun 21 20:38:47 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (datetime_s_*): canonicalize 24 o'clock.

Tue Jun 21 19:46:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_thread.rb (TestThread#test_priority): enable
	  this test again. Current GVL respect thread priority rather
	  than past.

Tue Jun 21 13:25:35 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (readline_getc): applied a patch in
	  #3827 by by Akio Tajima <artonx AT yahoo.co.jp>. (see #3827)

Tue Jun 21 13:16:31 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: fixed bug, specify --disable-libedit
	  then disable libedit, does not specify then check readline and
	  libedit if failed checking readline. (fixes #3375)

Mon Jun 20 22:52:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec): use sig_do_nothing instead of SIG_DFL
	  for avoiding a race.
	* process.c (sig_do_nothing): new function.

Mon Jun 20 21:31:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (thread_timer): rename timeout_10ms to
	  time_quantum. it's no longer 10ms.

Mon Jun 20 18:46:02 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_cipher.c, ext/openssl/lib/openssl/cipher.rb:
	  Documentation fix by Ippei Obayashi. See #4419.

Mon Jun 20 15:41:33 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/webrick/cookie.rb (WEBrick::Cookie.parse): Revert r31228.
	  r31228 was for allowing the 'Cookie:' header which did not have no
	  SP after ';' for separating cookie-pairs but RFC6265 requires single
	  SP after ';' there.  We allow multiple SPs here for compatibility
	  with older WEBrick version.

	* test/webrick/test_cookie.rb: Test it.

Sun Jun 19 13:31:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* NEWS: Introduce --hide-skip on test/unit.

Sun Jun 19 10:05:16 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Override Test::Unit::TestCase#on_parallel_worker?
	  only when $0 == __FILE__.

	* lib/test/unit/parallel.rb: Run Test::Unit::Worker.run only when
	  $0 == __FILE__.

Sat Jun 18 23:59:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fill_cbuf): finish reading at EOF, and the readconv has
	  been cleared by another thread while io_fillbuf() is waiting at
	  select().  a patch in [ruby-core:37197] by Hiroshi Shirosaki
	  <h.shirosaki AT gmail.com>.  fixed #3840

Sat Jun 18 21:36:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: remove GVL_DEBUG

Sat Jun 18 21:32:02 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm.c, vm_core.h (rb_vm_stack_to_heap): remove const.
	  It makes compilations warnings.

Sat Jun 18 18:54:15 2011  Koichi Sasada  <ko1@atdot.net>

	* vm.c, vm_core.h (rb_vm_stack_to_heap): fix "const" place.

Sat Jun 18 17:23:38 2011  Tanaka Akira  <akr@fsij.org>

	* eval.c, hash.c, load.c, proc.c, range.c, thread.c, time.c: don't
	  declare internal functions.

	* internal.h, vm_core.h: declare internal functions.

	* array.c: include internal.h.

	* common.mk: update dependency for array.o.

Sat Jun 18 13:39:33 2011  Tanaka Akira  <akr@fsij.org>

	* internal.h: declarations declared in include/ruby/*.h removed.

Sat Jun 18 12:42:17 2011  Tanaka Akira  <akr@fsij.org>

	* method.h, internal.h iseq.h: declare internal functions.

	* compile.c, eval.c, iseq.c, object.c, parse.y, proc.c, process.c,
	  thread.c, vm.c, vm_eval.c, vm_insnhelper.c, vm_method.c: don't
	  declare internal functions.

	  Note that rb_method_entry_eq() is defined in vm_method.c but
	  there was a declaration in proc.c with different const-ness.
	  Now it is declared in method.h with same const-ness to the
	  definition.

	* object.c (rb_mod_module_exec): don't declare functions declared in
	  include/ruby/intern.h.

Sat Jun 18 12:05:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/backward/classext.h: for evil gems.  fixed #4803

Sat Jun 18 11:12:13 2011  Tanaka Akira  <akr@fsij.org>

	* common.mk: update dependencies.

Sat Jun 18 11:09:03 2011  Tanaka Akira  <akr@fsij.org>

	* io.c: suppress warnings.

Sat Jun 18 10:22:39 2011  Tanaka Akira  <akr@fsij.org>

	* internal.h: declare more internal functions.

	* iseq.h (rb_method_get_iseq): declared.

	* compile.c, eval.c, eval_error.c, iseq.c, parse.y, proc.c, range.c,
	  ruby.c, time.c, util.c, vm.c: don't declare internal functions.

	* eval.c, parse.y, thread_pthread.c: non-existing function declarations
	  removed.

Sat Jun 18 08:12:54 2011  Tanaka Akira  <akr@fsij.org>

	* common.mk: dependencies updated.

	* tool/update-deps: new file to assist update dependencies in
	  common.mk.

Sat Jun 18 07:27:27 2011  Tanaka Akira  <akr@fsij.org>

	* internal.h: declare internal functions here.

	* node.h: declare NODE dependent internal functions here.

	* iseq.h: declare rb_iseq_t dependent internal functions here.

	* vm_core.h: declare rb_thread_t dependent internal functions here.

	* bignum.c, class.c, compile.c, complex.c, cont.c, dir.c, encoding.c,
	  enumerator.c, error.c, eval.c, file.c, gc.c, hash.c, inits.c, io.c,
	  iseq.c, load.c, marshal.c, math.c, numeric.c, object.c, parse.y,
	  proc.c, process.c, range.c, rational.c, re.c, ruby.c, string.c,
	  thread.c, time.c, transcode.c, variable.c, vm.c,
	  tool/compile_prelude.rb: don't declare internal functions declared
	  in above headers.  include above headers if required.

	  Note that rb_thread_mark() was declared as
	  void rb_thread_mark(rb_thread_t *th) in cont.c but defined as
	  void rb_thread_mark(void *ptr) in vm.c.  Now it is declared as
	  the later in internal.h.

Sat Jun 18 02:36:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (VpNewRbClass): fix type of the 2nd
	  argument.

	* ext/bigdecimal/bigdecimal.h: ditto.

Sat Jun 18 02:30:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigMath_s_exp): move BigMath.exp from
	  bigdecimal/math.rb.

	* ext/bigdecimal/lib/bigdecimal/math.rb: ditto.

	* test/bigdecimal/test_bigdecimal.rb: move test for BigMath.exp from
	  test/bigdecimal/test_bigmath.rb.

	* test/bigdecimal/test_bigmath.rb: ditto.

Sat Jun 18 00:20:54 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: do not define wnum[01].

Fri Jun 17 18:57:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* compile.c (iseq_compile_each): fix return value of obj[a,*b]=c.

Fri Jun 17 13:09:45 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Clean up documentation.

Fri Jun 17 09:25:14 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Document curses constants.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4880]

Fri Jun 17 09:11:05 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c:  Document Module#method_added and #method_removed.
	  Patch by Bryce Kerley.  [Ruby 1.9 - Feature #4867]

Fri Jun 17 08:50:16 2011  Eric Hodel  <drbrain@segment7.net>

	* io.c:  Improve documentation of IO and File open and new.
	  Patch by Roger Pack.  [Ruby 1.9 - Bug #4790]

Fri Jun 17 07:53:50 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/csv.rb:  Document #raw_encoding.  Patch by David Czarnecki.
	  [Ruby 1.9 - Bug #4874]

Fri Jun 17 07:46:50 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Document Benchmark::Tms#memberwise.  Patch by
	  David Czarnecki.  [Ruby 1.9 - Bug #4873]

Fri Jun 17 07:38:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/prettyprint.rb:  Improve documentation.  Patch by Ysiad
	  Ferreiras.  [#4834]

Fri Jun 17 07:23:03 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c (rb_ary_drop):  Improve documentation.  Patch by Caley Woods.
	  [Ruby 1.9 - Bug #4858]

Fri Jun 17 06:11:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/log.rb:  Improve documentation of BasicLog and Log.
	  Patch by Olivier Brisse.  [Ruby 1.9 - Bug #4833]
	* lib/webrick/httpstatus.rb:  Improve documentation of
	  WEBrick::HTTPStatus.  Patch by Olivier Brisse.
	  [Ruby 1.9 - Bug #4833]

Fri Jun 17 04:48:22 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c, thread_pthread.h: remove unused variables.
	  (native_thread_data_t::gvl_cond, native_thread_data_t::gvl_next)

Thu Jun 16 14:32:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* time.c (rb_time_new): prevent overflow by "* 1000".

Fri Jun 17 03:07:36 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm4_thread_create_join.rb,
	  benchmark/bm_vm4_thread_mutex[1-3].rb: renamed to
	  bm_thread_* (fix last rename).

Fri Jun 17 02:26:47 2011  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_thread_create): fix debug message.
	  (add last newline)

Thu Jun 16 23:40:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_rec): fix {UN,}LIKELY macro misuse.
	* gc.c (rb_newobj): ditto.
	* vm_insnhelper.c (vm_method_search): ditto.

Thu Jun 16 20:06:15 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb: Fix Regexp for test.

	* test/testunit/tests_for_parallel/test_third.rb: Use
	  Test::Unit::TestCase#on_parallel_worker? for detecting worker.

	* lib/test/unit/testcase.rb(Test::Unit::TestCase#on_parallel_worker?):
	  New Method Test::Unit::TestCase#on_parallel_worker? returns true
	  when a testcase is running on parallel worker.
	* lib/test/unit/parallel.rb(Test::Unit::TestCase#on_parallel_worker?):
	  ditto.

Thu Jun 16 19:27:12 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/test_securerandom.rb: Add testcase.  This testcase does NOT aim
	  to test cryptographically strongness and randomness.  It includes
	  the test for PID recycle issue of OpenSSL described in #4579 but
	  it's disabled by default.

Thu Jun 16 17:55:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (TestIO#test_copy_stream_socket): fix
	  test hanging up issue. Patch by CHIKANAGA Tomoyuki.

Thu Jun 16 15:17:39 2011  Eric Hodel  <drbrain@segment7.net>

	* variable.c (const_missing):  Add simple example of const_missing.
	  Patch by Anuj Dutta.  [Ruby 1.9 - Bug #4794]

Thu Jun 16 15:09:29 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/monitor.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4823]

Thu Jun 16 14:54:09 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/utils.rb: Document WEBrick::Utils.  Patch by Olivier
	  Brisse.  [Ruby 1.9 - Bug #4819]

Thu Jun 16 14:26:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpservlet/erbhandler.rb:  Allow the ERB document to
	  alter the content-type of the response.  [Ruby 1.9 - Bug #4685]

Thu Jun 16 14:15:47 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb: Clarify timeout duration types.  Patch by Alf Mikula.
	  [Ruby 1.9 - Bug #4791]
	* lib/net/http.rb: ditto

Thu Jun 16 13:25:25 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc*:  Import RDoc 3.7 release candidate

Thu Jun 16 11:35:09 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (search_response): parses SEARCH responses from
	  the Yahoo IMAP server correctly.  patched by Mark Nadig.  [Bug #4509]

Thu Jun 16 09:12:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* fix for build on solaris 10.

Thu Jun 16 09:08:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/io/console/test_io_console.rb (TestIO_Console#test_sync):
	  fix for daemon process.

Thu Jun 16 07:58:01 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb(test_ignore_tzero): Test for r32109.

	* test/testunit/tests_for_parallel/test_third.rb: Use another way to
	  detect that test is running on worker. This fixes sometimes
	  TestParallel failing.

Thu Jun 16 07:20:06 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Runner#_run_parallel): Ignore -j0
	  because it makes blocking forever by IO.select.

Thu Jun 16 03:08:11 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/testunit/test_parallel.rb (TestParallel::TestParallelWorker#
	  setup): now can run on Windows, probably.

	* test/testunit/test_parallel.rb (TestParallel::TestParallel#setup):
	  ditto.

Thu Jun 16 03:00:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (do_select): Windows: no need to poll if select(2) is
	  cancelable.

	* thread_win32.c (native_fd_select): new function to make select(2)
	  cancelable.

	* thread_win32.c (rb_w32_check_interrupt): new function for checking
	  interrupt.

	* win32/win32.c (rb_w32_select_with_thread): new function. cancelable
	  select(2).

	* win32/win32.c (rb_w32_select): use above function internally.

Wed Jun 15 23:30:45 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* gc.c: fix a regression by r31690 on AIX because AIX malloc
	  return NULL if it's passed 0. But some caller don't expect it.
	  patch by Yutaka Kanemoto. [ruby-dev:43779]
	(vm_malloc_prepare): return calculated size.
	(vm_xmalloc): use above result.
	(vm_xcalloc): ditto.

Wed Jun 15 23:11:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c: remove BLOCKING_REGION_CORE() macro. It's no longer used
	  since r32022.

Wed Jun 15 21:00:47 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_config.rb: execute based on the existence of the
	  OpenSSL module.

Wed Jun 15 12:35:11 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io.rb (test_copy_stream_socket): wait a child process
	  before SIGUSR1 handler is removed.

	* test/pathname/test_pathname.rb (define_assertion): use line number
	  for test method names.

Wed Jun 15 10:37:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (rb_stat_rdev): use DEVT2NUM.

	* file.c (rb_stat_rdev_major): ditto.

	* file.c (rb_stat_rdev_minor): ditto.

Wed Jun 15 05:12:59 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c (lib_eventloop_core): revert the last change (it's
	  the part for ruby_1_8), and use rb_thread_check_ints() when RUBY_VM
	  is defined.

Wed Jun 15 04:42:47 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm3_thread_*.rb: renamed bm_vm3_thread_*.rb to
	  benchmark/bm_vm_thread_*.rb.

Wed Jun 15 04:28:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_thread_pass.rb: rename bm_vm4* to
	  bm_vm_thread_*. suggested by ko1.
	* benchmark/bm_vm4_pipe.rb: ditto.
	* benchmark/bm_vm4_alive_check1.rb: ditto.
	* benchmark/bm_vm4_pass_flood.rb: ditto.

Wed Jun 15 03:52:50 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pass_flood.rb: new benchmark for GVL fairness.
	* benchmark/bm_vm4_alive_check1.rb: ditto.

Wed Jun 15 01:27:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_yield): fix live lock issue on 1-2 cpus
	  system. It's additional fix for r32021.
	* thread_pthread.c (gvl_init): add switch_wait_cond.
	* thread_pthread.h (typedef struct rb_global_vm_lock_struct): ditto.

Tue Jun 14 23:16:22 2011  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (show_progress): refine verbose mode.
	  (exec_test): ditto.

Tue Jun 14 23:02:36 2011  Tanaka Akira  <akr@fsij.org>

	* bootstraptest/runner.rb (show_progress): extracted from assert_check.
	  (assert_check): use show_progress.
	  (assert_normal_exit): ditto.
	  (assert_finish): ditto.
	  (flunk): ditto.

Tue Jun 14 22:51:42 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_*.rb: added tests.

Tue Jun 14 22:09:58 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: renamed some functions.
	* ext/date/date_core.c: modified doc.

Tue Jun 14 21:26:01 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (cont_save_thread): add new utility function.
	  rb_context_t::saved_thread.machine_stack_start and
	  machine_stack_end should be cleared immediately after a snapshot of
	  current thread is stored to saved_thread. [ruby-dev:43680] [Bug #4855]
	  this change aims to get rid of unnecessary GC mark at machine stack.

Tue Jun 14 19:50:49 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_autoload.rb: remove temporary directory.

Tue Jun 14 11:05:03 2011  Narihiro Nakamura  <narihiro@netlab.jp>

	* gc.c (rb_gc_set_params): call initial_expand_heap if
	  initial_heap_min_slots is set.

Tue Jun 14 11:02:08 2011  Narihiro Nakamura  <narihiro@netlab.jp>

	* gc.c: use size_t.

Tue Jun 14 01:10:38 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* test/coverage/test_coverage.rb: add a test for restart.  a patch
	  from Xavier Shay.  [ruby-core:36745]

Tue Jun 14 01:05:10 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* ext/coverage/coverage.c: make it restartable.  [ruby-core:36539]

Mon Jun 13 23:55:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_schedule_rec): call gvl_yield() unconditionally.
	* thread_pthread.c: remove HAVE_GVL_YIELD macro.
	* thread_win32.c (gvl_yield): new. this fallback logic was moved from
	  rb_thread_schedule_rec().

Mon Jun 13 23:50:25 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/io/console/console.c (console_dev): typo.

Mon Jun 13 23:38:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_parse_string): flush delayed token.  based on a
	  patch by Masaya Tarui in [ruby-dev:43762].  Bug #4544

	* parse.y (yylex): revert r24557.  delayed token at the end of
	  string should be flushed already by the above change.

Mon Jun 13 23:33:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_dev): console should be
	  unbuffered.

	* ext/io/console/console.c (console_dev): take care of no-ctty
	  case.

Mon Jun 13 23:06:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: rewrite GVL completely. This fix improve some
	  benchmark dramatically (e.g. vm3_thread_mutex result changed
	  form 120.601sec to 3.426sec).
	* thread_win32.c: ditto.
	* thread_pthread.h: ditto.
	* vm_core.h: ditto.
	* thread.c: ditto.

Mon Jun 13 23:11:52 2011  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_unix.rb: don't use Thread.abort_on_exception.

Mon Jun 13 23:05:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/unixsocket.c (unix_send_io): race condition fixed.
	  (unix_recv_io): ditto.
	  fixed by Eric Wong.  [ruby-core:35574]

	* test/socket/test_unix.rb: test added for above problem.

Mon Jun 13 21:41:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_win32.c (native_cond_signal): remove unnecessary rb_bug().
	  It's additional fix for r32021. [Bug #4696]

Mon Jun 13 20:50:49 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_ec.rb
	  test/openssl/test_pkey_ec.rb: merge both files into test_pkey_ec.rb.
	  Removed redundant group instantiation from PKey tests.
	* test/openssl/utils.rb: only create TEST_PKEY_EC_P256V1 if EC is
	  defined.

Mon Jun 13 20:28:24 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/digest.rb: remove MDC2 from test, it is not available
	  by default in an OpenSSL installation.

Mon Jun 13 20:18:55 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h, vm_insnhelper.h: move decl. of
	  ruby_vm_global_state_version and related macros
	  from vm_core.h to vm_insnhelper.h.

	* vm.c (vm_clear_all_cache): added.  This function is called
	  when ruby_vm_global_state_version overflows.
	  TODO: vm_clear_all_inline_method_cache() is only place holder.
	        We need to implement it ASAP.

	* vm_method.c (vm_clear_global_method_cache): added.

Mon Jun 13 19:46:21 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/cmath.rb: add new method Object#real?. fix #3137

Mon Jun 13 18:52:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (is_kind_of_BigDecimal): new function to
	  examine the whether the object is kind of BigDecimal.

Mon Jun 13 18:49:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimalCmp): use GetVpValueWithPrec
	  for Float and Rational arguments.

	* test/bigdecimal/test_bigdecimal.rb (test_new, test_cmp, test_power):
	  add and modify tests for the above change.

	* ext/bigdecimal/bigdecimal.c (BigDecimalCmp): modify coding style to
	  match ruby's standard.

Mon Jun 13 18:33:04 2011  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb (SecureRandom.random_bytes): modify PRNG state
	  to prevent random number sequence repetition at forked child
	  process which has same pid.
	  reported by Eric Wong.  [ruby-core:35765]

Mon Jun 13 17:02:34 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP#use_ssl?): require 'openssl' only when
	  https is needed. fixes r31933.

Mon Jun 13 14:35:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* lib/cmath.rb (CMath.cbrt): returns the principal value of the cube
	  root of the argument.  fix #3676

	* test/test_cmath.rb (test_cbrt_returns_principal_value_of_cube_root):
	  test for the above change.

Mon Jun 13 14:17:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* lib/test/unit.rb (Test::Unit::GlobOption#non_options): fix typo.

Mon Jun 13 13:04:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: fix error for digests that have no oid
	(e.g. DSS1).
	* test/openssl/test_digest.c: add tests for this.

Mon Jun 13 12:51:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/yaml.rb: load psych only when syck is not loaded.

Mon Jun 13 12:23:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

Mon Jun 13 12:23:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/psych/lib/psych/deprecated.rb (Object#to_yaml_properties):
	  undef to_yaml_properties before redefine it.

	* ext/syck/lib/syck/rubytypes.rb: ditto.

Mon Jun 13 11:30:10 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: allow Digests to be created by sn, ln or
	  oid.
	* test/openssl/test_digest.rb: add tests for this.
	  [Ruby 1.9 - Feature #4412] [ruby-core:35319]

Mon Jun 13 10:54:03 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/pkey_dh.c: corrected documentation.
	* test/openssl/utils.rb: add test key for DH.
	* test/openssl/test_pkey_dh.rb: add tests.

Mon Jun 13 10:13:08 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/pkey_dh.c: clarify difference between DH#public_key and
	DH#pub_key in documentation.

Mon Jun 13 05:50:43 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS: introduce PKey.read.

Mon Jun 13 05:17:29 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey.c: added PKey.read module function that allows
	  reading arbitrary public/private keys from DER-/PEM-encoded File or
	  string instances.
	* ext/openssl/ossl_pkey_dh.c: improved documentation.
	* test/openssl/utils.rb: added EC test key.
	* test/openssl/test_pkey_rsa.rb
	  test/openssl/test_pkey_dsa.rb: Test PKey.read. Reuse keys from
	  OpenSSL::TestUtils.
	* test/openssl/test_pkey_ec.rb: Created test file for EC tests.
	  Test PKey.read.
	  [Ruby 1.9 - Feature #4424] [ruby-core:35330]

Mon Jun 13 04:42:24 2011  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (total_i): fix to skip no ruby objects.

Mon Jun 13 03:07:38 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/benchmark/test_benchmark.rb (capture_output):
	  replace '-' as space. On NetBSD, subtract between two Process.times
	  after and before the short process may return negative value like:
	  t0=Process.times; yield; t1=Process.times; p t1.utime-t0.utime

Mon Jun 13 02:40:23 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Test for DSA#syssign/sysverify.

Mon Jun 13 01:59:19 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dh.c: completed documentation.
	* ext/openssl/ossl_pkey_dsa.c: corrected examples. Improved parameter
	  sections.

Mon Jun 13 00:25:10 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dsa.c: completed documentation.

Sun Jun 12 23:36:46 2011  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* lib/drb/drb.rb (kill_sub_thread): remove the method. [ruby-core:34185]

Sun Jun 12 21:01:56 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (d_lite_marshal_load): should give converted value.

Sun Jun 12 20:36:30 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: edited doc.

Sun Jun 12 18:12:07 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm3_clearmethodcache.rb: added.

Sun Jun 12 17:40:29 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_method.c (rb_clear_cache*): update only vm state version.

	* vm_method.c (rb_method_entry_get_without_cache, rb_method_entry):
	  Fill method cache entry with vm state version, and
	  check current vm state version for method (cache) look up.
	  This modification speed-up invalidating of global method cache table.
	  [Ruby 1.9 - Feature #3905] [ruby-core:36908]

Sun Jun 12 16:19:48 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: fail on Mac OS X. [Bug #4853][ruby-dev:43655]

Sun Jun 12 15:56:08 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c: remove th->transition_for_lock. It's thread unsafe.
	  [Bug #4723][ruby-dev:43563]

Sun Jun 12 15:47:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c: introduce spurious wakeup safe deadlock check.
	  [Bug #4696][ruby-dev:43554]

Sun Jun 12 13:33:52 2011  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_vm3_thread_mutex.rb: remove it.

	* benchmark/bm_vm3_thread_mutex[1-3].rb: added 3 benchmarks.
	    1: one thread with one mutex (no contention).
	    2: two threads with one mutex (contention).
	    3: 1000 threads with one mutex (huge number of contention)
	  Above removed benchmark was type 3.
	  Therefore, this commit adds type 1 and 2 benchmark.

Sun Jun 12 11:16:59 2011  Tanaka Akira  <akr@fsij.org>

	* io.c: use select() appropriately for sendfile().
	  Fixed by Eric Wong.  [ruby-core:36150]
	  (maygvl_copy_stream_wait_readwrite): removed.
	  (nogvl_copy_stream_sendfile): use nogvl_copy_stream_wait_write and
	  maygvl_copy_stream_wait_read instead of
	  maygvl_copy_stream_wait_readwrite.

Sun Jun 12 09:32:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* atomic.h (ATOMIC_OR): _InterlockedOr is not available on mingw.h
	* gc.c (rb_gc_set_params): VM_OBJSPACE is disabled on mingw.

Sun Jun 12 01:07:09 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: edited doc.

Sat Jun 11 23:18:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (RUBY_VM_SET_TIMER_INTERRUPT, RUBY_VM_SET_INTERRUPT,
	  RUBY_VM_SET_FINALIZER_INTERRUPT): use atomic ops for preventing
	  interrupt_flag bit lost. [Bug #4770][ruby-dev:43467]
	* thread.c (rb_threadptr_execute_interrupts_rec): ditto.
	* vm_core.h (typedef struct rb_thread_struct): change type of
	  interrupt_flag to rb_atomic_t.
	* atomic.h: move atomic ops definition from signal.c.
	* signal.c: remove atomic ops definition.
	* common.mk (gc, signal, thread, cont): add to dependency to atomic.h.

Sat Jun 11 23:23:52 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: edited doc.

Sat Jun 11 23:02:36 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/buffering.rb (module OpenSSL):
	  Buffering#each_byte should return String in accordance with IO in
	  1.9.

	* test/openssl/test_buffering.rb (class OpenSSL): add tests for getc
	  and each_byte.

Sat Jun 11 22:41:37 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* time.c: a correction of doc for strftime (%v).

Sat Jun 11 22:30:53 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replaced doc for strftime based on Time's one.

Sat Jun 11 22:07:56 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (datetime_s_{iso8601,rfc3339,xmlschema,rfc2822,httpdate}):
	  do not take argument comp.

Sat Jun 11 21:58:31 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: added examples.

Sat Jun 11 19:40:45 2011  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: expand heap if initial_heap_min_slots is bigger than
	  HEAP_MIN_SLOTS.

Sat Jun 11 19:42:50 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* ChangeLog (vim): set shiftwidth to 2.

Sat Jun 11 19:27:06 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_x509req.c: raise RequestError instead of
	  CertificateError when Request#to_der gets an error from OpenSSL.
	  Patch from Ippei Obayashi, see #4420. I cannot write a test for
	  this... Request does not allow to create broken bytes...

Sat Jun 11 19:34:51 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (Date::(ABBR_)?(MONTH|DAY)NAMES): should be usascii.

Sat Jun 11 19:24:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: rewrote doc.

Sat Jun 11 19:04:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GlobOption#non_options): should run
	  with 1.8.

Sat Jun 11 18:05:57 2011  WATANABE Hirofumi  <eban@ruby-lang.org>

	* bootstraptest/runner.rb: should initialize $stress to avoid warnings.

Sat Jun 11 18:02:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_getc): should be 7bit if ascii.  fixes #4557

Sat Jun 11 16:52:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (rb_enc_uint_chr): fix message format. Bug#4869

Sat Jun 11 16:28:25 2011  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/formatters/pretty.rb
	  (REXML::Formatters::Pretty#write_text),
	  test/rexml/test_core.rb
	  (Tester#test_pretty_format_long_text_finite): don't ignore
	  'width' parameter in pretty formatter. fixes #4498
	  Reported by Michael Frasca. Thanks!!!

Sat Jun 11 16:11:36 2011  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb
	  (Tester#test_pretty_format_long_text_finite): remove needless
	  assert_nothing_raised.

Sat Jun 11 16:04:03 2011  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/parsers/xpathparser.rb
	  (REXML::Parsers::XPathParser#parse),
	  test/rexml/test_elements.rb
	  (ElementsTester#test_each_with_frozen_condition):
	  don't modify original XPath. fixes #4161
	  Reported by Pavel Shved. Thanks!!!

Sat Jun 11 15:53:27 2011  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_elements.rb (ElementsTester): remove needless
	  prefix from test name.

Sat Jun 11 15:36:36 2011  Martin Duerst  <duerst@it.aoyama.ac.jp>
	* common.mk: fixed a grammatical error

Sat Jun 11 14:20:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm.c (thread_memsize): don't ignore size of th->local_storage.

Sat Jun 11 10:32:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: should quote arch_hdrdir and libpath for the case
	  installed prefix contains spaces.

Sat Jun 11 10:20:52 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (native_cond_timeout): wrap conditionally used
	  label.

	* thread_pthread.c (native_sleep): remove unused variable.

Sat Jun 11 10:15:50 2011  Tanaka Akira  <akr@fsij.org>

	* thread.c (rb_thread_execute_interrupts): use GetThreadPtr to extract
	  rb_thread_t from VALUE.
	  reported by Motohiro KOSAKI.  [ruby-dev:43700]

Sat Jun 11 10:00:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_process_options): add missing return type.

Fri Jun 10 23:18:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/tk/tcltklib.c (lib_eventloop_core): replace CHECK_INTS with
	  rb_thread_check_ints(). Because current code can't be compiled.

Fri Jun 10 16:38:13 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_locale_charmap): When ruby process is run as Windows
	  Service the console codepage is not set, GetConsoleCP returns 0.
	  So on such environment, use GetACP().
	  http://blogs.msdn.com/b/michkap/archive/2005/02/08/369197.aspx
	  patched by Rafal Bigaj [ruby-core:36832] [Bug #4854]

Fri Jun 10 14:34:24 2011  Koichi Sasada  <ko1@atdot.net>

	* common.mk: restore TESTRUN_SCRIPT to "$(srcdir)/test.rb".
	  TESTRUN_SCRIPT is used by "make run", "make gdb" and so on.

Fri Jun 10 13:01:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_module.rb (TestModule#remove_rake_mixins): remove all
	  module related to Rake.

Fri Jun 10 09:52:38 2011  Eric Hodel  <drbrain@segment7.net>

	* encoding.c:  Mention that Encoding.compatible? can work with more
	  than just Strings.

Fri Jun 10 02:25:53 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: updating version to match released gem.

Fri Jun 10 01:06:29 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/bigdecimal (BigDecimal_to_i): Integer#** may return flonum.

Fri Jun 10 00:35:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (string_to_c_internal): uses rb_reg_nth_match;
	* rational.c (string_to_r_internal): ditto.

Fri Jun 10 00:25:03 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c: remove an unused declaration.

Fri Jun 10 00:24:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* rational.c (string_to_r): Rational#** may return flonum.

Thu Jun  9 23:57:53 2011  Tanaka Akira  <akr@fsij.org>

	* io.c: fix IO.copy_stream interrupt handling.
	  based on the patch by Eric Wong.  [ruby-core:36156]

	* vm_core.h (rb_thread_call_with_gvl): don't declare here.

	* thread.c: include internal.h.
	  (rb_thread_execute_interrupts): new function.

	* internal.h (rb_thread_execute_interrupts): declared.
	  (rb_thread_call_with_gvl): declared.

Thu Jun  9 23:34:01 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (rb_objspace_call_finalizer): use rb_typeddata_is_kind_of() for
	  type check to get rid of a double free when main Thread has singleton
	  class. [ruby-core:36741] [Bug #4828]
	* thread.c (rb_obj_is_mutex): add a new utility function.
	* vm.c (rb_obj_is_thread): ditto.

Thu Jun  9 22:53:49 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_thread.rb (TestThread#test_kill_thread_subclass):
	  add test for Thread.kill with Thread subclass instance.

Thu Jun  9 22:31:47 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_thread.rb (TestThread#test_kill_wrong_argument):
	  test for [ruby-core:35086].
	  partially forward porting r31402 from ruby_1_9_2 branch.

Thu Jun  9 18:36:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* string.c: Fix the ambiguous description of the behavior of
	  rb_str_aref_m with a range.  It returns nil when the beginning of
	  the range is greater than the end of the string rather than the range.

Thu Jun  9 10:57:03 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Hash subclasses can be read
	  from YAML files.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Hash subclasses can be
	  dumped to YAML files.
	* test/psych/test_hash.rb: corresponding test.

Thu Jun  9 09:18:51 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Ruby modules can be loaded
	  from YAML files.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Ruby modules can be
	  dumped to YAML files.
	* test/psych/test_class.rb: corresponding test.

Thu Jun  9 09:05:04 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Ruby classes can be loaded
	  from YAML files.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Ruby classes can be
	  dumped to YAML files.
	* test/psych/test_class.rb: corresponding test.

Wed Jun  8 21:38:57 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (root_fiber_alloc): set root fiber's status RUNNING.
	  in cont_mark() only RUNNING fiber's machine stack is marked.
	  root fiber's status should be RUNNING at the beginning regardless of
	  FIBER_USE_NATIVE. [ruby-core:36735] fixes #4827

Tue Jun  7 20:50:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* doc/irb/irb.rd: fix typo. patch by Nobuhiro IMAI.
	  [Bug #4843] [ruby-dev:43639]
	* doc/irb/irb.rd.ja: ditto.
	* doc/ChangeLog-YARV: ditto.

Tue Jun  7 18:52:55 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rubygems/user_interaction.rb (Gem::StreamUI#tty?): IO#tty? of
	  Windows has been fixed at r29969.

	* test/rubygems/test_gem_stream_ui.rb: now can run tests.

Tue Jun  7 18:36:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rubygems/test_gem.rb (TestGem#{test_self_user_home_userprofile,
	  test_self_user_home_user_drive_and_path}): should simply ignore
	  meaningless tests instead of skipping them.

Tue Jun  7 18:15:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  should show some messages when skipping tests.

Tue Jun  7 13:59:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (date_s_today, datetime_s_now): check the
	  result of localtime_r().

Tue Jun  7 13:36:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/extconf.rb: use $defs not $CPPFLAGS to get rid of
	  command line escape issues on Windows.  fixed #4835.

Tue Jun  7 03:18:45 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_io.rb (TestIO#test_s_{,bin}write): do not create a
	  file under /tmp. [Bug #4846]

Mon Jun  6 22:51:43 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c: use #if FIBER_USE_NATIVE instead of #ifdef.
	  you can suppress use of setcontext for Fiber with compile option
	  -DFIBER_USE_NATIVE=0

Mon Jun  6 21:59:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_switch_hitter.rb: added a test.

Mon Jun  6 21:37:45 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: added notes.

Mon Jun  6 21:02:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: flattened format to strftimev.
	* ext/date/date_core.c (date_strftime_internal): taints run.

Mon Jun  6 15:10:17 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/{defines,missing}.h (rb_infinity, rb_nan): move from
	  defines.h to missing.h.  (couldn't use RUBY_EXTERN there.)

Mon Jun  6 14:35:48 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_markup_pre_process.rb (TestRDocMarkupPreProcess#
	  {test_include_file,test_include_file_encoding_incompatible}): no
	  need to write such workaround.  don't hide the bug of ruby. (and the
	  bug is already fixed.)

Mon Jun  6 14:11:11 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/date/date_core.c (valid_jd_sub): need to convert from VALUE to
	  double.

	* ext/date/date_core.c (offset_to_sec): get rid of a compiler warning.

Mon Jun  6 14:09:08 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/defines.h (rb_infinity, rb_nan): export for Windows.

Mon Jun  6 10:54:45 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Runner#puke):
	  Add overriding from MiniTest::Unit#puke. This reverts minitest's fix
	  that skip messages are hidden when not verbose mode (-v option).
	  To hide skip messages, use --hide-skip option instead.

Mon Jun  6 10:52:13 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: don't use autoload.

Mon Jun  6 09:39:43 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): release event objects to plug memory
	leak.  Thanks Mark J. Titorenko!

Sun Jun  5 23:26:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* eval.c: remove rb_thread_stop_timer_thread function declaration.
	  Instead, include vm_core.h.
	* process.c: ditto.

Sun Jun  5 21:38:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (thread_timer): add to care a spurious wakeup.
	  When native_cond_timedwait() return 0 by spurious wakeup, we
	  don't have to neither 1) call timer_thread_function and 2)
	  exit the timer thread.

Sun Jun  5 17:50:01 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (m_real_cwyear): new.  derived from m_cwyear.
	* ext/date/date_strftime.c: trivial changes.

Sun Jun  5 17:22:01 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/config_list.in: add new options for tcltklib.

Sun Jun  5 10:06:50 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_tmx.h: now does not place decoded data.  allows to
	  access indirectly via functions on demand.
	* ext/date/date_strftime.c: ditto.
	* ext/date/date_core.c: ditto.
	* ext/date/date_core.c ({d|dt}_lite_to_s): use strftime.

Sun Jun  5 06:22:02 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* NEWS: wrote about changes of date.

Sat Jun  4 16:59:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (d_lite_inspect): changed the format.
	* ext/date/date_core.c: refactoring and fixing some bugs.

Sat Jun  4 04:04:41 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rubygems/test_gem_commands_which_command.rb:
	  "missing" exists on ruby's top source directory. [Bug #4815]

Fri Jun  3 21:48:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rubygems/test_case.rb: Refix for test-all in separate directory.
	  r31147 + r31151.

Fri Jun  3 20:58:47 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/date/date_core.c (d_lite_plus): get rid of compiler warnings.

Fri Jun  3 20:56:40 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/missing.h, numeric.c (round): moved prototype of round()
	  from numeric.c to missing.h.  (note: round() is C99 feature, so ruby
	  provides it if not exist in C runtime.)

Fri Jun  3 20:42:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Keep $stdin, $stdout before run testcase
	  and restore after run. Because some test break $stdin, $stdout.
	  Fixes [Bug #4433] [ruby-core:35353]

Fri Jun  3 19:58:14 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_fflush): windows -- call fsync() only when the FD is tied to
	  file, because if the FD is pipe, it blocks.

Fri Jun  3 09:27:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (URI::HTTP#request_uri): return nil when the uri
	  is path-rootless form. Bug #4759

Thu Jun  2 23:51:03 2011  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Improve the line ending detection algorithm
	  patch by Alexey).

Thu Jun  2 20:05:57 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_s_write, rb_io_s_binwrite): return!!!

Thu Jun  2 16:29:34 2011  Shota Fukumori  <sorah@tubusu.net>

	* io.c: Add File.write, File.binwrite. [Feature #1081] [ruby-core:21701]

	* test/ruby/test_io.rb: Test for File.write, File.binwrite.

	* NEWS: News for above.

Thu Jun  2 12:33:09 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_fflush, rb_io_flush): need to fsync() when ruby calls
	  internal flush. [ruby-core:36670] [Bug #4813]

Thu Jun  2 07:56:24 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/tcltklib.c: reduce CPU power required by an eventloop.

Tue May 31 21:28:33 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring):
	  redirect stderr to null device.

Thu Jun  2 00:45:26 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/extconf.rb: fix for uninitialized global variables.
	  [Ruby 1.9 - Bug #4811]

Wed Jun  1 21:57:08 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_sleep): fix 1000times calculation error.
	  this is a regression since r31457. [Bug #4808] [ruby-dev:43606]

Wed Jun  1 17:19:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: remove unused macro.

Wed Jun  1 15:42:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (peek_n): new macro to see next nth char.

Wed Jun  1 15:40:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): fix for rubygems change.

Wed Jun  1 14:07:57 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*: Imported minitest 2.2.2 (r6281)
	* test/minitest/*: ditto

Wed Jun  1 12:35:50 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.8.5 (released @ 137c80f)
	* test/rubygems: Ditto

Wed Jun  1 12:34:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: add new features of bigdecimal.

Wed Jun  1 09:41:14 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi/util.rb:  Improve documentation.  Patch by Kuba Fietkiewicz.
	  [Ruby 1.9 - Bug #4775]
	* lib/cgi/core.rb:  ditto

Wed Jun  1 09:26:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Improve documentation and attach it to Numeric.
	  Modified from patch by Anil V.  [Ruby 1.9 - Bug #4762]

Wed Jun  1 09:21:30 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/prime.rb:  Indent examples enough to appear as code sections.
	  Note that Prime is Enumerable.  [#4762]

Wed Jun  1 07:34:57 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c (key_i):  Change rdoc from "the first occurrence" to "an
	  occurrence" since first occurrence is not a specification of
	  Hash#key.  [Ruby 1.9 - Bug #4760]

Wed Jun  1 07:26:19 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/pty/pty.c (pty_check):  Restore "not reached" comment.
	  [Ruby 1.9 - Bug #4756]

Wed Jun  1 07:21:40 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Fix document-method declarations for set_sync and
	  set_comment.  [Ruby 1.9 - Bug #4695]

Wed Jun  1 06:43:13 2011  Masaya Tarui  <tarui@ruby-lang.org>

	* load.c (loaded_feature_path): cut nonsense loop execution to fix
	  performance bug.

Wed Jun  1 01:16:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_mix_module): implement Module#mix.

Wed Jun  1 01:15:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_encoding_set): should honor already set ecflags since it
	  might be set by mode option.  fixed #4804

Wed Jun  1 00:34:04 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): remove unused
	  variable.

Wed Jun  1 00:32:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): support instantiation from
	  a Float through Rational.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_new): ditto.

	* test/bigdecimal/test_bigdecimal.rb (test_global_new_float): add a test for
	  the above changes.

	* test/bigdecimal/test_bigdecimal.rb (test_new_with_float): ditto.

Wed Jun  1 00:07:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_coerce): support coerce with a
	  Rational.  The precision used for instantiate a BigDecimal from the
	  given Rational is obtained from the receiver BigDecimal.

	* test/bigdecimal/test_bigdecimal.rb (test_coerce): add a test for the
	  above change.

Tue May 31 23:49:08 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (offset_to_sec): fixed invalid validation.

Tue May 31 23:43:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): replace the algorithm for
	  coercing from a Rational to stop requiring "bigdecimal/util.rb".
	  [ruby-core:34318]

	* ext/bigdecimal/bigdecimal.c (GetVpValue): refactoring.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_new): support instantiation from a
	  Rational.

	* test/bigdecimal/test_bigdecimal.rb (test_global_new_with_rational): add a
	  test for the above change.

	* test/bigdecimal/test_bigdecimal.rb (test_new_with_rational): ditto.

Tue May 31 22:44:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_new): support instantiation a
	  BigDecimal object from an Integer.

	* test/bigdecimal/test_bigdecimal.rb (test_new_with_integer):
	  add for testing the above change.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_global_new): replace its body
	  with a BigDecimal_new call.

	* test/bigdecimal/test_bigdecimal.rb (test_global_new_with_integer):
	  add for testing the above change.

Tue May 31 22:24:39 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: use simple/complex mode instead of light/right mode.
	* test/date/*.rb: followed the above changes.

Tue May 31 21:28:33 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring):
	  initialize SIGINT handler.

Tue May 31 17:03:24 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/net/http.rb, lib/net/protocol.rb: Allow to configure to wait
	  server returning '100 continue' response before sending HTTP request
	  body. See NEWS for more detail. See #3622.
	  Original patch is made by Eric Hodel <drbrain@segment7.net>.

	* test/net/http/test_http.rb: test it.

	* NEWS: Add new feature.

Tue May 31 14:17:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_s_pipe): potential bug. the mode of read IO is set as
	  DEFAULT_TEXTMODE in call of io_set_encoding(), and of write IO is
	  also set as it in call of io_new_instance() via rb_protect().
	  so, if DEFAULT_TEXTMODE is not 0, we should check the result of
	  extract_binmode() and avoid crush of default IO mode and the result.

Tue May 31 13:00:17 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* strftime.c (rb_strftime_with_timespec): improved style consistency.
	  constified some variables.

	* test/test_time.rb (TestTime#test_huge_precision): test for #4456.

Tue May 31 12:53:10 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/io/wait/test_io_wait.rb (TestIOWait#{test_nread,test_ready?,
	  test_wait}: give system some time to process the written data.

Tue May 31 12:40:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#test_open_mode): MUST release resources
	  explicitly. fix problem of r31671

Tue May 31 10:49:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c: remove conditions for clang
	  because clang version 3.0 (trunk 132165) doesn't need them.

Mon May 30 22:19:33 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring): don't
	  close stderr.

Mon May 30 20:22:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring): small
	  but critical typo of r31642.  sorry...
	  [Bug #4798] [ruby-core:36550]

Mon May 30 15:44:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* insns.def (opt_mult): as r31805, volatile it.
	  Without this, clang -O fails calculation.

	* numeric.c (fix_mul): ditto.

	* rational.c (f_imul): ditto.

Mon May 30 10:26:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_pow): make sure to assign the result of x * z.
	  If xz is optimized out, the value won't overflow.

Sun May 29 23:17:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_match): fix rdoc of Regexp#=~.
	  patched by Tsuyoshi Sawada. [Bug #4781]

Sun May 29 23:10:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/https.rb (WEBrick::HTTPRequest#parse_uri):
	  keep parse_uri as private. patched by okkez. [Bug #4773]

Sun May 29 17:53:03 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* numeric.c: add #include "internal.h" for rb_big_uminus() prototype.

Sun May 29 15:09:05 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): fix for negative value.

Sun May 29 02:16:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/net/http/utils.rb (TestNetHTTPUtils#teardown): add nil check.

Sun May 29 00:22:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec, after_exec): change from macro to function.

Sat May 28 19:30:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec, after_exec): change SIGPIPE handler to SIG_DFL
	  before calling execve(). Because r31760 reintroduced an issue that
	  system() may hang up (i.e. [ruby-dev:12261]).
	* process.c (save_sigpipe, restore_sigpipe): new.

Sat May 28 16:08:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (Init_signal, default_handler): change default SIGPIPE handler
	  from empty function to SIG_IGN. [ruby-dev:43215]
	* signal.c (sigpipe): removed.

Sat May 28 03:04:27 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (fill_cbuf): return MORE_CHAR_SUSPENDED when cbuf is not empty.

Sat May 28 02:22:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (rb_str_bytesize): rb_str_bytesize() should use LONG2NUM().
	  Patch by Nikolai Weibull. [Bug #4789] [ruby-core:36511]

Sat May 28 02:06:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (fill_cbuf): Fix test-all crash.

Sat May 28 00:58:40 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/ostruct.rb (method_missing): Handle [] and []= correctly.
	  Based on a patch by Caius Durling, bug #4179 [ruby-core:33792]

Fri May 27 23:56:54 2011  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb (Tester::test_text_frozen): split frozen
	  string test. refs #4783

Fri May 27 22:46:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): install gemspec of json.  fixed #4784

Fri May 27 22:45:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (validate_enc_binmode): do not clear textmode flag if
	  default.  fixed #4732

	* io.c (fill_cbuf): finish reading at EOF.

Fri May 27 11:31:51 2011  misfo <tedwardo2@gmail.com>

	* lib/rexml/text.rb (REXML::Text#initialize): prevent an error
	  when passing a frozen string to REXML::Text.new

	  dup the string passed in instead of cloning so that it's frozen
	  state is ignored

Fri May 27 08:47:26 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* thread.c (ppoll): typo bug fix.

Fri May 27 08:35:04 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: hang-up at exit before calling Tk.mainloop.

	* ext/tk/lib/tk/extconf.rb: cannot make on MinGW [Ruby 1.9 - Bug #4141].

Thu May 27 00:34:07 2011  James Edward Gray II  <jeg2@ruby-lang.org>

    * lib/csv.rb: Enhance each() to support Enumerator.

Thu May 26 10:32:11 2011  James Edward Gray II  <jeg2@ruby-lang.org>

    * lib/csv.rb: Documentation improvements from Ysiad Ferreiras.
      [Ruby 1.9 - Bug #4785]

Thu May 26 15:42:02 2011  Cezary Baginski <cezary.baginski@gmail.com>

	* lib/xmlrpc/parser.rb (FaultException): fix to_s and inspect

	* test/xmlrpc/parser.rb: test for the above

Wed May 25 11:54:31 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Remove color constants block.
	  [Ruby 1.9 - Bug #4748]

Wed May 25 09:56:45 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Add missing documentation for button state, MIN
	  and MAX comments.  Add Curses. to TABSIZE= and ESCDELAY= methods.
	  [Ruby 1.9 - Bug #4747]

Wed May 25 09:35:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Restore nodoc for Benchmark::Job and
	  Benchmark::Report.  [Ruby 1.9 - Bug #4726]

Wed May 25 09:29:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/pop.rb:  Hide implementation details from RDoc.
	  [Ruby 1.9 - Bug #4711]

Wed May 25 09:26:29 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/ftp.rb:  Add :nodoc: for private methods.
	  [Ruby 1.9 - Bug #4710]

Wed May 25 09:19:17 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Fix Document-method declarations.  Improve
	  Zlib::GzipFile's method catalog.  [Ruby 1.9 - Bug #4695]

Wed May 25 08:22:12 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/erb.rb:  Hide documentation for implementation details of ERB.
	  [Ruby 1.9 - Bug #4694]

Wed May 25 07:58:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile.{mkdir,rmdir}): revert for backward
	  compatibility.

Wed May 25 07:13:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* spec/README: update the description.

Wed May 25 07:12:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile.{lock,unlock}_tempfile): refactor.

Tue May 24 17:30:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* spec/README: fix typo.
	  patched by bowsersenior. https://github.com/ruby/ruby/pull/24

Tue May 24 07:06:34 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fail to start Tk.mainloop (exit immediately) on
	  some environment (reported on [ruby-talk:381444]).

	* ext/tk/lib/tk/canvas.rb: support creating a canvas item object from
	  an item ID number.

	* ext/tk/lib/tk/image.rb: import documents which are pull-requested.
	  [Ruby 1.9 - Feature #4595]

	* ext/tk/lib/tk/extconf.rb: search directories for 64bit library (e.g.
	  /usr/lib64), add some new configure options (see README.tcltklib),
	  and bug fix.

	* ext/tk/lib/tk/README.tcltklib: modify docs for some new configure
	  options.

Tue May 24 04:01:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/yaml.rb: switch default YAML engine to Psych, old syck engine
	  may be enabled via YAML::ENGINE.yamler = "syck". [ruby-core:36374]

Mon May 23 09:45:26 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): Revert r30508. Forgot to
	  include this file in the commit r31692. __APPLE__ is not
	  CASEFOLD_FILESYSTEM again, from this time.

Mon May 23 10:01:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Do not parse zero-tagged values as EOC. Do
	  not let current length become negative for infinite length constructed
	  values. Support constructed values of length zero. Added tests.

Mon May 23 09:19:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/smtp.rb:  Document Net::SMTP::Response.  Patch by J.R. Garcia.
	  [Ruby 1.9 - Bug #4768]

Mon May 23 09:03:52 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Never Ignore SIGINT. When received
	Interrupt, immediately puts result and exit. [ruby-dev:43571]

	* lib/test/unit.rb: When received Interrupt, wait results from workers
	and collect them. [ruby-dev:43571]

Mon May 23 09:08:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4767]

Mon May 23 08:45:55 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ostruct.rb:  Improve documentation.  Patch by Franklin Webber.
	  [Ruby 1.9 - Bug #4761]

Mon May 23 08:35:24 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c:  Improve documentation of Hash#key.  Patch by Utkarsh
	  Kukreti.  [Ruby 1.9 - Bug #4760]

Mon May 23 08:32:59 2011  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c:  Improve documentation.  Patch by Dave Copeland.
	  [Ruby 1.9 - Bug #4757]

Mon May 23 07:19:45 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS (openssl): Infinite length support. Different behavior of
	  Constructive and Primitive constructors.

Mon May 23 06:58:33 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Forbid Constructives whose value is not an
	  Array to prevent segfault. Added test.

Mon May 23 06:33:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Forbid Constructive without infinite
	  length. This also prevents a segfault. Added test and improved
	  documentation.

Mon May 23 05:58:14 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Fix decoding of infinite length values.
	  Simplified ossl_asn1_decode0 by splitting it into three separate
	  functions. Add tests.
	  [Ruby 1.9 - Bug #4374][ruby-core:35123]

Mon May 23 04:03:46 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1_initialize): Allow creation of
	  Constructives with an explicit tag_class parameter without
	  automatically setting tagging to :EXPLICIT. Fixes a bug when encoding
	  infinite length primitive values.

Mon May 23 04:03:46 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1_cons_to_der): Add an additional
	  EOC for infinite length Constructives that are supposed to be encoded
	  with explicit tagging. Also tabify method correctly.

Mon May 23 03:44:39 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1data_to_der): Remove redundant
	  flag tmp_cons.

Mon May 23 00:35:00 2001  Kenta Murata  <mrkn@mrkn.jp>

	* bignum.c (dump_bignum, bigmul1_balance, big_split, biglsh_bang),
	  (bigrsh_bang, big_split3, bigmul1_toom3, bigmul0): implement Toom3 (Toom-Cook)
	  multiplication.

	* include/ruby/defines.h: add format prefixes for BDIGIT and BDIGIT_DBL.

Sun May 22 23:24:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Instead of rb_intern use static symbols to
	  improve performance.

Sun May 22 21:56:51 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Use OpenSSL constants V_ASN1_xxx instead of
	  hardcoded numbers for initializing class_tag_map.

Sun May 22 21:29:29 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): Revert r30508. See #4255.
	  Now __APPLE__ is not CASEFOLD_FILESYSTEM again.

	* load.c (loaded_feature_path, rb_feature_p, load_lock): Revert r30508.
	  See #4255. Make $LOADED_FEATURES scanning case-sensitive again.

Sun May 22 18:59:27 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_asn1.c(ossl_asn1_default_tag): avoid using RCLASS_SUPER
	  to make it compilable. Plus, tabify and change variable definition style.

Sun May 22 18:26:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (vm_xcalloc): use calloc provided by platforms.
	  fixes #4754

Sun May 22 11:44:53 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/pty/pty.c:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4756]

Sun May 22 11:26:39 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4755]

Sun May 22 11:21:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ipaddr.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4753]

Sun May 22 11:14:40 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/forwardable.rb:  Document def_delegator.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4752]

Sun May 22 11:11:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/fileutils.rb:  Document block behavior of FileUtils.cd.  Patch by
	  Bil Kleb.  [Ruby 1.9 - Bug #4751]

Sun May 22 11:07:47 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Complete documentation.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4748]

Sun May 22 09:29:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  use spawn. it prevent that other tests inherit renamed $0.

Sun May 22 08:57:13 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Default tag lookup in constant time via hash
	  instead of previous linear algorithm.
	  [Ruby 1.9 - Feature #4309][ruby-core:34813]

Sun May 22 07:54:16 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: Explain DSS and DSS1 in documentation.

Sun May 22 07:10:25 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Add tests for sign/verify.

Sun May 22 06:07:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_x509cert.rb: Merge DSA-related tests from ruby_1_8
	  branch.

Sun May 22 04:11:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (Init_Thread): add a code comment why the meaningless
	  line is necessary.

Sun May 22 01:35:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified documentation.

Sat May 21 22:46:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime(date_strftime_with_tmx): "%v" means "%e-%b-%Y".

Sat May 21 22:14:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_extract_modeenc): accept combination hash and
	  File::Constants. (eg. File.open('yo', :mode => File::WRONLY))
	  [Feature #4742][ruby-core:36338]
	* test/ruby/test_io.rb (TestIO#test_open_mode): new test.

Sat May 21 21:44:14 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_switch_hitter.rb: new.

Sat May 21 21:18:29 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{core,parse}.c: moved nearly all core code from ext/date/lib.
	* ext/date/lib/{date,date/format}.rb: removed nearly all code.

Sat May 21 02:58:46 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/.document:  Add curses to documented extensions.
	* ext/curses/curses.c:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4747]

Sat May 21 02:51:01 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/bigdecimal/lib/bigdecimal/util.rb:  Improve documentation.  Patch
	  by Pete Higgins.  [Ruby 1.9 - Bug #4746]

Sat May 21 02:44:10 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/bigdecimal/lib/bigdecimal/jacobian.rb:  Document isEqual.  Patch
	  by Kuba Fietkiewicz.  [Ruby 1.9 - Bug #4744]

Sat May 21 02:22:34 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/date/lib/date/format.rb:  Document date formats.  Patch by
	  Clinton Nixon.  [Ruby 1.9 - Bug #4743]

Fri May 20 05:15:19 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* gc.c: Fix build on m68k by 'error: too few arguments to
	  function 'mark_locations_array''.

Fri May 20 04:23:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/scanf.rb:  Improve documentation.  Patch by Gabe McArthur.
	  [Ruby 1.9 - Bug #4735]

Fri May 20 00:58:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/ibm737-tbl.rb: greek code page.  fixes #4738

Thu May 19 14:44:05 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_signal.rb (test_signal_requiring): skip on Windows.
	  we can send SIGINT only to pid 0 and the process itself.

Thu May 19 09:07:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib: revert r31635-r31638 and untabify with expand(1).

Thu May 19 07:47:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_rsa.rb: Add tests for sign/verify.

Thu May 19 07:19:16 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey.c: Add documentation.

Thu May 19 07:06:56 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Fix indentation.
	* lib/net/imap.rb:  Fix indentation of regular expressions.

Thu May 19 06:36:11 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/imap.rb:  Fix indentation of EOF for heredoc.
	* lib/debug.rb (Commands):  Fix indentation of EOHELP for heredoc.

Thu May 19 06:30:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mkmf.rb:  Fix indentation of EOM for heredoc.

Thu May 19 06:16:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib:  Convert tabs to spaces for ruby files per
	  http://redmine.ruby-lang.org/projects/ruby/wiki/DeveloperHowto#coding-style
	  Patch by Steve Klabnik [Ruby 1.9 - Bug #4730]
	  Patch by Jason Dew [Ruby 1.9 - Feature #4718]

Thu May 19 06:06:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi/util.rb:  Improve documentation.  Patch by Clinton Nixon.
	  [Ruby 1.9 - Bug #4733]
	* lib/cgi/core.rb:  ditto
	* lib/cgi/cookie.rb:  ditto

Thu May 19 06:02:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/tempfile.rb:  Document Dir.mkdir and Dir.rmdir.  Patch by Clinton
	  Nixon.  [Ruby 1.9 - Bug #4728]

Thu May 19 05:57:52 2011  Eric Hodel  <drbrain@segment7.net>

	* encoding.c:  Improve documentation for Encoding#default_external and
	  Encoding#default_internal.

Wed May 18 22:45:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/lib/console/size.rb (IO#console_size): new
	  method.  (EXPERIMENTAL)

Wed May 18 22:41:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* internal.h: add for internal use only.

Wed May 18 22:36:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (setup_exception): internal exception should be hidden

Wed May 18 20:25:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/timeout.rb (Timeout#timeout): don't leak "execution expired"
	  exception. [Bug #4283] [ruby-core:34534].

Wed May 18 06:09:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Add some examples and improve documentation.  Patch by
	  Sandor Szucs.  [Ruby 1.9 - Bug #4727]

Wed May 18 05:40:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Remove nodoc from Benchmark::Job and
	  Benchmark::Report.  Patch by Sandor Szucs.  [Ruby 1.9 - Bug #4726]

Wed May 18 05:29:26 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/compat.rb:  Improve documentation.  Patch by Sandor
	  Szucs.  [Ruby 1.9 - Bug #4725]

Wed May 18 05:10:35 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/tracer.rb:  Improve documentation.  Patch by Richard Ramsden.
	  [Ruby 1.9 - Feature #4720]

Wed May 18 04:53:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Improve documentation.  Patch by Jason Dew.
	  [Ruby 1.9 - Feature #4717]

Wed May 18 04:50:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/ftp.rb:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4710]

Wed May 18 03:14:49 2011  Eric Hodel  <drbrain@segment7.net>

	* test/test_singleton.rb:  Add tests from lib/singleton.rb.  Patch by
	  Pete Higgins.  [Ruby 1.9 - Bug #4715]

Wed May 18 03:03:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/singleton.rb:  Improve documentation.  Patch by Pete Higgins.
	  [Ruby 1.9 - Bug #4709]

Tue May 17 21:24:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_lock): remove remove_signal_thread_list() call.
	  It's meaningless because lock_interrupt doesn't call
	  add_signal_thread_list().

Tue May 17 20:20:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (rb_thread_struct): add volatile to
	  transition_for_lock because it is not protected by lock.

Tue May 17 20:08:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* LEGAL (missing/{elf,tgamma,lgamma_r}.c): they've been replaced by
	  public domain implementations.

	* LEGAL (vsnprintf.c): it has moved to srcdir from missing/.

	* LEGAL (missing/crypt.c): list its original license.

Tue May 17 19:54:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* LEGAL (configure): add missing/setproctitle.c

Tue May 17 19:35:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	Fix FreeBSD test failure.

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  use ps -o command instead of ps -o cmd. FreeBSD doesn't support
	  -o cmd option.

Tue May 17 08:04:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: Add documentation.

Tue May 17 07:14:58 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Improve documentation of proxy configuration
	  methods.  Patch by Alf Mikula.  [Ruby 1.9 - Bug #4714]

Tue May 17 07:09:01 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/pop.rb:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4711]
	* lib/net/telnet.rb:  ditto

Tue May 17 07:00:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Fix nodoc for Net::HTTP::version_1_1?.  Patch by
	  Alf Mikula.  [Ruby 1.9 - Bug #4713]

Tue May 17 06:56:26 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/optparse.rb:  Add link to make_switch to improve documentation.
	  Patch by David Copeland.  [Ruby 1.9 - Bug #4708]

Tue May 17 06:50:40 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/observer.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4707]

Tue May 17 06:42:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/logger.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4706]

Tue May 17 06:28:14 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/gserver.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4705]

Tue May 17 06:21:15 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi.rb: Add toplevel documentation to class CGI
	* lib/cgi/session.rb: Add overview documentation to CGI::Cookie
	* lib/cgi/html.rb:  Don't add CGI::TagMaker documentation to CGI.
	  Patch by David Copeland.  [Ruby 1.9 - Bug #4704]
	* lib/cgi/core.rb:  Clean up CGI documentation.  Patch by David
	  Copeland.  [Ruby 1.9 - Bug #4704]
	* lib/cgi/cookie.rb:  Clean up CGI::Cookie documentation.  Patch by
	  David Copeland.  [Ruby 1.9 - Bug #4704]

Tue May 17 05:52:30 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/digest: Improve documentation of Digest, Digest::HMAC and
	  Digest::SHA2.  Patch by Pete Higgins.  [Ruby 1.9 - Bug #4702]

Tue May 17 03:51:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/abbrev.rb:  Hide copyright and revision information from RDoc.
	  Inspired by patch from David Copeland, bug #4703.

Tue May 17 03:33:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb (module Timeout):  Hide internal constants.  Patch by
	  Pete Higgins.  [Ruby 1.9 - Bug #4701]

Mon May 16 11:21:09 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (RUBY_SO_NAME): add CPU as prefix
	  of RUBY_SO_NAME on x64/ia64 mswin/mingw.
	  [Feature #4602]

Mon May 16 08:00:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb:  Update to RDoc 3.6.1, allows OpenSSL::Digest to be
	  found.

Mon May 16 05:49:54 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/drb/acl.rb:  Add documentation.

Mon May 16 05:13:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Add documentation.

Mon May 16 00:32:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_signal.rb (TestSignal#test_signal_process_group):
	  skip if the platform doesn't have :pgroup capability. (i.e. skip
	  if mswin32)

Sun May 15 23:53:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h: resurrect old rb_fd_copy().
	* thread.c (rb_fd_copy): ditto.

Sun May 15 23:45:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h: remove rb_fd_copy() to rb_fd_dup() and
	  rb_w32_fdcopy() to rb_w32_fd_dup().
	* win32/win32.c: ditto.
	* thread.c: ditto.

Sun May 15 22:26:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* signal.c (rb_f_kill): accept '-SIGXXX' style signal with Symbol or
	  implicit convertion with #to_str. [ruby-dev:43169] fixes #4362
	* test/ruby/test_signal.rb (test_signal_process_group): add a test
	  for send signal to process group.

Sun May 15 21:22:35 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (cont_init): clear macihne_stack_start/end of saved thread to
	  prevent mark machine stack of GC'ed Thread. root Fiber is not
	  initialized by fiber_init().
	  based on a patch by Serge Balyuk [ruby-core:35891] fixes #4612
	* test/ruby/test_fiber.rb (test_gc_root_fiber): add test for it.

Sun May 15 21:04:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (econv_init): revert r31353.  [ruby-dev:43512]

Sun May 15 03:39:35 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4695]

Sun May 15 03:23:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/erb.rb:  Document ERB::Compiler.  Patch by Simon Chiang.
	  [Ruby 1.9 - Bug #4694]

Sun May 15 00:58:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix mswin32 build error.

	* missing/setproctitle.c: add #ifdef HAVE_UNISTD_H.
	* win32/Makefile.sub (MISSING): add setproctitle.obj

Sat May 14 22:45:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* missing/setproctitle.c: add to include "ruby/util.h".

Sat May 14 19:52:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  add for $0 test.

Sat May 14 19:50:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* missing/setproctitle.c (compat_init_setproctitle): use
	  ruby_strdup() instead of strdup().

Sat May 14 19:37:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/missing.h: add setproctitle() declaration.
	* missing/setproctitle.c: added.
	* configure.in: add check for missing/setproctitle.c.

	* ruby.c (ruby_process_options): add to call compat_init_setproctitle().
	* ruby.c (set_arg0): remove all platform specific code. it's
	  moved to missing/setproctitle.c.
	* ruby.c (origarg): remove len field. It's no longer used.
	* ruby.c (get_arglen): removed.

	This patch makes a lot of cleanup set_arg0 related code and fixes
	[Feature #4689].

Sat May 14 17:42:21 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* process.c (rb_proc_times): improve documentation.
	  [ruby-core:35785] fixes #4581, reported by Andrew Grimm.

Sat May 14 12:12:54 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Add basic tests and tests that
	  ensure new public key PEM encoding behavior and ensure backward
	  compatibility.
	  [Ruby 1.9 - Bug #4422] [ruby-core:35328]
	* test/openssl/test_pkey_rsa.rb: Remove line with 'puts'.

Sat May 14 12:06:49 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/context.rb (class RDoc):  Fix infinite loop caused by
	  re-encountering BasicObject.

Sat May 14 10:32:36 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_rsa.rb: Add tests that ensure new public key
	  encoding behavior and also ensure backward compatibility.
	  [Ruby 1.9 - Bug #4421] [ruby-core:35327]

Sat May 14 09:50:10 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/yaml/dbm.rb:  Add documentation.  Patch by Justin Collins.
	  [Ruby 1.9 - Bug #4693]
	* lib/yaml/store.rb:  ditto

Sat May 14 09:31:43 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb: Updated to RDoc 3.6

Sat May 14 07:30:29 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: released a new gem, so increasing version.

Sat May 14 05:08:32 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c
	* ext/openssl/ossl_pkey.c
	* ext/openssl/ossl_pkey.h
	* test/openssl/pkey/test_pkey_rsa.rb
	  Reverted premature commit. Sorry for the noise!

Sat May 14 05:02:58 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/uri.rb:  Add toplevel documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4690]

Sat May 14 04:19:06 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS: Describe altered behaviour for RSA and DSA public key
	  encoding. [Ruby 1.9 - Bug #4421, Bug #4422]
	  [ruby-core:35327,35328]

Sat May 14 02:57:52 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ipaddr.rb (unless Socket):  Document valid*? methods.  Patch by
	  Sebastian Martinez.  [Ruby 1.9 - Feature #4687]

Sat May 14 02:54:04 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rexml/functions.rb:  Add some documentation for REXML::Functions.
	  Patch by Sebastian Martinez.  [Ruby 1.9 - Feature #4688]

Sat May 14 02:51:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/resolv.rb:  Hide private method and state-tracking constants from
	  RDoc.  Patch by Mark Turner.  [Ruby 1.9 - Feature #4691]

Fri May 13 19:23:21 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* numeric.c (flo_coerce): Add #flo_coerce documentation.
	  Patch by Sebastian Martinez.
	  https://github.com/ruby/ruby/pull/21

Fri May 13 18:42:22 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* README.EXT: fix typo.  Patch by William Blackerby.
	  https://github.com/ruby/ruby/pull/19

	* README.EXT.ja: ditto.

Fri May 13 15:22:34 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_select): check invalid handle before doing
	  select operations.  see [ruby-dev:43513], [ruby-dev:43535]

Fri May 13 08:34:00 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/rdoc.rb:  Output summary after documentation report.
	* lib/rdoc/stats/normal.rb:  Don't output information for users when
	  we're not on a TTY

Fri May 13 07:49:02 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/fileutils.rb:  Hide internal methods from RDoc.  Patch by Darragh
	  Curran.  [Ruby 1.9 - Bug #4684]

Fri May 13 07:36:23 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpservlet/erbhandler.rb:  Add documentation.

Fri May 13 07:04:33 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Fix indentation.  Patch by Jason Dew.
	  [Ruby 1.9 - Feature #4682]

Fri May 13 06:50:43 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Add documentation.  Patch by Jason Dew.  [Ruby 1.9 -
	  Feature #4667]

Fri May 13 05:44:19 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/logger.rb (class Logger):  Document Logger#datetime_format.
	  Patch by Sergio Gil Perez de la Manga.  [Ruby 1.9 - Bug #4678]

Fri May 13 05:39:11 2011  Eric Hodel <drbrain@segment7.net>

	* re.c (Init_Regexp): Document option constants.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4677]
	* lib/uri/common.rb (module URI):  Documentation for URI.  Patch by
	  Vincent Batts.  [Ruby 1.9- Bug #4677]
	* lib/uri/ftp.rb (module URI):  ditto
	* lib/uri/generic.rb (module URI):  ditto
	* lib/uri/http.rb (module URI):  ditto
	* lib/uri/https.rb (module URI):  ditto
	* lib/uri/ldap.rb (module URI):  ditto
	* lib/uri/ldaps.rb (module URI):  ditto
	* lib/uri/mailto.rb (module URI):  ditto
	* process.c (Init_process):  Document Process constants.  Patch by
	  Vincent Batts.  [Ruby 1.9- Bug #4677]

Fri May 13 05:16:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rss/atom.rb (module RSS):  Document URIs.  Patch by Mark Turner.
	  [Ruby 1.9 - #4671]
	* lib/rss/rss.rb (module RSS):  Document exception classes.  Patch by
	  Mark Turner.  [Ruby 1.9 - #4671]

Fri May 13 02:15:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (select_internal): remove unused variable (interrupt_flag).

Thu May 12 18:24:34 2011  Kouhei Sutou  <kou@clear-code.com>

	* configure.in: limit to "T" type for prefix of external symbols
	  because x86_64-w64-mingw32-gcc on Debian GNU/Linux generates the
	  following symbol:
	    0000000068483390 D _GLOBAL__F__conftest_external

	  Approved by nobu.

Thu May 12 14:50:52 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/dl/test_base.rb (Fiddle::LIBC_SO): its always msvc*.dll on
	  mswin/mingw.

Thu May 12 14:47:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (Logging.postpone): copy only when temporary logfile
	  exists.

Thu May 12 12:24:22 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* ext/openssl/ossl_ssl.c: By trunk@31346, function check of SSLv2 is
	  executed.
	  However, the problem is not revised in this.
	  This adds the control of using function of SSLv2 in made macro by
	  function check.

Thu May 12 08:10:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/set.rb (class Set):  Add nodoc to internal-use methods.  Patch
	  by Pete Higgins.  [Ruby 1.9 - Bug #4665]

Thu May 12 08:01:14 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_ec.c: Allow encryption when PEM-encoding
	  Elliptic Curve private keys.
	  [ruby-core:35329] [Bug #4423]

Thu May 12 07:54:59 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c (rb_obj_equal):  Add documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4664]
	* lib/rexml:  ditto
	* lib/mkmf.rb:  ditto
	* ext/socket/lib/socket.rb:  ditto

Thu May 12 07:30:08 2011  Eric Hodel  <drbrain@segment7.net>

	* Various .document files: Update .document files to match files which
	  have documentation.

Thu May 12 07:18:45 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dsa.c: Use generic X.509 SubjectPublicKeyInfo
	  format for PEM-encoding DSA public keys.
	  [ruby-core:35328] [Bug #4422]

Thu May 12 06:27:31 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_rsa.c: Use generic X.509 SubjectPublicKeyInfo
	  format for encoding RSA public keys.
	  [ruby-core:35327] [Bug #4421]

Wed May 11 19:45:27 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/forwardable.rb: support 'delegate :foo => :bar' for to meet
	  by specification of RDOC.

Wed May 11 08:36:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick: Add documentation for WEBrick::HTTPAuth

Wed May 11 03:06:35 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rss.rb: Add documentation for RSS.  Patch by Steve Klabnik.
	  [Ruby 1.9 - Bug #4663]

Tue May 10 14:50:32 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add option for hiding skip messages when test
	  ends. #4657

	* test/testunit/test_hideskip.rb, test/testunit/test4test_hideskip.rb:
	  test for above.

Tue May 10 10:53:04 2011  Eric Hodel  <drbrain@segment7.net>

	* common.mk (rdoc): Add rdoc-coverage rule

Tue May 10 09:13:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick: Add Documentation

Tue May 10 04:22:09  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/log.rb: Hide copyright info from ri
	* lib/webrick/httpstatus.rb: ditto
	* lib/webrick/htmlutils.rb: ditto
	* lib/webrick/httpversion.rb: ditto
	* lib/webrick/version.rb: ditto
	* lib/webrick/httpauth/userdb.rb: ditto
	* lib/webrick/httpauth/authenticator.rb: ditto
	* lib/webrick/accesslog.rb: ditto

Mon May  9 20:57:13 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex,rational}.rb: added tests.

Mon May  9 20:29:44 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (string_to_c_internal): a refactoring.

Mon May  9 18:33:05 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c: Improve documentation for String#start_with? and
	  String#end_with?. fixes #4652
	  patched by Andrew Grimm <andrew.j.grimm at gmail.com>

Mon May  9 13:49:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* complex.c (string_to_c_internal): support scientific notation.
	  patched by Tinco Andringa. https://github.com/ruby/ruby/pull/16
	  [ruby-core:36046][Bug #4655]

Mon May  9 11:52:48 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_ord): remove K&R style.
	  patched by Daehyub Kim. https://github.com/ruby/ruby/pull/17

Sun May  8 22:17:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex2,complexrational}.rb: use skip.
	* test/date/*.rb: ditto.

Sun May  8 21:02:31 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex2,complexrational}.rb: NEVER SKIP.

Sun May  8 21:01:21 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_date_base.rb: fixed.

Sun May  8 20:54:11 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: NEVER SKIP.

Sun May  8 20:37:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: reverted 31432.

Sun May  8 20:32:43 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: reverted 31483.

Sun May  8 19:39:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_cond_timedwait): add to care EINTR.
	* thread_pthread.c (thread_timer): remove EINTR check.

Sun May  8 19:04:15 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/time.rb (xmlschema): avoid passing any negative numbers.

Sun May  8 18:40:03 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{parse,strptime}.c: introduced some macros.

Sun May  8 17:17:13 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: use skip /w messages.

Sun May  8 17:04:55 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_httpdate): omitted to call zone_to_diff.

Sun May  8 16:56:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_s_test_*): use macros.

Sun May  8 10:24:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: cleanup signal_thread_list related ifdef.
	  1) we don't have to use #ifdef FOO-PLATFORM directly 2) About
	  half #ifdef didn't care symbian properly.

Sun May  8 05:19:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: Linux socketpair(2) only support
	  AF_UNIX, but windows socketpair doesn't support it. we can't
	  avoid platform check. sigh!

Sun May  8 00:13:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: use Socket.pair instead of pipe.
	  Windows can only treat a socket.

Sat May  7 22:43:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_zero): remove redundant zero fill.

Sat May  7 22:38:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_init): remove volatile qualifier.

Sat May  7 22:34:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_init_copy): new internal api. It provide efficient
	  copy constructor semantics.
	* thread.c (do_select): use rb_fd_init_copy().

Sat May  7 15:18:06 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix incorrect native_cond_signal call when deadlock was detected.

	* thread.c (lock_func): decrement cond_waiting if timeout was happen.

Sat May  7 18:28:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (USE_MONOTONIC_COND): check the availability
	  more strictly.

	* thread_pthread.h (rb_thread_cond_t): ditto.

Sat May  7 15:15:10 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	fix win32 native_cond_timedwait() makes SIGSEGV.

	* thread_win32.h (rb_thread_cond_struct): add prev field instead of
	  last. (ie cond_event_entry is now using double linked list instead of
	  single)
	* thread_win32.c (cond_event_entry): add prev field.

	* thread_win32.c (__cond_timedwait): remove entry properly if timeout
	  was happen.

	* thread_win32.c (native_cond_signal): change for double linked list.
	* thread_win32.c (native_cond_broadcast): ditto.
	* thread_win32.c (native_cond_initialize): ditto.

Sat May  7 12:41:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix mutex deadlock test hang-up.

	* thread_win32.c (abs_timespec_to_timeout_ms): fix 1000x calculation
	  mistake. (ie fix hang-up native_cond_timedwait())

Sat May  7 03:14:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	sleep_cond use monotonic time if possible.

	* thread_pthread.c (native_thread_init): change sleep_cond
	  attribute to monotonic.
	* thread_pthread.c (native_sleep): use native_cond_timeout().

	* thread_pthread.c (native_cond_timeout): add overflow care.
	* thread_win32.c (native_cond_timeout): ditto.

Sat May  7 02:49:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	  fix win32 compile error.

	* thread_win32.c (RB_CONDATTR_CLOCK_MONOTONIC): define
	  RB_CONDATTR_CLOCK_MONOTONIC always.
	* thread_pthread.c (RB_CONDATTR_CLOCK_MONOTONIC): ditto.

Sat May  7 02:29:41 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	  mutex: deadlock check timeout use monotonic time.

	* thread_pthread.c (native_cond_timeout): new internal api.
	  it calculate a proper time for argument of native_cond_timedwait().
	* thread_win32.c (native_cond_timeout): ditto.

	* thread_pthread.c (thread_timer): use native_cond_timeout()
	  instead of get_ts.
	* thread.c (lock_func): ditto.

	* thread_pthread.c (get_ts): removed. use native_cond_timeout().
	* thread.c (init_lock_timeout): ditto.

Sat May  7 01:54:21 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_ts): add monotonic clock capability.
	* thread_pthread.c (rb_thread_create_timer_thread): use monotonic
	  clock if possible.

Sat May  7 01:43:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.h (rb_thread_cond_t): add clockid field. it's
	  no longer an alias of pthread_cond_t.
	* thread_pthread.c: adapt new rb_thread_cond_t type.
	* thread.c (mutex_alloc): ditto.
	* thread_win32.c (native_cond_initialize): ditto.
	* configure.in: add check for pthread_cond_attr_setclock() and
	  clockid_t type.

Fri May  6 23:29:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): use ppoll() instead of poll()
	  if possible. based on a patch from Eric Wong. [ruby-core:36003].

Fri May  6 23:13:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: remove nanosleep check. we no longer use it.
	  r20124 removed last usage.

Fri May  6 22:35:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): extra digits are not used.

Fri May  6 17:43:07 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): remove unused variable offset.

	* ext/syck/syck.h: use #ifdef instead of #if DEBUG.

Fri May  6 16:27:33 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (DAY_IN_NANOSECONDS): refix: 31438.
	  check with LONG_MAX and cast as long; without this the calculation
	  will be done as int and overflow.

Fri May  6 15:01:11 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): avoid buffer overrun, by
	  silently ignoring lesser significant digits.  Required buffer
	  length can be computable so you might at first think of
	  allocating enough memory space on the fly using alloca().  That
	  is a wrong idea because when using alloca there is always risk
	  of integer overflow.  A function that accepts outer-process
	  resources like this should not blindly trust its inputs.  In
	  this particular case we just want to generate milliseconds
	  resolution by strtod() so the string in question needs no more
	  length than what we originally have.  Ignoring lesser
	  significant digits should suffice I believe.

Fri May  6 14:25:53 2011  Tinco Andringa <mail@tinco.nl>

	* ext/syck/rubyext.c (mktime_do): YAML.load time correctly parse
	  usecs smaller than 1 fixes #4571

Thu May  5 22:23:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_mutex_reinitialize_atfork): removed
	  unused macro.
	* thread_win32.c (native_mutex_reinitialize_atfork): ditto.

Thu May  5 22:09:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (DAY_IN_NANOSECONDS): long long int is not
	  available on all platforms.

Thu May  5 17:36:31 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* eval.c (frame_func_id): store result of method_entry_of_iseq() to
	  cfp->me because method_entry_of_iseq() might become expensive.

Thu May  5 15:03:51 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* eval.c (frame_func_id): __method__ return different name from
	  methods defined by Module#define_method with a same block.
	  [ruby-core:35386] fixes #4606
	* eval.c (method_entry_of_iseq): new helper function. search control
	  frame stack for a method entry which has given iseq.
	* test/ruby/test_method.rb: add tests for #4606

Wed May  4 22:13:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pipe.rb: Reduced iterations. Too slow benchmark
	  is bad.
	* benchmark/bm_vm4_thread_pass.rb: ditto.

Wed May  4 22:08:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/date/test_date_base.rb: don't use no message skip().

Wed May  4 21:11:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select2.rb: reduce number of using file
	  descriptors. because gdb need some fds.

Wed May  4 19:00:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): Fix wrong return value.
	* test/-ext-/wait_for_single_fd/test_wait_for_single_fd.rb
	  (TestWaitForSingleFD#test_wait_for_closed_pipe): test for it.

Wed May  4 18:46:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/-test-/wait_for_single_fd: New. for testing
	  rb_wait_for_single_fd() internal function.
	  The patch was written by Eric Wong. [ruby-core:35991]

	* test/-ext-/wait_for_single_fd/test_wait_for_single_fd.rb: ditto.

Wed May  4 12:46:25 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): Added POLLNVAL check.
	  based on a patch from Eric Wong at [ruby-core:35991].

Wed May  4 11:51:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_select): remove useless ifdef.

Wed May  4 11:42:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (wait_connectable): fix error handling code.
	  RB_WAITFD_OUT is turned on even though an error occur.

Wed May  4 10:12:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/readline/readline.c (readline_event): use rb_wait_for_single_fd().
	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 10:10:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (wait_connectable): use rb_wait_for_single_fd().
	  The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

	* ext/socket/init.c (try_wait_connectable, wait_connectable_ensure):
	  removed.

Wed May  4 10:07:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/io/wait/wait.c (io_wait): use rb_wait_for_single_fd().
	  The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 10:01:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): new. poll(2) based backend for
	  rb_wait_for_single_fd().
	  Now only Linux uses it.

	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 09:56:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): new.
	* thread.c (select_single): select(2) based backend for
	  rb_wait_for_single_fd().

	* io.c (make_writeconv): use rb_wait_for_single_fd() instead of
	  rb_thread_fd_select().
	* io.c (rb_io_wait_readable): ditto.
	* thread.c (rb_thread_wait_fd_rw): ditto.

	* io.c (wait_readable): removed.
	* thread.c (init_set_fd): new helper function.
	* include/ruby/io.h (RB_WAITFD_IN, RB_WAITFD_PRI, RB_WAITFD_OUT):
	  new constant for rb_single_wait_fd().

	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 08:04:59 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: fix time dumping so that
	  Syck can load UTC times that Psych dumps.

Wed May  4 07:33:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_copy): fix wrong argument.This issue was pointed
	  out by Eric Wong. [ruby-core:35982]

Tue May  3 20:29:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_symbol_mode):
	  Skip sticky bit test if the platform is FreeBSD. It doesn't allow to
	  change sticky bit if a target is regular file.

Tue May  3 18:23:57 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/date/test_date.rb (TestDate#test_coerce):
	  test for [ruby-core:35127].

Tue May  3 04:27:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_select): preserve errno if no error
	  occurred.

Tue May  3 03:57:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_w32_fdcopy): add prototype.  fixes
	  #4640

Mon May  2 01:02:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/fileutils.rb (FileUtils#chmod): accept symbolic mode argument.
	  The patch was written by takkanm. [ruby-core:26029][Feature #2190]

	* lib/fileutils.rb (FileUtils#fu_mode): new helper function.
	* lib/fileutils.rb (FileUtils#symbolic_modes_to_i): ditto.
	* lib/fileutils.rb (FileUtils#mode_mask): ditto.
	* lib/fileutils.rb (FileUtils#user_mask): ditto.

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_symbol_mode):
	  new test for the above symbolic mode.
	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_R): ditto.

Mon May  2 00:36:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (rsock_connect): add to care EINTR. based
	  on a patch from Eric Wong at [ruby-core:35621][Bug #4555]

Sun May  1 01:06:24 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_select): release GVL while waiting select().

Sat Apr 30 23:10:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_fdcopy): New. This can copy even though
	  fdset size exceed FD_SETSIZE.
	* include/ruby/intern.h (rb_fd_copy): use rb_w32_fdcopy()

Sat Apr 30 20:18:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): Change argument type to rb_fdset_t.
	  Now do_select() is free from unexpected hangup if
	  HAVE_RB_FD_INIT=1 [Bug #4636]

	* thread.c (rb_thread_fd_select, rb_thread_wait_fd_rw):
	  adapt new argument type.

	* thread.c (rb_thread_select): make dummy implementation.

Sat Apr 30 20:16:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_copy): Change function argument. Now
	  rb_fd_copy() has fully copy semantics.
	* include/ruby/intern.h: ditto.

Sat Apr 30 20:11:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h (rb_thread_select): mark as deprecated.

	* ext/io/wait/wait.c (wait_readable): use rb_thread_fd_select
	  instead of rb_thread_select.
	* ext/socket/init.c (wait_connectable0): ditto.
	* ext/readline/readline.c (readline_event): ditto.
	* io.c (rb_io_wait_readable, wait_readable, rb_io_wait_writable,
	  wait_writable): ditto.

Sat Apr 30 20:06:36 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): remove useless ifdef. time calculation
	  is not heavy weight.

Sat Apr 30 16:48:36 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select3.rb: New.

Sat Apr 30 16:27:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (copy_stream_body, rb_io_s_copy_stream): move rb_fd_init()
	  from copy_stream_body to rb_io_s_copy_stream. fds of passing
	  rb_fd_term() have to be guaranteed initialized.

Sat Apr 30 16:13:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select.rb, benchmark/bm_io_select2.rb: New.
	  based on a patch from Eric Wong at [Feature #4531]

Sat Apr 30 03:25:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: New. for testing ext/io/wait.
	  the patch was written by Eric Wong. [Feature #4531]

Sat Apr 30 00:34:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/win32.h: remove redundant declaration of
	  rb_w32_time_subtract().

Sat Apr 30 00:16:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_init): fix hangup if GVL_SIMPLE_LOCK=1.
	  We don't have to call mutex_unlock() before initialize it!

Fri Apr 29 13:15:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_win32.c (native_cond_timedwait): New. r31373 caused
	  win32 build failure.

	* thread_win32.c (__cond_timedwait, abs_timespec_to_timeout_ms):
	  New helper functions.

	* win32/win32.c (rb_w32_time_subtract): rename from subtract and
	  remove static.

Fri Apr 29 10:43:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pipe.rb: Add two new benchmark for GVL
	  performance. They was written by Koichi Sasada.
	* benchmark/bm_vm4_thread_pass.rb: ditto.

Fri Apr 29 10:25:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_method.c (rb_clear_cache_by_class): Revert r29673. It made
	  a segmentation fault regression. [Bug #4289][ruby-core:34554].

Fri Apr 29 10:24:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (make_writeconv): do not add textmode newline decorator if any
	  newline decorator is set already.  fixes #4618, fixes #4619

Fri Apr 29 10:17:42 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (lock_func): small cleanup.

Fri Apr 29 10:07:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_lock, lock_func): Avoid busy loop and
	  performance regression. bm_vm3_thread_mutex.rb performance
	  change from 109.064sec to 16.331sec. [Feature #4607]

	* thread.c (init_lock_timeout): New helper function.

Thu Apr 28 16:15:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{win32.c,dir.h} (rb_w32_uopendir): new API to pass UTF-8 path.

	* win32/win32.c (opendir_internal, rb_w32_opendir): extract and merge
	  common part of rb_w32_opendir() and rb_w32_uopendir().

	* dir.c (do_opendir, glob_helper): encoding.

	* dir.c (dir_initialize, do_opendir): convert path to UTF-8 and call
	  rb_w32_uopendir() instead of rb_w32_opendir() on Windows.
	  fixes #4491, reported by Joey Zhou.

Thu Apr 28 15:32:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/dl/test_base.rb (DL::LIBC_SO): its always msvc*.dll on
	  mswin/mingw.

Thu Apr 28 06:07:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/csv.rb (CSV::open): suppress universal newline decorator.
	  fixes #4603

	* lib/csv.rb (CSV.read): no mode is needed.

Thu Apr 28 06:06:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_extract_modeenc, rb_f_backquote): set default text
	  mode.  fixes #4619

	* io.c (pipe_open): set universal newline decorator if needed.

Wed Apr 27 11:33:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/emoji_iso2022_kddi.trans: ISO-2022-JP-KDDI doesn't have
	  CP932 UDA. Another reason is emacs-mule: the implementation of
	  stateless-iso-2022-jp doesn't support beyond 94x94 (0x7fxx);
	  but CP932 UDA is in 7Fxx-92xx.

Wed Apr 27 07:42:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (STRIP): use proper toolchain.  based on a patch
	  from Jon Forums at [ruby-core:35909].  fixes #4617

Wed Apr 27 01:20:59 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_zone_to_diff): renamed.
	* ext/date/date_parse.c: ditto.
	* ext/date/date_strptime.c: ditto.

Wed Apr 27 01:16:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_find): accept Encoding objects.

Wed Apr 27 00:55:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (econv_opts): add newline option.

	* io.c (validate_enc_binmode, rb_io_extract_modeenc): set newline
	  decorator according to open mode.

	* transcode.c (rb_econv_prepare_options): new function, to prepare
	  econv options with newline flags.

	* include/ruby/encoding.h (ECONV_NEWLINE_DECORATOR_MASK): add.

Wed Apr 27 00:51:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_truncate): fix function.

	* include/ruby/win32.h (ftruncate, truncate, ftello, fseeko): non-64
	  versions on mingw are useless because they use int32_t.  fixes #4564

Wed Apr 27 00:50:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified validation methods.
	* ext/date/lib/date.rb: ditto.

Wed Apr 27 00:00:37 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (dt_lite_set_tmx): should get df value.

Tue Apr 26 22:34:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): allowed day only civil
	  date.  disallowed separatorless day only ordinal date.

Mon Apr 25 21:31:36 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* ext/openssl/extconf.rb: Should check SSLv2_*method.
	  openssl compiled with "no-ssl2" the extconf don't fail
	  when running `make' having this compilation errors.
	  Patched by Laurent Arnoud. fixes #4562, #4556

Mon Apr 25 20:53:32 2011  Tajima, Akio <artonx@yahoo.co.jp>

	* win32/win32.c (kill): accept 0 only sig is SIGINT #4596

Mon Apr 25 19:59:47 2011  Tajima, Akio <artonx@yahoo.co.jp>

	* win32/win32.c (kill): accept 0 as pid, fixes #4596

Mon Apr 25 16:43:45 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (random_rand): remove unused variables.

	* struct.c (rb_struct_define_without_accessor): ditto.

	* strftime.c (rb_strftime_with_timespec): ditto.

	* sprintf.c: ditto.

	* time.c (time_asctime): remove useless GetTimeval().

	* thread_pthread.c: cast to (void *) for %p.

Mon Apr 25 11:02:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/ripper/lib/ripper/sexp.rb: fix rdoc around sexp.
	  patched by Sho Hashimoto. fixes #4599

Mon Apr 25 08:24:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* random.c (rb_f_rand, random_s_rand): RDocs for them.

Mon Apr 25 07:18:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* random.c (random_s_rand, Init_Random): Random.rand should behave as
	  Random::DEFAULT.rand rather than Kernel#rand.

	* random.c (rand_range, random_rand): rand_range function extracted
	  from random_rand function.

	* random.c (rb_f_rand): accept a Range argument as Random#rand
	  [ruby-dev:43427] #4605

Mon Apr 25 03:31:06 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/time.rb: require 'date'.
	* ext/date/lib/date/format.rb: removed require line.

Mon Apr 25 03:08:39 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: require 'date'.

Mon Apr 25 03:04:16 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): added a pattern.

Mon Apr 25 02:51:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/lib/date/format.rb: require 'date_core.so'.
	  date/format needs methods which are now in date_core.so.
	  This breaks make rdoc which uses Date._parse from time.rb.

Mon Apr 25 02:47:46 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): fixed a bug of regex.

Mon Apr 25 02:12:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: an adjustment of regex.

Mon Apr 25 01:58:50 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: omitted to call _parse.

Mon Apr 25 01:03:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (rb_to_id): remove unused variable.

Sun Apr 24 22:19:05 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c: omitted some method calls.

Sun Apr 24 02:57:27 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c (n2i): takes long.

Sun Apr 24 02:51:06 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: reverted.

Sun Apr 24 02:25:23 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/intern.h: pcc can't use __builtin_constant_p.

	* vm_exec.c: change condition.

Sun Apr 24 01:58:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (leap_p): suppress warning: parentheses.

	* ext/date/date_core.c (date_s__parse_internal): remove unused
	  variable "str".

	* ext/date/date_parse.c (parse_ddd_cb): use RSTRING_LENINT.

	* ext/date/date_strftime.c (date_strftime_with_tmx): remove unused
	  variable.

Sun Apr 24 00:34:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: removed some unused macros.  use strchr()
	  instead of index().

Sat Apr 23 21:29:42 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  _parse.  [experimental]
	* ext/date/date_parse.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of _parse.

Fri Apr 22 12:04:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_sort_bang): fix rdoc.
	  patched by burningTyger. https://github.com/ruby/ruby/pull/11

Fri Apr 22 11:49:49 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/xmlrpc/create.rb (XMLRPC::Create#conv2value):
	  XML-RPC's int is 32bit int, and Fixnum also may be beyond 32bit.

	* lib/xmlrpc/create.rb (XMLRPC::Create#conv2value):
	  XML-RPC doesn't allow Infinity and NaN.
	  http://www.xmlrpc.com/spec

Fri Apr 22 04:16:14 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): strings from psych have proper taint
	  markings.

	* test/psych/test_tainted.rb: test for string taint

Thu Apr 21 01:30:02 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rb_f_srand): fix rdoc: srand(0)'s 0 is a seed.
	  [ruby-core:35833] fixes #4590

Thu Apr 21 01:01:28 2011  Masaya Tarui  <tarui@ruby-lang.org>

	* win32/win32.c (CreateChild): maximum length of lpCommandLine is
	  32,768 characters, including the Unicode terminating null character.

Wed Apr 20 21:32:11 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strptime.c (date__strptime_internal): do not
	  overwrite local variables.

Wed Apr 20 14:41:28 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_each_line): check string's length when compare
	  separator and string. [ruby-core:35815] fixes #4586

Wed Apr 20 00:02:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): use position of open paren.

Tue Apr 19 01:00:21 2011  Tajima Akio <artonx@yahoo.co.jp>

	* test/ruby/test_io.rb (TestIO#test_cross_thread_close_fd):
	  skip cross thread pipe close if windows

Mon Apr 18 12:15:46 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_range.rb (TestRange#test_step_ruby_core_35753):
	  avoid float error. [ruby-core:35804]

Sun Apr 17 00:20:14 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{core,strftime}.c: use struct tmx instead of vtm.
	* ext/date/date_tmx.h: new.

Sat Apr 16 22:23:52 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c (date_strftime_wo_timespec): changed
	  the way of validation of locale modifiers.

Sat Apr 16 21:55:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  _strptime.  [experimental]
	* ext/date/date_strptime.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of _strptime.

Sat Apr 16 10:18:30 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vm.c (Init_VM): suppress warning: "OPT_BASIC_OPERATIONS" is not
	  defined.

Fri Apr 15 23:41:18 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ruby.c (proc_options): suppress warning:
	  "ALLOW_DEFAULT_SOURCE_ENCODING" is not defined.

Fri Apr 15 15:10:29 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/uri/generic.rb (#route_from_path): Fix a bug where
	  URI('http://h/b/').route_to('http://h/b') wrongly returned './'
	  (should be '../b'). [Bug #4476]

Fri Apr 15 14:58:06 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/fileutils.rb (FileUtils#touch): Fix corrupted output when
	  mtime is specified in addition to nocreate (and verbose).
	  ref [ruby-dev:43401]

Thu Apr 14 23:43:43 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (ruby_float_step): wrong loop condition.
	  fixes [ruby-core:35753], reported by Joey Zhou.

	* test/ruby/test_range.rb (TestRange#test_step_ruby_core_35753):
	  test above change.

Thu Apr 14 22:48:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Options#setup_options): set possible
	  values for completion. no conversion is needed.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#initialize): use
	  positional arguments instead of keyword arguments.

	* lib/test/unit.rb (Test::Unit::Runner#jobs_status): io/console may
	  not be available. use 80 as the last resort if IO#winsize and
	  COLUMNS are unavailable.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#died): rename using a
	  verb.

	* lib/test/unit.rb (Test::Unit::Runner#_run_parallel): check if worker
	  is signaled and use its exit status.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#dead): no longer @in
	  and @out are separated.

Thu Apr 14 21:23:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_autoload_p): search superclasses as same as actual
	  loading.  fixes [ruby-core:35679]

Thu Apr 14 21:21:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (frexp, modf): wrongly declared as pure in
	  mingw math.h.

	* include/ruby/win32.h (ftruncate, truncate): mingw64 misses
	  prototypes.

	* win32/win32.c (rb_w32_read): suppress warning.

Thu Apr 14 19:55:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/fileutils.rb (FileUtils#touch): fix corrupted output when
	  FileUtils.touch(:nocreate => true, :verbose => true) case.
	  The patch was written by Hiroyuki Iwatsuki. [ruby-dev:43401]

Thu Apr 14 16:01:45 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_f_syscall): suppress warning: "HAVE___SYSCALL" is not
	  defined.

Thu Apr 14 00:41:09 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (thread_fd_close_i): IOError exception should be assigned
	  to rb_thread_t::thrown_errinfo.

Wed Apr 13 20:12:26 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_io_fdatasync): remove unused variable.

Tue Apr 12 20:54:12 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/st.h: parenthesize macro arguments.

Tue Apr 12 19:19:50 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb: avoid race condition. fixes #4572

Tue Apr 12 18:07:13 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: --disable-libedit to disable
	  libedit. fixes #4550

Tue Apr 12 10:37:39 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: VC doesn't have ftruncate() and others, but
	  ruby needs HAVE_ macros to use our emulation functions.
	  (fix the problem of 31262)

Tue Apr 12 01:33:00 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: properly evaluate existence of truncate, ftruncate
	  and ftello for MinGW. [ruby-core:35678]
	* win32/win32.c: rename truncate, ftruncate and ftello to avoid
	  redefinitions.
	* win32/win32.h: ditto.

Mon Apr 11 21:51:52 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c: revert r31230. Because it made a regression.
	  [ruby-core:35631]

Mon Apr 11 21:49:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb: Added TestIO#test_cross_thread_close_stdio
	  and TestIO#test_cross_thread_close_fd.
	  The patch was written by Eric Wong. [ruby-core:35669]

Mon Apr 11 21:15:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (rb_group_member): kill 256K of stack usage.
	  the patch was written by Eric Wong. [ruby-core:35699]

Mon Apr 11 07:24:13 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c:  Fix typo, document version constants.

Sun Apr 10 22:23:45 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h: parenthesize macro arguments.

Sat Apr  9 23:31:47 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each, strio_readlines):
	  Use `NUM2LONG` instead of `FIX2INT`. Fixes [ruby-dev:43395].

Sat Apr  9 23:22:27 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each):
	  Fix exception message and don't raise immediately if block is not
	  given.
	  Fixes [ruby-dev:43394].

	* test/stringio/test_stringio.rb (test_each_line_limit_0):
	  Fix test for above.

Sat Apr  9 21:54:15 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each, strio_readlines):
	  limit must not be zero. Fixes [ruby-dev:43392].

	* test/stringio/test_stringio.rb: Add tests for above.

Sat Apr  9 18:01:36 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/util.h: parenthesize macro arguments.

Fri Apr  8 16:01:56 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): check whether str is
	  a string when str and lim are given.
	  https://twitter.com/watson1978/status/56225052152168449

Thu Apr  7 20:03:52 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h: parenthesize macro arguments.

Wed Apr  6 21:08:31 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h: parenthesize macro arguments.

Wed Apr  6 15:12:40 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_pkey_dh.c (ossl_dh_initialize):
	  pop pushed error after each try of reading. fixes #4550

	* ext/openssl/ossl_pkey_dsa.c (ossl_dsa_initialize): ditto.

	* ext/openssl/ossl_pkey_ec.c (ossl_ec_initialize): ditto.

Wed Apr  6 11:36:44 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_pkey_rsa.c (ossl_rsa_initialize):
	  pop pushed error after each try of reading. fixes #4550

Tue Apr  5 20:33:43 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h: parenthesize macro arguments.

Mon Apr  4 22:02:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/io/nonblock/nonblock.c (io_nonblock_set): Avoid F_SETFL if
	  we're not changing the O_NONBLOCK bit. F_SETFL is an expensive
	  operation since it needs to affect all processes with the same
	  file object.
	  The patch is written by Eric Wong. [ruby-core:35556]

Mon Apr  4 21:41:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_syswrite): While local FS writes are usually
	  buffered, the buffers can be full or the file opened with
	  O_SYNC. IO#syswrite can also be used on blocking IOs
	  (pipe/socket) just like IO#write.
	  The patch is written by Eric Wong. [ruby-core:35554]

Mon Apr  4 11:50:40 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/test_tempfile.rb: simply ignore platform dependent testcases
	  instead of skipping.

Sun Apr  3 22:52:22 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/syslog/syslog.c: improve rdoc.
	  a patch by Jonas Pfenniger. [ruby-core:35592] fixes #4545

Sun Apr  3 22:10:09 2011  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c: parenthesize macro arguments.

Sun Apr  3 21:33:58 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: disable fdatasync again on Mac OS X.
	  [ruby-core:35493][Bug #4500]

Sun Apr  3 21:16:20 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_reopen): IO#close releases GVL if possible.
	  close() may block for certain file types (NFS, SO_LINGER
	  sockets, inotify), so let other threads run. The patch was
	  created by Eric Wong [ruby-core:35555][Bug #4527]

	* io.c (fptr_finalize): ditto.

	* io.c (maygvl_fclose): new.
	* io.c (nogvl_fclose): ditto.
	* io.c (maygvl_close): ditto.
	* io.c (nogvl_close): ditto.

Fri Apr  1 22:25:50 2011  Tanaka Akira  <akr@fsij.org>

	* ext/syslog/syslog.c: parenthesize macro arguments.

Fri Apr 1 18:53:06 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/cookie.rb (WEBrick::Cookie.parse): 'white space is
	  permitted between tokens' according to RFC2965. Though 'Netscape
	  spec' does not define the syntax clearly, make it tolerant as a
	  server. As a real-world example, rest-client gem sends
	  'Cookie: foo=1;bar=2'

	* test/webrick/test_cookie.rb (test_parse_non_whitespace): test it.

Fri Apr  1 13:19:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (RUBY_VM_CHECK_INTS_TH): merge a patch by ko1
	  in [ruby-dev:43373].

Thu Mar 31 23:15:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-brace-to-do-end, ruby-do-end-to-brace):
	  adjust space between block beginning and block arguments

Thu Mar 31 20:42:05 2011  Tanaka Akira  <akr@fsij.org>

	* ext/strscan/strscan.c:  parenthesize macro arguments.

Thu Mar 31 18:06:12 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): should ignore crefs with
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag.

Thu Mar 31 16:49:56 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): search root cref properly.
	  [ruby-dev:43365]

Thu Mar 31 14:50:25 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* eval.c (rb_mod_s_constants): should ignore crefs with
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag.

Wed Mar 30 22:55:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-toggle-block): toggle do/end and {}.

	* misc/ruby-mode.el (ruby-move-to-block): move to opening of
	  block.

Wed Mar 30 14:35:15 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.h (COPY_CREF): should copy
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag to hide constants from
	  methods defined by class_eval.  [ruby-dev:43365]

Wed Mar 30 00:24:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/stringio/stringio.c: parenthesize macro arguments.

Tue Mar 29 21:51:31 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* object.c (rb_String): Kernel#String should call to_str before to_s.

Tue Mar 29 10:28:08 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/test_filehandler.rb
	  (WEBrick::TestFileHandler#test_short_filename): the cgi doesn't exist
	  on current directory.

Tue Mar 29 05:19:57 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c: parenthesize macro arguments.

Tue Mar 29 00:03:51 2011 Tajima Akio <artonx@yahoo.co.jp>

	* test/webrick/test_filehandler.rb (test_short_filename):
	  read real short filename by cmd because smb mounted files
	  have different naming convention.

Mon Mar 28 11:38:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (date_s_today): use int for year.

	* ext/date/date_core.c (datetime_s_now): ditto.

Mon Mar 28 11:07:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/extmk.rb: set MFLAGS from MAKEFLAGS when using nmake.

Mon Mar 28 11:07:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (love): all you need is love.

Sun Mar 27 23:16:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c: parenthesize macro arguments.

Sun Mar 27 16:55:34 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-map): remove unnecessary
	  binding. fixes
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=468952

	* misc/ruby-mode.el: suppress warnings at byte compile.  fixes
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502926

Sun Mar 27 11:18:35 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: removed unused variables.

Sat Mar 26 15:16:09 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/getaddrinfo.c: parenthesize macro arguments.

Sat Mar 26 05:27:34 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/lib/date/format.rb (DateTime#strftime): removed because
	  date_core defines it.

Fri Mar 25 21:59:45 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: should not force cast with macros.

Fri Mar 25 21:56:10 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/init.c: parenthesize macro arguments.

Fri Mar 25 19:39:40 2011  Ben Walton <bwalton@artsci.utoronto.ca>

	* test/test_syslog.rb:
	  Skip syslog tests that rely on LOG_PERROR unless it's defined

	  Instead of checking looking at the platform to determine if the tests
	  relying on LOG_PERROR should be run, look for the definition of the
	  constant as this will be robust against all platforms as long as the
	  underlying syslog.c code sets it up correctly.

	  This specifically addresses failures on Solaris 9.

	  Use LOG_PID instead of LOG_PERROR in Syslog.open test

	  LOG_PERROR isn't a POSIX option for syslog, so it fails on platforms
	  that don't define it.  Solaris 9 and 10 are examples of this.

	  Use LOG_PID instead.

Fri Mar 25 15:42:17 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/sdbm/_sdbm.c (sdbm_open): use size_t.

	* ext/syck/bytecode.c: ditto.

	* ext/sdbm/_sdbm.c (delpair): use ptrdiff_t.

	* ext/sdbm/init.c: use RSTRING_LENINT.

	* ext/dl/handle.c: suppress warning: shorten-64-to-32.

	* ext/strscan/strscan.c: ditto.

	* ext/syck/emitter.c: ditto.

	* ext/syck/implicit.c: ditto.

	* ext/syck/syck.c: ditto.

	* ext/syck/token.c: ditto.

Fri Mar 25 12:14:58 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: import nkf 7f18e30.

Fri Mar 25 11:49:29 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#test_no_curdir): skip silently
	  on Windows, because this tests a platform specific feature and it'll
	  never be supported on ruby on Windows.

	* test/ruby/test_dir_m17n.rb
	  (TestDir_M17N#test_filename_extutf8_invalid,
	  TestDir_M17N#test_filename_as_bytes_extutf8): ditto.

	* test/open-uri/test_open-uri.rb
	  (TestOpenURI#test_find_proxy_case_sensitive_env): ditto.

	* test/dl/test_handle.rb (DL::TestHandle#test_NEXT,
	  DL::TestHandle#test_DEFAULT): ditto.

Thu Mar 24 23:06:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): should not autoload in
	  defined? mode.

	* variable.c (rb_const_defined_0): fix autoloading base.
	  [ruby-core:35509]

Thu Mar 24 22:48:43 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c: parenthesize macro arguments.

Thu Mar 24 14:45:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl.c: suppress warning: shorten-64-to-32.

	* ext/openssl/ossl.h: ditto.

	* ext/openssl/ossl_asn1.c: ditto.

	* ext/openssl/ossl_bio.c: ditto.

	* ext/openssl/ossl_bn.c: ditto.

	* ext/openssl/ossl_cipher.c: ditto.

	* ext/openssl/ossl_hmac.c: ditto.

	* ext/openssl/ossl_ns_spki.c: ditto.

	* ext/openssl/ossl_ocsp.c: ditto.

	* ext/openssl/ossl_pkcs5.c: ditto.

	* ext/openssl/ossl_pkey.c: ditto.

	* ext/openssl/ossl_pkey_dh.c: ditto.

	* ext/openssl/ossl_pkey_dsa.c: ditto.

	* ext/openssl/ossl_pkey_ec.c: ditto.

	* ext/openssl/ossl_pkey_rsa.c: ditto.

	* ext/openssl/ossl_rand.c: ditto.

	* ext/openssl/ossl_ssl.c: ditto.

	* ext/openssl/ossl_x509ext.c: ditto.

	* ext/openssl/ossl_x509name.c: ditto.

Thu Mar 24 11:48:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_rand.c (ossl_rand_egd_bytes): use NUM2INT because
	  the result is used with functions whose argument is int.

	* ext/openssl/ossl_ssl.c (ossl_sslctx_setup): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_purpose): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_trust): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_set_purpose): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_set_trust): ditto.

Thu Mar 24 11:36:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_x509name.c: id_aref's type is ID.

Thu Mar 24 10:04:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/io/console/console.c (console_set_winsize):
	  suppress warning: shorten-64-to-32.

Thu Mar 24 09:56:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_ocsp.c (ossl_ocspreq_verify): flags is VALUE,
	  so it should use NUM2INT.

	* ext/openssl/ossl_ocsp.c (ossl_ocspbres_verify): ditto.

Wed Mar 23 21:09:29 2011  Tanaka Akira  <akr@fsij.org>

	* ext/readline/readline.c: parenthesize macro arguments.

Wed Mar 23 08:07:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): fix inaccurate results.

Wed Mar 23 00:12:16 2011  Tajima Akio <artonx@yahoo.co.jp>

	* win32/win32.c: wait process real termination after reading
	  exit code. fixes #4518

Tue Mar 22 21:20:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rubygems/test_case.rb: save current dir to @current_dir
	  before Dir.chdir.

Tue Mar 22 20:10:04 2011  Tanaka Akira  <akr@fsij.org>

	* ext/psych/parser.c: parenthesize macro arguments.

Tue Mar 22 20:10:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ruby_missing.h: parenthesize macro arguments.

Tue Mar 22 13:33:22 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/buffering.rb: removed circular require of
	  openssl.rb.

	* ext/openssl/lib/openssl/*: removed following comment for transition
	  measures of avoiding circular require. No one claimed about this as
	  far as I know.
	  ##
	  # Should we care what if somebody require this file directly?
	  # require "openssl"

Tue Mar 22 10:57:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/runner.rb: set Gem::TestCase's @@project_dir.

	* lib/rubygems/test_case.rb: set Gem::TestCase's @@project_dir only
	  when it is not defined.

Tue Mar 22 09:38:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (flo_round): use pow instead of while-loop. fixes #4510
	  patched by Alex Young [ruby-core:35526]

Tue Mar 22 06:47:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_strftime.c (date_strftime_wo_timespec):
	  suppress warning: shorten-64-to-32.

Tue Mar 22 06:42:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c: suppress warning: shorten-64-to-32.

Tue Mar 22 06:41:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit/parallel.rb: remove unused variable.

Tue Mar 22 06:19:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_16le.c: suppress warning: shorten-64-to-32.

	* ext/dbm/dbm.c: ditto.

	* ext/gdbm/gdbm.c: ditto.

	* parse.y (Init_ripper): suppress warning: unused value.

Mon Mar 21 11:21:32 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Refactoring. Unified if and elsif.

Sun Mar 20 23:09:34 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c: checks duplicated modifiers.

Sun Mar 20 22:32:30 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c: removed unused code and arguments.

Sun Mar 20 21:34:49 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  strftime. It has some limitations that is same as Time's
	  one.  [experimental]
	* ext/date/date_strftime.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of strftime.

Sun Mar 20 12:43:12 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509store.c: parenthesize macro arguments.

Sun Mar 20 01:39:48 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): check env process block size with OS ver.
	* win32/win32.c: export rb_w32_osver for above patch.
	* include/ruby/win32.h: declare rb_w32_osver for Win32 Libs.

Sat Mar 19 18:35:05 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): calculate total env block size for win32.
	* test/ruby/test_env.rb: add test for above patch.

Sat Mar 19 17:14:46 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): checking with max process environment
	  block size for Win32. 32767 for 2000/XP, 2003. if failed to
	  read the block, then checking with 5120 for earlier Windows.

Sat Mar 19 12:30:25 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509revoked.c: parenthesize macro arguments.

Fri Mar 18 20:44:36 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509req.c: parenthesize macro arguments.

Fri Mar 18 08:48:06 2011  Oleg Shaldybin  <oleg.shaldybin@gmail.com>

	* lib/fileutils.rb (FileUtils::Entry_#copy_file): updated FileUtils.cp
	  to still copy file permissions when :preserve is false (as cp does
	  this even when -p isn't set).

Fri Mar 18 00:59:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/win32ole/extconf.rb (create_docfile): removed.  should not
	  modify source directory unnecessarily, platform dependent
	  documentation should be dealt with by rdoc.  [ruby-core:35495]

Fri Mar 18 00:54:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_funcall_passing_block): add prototype.
	  a patch by James M. Lawrence at [ruby-core:35501]

Wed Mar 17 06:23:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509name.c: parenthesize macro arguments.

Wed Mar 16 20:36:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c (init_inetsock_internal): raise an error on
	  listen(2) failure.
	  reported by Xavier Shay.  [ruby-core:35505]

Wed Mar 16 15:06:21 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/buffering.rb (module OpenSSL): #flush should
	  not change sync mode on exception.
	* test/openssl/test_buffering.rb: added

Wed Mar 16 13:45:28 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/buffering.rb: de-nest Buffering module

	* ext/openssl/lib/openssl/buffering.rb: add RDoc

Wed Mar 16 08:40:39 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509ext.c: parenthesize macro arguments.

Tue Mar 15 18:34:27 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509crl.c: parenthesize macro arguments.

Tue Mar 15 09:49:03 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/misc/test_ruby_mode.rb (test_singleton_class): Skip for Pending.

Mon Mar 14 21:20:44 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_require.rb (test_require_too_long_filename):
	  increase path length, because MAXPATHLEN is defined as 4096 on linux.

	* test/ruby/test_require.rb (test_require_path_home_1): ditto.

	* test/ruby/test_require.rb (test_require_path_home_2): ditto.

Mon Mar 14 19:54:37 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509cert.c: parenthesize macro arguments.

Sun Mar 13 18:11:28 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509attr.c: parenthesize macro arguments.

Sun Mar 13 16:07:58 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/pstore.rb: Fix don't raise "nested transaction" when thread_safe
	  is true. Patch by Masaki Matsushita (Glass_saga). [ruby-dev:43337]

	* test/test_pstore.rb: Test for above.
	  Patch by Masaki Matsushita (Glass_saga) [ruby-dev:43337]

Sat Mar 12 04:12:41 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl_session.c: parenthesize macro arguments.

Sat Mar 12 02:27:07 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c ({d,dt}_lite_marshal_load): checks the given
	  argument.

Sat Mar 12 01:26:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: changed some directives.

Sat Mar 12 01:16:02 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c, ext/date/lib/*: moved rdoc descriptions.

Sat Mar 12 00:06:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib: moved from lib.

Fri Mar 11 23:32:38 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta*: removed undocumented delta.

Fri Mar 11 18:42:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (find_executable0): should exclude directories.

Fri Mar 11 01:40:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getmaxgroups, proc_setmaxgroups): Process#maxgroups
	  and Process#maxgroups= now raise NotImplementedError if the
	  platform don't support supplementary groups concept.

Fri Mar 11 01:25:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (get_sc_ngroups_max): return -1 if platform don't
	  support NGROUPS_MAX.

Thu Mar 10 22:28:15 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.h: parenthesize macro arguments.

Thu Mar 10 21:59:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (parser_encode_length): add exception as UTF8-MAC for
	  magic comment's emacs newline specifier
	  patched by James M. Lawrence [ruby-core:35476] fixes #4489

Thu Mar 10 16:00:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (parser_encode_length): fix typo: the length of
	  "-dos" and "-mac" is not 5 but 4.
	  patched by James M. Lawrence [ruby-core:35476] fixes #4489

Thu Mar 10 10:52:01 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_require.rb: setting too long string to ENV causes
	  Errno::EINVAL on Windows.  long path name errors may causes over
	  about 1024 bytes, then limit it about 4000 bytes.

Thu Mar 10 10:09:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Runner::Worker#read): fix for the case
	  when IO#read or IO#gets returns nil.

Thu Mar 10 07:12:03 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.6.2 (release candidate @ 2026fbb5)
	* test/rubygems: Ditto
	* test/runner.rb: Added test to load path to fix test requires.

Thu Mar 10 03:00:43 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.c: parenthesize macro arguments.

Wed Mar  9 23:51:26 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_io_m17n.rb (test_io_new_enc): "sjis" is now an alias
	  of Windows-31J.

Wed Mar  9 23:06:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): fix indent after aref.

Wed Mar  9 12:50:24 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: Rescue exceptions when
	  people implement the method method. Thanks Lin Jen-Shin.
	  [ruby-core:35255]

	* test/psych/visitors/test_yaml_tree.rb: test for implementation of
	  method method.

Wed Mar  9 11:53:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c: Change SJIS as an alias of Windows-31J.
	  [ruby-dev:43027] fixes #4280

	* enc/shift_jis.c: Add PCK as an alias of Windows-31J.

Wed Mar  9 00:45:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: nmake substitutes all occurrences in macro.

	* ext/extmk.rb: workaround for nmake.

Tue Mar  8 23:49:45 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setgroups): cleanup.

Tue Mar  8 23:40:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/misc/test_ruby_mode.rb: test for ruby-mode.el.

Tue Mar  8 23:27:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (get_sc_ngroups_max): try to use NGROUPS_MAX at first if
	  _SC_NGROUP_MAX is not defined.

Tue Mar  8 23:10:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): fix for array in block.

Tue Mar  8 21:44:49 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_rand.c: parenthesize macro arguments.

Tue Mar  8 16:45:31 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (ruby_setenv): MSDN says that Windows XP or earlier limits
	  the total size of environment block to 5,120 chars.  and on such
	  OS, putenv() causes SEGV.  So, ruby should limit the size of an
	  environment variable to 5,120 bytes for workaround.

Tue Mar  8 15:57:20 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rubygems/test_gem_spec_fetcher.rb
	  (TestGemSpecFetcher#test_cache_dir_escapes_windows_paths): cache_dir
	  may have driveletter and `:' for base of cache_dir itself, so need
	  to skip it for checking.

Tue Mar  8 12:30:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-deep-indent-paren-p, ruby-calculate-indent):
	  do not apply deep-indent inside parens at the beginning of
	  expressions.

Tue Mar  8 09:32:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (configure-ext, build-ext), ext/extmk.rb (extmake):
	  support parallel-make under ext.

Tue Mar  8 09:25:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_setgroups): use getgrnam() if getgrnam_r() is
	  not available.

	* process.c: RARRAY_LEN() returns long int.

Tue Mar  8 09:07:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_REPLACE_TYPE): enclose in quotes for multiple
	  type names.

Tue Mar  8 01:43:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (get_sc_ngroups_max): define to wrap sysconf(3).
	  this also supports Windows which doesn't have sysconf(3).

	* process.c (maxgroups): use get_sc_ngroups_max.

	* process.c (proc_setmaxgroups): ditto.

Tue Mar  8 01:16:49 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (rb_objspace): an initializer must be a constant.

Tue Mar  8 01:11:44 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (maxgroups): cast because sysconf(3)'s return value is long.

	* process.c (proc_setmaxgroups): ditto.

	* process.c (proc_setgroups): cast because RARRAY_LEN() is long.

Tue Mar  8 00:02:47 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_rsa.c: parenthesize macro arguments.

Mon Mar  7 22:59:39 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/pstore.rb: Delete variable @transaction and fix #4474. Patch by
	  Masaki Matsushita (Glass_saga).

	* test/test_pstore.rb(test_thread_safe): Add test for #4474.

Mon Mar  7 21:31:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setgroups): replace getgrnam() with getgrnam_r()
	  because getgrnam() isn't thread safe.

Mon Mar  7 20:49:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getmaxgroups, proc_setmaxgroups): reflect
	  platform maxgroups limitation by default instead hardcoded 65536.

Mon Mar  7 17:13:00 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (rb_gc_set_params): allow GC parameter configuration by
	  environment variables.  based on a patch from funny-falcon at
	  https://gist.github.com/856296, but honors safe level.

Mon Mar  7 09:05:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c: NUM2RLIM is defined but no getrlimit and setrlimit on
	  mingw.

Mon Mar  7 08:38:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (DateTimeData): should not use bare 'long long'
	  and 'long double', which are not defined by C89.

	* ext/date/date_core.c (dt_lite_plus): get rid of overflow at casting
	  down double to integer.

Mon Mar  7 00:21:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getgroups): get rid of maxgroups dependency.
	  ngroups can be calculated dynamically.

Sun Mar  6 23:45:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: rlim_t use standard RUBY_REPLACE_TYPE mechanism.

Sun Mar  6 23:26:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setmaxgroups): added negative value check.
	  This was suggested by Daniel Berger. Thanks Daniel!
	  [ruby-core:35426][Bug#4467]

Sun Mar  6 23:18:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (maxgroups, proc_setmaxgroups): increase max groups
	  limitation up to 65536.

Sun Mar  6 22:20:59 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_ec.c: parenthesize macro arguments.

Sun Mar  6 21:49:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* sample/list.rb (MyElem#initialize): initialize @head
	  explicitly. Otherwise -W2 option makes following warning.
	  "warning: instance variable @head not initialized".
	  This issue was founded by Andrew Grimm. Thanks Andrew!
	  [ruby-core:35435][Bug#4471]

Sun Mar  6 05:21:41 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* class.c: fix camelCase to snake_case in documentation code examples.
	  patched by Andrew Grimm. fixes Bug #4469

	* marshal.c: ditto.

	* proc.c: ditto.

	* sample/biorhythm.rb: ditto.

	* vm_eval.c: ditto.

	* vm_method.c: ditto.


Sun Mar  6 03:22:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl): use rb_thread_io_blocking_region() instead
	  rb_thread_blocking_region().

Sat Mar  5 22:54:36 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* include/ruby/intern.h: fix a typo of prototype declaration.
	  rb_mutex_try_lock -> rb_mutex_trylock [ruby-dev:43213]

Sat Mar  5 19:44:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (TestIO#test_fcntl_lock): small clean up.

Sat Mar  5 01:33:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl, nogvl_io_cntl): IO.fcntl() and IO.ioctl()
	  release GVL during calling kernel interface.
	  Suggested by Eric Wong. [ruby-core:35417][Bug #4463]

	* test/ruby/test_io.rb (TestIO#test_fcntl_lock): add new test for
	  IO.fcntl().

Fri Mar  4 23:09:12 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/testunit/test_parallel.rb
	  (test_should_run_all_without_any_leaks): consider that the order of
	  testcase could change. [ruby-dev:43300] [Bug #4466]

Fri Mar  4 22:01:14 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl): change 'cmd' type to int. ioctl and fcntl need to
	  be passed int.
	* io.c (rb_io_ctl): ditto.

Fri Mar  4 21:10:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: save warnflags. the patch is created by Eric Wong.
	  [Bug #4465]

Wed Mar  2 21:15:00 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_dsa.c: parenthesize macro arguments.

Thu Mar  3 22:10:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (check_exec_redirect_fd, check_exec_redirect): raise
	  ArgumentError if fd >= 3 on Windows because the feature is not
	  supported.

	* test/ruby/test_process.rb (test_execopts_redirect): remove meaningless
	  argument.

Thu Mar  3 21:21:42 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (test_execopts_redirect): redirecting fd
	  >= 3 is not supported on Windows, so should not specify such options
	  when calling spawn or others.

Thu Mar  3 18:59:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_slice_bang): raise error when the string is frozen.

Thu Mar  3 14:25:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* strftime.c (STRFTIME): return 0 and ERANGE when precision is too
	  large. [ruby-dev:43284] fixes #4456

Thu Mar  3 00:46:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (uleb128): cast the value to unsigned long.

	* addr2line.c (fill_lines): print error when lseek fails.

Thu Mar  3 00:36:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/encoding.rb (REXML::Encoding#encoding=): store @encoding
	  a String which means the name of the encoding.
	  this partially revert r29646.

	* lib/rexml/document.rb: follow above.

	* lib/rexml/output.rb: ditto.

	* lib/rexml/parsers/baseparser.rb: ditto.

	* lib/rexml/source.rb: ditto.

	* lib/rexml/xmldecl.rb: ditto.

Wed Mar  2 23:19:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_byte_substr): return nil for negative length.

Wed Mar  2 21:15:00 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_dh.c: parenthesize macro arguments.

Wed Mar  2 14:24:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Fix name from `inclement_io` to
	  `increment_io`.

Wed Mar  2 14:06:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_slice_bang): move treatments which is only needed
	  when the result is not nil.

Wed Mar  2 14:02:29 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb(TestParallel#spawn_runner):
	  Fix outputing empty line in running test.

	* test/testunit/tests_for_parallel/test_third.rb: Remove `sleep`

Tue Mar  1 22:29:10 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey.h: parenthesize macro arguments.

Tue Mar  1 22:02:35 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Fix number.

Tue Mar  1 21:48:22 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: For Windows.

	* test/testunit/test_parallel.rb(TestParallelWorker#test_quit_in_test):
	  Fix for above specification change.
	* test/testunit/test_parallel.rb(TestParallel#spawn_runner):
	  Fix outputing empty line in running test.

Tue Mar  1 20:51:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  remove tests for [bug#4396]. because we decided to reject this
	  ticket.

Tue Mar  1 19:46:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/{test_date.rb,test_date_attr.rb}: [ruby-dev:43280]

Tue Mar  1 18:40:38 2011  Ryan Davis  <ryan@YPCMC09457>

	* lib/rubygems*: Import rubygems 1.6.0 (released version @ 58d8a0b9)
	* test/rubygems: Ditto

Tue Mar  1 16:22:22 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c: revert r30987 because it causes some failures in
	  test-all, especially webrick.

Tue Mar  1 15:59:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_byteslice): the resulted encoding should keep
	  original encoding. this also fixes the encoding when the result
	  shares internal string. [ruby-core:35376]

Tue Mar  1 13:25:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (VpMemAlloc): CVE-2011-0188.
	  Fixes a bug reported by Drew Yao <ayao at apple.com>

Tue Mar  1 10:34:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_byteslice): Add String#byteslice. [ruby-core:35376]

Tue Mar  1 00:12:49 2011  Tajima Akio <artonx@yahoo.co.jp>

	* include/ruby/win32.h: define WIN32 if neither _WIN64 nor WIN32
	  defined. it forces to use push/pop for pack(4) pragma.

Mon Feb 28 23:52:13 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/testunit/test_rake_integration.rb (test_with_rake_runner):
	  use assert_in_out_err for suppress messages.

Mon Feb 28 22:48:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_spawn): use shell if a commandline contain
	  double-quote character.
	* win32/win32.c (is_internal_cmd): similar, use shell if a commandline
	  contain caret character.

	* test/ruby/test_system.rb (TestSystem#test_system_at): fix
	  wrong test case. if system() invoke a command by using shell,
	  system() never return nil. Also, "" quotation must not appear
	  twice in a command line.

Mon Feb 28 17:36:57 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkcs7.c: parenthesize macro arguments.

Mon Feb 28 16:48:42 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkcs12.c: parenthesize macro arguments.

Mon Feb 28 16:28:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_trans): when the hash for multibyte repl is empty,
	  tr is inverse mode, and a character doesn't much the table, the
	  character should be replaced by last replacement. Bug #4449

Mon Feb 28 16:38:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ocsp.c: parenthesize macro arguments.

Mon Feb 28 13:02:15 2011  Danial Pearce <github@tigris.id.au>

	* lib/tempfile.rb: Fix example file paths in docs for tempfile.
	  https://github.com/ruby/ruby/pull/5

Mon Feb 28 12:56:18 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_init): typo fix.
	  https://github.com/ruby/ruby/pull/8

Mon Feb 28 12:28:13 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/date/date_core.c (datetime_s_now): localtime() and localtime_r()
	  required time_t pointer as 1st parameter, and tv_sec member of struct
	  timeval is long.

Mon Feb 28 11:57:40 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb: Temporally disable test on Windows.

Mon Feb 28 07:28:35 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Runner#after_worker_quit):
	  method name more be natural English.

	* lib/test/unit.rb(Test::Unit::Runner::Worker.launch):
	  IO.sync doesn't need. Should use "b" for mode.

Sun Feb 27 21:59:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_redirect_win):
	  add test for system().

Sun Feb 27 18:00:09 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Refactoring; Worker never use Hash for internal
	  storage.

	* lib/test/unit.rb: Never use Kernel#spawn. Use IO.popen instead.

Sun Feb 27 13:16:48 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ns_spki.c: parenthesize macro arguments.

Sat Feb 26 17:07:53 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: [Feature #4257]

	* ext/date/extconf.rb: new

	* ext/date/date_core.c: new

Sat Feb 26 16:10:23 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: --jobs-status won't puts over 2 lines.

	* test/testunit/test_parallel.rb: Fix test for above.

	* lib/test/*: refactoring.

Sat Feb 26 07:10:05 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: fix parsing timezone's whose
	  whose format is (+/-)hhmm.  Thanks Goncalo Silva!

	* test/psych/test_scalar_scanner.rb: test for bug.

Thu Feb 24 23:02:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_hmac.c: parenthesize macro arguments.

Thu Feb 24 22:53:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (love): for the birthday.

Thu Feb 24 22:51:54 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_vm_destruct): run vm exit hooks after all objects are
	  destructed.

Thu Feb 24 14:40:33 2011  Shota Fukumori  <sorah@tubusu.net>

	* ChangeLog (vim): Modeline for vim

Thu Feb 24 13:39:25 2011  Shota Fukumori  <sorah@tubusu.net>

	* common.mk: Use $RUNRUBY for worker process.

	* lib/test/unit.rb: Fix bug.

	* lib/test/unit.rb: @options[:ruby](@opts[:ruby]) is now Array.

	* test/testunit/parallel.rb: Fix for above.

Thu Feb 24 10:05:55 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/tests_for_parallel/misc.rb: Fix bug in r30947.

	* lib/test/unit.rb, lib/test/unit/assertions.rb: For this test.

Wed Feb 23 23:07:38 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb, test/testunit/parallel/*:
	  Test for r30939.

	* lib/test/unit.rb: For test.

	* lib/test/parallel.rb: For test.

	* lib/test/unit/testcase.rb: For test.

Wed Feb 23 22:05:13 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_engine.c: parenthesize macro arguments.

Tue Feb 22 23:15:17 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Fix --ruby option doesn't effect.

	* lib/test/unit.rb: Fix typo.

Tue Feb 22 21:39:28 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_digest.c: parenthesize macro arguments.

Tue Feb 22 14:34:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Fix merging miss.

Tue Feb 22 12:27:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add new options; --jobs,-j,--ruby,--jobs-status,
	  --no-retry.
	  [Feature #4415] [ruby-dev:43226],[ruby-dev:43222],[ruby-core:35294]

	* lib/test/unit/parallel.rb: Used at test/unit --jobs(-j) option.

	* test/csv/test_serialization.rb: test/unit parallel running ready.

	* test/rake/test_file_task.rb: test/unit parallel running ready.

Tue Feb 22 06:09:10 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/syslog/syslog.c: Apply documentation patch from mathew murphy.
	  [Bug #4149]

Tue Feb 22 03:09:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: increase Psych to 1.1.0 for help with
	  debugging.

Tue Feb 22 03:04:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/streaming.rb: refactor streaming methods to a
	  module.
	* ext/psych/lib/psych/stream.rb: extracted streaming specific methods
	  to a module.
	* ext/psych/lib/psych/json/stream.rb: JSON stream inherits from
	  JSONTree and includes streaming methods.
	* ext/psych/lib/psych/visitors/json_tree.rb: JSON does not support
	  object references, so remove object reference testing when building
	  JSON trees.

Tue Feb 22 02:41:51 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb (accept): use Hash#key?
	  when looking up object references to err on the side of cache
	  misses.

Mon Feb 21 10:58:39 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/yaml_events.rb: refactoring JSON event
	  handling methods to a module for reuse.
	* ext/psych/lib/psych/json/tree_builder.rb: AST builder uses JSON
	  event methods.
	* ext/psych/lib/psych/json/stream.rb: stream emitter uses JSON event
	  methods.

Mon Feb 21 10:54:29 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/stream.rb: do not emit custom tags in maps
	  or sequences when emitting JSON.
	* ext/psych/lib/psych/json/tree_builder.rb: do not emit custom tags in
	  sequences when emitting JSON.
	* test/psych/json/test_stream.rb: tests for custom stream emits.
	* test/psych/test_json_tree.rb: tests for JSON emits.

Mon Feb 21 10:05:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/ruby_events.rb: DRY up ruby event handling
	  for JSON.
	* ext/psych/lib/psych/visitors/json_tree.rb: use ruby events module
	* ext/psych/lib/psych/json/stream.rb: ditto

Mon Feb 21 10:01:01 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/stream.rb: fix JSON stream emits to use
	  double quotes during stream.
	* test/psych/json/test_stream.rb: tests to reflect changes.

Mon Feb 21 00:38:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  add testcase for bug4396.

Sun Feb 20 19:59:32 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_cipher.c: parenthesize macro arguments.

Sun Feb 20 16:26:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (exec_recursive): prevent temporary objects from GC.

	* prevent temporary objects from GC, and should not use
	  RSTRING_PTR() for function calls since it evaluates the argument
	  a couple of times.

Sun Feb 20 16:22:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_flock): use rb_thread_io_blocking_region for the
	  time being.

Sun Feb 20 05:33:17 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.2 r6207.
	* test/minitest/*: ditto

Sun Feb 20 02:14:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sig_trap): avoid pthread_sigmask(xx, &mask, &mask) usage
	  because FreeBSD don't permit it. If it's used, it behave as
	  pthread_sigmask(xx, NULL, &mask).

	* signal.c (init_sigchld): ditto.

Sun Feb 20 00:46:51 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_bn.c: parenthesize macro arguments.

Sat Feb 19 22:37:42 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_insnhelper.c (vm_check_if_namespace): guard temporary object
	  from GC.

Sat Feb 19 06:36:27 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/test/unit.rb: partial revert of r30849. [ruby-core:32864]

	* test/testunit/test_rake_integration.rb: adding an integration test
	  with the rake loader to prevent regressions.

Fri Feb 18 19:31:31 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::remove_entry_secure): there is a
	  race condition in the case where the given path is a directory,
	  and some other user can move that directory, and create a
	  symlink while this method is executing.
	  Reported by: Nicholas Jefferson <nicholas at pythonic.com.au>

Fri Feb 18 00:28:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* compile.c (get_exception_sym2type): guard temporary object from GC.

Thu Feb 17 23:54:29 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* iseq.c (prepare_iseq_build): initialize iseq_compile_data::err_info
	  with nil. this fix exception in rb_iseq_load().

Thu Feb 17 22:32:35 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_marshal.rb (test_marshal_dump_extra_iv):
	  fix a typo of local variable. [Bug #3720] [ruby-dev:42083]

Thu Feb 17 21:32:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl.h: parenthesize macro arguments.

Wed Feb 16 20:37:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* eval_jump.c (rb_exec_end_proc): changed at_exit and END proc
	  evaluation order. [Bug #4400] [ruby-core:35237]
	* eval_jump.c (rb_mark_end_proc): ditto.

	* test/ruby/test_beginendblock.rb (TestBeginEndBlock#test_nested_at_exit):
	  added a test for nested at_exit.
	* test/ruby/test_beginendblock.rb (TestBeginEndBlock#test_beginendblock):
	  changed the test to adopt new spec.

Wed Feb 16 20:17:06 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/openssl_missing.h: parenthesize macro arguments.

Tue Feb 15 21:37:45 2011  Tanaka Akira  <akr@fsij.org>

	* ext/gdbm/gdbm.c: parenthesize macro arguments.

Tue Feb 15 20:34:53 2011  Tanaka Akira  <akr@fsij.org>

	* array.c (ary_join_1): fix array size.

Tue Feb 15 19:43:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: fix and resubmit r30621. [ruby-dev:43203]

Tue Feb 15 15:41:30 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (array_join): copy the encoding of the first element as
	  an initial encoding.

	* array.c (array_join_0): ditto.

	* array.c (array_join_1): ditto.

	* array.c (inspect_ary): ditto.

	* array.c (array_join_1): add an argument to check the appending is
	  first one or not.

Tue Feb 15 15:40:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* hash.c (inspect_i): copy the encoding of the first key as
	  an initial encoding.

Mon Feb 14 15:00:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (inspect_ary): don't taint the inspected result of a
	  recursive array.

Tue Feb 15 15:43:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): change the rule for empty strings:
	  remove the special treatment of the US-ASCII encoded empty string.
	  Now Encoding.compatible? usually respect the encoding of the
	  receiver.

Tue Feb 15 15:39:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): remove special treatment of
	  ASCII-8BIT receivers.

	* string.c (str_gsub): set initial encoding of the buffer as the
	  same of the receiver. [ruby-core:35141]

Tue Feb 15 09:49:33 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_system.rb (TestSystem#test_system_at): use findstr
	  command instead of find command, because the latter is confusing
	  another famous Unix command.

Mon Feb 14 23:01:19 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (rb_thread_io_blocking_region): reset th->waiting_fd
	  after blocking region, because remaining waiting_fd might
	  cause unnecessary IOError.

Mon Feb 14 21:06:50 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in: revert r30621.  That revision introduced mkmf test
	  failures and it turned out to be OK to revert. [ruby-dev:43203]

Mon Feb 14 21:04:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/fiddle/conversions.h: parenthesize macro arguments.

Mon Feb 14 18:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/setup.mak (USE_RUBYGEMS): fixed r30835. It didn't work on
	  mswin32 port. If you changed win32/configure.bat, you should change
	  setup.mak too.

Mon Feb 14 17:28:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  added test. [ruby-core:35218] (#4393)

Mon Feb 14 13:15:35 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (is_internal_cmd): if the first char of prog is '@',
	  execute it via shell.  [ruby-core:35218] (#4393)

Mon Feb 14 10:33:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb: revert r30863, because it causes too many noise.

Mon Feb 14 07:34:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c: parenthesize macro arguments.

Sun Feb 13 19:41:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::RequireFiles#non_options): skip
	  test suites failed to load instead of mere messages.

Sun Feb 13 09:56:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/openssl/test_config.rb (OpenSSL#test_freeze): fix error
	  message assertion.

	* test/io/nonblock/test_flush.rb (TestIONonblock#flush_test):
	  return true to finish the test.

	* test/syck/test_string.rb (Syck::TestString#test_non_binary_string):
	  use assert_not instead of refute, unless required minitest
	  explicitly.

	* test/test_prime.rb (TestPrime::sieve.Integer): ditto.

	* test/xmlrpc/webrick_testing.rb (WEBrick_Testing#start_server):
	  catch IOError when server socket was closed.

Sun Feb 13 07:39:51 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_inject): typo fixed. a patch from Gaku Ueda in
	  [ruby-core:35216].

Sun Feb 13 00:48:47 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (Date#===): [ruby-core:35127]

Sun Feb 13 00:29:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Options#process_args): always
	  return options.

	* lib/test/unit.rb (Test::Unit::RequireFiles#non_options): return
	  if any test case get loaded.

	* lib/test/unit.rb (Test::Unit::AutoRunner#initialize): do not add
	  default directory if it is nil.

	* lib/test/unit.rb (Test::Unit::AutoRunner#process_args): return
	  true if any test cases to run.

Sat Feb 12 23:17:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (assert_include): add alias.

Sat Feb 12 14:44:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_io_blocking_region): new function to run
	  blocking region with GIL released, for fd.

	* thread.c (rb_thread_fd_close): implement.  [ruby-core:35203]

	* vm.c (th_init): rename from th_init2.

Sat Feb 12 14:41:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::AutoRunner#initialize): use
	  default_dir if no test case given.

	* lib/test/unit.rb (Test::Unit::Runner): rename from Test::Unit::Mini.

	* lib/test/unit.rb (Test::Unit::GlobOption#non_options): run tests
	  under base directory if no argument given.

Sat Feb 12 08:03:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_settracefunc.rb (TestSetTraceFunc): ensure to use
	  method_added hook defined in Module.

Sat Feb 12 01:04:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): enable rubygems if --gem option is given.

	* ruby.c (process_options): load rubygems if it is disabled but
	  --gem option is given.

Fri Feb 11 23:27:50 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ruby.c (proc_options): add --gem=enabled as an alias of
	  --enable=gems and --gem=disabled as an alias of --disable=gems.
	  Gem named "enabled" or "disabled" has already been reserved
	  legitimately for this purpose.

Fri Feb 11 23:17:04 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dl/cfunc.c: parenthesize macro arguments.

Fri Feb 11 21:41:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bin/testrb, test/runner.rb, lib/test/unit.rb: improve backward
	  compatibility.

Fri Feb 11 19:45:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): use rb_ary_free to free internal object.

	* gc.h (RUBY_FREE_UNLESS_NULL): get rid of double free.
	  [ruby-core:35192]

Fri Feb 11 16:57:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_transcode.rb (test_from_cp50221): fix wrong
	  assertion and move back.

Fri Feb 11 14:33:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_no_match): alias for
	  backward compatibility.

Fri Feb 11 12:06:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (add_gems, require_libraries, proc_options): add
	  --require and --gem options.

Fri Feb 11 12:03:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rubygems): add --disable-rubygems option.

Fri Feb 11 11:39:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in (CROSS_COMPILING): get rid of NameError.

Thu Feb 10 23:12:34 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dl/dl.h: parenthesize macro arguments.

Wed Feb  9 23:11:27 2011  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c: parenthesize macro arguments.

Tue Feb  8 11:47:11 2011  Loren Sands-Ramshaw  <lorensr@gmail.com>

	* array.c: documentation clarification in rotate, rotate!,
	  index, and rindex. [ruby-core:35144]

Wed Feb  9 09:45:43 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_encoding.rb: remove unnecessary (and wrong)
	  platform-dependent hacks.

Wed Feb  9 00:47:18 2011  Tanaka Akira  <akr@fsij.org>

	* ext/etc/etc.c: parenthesize macro arguments.

Tue Feb  8 19:38:00 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg): fix for invalid nest errors.

Tue Feb  8 19:22:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in (AC_MSG_CHECKING): fixed typo. the patch is
	  created by Benoit Daloze. Thanks a lot. [Bug #4384][ruby-core:35148]

Tue Feb  8 16:04:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_s_sysopen): use NUM2MODET() instead NUM2UINT().

Tue Feb  8 15:59:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (rb_run_exec_options_err): use MODET2NUM() instead
	  LONG2NUM().

Tue Feb  8 13:59:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: revert r30725. Now we have proper runtime fallback.
	  Therefore, no need compile time disabling. (see r30762).

Tue Feb  8 01:00:21 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* process.c (proc_setgroups): add GC guard to prevent intermediate
	  variable from GC.

Tue Feb  8 00:56:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg, ruby-in-here-doc-p): tell
	  singleton class definitions from here documents.

	* misc/ruby-mode.el (ruby-expr-beg, ruby-parse-partial): keyword
	  followed by colon is label.

Mon Feb  7 22:56:16 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/benchmark.rb (Benchmark#bmbm): use ensure clause instead of
	  Object#tap to restore STDOUT.sync.

Mon Feb  7 22:34:20 2011  Tanaka Akira  <akr@fsij.org>

	* lib/net/http.rb (Net::HTTP#connect): support SNI (Server Name
	  Indication) for HTTPS.  [ruby-dev:43164]
	  http://stackoverflow.com/questions/4685736/openssl-server-name-indication-support-in-ruby

Mon Feb  7 16:05:32 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.3  Fixes [Bug #4376]

Mon Feb  7 11:46:59 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (rdoc): add --encoding=UTF-8; ruby's rdoc must be UTF-8.

Mon Feb  7 10:21:50 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_options.rb (TestRDocOptions#test_check_files):
	  there is no easy way to create owner unreadable file on Windows.
	  So, skip the test.

Sun Feb  6 13:48:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/lib/json/common.rb (JSON::MissingUnicodeSupport.iconv):
	  should not drop rest of the result.  use Iconv.conv instead.

Sun Feb  6 12:46:02 2011  Eric Hodel  <drbrain@segment7.net>

	* string.c (gsub): Ensure result encoding is the same as input
	  encoding.  [Bug #4340].

Sun Feb  6 12:18:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (words, qwords): dispatch array events.  based on a
	  patch from Michael Edgar.  [Bug #4365].

Sun Feb  6 12:12:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/fileutils/fileasserts.rb (FileAssertions): separate module.

Sun Feb  6 11:29:23 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c: parenthesize macro arguments.

Sat Feb  5 22:01:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  revert r30796. r30797 and r30798 are an alternative fix.
	  [ruby-dev:43174]

Sat Feb  5 21:47:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (mlhs_basic): include mlhs_post for ripper.  a patch
	  from Michael Edgar at [ruby-core:35078].

Sat Feb  5 21:22:21 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_block): move from
	  test/fileutils/fileasserts.rb.

	* test/fileutils/fileasserts.rb (assert_block): pass arguments
	  as-is.  [ruby-dev:43174]

Sat Feb  5 16:47:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  msg can be passed nil. [Bug #4371] [ruby-dev:43174]

Sat Feb  5 15:18:25 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.2

Sat Feb  5 12:05:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (syck_node_init_copy): SyckNode is not
	  copiable.  [ruby-core:35094]

Sat Feb  5 11:48:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_alloc): leave data ptr
	  NULL.

	* ext/openssl/ossl_cipher.c (ossl_cipher_new, ossl_cipher_initialize):
	  allocate internal structure.  [ruby-core:35094]

	* ext/openssl/ossl_cipher.c (ossl_cipher_copy): ditto.

Sat Feb  5 11:29:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/parser/parser.h (GET_PARSER): raise TypeError.

	* ext/json/parser/parser.rl (cParser_initialize): ditto.

	* ext/json/parser/parser.h (GET_PARSER): check if initialized.
	  [ruby-core:35079]

	* ext/json/parser/parser.rl (cParser_initialize): ditto.

Sat Feb  5 10:09:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_get_expanded_load_path): always expand load paths.

Sat Feb  5 09:38:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (encoded_dup): extract.

Sat Feb  5 03:37:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::LowMethods): make low level methods
	  in NoWrite and DryRun to do nothing.  [ruby-dev:43129]

	* test/fileutils/fileasserts.rb: add message arguments.

	* test/fileutils/fileasserts.rb (Test::Unit::Assertions#assert_block):
	  show the given message.

Sat Feb  5 02:09:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lex_getline, parser_set_encode): set encoding of lines
	  in SCRIPT_LINES__ as source encoding.  [ruby-dev:43168]

Sat Feb  5 02:08:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_thread_data_type): add prefix.

Sat Feb  5 00:59:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (GetThreadPtr): use TypedData_Get_Struct() instead
	  CoreDataFromValue() because we need type check. Otherwise,
	  type mismatch can cause segmentation fault crash.
	  [ruby-core:35086] [Ruby 1.9-Bug#4367]

	* vm.c (thread_data_type): remove static.

Fri Feb  4 19:14:27 2011  Tanaka Akira  <akr@fsij.org>

	* enc/trans/utf8_mac.trans: parenthesize macro arguments.

Fri Feb  4 12:11:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (str_utf8_nth): fixed a condition of optimized lead
	  byte counting. [Bug #4366][ruby-dev:43170]

Fri Feb  4 01:50:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (count_utf8_lead_bytes_with_word): wrote function
	  comments.

Fri Feb  4 00:14:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_reader_get_unused): no need to dup
	  before rb_str_resurrect.

Thu Feb  3 20:04:44 2011  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c (CHECK): unused macro removed.

Thu Feb  3 18:33:26 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_reader_get_unused): use rb_str_resurrect
	  because gz->z.input is hidden string. [ruby-core:35057]

Thu Feb  3 16:34:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c (code_to_mbc): cast as int from the subtraction of
	  pointers.

	* enc/utf_16le.c (utf16le_mbc_enc_len): use ptrdiff_t.

	* enc/utf_32be.c (utf32be_left_adjust_char_head): ditto.

	* enc/utf_32le.c (utf32le_left_adjust_char_head): ditto.

Thu Feb  3 16:31:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/missing.h: don't use HAVE_STDDEF_H because it never
	  defined by configure though configure.bat defines it.

	* include/ruby/ruby.h: move include stddef.h to defines.h

	* include/ruby/defines.h: ditto.

Wed Feb  2 20:25:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_step_back): cast 4th argument 'n'
	  as int because Ruby usually treats length value as long but
	  onigenc_step_back's 4th argument is int.

Thu Feb  3 07:20:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: use Regexp::NOENCODING
	  rather than magic number.

	* ext/syck/lib/syck/rubytypes.rb: ditto

Thu Feb  3 07:16:11 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* re.c (Init_Regexp): added a constant for ARG_ENCODING_NONE
	  [ruby-core:35054]

	* test/ruby/test_regexp.rb: corresponding test.

Thu Feb  3 07:02:16 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: ARG_ENCODING_NONE regular
	  expressions can round trip. [ruby-core:34969]

	* test/psych/test_yaml.rb: test for ARG_ENCODING_NONE regex

	* ext/sych/lib/syck/rubytypes.rb: ARG_ENCODING_NONE regular
	  expressions can round trip.

	* test/syck/test_yaml.rb: test for ARG_ENCODING_NONE regex

Wed Feb  2 17:09:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_fdatasync): Use fsync(2) if the underlying
	  operating system does not support fdatasync(2).

Wed Feb  2 14:51:08 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup/to_tt_only.rb: commit miss
	* test/rdoc/test_rdoc_markup_to_tt_only.rb: ditto
	* test/rdoc/test_rdoc_single_class.rb: ditto

Wed Feb  2 09:27:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.1

Wed Feb  2 00:30:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/st.h (st_table): Added comment why we need __extension__.

Tue Feb  1 20:45:44 2011  Tanaka Akira  <akr@fsij.org>

	* enc/encdb.c: parenthesize macro arguments.

Tue Feb  1 15:12:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_require.rb (TestRequire#test_require_with_unc):
	  use ``127.0.0.1'' instead of ``localhost'' as host name, because
	  XP or earlier cannot resolv it as NBT hostname.

Tue Feb  1 13:20:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/benchmark/test_benchmark.rb (#capture_bench_output):
	  Added explicit sleep. Windows have imprecise time support.
	  Thus Tms.new.Add!{} may be or may be not equal 0. The
	  test failure started since r30747.

Tue Feb  1 11:03:47 2011  Ryan Davis  <ryan@lust.local>

	* lib/rubygems*: Import rubygems 1.5.0 (released version @ 1fb59d0)
	* test/rubygems: Ditto

Tue Feb  1 08:01:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_set_winsize): new method to set
	  console size.  [EXPERIMENTAL]

	* ext/io/console/console.c (console_winsize): use GetWriteFD.

Tue Feb  1 02:28:14 2011  Masaya Tarui  <tarui@ruby-lnag.org>

	* include/ruby/win32.h, win32/win32.c: add rb_w32_inet_ntop.
	  inet_ntop's minimum supported client is Vista.

Tue Feb  1 00:10:30 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/benchmark.rb: fix benchmark to work with current ruby.
	  patched by Benoit Daloze [ruby-core:33846] [ruby-dev:43143]
	  merged from https://github.com/eregon/ruby/commits/benchmark

	*  lib/benchmark (Report#width): update documentation
	*  lib/benchmark: document the return value of #benchmark and the
	   :list attribute in Report
	*  lib/benchmark (Tms#format): rename variables, use String#%
	   instead of Kernel.format
	*  lib/benchmark: remove undocumented Benchmark::times (an alias
	   of Process::times used twice)
	*  lib/benchmark (#benchmark): use label_width for the caption
	*  lib/benchmark (Tms#initialize): rename variables
	*  lib/benchmark: allow title to not be a String and call #to_s
	*  lib/benchmark (Benchmark#bm): return an Array of the times with
	   the labels
	*  lib/benchmark: correct output for Benchmark#bmbm
	   (remove the extra space)
	*  lib/benchmark: add a few tests for Benchmark::Tms output
	*  lib/benchmark: improve style (enumerators, ljust, unused vars)
	*  lib/benchmark: add spec about output and return value
	*  lib/benchmark: improve basic style and consistency
	   no parenthesis for print and use interpolation instead of printf
	*  lib/benchmark: remove unnecessary conversions and variables
	*  lib/benchmark: correct indentation
	*  lib/benchmark: rename the FMTSTR constant and variable to FORMAT
	*  lib/benchmark: remove useless exception

	*  test/benchmark: remove unused variable warnings

Mon Jan 31 23:27:23 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* node.c (add_id): remove duplicated rb_id2str() call.

Sun Jan 30 17:19:46 2011  Tanaka Akira  <akr@fsij.org>

	* missing/langinfo.c: parenthesize macro arguments.

Mon Jan 31 21:57:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: revert r30698.

Mon Jan 31 21:32:44 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (thread_start_func_2): check deadlock condition before
	  release thread stack. fix memory violation when deadlock detected.
	  reported by Max Aller. [Bug #4009] [ruby-core:32982]

Mon Jan 31 14:45:47 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale::#search_file):
	  Gem might be undefined if --disable-gems. [ruby-core:34990]

Mon Jan 31 12:26:14 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: suppressed shorten-64-to-32 warnings.
	* regcomp.c: ditto.
	* regexec.c: ditto.
	* regint.h: ditto.
	* regparse.c: ditto.
	* regparse.h: ditto.
	* time.c: ditto.
	* variable.c: ditto.

Mon Jan 31 04:45:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_uniq_bang): call ARY_SET_LEN(ary, 0) before
	  ary_resize_capa because ary_resize_capa expects resized length is
	  smaller than current array length. call rb_ary_unshare before
	  ary_resize_capa because ary_resize_capa lost the reference to
	  original shared array. [ruby-core:34997]

Sun Jan 30 17:19:46 2011  Tanaka Akira  <akr@fsij.org>

	* missing/crypt.c: parenthesize macro arguments.

Sun Jan 30 16:40:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rubygems/test_gem_security.rb (TestGemSecurity): valid only
	  if OpenSSL is available.

	* test/dl/test_dl2.rb (TestDL#test_sin): math functions do not
	  work on x86_64 due to the design of DL2.

	* test/dl/test_func.rb (DL::TestFunc#test_{sinf,sin): ditto.

Sun Jan 30 16:09:22 2011  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): %G produces 4 digits.

Sun Jan 30 15:13:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/emacs_mule.c (emacsmule_islead): 7bit range is also leading
	  byte.

Sun Jan 30 13:03:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_fetch_m): use useful message for longer key, not a
	  nonsense id value.

	* string.c (rb_str_ellipsize): new function to ellipsize a string.

	* include/ruby/encoding.h (rb_enc_step_back): new function to step
	  back n characters.

Sun Jan 30 12:53:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/emacs_mule.c (emacsmule_islead): fix inverse condition.

Sun Jan 30 09:37:25 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* io.c (struct argf): char behaves like an unsigned char
	  by default on AIX.

Sun Jan 30 08:02:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: Mac OS X wrongly reports it has fdatasync(3).

Sun Jan 30 03:29:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (GetBNPtr): add missing nil case.
	  patched by Martin Bosslet. [ruby-core:34987]

Sun Jan 30 01:02:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/ruby.h: Added NUM2MODET() and MODET2NUM() default
	  definition.
	  Because r30686 introduced win32 build failure.

Sat Jan 29 22:16:26 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_join): [].join.encoding must be US-ASCII.
	  [ruby-list:47790]

Sat Jan 29 20:22:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/driver.rb (BenchmarkDriver#measure): Show command line
	  when abnormal exiting occur.

Sat Jan 29 10:53:16 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_get_ev_const): no-scope reference to toplevel
	  private constant has been prohibited incorrectly.

	* test/ruby/test_module.rb (test_toplevel_private_constant): add a
	  test for above.

Sat Jan 29 08:43:23 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.5.0 (release candidate @ 09893d9)
	* test/rubygems: Ditto

Sat Jan 29 02:02:37 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (rb_mod_const_of, sv_i): Module#constant should exclude
	  private constants.  see [ruby-core:32912].

	* test/ruby/test_module.rb (test_constants_with_private_constant): add
	  a test for above.

Sat Jan 29 01:36:41 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (rb_const_set): const_set should preserve constant
	  visibility.  see [ruby-core:32912].

	* test/ruby/test_module.rb: add a test for above.

Sat Jan 29 01:24:57 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (NODE_CLASS, NODE_MODULE), insns.def (defineclass): raise
	  an exception when "class Foo::Bar" is evaluated and Foo::Bar is
	  private.  To implement this, define_type of "defineclass" is added
	  so that the instruction can distinguish whether the class definition
	  is scoped (class Foo::Bar) or not (class Bar).

	* test/ruby/test_class.rb (test_redefine_private_class),
	  test/ruby/test_module.rb
	  (test_define_module_under_private_constant): add tests for above.

Sat Jan 29 01:19:17 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* constant.h, variable.c: to ensure compatibility, rb_const_get_* must
	  not raise an exception even when the constant is private.  Instead,
	  rb_public_const_get_* and rb_public_const_defined_* are introduced,
	  which raise an exception when the referring constant is private.
	  see [ruby-core:32912].

	* vm_insnhelper.c (vm_get_ev_const): use rb_public_const_get_* instead
	  of rb_const_get_* to follow the constant visibility when user code
	  refers a constant.

	* test/ruby/test_marshal.rb (test_marshal_private_class): add a test.
	  This test had failed because of incompatibility of rb_const_get.

Sat Jan 29 00:30:44 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): fix typo.  a patch from Tomoyuki
	  Chikanaga in [ruby-core:32919].

Fri Jan 28 23:20:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_no_create,
	  TestGDBM2#test_writer_open_notexist): We only need to skip libgdbm
	  1.8.0, not all 1.8.x. 1.8.1 or later don't have GDBM_WRITER sickness.

Fri Jan 28 21:56:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/dbm/extconf.rb: Added new header places for Fedora13.

Fri Jan 28 21:49:30 2011  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c: parenthesize macro arguments.

Fri Jan 28 17:47:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM2#test_writer_open_notexist):
	  gdbm 1.8.x changed GDBM::WRITER behavior. Thus our testcase need
	  to be changed too.

Fri Jan 28 17:33:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_no_create): skip
	  the test if gdbm version is 1.8.x.

Fri Jan 28 16:30:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_too_long_filename):
	  Added -w option because too long path error don't output a message
	  by default since r30660. [Bug #4336] [ruby-dev:43134]

Fri Jan 28 16:19:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_path_home_{1,2}):
	  Added -w option because too long path error don't output a message
	  by default since r30660. [Bug #4336] [ruby-dev:43134]

Fri Jan 28 16:04:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_path_home_{1,2,3}):
	  split from test_require_path_home.

Fri Jan 28 13:04:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in (--with-valgrind): Fixed r29683. Now this option
	  is really default on.

Fri Jan 28 12:05:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add #include<sys/stat.h> when struct stat is
	  tested. Otherwise, incomplete type dereference error will occur.

Fri Jan 28 11:53:19 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: redundant variable names made strange conftest
	  error. Fixed it.

Fri Jan 28 11:47:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path{,2}):
	  should handle Errno::E2BIG, because this test checks crash of ruby,
	  not the error type system.

Fri Jan 28 11:23:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_open): Use NUM2MODET() instead NUM2UINT().
	* io.c (rb_scan_open_args): ditto.

Fri Jan 28 10:58:20 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Added mode_t type checking.
	* process.c (rb_exec_arg_addopt): Use NUM2MODET() instead
	  NUM2LONG because clang makes compile error by this narrowing
	  conversion.
	* process.c (rb_run_exec_options_err): ditto.

Fri Jan 28 02:37:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* re.c (rb_reg_raise): add GC guard to prevent intermediate
	  variable from GC.

Fri Jan 28 02:35:41 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* hash.c (rb_hash_fetch_m): add GC guard to prevent intermediate
	  variable from GC.

Fri Jan 28 01:33:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path)
	  TestProcess#test_too_long_path): Reduced string size from 100MB
	  to 10MB. 100MB may cause no memory error. It isn't intended.

Fri Jan 28 01:27:42 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path2):
	  Factored out from test_too_long_path. A test should only do
	  one test.

Thu Jan 27 23:29:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_foreach): check if unpacked.

Thu Jan 27 23:14:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-map): remove deprecated binding.
	  use M-; instead.

Thu Jan 27 21:58:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* bignum.c (rb_str_to_inum): get rid of too huge alloca().

Thu Jan 27 21:43:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): rewrite again. use ALLOCV instead
	  rb_str_tmp_new().

Thu Jan 27 21:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c: get rid of STRNDUPA(). It's dangerous API.

Thu Jan 27 21:31:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_aspawn): get rid of too huge alloca().
	  [Bug #4330] [ruby-core:34898]

Thu Jan 27 20:30:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_spawn): get rid of too huge alloca().

Thu Jan 27 18:49:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (open_dir_handle): get rid of too huge alloca().

Thu Jan 27 18:34:58 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (w32_io_info): get rid of too huge alloca().
	  [Bug #4313] [ruby-core:34830]

Thu Jan 27 18:19:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (wstati64): get rid of too huge alloca().
	  [Bug #4316] [ruby-core:34834]

Thu Jan 27 15:11:52 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): get rid of too huge
	  alloca(). this is the real fix of [ruby-core:34833].

Thu Jan 27 12:46:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (ALLOC_ARGV_WITH_STR): fix void pointer arithmetic.

Thu Jan 27 08:41:40 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_exec_v, rb_proc_exec_n, rb_proc_exec)
	  (proc_spawn_n, proc_spawn): get rid of too huge alloca().
	  [ruby-core:34827], [ruby-core:34833]

Thu Jan 27 08:32:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ALLOCV): new API for exception-safe
	  temporary buffer.  [ruby-core:34844]

	* string.c (rb_alloc_tmp_buffer, rb_free_tmp_buffer):
	  implementation of the API.

Thu Jan 27 08:22:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln_find.c (dln_find_1): use rb_warning and return immediately
	  if fname is longer than buffer.

Wed Jan 26 22:57:30 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* class.c (clone_method): add GC guard to prevent intermediate
	  variable from GC. [Bug #4321] [ruby-dev:43107]

Wed Jan 26 22:45:16 2011  Tanaka Akira  <akr@fsij.org>

	* template/id.h.tmpl: parenthesize macro arguments.

Wed Jan 26 22:28:49 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_eval.c (rb_throw_obj): add GC guard to prevent intermediate
	  variable from GC. [Bug #4322] [ruby-dev:43108]

Wed Jan 26 17:08:59 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode0): OpenSSL::ASN1.decode
	  should reject indefinite length primitive encodings as that is
	  illegal. Patch by Martin Bosslet. See #4324.

Wed Jan 26 10:36:28 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (=~): documentation fix; the return value is nil when
	  it doesn't match. patched by Andrei Kulakov [ruby-core:34562]

Tue Jan 25 08:41:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln_find.c (dln_find_1): omit too long pathnames.

Tue Jan 25 08:28:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_resize): get rid of out-of-bound access.

Tue Jan 25 07:48:22 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_thread.rb: remove unused variables.

Tue Jan 25 07:45:44 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_thread.rb (TestThread#test_condvar_nolock_2): get
	  rid of method redefined.

Tue Jan 25 07:00:52 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_string_value_cstr): rb_str_modify can change
	  RSTRING_PTR.

Tue Jan 25 03:24:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_thread.rb: Added various ConditionVariable tests.

Mon Jan 24 22:26:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): Fix again. use rb_str_tmp_new()
	  instead ALLOC_N.

Mon Jan 24 21:50:48 2011  Tanaka Akira  <akr@fsij.org>

	* vm_insnhelper.h: parenthesize macro arguments.

Mon Jan 24 21:28:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): use ALLOC_N instead ALLOCA_N because
	  ALLOC_N may cause stack overflow.

Mon Jan 24 21:04:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_invalid_str): prevent intermediate variable from GC.
	  [ruby-core:34820]

Sun Jan 23 23:01:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/console/test_io_console.rb: Don't run test if the system
	  don't support io/console.

Sun Jan 23 22:17:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/fiddle/test_fiddle.rb: Don't run test if the system don't support
	  fiddle.

	* test/fiddle/test_function.rb: ditto.
	* test/fiddle/test_closure.rb: ditto.

Sun Jan 23 11:39:18 2011  Tanaka Akira  <akr@fsij.org>

	* vm_exec.h: parenthesize macro arguments.

Sun Jan 23 10:33:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in (ruby): suppress warnings.

Sun Jan 23 08:00:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_nth_len, str_utf8_nth): return the rest length together.

	* string.c (rb_str_substr): get rid of measure the length always
	  to improve performance for huge string.  [ruby-core:34648]

Sun Jan 23 00:40:10 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/test_syslog.rb: Fix to make a lot of test failure if
	  the platform doesn't support syslog.

Sat Jan 22 11:49:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: fixing merge key support
	  when multiple merge keys are specified.

	* test/psych/test_merge_keys.rb: tests for multi-merge key support

Sat Jan 22 11:33:04 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: merge keys are actually
	  part of YAML 1.1, so they should be supported.  Remove warning and
	  merge keys to parent.  [ruby-core:34679]

	* test/psych/test_merge_keys.rb: test for merge keys

Sat Jan 22 10:25:19 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): add the file name to the exception when
	  parse errors occur.

	* test/psych/test_parser.rb: test for parse error file name

Sat Jan 22 10:12:30 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): fix assertion error when reusing a
	  parser after an exception has been raised

	* test/psych/test_parser.rb: test for assertion error

Sat Jan 22 04:09:22 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/nodes/node.rb: Make Psych::Nodes::Node
	  enumerable.

	* ext/psych/lib/psych/visitors/depth_first.rb: Add a depth-first
	  visitor to enumerate over a YAML AST in a depth-first fashion

	* test/psych/nodes/test_enumerable.rb: test for enumerating nodes

	* test/psych/visitors/test_depth_first.rb: test for depth-first
	  visitor

Sat Jan 22 00:53:42 2011  Tanaka Akira  <akr@fsij.org>

	* vm_core.h: parenthesize macro arguments.

Fri Jan 21 18:15:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: should not use -Werror=* flags while conftests.

Fri Jan 21 09:17:00 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: Fix incorrectly detected x86_64-w64-mingw32 due
	  canonalization of target_os. Bug #3889 [ruby-core:32634]

Thu Jan 20 23:44:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Fix rb_cv_va_args_macro was broken. We are using
	  -Werror=implicit-function-declaration compile option. therefore
	  we need a function declaration explicitly.

Thu Jan 20 23:58:02 2011  Tanaka Akira  <akr@fsij.org>

	* node.h: parenthesize macro arguments.

Thu Jan 20 23:25:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add '#include <stdlib.h>' to
	  rb_cv_localtime_overflow test too. It's reported by Tomoyuki
	  Chikanaga. Thanks.

Thu Jan 20 16:11:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* README.EXT, README.EXT.ja: You shouldn't choose ``conftest.c'' as a
	  name of a source file.

Thu Jan 20 12:15:44 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add stdlib.h inclusion into rb_cv_negative_time_t
	  test because it's required for exit(3). The patch is
	  created by Tomoyuki Chikanaga. [Bug #4287] [ruby-dev:43060]

Thu Jan 20 11:39:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/utils.rb (TestWEBrick::RubyBin): test CGI does not need
	  to load rubygems.  if it activated, ruby raises LoadError about
	  rbconfig.rb.

Thu Jan 20 09:19:42 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/json_tree.rb: Fix JSON emit for
	  DateTime and Time classes.

	* test/psych/test_json_tree.rb: test for JSON emit

Thu Jan 20 08:02:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/coder.rb (represent_object): arbitrary objects
	  may be passed to the Psych::Coder object.

	* ext/psych/lib/psych/visitors/yaml_tree.rb: support for visiting
	  arbitrary objects set on the coder.

	* test/psych/test_coder.rb: supporting test case.

Thu Jan 20 06:03:17 2011  Tanaka Akira  <akr@fsij.org>

	* method.h: parenthesize macro arguments.

Wed Jan 19 13:16:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/commands/sources_command.rb: Finish removing code,
	  (fixes sources command test).

Wed Jan 19 13:04:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* proc.c (proc_call): Add gc guard to avoid segfault. The fix
	  is created by Tomoyuki Chikanaga. [Bug #4238][ruby-dev:42963]

Wed Jan 19 12:31:28 2011  Eric Hodel <drbrain@segment7.net>

	* lib/rubygems.rb: Since gem_prelude requires rubygems, enable
	  custom_require always.

Wed Jan 19 12:08:08 2011  Eric Hodel <drbrain@segment7.net>

	* lib/rubygems/commands/dependency_command.rb: Remove require of
	  deleted file.
	* lib/rubygems/commands/fetch_command.rb: ditto
	* lib/rubygems/commands/setup_command.rb: ditto
	* lib/rubygems/commands/sources_command.rb: ditto
	* lib/rubygems/commands/specification_command.rb: ditto

Wed Jan 19 08:13:59 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.5.0 (release candidate)
	* test/rubygems: Ditto

Tue Jan 18 23:31:01 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y: avoid NULL reference.  [ruby-dev:43067]

Wed Jan 19 02:54:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (cvt): set first byte of buf to NUL for the case when
	  no bytes are written to the buf. [ruby-dev:43062]

Tue Jan 18 23:04:51 2011  Tanaka Akira  <akr@fsij.org>

	* gc.h: parenthesize macro arguments.

Tue Jan 18 18:31:14 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/completion.rb: Irb tab completion support for XX::method
	  forms.

Tue Jan 18 15:05:55 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: added RDoc document for logging message escape
	  by Hal Brodigan. See #3869

Tue Jan 18 07:53:52 2011  Tanaka Akira  <akr@fsij.org>

	* eval_intern.h: parenthesize macro arguments.

Tue Jan 18 04:42:44 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/parser.rb (Mark): Adding a class to wrap
	  marker information

	* ext/psych/parser.c (mark): Add a method to return the mark object
	  for the parser

	* test/psych/test_parser.rb: tests for the Mark class.

Tue Jan 18 02:46:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/json_tree.rb (visit_String): JSON
	  strings should be dumped with double quotes. [ruby-core:34186]

	* test/psych/test_json_tree.rb: test for double quotes

Mon Jan 17 23:36:33 2011  Tanaka Akira  <akr@fsij.org>

	* array.c (rb_ary_times): less MEMCPY calls.

Mon Jan 17 22:54:33 2011  Tanaka Akira  <akr@fsij.org>

	* debug.h: parenthesize macro arguments.

Mon Jan 17 21:40:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): revert r30549.

Sun Jan 16 20:55:45 2011  Tanaka Akira  <akr@fsij.org>

	* vsnprintf.c: parenthesize macro arguments.

Sat Jan 15 11:57:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): add -Werror=implicit-function-declaration
	  if available.

	* lib/mkmf.rb (init_mkmf): ignore warnings in mkmf tests.

	* test/mkmf/base.rb (setup, teardown): restore config values.

	* test/mkmf/test_flags.rb: split from test_find_executable.rb.

Sat Jan 15 10:04:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): autoload rubygems.

	* tool/compile_prelude.rb (Prelude#initialize): ignore empty
	  preludes.

	* ruby.c (ruby_init_prelude): get rid of global namespace
	  pollution.

Sat Jan 15 09:42:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h: missing prototypes.

Fri Jan 14 23:25:55 2011  Tanaka Akira  <akr@fsij.org>

	* vm_method.c: parenthesize macro arguments.

Fri Jan 14 15:32:29 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* test/net/imap/test_imap.rb: call neither logout nor disconnect
	  unless connected.  patch by Kazuhiro NISHIYAMA.  [ruby-dev:42860]

Fri Jan 14 14:56:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/imap.rb: use bytesize for binary strings.
	  patched by Yoshimasa Niwa. [ruby-core:34222]

Fri Jan 14 14:01:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_unpack): the resulted string of unpack('M') must have
	  ASCII-8BIT encoding (and ENC_CODERANGE_VALID). [ruby-core:34482]

Fri Jan 14 13:38:58 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_check_footer): ISIZE (Input SIZE) in
	  gzip's header is the size of uncompressed input data modulo 2^32.
	  [ruby-core:34481] http://www.ietf.org/rfc/rfc1952.txt

Fri Jan 14 11:36:25 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (RUNRUBY): require path should
	  include "." because rbconfig.rb is there.

Fri Jan 14 10:40:11 2011  Ryan Davis  <ryan@lust.local>

	* gem_prelude.rb: Just require rubygems. Fixes rubygems 1.4.
	* lib/rubygems.rb: removed all Gem::Quickloader code.
	* ruby.c: renamed ruby_init_gems to ruby_init_prelude. Set
	  $disable_rubygems since there is no fine grained mechanism to
	  skip parts of the prelude. Open to suggestions on how to do this
	  better.
	* test/*.rb: Load path isn't set up correctly, so add
	  --disable-gems as needed to failing tests that are explicitly
	  testing stderr w/ ==.

Fri Jan 14 07:30:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_next_argv): go advance when the next file cannot be
	  read.  [ruby-core:34446]

Thu Jan 13 20:49:19 2011  Tanaka Akira  <akr@fsij.org>

	* vm_insnhelper.c: parenthesize macro arguments.

Thu Jan 13 13:21:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* vm_dump.c: delete dashes to make lines 80 chars, Patched by
	  Shota Fukumori (sora_h).  [Bug #4275] [ruby-dev:43021]

Thu Jan 13 13:21:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* vm_dump.c: fix misspelling of CrashReporter, Patched by Shota
	  Fukumori (sora_h).  [Bug #4275] [ruby-dev:43021]

Thu Jan 13 06:27:29 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* error.c: Exception#to_s should actually call to_s.

Thu Jan 13 00:32:54 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (get_nth_dirname): decrement the directory index
	  because the index specifies the index of given included_directories
	  which is separated by NUL and its index is begun from 1.
	  Note that 0 specifies the current directory of the compilation.
	  see also http://www.dwarfstd.org/doc/dwarf-2.0.0.pdf

Thu Jan 13 00:06:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Add warning messages. [ruby-core:34062]

Thu Jan 13 00:00:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Some syscall return unsigned or pointer value.
	  Therefore we should only check the result is -1 or not.
	  [ruby-core:34062]

Wed Jan 12 23:55:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Add 64bit Linux support. Some syscall takes
	  long type arguments.

Wed Jan 12 19:37:10 2011  Tanaka Akira  <akr@fsij.org>

	* vm_dump.c: parenthesize macro arguments.

Wed Jan 12 19:28:23 2011  Tanaka Akira  <akr@fsij.org>

	* vm.c (thread_free): reset ruby_current_thread if it points the
	  thread to free.
	* gc.c (slot_sweep): don't call RUBY_VM_SET_FINALIZER_INTERRUPT if
	  there is no current thread.
	  [ruby-dev:43000]

Wed Jan 12 19:09:29 2011  Tanaka Akira  <akr@fsij.org>

	* enum.c (sort_by_i): reenter check more strictly.
	  (sort_by_cmp): ditto.
	  [ruby-dev:43003] reported by Usaku NAKAMURA.

Wed Jan 12 16:25:12 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/net/http.rb (Net::HTTP#connect): makes it timeout during
	  SSL handshake too. [ruby-core:34203]
	  Patch by Marc Slemko.

	* test/net/http/test_http.rb (TestNetHTTP_v1_2#test_timeout_during_HTTP_session):
	  test for [ruby-core:34203]

	* test/net/http/test_https.rb (TestNetHTTPS#test_timeout_during_SSL_handshake):
	  ditto.

Wed Jan 12 16:24:53 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/readline/extconf.rb: new checks for RL_PROMPT_START_IGNORE
	  and RL_PROMPT_END_IGNORE. [ruby-core:34331]

	* ext/readline/readline.c: enables USE_INSERT_IGNORE_ESCAPE only if
	  RL_PROMPT_{START,END}_IGNORE are available to get rid of compilation
	  error with libedit.

Wed Jan 12 15:53:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* README.EXT.ja (rb_ensure): typo.

Wed Jan 12 11:33:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: OpenBSD uses the elf_abi.h header file instead of the
	  elf.h header file. patched by Jeremy Evans [ruby-core:34384]

Wed Jan 12 03:59:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/webrick/test_cgi.rb: Removes usage of deprecated
	  :RequestHandler option.
	  patched by Peter Weldon [ruby-core:34010]

	* test/webrick/test_httpproxy.rb: ditto.

	* test/webrick/test_httpserver.rb: Add a test of the deprecation
	  behaviour.

Wed Jan 12 08:37:07 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (hash_i): return different values for inverse hash.
	  [ruby-core:34334]

Tue Jan 11 20:32:59 2011  Tanaka Akira  <akr@fsij.org>

	* variable.c: parenthesize macro arguments.

Tue Jan 11 13:06:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* array.c (rb_ary_resize): should care of embeded array when extending
	  the array.

	* array.c (rb_ary_resize): need to set capa when changing the real
	  size of the array.
	  these are latent bugs.

Mon Jan 10 22:46:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): HFS+ is case
	  insensitive.

	* load.c (loaded_feature_path, rb_feature_p, load_lock): on a
	  case-insensitive filesystem, loaded features search should
	  ignore case.  [ruby-core:34297]

Mon Jan 10 21:34:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags): show LD commands.

Mon Jan 10 14:32:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_method.rb (TestMethod#test_define_method): method
	  transplanting between class and module is impossible.

Mon Jan 10 13:51:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/rdoc-mode.el (rdoc-mode): show trailing whitespace.

Mon Jan 10 11:22:02 2011  Tanaka Akira  <akr@fsij.org>

	* util.c: parenthesize macro arguments.

Mon Jan 10 07:41:31 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/README: mention rdoc-mode.el and ruby-style.el.

Sun Jan  9 20:37:21 2011  Tanaka Akira  <akr@fsij.org>

	* transcode.c: parenthesize macro arguments.

Sun Jan  9 16:31:53 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* io.c (Kernel.#syscall): implemented on LP64/LLP64 environments too.
	  also uses __syscall if available for *BSD on 64bit architecture.
	  [ruby-core:34062]

Sun Jan  9 16:31:34 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale::LOCALE_NAME_RE):
	  some platform has a locale without territory but with
	  encoding.
	  (#each_sub_locale): ditto.

Sun Jan  9 14:47:50 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c: apply a patch from Nobuyoshi Nakada.
	  fixed #3616 [ruby-core:31484] IRB + readline incorrectly counts
	  non-printing characters in prompt

Sat Jan  8 21:47:26 2011  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_sort_by): use rb_ary_resize.
	  (ary_cutoff): removed.

Sat Jan  8 21:24:17 2011  Tanaka Akira  <akr@fsij.org>

	* pack.c (swapf): compilation condition simplified.
	  (swapd): ditto.

Sat Jan  8 20:51:25 2011  Tanaka Akira  <akr@fsij.org>

	* pack.c (swapd): remove duplicated code.

Sat Jan  8 19:28:55 2011  Tanaka Akira  <akr@fsij.org>

	* thread.c: parenthesize macro arguments.

Fri Jan  7 23:07:40 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): backref needs to capture.

Fri Jan  7 21:57:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-variables), misc/ruby-style.el:
	  show trailing whitespace.

	* misc/ruby-mode.el (ruby-font-lock-syntactic-keywords): highlight
	  regexp after open bracket.  [ruby-core:34183]

Fri Jan  7 00:37:35 2011  Tanaka Akira  <akr@fsij.org>

	* string.c: parenthesize macro arguments.

Thu Jan  6 22:42:02 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigmul1_karatsuba): avoid overflow that make assertion
	  fail in certain case.  this patch is contributed from Ray Chason
	  <chasonr at gmail.com> in personal communication.

Thu Jan  6 20:55:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): ignore rest from first dot from
	  TARGET to generate init function name.
	  this is followup of r30464.

Thu Jan  6 11:27:01 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/tree_builder.rb (start_mapping): tags
	  should not be included in JSON mapping

Thu Jan  6 09:23:33 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/protocol.rb (eof?): BufferedIO should proxy eof? to the
	  underlying IO object.

Thu Jan  6 09:12:31 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/mkmf.rb (configuration): fixing gsub when multiple error flags
	  are passed to GCC.

Thu Jan  6 05:25:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_modify): export.

Thu Jan  6 05:14:41 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (get_strio, strio_set_string)
	  (strio_reopen): check if frozen.  [ruby-core:33648]

Thu Jan  6 05:10:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_resize): new utility function.  [ruby-dev:42912]

Thu Jan  6 05:03:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (init_funcname_len): ignore rest from first dot.
	  [ruby-dev:41774]

Thu Jan  6 02:55:48 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: use YAML 1.0 output
	  format for serializing nil values.  Thanks Eric Hodel!

	* test/psych/test_nil.rb: test for nil values

Wed Jan  5 14:21:34 2011  Mark Dodwell  <hi@mkdynamic.co.uk>

	* string.c: fix rdoc typo.
	  https://github.com/shyouhei/ruby/pull/3

Wed Jan  5 14:06:01 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_options.rb (TestRDocOptions#test_check_files):
	  skip on Windows because chmod 0 doesn't mean unreadable by owner.

Wed Jan  5 13:56:54 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/net/http.rb (Net::HTTP#get): A header hash given should not
	  be modified.

Wed Jan  5 12:10:08 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/dl/{cfunc.c,dl.h,handle.c}, ext/fiddle/fiddle.{h,c}: Use _WIN32
	  rather than checking for windows.h.  Thanks Jon Forums!
	  [ruby-core:33977]

Sat Jan  1 17:02:50 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale#search_file): make it possible
	  to load a localization from a gem.
	  (IRB::Locale#lc_path): obsoleted because of the change of #search_file
	  (IRB::Locale#each_localized_path): new private method, based on
	  lc_path
	  (IRB::Locale#find): follows the change of #search_file.
	  (IRB::Locale#load): removed duplicate with #find.

Sat Jan  1 11:44:42 2011  Tanaka Akira  <akr@fsij.org>

	* strftime.c: parenthesize macro arguments.

Sat Jan  1 11:10:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c: take care of platforms where long is bigger
	  than int.

Sat Jan  1 11:03:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS (optparse): shell completion support.

	* misc/README (rb_optparse.{bash,zsh}): for shell completion.

	* include/ruby/intern.h (VALUE rb_ary_print_on): I have never seen
	  this function anywhere.

Sat Jan  1 04:20:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* win32/win32.c (rb_w32_write_console): don't raise exception when
	  the conversion is for writing to console.
	  Patched by Heesob Park [ruby-core:33999]

Fri Dec 31 12:02:06 2010  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_sort_by): use less temporary objects.

Fri Dec 31 11:46:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags), lib/mkmf.rb (configuration): turn
	  warnings into errors only for bundled extensions.
	  [ruby-core:33815]

Fri Dec 31 11:15:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (sizeof): zlib.h mistakenly assumes the result
	  of sizeof to be int, not size_t.

Fri Dec 31 10:27:34 2010  Tanaka Akira  <akr@fsij.org>

	* st.c: parenthesize macro arguments.

Fri Dec 31 03:23:26 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD__uqtoa): Fix overflow when long != quad_t.
	  patched by Peter Weldon <peter.weldon AT null.net>
	  [ruby-core:33985]

Fri Dec 31 03:00:34 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* Makefile.in: remove unnecessary semicolons.

Thu Dec 30 23:09:47 2010  wanabe  <s.wanabe@gmail.com>

	* vm.c (vm_define_method): guard iseq from GC while method definition.
	  [ruby-dev:42832]

Thu Dec 30 20:18:32 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: ditto.

Thu Dec 30 20:57:09 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* Makefile.in: Check V=1 argument if run "make clean" or similar.

Thu Dec 30 20:41:50 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* Makefile.in: Kill ugly line continuation.

Thu Dec 30 11:49:40 2010  Tanaka Akira  <akr@fsij.org>

	* sprintf.c: parenthesize macro arguments.

Wed Dec 29 21:20:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (maygvl_copy_stream_wait_readwrite): define if USE_SENDFILE

Wed Dec 29 20:37:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: strip current directory prefix.

	* enc/depend (clean): remove name2ctype.h when out-of-place build.

	* win32/Makefile.sub (clean-enc): pass V to inferior make.

Wed Dec 29 18:23:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_expr_str): need to escape if the coderange is invalid.

Wed Dec 29 10:06:51 2010  Tanaka Akira  <akr@fsij.org>

	* signal.c: parenthesize macro arguments.

Wed Dec 29 07:22:15 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rake/rdoctask.rb: Deprecate in favor of rdoc/task.

Wed Dec 29 07:07:06 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 3.1

Tue Dec 28 18:36:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* error.c, include/ruby/intern.h (rb_compile_error_with_enc): new
	  function to raise syntax error, with source encoding'ed message.

	* parse.y (compile_error): use above function.
	  [ruby-core:33951] (#4217)

Tue Dec 28 07:37:38 2010  Tanaka Akira  <akr@fsij.org>

	* ruby.c: parenthesize macro arguments.

Tue Dec 28 07:17:11 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add ARGF.write and so on.

Tue Dec 28 07:12:38 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add new magic-comment. (warn-indent) [ruby-core:25442]

Tue Dec 28 04:32:37 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/extconf.rb: check for windows.h while building fiddle.
	  Thanks Jon Forums! [ruby-core:33923]

Tue Dec 28 01:45:12 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: Add Zlib.deflate and Zlib.inflate.
	  [ruby-dev:42833]

Mon Dec 27 21:22:33 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/configure.bat: Remove obsoleted coding rule. Now, we
	  don't support to build on Windows 95/98 and Me.

Mon Dec 27 18:27:13 2010  Tanaka Akira  <akr@fsij.org>

	* re.c: parenthesize macro arguments.

Mon Dec 27 15:22:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/README.win32: note to need NT based OS to build ruby.

Mon Dec 27 12:14:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (EXTMK_ARGS): specify to pass macro V, because nmake
	  doesn't pass it via MAKEFLAGS.

Mon Dec 27 10:33:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (Init_zlib): Add Zlib.deflate and Zlib.inflate.
	  [ruby-dev:42833]

Mon Dec 27 07:38:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: add compdef for generator.

Mon Dec 27 07:32:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/optparse.rb (OptionParser#compsys): escape brackets too.
	  [ruby-dev:42754]

Mon Dec 27 01:30:08 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: add IF_NAMESIZE.
	  add a default for INET6_ADDRSTRLEN.

Sun Dec 26 23:49:47 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: suppress a strange error message when RMALL
	  found no such file.
	* win32/rmall.bat: new.

Sun Dec 26 21:23:23 2010    <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: fix 'nmake clean-enc' breakage since r28322.

Sun Dec 26 22:25:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/depend (ripper.y): fix messages with nmake.
	  [ruby-dev:42896]

Sun Dec 26 22:24:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): get rid of warnings caused by
	  -Wdeclaration-after-statement on cygwin.

Sun Dec 26 20:28:34 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec): add small comment.

Sun Dec 26 20:52:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: define INET_ADDRSTRLEN as 16 if not
	  available.  fix compilation error on mswin32-60.  reported by nobu.

Sun Dec 26 19:37:37 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c: define IFNAMSIZ if not available.
	  fix compilation error on mingw32.  reported by nobu.

Sun Dec 26 12:16:29 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths::HOMEDIR): no exception if
	  HOME is not set.  [ruby-core:33867]

Sun Dec 26 11:39:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): missing ripper rule.  i.e., `a::B ||= c 1'.
	  http://twitter.com/#!/wannabe53/status/18797576396472321
	  http://twitter.com/#!/wannabe53/status/18798416150663168

Sun Dec 26 11:15:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/with_different_ofs.rb (DifferentOFS): should not affect
	  original classes.

Sun Dec 26 09:35:07 2010  Tanaka Akira  <akr@fsij.org>

	* rational.c: parenthesize macro arguments.

Sun Dec 26 09:22:19 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (rb_if_indextoname): new function to abstract
	  environments without if_indextoname.
	  (inspect_ipv6_multicast_if): new function to inspect
	  IPV6_MULTICAST_IF.
	  Socket::Option.new(:INET6, :IPV6, :MULTICAST_IF,
	  [2].pack("I!")).inspect is
	  "#<Socket::Option: INET6 IPV6 MULTICAST_IF eth0>".

Sun Dec 26 04:31:15 2010  Luis Lavena  <luislavena@gmail.com>

	* ext/dl/win32/registry.rb: Corrected RegCreateKeyExA signature.
	  Patch by Rafal Michalski [ruby-core:33874] [Ruby 1.9-Bug#4203]

Sun Dec 26 02:31:58 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (advice_arg_check): Change argument check.
	  Now, an unsupported advice makes NotImplementedError.
	  [ruby-dev:42887] [Ruby 1.9-Feature#4204]

Sun Dec 26 03:00:53 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/extconf.rb: Fix build error which was introduced r30372.

Sun Dec 26 01:37:10 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: check the existence of if_indextoname().

	* ext/socket/option.c: yesterday's akr's commits destroyed the build of
	  some unrelated platforms (such as Windows).

Sat Dec 25 23:29:11 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_ipv4_add_drop_membership): new function
	  to inspect struct ip_mreq and struct ip_mreqn for
	  IP_ADD_MEMBERSHIP and IP_DROP_MEMBERSHIP.
	  Socket::Option.new(:INET, :IP, :ADD_MEMBERSHIP,
	  [239,255,99,81, 0,0,0,0].pack("CCCCCCCC")).inspect is now
	  "#<Socket::Option: INET IP ADD_MEMBERSHIP 239.255.99.81 0.0.0.0>".
	  (inspect_ipv4_multicast_if): new function to inspect struct in_addr
	  and struct ip_mreqn for IP_MULTICAST_IF.
	  Socket::Option.new(:INET, :IP, :MULTICAST_IF,
	  [192,168,0,7].pack("CCCC")).inspect is now
	  "#<Socket::Option: INET IP MULTICAST_IF 192.168.0.7>".

	* ext/socket/extconf.rb: check struct ip_mreq and struct ip_mreqn.

Sat Dec 25 22:49:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv: DifferentOFS needs to be include in each classes.

	* test/digest/test_digest_extend.rb (TestDigestExtend#setup):
	  should not depend on the result of previous tests

	* test/with_different_ofs.rb (DifferentOFS::WithDifferentOFS): give
	  name.

	* test/with_different_ofs.rb (DifferentOFS): test suite for test
	  suites affected by $,.

	* test/digest/test_digest_extend.rb (TestDigestExtend): should not
	  assume $, invariant.

	* test/csv/test_data_converters.rb, test/csv/test_table.rb: don't
	  call setup within tests.

Sat Dec 25 20:01:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (pipe_open): Added rb_thread_atfork(). We must reinitialize
	  GVL at new process creation.

Sat Dec 25 18:26:55 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_ipv6_mreq): new function to inspect
	  struct ipv6_mreq for IPV6_JOIN_GROUP and IPV6_LEAVE_GROUP.
	  Socket::Option.new(:INET6, :IPV6, :JOIN_GROUP,
	  [0xff12,0,0,0,0,0,0,1, 2].pack("nnnnnnnnI!")).inspect is now
	  "#<Socket::Option: INET6 IPV6 JOIN_GROUP ff12::1 eth0>".

	* ext/socket/extconf.rb: check struct ipv6_mreq.

Sat Dec 25 18:04:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/csv.rb (CSV.foreach): 'rb' mode is defaulted in open.

	* lib/csv.rb (CSV#init_separators): cannonicalize encoding options
	  as Encoding objects.

Sat Dec 25 18:30:34 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_atfork): Add small comment why we need
	  reset random seed.

Sat Dec 25 17:33:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv/base.rb (TestCSV.with_different_ofs): give name to
	  anonymous classes.

	* lib/csv.rb (CSV#init_separators): use IO#gets with length
	  parameter to get rid of wrong convertion.

	* lib/csv.rb (CSV::foreach, CSV#initialize): directly use encoding

	* lib/csv.rb, test/csv: should not assume $, invariant.

Sat Dec 25 16:08:06 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c: change rb_atomic_t definition from uchar to uint.

Sat Dec 25 15:04:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv/test_encodings.rb (TestEncodings#setup): fix evil test
	  suite writing to the source directory.

Sat Dec 25 15:08:08 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/pty/pty.c (chfunc): Added rb_thread_atfork_before_exec().
	  We must reinitialize GVL at new process creation. Otherwise
	  we may meet an insane deadlock. [Bug#4121][ruby-dev:42686]

Sat Dec 25 14:27:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_extract_encoding_option): accept Encoding object as
	  encoding: optional argument.  [ruby-dev:42884]

Sat Dec 25 13:37:55 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.2 r6093.

Sat Dec 25 13:05:59 2010  Tanaka Akira  <akr@fsij.org>

	* random.c: parenthesize macro arguments.

Sat Dec 25 12:48:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_f_require_relative): don't omit return type.

Sat Dec 25 11:06:00 2010  Eric Hodel  <drbrain@segment7.net>

	* load.c (rb_f_require_relative): Add documentation.

Sat Dec 25 11:02:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzreader_gets): support optional length
	  parameter.

	* ext/zlib/zlib.c (gzfile_read, gzfile_readpartial): length should
	  be long.

Sat Dec 25 10:51:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/generator/generator.{c,h} (fbuffer_free_only_buffer):
	  unused.

	* ext/openssl/ossl_pkcs5.c (ossl_pkcs5_pbkdf2_hmac): add casts.

Fri Dec 24 08:46:04 2010  Tanaka Akira  <akr@fsij.org>

	* process.c: parenthesize macro arguments.

Thu Dec 23 19:17:14 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/net/imap/cacert.pem: updated because it has been expired.

	* test/net/imap/server.crt: signed again because CA cert was expired.

Thu Dec 23 11:16:52 2010  Tanaka Akira  <akr@fsij.org>

	* parse.y: parenthesize macro arguments.

Thu Dec 23 11:00:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_type): check for type from extensions for ruby
	  1.8.  see [ruby-core:33797].

Thu Dec 23 08:12:59 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/smtp.rb: refactoring Net::SMTP#esmtp= to use an
	  attr_accessor

Thu Dec 23 06:35:41 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/smtp.rb: Net::SMTP should close the SSL connection if the
	  connection verification fails.

Thu Dec 23 01:47:58 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: remove #object_id. [ruby-dev:42840]

Wed Dec 22 08:56:39 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add Module#private_constant and Module#public_constant.
	  [ruby-dev:39685][ruby-core:32698]

Wed Dec 22 07:59:23 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add IO#advise. [ruby-core:33110] [Ruby 1.9-Feature#4038]

Tue Dec 21 23:45:31 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (Init_GC): move back object_id to Kernel. [ruby-dev:42840]

Tue Dec 21 12:45:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (target_archs): remove temporary objects.

	* enc/Makefile.in, enc/depend (clean): remove work directories.

Tue Dec 21 07:39:12 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: parenthesize macro arguments.

Tue Dec 21 06:25:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rexml/test_contrib.rb (ContribTester#test_pos): should not
	  use fixed path name for tests.  [ruby-dev:42827]

	* test/rexml/test_sax.rb (SAX2Tester#test_socket): should not use
	  fixed port for tests.  [ruby-dev:42828]

Tue Dec 21 06:10:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (caller_setup_args): reverted r30241 and r30243
	  except for the test.

Tue Dec 21 01:41:42 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* io.c : add an extra byte to buffer for the specification of read
	  in Windows. see [ruby-core:33460] and r29980. and, we have to
	  discuss how to do this one byte.

Tue Dec 21 01:18:06 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c: Fix build error for win32. This regression was
	  introduced by r30271.

Tue Dec 21 00:59:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_cleanup_func): Moved interrupted_lock
	  destroying code from native_thread_destroy() to
	  thread_cleanup_func() because it's platform independent logic.

	* thread_win32.c (native_thread_destroy): ditto.
	* thread_pthread.c (native_thread_destroy): ditto.

Tue Dec 21 00:46:20 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_cleanup_func): Don't touch native threading
	  resource at fork. Sadly this is purely bandaid. We need to
	  implement proper fix later. [Bug #4169] [ruby-core:33767]

Tue Dec 21 00:22:44 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c (exit_success_p): Check status code more carefully.
	  status code may have garbage in upper bit.

Mon Dec 20 23:12:37 2010  Tanaka Akira  <akr@fsij.org>

	* node.c: parenthesize macro arguments.

Mon Dec 20 20:04:41 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add #__id__ and #object_id. [ruby-dev:42778]

Mon Dec 20 20:03:21 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_thread_destroy): Fixed gvl_cond leak.

Mon Dec 20 13:49:05 2010  Eric Hodel  <drbrain@segment7.net>

	* NEWS: Add item for RDoc 3.0.1

	* lib/rdoc: Import RDoc 3.0.1, remove require for perl parser.

Mon Dec 20 12:15:32 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 3.0.

Mon Dec 20 01:55:03 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (Init_IO): Added O_DIRECT. This feature was proposed by
	  Run Paint Run Run.
	  [Feature #4015] [ruby-core:33018]

Sun Dec 19 19:15:23 2010  Tanaka Akira  <akr@fsij.org>

	* marshal.c: parenthesize macro arguments.

Sat Dec 18 21:52:37 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vsnprintf.c (BSD_vfprintf): suppress warning: "_WIN32" is not
	  defined.

Sat Dec 18 16:02:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (caller_setup_args): fix of r30241. lambda block
	  should check argument number.

Sat Dec 18 14:42:29 2010  Tanaka Akira  <akr@fsij.org>

	* load.c: parenthesize macro arguments.

Sat Dec 18 10:07:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args, iseq_compile_each): optimize AMPER LAMBDA
	  combination as block.

Fri Dec 17 22:07:16 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (Init_GC): move #__id__ and #object_id to BasicObject.
	  [ruby-dev:42778]

Fri Dec 17 19:35:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf::FakeLog): capture output from mkmf.

	* test/mkmf/test_find_executable.rb (test_find_executable):
	  suppress meaningless differences for chkbuild.

Fri Dec 17 13:26:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak (BASERUBY): quit with an error when BASERUBY was not
	  able to set, just like configure.in does. [ruby-dev:42782]

Fri Dec 17 07:04:09 2010  Tanaka Akira  <akr@fsij.org>

	* iseq.c: parenthesize macro arguments.

Fri Dec 17 04:18:37 2010  Eric Hodel  <drbrain@segment7.net>

	* transcode.c (str_encode): Alter comment for better wording and ri
	  output.

Fri Dec 17 00:05:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_advise): New API. IO#advise() allows to tell the
	  ruby runtime how it expects to use a file handle. This feature
	  can be improved a performance some situations.
	  Note: This feature is mainly developed by Run Paint Run Run.
	  Thank you! [ruby-core:33110] [Ruby 1.9-Feature#4038]

	* io.c (do_io_advise): Helper function.
	* io.c (io_advise_sym_to_const): ditto.

Thu Dec 16 23:29:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (bin-comm): use transformed name.
	  [ruby-dev:42777]

Thu Dec 16 21:52:07 2010  Tanaka Akira  <akr@fsij.org>

	* io.c: parenthesize macro arguments.

Thu Dec 16 21:46:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb (RbConfig): honor ARCHFLAGS and RC_ARCHS to
	  override embedded ARCH_FLAG value on universal-darwin.

Thu Dec 16 19:50:12 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{configure.bat,setup.mak,Makefile.sub} (PROGRAM_PREFIX,
	  PROGRAM_SUFFIX): unite the differences of the names of macros of
	  prefix and suffix.
	  reported by HANEDA Norikatsu. [ruby-dev:42775]

Thu Dec 16 08:04:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (RNode): match the type of flags to RBasic, and renamed
	  nd_file as nd_reserved.

	* iseq.c (set_relation), vm_insnhelper.c (vm_cref_push): nd_file
	  is always zero-cleared.

Thu Dec 16 07:22:30 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/unit.rb: Imported minitest 2.0.1 r6079.

Wed Dec 15 20:45:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb (process_args): need to setup @help to print options.

Wed Dec 15 11:19:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/zlib/test_zlib.rb (test_to_io): forgotten to fix with r30201.

Wed Dec 15 11:07:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (simple_sendfile): enable on Mac OS X.

	* io.c (nogvl_copy_stream_sendfile): moved precheck of copy length.

	* io.c (nogvl_copy_stream_sendfile): should wait for both of
	  read/write fds.

Wed Dec 15 07:11:55 2010  Tanaka Akira  <akr@fsij.org>

	* hash.c: parenthesize macro arguments.

Wed Dec 15 04:02:00 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_set_config):
	  fix compile error when !HAVE_X509V3_SET_NCONF. Thanks
	  Chikanaga-san. [ruby-dev:42761] [Ruby 1.9-Bug#4158]

Wed Dec 15 03:41:31 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ripper/test_parser_events.rb (TestRipper#test_block_variables):
	  Limit address space 100MB instead 100KB. Quite frankly, This
	  margin is too narrow to contain ruby. [ruby-dev:42763] [Bug#4159]

Tue Dec 14 23:53:52 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): improve linux compatibility on FreeBSD,
	  and now it works. But without cpuset -l 0, it still gets stuck.

Tue Dec 14 20:31:33 2010  Tanaka Akira  <akr@fsij.org>

	* gc.c: parenthesize macro arguments.

Tue Dec 14 18:31:48 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb: help messages.

Tue Dec 14 18:19:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (help): there is no reason to use the abbreviation for here.

Tue Dec 14 15:03:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (test_reopen, test_reinitialize): should close
	  the temporary files.

Tue Dec 14 14:24:15 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (make_tempfile): change the prefix from 'foo'
	  to 'test_io' because the old one is meaningless and inconvenient.

	* test/ruby/test_io.rb (test_binmode_after_closed): the temporary file
	  maked by make_temfile is already closed.

Tue Dec 14 13:52:19 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (test_flush_in_finalizer[12]): should close
	  temporary file because it's only used for taking pathname and
	  unlinking the file after the end of the test (in GC phase).

Tue Dec 14 13:34:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_s_open): should close the IO if some error
	  occurs in initializing.

Tue Dec 14 13:04:16 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPRequest#send_request_body_data):
	  set binmode to tempfile.

Tue Dec 14 12:55:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/zlib/test_zlib.rb (*): should close files associated with zlib.

Tue Dec 14 11:30:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_argf.rb (test_inplace_rename_impossible): unlink
	  the renamed temporary file on no_safe_rename platforms.

	* test/ruby/test_argf.rb (test_readlines_limit_0,
	  test_each_line_limit_0): should close argf because the associated
	  Tempfile object cannot unlink the temporary file when it's gc'ed
	  on some platforms (Windows, etc.)

Tue Dec 14 11:27:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/minitest/unit.rb (Minitest::Unit#_run_suite): split test
	  name and its time. Thiw allows to know test's name when you are
	  running tests and meet a test which spends long time at realtime.

Tue Dec 14 11:25:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: Add -Werror=declaration-after-statement to default
	  warning flag. If you are using GCC, this flag is useful to
	  prevent breaking VC build.

Tue Dec 14 10:25:57 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode0): how many gcc-c99isms
	  must a man mend; before he can build with VC? r30178

Mon Dec 13 21:26:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): disable the use of sendfile(2) on
	  FreeBSD. It blocks on TestIO#test_copy_stream_socket.

Mon Dec 13 18:35:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c: define USE_SENDFILE on FreeBSD or DragonFly BSD.
	  Remove Mac OS X because its argument is different from them.

Mon Dec 13 12:00:09 2010  Tanaka Akira  <akr@fsij.org>

	* file.c: parenthesize macro arguments.

Mon Dec 13 11:21:14 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): added for BSD version of sendfile(2).

Mon Dec 13 09:50:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPRequest#set_form): Added to support
	  both application/x-www-form-urlencoded and multipart/form-data.
	  There is a similar API, Net::HTTPRequest#set_form_data, but
	  to keep its compatibility this is newly added. [ruby-dev:42729]

Sun Dec 12 23:45:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): fix for __goto__ and __label__
	  where were totally broken.

Sun Dec 12 22:45:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ID_H_INCLUDES): now id.h depends on vm_opts.h.

Sun Dec 12 20:42:47 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* template/id.h.tmpl: suppress all warning: "SUPPORT_JOKE" is not
	  defined.  [ruby-dev:42730]

Sun Dec 12 20:35:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: update how to install.

	* misc/rb_optparse.zsh: avoid error when setopt noclobber.

	* lib/optparse.rb: fix typo. pointed out at
	  <http://d.hatena.ne.jp/nagachika/20101207>.

Sun Dec 12 13:27:35 2010  Tanaka Akira  <akr@fsij.org>

	* eval_error.c: parenthesize macro arguments.

Sun Dec 12 11:53:24 2010  Tanaka Akira  <akr@fsij.org>

	* error.c: parenthesize macro arguments.

Sun Dec 12 04:01:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): fix: extra back slash is added when
	  the string is dummy encoding and includes \x22 or \x5C.

Sun Dec 12 02:42:24 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_asn1.c: indefinite length BER to DER encoding is
	  properly supported.  Thanks Martin Bosslet! [ruby-core:33082]

Sat Dec 11 17:43:34 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/bigdecimal/bigdecimal.h: suppress "warning: 'VPrint' declared
	  'static' but never defined".

Sat Dec 11 09:24:57 2010  Tanaka Akira  <akr@fsij.org>

	* encoding.c: parenthesize macro arguments.

Sat Dec 11 08:12:48 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c, ext/openssl/ossl_pkey_rsa.c: Document RSA, RSA
	  encryption/decryption and PKCS #5 encryption/decryption.

Sat Dec 11 06:23:41 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_x509name.c: include Comparable to provide #==.
	  Document OpenSSL::X509::Name#<=>.  [Ruby 1.9-Feature#4116]

Sat Dec 11 05:48:28 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: infinite loop on method_missing at loading.
	  [ruby-dev:42716] [Ruby 1.9-Bug#4129]

	* ext/tk/lib/multi-tk.rb: when no eventloop is running, ruby freezes at
	  exit.

Sat Dec 11 02:23:15 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/extconf.rb: try pkgconfig first, then fall back to
	  normal have_library, etc.  Thanks Erik Hollensbe. [ruby-core:32406]

Fri Dec 10 22:33:39 2010  Tanaka Akira  <akr@fsij.org>

	* dln_find.c: parenthesize macro arguments.

Fri Dec 10 20:05:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/id.h.tmpl (ruby_method_ids): suppress warnings.
	  [ruby-dev:42730]

Fri Dec 10 18:29:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): relatively called non-shared
	  binary cannot be found in PATH, so use given pathname.

Fri Dec 10 18:28:40 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (SCRIPTPROGRAMS): ignore backup files and etc.

	* cygwin/GNUmakefile.in (scriptbin): set executable bit.

	* tool/rbinstall.rb (install_recursive): always skip default ignored
	  files.  if block is given, call it instead of calling install.

	* tool/rbinstall.rb (bin-comm): use install_recursive.

Fri Dec 10 18:12:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf#config_value): extract macro value from
	  config.h.

	* test/mkmf/test_sizeof.rb (TestMkmf::TestSizeof#test_sizeof_builtin),
	  (TestMkmf::TestSizeof#test_sizeof_struct): more tests.

	* lib/mkmf.rb (check_signedness): should use the prelude code.
	  [ruby-dev:42731]

	* lib/mkmf.rb (Logging.log_close): separate from Logging.logfile.

	* test/mkmf/base.rb (TestMkmf::MKMFLOG): show mkmf.log at failures.

	* test/mkmf/base.rb (TestMkmf#teardown): close log file for each tests.

Fri Dec 10 11:36:43 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* compile.c (enum): remove a comma at end of enumerator list.

	* constant.h (rb_const_flag_t): ditto.

	* iseq.h (enum catch_type): ditto.

	* iseq.h (enum defined_type): ditto.

	* vm_core.h (enum iseq_type): ditto.

	* vm_core.h (enum vm_special_object_type): ditto.

Fri Dec 10 10:47:53 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (_HAVE_SANE_QUAD_): Don't forget LP64, r30156.

Fri Dec 10 10:37:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* sprintf.c (_HAVE_SANE_QUAD_): if a certain platform has LONG_LONG in
	  8 byte, it might be sane quad. [ruby-core:33634]

Fri Dec 10 10:07:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: remove version 1.1 features.

Fri Dec 10 02:18:02 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_cleanup): removing C
	  implementation of `cleanup`.

	* ext/openssl/lib/openssl/x509.rb: adding ruby implementation of
	  `cleanup`.  OpenSSL::X509::StoreContext#cleanup is deprecated since
	  reusing the underlying struct doesn't make sense. [ruby-dev:42546]

Thu Dec  9 20:14:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lvar_defined_gen, shadowing_lvar_gen, dvar_defined): no
	  warnings for unused method and block arguments.
	  [ruby-dev:42718] [ruby-dev:42724]

Thu Dec  9 19:25:49 2010  Tanaka Akira  <akr@fsij.org>

	* dln.c: parenthesize macro arguments.

Thu Dec  9 18:51:06 2010  Tanaka Akira  <akr@fsij.org>

	* lib/webrick/accesslog.rb (WEBrick::AccessLog#format): support
	  %{remote}p for logging remote (client) port number.
	  [ruby-dev:42670]

Thu Dec  9 11:00:30 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_dup): should copy contents only.  no instance
	  variable, no class would be copied.  it would affect methods
	  #sort, #reject, #transpose, #uniq, #compact, and #shuffle.
	  [ruby-core:33640]

	* array.c (rb_ary_reverse_m): ditto.

	* array.c (rb_ary_rotate_m): ditto.

Wed Dec  8 21:38:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl/lib/dl/struct.rb: clean a warning: assigned but unused
	  variable. patched by Kouhei Yanagita. [ruby-dev:42722]

	* ext/dl/lib/dl/import.rb: ditto.

Wed Dec  8 21:36:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (shadowing_lvar_gen): fix line number.  [ruby-dev:42718]

Wed Dec  8 20:37:11 2010  Tanaka Akira  <akr@fsij.org>

	* dir.c: parenthesize macro arguments.

Tue Dec  7 22:37:15 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* io.c (io_read): duplicate string if shared. [ruby-dev:42719]

Tue Dec  7 22:31:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Officious): separate completion
	  options from --help.  [ruby-dev:42690]

	* lib/optparse.rb (OptionParser::Completion#candidate),
	  (OptionParser::Switch#compsys): remove unused variables.

Tue Dec  7 22:05:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_loop): call default handler of the given
	  hash, method, proc or [] method as fallback.  [ruby-dev:42692]

Tue Dec  7 21:59:37 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/light/node.rb: remove circular require.

Tue Dec  7 21:56:01 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_light.rb: really suppress a warning.

Tue Dec  7 21:51:57 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_light.rb: suppress a warning.

Tue Dec  7 21:14:03 2010  Tanaka Akira  <akr@fsij.org>

	* debug.c: parenthesize macro arguments.

Tue Dec  7 21:06:38 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/doctype.rb, test/rexml/test_doctype.rb: suppress warnings.
	  [ruby-core:33305]
	  Reported by Aaron Patterson. Thanks!!!

Tue Dec  7 18:56:52 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (String#kconv): fix typo and update rdoc.
	  patched by Kouhei Yanagita [ruby-dev:42696]

Tue Dec  7 20:32:11 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_doctype.rb: add Accessor to test case name.

Tue Dec  7 20:31:02 2010  Kouhei Sutou  <kou@clear-code.com>

	* test/rexml/test_doctype.rb: Doctype -> DocType.

Tue Dec  7 20:29:23 2010  Kouhei Sutou  <kou@clear-code.com>

	* test/rexml/test_doctype_mixin.rb: rename to ...
	* test/rexml/test_doctype.rb: ... this to remove needless name.

Tue Dec  7 17:03:16 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (xlist): supported the XLIST command, which is an
	  extension by Apple and Google.  patch by Geoff Youngs.
	  [ruby-core:33521]

Tue Dec  7 08:00:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, win32/Makefile.sub (WERRORFLAG): flag to treat
	  warnings as errors.

	* lib/mkmf.rb (Logging.postpone): yield log file object.

	* lib/mkmf.rb (xsystem): add options, :werror only right now.

	* lib/mkmf.rb (with_werror): check as if warnings are errors.

	* lib/mkmf.rb (convertible_int): make declaration conflict
	  warnings errors not to pass wrong type.  [ruby-dev:42684]

	* lib/mkmf.rb (COMMON_MACROS): get rid of conflicts.

	* win32/Makefile.sub (WARNFLAGS): make declaration conflict
	  warnings errors if possible.

Sun Dec  7 21:16:10 2010  Tanaka Akira  <akr@fsij.org>

	* cont.c: parenthesize macro arguments.

Tue Dec  7 00:27:14 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* win32/win32.c (rb_w32_read): fixed more for readline,
	  and so on. [ruby-core:33511]

Mon Dec  6 23:18:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf#setup): run quietly.

	* test/mkmf/test_find_executable.rb (test_find_executable): use
	  configured results.

	* common.mk (test-build): test for build process.

Mon Dec  6 22:47:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): skip separators.

	* sample/optparse/opttest.rb: should not override --help.
	  [ruby-dev:42690]

Mon Dec  6 19:00:48 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: fix typos.

Mon Dec  6 18:59:04 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add new encodings.

Mon Dec  6 18:56:42 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_string.rb (TestString#test_scan): add a test for
	  [ruby-core:33338] #4087.

Mon Dec  6 18:55:36 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/uri/test_common.rb (TestCommon#test_encode_www_form): add
	  tests for r30015.

Mon Dec  6 10:39:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_pattern):
	  refix for restrict the pattern.

Mon Dec  6 09:45:11 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl (OpenSSL): add toplevel documentation
	* ext/openssl/ossl_ssl.c (SSLContext, SSLSocket: add additional
	  documentation
	* ext/openssl: move "let rdoc know about mOSSL" comments so they don't
	  show up in output

Mon Dec  6 09:16:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_pattern):
	  workaround fix pattern of hostname for RFC 3986. [ruby-dev:42672]

Mon Dec  6 09:14:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/mkmf.rb (check_signedness): rename unused variable prelude.

Sun Dec  5 17:56:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (make_metaclass): fix probable typo.  builtin type flag
	  cannot be used with FL_TEST.

Sun Dec  5 12:09:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/init.rb (IRB.parse_opts): fix typo. [ruby-core:33574]

Sun Dec  5 11:27:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): decrement for ungotten line.
	  [ruby-dev:42680]

Sun Dec  5 10:32:11 2010  Tanaka Akira  <akr@fsij.org>

	* complex.c: parenthesize macro arguments.

Sat Dec  4 11:39:17 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_x509ext.c (initialize): add documentation.

Sat Dec  4 11:21:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_update_by): new API for Hash#update.

Sat Dec  4 11:18:10 2010  Tanaka Akira  <akr@fsij.org>

	* class.c: parenthesize macro arguments.

Sat Dec  4 11:07:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_vm_inc_const_missing_count): missing prototype.

Sat Dec  4 08:50:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Init_iconv): no warnings if $VERBOSE is nil.

Sat Dec  4 08:25:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): revert r30064 and r30071,
	  because of [ruby-core:26761]. Bug#4106 rejected.

Sat Dec  4 07:46:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (String#tr_cpp): substitute * with P like as
	  autoconf.

Fri Dec  3 22:36:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): protected methods should be
	  checked against the real class.

Fri Dec  3 20:23:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (convertible_int): define printf format prefix too.

	* lib/mkmf.rb (convertible_int): detect convertible integer type.
	  port RUBY_REPLACE_INT from configure.in.

	* lib/mkmf.rb (check_sizeof): should return integer always.

Fri Dec  3 12:54:48 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (RCFLAGS): VC10 and after only. fixed the problem
	  of r30015. [ruby-core:33530]

Fri Dec  3 12:41:52 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* gc.c (rb_objspace_free): With our "lazy-sweep" GC engine, it is
	  possible for an object to survive until its surrounding object
	  space is about to be freed.  Those objects, if any, remains
	  leaked for the rest of a process life.  This is problematic
	  because for instance a T_DATA object may have its own destructor
	  to terminate something.

	* vm.c (ruby_vm_destruct): ruby_current_vm termination should be
	  somewhere after rb_objspace_free for above reason.

Fri Dec  3 12:17:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): protected singleton methods should
	  be visible from same real class methods.  [ruby-core:33506]

Fri Dec  3 07:08:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): round upto next char
	  boundary.  [ruby-dev:42674]

Fri Dec  3 06:52:46 2010  Tanaka Akira  <akr@fsij.org>

	* compile.c: parenthesize macro arguments.

Fri Dec  3 04:08:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): use st_insert2 and change return
	  value to int.

	* encoding.c (enc_alias): follow enc_alias_internal.

Fri Dec  3 01:52:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): use xfree instead of free.

Thu Dec  2 23:52:26 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* NEWS: entry for ruby_vm_at_exit().

	* eval.c (ruby_cleanup): bug fix around at_exit (1) timing was
	  wrong. (2) execution order was opposite.

Thu Dec  2 23:05:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (RCFLAGS): -nologo switch is only available in
	  newer versions of rc.exe. fixed the problem of r30012.

Thu Dec  2 21:28:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/add/rails.rb: removed.

Thu Dec  2 21:22:05 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): free the copied key and
	  return NULL when given key is already registered.

	* encoding.c (enc_alias): call set_encoding_const only when the
	  alias is not registered yet.

Thu Dec  2 19:58:24 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm.c (ruby_vm_at_exit): new API.  This enables extension libs to
	  hook a VM termination.  Right now, because the VM we have is
	  process global, most extensions do not deallocate resources and
	  leave them to Operating System's reaping userland processes.  But
	  in a future we plan to have multiple VMs to run simultaneously in
	  a single process (MVM project).  At that stage we can no longer
	  rely on OSes and have to manage every resources to be reclaimed
	  properly.  So it is.  For a forward-compatibility reason this API
	  is introduced now, encouraging you to be as gentle as you can for
	  your resources; that is, tidy up your room.

	* include/ruby/vm.h: ditto.

	* vm_core.h (rb_vm_struct): new field.

	* vm.c (vm_init2): initialize above new field.

	* eval.c (ruby_cleanup): trigger those hooks.

Thu Dec  2 17:00:44 2010  Tanaka Akira  <akr@fsij.org>

	* bignum.c: parenthesize macro arguments.

Thu Dec  2 15:31:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): more fix. [ruby-core:33513]

Thu Dec  2 13:41:43 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): workaround for console reading troubles.
	  fixed [ruby-core:33511]

Thu Dec  2 13:10:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form):
	  split key-value when the value is Array like object.

Thu Dec  2 10:39:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP#set_form_data):
	  use URI.encode_www_form for application/x-www-form-urlencoded.

Thu Dec  2 10:38:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/extmk.rb: remove $makeflags.defined?, it should be $mflags.

Thu Dec  2 10:19:47 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (rc): suppress meaningless message.

Thu Dec  2 10:09:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/generator/extconf.rb: remove the lines which set -O3
	  when -O option is not set.
	  Note that -O3 doesn't always exist.

	* ext/json/parser/extconf.rb: ditto.

Thu Dec  2 10:01:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/extmk.rb: define $makeflags.defined? like $mflags.

Thu Dec  2 07:20:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GCStressOption): --gc-stress
	  option.

	* lib/test/unit.rb (Test::Unit::Mini#_run_suites): show the result
	  even when interrupted on the way.

Thu Dec  2 07:08:38 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (setattr): should retry on EINTR.
	  [ruby-dev:42666]

Thu Dec  2 02:30:50 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb: fixed positional wording to match revised order.

Thu Dec  2 01:24:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/common.rb: don't use iconv on 1.9.
	  patched by Shota Fukumori [ruby-core:33164]

Thu Dec  2 01:02:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Update github/flori/json from 1.4.2+ to
	  e22b2f2bdfe6a9b0. this fixes some bugs.

Thu Dec  2 00:05:44 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  This change the order of chapter because such overview should
	  begin with simple examples.
	  patched by Eric Hodel [ruby-core:33469]

Wed Dec  1 22:01:49 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (Init_Numeric): fixed a potential bug when using bccwin32
	  ruby with Microsoft's dll, though we already gave up of supporting
	  bccwin32. [ruby-core:33503]

Wed Dec  1 21:43:21 2010  Tanaka Akira  <akr@fsij.org>

	* array.c: parenthesize macro arguments.

Wed Dec  1 21:41:57 2010  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_addrinfo.rb: extract Errno::EADDRINUSE as a method.

	* test/socket/test_socket.rb: ditto.

Wed Dec  1 15:08:32 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/openssl/test_ssl.rb (test_not_started_session): non socket
	  argument of SSLSocket.new is not supported on Windows.

Wed Dec  1 14:36:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_memhash): zero-filled strings should return
	  different values.  [ruby-core:33500]

Wed Dec  1 14:27:49 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.0 r5952.
	* test/minitest/*.rb: ditto.
	* lib/test/unit.rb: Compatibility fix for minitest changes.

Wed Dec  1 10:16:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): fix typo (not 0xFD but 0xFE).

Wed Dec  1 09:28:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: Follow .gnu_debuglink section.
	  A user of distribution provided ruby will see line
	  info if s/he has a debug package for ruby.
	  patched by Shinichiro Hamaji [ruby-dev:42655]

Wed Dec  1 01:29:15 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): inspect as a dummy encoding string
	  when a UTF-16/32 (not BE/LE) string does not have a BOM.
	  Unicode and some RFCs say that a string labeled as UTF-16/32
	  doesn't have a BOM, it should be considered big endian.
	  But many Windows programs generates little endian UTF-16
	  strings without a BOM. So String#inspect treats a string
	  labeled UTF-16/32 without a BOM as a dummy encoding string.
	  patched by Martin Duerst. [ruby-core:33461]

Tue Nov 30 17:04:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (parse_debug_line_cu): ignore DW_LNE_set_discriminator.
	  To ignore, it needs to read a single unsigned LEB128 integer.

Tue Nov 30 16:29:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_dump.c: undef HAVE_BACKTRACE when the OS is FreeBSD (in other
	  words backtrace() is libexecinfo) and it is optimized.
	  This temporary hack may be also applied to other libexecinfo
	  environments.

Tue Nov 30 16:23:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by Eric Hodel ref #4100

Tue Nov 30 12:23:52 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): read only 1 byte at once on console.
	  workaround of Windows bug. see [ruby-core:33460].
	  this is not the final solution.

Tue Nov 30 11:39:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by mathew murphy [ruby-core:33472] ref #4100

Tue Nov 30 05:03:44 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/uri/common.rb (encode_www_form, encode_www_form_component):
	  Improve English in documentation.

	* ext/openssl/ossl_ssl.c (ssl_version=, ciphers=): Document
	  #ssl_version=, add documentation for #ciphers=.

Mon Nov 29 22:55:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/uri/common.rb (URI::WFKV_): get rid of backtrack explosion
	  by nested repeat operators.  [ruby-core:33464]

Mon Nov 29 22:53:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (scriptbin.mk): fix generated rules.

	* win32/win32.c (rb_w32_write_console): fix argument type.

Mon Nov 29 21:12:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-forward-sexp): stop after literal hash
	  key labels.

	* misc/ruby-mode.el (ruby-font-lock-keywords): highlight literal
	  hash key labels as symbols.

Mon Nov 29 18:31:31 2010  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb (test_unicode_public_review_issue_121):
	  - Removed commented-out options that are no longer under discussion.
	  - Added two more tests for forthcomming clarifications.

Mon Nov 29 14:31:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_isatty): use GetConsoleMode() to determine the
	  fd is console or not, just like rb_w32_write_console(). [experimental]

Mon Nov 29 14:19:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (rb_w32_write_console): wrong prototype.

Mon Nov 29 14:10:55 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_write_console): fixed indentation.

Sun Nov 28 22:13:39 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (NATIVE_MUTEX_LOCK_DEBUG): move and use it.

	* ChangeLog: fix my timezone.

Mon Nov 28 21:58:58 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c: remove pthread_atfork().

Mon Nov 28 21:54:22 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_cond_*): Check return code.
	  (Some OSes except Linux return error code).

Sun Nov 28 21:46:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (thread_start_func_1): initialize native thread
	  data immediately before starting.

Sun Nov 28 14:56:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (struct argf): make lineno long, and reorder members.

Sun Nov 28 14:55:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_win32.c (gvl_release, gvl_init): suppress warnings.

Sun Nov 28 14:48:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (gvl_release, gvl_init): suppress warnings.

	* vm_core.h (rb_vm_gvl_destroy): add prototype.

Sun Nov 28 14:46:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (gvl_reinit): register atfork handler only in
	  the parent process, to get rid of dead lock.

Sun Nov 28 12:23:57 2010  Koichi Sasada  <ko1@atdot.net>

	* thread.c, vm_core.h: make gvl_acquire/release/init/destruct
	  APIs to modularize GVL implementation.

	* thread_pthread.c, thread_pthread.h: Two GVL implementations.
	  (1) Simple locking GVL which is same as existing GVL.
	  (2) Wake-up queued threads.  The wake-up order is simple FIFO.
	     (We can make several queues to support exact priorities, however
	      this causes some issues such as priority inversion and so on.)
	      This impl. prevents spin-loop (*1) caused on SMP environments.
	  *1: Only one Ruby thread acquires GVL again and again.
	      Bug #2359 [ruby-core:26694]

	* thread_win32.c, thread_win32.h: Using simple lock
	  not by CRITICAL_SECTION but by Mutex.
	  Bug #3890 [ruby-dev:42315]

	* vm.c (ruby_vm_destruct): ditto.

Sun Nov 28 04:40:00 2010  Luis Lavena  <luislavena@gmail.com>

	* io.c (io_fwrite): use rb_w32_write_console under Windows.

	* win32/win32.c (rb_w32_write_console): added to write to write
	  Unicode using WriteConsoleW for stdout/stderr. [ruby-core:33166]

Sun Nov 28 03:58:47 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by Mike Perham [ruby-core:33433]

Sat Nov 27 19:12:10 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: parenthesize macro arguments.

Sat Nov 27 18:08:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (leap_year_v_p): fixed typo.  [ruby-dev:42631]

Sat Nov 27 17:57:08 2010  Tanaka Akira  <akr@fsij.org>

	* resolv.rb (Resolv::DNS): use the same DNS server when retry using
	  TCP.  reported by Julian Mehnle.  [ruby-core:32970]

Sat Nov 27 15:45:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): see CrashReport log on Mac OS X.

	* configure.in: link addr2line only for ELF.

Sat Nov 27 13:58:55 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): : was missing.  Thanks,
	  Shota Fukumori.  [ruby-dev:42634]

Sat Nov 27 12:07:05 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* man/ruby.1: Ruby man page from Arthur Gunn in [ruby-core:33412]

Sat Nov 27 11:29:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): get rid of 1.9 syntax
	  so that BASERUBY can be 1.8.

Sat Nov 27 08:16:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* addr2line.c (rb_dump_backtrace_with_lines): should close fd on
	  edge case.

Fri Nov 26 13:33:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: apply a patch from shinichiro.h.

Fri Nov 26 12:21:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: added to show source filename and line number of
	  functions in backtrace. [ruby-dev:42625]
	  a patch from shinichiro.h <shinichiro.hamaji AT gmail.com>

	* addr2line.h: ditto.

	* common.mk: add addr2line.$(OBJEXT).

	* configure.in: check dl_iterate_phdr.

	* vm_dump.c (rb_vm_bugreport): use rb_dump_backtrace_with_lines in
	  addr2line.c when the binary is ELF.

Fri Nov 26 12:12:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (setup_tree): restart setup_tree() for a node whose
	  AnchorNode's type is ANCHOR_PREC_BEHIND or ANCHOR_PREC_BEHIND_NOT
	  and divide_look_behind_alternatives() divided it to NT_ALT or
	  NT_LIST. [ruby-core:33370]

Fri Nov 26 11:40:11 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): get only required rights of the target
	  thread because THREAD_ALL_ACCESS causes an access error on XP.
	  reported by Masaya TARUI via IRC.

Fri Nov 26 11:09:07 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): show the displacement from the beginning
	  of the symbol.

Fri Nov 26 10:48:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): follow the output of glibc.
	  see [ruby-dev:42627]

Fri Nov 26 09:48:45 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_initialize_str): should succeed the taint status from
	  the origin. [ruby-core:33338]

Fri Nov 26 09:32:37 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): seems to be necessary the 3rd argument of
	  SymGetLineFromAddr64(), even though MSDN says it can be zero.

Fri Nov 26 09:03:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (onig_is_prelude): added to check whether ruby is still
	  in prelude (or other boot processes) or not.

	* regcomp.c (optimize_node_left): use onig_is_prelude for printing.

	* regcomp.c (set_optimize_info_from_tree): ditto.

	* regcomp.c (onig_compile): ditto.

	* regcomp.c (print_compiled_byte_code_list): print its address.

	* regcomp.c (print_indent_tree): print its contents tree of
	    ANCHOR_PREC_READ(_NOT) and ANCHOR_PREC_BEHIND(_NOT).

Thu Nov 25 23:10:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (print_distance_range): use PRIuSIZE.

	* regcomp.c (print_optimize_info): use %ld because the type of
	  calculated value of integers is long.

	* regexec.c (onig_print_compiled_byte_code): add prototype.

	* regexec.c (match_at): add 2nd argument.

Thu Nov 25 10:29:55 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/callback/mkcallback.rb (gencallback): shouldn't assume that
	  VALUE is the same size with long.

Thu Nov 25 10:03:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/win32ole/test_err_in_callback.rb (teardown): remove tmp file
	  only when it exists.

Thu Nov 25 01:38:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/big5-hkscs-tbl.rb: Update table as HKSCS-2008.
	  patched by oCameLo oTnTh [ruby-core:33256]

	* enc/big5.c: add alias Big5-HKSCS:2008 to Big5-HKSCS.

Wed Nov 24 15:18:07 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vsnprintf (BSD_vfprintf): use QUADINT macro only when _HAVE_SANE_QUAD_
	  macro is defined.

Wed Nov 24 12:47:16 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vsnprintf (BSD_vfprintf): added VC++ compatible size specifications
	  (I, I32, I64).

Wed Nov 24 11:19:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): treat UTF-16 and UTF-32 as BE or LE.

Wed Nov 24 06:35:32 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: add the UTF-32 converter.

Wed Nov 24 05:40:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

Wed Nov 24 06:13:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (filecp, wstr_to_mbstr, mbstr_to_wstr):
	  refactored.

Wed Nov 24 05:40:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: add a converter from UTF-8 to UTF-16.

Wed Nov 24 03:21:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: raise error on unpaired upper
	  surrogates.

Wed Nov 24 01:40:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_16_32.h: add UTF-16 and UTF-32 as a dummy encoding.

	* enc/trans/utf_16_32.trans: add a converter from UTF-16 to UTF-8.

Tue Nov 23 21:59:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (wlink, rb_w32_getppid): use typedef instead of
	  repeating complicated function prototypes.

Tue Nov 23 18:54:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_mark): should mark self in control
	  frames.  [ruby-core:33289]

Tue Nov 23 07:57:31 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta/parser.{ry,rb}: fixed a bug of token scanner.

Tue Nov 23 07:29:24 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c ({nucomp,nurat}_expt): added a check.

Tue Nov 23 07:27:27 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (daynum): should be private.

Tue Nov 23 07:22:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ChangeLog (change-log-indent-text): hanging indent.

Tue Nov 23 06:30:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SITE_DIR, VENDOR_DIR),
	  version.c (ruby_initial_load_paths): exclude directories that
	  are configured without them from $LOAD_PATH. [ruby-core:33267]

	* configure.in (rubylibprefix): No ruby, No libprefix.

Tue Nov 23 01:05:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): don't output floating point
	  when the precision is 0. [ruby-dev:42615]

Mon Nov 22 21:30:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): fix for ascii-compatible external
	  encoding and different encoding string.  [ruby-core:33283]

Mon Nov 22 18:45:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): should not duplicate rules.
	  bug fix of r29842.

Mon Nov 22 18:04:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/big5.c: split CP950 from Big5.

	* enc/big5.c: split CP951 from Big5-HKSCS.

	* enc/trans/big5.trans: import conversion table of Big5, Big5-HKSCS,
	  CP950, and CP951 from ICU. they need fallback conversions.
	  ref [ruby-core:33256]
	  http://source.icu-project.org/repos/icu/data/trunk/charset/data/ucm/

	* tool/transcode-tblgen.rb (import_ucm): add to import ucm files.

Mon Nov 22 18:33:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): append for each chars instead of bulk
	  copy if encoding conversion is needed.  [ruby-core:33283]

Mon Nov 22 14:22:45 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* time.c (time_zone): use rb_locale_str_new_cstr to set encoding
	  as locale and convert its content to internal encoding.
	  [ruby-core:33278]

Mon Nov 22 11:58:11 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): set ENC_CODERANGE_VALID when the
	  receiver is 7BIT and the argument is non ASCII.

Mon Nov 22 01:48:58 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: some improvements for performance.

Sat Nov 20 07:45:50 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/mkmf.rb: adding compilation support for ObjC/ObjC++ extensions.
	  Thanks Scott Gonyea! [ruby-core:33260]

Sat Nov 20 01:57:55 2010  Akio Tajima  <artonx@yahoo.co.jp>

	* common.mk: add dependency(insns.inc) to compile.obj

Fri Nov 19 23:05:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (insns_rules.mk): remove extra backslash.

	* cygwin/GNUmakefile.in, win32/Makefile.sub (clean): rc files are
	  made at compile time, so should be removed by clean.

Fri Nov 19 22:09:46 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb
	  (Tester#test_pretty_format_long_text_finite): skip a test that
	  uses long string on small memory system. [ruby-dev:42599]

Fri Nov 19 21:07:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb: shell completion support for zsh.  based on
	  <http://d.hatena.ne.jp/rubikitch/20071002/zshcomplete>

	* lib/optparse.rb: shell completion support for bash.

Fri Nov 19 00:00:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (SCRIPTPROGRAMS): no needs on cygwin.

	* win32/Makefile.sub (scriptbin): create script binaries.

Thu Nov 18 23:21:23 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/formatters/pretty.rb (REXML::Formatters::Pretty#wrap):
	  REXML::Formatters::Pretty#wrap used a recursive method call to
	  format text.  This switches it to use an iterative approach.
	  [ruby-core:33245]
	  Patch by Jeremy Evans. Thanks!!!

	* test/rexml/test_core.rb: add a test for it.

Thu Nov 18 22:58:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h (rb_io_buffer_t): extract from rb_io_t.

Thu Nov 18 07:37:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (reconfig): force reconfigure with previous options.

	* common.mk (showconfig): show configure flags, like as
	  `config.status --config' generated by recent autoconf.

Thu Nov 18 07:16:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/langinfo.c (strncasecmp): get rid of redefinition.

Thu Nov 18 00:02:17 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Upgrading output encoding with ASCII content
	  as needed.  [ruby-core:33229]

Wed Nov 17 23:19:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/configure.bat: remove quotes from arguments to be quoted.

	* lib/mkmf.rb (create_makefile): use forward slashes in messages.

	* lib/mkmf.rb (create_makefile): make extension libraries messages
	  brief.

	* win32/Makefile.sub (MAKEDIRS): should not include silent flag.

	* common.mk (ext/ripper/ripper.c, ext/json/parser/parser.c): pass
	  Q and ECHO.  [ruby-core:33226]

Wed Nov 17 16:09:52 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_tracer.rb: new test case.
	  minimal regression test for r29280.

Wed Nov 17 16:04:23 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/envutil.rb (Test::Unit::Assersions#assert_warn):
	  new assertion to assert that a particular warning message is
	  displayed.
	  forward port from branches/ruby_1_9_2@29795.

Wed Nov 17 15:16:48 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regint.h (OnigOpInfoType): constify name.

	* regcomp.c (op2name): constify return value.

	* regcomp.c (onig_print_compiled_byte_code): use PRIuPTR and
	  uintptr_t to clean warnings.

	* regcomp.c (print_indent_tree): use PRIxPTR and intptr_t.

	* regexec.c (match_at): use PRIdPTR and intptr_t.

Wed Nov 17 09:49:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c (property_name_to_ctype): fix memory leak.

	* enc/euc_jp.c (property_name_to_ctype): ditto.

Wed Nov 17 08:54:04 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Upgrading output encoding as needed.  [ruby-core:33135]

Tue Nov 16 22:30:39 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_throw): remove fear of undefined behavior :-)
	  Coverity Scan found this bug.

Tue Nov 16 09:33:00 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (to_digits): avoid unused
	  variables warning, reported by Aaron Patterson.

Tue Nov 16 06:39:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (PACK_ITEM_ADJUST): return nil not result array and yield
	  values if block is given.  [ruby-core:33193]

Tue Nov 16 00:21:20 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* regparse.c (and_cclass, or_cclass): fix memory leak.  Coverity Scan
	  found this bug.  [ruby-dev:42579]

Tue Nov 16 00:07:32 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (assign_heap_slot): fix fear of memory leak and memory
	  violation.  Coverity Scan found this bug.

Mon Nov 15 23:54:45 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval_intern.h (CHECK_STACK_OVERFLOW): it was not intended to add
	  size_t to a pointer typed VALUE*.  Coverity Scan found this defect.

Mon Nov 15 23:41:21 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_set_exception_local_table, iseq_set_local_table,
	  rb_iseq_build_from_ary): fix type inconsistency (which is benign
	  because sizeof(ID) == sizeof(ID*), though).  Coverity Scan found
	  these bugs.

Mon Nov 15 22:47:27 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_funcall): ensure va_end after va_init_list.  Coverity
	  Scan found this bug.

Mon Nov 15 08:36:12 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/racc/parser.rb (do_parse, yyparse): using class eval to define
	  method and avoid __send__.

Mon Nov 15 06:43:48 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* etc/openssl/ossl_ssl.c (ossl_ssl_get_cert): raise exception if
	  pointer is invalid.  Thanks Ippei Obayashi! [ruby-dev:42573]

Sun Nov 14 17:57:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/Makefile.in (distclean): should not remove sources which are
	  distributed in tarball.

Sun Nov 14 16:48:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_set_token_info): turn on/off with directives.
	  [ruby-core:25442]

Sun Nov 14 12:05:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_readlines): forward to current_file for arguments
	  check.  http://twitter.com/nagachika/status/3634254856589312

Sun Nov 14 08:48:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/setup.mak (-basic-vars-, -runtime-): suppress trailing
	  space and compiler command line.

Sun Nov 14 04:22:32 2010  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (config.h): Added HAVE_LABS and HAVE_LLABS to config.h.

	* symbian/configure.bat: Changed packaging version in line with API
	  style 3 versioning.

Sat Nov 13 16:37:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags, help): emit messages at once.

	* win32/Makefile.sub (MSG, EOM): remove surrounding quotes by %~I.

Sat Nov 13 01:31:30 2010  Akio Tajima <artonx@yahoo.co.jp>

	* win32/Makefile.sub: reorder variable End Of Message (don't display it)

Fri Nov 12 20:52:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags, help): use caret to quote leading spaces on
	  Windows.

	* Makefile.in, common.mk, cygwin/GNUmakefile.in, enc/depend,
	  ext/ripper/depend, lib/mkmf.rb, win32/Makefile.sub: caddle up.

Fri Nov 12 16:35:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: support C level backtrace information on FreeBSD.
	  When devel/libexecinfo is installed on FreeBSD, now ruby
	  can show C level backtrace information.
	  http://www.freebsd.org/cgi/cvsweb.cgi/ports/devel/libexecinfo/

Fri Nov 12 09:58:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak: use findstr.exe instead of find.exe, because all
	  target build platforms should have findstr.exe, and, find.exe often
	  means another command such as cygwin's.

Fri Nov 12 00:30:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.h): need PRI_LL_PREFIX.

Thu Nov 11 23:38:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: ANSI C-conforming const and volatile are mandatory

	* configure.in (AC_C_CONST, AC_C_INLINE, AC_C_VOLATILE): check
	  before used in other checks.

	* configure.in (RUBY_CHECK_PRINTF_PREFIX): should not break from
	  RUBY_WERROR_FLAG, so that ac_c_werror_flag gets restored.

Thu Nov 11 23:04:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (warn_deprecated): show caller position.

Thu Nov 11 23:03:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_close): untie tied io before closing.

	* io.c (argf_write): add ARGF.write and so on.

	* io.c (argf_read_nonblock): add ARGF.read_nonblock.

Thu Nov 11 21:49:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/stats.rb (RDoc#print): get rid of NaN.

Thu Nov 11 21:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (SHOWFLAGS): show compile flags.

	* common.mk: hide long command lines by default.  verbose-mode is
	  turned on by V=1 as before.
	  http://jarp.does.notwork.org/diary/200605b.html#200605121

Thu Nov 11 21:32:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_func): accept variable address.

	* ext/win32ole/extconf.rb: libuuid is needed on cygwin.

Thu Nov 11 21:24:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): use cygwin_conv_path on cygwin 1.7 or
	  later.

	* ruby.c (push_include_cygwin): ditto.

Thu Nov 11 20:49:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (PRI_LL_PREFIX): format type specifier for
	  LONG_LONG may vary on platforms.

Thu Nov 11 20:45:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SYMBOL_PREFIX): separate from EXPORT_PREFIX.

	* win32/mkexports.rb (Exports#each_export): use SYMBOL_PREFIX.

Wed Nov 10 07:20:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (scriptbin): make executable file from
	  scripts with stub.

	* ruby.c (load_file_internal): assume xflag for exe file as well
	  as no-shebang file.

	* tool/rbinstall.rb: install script programs.

	* win32/mkexports.rb (Exports#initialize): alias ruby_sysinit for
	  stub.

	* win32/stub.c: stub for scripts.  [EXPERIMENTAL]

Tue Nov  9 21:57:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (init_funcname): allocate and build initialization
	  funciton name at once.

Tue Nov  9 21:14:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (AC_FUNC_GETPGRP, AC_FUNC_SETPGRP): no need when
	  not used.

	* configure.in (EXPORT_PREFIX): check generic prefix.

Tue Nov  9 13:24:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regenc.c (onigenc_minimum_property_name_to_ctype):
	  \p{...} should be case insensitive. [ruby-core:33000]

	* regenc.c (onigenc_property_list_add_property):
	  ditto.

	* enc/euc_jp.c (init_property_list, property_name_to_ctype):
	  to lowercase property names.

	* enc/shift_jis.c (init_property_list, property_name_to_ctype):
	  ditto.

Tue Nov  9 13:29:36 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (overlapped_socket_io): get rid of a warning of 64bit
	  mingw.

Tue Nov  9 10:44:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): this code uses FPU's rounding system.
	  But x86's FPU calculates double precision floating-point
	  numbers in 80bit precision, so it fails to round the value.
	  So ensure the value is assigned a variable. [ruby-dev:42551]
	  see also [ruby-math:00802]
	  http://www.shudo.net/java-grandprix99/strictfp/

Tue Nov  9 07:30:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_syserr_new): new function to make SystemCallError
	  instance without errno.  [EXPERIMENTAL]

	* error.c (rb_syserr_fail, rb_mod_syserr_fail): ditto.

Tue Nov  9 05:54:57 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/*.rb: Remove unused variable warnings.
	  Patch by Run Paint [ruby-core:30991]

	* lib/rubygems/*, lib/rdoc/*.rb, lib/rake/*.rb: ditto

Mon Nov  8 18:26:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_hdtoa): fix type cast and bufsize.

Mon Nov  8 15:40:56 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): fix precision specifier doesn't
	  work well on %f. [ruby-dev:42552]

Mon Nov  8 14:41:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (get_wsa_extension_function): typos.

Mon Nov  8 13:41:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Add Age property to regexp. [ruby-core:33019]
	  patched by Ammar Ali, tested by Run Paint Run Run

Mon Nov  8 12:16:39 2010  Ben Walton  <bwalton@artsci.utoronto.ca>

	* configure.in: support -h for solaris linker when gcc not used

Mon Nov  8 11:47:39 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (finish_overlapped_socket): refactoring.

Mon Nov  8 11:02:21 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (get_proc_address): refactoring.

	* win32/win32.c (get_wsa_exetinsion_function): refactoring.

Mon Nov  8 09:45:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/gbk-tbl.rb: Add euro sign. [ruby-core:33094]
	  CP936, which is de facto definition of GBK, has it.
	  http://msdn.microsoft.com/en-us/goglobal/cc305153.aspx

Mon Nov  8 07:26:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check only the first symbol to get rid of
	  duplication.  [ruby-core:33084] #4031

Sun Nov  7 10:13:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (NM): check on all platforms.  #4031

Sun Nov  7 06:16:33 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/openssl/test_ocsp.rb: adding test for r29699.  Thanks Elise
	  Huard! [ruby-core:32460]

Sat Nov  6 07:33:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_export_prefix): check for prefixed
	  underscore of exported symbols

	* tool/rbinstall.rb (bin-comm): prepend prolog shell script if
	  necessary.

	* configure.in (LIBRUBY_RELATIVE): use rpath token expansion.

Sat Nov  6 07:24:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in (arch, sitearch): reordered.

	* configure.in: keep failed file.

Sat Nov  6 07:03:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_fork_err): save errinfo before fdopen.

Sat Nov  6 00:43:58 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_ocsp.c (ossl_ocspcid_initialize): an optional
	  parameter may be used to specify the OpenSSL::OCSP::CertificateId on
	  initialization.  Thanks Elise Huard! [ruby-core:32460]

Fri Nov  5 12:23:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_{process,system}.rb (test_fallback_to_sh):
	  meaningless and wrong tests where /bin/sh does not exist.

	* process.c (proc_spawn_v): should spawn, not exec.

Fri Nov  5 01:21:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_exec_v, proc_spawn_v): try to execute with sh if
	  no shebang.  [ruby-core:32745] [EXPERIMENTAL]

Fri Nov  5 00:39:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_readlines, rb_io_each_line): limit must not be zero.
	  a patch from Tomoyuki Chikanaga at [ruby-dev:42538].  #4024

Fri Nov  5 00:14:15 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/extconf.rb: fixing ffi library location on windows.
	  Thanks Usa! [ruby-core:32930]

Thu Nov  4 20:04:44 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_newobj): force garbage_collect() if GC.stress == true.

Thu Nov  4 19:48:22 2010  Koichi Sasada  <ko1@atdot.net>

	* ChangeLog: missed to write a last ChangeLog.

	* gc.c (gc_finalize_deferred): removed.

	* gc.c (rb_gc_finalize_deferred): Do not invoke a free_unused_heaps().

Thu Nov  4 19:45:27 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (run_final): do not need argument obj.

Thu Nov  4 19:26:10 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (before_gc_sweep): fix commit miss.

Thu Nov  4 19:20:46 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep, before_gc_sweep):
	  invoke rb_sweep_method_entry() as soon as possible.

Thu Nov  4 19:13:58 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep, slot_sweep): finalizers should be invoked
	  as soon as possible.

Thu Nov  4 10:30:40 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in (--with-valgrind): Now this option is default on.
	  You can still explicitly disable this feature by specifying
	  --without-valgrind.

Thu Nov  4 02:06:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (fiber_t_alloc): raise an error when fiber is going to be
	  initialized twice.  [ruby-dev:42524]

Thu Nov  4 02:04:25 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (rb_fiber_resume): raise an "double resume" error when root
	  fiber is going to be resumed.  [ruby-dev:42523]

Wed Nov  3 14:17:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct#delete_field): also undefine
	  accessor methods.  [ruby-core:33010]

Wed Nov  3 14:13:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): concatenation of valid
	  encoding string and invalid encoding string should result
	  invalid encoding.  [ruby-core:33027]

Wed Nov  3 08:58:59 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c, vm.c, vm_core.h: remove USE_VALUE_CACHE option.

Wed Nov  3 07:47:25 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex#identify_string): parse multiple
	  regex options.  a patch from Heesob Park in [ruby-core:32988].

Wed Nov  3 07:33:57 2010  Tanaka Akira  <akr@fsij.org>

	* vm_method.c (rb_clear_cache_by_class): just return if the class has
	  no method.  reported by Eric Wong.  [ruby-core:32689]

Tue Nov  2 22:50:25 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/visitor.rb (initialize): push accessor
	  methods to subclass that actually uses them.

Tue Nov  2 22:47:08 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/visitor.rb (accept): switch to
	  a dispatch cache rather than case / when statement.

Tue Nov  2 21:46:52 2010  Kouhei Sutou  <kou@cozmixng.org>

	* NEWS: fix a typo.

Tue Nov  2 20:10:32 2010  Tajima Akio <artonx@yahoo.co.jp>

	* test/rake/test_tasks.rb: clear env var which is used by the test.
	  [ruby-dev:42508]

Tue Nov  2 00:25:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: win64 is just same with win32 about socket.
	  notice: but wince is not same.

Mon Nov  1 21:25:57 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* main.c: <stdlib.h> is needed, to introduce the getenv(3)
	  prototype declaration.  Without it a C compiler shall infer
	  the getenv type as "int getenv(...);", but this is totally
	  wrong, especially when your machine's sizeof(int) and
	  sizeof(char*) differs.  On such environment a return value
	  of getenv(3), which is in fact a char*, might first casted
	  into a int (loses data here), and then casted back to char*
	  by automatic integral promotion to fit to the prototype of
	  ruby_set_debug_option().

Sun Oct 31 23:27:09 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (finalizer_table, objspace->final.table):
	  Create finalizer_table at Init_heap().
	  Remove all null checks of finalizer_table.

	* gc.c (mark_tbl): skip if no table entries.

	* gc.c (slot_swee): remove useless need_call_final check.

Sun Oct 31 22:32:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_objspace_free): finalizers should be called separately
	  from freeing objspace.  [ruby-dev:42479]

Sun Oct 31 22:24:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): free current VM and its objspace even
	  when exiting by SystemExit.

Sun Oct 31 22:10:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (new_child_iseq): adjust argument types.

	* iseq.c (prepare_iseq_build, rb_iseq_new),
	  (rb_iseq_new_with_bopt_and_opt, rb_iseq_new_with_opt),
	  (rb_iseq_new_with_bopt): ditto.

	* compile.c (iseq_set_exception_table): suppress warnings.

	* insns.def (putspecialobject, defined): ditto.

	* iseq.c (iseq_load): ditto.

Sun Oct 31 09:30:51 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h: some refactoring.
	  - move decl. of rb_compile_option_struct to iseq.h.
	  - define enum iseq_type.
	  - define enum vm_special_object_type.

	* compile.c: some refactoring.
	  - apply above changes.
	  - (struct iseq_link_element): change value of type.
	  - remove unused decl.
	  - fix comment.
	  - rename iseq_build_body and iseq_build_exception to
	    iseq_build_from_ary_body and iseq_build_from_ary_exception.

	* iseq.h: define enum catch_type and enum defined_type.

	* insns.def: apply above changes.

	* iseq.c: define ISEQ_MAJOR_VERSION and ISEQ_MINOR_VERSION.

Sat Oct 30 23:38:59 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/encoding.rb: untabify.

Sat Oct 30 21:06:37 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/encoding.rb: use Ruby native encoding mechanism.
	  [ruby-dev:42464]
	* lib/rexml/encodings/: remove.

	* lib/rexml/document.rb, lib/rexml/formatters/default.rb,
	  lib/rexml/output.rb, lib/rexml/parseexception.rb,
	  lib/rexml/parsers/baseparser.rb, lib/rexml/source.rb,
	  lib/rexml/xmldecl.rb: use Ruby's native Encoding object.

	* test/rexml/, test/rss/: follow the above encoding changes.

	* NEWS: add REXML's incompatible change about encoding.

Sat Oct 30 17:23:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strtod): get rid of overflow/underflow as possible.

Sat Oct 30 14:37:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_pc): erase runtime-defined variables and
	  check if generated pc file is valid.

	* template/ruby.pc.in (DEFFILE): need for mingw.

	* template/ruby.pc.in (LIBRUBY): fix the order.

Sat Oct 30 11:33:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (ruby_pc): ignore missing variables.

	* template/ruby.pc.in: add missing variables for mswin.

Sat Oct 30 10:24:35 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* object.c: Make BasicObject.new accept no parameter.
	  Revert of r26135 [ruby-core:27080], as per [ruby-core:32952].

Sat Oct 30 09:40:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c: use constants in id.h.

Sat Oct 30 09:08:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/fiddle/closure.c (fiddle_closure): embed cif not reference
	  so that the content surely get initialized.  [ruby-dev:42480]

Sat Oct 30 07:01:53 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv-replace.rb: suppress warning.

	* lib/open-uri.rb: ditto.

Sat Oct 30 06:32:52 2010  Tanaka Akira  <akr@fsij.org>

	* test/pathname/test_pathname.rb (TestPathname#test_grpowned?): the
	  group of the created file is inherited from the parent
	  directory on BSDs and MacOS X.  Linux also inherit the group if
	  the setgid bit of the directory is set.  It causes the test fail.
	  fixed by Shota Fukumori.  [ruby-dev:42458]

Sat Oct 30 05:58:54 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: retry via TCP if UDP reply is truncated.
	  fixed by Julian Mehnle.  [ruby-core:32407]

Sat Oct 30 00:35:13 2010  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_s_compile): fix optional argument.
	  a patch from Yutaka HARA [ruby-core:32953] [Ruby 1.9-Bug#4001]

Sat Oct 30 00:24:42 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (memsize_of): take care of
	  T_CLASS/const_tbl.
	  a patch from nagachika <nagachika00@gmail.com> [ruby-dev:42490]

Fri Oct 29 23:32:36 2010  Koichi Sasada  <ko1@atdot.net>

	* test/profile_test_all.rb: added.
	  You can use test-all profiler with the following command:
	    RUBY_TEST_ALL_PROFILE=true make test-all
	  This command generates ./test_all_profile and you can analyze
	  which tests consume memories.

	* test/runner.rb: ditto.

Fri Oct 29 10:02:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Add 'Unknown' Script.
	  patched by Run Paint Run Run. [ruby-core:32937] #3998

Fri Oct 29 05:13:34 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (ObjectSpace.memsize_of_all): rename
	  ObjectSpace.total_memsize_of_all_objects() to
	  ObjectSpace.memsize_of_all([klass]).
	  Accept Class object to filter the objects.

	* test/objspace/test_objspace.rb: fix test for above change.

Fri Oct 29 03:04:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_dump): fix expected length. [ruby-core:32935]

Thu Oct 28 23:31:39 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (before_gc_sweep, run_final): fix decrement timing of final_num.

Thu Oct 28 20:11:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Update Oniguruma for Unicode 6.
	  patched by Run Paint Run Run. [ruby-core:32923] #3989

Thu Oct 28 20:06:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/oniguruma.h (ONIGENC_CTYPE_SPECIAL_MASK):
	  change mask from 128 to 256. [ruby-core:32931]

Thu Oct 28 12:06:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httprequest.rb (read_request_line): extend max
	  length to 2083. This is from Internet Explorer's max uri
	  length. http://support.microsoft.com/kb/208427 [ruby-core:32924]

Thu Oct 28 04:00:08 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (GC.stat): added.  [ruby-dev:38607]

	* test/ruby/test_gc.rb: add a test for above.

Thu Oct 28 03:13:06 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (memsize_of): fix rdoc.

	* ext/objspace/objspace.c (total_memsize_of_all_objects): added.

	* test/objspace/test_objspace.rb:
	  - add a test for ObjectSpace.total_memsize_of_all_objects.
	  - add two tests for ObjectSpace.memsize_of (for nil and Fixnum).

Wed Oct 27 23:55:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Init_iconv): warn deprecated use.

Wed Oct 27 18:50:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2long, rb_big2ulong): rb2ulong() returns VALUE, but
	  its real range is ulong. So, if the size of VALUE is bigger than
	  ulong, upper bits are always zero even if the actual value is
	  negative.
	  fixed #3490

Wed Oct 27 18:27:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): should close write end of pipe
	  before closing read end, to get rid of timing problem.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 27 18:14:27 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getppid): support Win64.

Wed Oct 27 15:07:19 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_error): should get error no only once, because
	  the result of the second getting will indicate the error of the
	  first FormatMessage() call.

Wed Oct 27 13:51:25 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): need to propagate exceptions
	  in read/write thread. fix r29541.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 27 12:05:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* class.c (clone_const): need to return value. fix r29602.

Wed Oct 27 11:58:58 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (NUM2LONG_internal): add cast to get rid of a
	  non GCC compiler warning. this is intentional type conversion.

Wed Oct 27 09:25:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c: apply documentation patch by Run Paint Run Run.
	  [ruby-core:32915]

Wed Oct 27 02:12:10 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* object.c (Init_Object), constant.h, variable.c
	  (rb_mod_private_constant, rb_mod_public_constant,
	  set_const_visibility, rb_const_get_0): add Module#public_constant
	  and private_constant.  [ruby-dev:39685][ruby-core:32698]

	* test/ruby/test_module.rb: add tests for above.

Wed Oct 27 02:02:54 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c, constant.h, gc.c, method.h, object.c, variable.c,
	  vm_insnhelper.c: use struct rb_constant_entry_t as entry of
	  RCLASS_CONST_TBL.  RCLASS_CONST_TBL has contained VALUE of constant
	  directly.  Now instead rb_const_entry_t is contained in
	  RCLASS_CONST_TBL,  rb_const_entry_t is managed by malloc, and
	  have not only the value itself but also visibility flag.
	  This is another preparation for private constant (see
	  [ruby-dev:39685][ruby-core:32698]).

Wed Oct 27 01:56:34 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c, gc.c, object.c, variable.c, vm_insnhelper.c,
	  include/ruby/ruby.h: separate RCLASS_CONST_TBL from RCLASS_IV_TBL.
	  RCLASS_IV_TBL has contained not only instance variable table but
	  also constant table.  Now the two table are separated to
	  RCLASS_CONST_TBL and RCLASS_IV_TBL.  This is a preparation for
	  private constant (see [ruby-dev:39685][ruby-core:32698]).

Tue Oct 26 18:51:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/scanf.rb (extract_float): allow 2.e+2 style.
	  [ruby-dev:42452] #3978

Tue Oct 26 18:09:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (ASFLAGS): needs INCFLAGS.

	* configure.in (rb_cv_dynamic_alloca): check if extra source for
	  dynamic size alloca.

	* missing/x86_64-chkstk.s (___chkstk): necessary for alloca of
	  amd64-mingw32msvc-gcc on Ubuntu.

	* thread_win32.c (ruby_alloca_chkstk): check stack overflow

Tue Oct 26 18:04:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in (Libs): needs DLDFLAGS.

Tue Oct 26 12:47:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (pkgconfig-data): moved from Makefile.in.

	* tool/rbinstall.rb: install pc file only if non-empty.
	  [ruby-core:32901] #3983

	* win32/Makefile.sub (ruby_pc): create pc file.

Tue Oct 26 09:13:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_gcc_atomic_builtins): check for atomic
	  builtins, all are not available in Apple derivative gcc.

Tue Oct 26 00:29:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (pkgconfig-data): create pkg-config metadata file.

	* tool/rbinstall.rb: install pkg-config metadata file.

	* template/ruby.pc.in: template of pkg-config metadata file.

Mon Oct 25 16:38:07 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* signal.c  (rb_atomic_t): GCC (of  at least  recent versions)
	  has  ubiquitous  support  for  atomic operations.   On  that
	  compiler a C program can  issue a memory barrier using these
	  dedicated  instructions.  According to  the GCC  manual they
	  cargo culted  this feature form  the Itanium ABI  so chances
	  are that  other compilers  could also support  this feature.
	  But so far GCC is the  only compiler that I know to have it.
	  Also note that this works on non-Itanium machines.

Mon Oct 25 06:21:35 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): prec digits fractal part should be
	  appended to 0 if prec is given.  [ruby-dev:42453] #3979

Mon Oct 25 02:57:21 2010  Koichi Sasada  <ko1@atdot.net>

	* common.mk (run.gdb): Quit gdb on 'make gdb' when
	  no signals are received.

Mon Oct 25 00:25:23 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: some corrections of documentation.

Sun Oct 24 17:14:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c, gc.c, hash.c, object.c, string.c, struct.c,
	  transcode.c, variable.c, vm.c, vm_insnhelper.c, vm_method.c:
	  replace calls to rb_error_frozen() with rb_check_frozen().  a
	  patch from Run Paint Run Run at [ruby-core:32014]

	* include/ruby/intern.h (rb_check_frozen): optimize.
	  [ruby-core:32878]

Sun Oct 24 15:16:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Mini#run): abort if interrupted.

	* lib/test/unit.rb (Test::Unit::Mini#run_test_suites): show the
	  result even when interrupted on the way.

	* lib/test/unit.rb (Test::Unit::Mini#run_test_suites): ensure
	  output sync mode to be restored.

Sun Oct 24 14:11:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_define_method): defined method is run with the default
	  public visibility regardless the visibility context of definition.
	  [ruby-core:30638]

Sun Oct 24 12:08:54 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/test/unit.rb: make test/unit play nicely with the rake test
	  loader. [ruby-core:32864]

Sun Oct 24 00:25:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (test_segv_test): follow up the
	  change at r29556.

Sat Oct 23 14:39:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: $extmk should be true for test/runner.

Sat Oct 23 10:55:37 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c (rb_vm_bugreport): fix to add bug outputs.
	  - loaded script ($0)
	  - loaded features ($")
	  - process memory map on Linux (/proc/self/maps)

	* vm_dump.c (rb_vmdebug_stack_dump_raw): fix header message.

Fri Oct 22 14:50:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  assertion message must not be nil.

Fri Oct 22 13:59:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  treat nil case. Please run test-all before commit such change.

Thu Oct 21 23:58:14 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_lazy_sweep): Variable declarations should be at
	  the head of block.

Thu Oct 21 23:56:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (objspace_each_objects, rb_objspace_each_objects): use
	  struct.

	* gc.c (objspace_each_objects): fix return with no value.

Thu Oct 21 23:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_initialize): remove useless intermediate variable.

Thu Oct 21 16:07:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_f_select): change rdoc.
	  patched by Eito Katagiri [ruby-core:31805]

Thu Oct 21 15:55:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httpauth/digestauth.rb
	  (WEBrick::HTTPAuth::ProxyDigestAuth#check_uri): privated.
	  [ruby-dev:42344]

Thu Oct 21 15:50:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_f_select): add correct rdoc.
	  patched by Dave Thomas [ruby-core:32467]

Thu Oct 21 15:42:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/telnet.rb (Net::Telnet#close): added.
	  patched by Erik Hollensbe [ruby-dev:42260] #3830

Thu Oct 21 13:08:00 2010  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (rb_objspace_each_objects): don't lazy sweep in
	  rb_objspace_each_objects. [Bug #3940] [ruby-dev:42369]

Thu Oct 21 00:05:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): get rid of deadlock on pipe.
	  a patch from Tomoyuki Chikanaga at [ruby-dev:42435].  #3970

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 20 23:54:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dbm/dbm.c: rdoc based on a patch by mathew meta AT
	  pobox.com, at [ruby-core:32853].

Wed Oct 20 10:47:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): reject 0x1.p+0. [ruby-dev:42432] #3966

Wed Oct 20 10:00:57 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): print floating point on "%#a".
	  [ruby-dev:42431] Bug#3965

Tue Oct 19 19:30:11 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): clear ALT flag for %a.
	  [ruby-core:32841] [ruby-core:32848]

Tue Oct 19 12:19:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): fix over-count of field size.

Tue Oct 19 03:08:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): use HEXPREFIX flag for prefix of %a.
	  [ruby-core:32841]

Mon Oct 18 13:18:01 2010  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_class_init): Define
	  Digest::Class.new(). [Feature #3954]

Mon Oct 18 12:58:40 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_pack): refine the document.  [ruby-dev:42397]
	  (pack_unpack): ditto.

Mon Oct 18 10:19:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (transport_request): @socket may be nil.
	  patched by Egbert Eich [ruby-core:32829]

Mon Oct 18 09:57:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (BSD_vfprintf): wrong padding around prefix and
	  floating point with %a. [ruby-dev:42403] Bug #3956

Sun Oct 17 22:36:33 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta.rb: added an rdoc tag.

Sun Oct 17 10:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_mod_remove_const): update rdoc.
	  [ruby-core:31957]

Sun Oct 17 10:40:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_define_{class,module}_id_under): register to be
	  marked, which probably are defined and used internally.

Sat Oct 16 11:10:55 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_encoding2cp): set codepage 20936
	  according to GB2312. [Bug #3937] [ruby-core:32758]

Sat Oct 16 10:54:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (CPP): already used in .c.i rule.

	* cygwin/GNUmakefile.in (DLLWRAP, WINDRES): add --driver-name and
	  --preprocessor options explicitly.  [ruby-core:32776]

Sat Oct 16 10:06:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/sdbm/_sdbm.c (SEEDUPS, BADMESS): make settable using command
	  line options.

	* ext/sdbm/_sdbm.c (makroom): suppress unused result warning.

	* ext/sdbm/extconf.rb: disable BADMESS, a library should not emit
	  messages directly.

Sat Oct 16 08:39:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_strerror): get English message first, instead of
	  system default. see [ruby-dev:42358].

Sat Oct 16 00:08:00 2010  Koichi Sasada  <ko1@atdot.net>

	* hash.c (rb_hash_aref): skip calling "default" method
	  if it is not needed, for speed-up.

Fri Oct 15 23:36:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (NUM2DEVT, DEVT2NUM, PRI_DEVT_PREFIX): fallback to
	  unsigned int.

Fri Oct 15 22:54:46 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_hresult2msg): get English message first,
	  instead of system default. [ruby-core:32765]

Fri Oct 15 22:47:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (VALUE): prefer long over uintptr_t,
	  FIX2LONG expects VALUE to be long at least.

	* include/ruby/ruby.h (FIX2LONG): parenthesize the argument.

Fri Oct 15 20:30:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (dev_t): use RUBY_REPLACE_TYPE.

	* file.c (rb_stat_inspect): use PRI_DEVT_PREFIX.

Fri Oct 15 17:26:57 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): simplify comparison of explicit_endian
	  as pointed by nobu.

	* pack.c (pack_unpack): ditto.

Fri Oct 15 16:40:37 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): fix more than one modifiers appear in the
	  format string. [ruby-core:32793]

	* pack.c (pack_unpack): ditto.

Thu Oct 14 23:20:42 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb: refactoring.

Thu Oct 14 22:18:29 2010  Koichi Sasada  <ko1@atdot.net>

	* insns.def, iseq.c, vm_insnhelper.c: rename variable name
	  (ip -> iseq).

Thu Oct 14 20:41:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): support endian modifiers: < and >.
	  [ruby-dev:42376] Feature #3491

	* pack.c (pack_unpack): ditto.

Thu Oct 14 20:50:51 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (reg_get_val): expand environment in
	  the pathname. [Bug #3907]

Thu Oct 14 07:35:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (DEVT2NUM): added. Size of dev_t is depend on the
	  environment even if POSIX defines dev_t as unsigned integer.
	  For example, OpenVMS, 64bit Solaris 9, and NetBSD 6 defines
	  dev_t as 64bit unsigned integer.

	* file.c (rb_stat_dev): use DEVT2NUM.

	* file.c (rb_stat_dev_major): dev_t is not long. major(3)'s return
	  value is int.

	* file.c (rb_stat_dev_minor): dev_t is not long. minor(3)'s return
	  value is int.

	* configure.in: check size of dev_t.

Thu Oct 14 07:22:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_and, rb_ary_or), class.c (rb_mod_init_copy),
	  gc.c (undefine_final), time.c (time_mload): get rid of
	  type-punning casts.

Thu Oct 14 04:16:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (ruby_float_step): fix Numeric#step with infinity unit
	  doesn't works well. [ruby-core:32779]

Wed Oct 13 23:16:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/enc-unicode.rb: get rid of lots of warnings.

	* iseq.c (insn_operand_intern, rb_iseq_disasm): fix format specifiers.

	* vm.c (thread_free): ditto.

	* numeric.c (check_uint): get rid of overflow on LLP64 platforms.

	* insns.def (opt_case_dispatch): use st_data_t.

Wed Oct 13 22:32:34 2010  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/util.rb (CGI::unescape): bugfix to unescape the multibyte
	  string. Thanks nobu and tDiary dev members. [Bug #3909]

Wed Oct 13 21:13:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_chr): raise error when the value is negative.

Wed Oct 13 19:24:08 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm.c (ruby_vm_destruct): This function type was wrong; correct to the prototype.

Wed Oct 13 14:58:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num_to_uint): fix 32bit logic.

Wed Oct 13 12:53:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num_to_uint): added to check the range of arguments.
	  Mainly for negative value with NUM2UINT on 32bit environment.

	* string.c (rb_str_concat): use rb_num_to_uint.

Wed Oct 13 12:10:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_error): get English message first, instead
	  of system default. see [ruby-core:32765].
	  [experimental]

Wed Oct 13 11:04:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c (ruby_set_debug_option): define always for binary
	  compatibility with debug env enabled binary.

	* signal.c (ruby_enable_coredump): ditto.

Wed Oct 13 10:52:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ruby_executable_node): missing prototype.

Wed Oct 13 05:23:04 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* missing/strchr.c: add strlen's prototype.

	* missing/strstr.c: ditto.

Wed Oct 13 00:21:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (struct mktime_arg): constified.

	* ext/syck/rubyext.c (mktime_do, mktime_r, rb_syck_mktime): fix
	  function signatures.

Wed Oct 13 00:18:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (MurmurMagic): get rid of literal overflow.

	* configure.in (RUBY_CHECK_PRINTF_PREFIX): check for printf format
	  specifier if possible.

Tue Oct 12 23:58:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_open_osfhandle, rb_w32_wopen, rb_w32_pipe):
	  use uintptr_t instead of long for win64.

	* win32/win32.c (socketpair_internal): suppress warnings.

	* win32/win32.c (ftruncate): use HANDLE instead of long for win64.

	* vsnprintf.c (BSD_vfprintf): fix cast.

	* numeric.c (rb_num2fix): result of rb_num2long is SIGNED_VALUE.

	* compile.c (iseq_build_body), error.c (set_syserr, get_syserr),
	  (syserr_initialize), gc.c (define_final, rb_gc_copy_finalizer),
	  (run_final), hash.c (rb_hash_aref, rb_hash_lookup2),
	  (rb_hash_fetch_m, rb_hash_clear, rb_hash_aset, eql_i),
	  iseq.c (iseq_load, iseq_data_to_ary), marshal.c (r_symlink),
	  thread.c (rb_thread_local_aref),
	  variable.c (generic_ivar_remove, ivar_get, rb_const_get_0),
	  (rb_cvar_get), vm.c (rb_vm_check_redefinition_opt_method),
	  vm_insnhelper.c (vm_get_ev_const), vm_method.c (remove_method),
	  ext/iconv/iconv.c (map_charset): use st_data_t.

	* compile.c (iseq_build_body), insns.def (getglobal, setglobal),
	  iseq.c (iseq_load, iseq_data_to_ary), util.c (valid_filename):
	  use VALUE.

	* gc.c (obj_free, rb_objspace_call_finalizer): fix truncating
	  cast.

	* gc.c (mark_current_machine_context): suppress warnings.

	* compile.c (iseq_compile_each): fix truncating cast.

	* cont.c (fiber_setcontext): missing variable definition.

Tue Oct 12 19:25:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (exc_to_s): use OBJ_INFECT.

	* error.c (name_err_to_s): ditto.

	* error.c (name_err_mesg_to_str): ditto.

	* error.c (syserr_initialize): ditto.

Tue Oct 12 19:07:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): taint message if mesg is given
	  and it is tainted.

Tue Oct 12 18:25:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ungetc): always see Bignum. On 32bit valid value
	  may be a Bignum. On 64bit for errors. [ruby-dev:42366]

Tue Oct 12 18:25:04 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): use unsigned int for GB18030.

Tue Oct 12 17:53:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric (check_uint): the mask must refer to VALUE.

Tue Oct 12 17:47:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric (check_uint): set MSB for negative value.

	* numeric (rb_num2uint): return value's type of rb_num2ulong
	  is VALUE.

	* numeric (int_chr): variable i can't be negative.

Tue Oct 12 16:04:37 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_strerror): get English message first, instead
	  of system default. see [ruby-dev:42358].
	  [experimental]

Tue Oct 12 15:52:35 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_strerror): unmap some range of errno for
	  workaround of VC10's strerror() and sys_nerr problem.
	  based on a patch from Akio Tajima, [ruby-dev:42355].

Tue Oct 12 15:36:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ungetc): use unsigned int for GB18030.

Tue Oct 12 15:14:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_putc): support multibyte characters.
	  [ruby-core:30697]

Tue Oct 12 15:10:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_enc_uint_chr): split from int_chr.

	* numeric.c (int_chr): use rb_enc_uint_chr.

	* include/ruby/encoding.h (rb_enc_uint_chr): added.

Tue Oct 12 14:04:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_chr): a codepoint of Ruby M17N must be 32bit
	  unsigned int; GB18030 uses MSB. Also note that OnigCodePoint
	  is defined as unsigned int.

Tue Oct 12 12:20:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): foolish mistake.

Tue Oct 12 10:39:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_MINGW32): canonicalize only on mingw.

Mon Oct 11 20:20:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (HTTP.get): specify ASCII-8BIT as the result
	  encoding of Zlib::GzipReader.
	  http://hibari.2ch.net/test/read.cgi/tech/1281473294/271

Mon Oct 11 17:42:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): use mesg's encoding when locale
	  encoding is US-ASCII. If locale encoding is not US-ASCII,
	  assume err has non ASCII characters. [ruby-dev:42358]

Mon Oct 11 14:03:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): set the encoding of Errno::*#message
	  as locale. [ruby-dev:42358]

Mon Oct 11 06:38:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_set_encoding):
	  StringIO#set_encoding can get 2nd argument and optional hash
	  for API compatibility to IO. [ruby-dev:42356]

Mon Oct 11 06:11:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_set_encoding): use rb_funcall2 when the io is not
	  a T_FILE. [ruby-dev:42356]

Sun Oct 10 18:42:23 2010  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#replace): Apply a bit of optimization.

Sun Oct 10 10:20:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_MINGW32): canonicalize as like mswin version.

Sun Oct 10 05:33:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_signal_buff_size, rb_signal_exec): moved
	  declarations from thread.c.

Sat Oct  9 16:54:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RSHIFT): quote to get rid of argument expansion
	  for autoconf 2.68.

Sat Oct  9 11:00:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_reset_event_flags, exec_event_hooks): ignore
	  hooks marked as removed.

	* thread.c (thread_exec_event_hooks): remove hooks to be removed.

	* thread.c (rb_threadptr_remove_event_hook, rb_remove_event_hook):
	  defer removing hooks if running the hooks.  [ruby-dev:42350]

Sat Oct  9 10:51:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_threadptr_exec_event_hooks): suppress each event
	  hooks separately.

	* thread.c (thread_suppress_tracing): split from
	  ruby_suppress_tracing, accepting thread pointer and event mask.

Sat Oct  9 08:16:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_threadptr_remove_event_hook): fix typo.

Fri Oct  8 10:52:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RBCONFIG): depends on version.h due to
	  RUBY_PATCHLEVEL.  [ruby-core:32709]

Fri Oct  8 00:24:54 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Fixing documentation typos.  [ruby-core:32712]

Thu Oct  7 09:14:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c (vm_exec_core):  Treat clang as non gcc on this
	  context: It has __asm__ but doesn't works well.

Wed Oct  6 12:28:22 2010  Tanaka Akira  <akr@fsij.org>

	* lib/uri/generic.rb (URI::Generic#hostname): new method.
	  (URI::Generic#hostname=): ditto.

	* lib/open-uri.rb: use URI#hostname

	* lib/net/http.rb: ditto.

	  reported by Adam Majer.  [ruby-core:32056]

Wed Oct  6 11:52:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fptr_finalize): write_mutex might have been destroyed
	  already in finalization phase, as the order of finalizers is not
	  guaranteed.  rb_mutex_t should be used in place of Mutex object
	  in the future.

Tue Oct  5 22:17:02 2010  wanabe  <s.wanabe@gmail.com>

	* win32/mkexports.rb: revert r29320 and r29402.

Mon Oct  4 12:43:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (regexp): dregexp has literal string only at the head
	  and successors are array.  [ruby-core:32682]

Mon Oct  4 10:22:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rand_init): This checks the value is in 32bit or not,
	  so use int32_t, not int.

Mon Oct  4 09:47:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rand_init): remove useless assignment.

	* re.c (update_char_offset): remove unused variable.

	* re.c (read_escaped_byte): ditto.

Mon Oct  4 09:30:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/lib/openssl/bn.rb (Integer#to_bn): OpenSSL::BN.new
	  accepts only Strings, so call Integer#to_s(16).
	  16 is for an optimization. [ruby-dev:42336]

Mon Oct  4 07:57:51 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (fiber_memsize): Return size.
	  Before this change, fiber_memsize always returns 0.

Mon Oct  4 07:16:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/unicode.c (onigenc_unicode_property_name_to_ctype):
	  remove useless assignment.

	* vm.c (vm_make_proc_from_block): ditto.

	* variable.c (rb_ivar_count): ditto.

Mon Oct  4 06:40:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* Makefile.in (clean-rdoc): Don't use \ in variable expansion.
	  BSD make treats it as an escape character.

Mon Oct  4 00:01:53 2010  wanabe  <s.wanabe@gmail.com>

	* tool/config.sub: revert r29320, r29324, r29347, r29354, r29365
	  to automake-1.11.1. [ruby-core:32634]

	* win32/mkexports.rb: no longer use 'mingw64'. a patch from Luis Lavena
	  at [ruby-core:32678].

Sun Oct  3 20:36:37 2010  Akio Tajima (arton)  <artonx@yahoo.co.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb: Change creating
	  shortcut verb to 'Link' [Bug #3339]

Sun Oct  3 19:44:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): get rid of duplicated ruby target when
	  already there it was.

Sat Oct  2 22:59:32 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_thread.rb: add for win32ole with Thread.

Fri Oct  1 17:03:00 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/webrick/test_httpproxy.rb (TestWEBrickHTTPProxy::test_upstream_proxy):
	  My machine fails this test at this line, saying 503 service unavailable.

Thu Sep 30 16:11:08 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getenv): should return NULL if specified name
	  is empty. a patch from Heesob Park at [ruby-core:32650]

Thu Sep 30 15:18:23 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (command_asgn): allow command_call to be right hand side
	  expression of chained assignment.  [ruby-dev:42313]

Thu Sep 30 10:55:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (ruby_setenv): workaround for old Windows. a patch from
	  Heesob Park. [ruby-core:32353]

Thu Sep 30 09:29:06 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form): change treatment of
	  undefined value in given array as latest internet draft for
	  application/www-form-urlencoded.
	  http://tools.ietf.org/html/draft-hoehrmann-urlencoded-01

Thu Sep 30 09:34:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): fixed wrong type of return value of
	  SymGetModuleBase64(). [ruby-dev:42306]

Wed Sep 29 21:04:05 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions::test_script_from_stdin):
	  As usual, PTY is not always available.

Wed Sep 29 18:38:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x64): regularize only for pc vendor, and strip
	  useless 64 suffix.

Wed Sep 29 17:53:02 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BIGDECIMAL_ENABLE_VPRINT):
	  VPrint is usually disabled.  It's only used in debugging.

Wed Sep 29 17:41:34 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_limit):
	  return the result of a block.

	* test/bigdecimal/test_bigdecimal.rb (test_save_limit):
	  add a test for the above change.

Wed Sep 29 16:18:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): remove unused optional arguments.

Wed Sep 29 13:26:30 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_rounding_mode):
	  return the result of a block.

	* test/bigdecimal/test_bigdecimal.rb (test_save_rounding_mode):
	  add a test for the above change.

	* test/bigdecimal/test_bigdecimal.rb (test_save_exception_mode):
	  add a test for the return value of BigDecimal.save_exception_mode.

Wed Sep 29 12:45:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_div2, BigDecimal_add2,
	  BigDecimal_sub2, BigDecimal_mult2, VpLimitRound): remove meaningless
	  casts to get rid of compiler warnings.

Wed Sep 29 12:35:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VPrint, VpToString): fix format.

Wed Sep 29 12:31:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/known_classes.rb (RDoc::KNOWN_CLASSES): add Encoding.

Tue Sep 28 20:50:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x64): regularize same as mswin.

Tue Sep 28 20:06:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): add windows support.
	  based on patches from Peter Weldon at [ruby-core:32551]

Mon Sep 27 23:30:34 2010  Koichi Sasada  <ko1@atdot.net>

	* insns.def (opt_case_dispatch), vm_insnhelper.c:
	  execute the procedures of "when" clauses by bytecode
	  instead of st_foreach() when the object does not hit
	  prepared hash.  [ruby-dev:42304]

Mon Sep 27 15:54:03 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/http/test_https.rb: As always, localhost is not
	  guaranteed to be resolved as 127.0.0.1.  But a SSL
	  certificate needs a socket to listen on a specific address
	  where a CN resolves to.  On situations where localhost is
	  not 127.0.0.1, these tests are not possible.

Mon Sep 27 15:25:05 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/imap/test_imap.rb: resurrection of r29259.
	  this change depends on minitest 1.7.1.

	* lib/test/unit/assertions.rb: ditto.

Sun Sep 26 22:59:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x86_64-pc-mingw64): regularize.

Sun Sep 26 22:21:07 2010  wanabe  <s.wanabe@gmail.com>

	* ext/openssl/ossl_hmac.c (ossl_hmac_hexdigest, ossl_hmac_s_hexdigest),
	  ext/openssl/ossl_pkey_ec.c (ossl_ec_group_set_seed),
	  ext/openssl/ossl_ssl_session.c (ossl_ssl_session_to_der),
	  ext/openssl/ossl_pkcs7.c (numberof): suppress warnings.
	  [ruby-core:31932]

Sun Sep 26 10:25:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.{guess,sub}: updated to automake-1.11.1.

Sat Sep 25 22:48:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_DLDFLAGS): fix quoting.

Sat Sep 25 10:30:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_DLDFLAGS): use -unexported_symbol only
	  when available.  http://trac.macports.org/ticket/26341

Sat Sep 25 10:05:49 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Always add -mieee for Renesas SH4.
	  Thanks, Nobuhiro Iwamatsu. [Feature #3874] [ruby-core:32548]

Sat Sep 25 01:34:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (install-cross): target to install cross-compiling
	  stuff.

Fri Sep 24 23:44:59 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_call), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (vm_yield_with_cfunc): pass given block.
	  [ruby-core:32075]

	* vm_eval.c (rb_funcall_passing_block): new function to call
	  method with passing given block.

Fri Sep 24 15:50:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_to_i): fix rdoc: String#to_i raises an
	  exception when base is invalid. [ruby-core:31685]

Fri Sep 24 15:28:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_rindex): use rb_enc_prev_char instead of repeated
	  str_nth.
	  patched by Michael Selig [ruby-core:32498]

Fri Sep 24 14:19:12 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/test_pty.rb: Same as 229281; existence of PTY class do not
	  guarantee a successful pty operation.

Fri Sep 24 06:25:55 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.7.2 r5879.
	* test/minitest/*.rb: ditto.

Thu Sep 23 23:09:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_cref0): cref is stacked only in normal
	  iseqs, so check if it is the case first.

Thu Sep 23 23:08:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub: mingw64 should use x86_64.  [ruby-core:32514]

Thu Sep 23 21:40:40 2010  wanabe  <s.wanabe@gmail.com>

	* ext/socket/raddrinfo.c (init_addrinfo, inspect_sockaddr): suppress
	  warnings.  see [ruby-core:31932].

Thu Sep 23 19:27:57 2010  wanabe  <s.wanabe@gmail.com>

	* thread_win32.c (w32_wait_events, w32_close_handle): suppress warnings.
	  see [ruby-core:31932].

Thu Sep 23 18:54:39 2010  wanabe  <s.wanabe@gmail.com>

	* tool/config.sub: add mingw64.

	* win32/mkexports.rb (Exports::Mingw64): added.

	* win32/mkexports.rb (Exports::Mingw32): renamed from Exports::Mingw.

Thu Sep 23 09:01:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_cref_push): no outer cref is needed for proc
	  from method.  Bug #3786, Bug #3860, [ruby-core:32501]

Wed Sep 22 17:12:01 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/openssl/utils.rb (OpenSSL#silent): always restore $VERBOSE.
	  [ruby-dev:42285]

Wed Sep 22 16:59:40 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_prime.rb (TestPrime#test_new): the warning expected have
	  not been displayed when $VERBOSE == nil. Patch by Shota Fukumori
	  a.k.a. sora_h. [ruby-dev:42272]
	  Recovers $stderr even if StringIO.new fails. Reported by unak.

Wed Sep 22 01:55:48 2010  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_method.rb: fix last commit.

Wed Sep 22 01:49:52 2010  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_method.rb: add a test for [ruby-core:30534].

Wed Sep 22 00:52:44 2010  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/rdoc/ri/store.rb (save_cache): remove duplicate entries.

Wed Sep 22 00:00:05 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_f_pathname): Pathname() translated
	  from pathname.rb.

Tue Sep 21 22:18:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/mkconfig.rb: fixed build problem on mswin64 introduced in r29278.

Tue Sep 21 02:42:35 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/pathname/test_pathname.rb (TestPathname#test_mkdir): fix typo.

Mon Sep 20 23:23:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (bracket): get rid of scanning at the end of the pattern
	  string, not to raise an exception while globbing command line.
	  [ruby-core:32478]

Mon Sep 20 11:25:49 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (Init_pathname): Pathname#=~ undefinition
	  translated from pathname.rb.

Mon Sep 20 02:34:11 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (check_rounding_mode, BigDecimal_mode):
	  raise ArgumentError instead of TypeError passing invalid modes.

	* test/bigdecimal/test_bigdecimal.rb (test_mode, test_round):
	  change against the above modifications.

Sun Sep 19 22:08:39 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mkmf.rb (try_link): rdoc
	  (try_compile): ditto
	  (try_cpp): ditto
	  (try_func): ditto
	  (try_var): ditto
	  (try_run): ditto
	  (egrep_cpp): ditto

Sun Sep 19 20:43:33 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in (--disable-install-doc): disables capi too, in addition
	  to rdoc.
	  (--disable-install-rdoc): a new option for disabling only rdoc.
	  (--disable-install-capi): a new option for disabling only capi.

Sun Sep 19 20:37:45 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (clean): removes all documents on cleaning.o
	  (CAPIOUT): new variable.
	  (clean-capi, distclean-capi, realclean-capi): new targets

	* Makefile.in (clean-capi, distclean-capi, realclean-capi): ditto.

	* win32/Makefile.sub (clean-capi, distclean-capi, realclean-capi):
	  ditto.

Sun Sep 19 13:44:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_SO): fix an oversight of replace
	  RUBY_INSTALL_NAME with RUBY_SO_NAME.  a patch from Jeremy Evans
	  at [ruby-core:32474].

Sun Sep 19 07:48:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_unlink): Pathname#unlink and
	  Pathname#delete translated from pathname.rb.

Sun Sep 19 06:06:07 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (check_rounding_mode): added for
	  converting symbol to rounding mode number.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode, BigDecimal_round):
	  support to specify rounding mode by symbol.

	* test/bigdecimal/test_bigdecimal.rb (test_mode, test_round):
	  add tests for above changes.

Sun Sep 19 05:14:35 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c: fix rounding algorithms for half-down
	  and half-even.  This change is based on the patch created by Matthew
	  Willson, the reporter of this bug.  [Bug #3803] [ruby-core:32136]

	* test/bigdecimal/test_bigdecimal.rb: add tests for above changes.

Sat Sep 18 20:09:51 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_each_entry): Pathname#each_entry
	  translated from pathname.rb.

Fri Sep 17 23:44:07 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/xpath_parser.rb, test/rexml/test_xpath.rb:
	  add missing method availability check. [ruby-core:32447]
	  Reported by Wiebe Cazemier. Thanks!!!

Fri Sep 17 23:23:26 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_sax.rb: don't use thread and sleep to avoid slow test.

Fri Sep 17 23:10:44 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb: enable.

Fri Sep 17 22:46:02 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: untabify.

Fri Sep 17 22:29:56 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: fix fixture data path. All REXML tests are worked.

Fri Sep 17 22:15:15 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_listener.rb: remove needless codes.

Fri Sep 17 22:12:23 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: import REXML tests from
	  http://www.germane-software.com/repos/rexml/trunk/test/.
	  Many tests are failed temporary. I'll fix them quickly. Sorry.

Fri Sep 17 16:48:49 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/io/console/test_io_console.rb (TestIO_Console::helper):
	  PTY.open is not guaranteed to work.  On my machine opening a
	  pty is prohibited via process control group.  On those cases
	  exceptions shall occur, and that doesn't mean our fault.
	  Skip those tests on such situations.

Fri Sep 17 08:30:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tracer.rb: count only non-internal libraries in stack trace,
	  ignoring custom_require.  [ruby-core:31858]

Fri Sep 17 02:18:41 2010  Akinori MUSHA  <knu@iDaemons.org>

	* tool/mkconfig.rb: Fix build with m4 1.4.15 generating duplicate
	  lines in config.status.  According to nobu, the mswin32 port may
	  depend on the piece of code in question, so the behavior is left
	  unchanged on mswin32.

Thu Sep 16 23:47:59 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_opendir): Pathname#opendir translated
	  from pathname.rb.

Thu Sep 16 21:40:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GlobOption): merged RejectOption.

	* test/runner.rb: utilize GlobOption.

Thu Sep 16 21:31:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/driver.rb (RDoc::RI::Driver.setup_options)
	  (RDoc::RI::Driver.fixup_options): split from process_args.
	  libraries should not parse ARGV inside, since it's a task of
	  applications, not libraries.

Thu Sep 16 21:02:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths.each): HOMEDIR can be nil
	  if $HOME is unset.

Thu Sep 16 14:50:42 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_file_exhaustive.rb (TestFileExhaustive::test_expand_path):
	  ENV["HOME"] might not be set.  On those cases without it an
	  exception raises here, which effectively disables later
	  tests on this method.

Thu Sep 16 08:30:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): fix rdoc.  pointed out by Tomoyuki
	  Chikanaga at [ruby-core:32395], and a patch from Daniel
	  Bovensiepen at [ruby-core:32403].

Thu Sep 16 08:27:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/extconf.rb: use expanded sysconfdir with empty DESTDIR.
	  [ruby-core:32394]

Thu Sep 16 06:07:24 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_rmdir): Pathname#rmdir translated
	  from pathname.rb.

Thu Sep 16 00:36:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/extconf.rb: Remove Readline 6 check because
	  Ruby's license is now GPLv3 compatible. [ruby-core:28736]

Thu Sep 16 00:26:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* COPYING: change Ruby's License from a dual license with GPLv2
	  to a dual license with 2-clause BSDL.
	  [ruby-dev:42166] [ruby-core:31971]
	  [ruby-dev:39167] [ruby-core:25272]

	* COPYING.ja: ditto.

	* BSDL: added. this is from The FreeBSD License.

Wed Sep 15 21:07:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_mkdir): Pathname#mkdir translated
	  from pathname.rb.

Wed Sep 15 13:37:00 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/imap/test_imap.rb: "localhost" not guaranteed to
	  resolve to "127.0.0.1".  On my machine it is "::1" instead.
	  The problem is, you have to connect to the imaps server via
	  the canonical name written in a server certificate, and that
	  of the server.cert is "localhost".  So you have to listen to
	  the address of what "localhost" resolves to.  I think this
	  situation cannot be resolved in a handy manner because the
	  test "test_imaps_post_connection_check" is actually
	  expecting to connect to a server via an address other than
	  the CN.  On my machine several assertions won't pass because
	  the test cannot connect to the server.

Wed Sep 15 09:12:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_puts): fix for wide char encoding strings.
	  [ruby-dev:42212]

Wed Sep 15 07:27:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_format_m): mentioned about Hash argument.  a patch
	  from Daniel Bovensiepen at [ruby-core:32386].

	* sprintf.c (get_hash): ditto, and fix typo.

Wed Sep 15 07:22:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_entries): Pathname#entries translated
	  from pathname.rb.

Wed Sep 15 02:13:44 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/closure.c : Don't use FFI closure alloc on OpenBSD.
	  Thanks Jeremy Evans! [ruby-core:32384]

Tue Sep 14 20:17:48 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_s_getwd): Pathname.getwd and
	  Pathname.pwd translated from pathname.rb.

Tue Sep 14 05:13:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_s_glob): Pathname.glob translated
	  from pathname.rb.

Tue Sep 14 01:24:51 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* ext/socket/raddrinfo.c (ruby_getaddrinfo__aix): suppress a
	  warning.

Mon Sep 13 20:48:30 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_zero_p): Pathname#zero? translated
	  from pathname.rb.

Mon Sep 13 19:56:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/rubysocket.h (__DARWIN_ALIGNBYTES): workaround of a
	  bug in system header of darwin 9.  [ruby-core:32341]

Mon Sep 13 18:11:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_do): fix typo.  a patch from Peter Weldon
	  at [ruby-core:32327].

Mon Sep 13 10:12:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): reject Float('0x0.').
	  [ruby-dev:42239] Bug #3820

Mon Sep 13 09:23:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (ossl_bn_is_prime): fix comparison
	  with rb_scan_args. Before this fix, OpenSSL::BN#prime?
	  is fully broken. [ruby-dev:42225]

Mon Sep 13 06:45:24 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_writable_real_p):
	  Pathname#writable_real? translated from pathname.rb.

Sun Sep 12 21:21:50 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: [ruby-core:32096]  Thanks Colin Bartlett.

Sun Sep 12 19:30:27 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_world_writable_p):
	  Pathname#world_writable? translated from pathname.rb.

Sun Sep 12 09:16:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_writable_p): Pathname#writable?
	  translated from pathname.rb.

Sun Sep 12 08:36:15 2010  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_name2int): support more limits:
	  RLIMIT_MSGQUEUE, RLIMIT_NICE, RLIMIT_RTPRIO, RLIMIT_RTTIME and
	  RLIMIT_SIGPENDING.
	  (Init_process): ditto.
	  patch by Run Paint Run Run.  [ruby-core:32262]

Sun Sep 12 04:27:13 2010  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_name2int): use STRCASECMP to avoid
	  ALLOCA_N.

Sat Sep 11 16:47:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (ruby_setenv): raise if putenv and SetEnvironmentVariable
	  failed, because of the restriction of the size on Windows.
	  based on a patch from Peter Weldon at [ruby-core:32304].  fix:
	  Bug#3812, [ruby-core:32250]

Sat Sep 11 15:19:57 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpauth/digestauth.rb (WEBrick::Config::DigestAuth):
	  Add documentation

	* lib/webrick/config.rb (WEBrick::Config::DigestAuth): Add
	  documentation

Sat Sep 11 12:32:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_set_kcode, rb_get_kcode): removed
	  zombie prototype declarations.  a patch from Eric Hodel
	  at [ruby-core:32305].

Sat Sep 11 06:53:12 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_symlink_p): Pathname#symlink?
	  translated from pathname.rb.

Fri Sep 10 23:03:43 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sticky_p): Pathname#sticky? translated
	  from pathname.rb.

Fri Sep 10 19:11:13 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#continue): add
	  method for generating HTTP/1.1 100 continue response if the client
	  expects it, otherwise does nothing.  Patch by Brian Candler.
	  ref #855.

	* test/webrick/test_httprequest.rb: test added.

Fri Sep 10 17:49:34 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/x509-internal.rb: removed unused local
	  variable.

	* test/openssl/*: less warnings while test running with -w.

Fri Sep 10 16:49:20 2010  Akinori MUSHA  <knu@iDaemons.org>

	* class.c (rb_scan_args): Add support for optional keyword
	  argument hash. [ruby-dev:42221] [ruby-dev:38048]

	* README.EXT, README.EXT.ja: Update documentation accordingly.

	* dir.c (dir_initialize): Make use of the new rb_scan_args()
	  feature.

	* io.c (rb_io_s_popen, rb_scan_open_args, rb_io_initialize)
	  (rb_io_s_pipe, open_key_args, io_s_foreach, io_s_readlines)
	  (rb_io_s_read, rb_io_set_encoding): Ditto.

	* transcode.c (str_transcode, econv_args)
	  (econv_primitive_convert): Ditto.

	* ext/zlib/zlib.c (rb_gzreader_initialize): Ditto.

Fri Sep 10 10:33:18 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rb_genrand_ulong_limited): renamed from
	  rb_rand_internal and now this is public API.

	* include/ruby/ruby.h (rb_genrand_ulong_limited): added.

	* bignum.c (big_sparse_p): use rb_genrand_ulong_limited.

Fri Sep 10 13:07:22 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/digest/lib/digest.rb: removed unused exception variable
	  assignment to avoid a warning.

Fri Sep 10 07:29:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_systmpdir): assume system default tmpdir
	  safe.  [ruby-dev:42089]

Fri Sep 10 07:03:23 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_size_p): Pathname#size? translated from
	  pathname.rb.

Fri Sep 10 02:15:29 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_peercred): support OpenBSD-current.
	  patch by Jeremy Evans.  [ruby-core:32240]

Thu Sep  9 23:25:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace_each): skip allocator frames which have no
	  name.  [ruby-core:32231]

Thu Sep  9 22:39:08 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_size): Pathname#size translated from
	  pathname.rb.

Thu Sep  9 22:34:48 2010  wanabe  <s.wanabe@gmail.com>

	* compile.c (case_when_optimizable_literal): When float value can be
	  treated as integer, add to table hash of case that way.
	  based on a patch from Ikuo KOBORI. [ruby-dev:42038]

	* insns.def (opt_case_dispatch): ditto.

	* test/ruby/test_case.rb: add tests.

Thu Sep  9 17:15:15 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/net/http/test_https.rb (test_identity_verify_failure): follows
	  the SSL hostname check error message of openssl.

Thu Sep  9 10:44:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_env.rb (test_aset): OpenBSD acts like NetBSD in
	  that it ignores characters after = in ENV.
	  patched by Jeremy Evans [ruby-core:32184]

Thu Sep  9 09:02:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/rbinstall.rb (install?): gemspec filename should include
	  its version. patched by Luis Lavena [ruby-core:32165]

Wed Sep  8 22:46:31 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ssl_get_error): Thread context switch was
	  blocked on Windows while blocking call for SSLSocket.  Need to
	  convert errno for letting rb_io_wait_readable detect EWOULDBLOCK.
	  Patch by arton. ref #3794.

Wed Sep  8 20:56:57 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_setgid_p): Pathname#setgid? translated
	  from pathname.rb.

Wed Sep  8 06:25:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_setuid_p): Pathname#setuid? translated
	  from pathname.rb.

Tue Sep  7 21:03:35 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readable_real_p):
	  Pathname#readable_real?  translated from pathname.rb.

Mon Sep  6 23:07:25 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_world_readable_p):
	  Pathname#world_readable?  translated from pathname.rb.

Mon Sep  6 11:03:13 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* Fixed wrong check of missing functions. Patch by Adrian Quark.
	  ref #3400
	  The patch contains following comment:
	    This patch should avoid unnecessary incompatibility with future
	    versions of Openssl.  Changes suggested by bmaher_at_amazon.com.

Mon Sep  6 10:46:55 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* Fixed exception message for SSL post connection check failure. Patch
	  by Paul Betteridge. ref [Bug #3704]

Mon Sep  6 10:31:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_s_get_line_buffer):
	  Readline.line_buffer should return locale string.
	  [ruby-dev:42184] #3791

Mon Sep  6 09:47:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): check there is at least 1 digit after
	  "0x" before ".". [ruby-dev:42183] #3790

Mon Sep  6 09:44:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): check integer overflow.
	  [ruby-dev:42180] #3789

Mon Sep  6 06:17:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readable_p): Pathname#readable?
	  translated from pathname.rb.

Sun Sep  5 23:02:34 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_owned_p): Pathname#owned?
	  translated from pathname.rb.

Sat Sep  4 23:48:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_readlink): symlink target should be in
	  filesystem encoding.

Sat Sep  4 10:40:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (ruby_init_ext): export for golfers.

	* vm_core.h (rb_iseq_eval, rb_iseq_compile_with_option): ditto.

Sun May 23 17:29:41 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (capi): uses a timestamp file to get rid of
	  generating twice.

Fri Jun 18 01:33:21 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* enc/Makefile.in (realclean): has been missing. necessary
	  for make realclean-enc.

Fri Sep  3 23:51:26 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_socket_p): Pathname#socket?
	  translated from pathname.rb.

Fri Sep  3 06:40:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (chfunc): pass through exceptions.

	* io.c (rb_io_bufwrite, rb_io_bufread): added.

	* process.c (rb_fork_err): protect from exceptions.

Fri Sep  3 06:16:07 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_pipe_p): Pathname#pipe?
	  translated from pathname.rb.

Fri Sep  3 06:14:40 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (chfunc): restore errno from SystemCallError and
	  propagate proper exception to the parent.  [ruby-dev:41965]

Thu Sep  2 22:10:38 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_file_p): Pathname#file?
	  translated from pathname.rb.

Thu Sep  2 09:12:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): don't forget to free
	  memory.

Thu Sep  2 09:01:13 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): unicodize.

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): convert arguments of
	  CreateChild() from ACP to WideChar.

Thu Sep  2 06:53:43 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_directory_p): Pathname#directory?
	  translated from pathname.rb.

Wed Sep  1 22:03:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_grpowned_p): Pathname#grpowned?
	  translated from pathname.rb.

Wed Sep  1 17:39:02 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.7.1 r5835.
	* test/minitest/*.rb: ditto.

Wed Sep  1 16:50:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): optimized. don't create hash objects
	  when given pattern is ASCII only.

	* string.c (tr_find): ditto.

Wed Sep  1 14:35:29 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_rotate_m): fix typo of rdoc.
	  patched by Andrei Kulakov [ruby-core:31975]

Wed Sep  1 14:33:36 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enum.c (enum_zip): fix typo of rdoc.
	  patched by Andrei Kulakov [ruby-core:31974]

Wed Sep  1 12:56:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (ruby_suppress_tracing): restore the state and invoke
	  the func with normal state.  a patch from Satoshi Shiba <shiba
	  AT rvm.jp> at [ruby-dev:42162].  [ruby-core:31783]

Tue Aug 31 21:10:23 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_exist_p): Pathname#exist? translated
	  from pathname.rb.

Tue Aug 31 17:32:34 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/stubs.c: fix [Bug #3771] "VC++ can't make ext/tk with enabling
	  stubs". Thanks, Akio Tajima [ruby-dev:42159].

Tue Aug 31 03:42:14 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): fix bug in r29146.
	  Initialize table even if cflag is 0; tr_find see whether
	  del is empty or not.

	* string.c (tr_find): nodel can't be NULL; if NULL, it means
	  it is not specified.

Mon Aug 30 21:29:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_executable_real_p):
	  Pathname#executable_real? translated from pathname.rb.

Mon Aug 30 15:00:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): initialize negating table when
	  negating string is given. [ruby-core:31851]

	* string.c (tr_find): add a sentence for the time when
	  target characters include negating one.

	* string.c (rb_str_count): move definition.

Mon Aug 30 07:32:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_executable_p): Pathname#executable?
	  translated from pathname.rb.

Sun Aug 29 23:54:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser/ruby.rb (RDoc#parse_call_parameters): don't
	  include assignment.  [Bug #3759], [ruby-dev:42154]

	* lib/rdoc/parser/ruby.rb (RDoc#parse_class): ignore non-constant
	  name singleton class.  [Bug #3759], [ruby-dev:42154]

Sun Aug 29 23:25:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_get_path_check): clarify error message for
	  ASCII-incompatible path name.

Sun Aug 29 16:02:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (node_name.inc): remove command option -n and give
	  file as stdin, because IronRuby 1.1 still doesn't support it.
	  So now we can use ir.exe as BASERUBY.

	* tool/node_name.rb: read stdin with while gets.

Sun Aug 29 13:22:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_method_id_and_class): curried proc has no
	  method.  [ruby-core:31871]

Sun Aug 29 12:51:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_provide_feature): clarify error message for frozen
	  $LOADED_FEATURES.  based on a patch from Run Paint Run Run at
	  [ruby-core:31913].

Sun Aug 29 12:19:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_failed): should honor encoding.  [ruby-core:31915]

Sun Aug 29 09:35:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (clean): exclude *.inc. [ruby-dev:41931]

	* common.mk (distclean): include *.inc.

	* common.mk (help): change description about clean and distclean.

Sat Aug 29 06:34:52 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_chardev_p): Pathname#chardev?
	  translated from pathname.rb.

Sat Aug 28 17:39:33 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_exception_mode,
	  BigDecimal_save_rounding_mode, BigDecimal_save_limit): added.

	* test/bigdecimal/test_bigdecimal.rb: added tests for the above
	  features.

Sat Aug 28 08:11:05 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_blockdev_p): Pathname#blockdev?
	  translated from pathname.rb.

Fri Aug 27 16:20:01 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* string.c (rb_str_prepend): new method by Shota Fukumori (sora_h)
	  [Feature #3765]

Fri Aug 27 15:24:20 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* math.c (math_atan2): you should know that M_PI is not the feature
	  of C90.
	  fixed build failure caused by r29115.

Fri Aug 27 15:26:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (null_device): move from io.c.

Fri Aug 27 12:47:44 2010  Kenta Murata  <mrkn@mrkn.jp>

	* math.c (math_atan2): change the behavior when x and y are zero.
	  [ruby-dev:42090] [Bug #3736] [ruby-dev:42116]

	* test/ruby/test_math.rb (test_atan2): add tests for the above
	  changes.

Fri Aug 27 12:26:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* object.c (rb_obj_class): remove mention of obsolete method.
	  a patch from Run Paint Run Run at [ruby-core:31842].

Fri Aug 27 12:25:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (null_device): the name of null device.  [ruby-dev:41791]

Fri Aug 27 07:57:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): bail out from modification during
	  shuffle.

	* array.c (rb_ary_sample): ditto.

Fri Aug 27 05:11:51 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sysopen): Pathname#sysopen translated
	  from pathname.rb.

Thu Aug 26 22:53:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle): rdoc fix.  argument name was missing.
	  a patch from Run Paint Run Run at [ruby-core:31848].

Thu Aug 26 21:49:46 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readlines): Pathname#readlines
	  translated from pathname.rb.

Thu Aug 26 10:37:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regint.h (OnigStackIndex): the type should be intptr_t.
	  Original Oniguruma assumes the size of long and that of void *
	  are equal, but it's not true on LLP64 platform: mswin64.
	  originally patched by shintaro kuwamoto [ruby-dev:42133]

Thu Aug 26 10:38:11 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* test/dl/test_base.rb: AIX does not have dynamically loadable lib[cm].

	* test/fiddle/helper.rb: AIX does not have dynamically loadable lib[cm].

Thu Aug 26 09:49:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): check number of argument.

Tue Aug 26 09:11:40 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_exception_mode, VpGetException,
	  VpSetException): thread-local exception mode.

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_precision_limit, VpGetPrecLimit,
	  VpSetPrecLimit): thread-local precision limit.

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_rounding_mode, VpGetRoundMode,
	  VpSetRoundMode, VpException, VpInternalRound):
	  thread-local rounding mode.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode, BigDecimal_round,
	  VpIsRoundMode, VpGetRoundMode, VpSetRoundMode, VpActiveRound,
	  VpMidRound, VpLeftRound), ext/bigdecimal/bigdecimal.h:
	  use unsigned short for rounding mode.

	* test/bigdecimal/test_bigdecimal.rb (test_mode): add test for
	  setting rounding mode.

	* test/bigdecimal/test_bigdecimal.rb (test_thread_local_mode):
	  add test for setting mode thread-locally.

Thu Aug 26 07:29:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_{shuffle_bang,sample}): use Random class object.

	* random.c (try_get_rnd): use default_rand for Random as same as
	  singleton methods.

	* random.c (rb_random_real): check the range of result.

Wed Aug 25 22:11:11 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_binread): Pathname#binread translated
	  from pathname.rb.

Wed Aug 25 03:42:43 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): workaround for VC9 for x64.
	  reported by kuwamoto shintaro in [ruby-dev:42125].

Tue Aug 24 23:28:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* .gitignore: updated.

Tue Aug 24 22:07:28 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_read): Pathname#read translated from
	  pathname.rb.

Tue Aug 24 10:11:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: read API version from include/ruby/version.h.

	* {bcc,win}32/setup.mak (-version-): ditto.

	* version.h (RUBY_LIB_VERSION): use API version numbers.

Tue Aug 24 07:07:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang, rb_ary_sample): add optional
	  argument random.  [ruby-dev:41923] [EXPERIMENTAL]

	* random.c (rb_random_{int32,real,bytes}): fallback to normal
	  method invocation.

Tue Aug 24 06:08:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/version.h (RUBY_API_VERSION_*): renamed and moved
	  from version.h.  [ruby-dev:42103]

Tue Aug 24 05:58:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ChangeLog: flushed.  [ruby-dev:42050]

For the changes before 1.9.3, see doc/ChangeLog-1.9.3
For the changes before 1.8.0, see doc/ChangeLog-1.8.0

Local variables:
coding: us-ascii
add-log-time-format: (lambda ()
  (let* ((time (current-time))
	 (system-time-locale "C")
	 (diff (+ (cadr time) 32400))
	 (lo (% diff 65536))
	 (hi (+ (car time) (/ diff 65536))))
  (format-time-string "%a %b %e %H:%M:%S %Y" (list hi lo) t)))
indent-tabs-mode: t
tab-width: 8
change-log-indent-text: 2
end:
vim: tabstop=8 shiftwidth=2
