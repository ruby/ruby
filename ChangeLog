Fri Jun 28 12:26:53 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big_and): Allocate new bignum with same size to shorter
	  argument if it's high bits are zero.

Fri Jun 28 12:14:04 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c (init_inetsock_internal): Don't use local
	  addresses which address family is different to remote address.

Fri Jun 28 08:06:22 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigand_int): Add arguments, xn and hibitsx.
	  Use twocomp2abs_bang.

Thu Jun 27 23:58:13 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (abs2twocomp_bang): Removed.
	  (abs2twocomp): Take n_ret argument to return actual length.
	  (rb_big_and): Follow above change.

Thu Jun 27 22:52:19 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (get2comp): Use bary_2comp.
	  (abs2twocomp_bang): New function.
	  (abs2twocomp): New function.
	  (twocomp2abs_bang): New function.
	  (rb_big_and): Use abs2twocomp and twocomp2abs_bang.

Thu Jun 27 20:03:13 2013  CHIKANAGA Tomoyuki  <nagachika@ruby-lang.org>

	* ext/openssl/lib/openssl/ssl.rb (verify_certificate_identity): fix
	  hostname verification. Patched by nahi.

	* test/openssl/test_ssl.rb (test_verify_certificate_identity): test for
	  above.


Thu Jun 27 00:23:57 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big_pow): Retry if y is a Bignum and it is
	  representable as a Fixnum.
	  Use rb_absint_numwords.

Wed Jun 26 23:53:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_rounding_mode): fix typo.
	  Fixes GH-343. Patch by @jgarber.

Wed Jun 26 23:22:21 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (rb_enumeratorize_with_size): use strict definition
	  rb_enumerator_size_func.

Wed Jun 26 23:11:14 2013  Kouhei Sutou  <kou@cozmixng.org>

	* gc.c (is_before_sweep): Add a missing space before a parenthesis.
	* gc.c (rb_gc_force_recycle): Add a missing space around a parenthesis.

Wed Jun 26 22:44:00 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_enumeratorize_with_size): cast for
	  backward compatibility.

	* include/ruby/intern.h (rb_enumerator_size_func): define strict
	  function declaration for rb_enumeratorize_with_size().

Wed Jun 26 21:01:22 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/ruby/test_io.rb (TestIO#test_write_32bit_boundary): skip if
	  writing a file is slow.
	  [ruby-core:55541] [Bug #8519]

Wed Jun 26 16:42:11 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: should use expanded values for header directories
	  unless extmk.  patch by vo.x (Vit Ondruch) at [ruby-core:55653]
	  [Bug #8115], rhbz#921650.

Wed Jun 26 12:48:22 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigxor_int): Fix a buffer over read.

Wed Jun 26 12:13:12 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigand_int): Consider negative values.
	  (bigor_int): The allocated bignum should have enough size
	  to store long.
	  This fixes (bignum fits in a BDIGIT) | (fixnum bigger than BDIGIT)
	  on platforms which SIZEOF_BDIGITS < SIZEOF_LONG,
	  such as LP64 with 32bit BDIGIT (no int128).

Wed Jun 26 12:08:51 2013  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_udp.rb: Close sockets explicitly.
	  Don't use fixed port number.

Wed Jun 26 07:27:17 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigand_int): Fix a buffer over read.

Wed Jun 26 06:48:07 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigadd_int): Fix a buffer over read.

Wed Jun 26 01:18:13 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (is_before_sweep): Add new helper function that check the object
	  is before sweep?
	* gc.c (rb_gc_force_recycle): Have to clear mark bit if object's slot
	  already ready to minor sweep.

Wed Jun 26 01:17:29 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigsub_int): Fix a buffer over read.

Tue Jun 25 22:45:43 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_absint_singlebit_p): Use POW2_P.
	  (bary_pack): Ditto.
	  (rb_big2str0): Ditto.
	  (POW2_P): Moved to top.

Tue Jun 25 22:28:07 2013  Akinori MUSHA  <knu@iDaemons.org>

	* lib/rubygems/ext/builder.rb (Gem::Ext::Builder.make): Pass
	  DESTDIR via command line to override what's in MAKEFLAGS.  This
	  fixes an installation problem under a package building
	  environment where DESTDIR is specified in the (parent) command
	  line. [Fixes GH-327]

Tue Jun 25 21:43:13 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big2dbl): Use (BDIGIT)1 instead of 1UL.
	  (bary_mul_normal): Remove a useless cast.

Tue Jun 25 21:26:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigMath_s_exp): Fix for the cases when
	  the argument x is not a BigDecimal.
	  This change is based on the patch made by Garth Snyder.
	  [Fix GH-332] https://github.com/ruby/ruby/pull/332

Tue Jun 25 20:36:31 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big2ulong): "check" argument removed.
	  (rb_big2ulong): Follow above change.
	  (rb_big2long): Ditto.
	  (rb_big_rshift): Ditto.
	  (rb_big_aref): Ditto.

Tue Jun 25 20:08:29 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big2ulong_pack): Use rb_integer_pack.
	  (rb_big_aref): Call big2ulong with TRUE for "check" argument.
	  It should be non-effective.

Tue Jun 25 19:07:33 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (LSHIFTX): Revert r41611.
	  The redundant expression suppresses a warning, C4293, by Visual
	  Studio.
	  http://ruby-mswin.cloudapp.net/vc10-x64/ruby-trunk/log/20130625T072854Z.log.html.gz#miniruby

Tue Jun 25 19:03:00 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big2ulong): Add a cast.
	  (big2ull): Add a specialized code for SIZEOF_LONG_LONG <=
	  SIZEOF_BDIGITS.

Tue Jun 25 12:42:57 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_unpack_single_bdigit): Use "1 + ~u" instead of
	  "-u" to suppress warning (C4146) by Visual Studio.
	  Reported by ko1 via IRC.

Tue Jun 25 12:28:57 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big2ulong): Add code specialized for SIZEOF_LONG <=
	  SIZEOF_BDIGITS.
	  This prevents shift width warning from "num <<= BITSPERDIG".

Tue Jun 25 12:23:30 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: fix oldgen/remembered_shady counting algorithm.

	* gc.c (rgengc_check_shady): increment
	  `objspace->rgengc.remembered_shady_object_count' here.

	* gc.c (rgengc_remember): return FALSE if obj is already remembered.

	* gc.c (rgengc_rememberset_mark): make it void.

	* gc.c (gc_mark_children): fix to double counting oldgen_object_count
	  at minor GC.

Tue Jun 25 12:07:18 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (MSB): Removed.
	  (BDIGIT_MSB): Defined using BIGRAD_HALF.
	  (bary_2comp): Apply BIGLO after possible over flow of BDIGIT.
	  (get2comp): Ditto.
	  (bary_unpack_internal): Use BDIGIT_MSB.
	  Apply BIGLO after possible over flow of BDIGIT.
	  (rb_integer_unpack): Use BDIGIT_MSB.
	  (calc_hbase): Use BDIGMAX.
	  (big2dbl): Use BDIGMAX.
	  Apply BIGLO after possible over flow of BDIGIT.
	  (rb_big_neg): Apply BIGLO after possible over flow of BDIGIT.
	  (biglsh_bang): Ditto.
	  (bigrsh_bang): Ditto.
	  (bary_divmod): Use BDIGIT_MSB.
	  (bigdivrem): Ditto.
	  (bigxor_int): Apply BIGLO after possible over flow of BDIGIT.

	* marshal.c (shortlen): Use SIZEOF_BDIGITS instead of sizeof(BDIGIT).

	* ext/openssl/ossl_bn.c (ossl_bn_initialize): Use SIZEOF_BDIGITS
	  instead of sizeof(BDIGIT).

Tue Jun 25 11:40:08 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (big2ulong): suppress shorten-64-to-32 warning.  BDIGIT can
	  be bigger than long now.

	* bignum.c (LSHIFTX): remove redundant never-true expression.

Tue Jun 25 00:55:54 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (typedef struct rb_objspace): Change members for monitor objects.
	* gc.c (gc_marks_test): Check all WriteBarrier Errors and track them in obj-tree.
	* gc.c (rgengc_check_shady): Ditto.
	* gc.c (gc_marks): Move 2 function calls to gc_marks_test for test initialize.

Mon Jun 24 23:30:31 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_unpack_single_bdigit): Refine code to filling
	  higher bits and use BIGLO.

Mon Jun 24 22:26:31 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/rinda/test_rinda.rb (RingIPv6#prepare_ipv6):
	  ifindex() function may not be implemented on Windows. We use another
	  check for the case.

Mon Jun 24 22:11:37 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_nolock):
	  skip a failing test on Windows because flock() implementation is
	  different from Unix.

Mon Jun 24 22:06:14 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/rubygems/test_gem_installer.rb (test_install_extension_flat):
	  use ruby in build directory in case ruby is not installed.
	  [ruby-core:53265] [Bug #8058]

Mon Jun 24 22:04:02 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* ext/dl/cfunc.c (rb_dlcfunc_call): fix conversion from Bignum to
	  pointer. sizeof(DLSTACK_TYPE) is larger than sizeof(long) on
	  Windows x64 and higher bits over sizeof(long) of DLSTACK_TYPE was
	  zero even if a pointer value was over 32 bits which causes SEGV on
	  DL::TestCPtr#test_to_ptr_io. Adding a cast solves the bug.

Mon Jun 24 22:04:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* eval_error.c (warn_printf): use rb_vsprintf instead so ruby specific
	  extensions like PRIsVALUE can be used in format strings
	* eval_error.c (error_print): use warn_print_str (alias for
	  rb_write_error_str) to print a string value instead of using
	  RSTRING_PTR and RSTRING_LEN manually
	* eval.c (setup_exception): use PRIsVALUE instead of %s and RSTRING_PTR

Mon Jun 24 20:31:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* compile.c (make_name_for_block): use PRIsVALUE in format string
	  instead of %s and RSTRING_PTR to protect objects from being garbage
	  collected too soon
	* encoding.c (str_to_encindex): ditto
	* hash.c (rb_hash_fetch_m): ditto
	* io.c (rb_io_reopen): ditto
	* parse.y (reg_fragment_check_gen): ditto
	* parse.y (reg_compile_gen): ditto
	* parse.y (ripper_assert_Qundef): ditto
	* re.c (rb_reg_raise): ditto
	* ruby.c (set_option_encoding_once): ditto
	* vm_eval.c (rb_throw_obj): ditto

Mon Jun 24 07:57:18 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (after_gc_sweep): Have to record malloc info before reset.
	* gc.c (gc_prof_timer_start): Pick out part of new record creation as gc_prof_setup_new_record.
	* gc.c (gc_prof_set_malloc_info): Move point of recording allocation size to front of mark.

Mon Jun 24 02:53:09 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c: Return value in Array overview example found by @PragTob
	  [Fix GH-336] https://github.com/ruby/ruby/pull/336

Mon Jun 24 02:45:51 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c (rb_ary_zip): typo by @PragTob [Fix GH-337]
	  https://github.com/ruby/ruby/pull/337

Mon Jun 24 02:42:01 2013  Zachary Scott  <zachary@zacharyscott.net>

	* win32/README.win32: grammar typo by @blankenshipz [Fix GH-334]
	  https://github.com/ruby/ruby/pull/334

Mon Jun 24 00:59:35 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (BIGUP): Use LSHIFTX and avoid cast to consider the type
	  of x is bigger than BDIGIT_DBL.
	  (big2ulong): Use unsigned long to store the result.
	  (big2ull): Use unsigned LONG_LONG to store the result.
	  (bigand_int): Use long for num to avoid data loss.
	  (bigor_int): Ditto.
	  (bigxor_int): Ditto.

Sun Jun 23 23:05:58 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/defines.h (BDIGIT): Define it only if it is not defined
	  yet.  This eases tests and debug.
	  (SIZEOF_BDIGITS): Ditto.
	  (BDIGIT_DBL): Ditto.
	  (BDIGIT_DBL_SIGNED): Ditto.
	  (PRI_BDIGIT_PREFIX): Ditto.
	  (PRI_BDIGIT_DBL_PREFIX): Ditto.
	  (PRIdBDIGIT): Define it only if PRI_BDIGIT_PREFIX is defined.
	  (PRIiBDIGIT): Ditto.
	  (PRIoBDIGIT): Ditto.
	  (PRIuBDIGIT): Ditto.
	  (PRIxBDIGIT): Ditto.
	  (PRIXBDIGIT): Ditto.
	  (PRIdBDIGIT_DBL): Ditto.
	  (PRIiBDIGIT_DBL): Ditto.
	  (PRIoBDIGIT_DBL): Ditto.
	  (PRIuBDIGIT_DBL): Ditto.
	  (PRIxBDIGIT_DBL): Ditto.
	  (PRIXBDIGIT_DBL): Ditto.

	* include/ruby/ruby.h (RBIGNUM_EMBED_LEN_MAX): Define it only if it is
	  not defined yet.

Sun Jun 23 17:29:51 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_unpack_single_bdigit): Use a cast.

Sun Jun 23 15:38:07 2013  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_thread.rb: rescue resource limitation errors.

Sun Jun 23 08:19:27 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_unpack_single_bdigit): Extracted from
	  bary_unpack_internal.

Sun Jun 23 07:41:52 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_unpack_internal): Suppress warnings (C4146) on Visual Studio.
	  Reported by ko1 via IRC.

Sun Jun 23 06:49:28 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h, gc.c: rename macros and functions:
	  OBJ_WB_GIVEUP() -> OBJ_WB_UNPROTECT(),
	  rb_obj_wb_giveup() -> rb_obj_wb_unprotect(),
	  rb_gc_giveup_promoted_writebarrier() ->
	  rb_gc_writebarrier_unprotect_promoted(),

	* class.c, eval.c, hash.c: use OBJ_WB_UNPROTECT().

Sun Jun 23 05:41:32 2013  Koichi Sasada  <ko1@atdot.net>

	* class.c (rb_include_class_new), eval.c (rb_using_refinement):
	  make classes/modules (who share method table) shady.
	  If module `a' and `b' shares method table m_tbl and new method
	  with iseq is added, then write barrier is applied only `a' or `b'.
	  To avoid this issue, shade such classes/modules.

	* vm_method.c (rb_method_entry_make): add write barriers.

Sun Jun 23 01:27:54 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bytes_zero_p): Removed.
	  (bary_pack): Don't call bytes_zero_p.

Sun Jun 23 00:51:29 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bytes_zero_p): Extracted from bary_pack.
	  (bary_pack): Use bytes_zero_p.

Sun Jun 23 00:16:57 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (MSB): New macro.
	  (bary_unpack_internal): Use MSB.
	  (bary_divmod): Ditto.
	  (bigdivrem): Ditto.

Sat Jun 22 23:45:22 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_swap): New function.
	  (bary_pack): Use bary_swap.
	  (bary_unpack_internal): Ditto.

Sat Jun 22 23:18:39 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bytes_2comp): Renamed from quad_buf_complement.
	  (bary_pack): Use bytes_2comp.
	  (rb_quad_pack): Use rb_integer_pack.
	  (rb_quad_unpack): Use rb_integer_unpack.

Sat Jun 22 21:46:18 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_unpack): Don't allocate a Bignum if possible.

Sat Jun 22 21:03:58 2013  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_unpack): Remove specialized unpackers for integers.

Sat Jun 22 20:36:50 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_unpack_internal): Specialized unpacker implemented.
	  (bary_unpack): Support INTEGER_PACK_FORCE_GENERIC_IMPLEMENTATION.
	  (rb_integer_unpack): Support INTEGER_PACK_FORCE_GENERIC_IMPLEMENTATION.

Sat Jun 22 18:53:10 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_pack): Support
	  INTEGER_PACK_FORCE_GENERIC_IMPLEMENTATION flag.
	  Fix byte order and word order handling in code specialized for
	  wordsize % SIZEOF_BDIGITS == 0.

	* internal.h (INTEGER_PACK_FORCE_GENERIC_IMPLEMENTATION): Defined.

Sat Jun 22 15:41:25 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rgengc_check_shady): add new WB miss checking
	  on RGENGC_CHECK_MODE >= 2.

	    (1) Save bitmaps before marking
	    (2) Run full marking
	    (3) On each traceable object,
	      (a) object        was not oldgen (== newly or shady object) &&
	      (b) parent object was     oldgen &&
	      (c) parent object was not remembered &&
	      (d) object        was not remembered
	      then, it should be WB miss.

	  This idea of this checker is by Masaya Tarui <tarui@ruby-lang.org>.

Sat Jun 22 15:25:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* ext/etc/etc.c (setup_passwd): revert r41560, unnecessary

Sat Jun 22 14:39:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* ext/etc/etc.c (Init_etc): omit 'passwd' from definition of Etc::Passwd
	  if HAVE_STRUCT_PASSWD_PW_PASSWD is not defined to prevent mismatch of
	  fields and values in setup_passwd

Sat Jun 22 14:35:40 2013  Tanaka Akira  <akr@fsij.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): Use rb_big_pack instead of
	  rb_big2ulong_pack and rb_big2ull.

	* include/ruby/intern.h (rb_big2ulong_pack): Deprecated.

Sat Jun 22 14:31:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* ext/etc/etc.c (setup_passwd): pass 0 as VALUE to rb_struct_new to
	  prevent segfault if the compiler passes it as a 32 bit integer on
	  a 64 bit ruby

Sat Jun 22 13:47:13 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_pack): MEMZERO can be used even if nails is not zero.

Sat Jun 22 13:43:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* ext/etc/etc.c (etc_getpwnam): use PRIsVALUE in format string instead
	  of %s and RSTRING_PTR

	* ext/etc/etc.c (etc_getgrnam): ditto

Sat Jun 22 13:07:15 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (CLEAR_LOWBITS): Rewritten without RSHIFTX.
	  (RSHIFTX): Removed.

Sat Jun 22 10:38:03 2013  Tanaka Akira  <akr@fsij.org>

	* pack.c (num2i32): Removed.
	  (pack_pack): Don't use num2i32.

Sat Jun 22 09:55:13 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (LSHIFTX): Defined to suppress a warning.
	  (RSHIFTX): Ditto.
	  (CLEAR_LOWBITS): Use LSHIFTX and RSHIFTX.
	  (FILL_LOWBITS): Use LSHIFTX.
	  Reported by ko1 via IRC.

Sat Jun 22 09:11:33 2013  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*: Imported minitest 4.7.5 (r8724)
	* test/minitest/*: ditto

Sat Jun 22 07:20:30 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_prof_set_heap_info, after_gc_sweep): call
	  gc_prof_set_heap_info() just after sweeping to calculate
	  live object number correctly.
	  (live object number = total generated number (before marking) -
	                        total freed number (after sweeping))

	* gc.c (gc_marks): record `oldgen_object_count' into current profile`
	  record directly.

	* gc.c (rgengc_rememberset_mark): same for remembered_normal_objects
	  and remembered_shady_objects.

Sat Jun 22 06:46:04 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_objspace::profile): rename rb_objspace::profile::record to
	  records (because it points a set of records) and add a field
	  rb_objspace::profile::current_record to point a current profiling
	  record.

	* gc.c: use above fields.

Sat Jun 22 06:05:36 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_gc_giveup_promoted_writebarrier): remove `rest_sweep()'
	  because all of remembered objects are called for gc_mark_children().

Sat Jun 22 05:08:03 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rgengc_rememberset_mark): call gc_mark_children() for
	  remembered objects directly instead of pushing on the mark stack.

Sat Jun 22 04:48:53 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h (OBJ_WRITE): cast to (VALUE *) for second
	  parameter `slot'. You don't need to write a cast (VALUE *) any more.

	* class.c, compile.c, hash.c, iseq.c, proc.c, re.c, variable.c,
	  vm.c, vm_method.c: remove cast expressions for OBJ_WRITE().

Sat Jun 22 04:37:08 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (slot_sweep_body): rename to slot_sweep().
	  No need to separate major/minor GC.

	* gc.c (gc_setup_mark_bits): remove gc_clear_mark_bits() and unify to
	  this function.

Sat Jun 22 04:20:21 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (check_bitmap_consistency): add to check flag and bitmap consistency.
	  Use this function in several places.

Sat Jun 22 02:18:07 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_pack): Specialized packers implemented.
	  (HOST_BIGENDIAN_P): New macro.
	  (ALIGNOF): New macro.
	  (CLEAR_LOWBITS): New macro.
	  (FILL_LOWBITS): New macro.
	  (swap_bdigit): New macro.
	  (bary_2comp): Returns an int.

	* internal.h (swap16): Moved from pack.c
	  (swap32): Ditto.
	  (swap64): Ditto.

Fri Jun 21 21:29:49 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (typedef enum): Introduce flags of major gc reason.
	* gc.c (garbage_collect_body): Ditto.
	* gc.c (gc_profile_flags): Ditto.
	* gc.c (gc_profile_dump_on): Ditto.

Fri Jun 21 21:11:53 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (allocate_sorted_heaps): remove unused variable `add'.

Fri Jun 21 20:50:32 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: constify RArray::as::ary and RArray::heap::ptr.
	  Use RARRAY_ASET() or RARRAY_PTR_USE() to modify Array objects.

	* array.c, gc.c: catch up above changes.

Fri Jun 21 20:32:13 2013  Koichi Sasada  <ko1@atdot.net>

	* vm_eval.c (eval_string_with_cref): fix WB miss.

Fri Jun 21 20:15:49 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: support write barrier protection for T_STRUCT.
	  Introduce the following C APIs:
	    * RSTRUCT_RAWPTR(st) returns pointer (do WB on your risk).
	      The type of returned pointer is (const VALUE *).
	    * RSTRUCT_GET(st, idx) returns idx-th value of struct.
	    * RSTRUCT_SET(st, idx, v) set idx-th value by v with WB.
	  And
	    * RSTRUCT_PTR(st) returns pointer with shady operation.
	      The type of returned pointer is (VALUE *).

	* struct.c, re.c, gc.c, marshal.c: rewrite with above APIs.

Fri Jun 21 19:38:37 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (BDIGMAX): Use BIGRAD.
	  (BIGLO): Use BDIGMAX.
	  (bigdivrem1): Ditto.
	  (bigor_int): Ditto.
	  (rb_big_or): Ditto.

Fri Jun 21 19:18:48 2013  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_pack): Move the implementation for 'c' directive after
	  pack_integer label.

Fri Jun 21 19:11:56 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h, re.c: support write barrier for T_REGEXP.

	   Note: T_MATCH object is also easy to support write barriers.
	         However, most of T_MATCH objects are short-lived objects.
	         So I skipped to support non-shady T_MATCH.

Fri Jun 21 18:56:58 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigsub_int): Use bdigit_roomof.
	  (bigadd_int): Ditto.
	  (bigand_int): Ditto.
	  (bigor_int): Ditto.
	  (bigxor_int): Ditto.

Fri Jun 21 17:56:25 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/gc/gcbench.rb: fix summary of benchmark result notation.

Fri Jun 21 16:38:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* ext/openssl/ossl_x509attr.c: change OSSL_X509ATTR_IS_SINGLE and
	  OSSL_X509ATTR_SET_SINGLE macros to use ->value.set rather than
	  ->set to fix compile failure

Fri Jun 21 15:26:45 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_sweep): profile sweep time correctly when LAZY_SWEEP is
	  disabled.

	* gc.c (gc_marks_test): store oldgen count and shady count
	  before test marking and restore them after marking.

Fri Jun 21 15:07:42 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: enable lazy sweep (commit miss).

Fri Jun 21 14:31:29 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (ruby_setenv): refine error message so include the variable
	  name.

Fri Jun 21 14:15:08 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: fix to use total_allocated_object_num and heaps_used
	  at the GC time for profiler.

Fri Jun 21 12:35:35 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: RGENGC_CHECK_MODE should be 0.

Fri Jun 21 11:18:25 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_marks_body): fix to get `th' in this function.

Fri Jun 21 10:21:44 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (heaps_header/heaps_slot): embed bitmaps into heaps_slot.
	  no need to maintain allocation/free bitmaps.

Fri Jun 21 09:22:16 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (slot_sweep_body): add counters at a time.

	* gc.c (gc_profile_dump_on): fix line break position.

Fri Jun 21 08:14:00 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c: refactoring bitmaps. introduce bits_t type and some Consts.

Fri Jun 21 08:04:32 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: fix to support USE_RGENGC == 0 (disable RGenGC).
	  If USE_RGENGC==0, it caused compilation error.

Fri Jun 21 08:08:11 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (lazy_sweep): Use is_lazy_sweeping()
	* gc.c (rest_sweep): Ditto.
	* gc.c (gc_prepare_free_objects): Ditto.

Fri Jun 21 07:34:47 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_profile_record::oldgen_objects): added.

	* gc.c (gc_profile_dump_on): print the following information:
	  * Living object counts
	  * Free object counts
	  If RGENGC_PROFILE > 0 then
	  * Oldgen object counts
	  * Remembered normal object counts
	  * Remembered shady object counts

Fri Jun 21 06:43:59 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_ull2big): Refactored.
	  (rb_uint2big): Useless code removed.

Fri Jun 21 05:37:39 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_prof_sweep_timer_stop): accumulate sweep time only when
	  record->gc_time > 0.

Fri Jun 21 00:37:31 2013  Tanaka Akira  <akr@fsij.org>

	* ext/bigdecimal: Workaround fix for bigdecimal test failures caused
	  by [ruby-dev:47413] [Feature #8509]

	* ext/bigdecimal/bigdecimal.h (BDIGIT): Make it independent from the
	  definition for bignum.c.
	  (SIZEOF_BDIGITS): Ditto.
	  (BDIGIT_DBL): Ditto.
	  (BDIGIT_DBL_SIGNED): Ditto.
	  (PRI_BDIGIT_PREFIX): Undefine the definition.
	  (PRI_BDIGIT_DBL_PREFIX): Ditto.

	* ext/bigdecimal/bigdecimal.c (RBIGNUM_ZERO_P): Use rb_bigzero_p.
	  (bigzero_p): Removed.
	  (is_even): Use rb_big_pack.

Thu Jun 20 22:52:42 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigmul1_toom3): Don't call bignorm twice.

Thu Jun 20 22:49:27 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bignorm): Don't call bigtrunc if the result is a fixnum.

Thu Jun 20 22:29:42 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_uint2big): Refactored.

Thu Jun 20 22:24:41 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (dump_bignum): Use SIZEOF_BDIGITS.

Thu Jun 20 22:22:46 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big2ulong): Change the return type to unsigned long.
	  (rb_big2ulong_pack): Follow the above change.
	  (rb_big2long): Ditto.
	  (rb_big_lshift): Ditto.
	  (rb_big_rshift): Ditto.
	  (rb_big_aref): Ditto.

Thu Jun 20 22:02:46 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_unpack_internal): Return -2 when negative overflow.
	  (bary_unpack): Set the overflowed bit if an extra BDIGIT exists.
	  (rb_integer_unpack): Set the overflowed bit.

Thu Jun 20 21:17:19 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rgengc_rememberset_mark): record
	  (1) normal objects count in remember set
	  (2) shady objects count in remember set
	  each GC timing.

	* gc.c (gc_profile_record_get): enable to access above information
	  and REMOVING_OBJECTS, EMPTY_OBJECTS.

Thu Jun 20 18:29:26 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/gc/gcbench.rb: Do not use GC::Profiler::disable because
	  GC::Profiler::disable prohibit to access profiling data. It should
	  be spec bug.

	  Skip GC::Profiler::report if RUBY_VERSION < '2.0.0'

Thu Jun 20 17:59:08 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/gc/gcbench.rb: stop GC::Profiler before output results.
	  Generating GC::Profiler result under profiling causes infinite loop.

Thu Jun 20 17:24:24 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/gc/gcbench.rb: don't use __dir__ to make compatible
	  with ruby 1.9.3.

Thu Jun 20 16:57:19 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_app_aobench.rb: use attr_accessor/reader instead of
	  defining methods.

Thu Jun 20 16:46:46 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_app_aobench.rb: added.

	* benchmark/gc/aobench.rb: added.

Thu Jun 20 16:28:33 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/bm_so_binary_trees.rb: disable `puts' method
	  and change iteration parameter to increase execution time.

	* benchmark/gc/binarytree.rb: added.

Thu Jun 20 16:06:37 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/gc/pentomino.rb: added.
	  Simply load pentomino puzzle in the benchmark/ directory.

Thu Jun 20 15:32:56 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/gc/redblack.rb: import red black tree benchmark from
	  https://github.com/jruby/rubybench/blob/master/time/bench_red_black.rb

	* benchmark/gc/ring.rb: add a benchmark. This benchmark create many
	  old objects.

Thu Jun 20 15:14:00 2013  Koichi Sasada  <ko1@atdot.net>

	* benchmark/gc: create a directory to store GC related benchmark.

	* benchmark/gc/gcbench.rb: moved from tool/gcbench.rb.

	* benchmark/gc/hash(1|2).rb: ditto.

	* benchmark/gc/rdoc.rb: ditto.

	* benchmark/gc/null.rb: added.

	* common.mk: fix rule.

Thu Jun 20 14:09:54 2013  Koichi Sasada  <ko1@atdot.net>

	* tool/hashbench1.rb: fix parameter too. Increase temporary objects.

Thu Jun 20 14:01:35 2013  Koichi Sasada  <ko1@atdot.net>

	* tool/hashbench1.rb: fix parameters.

Thu Jun 20 14:00:34 2013  Koichi Sasada  <ko1@atdot.net>

	* common.mk: remove dependency from ruby.

Thu Jun 20 13:14:06 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_backtrace): evaluate RARRAY_AREF only once.
	  the first argument of RB_TYPE_P is expanded twice for non-immediate
	  types.

Thu Jun 20 08:09:29 2013  Koichi Sasada  <ko1@atdot.net>

	* tool/gcbench.rb: Summary in one line.

	* common.mk: separate gcbench-hash to gcbench-hash1 and gcbench-hash2.

Thu Jun 20 08:07:23 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (BIGSIZE): New macro.
	  (bigfixize): Use BIGSIZE.
	  (big2ulong): Ditto.
	  (check_shiftdown): Ditto.
	  (rb_big_aref): Ditto.

Thu Jun 20 07:46:48 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (rb_gc_writebarrier): give up rescan A and register B directly
	  if A has huge number of children.

Thu Jun 20 07:30:35 2013  Koichi Sasada  <ko1@atdot.net>

	* common.mk: add new rules `gcbench-rdoc', `gcbench-hash'.

	* tool/gcbench.rb: separate GC bench framework and process.

	* tool/hashbench1.rb, tool/hashbench2.rb: add two types GC bench.
	  hashbench1: many temporal objects (GC by newobj)
	  hashbench2: hash size becomes bigger and bigger (GC by malloc)
	  Two benches are executed by `gcbench-hash' rule.

	* tool/rdocbench.rb: separated.

Thu Jun 20 06:25:39 2013  Koichi Sasada  <ko1@atdot.net>

	* tool/rdocbench.rb: add summary.

Thu Jun 20 06:18:01 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_profile_total_time): check objspace->profile.next_index > 0.

Thu Jun 20 05:47:41 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_prof_sweep_timer_start): fix merge miss.

	* gc.c (GC_PROFILE_MORE_DETAIL): set it 0.

Thu Jun 20 05:38:56 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: Accumulate sweep time to GC time.
	  Now [GC time] is [mark time] + [sweep time] + [misc].
	  ([GC time] >= [mark time] + [sweep time])

	* gc.c (gc_prof_sweep_slot_timer_start/stop): rename to
	  gc_prof_sweep_timer_start/stop and locate at lazy_sweep().

	* gc.c (elapsed_time_from): add a utility function.

Thu Jun 20 05:08:53 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_marks): fix wrong option. FALSE means major/full GC.
	  It should be TRUE (minor marking).

Thu Jun 20 02:44:45 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (waitpid): should not return 0 but wait until exit
	  unless WNOHANG is given.  waiting huge process may return while
	  active, for some reason.

Thu Jun 20 01:34:15 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bdigit_roomof): Use SIZEOF_BDIGITS.
	  (bigfixize): Refine an ifdef condition.
	  (rb_absint_size): Use bdigit_roomof.
	  (rb_absint_singlebit_p): Ditto.
	  (rb_integer_pack): Ditto.
	  (integer_pack_fill_dd): Use BITSPERDIG.
	  (integer_unpack_push_bits): Use BITSPERDIG, BIGLO and BIGDN.

Thu Jun 20 01:07:39 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (MARKED_IN_BITMAP, FL_TEST2): return boolean value since always
	  used as boolean value.

	* gc.c (MARK_IN_BITMAP, CLEAR_IN_BITMAP): evaluate bits once.

Thu Jun 20 00:05:07 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (RVALUE_PROMOTED): fix type.

Wed Jun 19 23:39:01 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_marks_test): rewrite checking code.
	  When RGENGC_CHECK_MODE >= 2, all minor marking, run normal minor
	  marking *and* major/full marking. After that, compare the results
	  and shows BUG if a object living with major/full marking but dead
	  with minor marking.
	  After detecting bugs, print references information.
	  (RGENGC_CHECK_MODE == 2, show references to dead object)
	  (RGENGC_CHECK_MODE == 3, show all references)

Wed Jun 19 23:51:48 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigfixize): Use rb_absint_size.
	  (check_shiftdown): Ditto.
	  (big2ulong): Use bdigit_roomof.

Wed Jun 19 23:32:23 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (RVALUE_PROMOTED): check consistency between oldgen flag and
	  oldgen bitmap if RGENGC_CHECK_MODE > 0.

Wed Jun 19 23:29:29 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_gc_force_recycle): clear oldgen bitmap, too.

Wed Jun 19 21:02:13 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_uint2big): Consider environments BDIGIT is bigger than
	  long.
	  (big2ulong): Ditto.
	  (rb_big_aref): Ditto.
	  (rb_big_pack): Just call rb_integer_pack.
	  (rb_big_unpack): Just call rb_integer_unpack.

Wed Jun 19 20:51:21 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* gc.c (gc_stress_get): GC.stress can be Fixnum.

Wed Jun 19 19:31:30 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (DIGSPERLONG): Don't define if BDIGIT is bigger than long.
	  (DIGSPERLL): Don't define if BDIGIT is bigger than LONG_LONG
	  (rb_absint_size): Consider environments BDIGIT is bigger than long.
	  Use BIGLO and BIGDN.
	  (rb_absint_singlebit_p): Ditto.
	  (rb_integer_pack): Ditto.
	  (bigsub_int): Consider environments BDIGIT is bigger than long.
	  Use SIZEOF_BDIGITS instead of sizeof(BDIGIT).
	  (bigadd_int): Ditto.
	  (bigand_int): Ditto.
	  (bigor_int): Ditto.
	  (bigxor_int): Ditto.

Wed Jun 19 15:14:30 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h (struct rb_data_type_struct), gc.c: add
	  rb_data_type_struct::flags. Now, this flags is passed
	  at T_DATA object creation. You can specify FL_WB_PROTECTED
	  on this flag.

	* iseq.c: making non-shady iseq objects.

	* class.c, compile.c, proc.c, vm.c: add WB for iseq objects.

	* vm_core.h, iseq.h: constify fields to detect WB insertion.

Wed Jun 19 15:11:13 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (gc_mark_children): show more info for broken object.

Wed Jun 19 14:04:41 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/envutil.rb (EnvUtil#rubybin): remove unnecessary
	  unless expression.

Wed Jun 19 07:47:48 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (garbage_collect_body): use FIX2INT for ruby_gc_stress.

Wed Jun 19 07:44:31 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_objspace::gc_stress): int -> VALUE to store Fixnum object.

Wed Jun 19 07:25:35 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (make_deferred): clear flags to T_ZOMBIE.

	* gc.c (slot_sweep_body): fix indent.

Wed Jun 19 07:18:47 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big_aref): Apply BIGLO to ~xds[i] for environment which
	  BDIGIT is 16bit.

Wed Jun 19 07:09:26 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rgengc_remember): fix output level.

	* gc.c (rgengc_rememberset_mark): fix to output clear count.
	  (shady_object_count + clear_count = count of remembered objects)

Wed Jun 19 07:06:21 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rgengc_remember): check T_NONE and T_ZOMBIE
	  if RGENGC_CHECK_MODE > 0.

Wed Jun 19 07:02:19 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (RGENGC_CHECK_MODE): add new check mode `3'.
	  In this mode, show all references if there is
	  a miss-corrected object.

Wed Jun 19 06:31:08 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_stress_set): add special option of GC.stress.
	  `GC.stress=(flag)' accepts integer to control behavior of GC.
	  See code for details. Of course, this feature is only for MRI.

	  You can debug RGenGC (WB) using `GC.stress = 1'.
	  Using this option, do minor marking at all possible places.

	  GC::STRESS_MINOR_MARK = 1 and GC::STRESS_LAZY_SWEEP = 2
	  seem good to add.

Wed Jun 19 06:29:31 2013  Koichi Sasada  <ko1@atdot.net>

	* vm.c (kwmerge_i): add WB.

Wed Jun 19 06:26:49 2013  Koichi Sasada  <ko1@atdot.net>

	* hash.c: `st_update()' also has same issue of last fix.
	  write barriers at callback function are too early.
	  All write barriers are executed after `st_update()'

Wed Jun 19 04:33:22 2013  Koichi Sasada  <ko1@atdot.net>

	* variable.c (rb_const_set): fix WB miss.

	  WBs had located before creating reference between a klass
	  and constant value. It causes GC bug.

	    # pseudo code:
	    WB(klass, value); # WB and remember klass
	    st_insert(klass->const_table, const_id, value);

	  `st_insert()' can cause GC before inserting `value' and
	  forget `klass' from the remember set. After that, relationship
	  between `klass' and `value' are created with constant table.
	  Now, `value' can be young (shady) object and `klass' can be old
	  object, without remembering `klass' object.
	  At the next GC, old `klass' object will be skipped and
	  young (shady) `value' will be miss-collected. -> GC bug

	  Lesson: The place of a WB is important.

Tue Jun 18 22:01:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): ensure methods of type
	  VM_METHOD_TYPE_ATTR_SET are called with 1 argument

	* test/ruby/test_module.rb
	  (TestModule#test_attr_writer_with_no_arguments): add test
	  [ruby-core:55543] [Bug #8540]

Tue Jun 18 22:36:23 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (gc_profile_record_flag): fix typo.

Tue Jun 18 22:08:53 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/objspace/object_tracing.c: Return for ::allocation_generation

Tue Jun 18 22:04:35 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/objspace/object_tracing.c: Document object_tracing methods.

Tue Jun 18 21:58:17 2013  Zachary Scott  <zachary@zacharyscott.net>

	* gc.c: Rename rb_mObSpace -> rb_mObjSpace

Tue Jun 18 20:55:05 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/objspace/objspace.c: Document ObjectSpace::InternalObjectWrapper.

Tue Jun 18 20:39:04 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/objspace/object_tracing.c: Teach rdoc object_tracing.c [Bug #8537]

Tue Jun 18 20:29:47 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/.document: add object_tracing.c to document file

Tue Jun 18 20:20:27 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/objspace/objspace.c: rdoc on require to overview from r41355

Tue Jun 18 18:39:58 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Check __int128.

	* include/ruby/defines.h (BDIGIT_DBL): Use uint128_t if it is available.
	  (BDIGIT): Use uint64_t if uint128_t is available.
	  (SIZEOF_BDIGITS): Defined for above case.
	  (BDIGIT_DBL_SIGNED): Ditto.
	  (PRI_BDIGIT_PREFIX): Ditto.

	* include/ruby/ruby.h (PRI_64_PREFIX): Defined.

	* bignum.c (rb_big_pow): Don't use BITSPERDIG for the condition which
	  rb_big_pow returns Float or Bignum.

	[ruby-dev:47413] [Feature #8509]

Tue Jun 18 16:43:44 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_heredoc_restore): clear lex_strterm always to get
	  rid of marking recycled node.  this bug is revealed by r41372 with
	  GC.stress=true.

Tue Jun 18 12:53:25 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (nlz): Cast the result explicitly.
	  (big2dbl): Don't assign BDIGIT values to int variable.

Tue Jun 18 12:25:16 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big_xor): Non-effective code removed.

Tue Jun 18 11:26:05 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_stat): add `generated_normal_object_count_types' for
	  RGENGC_PROFILE >= 2.

Tue Jun 18 11:02:18 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_mark_maybe): check to skip T_NONE.

	* gc.c (markable_object_p): do not need to check (flags == 0) here.

Tue Jun 18 10:17:37 2013  Koichi Sasada  <ko1@atdot.net>

	* variable.c (rb_autoload): fix WB miss.

Tue Jun 18 04:20:18 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_mark_children): don't need to care about T_ZOMBIE here.

Mon Jun 17 22:16:02 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* test/ruby/test_proc.rb (TestProc#test_block_given_method_to_proc):
	  run test for r41359.

Mon Jun 17 21:42:18 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* include/ruby/ruby.h, vm_eval.c (rb_funcall_with_block):
	  new function to invoke a method with a block passed
	  as an argument.

	* string.c (sym_call): use the above function to avoid
	  a block sharing. [ruby-dev:47438] [Bug #8531]

	* vm_insnhelper.c (vm_yield_with_cfunc): don't set block
	  in the frame.

	* test/ruby/test_symbol.rb (TestSymbol#test_block_given_to_proc):
	  run related tests.

Mon Jun 17 21:33:27 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* include/ruby/intern.h, proc.c (rb_method_call_with_block):
	  new function to invoke a Method object with a block passed
	  as an argument.

	* proc.c (bmcall): use the above function to avoid a block sharing.
	  [ruby-core:54626] [Bug #8341]

	* test/ruby/test_proc.rb (TestProc#test_block_persist_between_calls):
	  run related tests.

Mon Jun 17 20:53:21 2013  Tanaka Akira  <akr@fsij.org>

	* loadpath.c (RUBY_REVISION): Defined to suppress revision.h
	  inclusion actually.  r41352 removes the dependency.

Mon Jun 17 18:15:57 2013  Benoit Daloze  <eregontp@gmail.com>

	* ext/objspace/objspace.c: let rdoc know about objspace methods.
	  Specify 'objspace' should be required. See #8537.

Mon Jun 17 17:44:31 2013  Benoit Daloze  <eregontp@gmail.com>

	* gc.c (ObjectSpace): is a module not a class.

	* ext/objspace/objspace.c: try to include overview in rdoc,
	  see #8537.

Mon Jun 17 17:38:24 2013  Benoit Daloze  <eregontp@gmail.com>

	* gc.c: fix example of ObjectSpace.define_finalizer in overview

Mon Jun 17 16:59:53 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/tkutil/tkutil.c: use rb_sprintf(), rb_id2str(), and
	  rb_intern_str() instead of rb_intern() and RSTRING_PTR() with
	  RB_GC_GUARD(), to prevent temporary objects from GC.
	  [ruby-core:39000] [Bug #5199]

Mon Jun 17 14:27:54 2013  Zachary Scott  <zachary@zacharyscott.net>

	* vm_backtrace.c: Update rdoc for Backtrace#label with @_ko1

Mon Jun 17 13:04:01 2013  Akinori MUSHA  <knu@iDaemons.org>

	* tool/ifchange (until): Fix the condition, although harmless in
	  this case.

Mon Jun 17 11:50:29 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_mark_maybe): added. check `is_pointer_to_heap()' and
	  type is not T_ZOMBIE.

	* gc.c: use `gc_mark_maybe()'. T_ZOMBIE objects should not be pushed
	  to the mark stack.

Mon Jun 17 07:56:24 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_small_lshift): Renamed from bdigs_small_lshift.
	  (bary_small_rshift): Renamed from bdigs_small_rshift.

Mon Jun 17 07:38:48 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (absint_numwords_bytes): Removed.
	  (rb_absint_numwords): Don't call absint_numwords_bytes.

Sun Jun 16 23:14:58 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (BARY_ADD): New macro.
	  (BARY_SUB): Ditto.
	  (BARY_MUL): Ditto.
	  (BARY_DIVMOD): Ditto.
	  (BARY_ZERO_P): Ditto.
	  (absint_numwords_generic): Use these macros.

Sun Jun 16 21:41:39 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_2comp): Extracted from get2comp.
	  (integer_unpack_num_bdigits): Extracted from
	  rb_integer_unpack_internal.
	  (bary_unpack_internal): Renamed from bary_unpack and support
	  INTEGER_PACK_2COMP.
	  (bary_unpack): New function to validate arguments and invoke
	  bary_unpack_internal.
	  (rb_integer_unpack_internal): Removed.
	  (rb_integer_unpack): Invoke bary_unpack_internal.
	  (rb_integer_unpack_2comp): Removed.

	* internal.h (rb_integer_unpack_2comp): Removed.

	* pack.c: Follow the above change.

Sun Jun 16 18:41:42 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (INTEGER_PACK_2COMP): Defined.
	  (rb_integer_pack_2comp): Removed.

	* bignum.c (bary_pack): Support INTEGER_PACK_2COMP.
	  (rb_integer_pack): Invoke bary_pack directly.
	  (rb_integer_pack_2comp): Removed.
	  (rb_integer_pack_internal): Ditto.
	  (absint_numwords_generic): Follow the above change.

	* pack.c (pack_pack): Ditto.

	* sprintf.c (rb_str_format): Ditto.

Sun Jun 16 17:48:14 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (absint_numwords_generic): rb_funcall invocations removed.

Sun Jun 16 16:04:38 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/config_files.rb: use URI.read to allow it runs with Ruby 1.8.5.

Sun Jun 16 14:32:25 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_pack) Extracted from rb_integer_pack_internal.
	  (absint_numwords_generic): Use bary_pack.

Sun Jun 16 11:01:57 2013  Kouhei Sutou  <kou@cozmixng.org>

	* NEWS (XMLRPC::Client#http): Add.
	  [ruby-core:55197] [Feature #8461]

Sun Jun 16 10:38:45 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_add): New function.
	  (bary_zero_p): Extracted from bigzero_p.
	  (absint_numwords_generic): Use bary_zero_p and bary_add.
	  (bary_mul): Fix an argument for bary_mul_single.
	  (bary_divmod): Use size_t for arguments.

Sun Jun 16 08:55:22 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigdivrem): Use a BDIGIT variable to store the return
	  value of bigdivrem_single.

Sun Jun 16 08:43:59 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_divmod): New function.
	  (absint_numwords_generic): Use bary_divmod.
	  (bigdivrem_num_extra_words): Extracted from bigdivrem.
	  (bigdivrem_single): Ditto.
	  (bigdivrem_normal): Ditto.
	  (BIGDIVREM_EXTRA_WORDS): Defined.

Sun Jun 16 05:51:51 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c: Fixup around GC by MALLOC.
	  Add allocate size to malloc_increase before GC
	  for updating limit in after_gc_sweep.
	  Reset malloc_increase into garbage_collect()
	  for preventing GC again soon.

Sun Jun 16 05:15:36 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c: Add some columns to more detail profile.
	  new columns: Allocated size, Prepare Time, Removing Objects, Empty Objects

Sun Jun 16 02:04:40 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (gc_prof_timer_stop): Merge function codes of GC_PROFILE_MORE_DETAIL and !GC_PROFILE_MORE_DETAIL.
	* gc.c (gc_prof_mark_timer_start): Ditto.
	* gc.c (gc_prof_mark_timer_stop): Ditto.
	* gc.c (gc_prof_sweep_slot_timer_start): Ditto.
	* gc.c (gc_prof_sweep_slot_timer_stop): Ditto.
	* gc.c (gc_prof_set_malloc_info): Ditto.
	* gc.c (gc_prof_set_heap_info): Ditto.

Sat Jun 15 23:50:24 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_sub): New function.
	  (absint_numwords_generic): Use bary_sub.
	  (bigsub_core): Skip unnecessary copy.

Sat Jun 15 22:05:30 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_mul): New function.
	  (absint_numwords_generic): Use bary_mul.
	  (bary_mul_single): Extracted from bigmul1_single.
	  (bary_mul_normal): Extracted from bigmul1_normal.

Sat Jun 15 20:13:46 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bary_unpack): Extracted from rb_integer_unpack_internal.
	  (absint_numwords_generic): Use bary_unpack.
	  (roomof): Defined.
	  (bdigit_roomof): Defined.
	  (BARY_ARGS): Defined.
	  (bary_unpack): Declared.

Sat Jun 15 19:35:04 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (absint_numwords_bytes): Make it static.
	  (absint_numwords_small): Ditto.
	  (absint_numwords_generic): Ditto.

Sat Jun 15 17:14:32 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigmul1_normal): Shrink the result Bignum length.

Sat Jun 15 10:19:42 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/bigdecimal/bigdecimal.c: Update overview formatting of headers

Sat Jun 15 10:19:06 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/bigdecimal/bigdecimal.gemspec: Update authors

Sat Jun 15 10:02:26 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bdigs_small_rshift): Extracted from big_rshift.
	  (bigdivrem): Use bdigs_small_rshift.

Sat Jun 15 08:37:28 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (eval_string_with_cref): propagate absolute path from the
	  binding if it is given explicitly.  patch by Gat (Dawid Janczak) at
	  [ruby-core:55123]. [Bug #8436]

Sat Jun 15 02:40:18 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bdigs_small_lshift): Extracted from big_lshift.
	  (bigdivrem): Use bdigs_small_lshift.

Fri Jun 14 20:47:41 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigdivrem): Reduce number of digits before bignew() for div.

Fri Jun 14 20:12:37 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigdivrem): Use bignew when ny == 1.

Fri Jun 14 18:52:51 2013  Koichi Sasada  <ko1@atdot.net>

	* compile.c (rb_iseq_compile_node): fix location of a `trace'
	  instruction (b_return event).
	  [ruby-core:55305] [ruby-trunk - Bug #8489]
	  (need a backport to 2.0.0?)

	* test/ruby/test_settracefunc.rb: add a test.

Fri Jun 14 18:18:07 2013  Koichi Sasada  <ko1@atdot.net>

	* class.c, include/ruby/ruby.h: add write barriers for T_CLASS,
	  T_MODULE, T_ICLASS.

	* constant.h: constify rb_const_entry_t::value and file to detect
	  assignment.

	* variable.c, internal.h (rb_st_insert_id_and_value, rb_st_copy):
	  added. update table with write barrier.

	* method.h: constify some variables to detect assignment.

	* object.c (init_copy): add WBs.

	* variable.c: ditto.

	* vm_method.c (rb_add_method): ditto.

Fri Jun 14 14:33:47 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* NEWS: add a note for Module#using.

Fri Jun 14 13:40:27 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .travis.yml (before_script): update config files.

	* common.mk ($(srcdir)/tool/config.{guess,sub}): use get-config_files.

	* tool/config_files.rb: split get-config_files.

	* common.mk (update-config_files): rule to download config files.

	* tool/config.guess, tool/config.sub: remove and download from the
	  upstream.

	* tool/config_files.rb: download config files from GNU.

Fri Jun 14 12:21:20 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RUBY_SAFE_LEVEL_CHECK): suppress warnings
	  "left-hand operand of comma expression has no effect", on gcc 4.4.

Fri Jun 14 09:48:48 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* NEWS: add notes for $SAFE.

	* doc/security.rdoc: remove the description of $SAFE=4.

Fri Jun 14 00:14:29 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigdivrem): Zero test condition simplified.

Thu Jun 13 23:43:11 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/bigdecimal/*: improve documentation, nodoc samples with @mrkn

Thu Jun 13 23:02:14 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client#http): Add reader for raw
	  Net::HTTP. [ruby-core:55197] [Feature #8461]
	  Reported by Herwin Weststrate. Thanks!!!

Thu Jun 13 22:44:52 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client#parse_set_cookies): Support
	  multiple names in a response. [ruby-core:41711] [Bug #5774]
	  Reported by Roman Riha. Thanks!!!
	* test/xmlrpc/test_client.rb (XMLRPC::ClientTest#test_cookie_override):
	  Add a test of the above case.

Thu Jun 13 22:35:50 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client#parse_set_cookies): Use
	  guard style.

Thu Jun 13 22:12:32 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils#rmdir): fix traversal loop, not trying
	  remove same directory only.

Thu Jun 13 21:30:14 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (opt-dir), tool/ifchange: get rid of "alternate value"
	  expansion for legacy sh.  [ruby-dev:47420] [Bug #8524]

Thu Jun 13 21:24:09 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigdivrem): Refactored to use ALLOCV_N for temporary
	  buffers.

Thu Jun 13 18:54:11 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (integer_unpack_num_bdigits_generic): reorder terms (but not
	  changed the intention of the expression) because VC++ reports a
	  warning for it.  reported by ko1 via IRC.

Thu Jun 13 18:53:14 2013  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_thread.rb (test_thread_local_security): Don't create
	  an unused thread.

Thu Jun 13 18:34:20 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bigdivrem): Use nlz.

Thu Jun 13 14:51:06 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (RUBY_SAFE_LEVEL_CHECK): check constant safe
	  level at compile time.

Thu Jun 13 14:39:08 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* test/-ext-/test_printf.rb, test/rss/test_parser.rb,
	  test/ruby/test_array.rb, test/ruby/test_hash.rb,
	  test/ruby/test_m17n.rb, test/ruby/test_marshal.rb,
	  test/ruby/test_object.rb, test/ruby/test_string.rb: don't use
	  untrusted?, untrust, and trust to avoid warnings in case $VERBOSE is
	  true.

Thu Jun 13 10:47:16 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* bootstraptest/test_autoload.rb, bootstraptest/test_method.rb:
	  remove tests for $SAFE=4.

	* lib/pp.rb: use taint instead of untrust to avoid warnings when
	  $VERBOSE is set to true.

Thu Jun 13 06:12:18 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_unpack_num_bdigits_small): Fix a compile error on
	  clang -Werror,-Wshorten-64-to-32
	  Reported by Eric Hodel.  [ruby-core:55467] [Bug #8522]

Thu Jun 13 05:32:13 2013  Eric Hodel  <drbrain@segment7.net>

	* ext/socket/extconf.rb:  Enable RFC 3542 IPV6 socket options for OS X
	  10.7+.  [ruby-trunk - Bug #8517]

Thu Jun 13 00:17:18 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_unpack_2comp): New function.
	  (rb_integer_unpack_internal): Extracted from rb_integer_unpack and
	  nlp_bits_ret argument added.
	  (integer_unpack_num_bdigits_small): nlp_bits_ret argument added to
	  return number of leading padding bits.
	  (integer_unpack_num_bdigits_generic): Ditto.

	* internal.h (rb_integer_unpack_2comp): Declared.

	* pack.c (pack_unpack): Use rb_integer_unpack_2comp and
	  rb_integer_unpack.

Wed Jun 12 23:27:03 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* eval.c (mod_using): new method Module#using, which activates
	  refinements of the specified module only in the current class or
	  module definition.  [ruby-core:55273] [Feature #8481]

	* test/ruby/test_refinement.rb: related test.

Wed Jun 12 22:58:48 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* safe.c (rb_set_safe_level, safe_setter): raise an ArgumentError
	  when $SAFE is set to 4.  $SAFE=4 is now obsolete.
	  [ruby-core:55222] [Feature #8468]

	* object.c (rb_obj_untrusted, rb_obj_untrust, rb_obj_trust):
	  Kernel#untrusted?, untrust, and trust are now deprecated.
	  Their behavior is same as tainted?, taint, and untaint,
	  respectively.

	* include/ruby/ruby.h (OBJ_UNTRUSTED, OBJ_UNTRUST): OBJ_UNTRUSTED()
	  and OBJ_UNTRUST() are aliases of OBJ_TAINTED() and OBJ_TAINT(),
	  respectively.

	* array.c, class.c, debug.c, dir.c, encoding.c, error.c, eval.c,
	  ext/curses/curses.c, ext/dbm/dbm.c, ext/dl/cfunc.c,
	  ext/dl/cptr.c, ext/dl/dl.c, ext/etc/etc.c, ext/fiddle/fiddle.c,
	  ext/fiddle/pointer.c, ext/gdbm/gdbm.c, ext/readline/readline.c,
	  ext/sdbm/init.c, ext/socket/ancdata.c, ext/socket/basicsocket.c,
	  ext/socket/socket.c, ext/socket/udpsocket.c,
	  ext/stringio/stringio.c, ext/syslog/syslog.c, ext/tk/tcltklib.c,
	  ext/win32ole/win32ole.c, file.c, gc.c, hash.c, io.c, iseq.c,
	  load.c, marshal.c, object.c, proc.c, process.c, random.c, re.c,
	  safe.c, string.c, thread.c, transcode.c, variable.c,
	  vm_insnhelper.c, vm_method.c, vm_trace.c: remove code for
	  $SAFE=4.

	* test/dl/test_dl2.rb, test/erb/test_erb.rb,
	  test/readline/test_readline.rb,
	  test/readline/test_readline_history.rb, test/ruby/test_alias.rb,
	  test/ruby/test_array.rb, test/ruby/test_dir.rb,
	  test/ruby/test_encoding.rb, test/ruby/test_env.rb,
	  test/ruby/test_eval.rb, test/ruby/test_exception.rb,
	  test/ruby/test_file_exhaustive.rb, test/ruby/test_hash.rb,
	  test/ruby/test_io.rb, test/ruby/test_method.rb,
	  test/ruby/test_module.rb, test/ruby/test_object.rb,
	  test/ruby/test_pack.rb, test/ruby/test_rand.rb,
	  test/ruby/test_regexp.rb, test/ruby/test_settracefunc.rb,
	  test/ruby/test_struct.rb, test/ruby/test_thread.rb,
	  test/ruby/test_time.rb: remove tests for $SAFE=4.

Wed Jun 12 22:18:23 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_unpack_num_bdigits_generic): Rewritten without
	  rb_funcall.
	  (integer_unpack_num_bdigits_bytes): Removed.
	  (rb_integer_unpack): integer_unpack_num_bdigits_bytes invocation
	  removed.

Wed Jun 12 20:18:03 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/xmlrpc/client.rb (XMLRPC::Client#parse_set_cookies): Extract.

Wed Jun 12 18:19:41 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (validate_integer_pack_format): supported_flags argument
	  added and validate given flags.
	  (rb_integer_pack_internal): Specify supported_flags.
	  (rb_integer_unpack): Ditto.

Wed Jun 12 16:41:38 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sort_bang): remove duplicated assertions.
	  ARY_HEAP_PTR() implies ary not to be embedded.  [ruby-dev:47419]
	  [Bug #8518]

Wed Jun 12 12:44:45 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_getc): fix 7bit coderange condition, check if ascii read
	  data instead of read length. [ruby-core:55444] [Bug #8516]

Wed Jun 12 12:35:13 2013  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_pack): Use rb_integer_pack_2comp.

Wed Jun 12 12:07:04 2013  Tanaka Akira  <akr@fsij.org>

	* sprintf.c (rb_str_format): Fix a dynamic format string.

Wed Jun 12 12:04:09 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_uniq_bang): must not be modified once frozen even in
	  a callback method.

Wed Jun 12 12:03:43 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_sort_bang): must not be modified once frozen even in
	  a callback method.

Wed Jun 12 12:00:15 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (FL_SET_EMBED): shared object is frozen even when get
	  unshared.

	* array.c (rb_ary_modify): ARY_SET_CAPA needs unshared array.

Wed Jun 12 07:32:01 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (rand_int): Use rb_big_uminus.

Wed Jun 12 07:12:54 2013  Eric Hodel  <drbrain@segment7.net>

	* struct.c:  Improve documentation: replace "instance variable" with
	  "member", recommend the use of a block to customize structs, note
	  that member accessors are created, general cleanup.

Wed Jun 12 06:35:01 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (INTEGER_PACK_NEGATIVE): Defined.
	  (rb_integer_unpack): sign argument removed.

	* bignum.c (rb_integer_unpack): sign argument removed.
	  Non-negative integers generated by default.
	  INTEGER_PACK_NEGATIVE flag is used to generate non-positive integers.

	* pack.c (pack_unpack): Follow the above change.

	* random.c (int_pair_to_real_inclusive): Ditto.
	  (make_seed_value): Ditto.
	  (mt_state): Ditto.
	  (limited_big_rand): Ditto.

	* marshal.c (r_object0): Ditto.

Wed Jun 12 00:07:46 2013  Kouhei Sutou  <kou@cozmixng.org>

	* test/xmlrpc/test_client.rb (XMLRPC::ClientTest#test_cookie_simple):
	  Add a test for the extracted method.

Tue Jun 11 23:56:24 2013  Kouhei Sutou  <kou@cozmixng.org>

	* test/xmlrpc/test_client.rb (XMLRPC::ClientTest::Fake::HTTP#started):
	  Add a missing empty line.

Tue Jun 11 23:37:19 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (validate_integer_pack_format): Don't require a word order
	  flag if numwords is 1 or less.
	  (absint_numwords_generic): Don't specify a word order for
	  rb_integer_pack.

	* hash.c (rb_hash): Ditto.

	* time.c (v2w_bignum): Ditto.

Tue Jun 11 23:01:57 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (validate_integer_pack_format): Refine error messages.

Tue Jun 11 22:25:04 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (validate_integer_pack_format): numwords argument added.
	  Move a varidation from rb_integer_pack_internal and rb_integer_unpack.
	  (rb_integer_pack_internal): Follow above change.
	  (rb_integer_unpack): Ditto.

Tue Jun 11 20:52:43 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_pack_internal): Renamed from rb_integer_pack
	  and overflow_2comp argument added.
	  (rb_integer_pack): Just call rb_integer_pack_internal.
	  (rb_integer_pack_2comp): New function.

	* internal.h (rb_integer_pack_2comp): Declared.

	* sprintf.c (rb_str_format): Use rb_integer_pack and
	  rb_integer_pack_2comp to format binary/octal/hexadecimal integers.
	  (ruby_digitmap): Declared.
	  (remove_sign_bits): Removed.
	  (BITSPERDIG): Ditto.
	  (EXTENDSIGN): Ditto.

Tue Jun 11 16:15:03 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_shrink_capa): shrink the capacity so it fits just with
	  the length.

	* array.c (ary_make_shared): release never used elements from frozen
	  array to be shared.  [ruby-dev:47416] [Bug #8510]

Tue Jun 11 12:49:01 2013  Zachary Scott  <zachary@zacharyscott.net>

	* doc/re.rdoc: Rename to doc/regexp.rdoc
	* re.c: Update rdoc include for rename of file

Tue Jun 11 07:13:13 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* eval_error.c (error_print): keep that errat is non-shady object.
	  and guard errat from GC.

Tue Jun 11 05:04:25 2013  Benoit Daloze  <eregontp@gmail.com>

	* ext/racc/cparse/cparse.c: use rb_ary_entry() and
	  rb_ary_subseq() instead of RARRAY_PTR.
	  Based on a patch by Dirkjan Bussink. See Bug #8399.

Mon Jun 10 23:51:51 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* array.c (rb_ary_new_from_values): fix a typo. pointed out by
	  nagachika.
	  http://d.hatena.ne.jp/nagachika/20130610/ruby_trunk_changes_41199_41220

Mon Jun 10 21:51:03 2013  Kouhei Sutou  <kou@cozmixng.org>

	* ext/socket/raddrinfo.c (nogvl_getaddrinfo): Fix indent.

Mon Jun 10 21:49:43 2013  Kouhei Sutou  <kou@cozmixng.org>

	* ext/socket/raddrinfo.c (nogvl_getaddrinfo): Add missing return
	  value assignment.

Mon Jun 10 20:58:11 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/socket/raddrinfo.c (nogvl_getaddrinfo): work around for Ubuntu
	  13.04's getaddrinfo issue with mdns4. [ruby-list:49420]

Mon Jun 10 19:34:39 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_pack): Returns sign instead of words.
	  (absint_numwords_generic): Follow the above change.
	  (big2str_base_powerof2): Follow the above change.

	* internal.h: Ditto.

	* hash.c (rb_hash): Ditto.

	* pack.c (pack_pack): Ditto.

	* random.c (int_pair_to_real_inclusive): Ditto.
	  (rand_init): Ditto.
	  (random_load): Ditto.
	  (limited_big_rand): Ditto.

	* time.c (v2w_bignum): Ditto.

Mon Jun 10 17:20:01 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rgengc_remember): permit promoted object.
	  (rb_gc_writebarrier -> remember)

Mon Jun 10 17:14:01 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (RVALUE_PROMOTE): fix parameter name (`x' to `obj')
	  and make it inline function (like RVALUE_PROMOTE).

Mon Jun 10 16:22:50 2013  Koichi Sasada  <ko1@atdot.net>

	* array.c (rb_ary_new_from_values): add assertion
	  (ary should be young object).

Mon Jun 10 16:05:59 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (wmap_mark): check allocation of `w->obj2wmap'.
	  (no-allocation `w->obj2wmap' will be NULL pointer reference)

Mon Jun 10 15:36:00 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.c (error_print): use checking functions instead of
	  catching exceptions.

	* eval_error.c (error_print): restore errinfo for the case new
	  exception raised while printing the message.  [ruby-core:55365]
	  [Bug #8501]

	* eval_error.c (error_print): reduce calling setjmp.

Mon Jun 10 12:10:06 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_unpack_num_bdigits_small: Extracted from
	  rb_integer_unpack.
	  (integer_unpack_num_bdigits_generic): Ditto.
	  (integer_unpack_num_bdigits_bytes): New function.
	  (rb_integer_unpack): Use above functions.
	  Return a Bignum for INTEGER_PACK_FORCE_BIGNUM even when the result
	  is zero.

Mon Jun 10 05:38:23 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (absint_numwords_small): New function.
	  (absint_numwords_generic): Use absint_numwords_small if possible.

Mon Jun 10 01:07:57 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (absint_numwords_bytes): New function.
	  (absint_numwords_generic): Extracted from rb_absint_numwords.
	  (rb_absint_numwords): Use absint_numwords_bytes if possible.

Sun Jun  9 21:33:15 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_absint_numwords): Return (size_t)-1 when overflow.
	  Refine variable names.
	  (rb_absint_size): Refine variable names.

	* internal.h (rb_absint_size): Refine an argument name.
	  (rb_absint_numwords): Ditto.

Sun Jun  9 16:51:41 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_absint_numwords): Renamed from rb_absint_size_in_word.

	* internal.h (rb_absint_numwords): Follow the above change.

	* pack.c (pack_pack): Ditto.

	* random.c (rand_init): Ditto.
	  (limited_big_rand): Ditto.

Sun Jun  9 14:41:05 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_pack): numwords_allocated argument removed.

	* internal.h (rb_integer_pack): Follow the above change.

	* hash.c (rb_hash): Ditto.

	* time.c (v2w_bignum): Ditto.

	* pack.c (pack_pack): Ditto.

	* random.c (int_pair_to_real_inclusive): Ditto.
	  (rand_init): Ditto.
	  (random_load): Ditto.
	  (limited_big_rand): Ditto.

Sun Jun  9 09:34:44 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big2str_base_powerof2): New function.
	  (rb_big2str0): Use big2str_base_powerof2 if base is 2, 4, 8, 16 or 32.

Sun Jun  9 00:59:04 2013  Tanaka Akira  <akr@fsij.org>

	* hash.c (rb_hash): Use rb_integer_pack to obtain least significant
	  long integer.

Sat Jun  8 23:56:00 2013  Tanaka Akira  <akr@fsij.org>

	* numeric.c (rb_num_to_uint): Use rb_absint_size instead of
	  RBIGNUM_LEN.

Sat Jun  8 22:53:45 2013  Tanaka Akira  <akr@fsij.org>

	* marshal.c (r_object0): Use rb_integer_unpack.

Sat Jun  8 22:18:57 2013  Tanaka Akira  <akr@fsij.org>

	* time.c (v2w): Use rb_absint_size instead of RBIGNUM_LEN.

Sat Jun  8 21:47:33 2013  Tanaka Akira  <akr@fsij.org>

	* time.c (v2w_bignum): Simplified using rb_integer_pack.
	  (rb_big_abs_find_maxbit): Removed.

Sat Jun  8 21:03:40 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_absint_singlebit_p): New function.

	* internal.h (rb_absint_singlebit_p): Declared.

	* time.c (v2w_bignum): Use rb_absint_singlebit_p instead of
	  rb_big_abs_find_minbit.
	  (rb_big_abs_find_minbit): Removed.

Sat Jun  8 20:24:23 2013  Tanaka Akira  <akr@fsij.org>

	* time.c (rb_big_abs_find_maxbit): Use rb_absint_size.
	  (bdigit_find_maxbit): Removed.

Sat Jun  8 19:47:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* class.c (include_modules_at): invalidate method cache if included
	  module contains constants

	* test/ruby/test_module.rb: add test

Sat Jun  8 19:31:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* random.c (limited_big_rand): declare rnd, lim and mask as uint32_t
	  to avoid 64 bit to 32 bit shorten warnings.

Sat Jun  8 19:23:53 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* win32/Makefile.sub: r41163 changed win32/win32.c and configure.in
	  but it didn't treat about mswin32/mswin64, so fix it.
	  NOTE: this needs a review by usa whether additional condition is
	  required or not.

Sat Jun  8 19:06:26 2013  Tanaka Akira  <akr@fsij.org>

	* random.c: Unused RBignum internal accessing macros removed.

Sat Jun  8 19:04:15 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (limited_big_rand): The argument, limit, is changed to
	  VALUE.  Use rb_integer_pack and rb_integer_unpack.

Sat Jun  8 17:15:18 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (make_seed_value): Fix the length given for
	  rb_integer_unpack.

Sat Jun  8 16:38:02 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_unpack): Don't use rb_funcall if possible.

	* random.c: Use uint32_t for elements of seed.
	  (make_seed_value): Use rb_integer_unpack.

Sat Jun  8 15:58:18 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (rand_init): Add a cast to fix clang compile error:
	  random.c:410:32: error: implicit conversion loses integer precision:
	  'size_t' (aka 'unsigned long') to 'int' [-Werror,-Wshorten-64-to-32]
	  This cast doesn't cause a problem because len is not bigger than
	  MT_MAX_STATE.

Sat Jun  8 15:30:03 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (rand_init): Use rb_integer_pack.
	  (roomof): Removed.

Sat Jun  8 14:58:32 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (INTEGER_PACK_FORCE_BIGNUM): New flag constant.

	* bignum.c (rb_integer_unpack): Support INTEGER_PACK_FORCE_BIGNUM.

	* random.c (int_pair_to_real_inclusive): Use
	  INTEGER_PACK_FORCE_BIGNUM to use rb_big_mul instead of rb_funcall.

Sat Jun  8 14:17:01 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check for NET_LUID.  header macro varies across
	  compiler versions.

	* win32/win32.c: use configured macro.

Sat Jun  8 11:59:55 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (int_pair_to_real_inclusive): Use rb_funcall instead of
	  rb_big_mul because rb_integer_unpack can return a Fixnum.

Sat Jun  8 11:17:39 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (int_pair_to_real_inclusive): Use rb_integer_pack.

Sat Jun  8 09:49:42 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (int_pair_to_real_inclusive): Use rb_integer_unpack.

Sat Jun  8 08:12:22 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (random_load): Use rb_integer_pack.

Sat Jun  8 06:15:46 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (numberof): Removed.

Sat Jun  8 06:00:47 2013  Tanaka Akira  <akr@fsij.org>

	* random.c: include internal.h.
	  (mt_state): Use rb_integer_unpack.

Sat Jun  8 00:55:51 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_pack_loop_setup): word_num_nailbytes_ret argument
	  removed.
	  (rb_integer_pack): Follow the above change.
	  (rb_integer_unpack): Follow the above change.

Sat Jun  8 00:37:32 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (validate_integer_pack_format): Renamed from
	  validate_integer_format.
	  (integer_pack_loop_setup): Renamed from integer_format_loop_setup.
	  (integer_pack_fill_dd): Renamed from int_export_fill_dd.
	  (integer_pack_take_lowbits): Renamed from int_export_take_lowbits.
	  (integer_unpack_push_bits): Renamed from int_import_push_bits.

Fri Jun  7 23:58:06 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_pack): Arguments changed.  Use flags to
	  specify word order and byte order.
	  (rb_integer_unpack): Ditto.
	  (validate_integer_format): Follow the above change.
	  (integer_format_loop_setup): Ditto.

	* pack.c: Ditto.

	* internal.h: Ditto.
	  (INTEGER_PACK_MSWORD_FIRST): Defined.
	  (INTEGER_PACK_LSWORD_FIRST): Ditto.
	  (INTEGER_PACK_MSBYTE_FIRST): Ditto.
	  (INTEGER_PACK_LSBYTE_FIRST): Ditto.
	  (INTEGER_PACK_NATIVE_BYTE_ORDER): Ditto.
	  (INTEGER_PACK_LITTLE_ENDIAN): Ditto.
	  (INTEGER_PACK_BIG_ENDIAN): Ditto.

Fri Jun  7 22:10:50 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rubygems/specification.rb (Gem::Specification#to_yaml):
	  use Gem::NoAliasYAMLTree.create instead of Gem::NoAliasYAMLTree.new
	  to suppress deprecated warnings.

Fri Jun  7 21:39:39 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_integer_pack): Renamed from rb_int_export.
	  (rb_integer_unpack): Renamed from rb_int_import.

	* internal.h, pack.c: Follow the above change.

Fri Jun  7 21:05:26 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (integer_format_loop_setup): Extracted from rb_int_export
	  and rb_int_import.

Fri Jun  7 19:48:38 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (validate_integer_format): Extracted from rb_int_export and
	  rb_int_import.

Fri Jun  7 19:23:15 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_absint_size): Use numberof.
	  (rb_int_export): Ditto.

Fri Jun  7 18:58:56 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (numberof): Gathered from various files.

	* array.c, math.c, thread_pthread.c, iseq.c, enum.c, string.c, io.c,
	  load.c, compile.c, struct.c, eval.c, gc.c, parse.y, process.c,
	  error.c, ruby.c: Remove the definitions of numberof.

Fri Jun  7 18:24:39 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_absint_size): Declare a variable, i, just before used
	  to suppress a warning.
	  (rb_int_export): Ditto.

Fri Jun  7 17:41:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* bignum.c (rb_absint_size): explicit cast to BDIGIT to avoid implicit
	  64 bit to 32 bit shortening warning
	* bignum.c (rb_int_export): ditto
	* bignum.c (int_import_push_bits): ditto

Fri Jun  7 17:31:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* internal.h (RCLASS_SUPER): use descriptive variable name
	* internal.h (RCLASS_SET_SUPER): ditto

Fri Jun  7 13:25:27 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/fbuffer/fbuffer.h (fbuffer_append_str): change the place of
	  RB_GC_GUARD. it should be after the object is used.

Fri Jun  7 13:22:43 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (before_gc_sweep): noinline can also avoid the segv instead of
	  -O0 of r41084. this way is expected less slow.

Fri Jun  7 11:45:42 2013  Kenta Murata  <mrkn@cookpad.com>

	* rational.c (numeric_quo): move num_quo in numeric.c to numeric_quo
	  in rational.c to refer canonicalization state for mathn support.
	  [ruby-core:41575] [Bug #5736]

	* numeric.c (num_quo): ditto.

	* test/test_mathn.rb: add a test for the change at r41109.

Fri Jun  7 11:41:42 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: revert r41106.  size_t may not be unsigned

	* bignum.c (rb_absint_size_in_word, rb_int_export, rb_int_import): use
	  NUM2SIZET() and SIZET2NUM() already defined in ruby/ruby.h.

Fri Jun  7 11:28:37 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c: use oldgen bitmap as initial mark bitmap when major gc.
	  so can skip oldgen bitmap check around mark & sweep.
	* gc.c (slot_sweep_body): change scan algorithm for performance:
	  from object's pointer base to bitmap one.

Fri Jun  7 11:25:56 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c: introduce oldgen bitmap for preparing performance tuning.

Fri Jun  7 11:20:57 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (MARKED_IN_BITMAP, MARK_IN_BITMAP, CLEAR_IN_BITMAP): bring
	  bitmap macros in one place, and introduce BITMAP_BIT.

Fri Jun  7 11:18:35 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* array.c (ary_new): change order of allocation in order
	  to remove FL_OLDGEN operation.

Fri Jun  7 11:16:28 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* tool/rdocbench.rb: add gc total time information.

Fri Jun  7 10:12:01 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: remove "Sunny" terminology.
	  "Sunny" doesn't mean antonym of "Shady" (questionable, doubtful, etc).
	  Instead of "Sunny", use "non-shady" or "normal".

Fri Jun  7 09:29:33 2013  Kenta Murata  <mrkn@cookpad.com>

	* bignum.c (rb_int_import): explicitly casting BDIGIT_DBL to BDIGIT
	  to prevent warning.

Fri Jun  7 07:29:33 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (rb_int_export): countp argument is split into
	  wordcount_allocated and wordcount.

	* bignum.c (rb_int_export): Follow the above change.

	* pack.c (pack_pack): Ditto.

Fri Jun  7 07:17:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: describe a compatibility issue of Numeric#quo
	  introduced at r41109.

Fri Jun  7 07:15:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* NEWS: fix style.

Fri Jun  7 06:48:17 2013  Benoit Daloze  <eregontp@gmail.com>

	* numeric.c: remove unused ID id_to_r introduced in r41109.

Fri Jun  7 06:15:31 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_int_import): New function.
	  (int_import_push_bits): Ditto.

	* internal.h (rb_int_import): Declared.

	* pack.c (pack_unpack): Use rb_int_import for BER compressed integer.

Thu Jun  6 22:24:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* numeric.c (num_quo): Use to_r method to convert the receiver to
	  rational.  [ruby-core:41575] [Bug #5736]

	* test/ruby/test_numeric.rb: add a test for the above change.

Thu Jun  6 20:40:17 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Invoke RUBY_REPLACE_TYPE for size_t.
	  Don't invoke RUBY_CHECK_PRINTF_PREFIX for size_t to avoid conflict
	  with RUBY_REPLACE_TYPE.

	* internal.h (rb_absint_size): Declared.
	  (rb_absint_size_in_word): Ditto.
	  (rb_int_export): Ditto.

	* bignum.c (rb_absint_size): New function.
	  (rb_absint_size_in_word): Ditto.
	  (int_export_fill_dd): Ditto.
	  (int_export_take_lowbits): Ditto.
	  (rb_int_export): Ditto.

	* pack.c (pack_pack): Use rb_int_export for BER compressed integer.

Thu Jun  6 19:31:33 2013  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: fixed coding error [ruby-core:55337].
	  reported by Riley Lynch.

Thu Jun  6 14:16:37 2013  Narihiro Nakamura  <authornari@gmail.com>

	* ext/objspace/object_tracing.c: rename allocation_info to
	  lookup_allocation_info. At times I confused "struct
	  allocation_info" with "function allocation_info".

Thu Jun  6 13:57:06 2013  Narihiro Nakamura  <authornari@gmail.com>

	* ext/objspace/object_tracing.c: allocation_info function isn't
	  called by any other file.

Thu Jun  6 09:41:00 2013  Kenta Murata  <mrkn@cookpad.com>

	* numeric.c (num_quo): should return a Float for a Float argument.
	  [ruby-dev:44710] [Bug #5515]

	* test/ruby/test_fixnum.rb: Add an assertion for the above change.

	* test/ruby/test_bignum.rb: ditto.

Thu Jun  6 00:59:44 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (gc_mark): get rid of pushing useless objects.
	* gc.c (rgengc_rememberset_mark): bypass gc_mark() in order to push
	  sunny old object at minor gc.
	* gc.c (gc_mark_children): move sunny old check to gc_mark().
	* gc.c (rgengc_check_shady): remove DEMOTE that already unnecessary.
	* gc.c (rb_gc_writebarrier): ditto.

	  change sunny old check point in order to save mark stack and
	  remove unnatural rest_sweep & demote.

Thu Jun  6 00:52:42 2013  Masaya Tarui  <tarui@ruby-lang.org>

	* gc.c (rgengc_rememberset_mark): change scan algorithm for performance:
	  from object's pointer base to bitmap one.

Thu Jun  6 00:30:04 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* win32/win32.c (NET_LUID): define it on MinGW32.
	  mingw-w64 has NET_LUID but mingw32 (mingw.org) still doesn't have
	  NET_LUID. reported by taco on IRC

Thu Jun  6 00:05:08 2013  Akinori MUSHA  <knu@iDaemons.org>

	* string.c (String#b): Allow code range scan to happen later so
	  ascii_only? on a result string returns the correct value.
	  [ruby-core:55315] [Bug #8496]

Wed Jun  5 22:40:42 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (capability_response): should ignore trailing
	  spaces.  Thanks, Peter Kovacs.  [ruby-core:55024] [Bug #8415]

	* test/net/imap/test_imap_response_parser.rb: related test.

Wed Jun  5 21:17:08 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (big_fdiv): Use nlz() instead of bdigbitsize().
	  (bdigbitsize): Removed.

Wed Jun  5 20:32:00 2013  Kenta Murata  <mrkn@cookpad.com>

	* include/ruby/ruby.h: fix alignment in comment.

Wed Jun  5 20:05:29 2013  Tanaka Akira  <akr@fsij.org>

	* random.c (int_pair_to_real_inclusive): Add a cast to BDIGIT.
	  (random_load): Fix shift width for fixnums.
	  Re-implement bignum extraction without ifdefs.

Wed Jun  5 15:26:10 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (before_gc_sweep): don't optimize it to avoid segv on Ubuntu
	  10.04 gcc 4.4.
	  http://u32.rubyci.org/~chkbuild/ruby-trunk/log/20130527T190301Z.diff.html.gz

Wed Jun  5 09:46:46 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_mkdir): add
	  EACCES for Windows.

Wed Jun  5 08:13:37 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_big_pow): Don't need to multiply SIZEOF_BDIGITS.
	  Use nlz instead of bitlength_bdigit.
	  (bitlength_bdigit): Removed.

Wed Jun  5 07:14:18 2013  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (d_lite_cmp, d_lite_equal): simplified.

Wed Jun  5 07:07:01 2013  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: fixed a bug [ruby-core:55295].  reported
	  by Riley Lynch.

Wed Jun  5 06:44:08 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Update to RubyGems 2.0.3

	* test/rubygems:  Tests for the above.

	* NEWS:  Added RubyGems 2.0.3 note.

Wed Jun  5 06:35:15 2013  Eric Hodel  <drbrain@segment7.net>

	* doc/marshal.rdoc:  Add description of Marshal format.

Wed Jun  5 01:16:09 2013  Benoit Daloze  <eregontp@gmail.com>

	* array.c (Array#+): fix documentation example.
	  Patch by Logan Serman. [Fixes GH-324]

Wed Jun  5 00:21:54 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/irb/lc/ja/help-message: update help messages.
	  following r41028. [ruby-dev:46707] [Feature #7510]

Wed Jun  5 00:09:32 2013  Tanaka Akira  <akr@fsij.org>

	* marshal.c (r_object0): Generalize a round up expression.
	  Use BDIGIT instead of int.

Tue Jun  4 23:44:02 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* object.c (rb_Hash): fix docs. patched by Stefan Sch"ussler.
	  [ruby-core:55299] [Bug #8487]

Tue Jun  4 23:16:49 2013  Benoit Daloze  <eregontp@gmail.com>

	* lib/irb/completion.rb: Use %w literal construction for long lists.
	  Patch by Dave Goodchild. [Fixes GH-299]

Tue Jun  4 23:08:42 2013  Benoit Daloze  <eregontp@gmail.com>

	* ext/objspace/objspace.c: improve wording and remove duplicated comment.
	  Based on a patch by Dave Goodchild. [Fixes GH-299]

Tue Jun  4 18:41:47 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bitlength_bdigit): Fix an off-by-one error.

Tue Jun  4 15:30:00 2013  Kenta Murata  <mrkn@cookpad.com>

	* ext/bigdecimal/lib/bigdecimal/util.rb (Float#to_d): fix the number
	  of figures.  Patch by Vipul A M <vipulnsward@gmail.com>.
	  https://github.com/ruby/ruby/pull/323  fix GH-323

	* test/bigdecimal/test_bigdecimal_util.rb: fix for the above change.

Tue Jun  4 00:44:27 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_mkdir): add
	  EEXIST for Linux. (suggested by nurse)

Mon Jun  3 23:58:19 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/fileutils.rb (FileUtils.rmdir): use remove_tailing_slash.
	* test/fileutils/test_fileutils.rb: test for above.

Mon Jun  3 23:47:55 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (bitlength_bdigit): New function.
	  (rb_big_pow): Use bitlength_bdigit instead of ffs.

Mon Jun  3 23:11:19 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/fileutils.rb: fix behavior when mkdir/mkdir_p accepted "/".
	* test/fileutils/test_fileutils.rb: add test for above change.
	  Patched by Mitsunori Komatsu. [GH-319]

Mon Jun  3 19:02:20 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (is_hfs): use the file descriptor instead of a path.

Mon Jun  3 07:15:17 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: removes AC_CHECK_FUNCS(readdir_r). readdir_r()
	  is only used from dir.c and it doesn't need readdir_r().
	* configure.in (SIZEOF_STRUCT_DIRENT_TOO_SMALL): removed. It is
	  only used for readdir_r.
	* dir.c: removes NAME_MAX_FOR_STRUCT_DIRENT. It is not right way
	  to detect maximum length of path len. POSIX require to use
	  fpathconf(). IOW, it might have lead to make a vulnerability
	  using stack smashing. Moreover, readdir() works enough for our
	  usage.
	* dir.c (READDIR): removes an implementation which uses
	  readdir_r() and parenthesize in a macro body correctly.
	* dir.c (dir_read): removes IF_HAVE_READDIR_R(DEFINE_STRUCT_DIRENT
	  entry), it is used only for readdir_r().
	* dir.c (dir_each): ditto.
	* dir.c (glob_helper): ditto.

	* dir.c (READDIR): removes entry and dp argument.
	* dir.c (dir_read): adjust for the above change.
	* dir.c (dir_each): ditto.
	* dir.c (glob_helper): ditto.

Mon Jun  3 03:40:29 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_insnhelper.c (vm_yield_setup_block_args): partially revert r41019.
	  The code is not useless.

Mon Jun  3 01:25:25 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/socket/test_sockopt.rb: change test name. follow r41037.

Mon Jun  3 01:08:43 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/rinda/test_rinda.rb: rename functions introduced in r41009.

Sun Jun  2 23:33:42 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* enc/trans/japanese_euc.trans, test/ruby/test_transcode.rb,
	  tool/transcode-tblgen.rb: change EUC-JP-2004 to EUC-JIS-2004.
	  This is follow up to changes in r41024.

Sun Jun  2 22:44:42 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/socket/option.c: rename functions introduced in r41009
	  s/ip/ipv4/g because they are ipv4 functions.
	  (there's a policy that the name "ip" is for methods which supports
	   both ipv4 and ipv6)

Sun Jun  2 16:15:29 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln_find.c (dln_find_exe, dln_find_file): remove deprecated
	  non-reentrant functions.

Sun Jun  2 15:04:35 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/cgi/util.rb, lib/erb.rb: Use String#b [Feature #8394] by znz

Sun Jun  2 14:10:21 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/irb/lc/help-message: Apply english updates for irb --help #7510

Sun Jun  2 12:03:58 2013  Zachary Scott  <zachary@zacharyscott.net>

	* range.c: Fix rdoc on Range#bsearch [Bug #8242] [ruby-core:54143]

Sun Jun  2 02:08:37 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/euc_jp.c: fix typo: the name of EUC-JIS-2004.

Sat Jun  1 23:17:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* vm_eval.c (rb_mod_module_eval): mention in docs that arguments passed
	  to the method are passed to the block

Sat Jun  1 17:58:13 2013  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#freeze, taint, untaint): Save a "self" by
	  utilizing super returning self, and add tests while at it.

Sat Jun  1 17:24:47 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_arguments): not a simple single argument if any
	  keyword arguments exist.  [ruby-core:55203] [Bug #8463]

	* vm_insnhelper.c (vm_yield_setup_block_args): split single parameter
	  if any keyword arguments exist, and then extract keyword arguments.
	  [ruby-core:55203] [Bug #8463]

Sat Jun  1 11:16:22 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_exc_new_cstr): rename from rb_exc_new2.

	* error.c (rb_exc_new_str): rename from rb_exc_new3.

Sat Jun  1 10:13:17 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_new[2-5], rb_{tainted,usascii}_str_new2),
	  (rb_str_buf_new2): remove old interfaces.

Sat Jun  1 08:00:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_read, gzfile_read_all, gzfile_getc),
	  (gzreader_gets): check EOF.  [ruby-core:55220] [Bug #8467]

Sat Jun  1 07:32:15 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c: Use BDIGIT type for hbase.

Sat Jun  1 02:37:35 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/socket/option.c (sockopt_s_byte): constructor of the sockopt
	  whose value's is byte.

	* ext/socket/option.c (sockopt_byte): getter for above.

	* ext/socket/option.c (inspect_byte): inspect for above.

	* ext/socket/option.c (sockopt_s_ip_multicast_loop): constructor of
	  the sockopt whose optname is IP_MULTICAST_LOOP.

	* ext/socket/option.c (sockopt_ip_multicast_loop): getter for above.

	* ext/socket/option.c (sockopt_s_ip_multicast_ttl): constructor of
	  the sockopt whose optname is IP_MULTICAST_TTL.

	* ext/socket/option.c (sockopt_ip_multicast_ttl): getter for above.

	* ext/socket/option.c (sockopt_inspect): use above.

Sat Jun 01 01:50:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_power): use rb_dbl2big
	  to convert a double value to a Bignum.

Sat Jun  1 00:19:50 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (calc_hbase): Make hbase the maximum power of base
	  representable in BDIGIT.

Fri May 31 23:56:13 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (calc_hbase): Extracted from rb_big2str0.

Fri May 31 23:22:24 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c: Don't hard code SIZEOF_BDIGITS for log_base(hbase).
	  (big2str_orig): hbase_numdigits argument added.
	  (big2str_karatsuba): Ditto.
	  (rb_big2str0): Calculate hbase_numdigits.

Fri May 31 17:57:21 2013  Zachary Scott  <zachary@zacharyscott.net>

	* process.c: Improve Process::exec documentation

Fri May 31 17:26:42 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (rb_funcallv): add better names of rb_funcall2.

	* vm_eval.c (rb_funcallv_public): ditto for rb_funcall3.

Fri May 31 17:04:45 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_new_capa): add better names of rb_ary_new2.

	* array.c (rb_ary_new_from_args): ditto for rb_ary_new3.

	* array.c (rb_ary_new_from_values): ditto for rb_ary_new4.

Fri May 31 16:35:44 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (HAVE_ATTRIBUTE_FUNCTION_ALIAS): define to tell if
	  alias attribute is available.

Fri May 31 16:03:23 2013  Zachary Scott  <zachary@zacharyscott.net>

	* object.c, proc.c: s/call_seq/call-seq in rdoc. [Fix GH-322]

Fri May 31 15:56:36 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/openssl/ossl_ssl.c: Add missing paren in rdoc [Fix GH-321]

Fri May 31 11:58:24 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (set_visibility): extract from rb_mod_public(),
	  rb_mod_protected() and rb_mod_private().

Thu May 30 19:47:42 2013  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_callee_setup_keyword_arg,
	  vm_callee_setup_arg_complex): consider a hash argument for keyword
	  only when the number of arguments is more than the expected
	  mandatory parameters.  [ruby-core:53199] [ruby-trunk - Bug #8040]

	* test/ruby/test_keyword.rb: update a test for above.

Thu May 30 17:55:04 2013  Zachary Scott  <zachary@zacharyscott.net>

	* process.c: RDoc on Process.spawn

Thu May 30 00:08:14 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_profile_enable): rest_sweep() to finish last GC.
	  Profiling record is allocated at first of marking phase.
	  Enable at lazy sweeping may cause an error (SEGV).

Wed May 29 10:33:27 2013  Koichi Sasada  <ko1@atdot.net>

	* hash.c: fix WB bug.
	  (1) Hash's key also needs WB.
	  (2) callback parameter *key and *value of st_update() is not a
	      storage of st_table itself (only local variable). So that
	      OBJ_WRITE() is not suitable, especially for `!existing'.
	      OBJ_WRITTEN() is used instead of OBJ_WRITE().

Tue May 28 12:31:21 2013  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/object_tracing.c: fix a bug reported at
	  "[ruby-core:55182] [ruby-trunk - Bug #8456][Open] Sugfault in Ruby Head"
	  Care about the case TracePoint#path #=> `nil'.

	* ext/objspace/object_tracing.c: add two new methods:
	  * ObjectSpace.allocation_class_path(o)
	  * ObjectSpace.allocation_method_id(o)
	  They are not useful for Object.new because they are always
	  "Class" and :new.
	  To trace more useful information, we need to maintain call-tree
	  using call/return hooks, which is implemented by
	  ll-prof <http://sunagae.net/wiki/doku.php?id=software:llprof>

	* test/objspace/test_objspace.rb: add a test.

Tue May 28 11:30:02 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): leave makefiles untouched if the content is
	  not changed, to get rid of unnecessary re-linking.

Tue May 28 03:11:02 2013  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/gc_hook.c, ext/objspace/objspace.c: add new methods to
	  hook GC invocation.
	  * ObjectSpace.after_gc_start_hook=(proc)
	  * ObjectSpace.after_gc_end_hook=(proc)

	  Note that hooks are not kicked immediately. Procs are kicked
	  at postponed_job.

	  This feature is a sample of new internal event and
	  rb_postponed_job API.

Tue May 28 02:56:15 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_stat): remove wrong rest_sweep().

Tue May 28 02:44:23 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (garbage_collect_body): fix GC_ENABLE_LAZY_SWEEP condition.

	* gc.c (GC_NOTIFY): move debug print location and use stderr instead
	  of stdout.

Tue May 28 02:07:21 2013  Koichi Sasada  <ko1@atdot.net>

	* vm_trace.c (rb_postponed_job_register_one): fix iteration bug.

	* ext/-test-/postponed_job/postponed_job.c,
	  test/-ext-/postponed_job/test_postponed_job.rb: add a test.

Tue May 28 00:34:23 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h, gc.c: add new internal event
	  RUBY_INTERNAL_EVENT_GC_END. This event invokes at the end of
	  after_sweep().
	  Time chart with lazy sweep is:
	    (1) Kick RUBY_INTERNAL_EVENT_GC_START
	    (2) [gc_marks()]
	    (3) [lazy_sweep()]
	    (4) [... run Ruby program (mutator) with lazy_sweep() ...]
	    (5) [after_sweep()]
	    (6) Kick RUBY_INTERNAL_EVENT_GC_END
	    (7) [... run Ruby program (mutator), and go to (1) ...]
	  Time chart without lazy sweep (GC.start, etc) is:
	    (1) Kick RUBY_INTERNAL_EVENT_GC_START
	    (2) [gc_marks()]
	    (3) [gc_sweep()]
	    (4) [after_sweep()]
	    (5) Kick RUBY_INTERNAL_EVENT_GC_END
	    (6) [... run Ruby program (mutator), and go to (1) ...]

	* ext/-test-/tracepoint/tracepoint.c,
	  test/-ext-/tracepoint/test_tracepoint.rb: modify a test.

Tue May 28 00:18:57 2013  Koichi Sasada  <ko1@atdot.net>

	* vm_trace.c (rb_postponed_job_flush): remove a wrong comment.

Mon May 27 22:09:33 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (RHASH_SIZE): Add a cast to suppress a
	  warning, comparison between signed and unsigned integer
	  expressions [-Wsign-compare], on ILP32.

Mon May 27 19:25:47 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: rename RUBY_INTERNAL_EVENT_FREE to
	  RUBY_INTERNAL_EVENT_FREEOBJ.

	* ext/-test-/tracepoint/tracepoint.c,
	  ext/objspace/object_tracing.c,
	  gc.c, vm_trace.c: catch up this change.

Mon May 27 18:57:28 2013  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c: support ObjectSpace.trace_object_allocations.
	  Read the following test to know HOWTO.
	  This feature is a sample of RUBY_INTERNAL_EVENT.

	* test/objspace/test_objspace.rb: add a test.

	* ext/objspace/object_tracing.c: ditto.

	* gc.c (rb_gc_count): add. This function returns GC count.

	* internal.h: add decl. of rb_gc_count(). Same as `GC.count'.

Mon May 27 17:33:28 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (install_recursive): add maxdepth option.

	* tool/rbinstall.rb (bin-comm): limit depth of bindir and reject empty
	  files.  [ruby-core:55101] [Bug #8432]

Mon May 27 16:16:18 2013  Koichi Sasada  <ko1@atdot.net>

	* vm_trace.c (rb_postponed_job_flush, rb_postponed_job_register): use
	  ruby_xmalloc/xfree. It is safe during GC.

Mon May 27 09:24:03 2013  Koichi Sasada  <ko1@atdot.net>

	* test/-ext-/postponed_job/test_postponed_job.rb: fix typo and class name.

Mon May 27 09:05:17 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h, gc.c, vm_trace.c: add internal events.
	  * RUBY_INTERNAL_EVENT_NEWOBJ: object created.
	  * RUBY_INTERNAL_EVENT_FREE: object freed.
	  * RUBY_INTERNAL_EVENT_GC_START: GC started.
	  And rename `RUBY_EVENT_SWITCH' to `RUBY_INTERNAL_EVENT_SWITCH'.

	  Internal events can not invoke any Ruby program because the tracing
	  timing may be critical (under huge restriction).
	  These events can be hooked only by C-extensions.
	  We recommend to use rb_postponed_job_register() API to call Ruby
	  program safely.

	  This change is mostly written by Aman Gupta (tmm1).
	  https://bugs.ruby-lang.org/issues/8107#note-12
	  [Feature #8107]

	* include/ruby/debug.h, vm_trace.c: added two new APIs.
	  * rb_tracearg_event_flag() returns rb_event_flag_t of this event.
	  * rb_tracearg_object() returns created/freed object.

	* ext/-test-/tracepoint/extconf.rb,
	  ext/-test-/tracepoint/tracepoint.c,
	  test/-ext-/tracepoint/test_tracepoint.rb: add a test.

Mon May 27 08:38:21 2013  Koichi Sasada  <ko1@atdot.net>

	* ext/-test-/postponed_job/postponed_job.c: fix `init' function name.

Mon May 27 06:22:41 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/debug.h, vm_trace.c: add rb_postponed_job API.
	  Postponed jobs are registered with this API. Registered jobs
	  are invoked at `ruby-running-safe-point' as soon as possible.
	  This timing is completely same as finalizer timing.

	  There are two APIs:
	  * rb_postponed_job_register(flags, func, data): register a
	    postponed job with data. flags are reserved.
	  * rb_postponed_job_register_one(flags, func, data): same as
	    `rb_postponed_job_register', but only one `func' job is
	    registered (skip if `func' is already registered).

	  This change is mostly written by Aman Gupta (tmm1).
	  https://bugs.ruby-lang.org/issues/8107#note-15
	  [Feature #8107]

	* gc.c: use postponed job API for finalizer.

	* common.mk: add dependency from vm_trace.c to debug.h.

	* ext/-test-/postponed_job/extconf.rb, postponed_job.c,
	  test/-ext-/postponed_job/test_postponed_job.rb: add a test.

	* thread.c: implement postponed API.

	* vm_core.h: ditto.

Mon May 27 02:26:02 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_stat): collect promote_operation_count and
	  types (RGENGC_PROFILE >= 2).

Mon May 27 01:40:58 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_stat): collect shade_operation_count,
	  remembered_sunny_object_count and remembered_shady_object_count
	  for each types when RGENGC_PROFILE >= 2.
	  They are informative for optimization.

Mon May 27 01:15:22 2013  Koichi Sasada  <ko1@atdot.net>

	* hash.c (rb_hash_tbl_raw), internal.h: added.
	  Returns st_table without shading hash.

	* array.c: use rb_hash_tbl_raw() for read-only purpose.

	* compile.c (iseq_compile_each): ditto.

	* gc.c (count_objects): ditto.

	* insns.def: ditto.

	* process.c: ditto.

	* thread.c (clear_coverage): ditto.

	* vm_insnhelper.c: ditto.

Mon May 27 00:31:09 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/make-snapshot: use ENV["AUTOCONF"] instead of directly using
	  literal "autoconf".

Sun May 26 21:31:46 2013  Koichi Sasada  <ko1@atdot.net>

	* hash.c, include/ruby/ruby.h: support WB protected hash.
	  * constify RHash::ifnone and make new macro RHASH_SET_IFNONE().
	  * insert write barrier for st_update().

	* include/ruby/intern.h: declare rb_hash_set_ifnone(hash, ifnone).

	* marshal.c (r_object0): use RHASH_SET_IFNONE().

	* ext/openssl/ossl_x509name.c (Init_ossl_x509name): ditto.

Sat May 25 23:22:38 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* test/fiddle/test_c_struct_entry.rb,
	  test/fiddle/test_c_union_entity.rb,
	  test/fiddle/test_cparser.rb, test/fiddle/test_func.rb,
	  test/fiddle/test_handle.rb, test/fiddle/test_import.rb,
	  test/fiddle/test_pointer.rb: don't run test if the system
	  don't support fiddle.

Sat May 25 21:29:34 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/pty/pty.c (get_device_once): FreeBSD 10-current and 9-stable
	  added O_CLOEXEC support to posix_openpt, so assume FreeBSD 9.2 or
	  later supports it.
	  http://www.freebsd.org/cgi/query-pr.cgi?pr=162374

Sat May 25 18:46:23 2013  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (rb_method_entry_min_max_arity): fix missing break in switch.
	  This was introduced in r38236, which is not intentional apparently.
	  This has caused no actual harm because VM_METHOD_TYPE_OPTIMIZED is
	  not used except for OPTIMIZED_METHOD_TYPE_SEND, but may do in
	  future.  Coverity Scan found this inadequacy.

Sat May 25 18:08:06 2013  Yusuke Endoh  <mame@tsg.ne.jp>

	* dir.c (bracket): fix copy-paste error.  When the first and last
	  characters of fnmatch range have different length, fnmatch may
	  have wrongly matched a path that does not really match.
	  Coverity Scan found this bug.

Sat May 25 17:06:25 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep): reduce full GC timing.

Sat May 25 11:28:49 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (set_const_visibility): return without clearing method
	  cache if no arguments.

	* vm_method.c (set_method_visibility): ditto.

Sat May 25 11:27:32 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (set_method_visibility): quote unprintable method name.

Sat May 25 11:24:24 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (rb_frame_callee): returns the called name of the current
	  frame, not the previous frame.

	* eval.c (prev_frame_callee, prev_frame_func): rename and make static,
	  as these are used by rb_f_method_name() and rb_f_callee_name() only.

	* variable.c (set_const_visibility): use the called name.

Sat May 25 08:58:23 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_quote_unprintable): check if argument is a string.

Fri May 24 19:32:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* variable.c (set_const_visibility): use rb_frame_this_func() instead
	  of rb_frame_callee() for getting the name of the called method

	* test/ruby/test_module.rb: add test for private_constant with no args

Fri May 24 18:53:10 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: do major/full GC when:
	  * number of oldgen object is bigger than twice of
	    number of oldgen object at last full GC.
	  * number of remembered shady object is bigger than twice of
	    number of remembered shady object at last full GC.
	  * number of oldgen object and remembered shady object is bigger
	    than half of total object space.
	  (please fix my English!)

Fri May 24 17:07:00 2013  Charlie Somerville  <charliesome@ruby-lang.org>

	* intern.h: remove dangling rb_class_init_copy declaration
	  [ruby-core:55120] [Bug #8434]

Fri May 24 16:31:23 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/strscan/strscan.c (strscan_aref): raise error if given
	  name reference is not found.

Fri May 24 15:48:18 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep, garbage_collect_body): do major GC (full GC)
	  before extending heaps.
	  TODO: do major GC when there are many old (promoted) objects.

	* gc.c (after_gc_sweep): remove TODO comments.

Fri May 24 11:04:00 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_RPATHFLAGS): do not append -L option with
	  runtime library directory if cross compiling, but only -R option.
	  runtime path makes no sense on the host system.  [ruby-dev:47363]
	  [Bug #8443]

Fri May 24 02:57:17 2013  Koichi Sasada  <ko1@atdot.net>

	* object.c (rb_obj_clone): should not propagate OLDGEN status.
	  This propagation had caused WB miss for class.

Thu May 23 17:35:30 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (loaded_feature_path): fix invalid read by index underflow.
	  the beginning of name is also a boundary as well as just after '/'.

Thu May 23 17:21:22 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (gc_profile_dump_on): revert r40898.  ok to show the record
	  accumulating while lazy_sweep().

Wed May 22 16:50:18 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (gc_profile_dump_on): use size_t to get rid of overflow and
	  show the header when next_index > 0, instead of next_index != 1.

Wed May 22 15:18:59 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (setup_overlapped): check the error code in addition
	  to the result of SetFilePointer() to determine if an error occurred,
	  because INVALID_SET_FILE_POINTER is a valid value.
	  [ruby-core:55098] [Bug #8431]

	* win32/win32.c (setup_overlapped, finish_overlapped): extract from
	  rb_w32_read() and rb_w32_write().

Wed May 22 14:19:56 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_prepare_free_objects, rest_sweep, lazy_sweep): fix position
	  of `during_gc' setting.

Wed May 22 07:36:08 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (garbage_collect): all GC is start from garbage_collect()
	  (or garbage_collect_body()). `garbage_collect()' accept additional
	  two parameters `full_mark' and `immediate_sweep'.
	  If `full_mark' is TRUE, then force it full gc (major gc), otherwise,
	  it depends on status of object space. Now, it will be minor gc.
	  If `immediate_sweep' is TRUE, then disable lazy sweep.
	  To allocate free memory, `full_mark' and `immediate_sweep' should be
	  TRUE. Otherwise, they should be FALSE.

	* gc.c (gc_prepare_free_objects): use `garbage_collect_body()'.

	* gc.c (slot_sweep, before_gc_sweep, after_gc_sweep): add logging code.

Tue May 21 22:47:06 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/strscan/strscan.c (strscan_aref): support named captures.
	  patched by Konstantin Haase [ruby-core:54664] [Feature #8343]

Tue May 21 21:48:44 2013  Kouhei Sutou  <kou@cozmixng.org>

	* test/ruby/test_dir_m17n.rb (TestDir_M17N#test_entries_compose):
	  Use #each instead of #map just for iteration.

Tue May 21 19:57:22 2013  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/lib/digest.rb (Digest::Class.file): Take optional
	  arguments that are passed to the constructor of the digest
	  class.

Tue May 21 17:21:12 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: remove gc_profile_record::is_marked. always true.

Tue May 21 17:13:40 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: fix to collect additional information for GC::Profiler.
	  * major/minor GC
	  * trigger reason of GC

	* gc.c (gc_profile_dump_on): change reporting format with
	  added information.

	* gc.c (gc_profile_record_get): return added information by
	  :GC_FLAGS => array.

Tue May 21 16:45:31 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: GC::Profiler's sweeping time is accumulated all slot
	  sweeping time. At lazy GC, GC::Profiler makes new record entry
	  for each lazy_sweep(). In this change, accumulating all
	  slot_sweep() time.
	  And change indentation.

Tue May 21 16:29:09 2013  Koichi Sasada  <ko1@atdot.net>

	* common.mk (rdoc-bench): add a benchmark rule
	  using RDoc. Generate all rdoc related files
	  (same as `make rdoc') in temporary directory
	  and remove them. Execution time, GC::Profiler
	  and results of GC.stat are printed.

	* tool/rdocbench.rb: added for `rdoc-bench'.

Tue May 21 16:25:05 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_profile_dump_on): `count' should be (int) because it
	  can be negative number.
	  And use pointer for `record' (don't copy).

Tue May 21 03:11:18 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_each): compose HFS file names from
	  UTF8-MAC. [ruby-core:48745] [Bug #7267]

Tue May 21 03:08:52 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (assert_separately): require envutil in the
	  child process too.

Tue May 21 03:07:26 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_conv_enc_opts): should infect.

Mon May 20 22:24:45 2013  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#delete_if, Set#keep_if): Avoid blockless call of
	  proc, which is not portable to JRuby.  Replace &method() with
	  faster and simpler literal blocks while at it.

Mon May 20 22:00:31 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/e2mmap.rb: Format of E2MM documentation

Mon May 20 21:41:15 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/extmk.rb: nodoc this file

Mon May 20 20:43:32 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/cmath.rb: Remove duplicate RDoc heading from overview

Mon May 20 20:36:19 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/securerandom.rb: Update position of overview for RDoc

Mon May 20 19:33:55 2013  Benoit Daloze  <eregontp@gmail.com>

	* math.c: improve and fix documentation of sin, tan and log

Mon May 20 19:31:49 2013  Benoit Daloze  <eregontp@gmail.com>

	* lib/logger.rb (Logger::Application): show namespace in documentation

Mon May 20 11:50:12 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/pp.rb: Revert part of r40834 and nodoc PP::ObjectMixin
	  [ruby-core:55068]

Mon May 20 10:40:21 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/webrick/htmlutils.rb (WEBrick::HTMLUtils#escape): replace HTML
	  meta chars even in non-ascii string.  [Bug #8425] [ruby-core:55052]

	* lib/webrick/httputils.rb (WEBrick::HTTPUtils#{_escape,_unescape}):
	  fix %-escape encodings.  [Bug #8425] [ruby-core:55052]

	* lib/webrick/httpservlet/filehandler.rb (set_dir_list): revert r20152
	  partially and fix misuse of bytesize and regexp repetition operator.

Mon May 20 08:03:51 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/profiler.rb: Document Profiler__ methods

Mon May 20 08:02:13 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/tempfile.rb: nodoc Tempfile#inspect

Mon May 20 07:48:24 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/stringio/stringio.c: Correct position of method rdoc

Mon May 20 07:27:41 2013  Zachary Scott  <zachary@zacharyscott.net>

	* math.c: RDoc formatting of Math core docs with domains and codomains
	  Patch by @eLobato [Fixes GH-309]

Mon May 20 05:58:12 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/bigdecimal/bigdecimal.c: Formatting for BigMath [Fixes GH-306]
	  Based on a patch by @eLobato.
	* ext/bigdecimal/lib/bigdecimal/math.rb: ditto

Mon May 20 04:56:59 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/forwardable.rb: Forwardable examples in overview were broken
	  Based on patch by @joem [Fixes GH-303] [Bug #8392]

Mon May 20 03:35:26 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/optparse.rb: nodoc OptionParser::Version and SPLAT_PROC

Mon May 20 03:16:52 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/pp.rb: Document PP::ObjectMixin [Fixes GH-312]

Sun May 19 23:52:22 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/webrick/test_htmlutils.rb: add test for WEBrick::HTMLUtils.

Sun May 19 23:12:07 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* encoding.c: document fix, change default script encoding.
	  patched by @windwiny [Fixes GH-310]

Sun May 19 17:29:07 2013  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#delete_if, Set#keep_if): Add comments.

Sun May 19 11:37:36 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* ext/fiddle/extconf.rb: ignore rc version of libffi to fix build failure.

Sun May 19 10:38:50 2013  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-electric.el (ruby-electric-delete-backward-char): Use
	  delete-char instead of delete-backward-char, which is an
	  interactive function.

Sun May 19 03:59:29 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_scrub0): added for refactoring.

Sun May 19 03:48:26 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.decode_www_form): scrub string if decoded
	  bytes are invalid for the encoding.

Sun May 19 02:46:32 2013  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#delete_if, Set#keep_if): Make Set#delete_if and
	  Set#keep_if more space and time efficient by avoiding to_a.

Sun May 19 02:33:09 2013  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-electric.el (ruby-electric-setup-keymap): Make
	  backquotes electric as well.  It was listed in
	  ruby-electric-expand-delimiters-list but not activated.

	* misc/ruby-electric.el (ruby-electric-delete-backward-char):
	  Introduce electric DEL that deletes what the previous electric
	  command has input.

	* misc/ruby-electric.el (ruby-electric-matching-char): Make
	  electric quotes work again at the end of buffer.

Sun May 19 01:39:50 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (setjmp-type): check if setjmpex() is really available.
	  workaround for i686-w64-mingw32 which declares it but lacks its
	  definition.

	* include/ruby/defines.h: include setjmpex.h only if also setjmpex()
	  is available.

Sat May 18 23:57:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (setjmp-type): use setjmpex() on w64-mingw32 to get rid
	  of -Wclobbered warnings.

	* include/ruby/defines.h: include setjmpex.h here becase setjmp.h is
	  included from win32.h via intrin.h, winnt.h, and so on.

Sat May 18 20:28:12 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (INTEGER2NUM): Make less comparisons.

Sat May 18 20:15:28 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_scrub_bang): add String#scrub!. [Feature #8414]

Sat May 18 16:59:52 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (INTEGER2NUM): Renamed from INTEGER2VALUE.

Sat May 18 16:57:58 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (INTEGER2VALUE): Suppress a warning:
	  comparison between signed and unsigned integer expressions

Sat May 18 16:38:39 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): forward anonymous and first keyword
	  rest argument one.  [ruby-core:55033] [Bug #8416].

Sat May 18 15:49:14 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_vm_tag): move jmpbuf between tag and prev so ensure to
	  be accessible.

Sat May 18 11:05:14 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (inspect_enumerator): use VALUE instead of mere char*
	  by using rb_sprintf() and rb_id2str().

	* enumerator.c (append_method): extract from inspect_enumerator().

Sat May 18 09:00:32 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb (INTEGER2VALUE): Use LONG2FIX if possible.

Sat May 18 00:38:47 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: Convert integer constants bigger than int
	  correctly.

Fri May 17 22:02:15 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ifaddr.c: Use unsigned LONG_LONG to represent flags
	  because SunOS 5.11 (OpenIndiana) defines ifa_flags as uint64_t.

Fri May 17 21:47:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* cont.c: Typo in constant MAX_MACHINE_STACK_CACHE from '..MAHINE..'
	  patch by @schmurfy [Fixes GH-307]

Fri May 17 19:18:24 2013  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-electric.el (ruby-electric-matching-char): Do not put
	  a closing quote when the quote typed does not start a string, as
	  in $', ?\' or ?\".

Fri May 17 18:06:15 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Consider error messages to find out version option of
	  C compiler.
	  The C compiler of Sun Studio C emits "Warning: Option -qversion
	  passed to ld, if ld is invoked, ignored otherwise" and exit
	  successfully.

Fri May 17 17:34:48 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_gc_guarded_ptr): unoptimize on other compilers than gcc and
	  msvc.

Fri May 17 11:06:48 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_intern.h (TH_PUSH_TAG): ensure jmpbuf to be accessible before
	  pushing tag to get rid of unaccessible tag by stack overflow.

Thu May 16 17:15:32 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_eval.c (rb_catch_obj): add volatile to tag to prevent crash
	  experimentally.
	  http://www.rubyist.net/~akr/chkbuild/debian/ruby-trunk/log/20130515T133500Z.log.html.gz

Thu May 16 16:19:50 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (verconf.in): no longer used.

	* win32/Makefile.sub (config.status): fix typo.

	* configure.in, template/verconf.h.in (RUBY_EXEC_PREFIX): fix for
	  default prefix.

Thu May 16 13:12:27 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/verconf.h.in: generate verconf.h from the template and
	  rbconfig.rb.

Thu May 16 05:47:18 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: fix syntax error.
	  Thanks @spastorino! [ruby-core:55011]

Thu May 16 03:05:45 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_node_newnode): use newobj_of() instead of rb_newobj().

Thu May 16 02:03:39 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/depend: Add a dependency for ifaddr.o.

Thu May 16 01:44:45 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (verconf.h): $< cannot be used in explicit rules with
	  nmake.

	* win32/Makefile.sub (CONFIG_H): create verconf.in instead of
	  verconf.h.

Thu May 16 01:25:07 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: only emit warnings when
	  -w is enabled.

Wed May 15 18:58:17 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (newobj): rename to `newobj_of' and accept additional
	  three parameters v1, v2, v3. newobj_of() do OBJSETUP() and
	  fill values with v1, v2, v3.

	* gc.c (rb_data_object_alloc, rb_data_typed_object_alloc):
	  use newobj_of().

Wed May 15 17:55:49 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_PLATFORM): move to config.h as needed by
	  version.c.

Wed May 15 17:04:11 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: add an additional RGENGC_PROFILE mode (2).
	  Profiling result can be check by GC.stat.

	* gc.c (type_name): separate from obj_type_name().

Wed May 15 16:58:24 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: save configured load path values into verconf.in.

	* common.mk (verconf.h): create from verconf.in with shvar_to_cpp.rb.

	* tool/shvar_to_cpp.rb: turn shell variables into C macros.
	  [Bug #7959]

	* loadpath.c: split load path staffs from version.c.

	* dmyloadpath.c: miniruby has no builtin load paths, so verconf.h is
	  not needed.

Wed May 15 03:56:09 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: adding backwards
	  compatible YAMLTree.new method

Wed May 15 02:22:16 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: Adding Psych.safe_load for loading a user
	  defined, restricted subset of Ruby object types.
	* ext/psych/lib/psych/class_loader.rb: A class loader for
	  encapsulating the logic for which objects are allowed to be
	  deserialized.
	* ext/psych/lib/psych/deprecated.rb: Changes to use the class loader
	* ext/psych/lib/psych/exception.rb: ditto
	* ext/psych/lib/psych/json/stream.rb: ditto
	* ext/psych/lib/psych/nodes/node.rb: ditto
	* ext/psych/lib/psych/scalar_scanner.rb: ditto
	* ext/psych/lib/psych/stream.rb: ditto
	* ext/psych/lib/psych/streaming.rb: ditto
	* ext/psych/lib/psych/visitors/json_tree.rb: ditto
	* ext/psych/lib/psych/visitors/to_ruby.rb: ditto
	* ext/psych/lib/psych/visitors/yaml_tree.rb: ditto
	* ext/psych/psych_to_ruby.c: ditto
	* test/psych/helper.rb: ditto
	* test/psych/test_safe_load.rb: tests for restricted subset.
	* test/psych/test_scalar_scanner.rb: ditto
	* test/psych/visitors/test_to_ruby.rb: ditto
	* test/psych/visitors/test_yaml_tree.rb: ditto

Wed May 15 02:06:35 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/psych/helper.rb: envutil is not available outside Ruby, so
	  port the functions from envutil to the test helper.

	* test/psych/test_deprecated.rb: ditto

	* test/psych/test_encoding.rb: ditto

Wed May 15 00:42:54 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* signal.c: need to include unistd.h for write(2).
	  unistd.h is now included via ruby/defines.h, but should explicitly
	  include here.  (suggested by kosaki)

Tue May 14 23:43:05 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/.document: Add ifaddr.c.

Tue May 14 23:24:31 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/extconf.rb: check for if_nametoindex() for
	  i686-w64-mingw32, and check for declarations of if_indextoname() and
	  if_nametoindex().

	* ext/socket/ifaddr.c (ifaddr_ifindex): not-implement unless
	  if_nametoindex() is available.

	* ext/socket/rubysocket.h: declare if_indextoname() and
	  if_nametoindex() if available but not declared.

Tue May 14 19:58:17 2013  CHIKANAGA Tomoyuki  <nagachika@ruby-lang.org>

	* ext/dl/lib/dl/func.rb (DL::Function#call): check tainted when
	  $SAFE > 0.
	* ext/fiddle/function.c (function_call): check tainted when $SAFE > 0.
	* test/fiddle/test_func.rb (module Fiddle): add test for above.


Tue May 14 14:51:52 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (INTPTR_MAX, INTPTR_MIN, UINTPTR_MAX): split
	  from intptr_t and uintptr_t, since VC9 defines the latter only in
	  crtdefs.h.

Tue May 14 12:21:28 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (NET_LUID): mingw may have NET_LUID and not defined
	  _IFDEF_.

Tue May 14 03:33:17 2013  Koichi Sasada  <ko1@atdot.net>

	* string.c (rb_str_new_frozen): remove debug print.

Tue May 14 03:22:51 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: enable to generate write barrier protected
	  arrays (T_ARRAY).

Tue May 14 03:21:42 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: enable to generate write barrier protected
	  strings (T_STRING).

Tue May 14 03:19:59 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: enable to generate write barrier protected
	  objects (T_OBJECT).

Tue May 14 03:17:15 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: enable to generate write barrier protected
	  objects for numeric types (Float, Complex, Rational, Bignum).

Tue May 14 03:10:59 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: enable RGENGC (USE_RGENGC)
	  but no type creates write protected (sunny) objects
	  (RGENGC_WB_PROTECTED_* == 0).

Tue May 14 02:47:30 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: support RGENGC. [ruby-trunk - Feature #8339]
	  See this ticket about RGENGC.

	* gc.c: Add several flags:
	  * RGENGC_DEBUG: if >0, then prints debug information.
	  * RGENGC_CHECK_MODE: if >0, add assertions.
	  * RGENGC_PROFILE: if >0, add profiling features.
	    check GC.stat and GC::Profiler.

	* include/ruby/ruby.h: disable RGENGC by default (USE_RGENGC == 0).

	* array.c: add write barriers for T_ARRAY and generate sunny objects.

	* include/ruby/ruby.h (RARRAY_PTR_USE): added. Use this macro if
	  you want to access raw pointers. If you modify the contents which
	  pointer pointed, then you need to care write barrier.

	* bignum.c, marshal.c, random.c: generate T_BIGNUM sunny objects.

	* complex.c, include/ruby/ruby.h: add write barriers for T_COMPLEX
	  and generate sunny objects.

	* rational.c (nurat_s_new_internal), include/ruby/ruby.h: add write
	  barriers for T_RATIONAL and generate sunny objects.

	* internal.h: add write barriers for RBasic::klass.

	* numeric.c (rb_float_new_in_heap): generate sunny T_FLOAT objects.

	* object.c (rb_class_allocate_instance), range.c:
	  generate sunny T_OBJECT objects.

	* string.c: add write barriers for T_STRING and generate sunny objects.

	* variable.c: add write barriers for ivars.

	* vm_insnhelper.c (vm_setivar): ditto.

	* include/ruby/ruby.h, debug.c: use two flags
	  FL_WB_PROTECTED and FL_OLDGEN.

	* node.h (NODE_FL_CREF_PUSHED_BY_EVAL, NODE_FL_CREF_OMOD_SHARED):
	  move flag bits.

Tue May 14 01:54:48 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: remove rb_objspace_t::marked_num.
	  We can use `objspace_live_num()' instead of removed `marked_num'
	  if it is after `after_gc_sweep()' function call.

	* gc.c (after_gc_sweep): use objspace_live_num() instead of removed
	  rb_objspace_t::marked_num.

	* gc.c (gc_mark_ptr, gc_marks): remove rb_objspace_t::marked_num code.

	* gc.c (gc_prepare_free_objects): do not call set_heaps_increment()
	  with checking objspace->heap.marked_num. At this point, we only
	  need to check availability of free-cell.

	* gc.c (lazy_sweep): call after_gc_sweep() if there are no sweep_able entry.

	* gc.c (rest_sweep, gc_prepare_free_objects): remove after_gc_sweep() call.

Tue May 14 01:50:41 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: disable GC_PROFILE_MORE_DETAIL (fix last commit).

	* gc.c (gc_prof_set_malloc_info): fix "objspace->heap.live_num" to
	  "objspace_live_num(objspace)". There is no such member variable.

Tue May 14 01:25:55 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c: refactoring GC::Profiler.

	* gc.c (gc_prof_sweep_timer_start/stop): removed because
	  they doesn't support lazy sweep.

	* gc.c (gc_prof_sweep_slot_timer_start/stop): added.
	  redefine `sweeping time' to accumulated time of all of
	  slot_sweep().

	* gc.c (rb_objspace_t::profile::count): renamed to
	  rb_objspace_t::profile::next_index. `counter' seems ambiguous.
	  increment it when next record is acquired.

Tue May 14 00:48:55 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: constify RRational::(num,den) and
	  RComplex::(real,imag).
	  Add macro to set these values:
	    * RRATIONAL_SET_NUM()
	    * RRATIONAL_SET_DEN()
	    * RCOMPLEX_SET_REAL()
	    * RCOMPLEX_SET_IMAG()
	  This change is a part of RGENGC branch [ruby-trunk - Feature #8339].

	  TODO: API design. RRATIONAL_SET(rat,num,den) is enough?
	  TODO: Setting constify variable with cast has same issue of r40691.

	* complex.c, rational.c: use above macros.

Mon May 13 21:49:17 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Check socketpair again.
	  It is required on Unix.

Mon May 13 21:20:32 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (getipaddrs): use alternative interface name if
	  available, because if_nametoindex() requires them.

Mon May 13 20:23:24 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (getipaddrs): [experimental]
	  emulate getipaddrs(3) on Unix.

	* win32/Makefile.sub, configure.in (LIBS): need iphlpapi.lib for above
	  function.

	* include/ruby/win32.h (socketpair): rb_w32_socketpair() doesn't
	  substitute for any function, so use non-prefixed name.

	* ext/socket/extconf.rb (socketpair); follow above change.

Mon May 13 20:11:06 2013  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (prepare_iseq_build): remove additional line break.

Mon May 13 19:29:54 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: constify RBasic::klass and add
	  RBASIC_CLASS(obj) macro which returns a class of `obj'.
	  This change is a part of RGENGC branch [ruby-trunk - Feature #8339].

	* object.c: add new function rb_obj_reveal().
	  This function reveal internal (hidden) object by rb_obj_hide().
	  Note that do not change class before and after hiding.
	  Only permitted example is:
	    klass = RBASIC_CLASS(obj);
	    rb_obj_hide(obj);
	    ....
	    rb_obj_reveal(obj, klass);

	  TODO: API design. rb_obj_reveal() should be replaced with others.

	  TODO: modify constified variables using cast may be harmful for
	        compiler's analysis and optimization.
	        Any idea to prohibit inserting RBasic::klass directly?
	        If rename RBasic::klass and force to use RBASIC_CLASS(obj),
	        then all codes such as `RBASIC(obj)->klass' will be
	        compilation error. Is it acceptable? (We have similar
	        experience at Ruby 1.9,
	        for example "RARRAY(ary)->ptr" to "RARRAY_PTR(ary)".

	* internal.h: add some macros.
	  * RBASIC_CLEAR_CLASS(obj) clear RBasic::klass to make it internal
	    object.
	  * RBASIC_SET_CLASS(obj, cls) set RBasic::klass.
	  * RBASIC_SET_CLASS_RAW(obj, cls) same as RBASIC_SET_CLASS
	    without write barrier (planned).
	  * RCLASS_SET_SUPER(a, b) set super class of a.

	* array.c, class.c, compile.c, encoding.c, enum.c, error.c, eval.c,
	  file.c, gc.c, hash.c, io.c, iseq.c, marshal.c, object.c,
	  parse.y, proc.c, process.c, random.c, ruby.c, sprintf.c,
	  string.c, thread.c, transcode.c, vm.c, vm_eval.c, win32/file.c:
	  Use above macros and functions to access RBasic::klass.

	* ext/coverage/coverage.c, ext/readline/readline.c,
	  ext/socket/ancdata.c, ext/socket/init.c,
	* ext/zlib/zlib.c: ditto.

Mon May 13 18:44:14 2013  Koichi Sasada  <ko1@atdot.net>

	* *.c, parse.y, insns.def: use RARRAY_AREF/ASET macro
	  instead of using RARRAY_PTR().

Mon May 13 16:53:53 2013  Koichi Sasada  <ko1@atdot.net>

	* include/ruby/ruby.h: add new utility macros to access
	  Array's element.
	  * RARRAY_AREF(a, i) returns i-th element of an array `a'
	  * RARRAY_ASET(a, i, v) set i-th element of `a' to `v'
	  This change is a part of RGENGC branch [ruby-trunk - Feature #8339].

Mon May 13 15:31:10 2013  Koichi Sasada  <ko1@atdot.net>

	* object.c (rb_obj_setup): added.

	* include/ruby/ruby.h (OBJSETUP): use rb_obj_setup() instead of
	  a macro.

Mon May 13 15:24:16 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_data_object_alloc): check klass only if klass is not 0.
	  klass==0 means internal object.

Mon May 13 14:57:28 2013  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_data_object_alloc, rb_data_typed_object_alloc):
	  use NEWOBJ_OF() instead of NEWOBJ().

Mon May 13 14:51:59 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (rb_obj_singleton_method): new method Kernel#singleton_method
	  which returns a Method object of the singleton method.
	  non-singleton method causes NameError, but not aliased or zsuper
	  method, right now.
	  [ruby-core:54914] [Feature #8391]

	* vm_method.c (rb_method_entry_at): return the method entry for id at
	  klass, without ancestors.

	* class.c (rb_singleton_class_get): get the singleton class if exists,
	  or nil.

Mon May 13 10:20:59 2013  Yuki Yugui Sonoda  <yugui@google.com>

	* ext/openssl/ossl_ssl.c: Disabled OpenSSL::SSL::SSLSocket if
	  defined(OPENSSL_NO_SOCK).

	  This fixes a linkage error on platforms which do not have socket.
	  OpenSSL itself is still useful as a set of cryptographic functions
	  even on such platforms.

Mon May 13 10:30:04 2013  Zachary Scott  <zachary@zacharyscott.net>

	* hash.c: Hash[] and {} are not equivalent by @eam [Fixes GH-301]

Mon May 13 10:04:22 2013  Zachary Scott  <zachary@zacharyscott.net>

	* random.c: Document Random::DEFAULT by @eLobato [Fixes GH-304]

Sun May 12 21:12:42 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (OFFT2NUM): RUBY_REPLACE_TYPE also defines macro
	  to convert int type to VALUE if found.

Wed May  8 13:46:52 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h (rb_iv_set, rb_iv_get): removed. Because
	  ruby.h has a declaration for that.

Wed May  8 13:49:06 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h (rb_uint2big, rb_int2big, rb_uint2inum)
	(rb_int2inum, rb_ll2inum, rb_ull2inum): removed because ruby.h
	  has a declaration for these.

Sun May 12 17:52:23 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: removes 'ac_cv_func_fseeko=yes' form MinGW
	  specific definitions.

Sun May 12 17:25:46 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (rb_file_s_truncate): use correct type. chsize takes
	  a long.

Sun May 12 17:18:46 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c: move '#define HAVE_SPAWNV 1' to win32/Makefile.sub.
	* win32/Makefile.sub: see above.

Sun May 12 17:13:32 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: removes AC_CHECK_FUNCS(setitimer) because it's
	  unused.

Sun May 12 17:08:16 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: removes AC_CHECK_FUNCS(pause) because it's unused.

Sun May 12 17:05:18 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (rb_f_kill): fixes typo. s/HAS_KILLPG/HAVE_KILLPG/.

Sun May 12 17:03:27 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: abort if gettimeofday doesn't exist.

Sun May 12 16:31:27 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: adds RUBY_REPLACE_TYPE(off_t) for creating
	  NUM2OFFT.
	* file.c (rb_file_truncate): use correct type. chsize() take
	  a long.
	* include/ruby/ruby.h (NUM2OFFT): use a definition created by
	  a configure script by default.

Sun May 12 16:03:41 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: removes AC_CHECK_FUNC(fseeko, fseeko64, ftello,
	  ftello64). They are not used from anywhere.

	* win32/win32.c (fseeko): removes.
	* win32/win32.c (rb_w32_ftello): removes.
	* include/ruby/win32.h: removes declarations of rb_w32_ftello and
	  rb_w32_fseeko.
	* win32/Makefile.sub: removes '#define HAVE_FTELLO 1'.

Sun May 12 15:51:47 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: remove AC_CHECK_FUNC(close). It is not used from
	  anywhere.

Sun May 12 15:50:45 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: adds comments for setjmp check.

Sun May 12 15:38:09 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: move clock_gettime() check into regular place.

Wed May  8 13:45:53 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: add getenv() declaration check.
	* dln_find.c: add HAVE_DECL_GETENV test.

Sun May 12 15:33:18 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: sorts AC_CHECK_FUNCS()s as alphabetical order.

Wed May  8 13:41:57 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* bignum.c: remove redundant decl for big_lshift() big_rshift().

Sun May 12 16:06:43 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/socket/rubysocket.h (rsock_inspect_sockaddr): as r40646
	  check HAVE_TYPE_STRUCT_SOCKADDR_DL.

Sat May 11 23:01:58 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/socket/rubysocket.h (HAVE_TYPE_STRUCT_SOCKADDR_DL):
	  MSVC has struct sockaddr_dl, but its content is broken.
	  http://ruby-mswin.cloudapp.net/vc10-x64/ruby-trunk/log/20130511T103938Z.log.html.gz

Sat May 11 22:07:42 2013  Tanaka Akira  <akr@fsij.org>

	* test/rinda/test_rinda.rb: Socket.getifaddrs may returns an interface
	  which #addr method returns nil for venet0 in OpenVZ.

Sat May 11 21:56:34 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (rsock_inspect_sockaddr): Add casts to
	  suppress warnings.

Sat May 11 17:28:51 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket: New method, Socket.getifaddrs, implemented.
	  [ruby-core:54777] [Feature #8368]

Sat May 11 00:47:22 2013  Tanaka Akira  <akr@fsij.org>

	* gc.h (SET_MACHINE_STACK_END): Add !defined(_ILP32) to a defining
	  condition to avoid compilation error on x32.
	  https://sites.google.com/site/x32abi/

Fri May 10 23:56:34 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_peek_variable_name): treat invalid global, class,
	  and instance variable names as mere strings rather than errors.
	  [ruby-core:54885] [Bug #8375]

Fri May 10 20:22:40 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Move library checks into "Checks for libraries." part.

Fri May 10 19:32:01 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Reformat arguments of AC_CHECK_HEADERS and
	  AC_CHECK_FUNCS to track modifications easily.

Fri May 10 12:01:36 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Don't link librt if clock_gettime is available in
	  the main C library.
	  glibc 2.17 moves clock_* from librt to the main C library.
	  http://sourceware.org/ml/libc-announce/2012/msg00001.html

Thu May  9 22:00:35 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_sendmsg_internal): controls_num should
	  not be negative.

Thu May  9 21:09:57 2013  Tanaka Akira  <akr@fsij.org>

	* file.c, ext/etc/etc.c, ext/socket/unixsocket.c,
	  ext/openssl/ossl.h, ext/openssl/openssl_missing.c: Use
	  HAVE_AGGREGATE_MEMBER instead of HAVE_ST_MEMBER.

Thu May  9 20:43:41 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_sendmsg_internal): Always set
	  controls_num to raise NotImplementedError appropriately.
	  (bsock_recvmsg_internal): Raise NotImplementedError if
	  :scm_rights=>true is given on platforms which don't have
	  4.4BSD style control message.

Thu May  9 12:06:07 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h, ext/socket/unixsocket.c,
	  ext/socket/ancdata.c: Use HAVE_STRUCT_MSGHDR_MSG_CONTROL instead
	  of HAVE_ST_MSG_CONTROL.

Thu May  9 11:30:02 2013  Zachary Scott	 <zachary@zacharyscott.net>

	* string.c: Add call-seq alias for String#=== [Bug #8381]

Thu May  9 11:14:18 2013  Zachary Scott	 <zachary@zacharyscott.net>

	* doc/contributing.rdoc: Add guide for contributing to CRuby

Thu May  9 04:55:49 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Check socket library again.  shutdown() is used in
	  io.c.

Thu May  9 01:52:31 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Don't check socketpair.  socketpair is not used in
	  ruby command itself.

Thu May  9 01:05:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_mod_included_modules): should not include non-modules.
	  [ruby-core:53158] [Bug #8025]

Wed May  8 22:46:59 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_mod_included_modules): should not include the original
	  module itself.  [ruby-core:53158] [Bug #8025]

Wed May  8 17:43:55 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ext_int_to_encs): ignore internal encoding if external
	  encoding is ASCII-8BIT. [Bug #8342]

Wed May  8 13:49:38 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/generator/generator.c (isArrayOrObject): cast char to
	  unsigned char. [Bug #8378]

Wed May  8 13:46:10 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/generator/depend: fix dependencies [Bug #8379]

	* ext/json/parser/depend: ditto.

Wed May  8 13:07:17 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): fail if $, @, @@ are not followed by a valid
	  name character.  [ruby-core:54846] [Bug #8375].

Wed May  8 13:06:31 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ISGRAPH): add missing macro.

Wed May  8 06:42:56 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/socket/socket.c (socket_s_ip_address_list): fix wrongly filled
	  sin6_scope_id on KAME introduced by r40593 for OpenIndiana.
	  KAME uses fe80:<scope_id>::<interface id> for link-local address
	  internally.
	  Setting sin6_scope_id causes it leaked.
	  see also comments of sockaddr_obj().

Tue May  7 22:12:34 2013  Tanaka Akira  <akr@fsij.org>

	* ext/readline/readline.c (insert_ignore_escape): Add a cast to
	  unsigned char * before dereference.
	  This suppress a warning on Cygwin.

Tue May  7 12:15:24 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (bsock_recvmsg_internal): Add a cast to
	  suppress warning.
	  Bionic defines socklen_t as int.
	  Bionic defines msg_controllen as unsigned int (__kernel_size_t)
	  instead of socklen_t as POSIX.

Tue May  7 12:12:42 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (ancillary_inspect): Don't call
	  anc_inspect_ipv6_pktinfo if !HAVE_TYPE_STRUCT_IN6_PKTINFO.
	  anc_inspect_ipv6_pktinfo is not defined in the case.

Tue May  7 12:10:52 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (socket_s_ip_address_list): Cast EXTRA_SPACE as
	  int.  This suppress a warning.

Tue May  7 12:09:29 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Set close_fds false for Cygwin.
	  Cygwin doesn't support fd passing.
	  This enables socket extension library cross-compilable by default.

Tue May  7 12:07:35 2013  Tanaka Akira  <akr@fsij.org>

	* pack.c (swap32): Don't redefine it if it is already defined.
	  Bionic defines it.
	  (swap64): Ditto.

Mon May  6 20:50:37 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (socket_s_ip_address_list): Fill sin6_scope_id
	  if getifaddrs() returns an IPv6 link local address which
	  sin6_scope_id is zero, such as on OpenIndiana SunOS 5.11.

Sun May  5 18:56:52 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defined): use vm_search_superclass() like as normal super
	  call.  based on a patch <https://gist.github.com/wanabe/5520026> by
	  wanabe.

	* vm_insnhelper.c (vm_search_superclass): return error but not raise
	  exceptions.

	* vm_insnhelper.c (vm_search_super_method): check the result of
	  vm_search_superclass and raise exceptions on error.

Sun May  5 16:29:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defined): get method entry from the method top level
	  frame, not block frame.  [ruby-core:54769] [Bug #8367]

Sun May  5 13:28:54 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in (Cflags): use rubyarchhdrdir for multiarch.
	  [Bug #7874]

Sat May  4 07:20:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* doc/security.rdoc: Add note about reporting security vulns

Sat May  4 04:13:27 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/defines.h (RUBY_ATTR_ALLOC_SIZE): New for
	  attribute((alloc_size(params))).

	* include/ruby/defines.h (xmalloc, xmalloc2, xcalloc)
	(xrealloc, xrealloc2): Annotated by RUBY_ATTR_ALLOC_SIZE.
	* include/ruby/ruby.h (rb_alloc_tmp_buffer): ditto.

Fri May  3 19:32:13 2013  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/util.rb: All class methods modulized.
	  We can use these methods like a function when "include CGI::Util".
	  [Feature #8354]

Fri May  3 14:09:45 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Make default_ipv6 true for Cygwin.
	  Cygwin supports IPv6 since Cygwin 1.7.1 (2009-12).
	  http://cygwin.com/ml/cygwin-announce/2009-12/msg00027.html

Fri May  3 13:35:26 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/{getaddrinfo,getnameinfo}.c: define socklen_t if not
	  defined, e.g., older VC.

Fri May  3 13:29:11 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (INTPTR_MAX, INTPTR_MIN, UINTPTR_MAX): also
	  should be defined when defining intptr_t and uintptr_t.
	  bigdecimal.c requires the former two now.

Fri May  3 13:22:12 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (poll_child_status): fix build error on older mingw.

Fri May  3 00:15:58 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* common.mk: remove timestamps in distclean-ext realclean-ext.

Thu May  2 23:23:49 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_obj_is_kind_of): skip prepending modules.
	  [ruby-core:54742] [Bug #8357]

	* object.c (rb_class_inherited_p): ditto.
	  [ruby-core:54736] [Bug #8357]

Thu May  2 22:11:47 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bin/irb: remove dead code from sample/irb.rb.

Thu May  2 17:32:45 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (copy_ivar_i): get rid of overwriting already copied
	  instance variables.  c.f. [Bug #8276]

Thu May  2 16:55:43 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (id_locals): use cached ID.

	* vm.c (ruby_thread_init): ditto.

	* defs/id.def: add more predefined IDs used in core.

Thu May  2 13:42:42 2013  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*: Imported minitest 4.7.4 (r8483)
	* test/minitest/*: ditto

Thu May  2 11:32:22 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (poll_child_status): [experimental] set the cause of
	  a child's death to status if its exitcode seems to be an error.

	* test/ruby/test_process.rb (TestProcess#test_no_curdir): maybe now
	  we can test it.

	* test/ruby/test_thread.rb (TestThread#test_thread_timer_and_interrupt):
	  ditto.

Thu May  2 11:24:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/yaml.rb: nodoc EngineManager, add History doc #8344

Wed May  1 21:11:17 2013  Tanaka Akira  <akr@fsij.org>

	* time.c (localtime_with_gmtoff_zone): musl libc may return NULL for
	  tm_zone.

Wed May  1 18:59:36 2013  Benoit Daloze  <eregontp@gmail.com>

	* enum.c (Enumerable#chunk): fix grammar of error message
	  for symbols beginning with an underscore [Bug #8351]

Wed May  1 16:47:47 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/curses/extconf.rb (curses_version): try once for each tests, a
	  function or a variable.  fallback to variable for old SVR4.

Wed May  1 16:17:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extmake): extensions not to be installed should not
	  make static libraries, but make dynamic libraries always.

Wed May  1 12:20:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/rake/version.rb: Fix RDoc warning with  :include: [Bug #8347]

Wed May  1 11:40:25 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* defs/id.def (predefined): add "idProc".

	* eval.c (frame_func_id): use predefined IDs.

	* proc.c (mnew, mproc, mlambda): use predefined IDs.

	* vm.c (rb_vm_control_frame_id_and_class): ditto.

	* vm.c (Init_VM): ditto.

Tue Apr 30 23:18:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/benchmark.rb: Update Benchmark results on newer CPU

Tue Apr 30 12:31:40 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (mproc, mlambda): use frozen core methods instead of plain
	  global methods, so that methods cannot be overridden.
	  [ruby-core:54687] [Bug #8345]

	* vm.c (Init_VM): define proc and lambda on the frozen core object.

	* include/ruby/intern.h (rb_block_lambda): add declaration instead of
	  deprecated rb_f_lambda.

Mon Apr 29 17:02:30 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.h: Bionic libc doesn't have locale.
	  [Feature #8338]


Mon Apr 29 06:58:30 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_bn.c (ossl_bn_initialize): no need of alloca for
	  small fixed size array.

	* ext/openssl/ossl_bn.c (ossl_bn_initialize): check overflow first,
	  and use alloca for small size input.

Mon Apr 29 00:40:13 2013  Benoit Daloze  <eregontp@gmail.com>

	* lib/yaml.rb: Clarify documentation about YAML being always Psych.
	  Give a tip about using Syck. See #8344.

Sun Apr 28 23:34:01 2013  Benoit Daloze  <eregontp@gmail.com>

	* lib/yaml.rb: Use another trick to define the YAML module.
	  https://twitter.com/n0kada/status/328342207511801856

Sun Apr 28 23:19:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/pp.rb: Update PP module overview by @geopet

Sun Apr 28 22:04:37 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* ext/openssl/ossl_bn.c (ossl_bn_initialize): fix buffer overflow on
	  x64 Windows and memory leak when initializing with integer.
	  [ruby-core:54615] [Bug #8337]

Sun Apr 28 12:38:04 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT: correct method name to be used.  [Bug #7982]

	* README.EXT.ja: add notes too.

Sun Apr 28 10:35:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* object.c: With feedback from Steve Klabnik, reverted a change to
	  #untrusted? and #tainted?. Also adjusted grammar for $SAFE levels

Sun Apr 28 10:10:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/yaml.rb: Disable setting YAML const twice [ruby-core:54642]

Sun Apr 28 09:50:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* object.c: Documentation for taint and trust [Bug #8162]

Sun Apr 28 09:40:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* README.EXT: Copy note from r40505 for rb_sprintf() [Bug #7982]

Sun Apr 28 08:28:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/curses/curses.c: Update Curses::Window example for nicer output
	  Patch by Michal Suchanek [Bug #8121] [ruby-core:53520]

Sun Apr 28 08:10:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* README.EXT: Update note from r40504, by Jeremy Evans [Bug #7982]

Sun Apr 28 08:02:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* README.EXT: Add note to warn use of %i in Exceptions [Bug #7982]

Sun Apr 28 02:41:05 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Fix a typo.  Should check endgrent() instead of
	  endgrnam().

Sun Apr 28 00:35:45 2013  Tanaka Akira  <akr@fsij.org>

	* process.c (obj2gid): Don't call endgrent() if not exist.
	  Bionic (Android's libc) don't have endgrent().

	* configure.in: Check endgrnam function.

Sat Apr 27 23:53:00 2013  Charlie Somerville  <charlie@charliesomerville.com>

	* lib/yaml.rb: add security warning to YAML documentation

Sat Apr 27 23:25:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/yaml.rb: Documentation for YAML module [Bug #8213]

Sat Apr 27 20:19:21 2013  Tanaka Akira  <akr@fsij.org>

	* thread_pthread.c (ruby_init_stack): Add STACK_GROW_DIR_DETECTION.
	  This fixes a compilation failure while cross-compiling for Tensilica
	  Xtensa Processor.

Sat Apr 27 19:32:44 2013  Benoit Daloze  <eregontp@gmail.com>

	* thread.c: fix typos and documentation

Sat Apr 27 19:04:55 2013  Tanaka Akira  <akr@fsij.org>

	* sparc.c: Use __asm__ instead of asm for gcc.
	  gcc doesn't provide asm keyword if -ansi option is given.
	  http://gcc.gnu.org/onlinedocs/gcc/Alternate-Keywords.html

Sat Apr 27 17:22:50 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Redundant test removed.

Sat Apr 27 16:00:10 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb (test_recvmsg_with_msg_peek_creates_fds):
	  Extracted.

Sat Apr 27 15:50:40 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (SIGNED_INTEGER_TYPE_P): New macro.
	  (SIGNED_INTEGER_MAX): Ditto.
	  (SIGNED_INTEGER_MIN): Ditto.
	  (UNSIGNED_INTEGER_MAX): Ditto.
	  (TIMET_MAX): Use SIGNED_INTEGER_MAX and UNSIGNED_INTEGER_MAX.
	  (TIMET_MIN): Use SIGNED_INTEGER_MIN.

	* thread.c (TIMEVAL_SEC_MAX): Use SIGNED_INTEGER_MAX.
	  (TIMEVAL_SEC_MIN): Use SIGNED_INTEGER_MIN.

Sat Apr 27 10:52:52 2013  Tanaka Akira  <akr@fsij.org>

	* thread.c (TIMEVAL_SEC_MAX, TIMEVAL_SEC_MIN): Consider environments,
	  sizeof(time_t) is smaller than sizeof(tv_sec), such as
	  OpenBSD 5.2 (amd64).

Fri Apr 26 23:34:59 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/text.rb (REXML::Text.normalize): Fix a bug that all
	  entity filters are ignored. [ruby-dev:47278] [Bug #8302]
	  Patch by Ippei Obayashi. Thanks!!!
	* test/rexml/test_entity.rb (EntityTester#test_entity_filter): Add
	  a test of the above change.

Fri Apr 26 22:53:55 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/element.rb (REXML::Attributes#to_a): Support
	  namespaced attributes. [ruby-dev:47277] [Bug #8301]
	  Patch by Ippei Obayashi. Thanks!!!
	* test/rexml/test_attributes.rb
	  (AttributesTester#test_to_a_with_namespaces): Add a test of the
	  above change.

Fri Apr 26 21:48:29 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/atom.rb (RSS::Atom::Entry): Fix indent of document comment.

Fri Apr 26 21:21:17 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rss/maker.rb (RSS::Maker): Fix indent of document comment.

Fri Apr 26 18:41:04 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Use a block of enable_config() for
	  --{enable,disable}-close-fds-by-recvmsg-with-peek configure option

Fri Apr 26 18:08:08 2013  Tanaka Akira  <akr@fsij.org>

	* dir.c (dir_set_pos): Fix a compilation error when seekdir() is not
	  exist.

Fri Apr 26 17:41:17 2013  Tanaka Akira  <akr@fsij.org>

	* thread_pthread.c (ruby_init_stack): Add STACK_GROW_DIR_DETECTION.
	  This fixes a compilation failure while cross-compiling for ARM.

Fri Apr 26 14:35:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/rss/atom.rb: Documentation for RSS::Atom based on a patch by
	  Michael Denomy
	* lib/rss/maker.rb: Documentation for RSS::Maker also by @mdenomy

Fri Apr 26 12:41:22 2013  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: Test linkability of curses_version at first.

	* ext/socket/extconf.rb: Test the behavior of fd passing with MSG_PEEK
	  only if recvmsg(), msg_control member, AF_UNIX and SCM_RIGHTS are
	  available.

Fri Apr 26 00:07:52 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* lib/rinda/ring.rb (Rinda::RingServer#initialize): accept array
	  arguments of address to specify multicast interface.

	* lib/rinda/ring.rb (Rinda::RingServer#make_socket): add optional
	  arguments for multicast interface.

	* test/rinda/test_rinda.rb
	  (TestRingFinger#test_ring_server_ipv4_multicast,
	   TestRingFinger#test_ring_server_ipv6_multicast): add tests for
	  above change.

	* test/rinda/test_rinda.rb
	  (TestRingServer#test_make_socket_ipv4_multicast,
	   TestRingServer#test_make_socket_ipv6_multicast): change bound
	  interface address because multicast address is not allowed on Linux
	  or Windows.
	  [ruby-core:53692] [Bug #8159]

Thu Apr 25 23:45:02 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* lib/rinda/ring.rb (Rinda::RingServer#initialize): add a socket
	  to @sockets in make_socket() to close sockets on shutdown even if
	  make_socket() is called after initialize.

	* lib/rinda/ring.rb (Rinda::RingServer#make_socket): ditto.

Thu Apr 25 23:39:42 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/rinda/test_rinda.rb (TupleSpaceProxyTest#test_take_bug_8215):
	  use KILL on Windows since TERM doen't work and ruby process remains
	  after test-all on Windows.

Thu Apr 25 23:16:28 2013  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: Implement
	  --with-curses-version={function,variable} configure option for
	  cross-compiling.

Thu Apr 25 18:15:46 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Don't use WIDE getaddrinfo by default.

Thu Apr 25 17:56:39 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Remove obsolete options: ---with-ipv6-lib and
	  --with-ipv6-libdir.

Thu Apr 25 17:43:49 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Implement
	  --{enable,disable}-close-fds-by-recvmsg-with-peek configure option
	  for cross-compiling.
	  Make --{enable,disable}-wide-getaddrinfo configure option
	  cross-compiling friendly.

Thu Apr 25 16:11:06 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_ext_int_to_encs, parse_mode_enc): bom-prefixed name is
	  not a real encoding name, just a fallback.  so the proper conversion
	  should take place even if if the internal encoding is equal to the
	  bom-prefixed name, unless actual encoding is equal to the internal
	  encoding.  [ruby-core:54563] [Bug #8323]

	* io.c (io_set_encoding_by_bom): reset extenal encoding if no BOM
	  found.  [ruby-core:54569]

Thu Apr 25 14:35:01 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (ossl_bn_initialize): allow Fixnum and Bignum.
	  [ruby-core:53986] [Feature #8217]

Thu Apr 25 14:26:32 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.decode_www_form): follow current URL Standard.
	  It gets encoding argument to specify the character encoding.
	  It now allows loose percent encoded strings, but denies ;-separator.
	  [ruby-core:53475] [Bug #8103]

	* lib/uri/common.rb (URI.decode_www_form): follow current URL Standard.
	  It gets encoding argument to convert before percent encode.
	  Now UTF-16 strings aren't converted to UTF-8 before percent encode
	  by default.

Wed Apr 25 14:26:00 2013  Charlie Somerville  <charlie@charliesomerville.com>

	* benchmark/bm_hash_shift.rb: add benchmark for Hash#shift

	* hash.c (rb_hash_shift): use st_shift if hash is not being iterated to
	  delete element without iterating the whole hash.

	* hash.c (shift_i): remove function

	* include/ruby/st.h (st_shift): add st_shift function

	* st.c (st_shift): ditto

	[Bug #8312] [ruby-core:54524] Patch by funny-falcon

Thu Apr 25 12:03:38 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Extract C programs as toplevel constants.

Thu Apr 25 02:23:28 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_RM_RECURSIVE): this hack is needed by only
	  autoconf 2.69 or earlier on darwin.

Thu Apr 25 01:22:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tracer.rb (get_line): simply read by File.readlines.

	* lib/debug.rb (script_lines): get source lines from SCRIPT_LINES__ or
	  read from the file.

	* lib/debug.rb (display_list): use script_lines instead of recursion.
	  [Bug #8318]

	* lib/debug.rb (line_at): use script_lines same as display_list.

	* lib/debug.rb (display_list): Fix debug listing when called from the
	  same file it has been required.  patch by Dario Bertini <berdario AT
	  gmail.com> [Bug #8318] [fix GH-280]

Wed Apr 24 21:51:13 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: Check mblen().
	  mblen() is optional in uClibc.

	* eval_intern.h (CharNext): Don't use mblen() is not available.

Wed Apr 24 15:55:06 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_fd_fix_cloexec): use rb_update_max_fd().

Wed Apr 24 14:08:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* numeric.c: Fix wiki link on Float imprecision in overview, patched
	  by Makoto Kishimoto [Bug #8304] [ruby-dev:47280]

Wed Apr 24 14:03:59 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): disallow $- without following identifier
	  character.  [ruby-talk:406969]

	* parse.y (is_special_global_name): mere $- is not a valid global
	  variable name.

Wed Apr 24 13:54:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* string.c: Document String#setbyte return value by @gjmurakami-10gen
	  [Fixes GH-294]

Wed Apr 24 13:45:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* class.c: Example of Object#methods by @windwiny [Fixes GH-293]
	* ruby.c: Document return values of Kernel #sub, #gsub, and #chop

Wed Apr 24 12:54:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/socket/lib/socket.rb: Doc typos by @vipulnsward [Fixes GH-292]


Wed Apr 24 12:54:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/socket/lib/socket.rb: Doc typos by @vipulnsward [Fixes GH-292]

Wed Apr 24 12:27:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c: Fix documentation for Array#index and #replace aliases
	  Based on a patch by @phiggins [Fixes GH-282]

Tue Apr 23 21:14:38 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): refix r40413, on Ruby 1.9 usual character
	  escape uses hex/Unicode escapes, so fix to use Unicode escape on
	  Unicode strings and hex on others. [ruby-core:54458] [Bug #8290]

Tue Apr 23 20:10:02 2013  Tanaka Akira  <akr@fsij.org>

	* missing/isnan.c (isnan): Don't define if isnan() macro is defined.
	  This fixes a compilation failure on uClibc based Gentoo system.

Tue Apr 23 17:40:40 2013  Martin Duerst <duerst@it.aoyama.ac.jp>

	* lib/rexml/document.rb, lib/rexml/element.rb,
	  lib/rexml/formatters/pretty.rb: remove opinionated
	  language in documentation. [Bug #8309],
	  reported by Charles Beckmann

Tue Apr 23 14:04:44 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (getacl_response): parse the mailbox of an ACL
	  response correctly.  [ruby-core:54365] [Bug #8281]

Tue Apr 23 11:58:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_scrub): fix for UTF-32.  strlen() on strings
	  contain NUL returns wrong result, use sizeof operator instead.
	  [ruby-dev:45975] [Feature #6752]

Tue Apr 23 10:26:50 2013  Akinori MUSHA  <knu@iDaemons.org>

	* test/ruby/test_module.rb
	  (TestModule#test_const_get_invalid_name)
	  (test_const_defined_invalid_name): Fix expected values.

Tue Apr 23 09:51:26 2013  Akinori MUSHA  <knu@iDaemons.org>

	* string.c (rb_str_inspect): NUL should not be represented as "\0"
	  when octal digits may follow.  [ruby-core:54458] [Bug #8290]

Mon Apr 22 22:54:00 2013  Charlie Somerville  <charlie@charliesomerville.com>

	* insns.def (opt_mod): Use % operator if both operands are positive for
	  a significant performance improvement. Thanks to @samsaffron.

Mon Apr 22 17:09:37 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): copy all instance variables not only generic
	  ivars, before calling post proc.  [ruby-core:51163] [Bug #7627]

Mon Apr 22 10:25:21 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_hdtoa): revert r29729.
	  If you want ruby to behave as before on x86, specify to use SSE like
	  -msse2 -mfpmath=sse for gcc.

Sun Apr 21 23:19:00 2013  Charlie Somerville  <charlie@charliesomerville.com>

	* configure.in: Revert using sigsetjmp by default due to performance
	  problems on some systems (eg. older Linux)

Sun Apr 21 21:35:00 2013  Charlie Somerville  <charlie@charliesomerville.com>

	* configure.in: Use sigsetjmp by default so jumping out of signal
	  handlers properly restores the signal mask and SS_ONSTACK flag.
	  [ruby-core:54175] [Bug #8254]

	* configure.in: Manually check for presence of sigsetjmp. It is not a
	  function on some systems, so AC_CHECK_FUNCS cannot be used.

Sun Apr 21 08:00:55 2013  Tanaka Akira  <akr@fsij.org>

	* test/csv/test_features.rb, test/logger/test_logger.rb
	  test/mkmf/test_have_macro.rb, test/net/http/test_http.rb,
	  test/openssl/test_config.rb, test/psych/test_encoding.rb,
	  test/psych/test_exception.rb, test/psych/test_psych.rb,
	  test/psych/test_tainted.rb, test/readline/test_readline.rb,
	  test/rexml/test_contrib.rb, test/ruby/test_autoload.rb,
	  test/ruby/test_beginendblock.rb, test/ruby/test_exception.rb,
	  test/ruby/test_file.rb, test/ruby/test_io.rb,
	  test/ruby/test_marshal.rb, test/ruby/test_process.rb,
	  test/ruby/test_require.rb, test/ruby/test_rubyoptions.rb,
	  test/syslog/test_syslog_logger.rb, test/webrick/test_httpauth.rb,
	  test/zlib/test_zlib.rb: Use Tempfile.create.

Sun Apr 21 00:15:36 2013  Tanaka Akira  <akr@fsij.org>

	* lib/tempfile.rb (Tempfile.create): Close when the block exits.

Sat Apr 20 23:38:14 2013  Tanaka Akira  <akr@fsij.org>

	* lib/webrick/httpauth/htpasswd.rb: Use Tempfile.create to avoid
	  unintentional unlink() by the finalizer.
	  lib/webrick/httpauth/htdigest.rb: Ditto.

Sat Apr 20 22:47:48 2013  Tanaka Akira  <akr@fsij.org>

	* lib/tempfile.rb (Tempfile.create): New method.
	  The method name is proposed by Shugo Maeda.  [ruby-dev:47220]
	  [ruby-core:41478] [Feature #5707]

Sat Apr 20 14:22:10 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object): dump no ivars to the original by marshal_dump.
	  [ruby-core:54334] [Bug #8276]

	* marshal.c (r_object0): copy all ivars of marshal_dump data to the
	  result object instead.  [ruby-core:51163] [Bug #7627]

Sat Apr 20 02:33:27 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_scrub): add ruby method String#scrub which verify and
	  fix invalid byte sequence. [ruby-dev:45975] [Feature #6752]

	* string.c (str_compat_and_valid): check given string is compatible
	  and valid with given encoding.

	* transcode.c (str_transcode0): If invalid: :replace is specified for
	  String#encode, replace invalid byte sequence even if the destination
	  encoding equals to the source encoding.

Fri Apr 19 21:55:40 2013  Kouhei Sutou  <kou@cozmixng.org>

	* README.EXT.ja (Data_Wrap_Struct): Remove a description about
	  orphan argument. Oh, I renamed the argument name without
	  changing description at r36180... Sorry....
	  Patch by Makoto Kishimoto. Thanks!!! [ruby-dev:47269] [Bug #8292]
	* README.EXT.ja (Data_Make_Struct): Add a sample code that describes
	  how it works.
	  Patch by Makoto Kishimoto. Thanks!!! [ruby-dev:47269] [Bug #8292]

Fri Apr 19 17:54:57 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (body_type_msg): should accept
	  message/delivery-status with extra data.
	  [ruby-core:53741] [Bug #8167]

	* test/net/imap/test_imap_response_parser.rb: related test.

Fri Apr 19 13:03:14 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_object): do not dump encoding which is dumped with
	  marshal_dump data.  [ruby-core:54334] [Bug #8276]

Fri Apr 19 11:36:53 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (stack_protector): control use of -fstack-protector.

	* configure.in (debugflags): let -fstack-protector precede and disable
	  debugflags, because they can't work together on SmartOS.  [Bug #8268]

Fri Apr 19 07:43:52 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/openssl/test_cipher.rb: Correct a typo
	  by jgls <joerg@joergleis.com>
	  https://github.com/ruby/ruby/pull/291 fix GH-291

Thu Apr 18 16:58:51 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_mod_public_method): fix visibility on anonymous
	  module. set visibility of singleton method, not method in base
	  class.  [ruby-core:54404] [Bug #8284]

Thu Apr 18 16:20:51 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_helper): should skip dot directories only for recursion,
	  but should not if matching to the given pattern.  [ruby-core:54387]
	  [Bug #8283]

Thu Apr 18 16:20:21 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (pack_unpack): increase buffer size to fix buffer overflow,
	  and fix garbage just after unpacking without missing paddings.
	  [Bug #8286]

Thu Apr 18 13:35:54 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_unpack): output characters even if the input doesn't
	  have paddings. [Bug #8286]

Thu Apr 18 08:20:48 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (clean-ext): remove timestamps.

Wed Apr 17 22:07:50 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (SOCKLEN_MAX): Expression simplified.

Wed Apr 17 20:09:19 2013  Aman Gupta  <ruby@tmm1.net>

	* compile.c (iseq_add_mark_object): Use new rb_iseq_add_mark_object().

	* insns.def (setinlinecache): Ditto.

	* iseq.c (rb_iseq_add_mark_object): New function to allocate
	  iseq->mark_ary on demand. [Bug #8142]

	* iseq.h (rb_iseq_add_mark_object): Ditto.

	* iseq.c (prepare_iseq_build): Avoid allocating mark_ary until needed.

	* iseq.c (rb_iseq_build_for_ruby2cext): Ditto.

Wed Apr 17 20:00:18 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (SOCKLEN_MAX): Defined.

	* ext/socket/raddrinfo.c (ext/socket/raddrinfo.c): Reject too long
	  Linux abstract socket name.

Wed Apr 17 19:45:27 2013  Aman Gupta  <tmm1@ruby-lang.org>

	* iseq.c (iseq_location_setup): re-use existing string when iseq has
	  the same path and absolute_path. [Bug #8149]

Wed Apr 17 11:38:37 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  UNASSIGNED is not a valid message.

Wed Apr 17 10:58:18 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (sleep_timeval): get rid of overflow on Windows where
	  timeval.tv_sec is not time_t but mere long.

Tue Apr 16 23:07:12 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/unixsocket.c (unix_send_io): Suppress a warning by clang.
	  (unix_recv_io): Ditto.

Tue Apr 16 12:27:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/sdbm/init.c: Fix comment indentation, by windwiny [Fixes GH-277]

Tue Apr 16 12:25:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/socket/option.c: Document synonymous methods, by windwiny [GH-277]
	* ext/stringio/stringio.c: ditto
	* ext/io/wait/wait.c: ditto
	* ext/gdbm/gdbm.c: ditto
	* ext/dl/cfunc.c: ditto
	* ext/zlib/zlib.c: ditto
	* ext/win32ole/win32ole.c: ditto
	* ext/dbm/dbm.c: ditto
	* ext/json/generator/generator.c: ditto
	* ext/date/date_core.c: ditto

Tue Apr 16 11:23:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/openssl/*: Document synonymous methods, by windwiny [GH-277]

Mon Apr 15 22:21:42 2013  Tanaka Akira  <akr@fsij.org>

	* ext/fiddle/depend: New file.

Mon Apr 15 22:01:02 2013  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-electric.el (ruby-electric-insert): Check
	  ruby-electric-is-last-command-char-expandable-punct-p here.

	* misc/ruby-electric.el (ruby-electric-closing-char): New
	  interactive function bound to closing characters.  Typing one of
	  those closing characters right after the matching counterpart
	  cancels the effect of automatic closing.  For example, typing
	  "{" followed by "}" simply makes "{}" instead of "{ } }".

Mon Apr 15 12:54:42 2013  Martin Bosslet  <Martin.Bosslet@gmail.com>

	* ext/openssl/ossl_ssl.c: Correct shutdown behavior w.r.t GC.

	* test/openssl/test_ssl.rb: Add tests to verify correct behavior.

	[Bug #8240] Patch provided by Shugo Maeda. Thanks!

Mon Apr 15 10:23:39 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/coverage/depend: fix id.h place as r40283.

	* ext/coverage/extconf.rb: add topdir and topsrcdir to VPATH.

Sun Apr 14 19:46:14 2013  Tanaka Akira  <akr@fsij.org>

	* ext/-test-/debug/depend: New file.

	* ext/-test-/exception/depend: Ditto.

	* ext/-test-/printf/depend: Ditto.

	* ext/-test-/string/depend: Ditto.

	* ext/coverage/depend: Ditto.

	* ext/io/console/depend: Ditto.

	* ext/io/nonblock/depend: Ditto.

	* ext/io/wait/depend: Ditto.

	* ext/openssl/depend: Ditto.

	* ext/pathname/depend: Ditto.

	* ext/psych/depend: Ditto.

	* ext/zlib/depend: Ditto.

Sun Apr 14 02:46:50 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#create_makefile): remove {$(VPATH)} other
	  than nmake.

	* ext/ripper/depend: use VPATH expecting removed by above.

Sat Apr 13 23:06:20 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (timestamp_file): gather timestamp files in one
	  directory from each extension directories.

Sat Apr 13 21:09:02 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#create_makefile): output new macro
	  disthdrdir to specify the path of id.h, parse.h and etc.

	* ext/ripper/depend: use above macro.

Sat Apr 13 20:28:08 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* Merge Onigmo 5.13.4 f22cf2e566712cace60d17f84d63119d7c5764ee.
	  [bug] fix problem with optimization of \z (Issue #16) [Bug #8210]

Sat Apr 13 18:56:15 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/ripper/depend: parse.h and id.h may be created on topdir.

Sat Apr 13 12:08:16 2013  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Add Vector#cross_product, patch by Luis Ezcurdia
	  [fix GH-276] [rubyspec:81eec89a124]

Sat Apr 13 10:20:37 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* struct.c (rb_struct_define_without_accessor, rb_struct_define),
	  (rb_struct_s_def): hide member names array.

	* struct.c (anonymous_struct, new_struct, setup_struct): split
	  make_struct() for each purpose.

Sat Apr 13 09:34:31 2013  Tanaka Akira  <akr@fsij.org>

	* lib/mkmf.rb: Add ruby/ruby.h, ruby/missing.h, ruby/intern.h,
	  ruby/st.h and ruby/subst.h for ruby_headers in generated Makefile.

	* ext/-test-/old_thread_select/depend: Update dependencies.

	* ext/-test-/wait_for_single_fd/depend: Ditto.

	* ext/bigdecimal/depend: Ditto.

	* ext/curses/depend: Ditto.

	* ext/digest/bubblebabble/depend: Ditto.

	* ext/digest/depend: Ditto.

	* ext/digest/md5/depend: Ditto.

	* ext/digest/rmd160/depend: Ditto.

	* ext/digest/sha1/depend: Ditto.

	* ext/digest/sha2/depend: Ditto.

	* ext/dl/callback/depend: Ditto.

	* ext/dl/depend: Ditto.

	* ext/etc/depend: Ditto.

	* ext/nkf/depend: Ditto.

	* ext/objspace/depend: Ditto.

	* ext/pty/depend: Ditto.

	* ext/readline/depend: Ditto.

	* ext/ripper/depend: Ditto.

	* ext/sdbm/depend: Ditto.

	* ext/socket/depend: Ditto.

	* ext/stringio/depend: Ditto.

	* ext/strscan/depend: Ditto.

	* ext/syslog/depend: Ditto.

	* ext/-test-/num2int/depend: Removed.

	* ext/dbm/depend: Ditto.

	* ext/fcntl/depend: Ditto.

	* ext/gdbm/depend: Ditto.

	* ext/racc/cparse/depend: Ditto.

Sat Apr 13 00:15:54 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (Init_etc): move Passwd and Group under Etc namespace
	  as primary names.

Fri Apr 12 21:06:55 2013  Tanaka Akira  <akr@fsij.org>

	* common.mk: pack.o depends on internal.h.

Fri Apr 12 20:59:24 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (ones): Use __builtin_popcountl if available.

	* internal.h (GCC_VERSION_SINCE): Macro moved from pack.c.

	* pack.c: Include internal.h for GCC_VERSION_SINCE.

Fri Apr 12 18:29:42 2013  Tanaka Akira  <akr@fsij.org>

	* common.mk: version.o depends on $(srcdir)/include/ruby/version.h
	  instead of {$(VPATH)}version.h to avoid confusion by VPATH between
	  top level version.h and include/ruby/version.h for build in-place.
	  [ruby-dev:47249] [Bug #8256]

Fri Apr 12 15:21:24 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_callee_setup_keyword_arg): non-symbol key is not
	  a keyword argument, keep it as a positional argument.

Fri Apr 12 11:58:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c: Document synonymous methods, by windwiny [GH-277]
	* bignum.c: ditto
	* complex.c: ditto
	* dir.c: ditto
	* encoding.c: ditto
	* enumerator.c: ditto
	* numeric.c: ditto
	* proc.c: ditto
	* re.c: ditto
	* string.c: ditto

Thu Apr 11 23:41:46 2013  Tanaka Akira  <akr@fsij.org>

	* common.mk: Add dependencies for include/ruby.h

	* tool/update-deps: Use "make -p all miniruby ruby golf" to extract
	  dependencies in makefiles.

Thu Apr 11 23:21:17 2013  Tanaka Akira  <akr@fsij.org>

	* tool/update-deps: Use "make -p all golf" to extract dependencies in
	  makefiles.

Thu Apr 11 21:02:19 2013  Tanaka Akira  <akr@fsij.org>

	* common.mk: Dependency updated.

	* tool/update-deps: Rewritten.

Thu Apr 11 19:59:48 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk: partially revert r40183, which breaks building on
	  other than source directory. (its commit log also says the same
	  thing, but such failure is not reproducible on my environment
	  and the commit breaks build on my environment)

Thu Apr 11 16:10:01 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/fiddle/closure.c (USE_FFI_CLOSURE_ALLOC): define 0 on
	  Mac OS X and Linux [Bug #3371]

Thu Apr 11 13:19:22 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/drb/drbtest.rb (Drb{Core,Ary}#teardown): retry Process.kill
	  if it fails with Errno::EPERM on Windows (workaround).
	  [ruby-dev:47245] [Bug #8251]

Thu Apr 11 11:11:38 2013  Akinori MUSHA  <knu@iDaemons.org>

	* dir.c: Fix a typo.

Thu Apr 11 10:39:34 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/fiddle/closure.c (USE_FFI_CLOSURE_ALLOC): add missing case:
	  RUBY_LIBFFI_MODVERSION is not defined (usually on Windows).

Thu Apr 11 09:27:04 2013  Konstantin Haase  <me@rkh.im>

	* dir.c (file_s_fnmatch): Document File::FNM_EXTGLOB flag.

Thu Apr 11 09:17:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* README: Fix typo by Benjamin Winkler [Fixes GH-281]

Thu Apr 11 06:15:51 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* regint.h: fix typo: _M_AMD86 -> _M_AMD64.

	* siphash.c: ditto.

	* st.c: ditto.

Thu Apr 11 06:09:57 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/fiddle/extconf.rb: define RUBY_LIBFFI_MODVERSION macro.

	* ext/fiddle/closure.c (USE_FFI_CLOSURE_ALLOC): define 0 or 1
	  with platform and libffi's version. [Bug #3371]

Thu Apr 11 05:30:43 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/mkmf.rb (pkg_config): Add optional argument "option".
	  If it is given, it returns the result of
	  `pkg-config --<option> <pkgname>`.

Thu Apr 11 03:33:05 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/fiddle/closure.c (initialize): check mprotect's return value.
	  If mprotect is failed because of PaX or something, its function call
	  will cause SEGV.
	  http://c5664.rubyci.org/~chkbuild/ruby-trunk/log/20130401T210301Z.diff.html.gz

Wed Apr 10 17:39:13 2013  Tanaka Akira  <akr@fsij.org>

	* ext/bigdecimal/bigdecimal.c (VpCtoV): Initialize a local variable
	  even when overflow.

Wed Apr 10 12:32:37 2013  Tanaka Akira  <akr@fsij.org>

	* bignum.c (rb_ll2big): Don't overflow on signed integer negation.

	* ext/bigdecimal/bigdecimal.c (MUL_OVERFLOW_SIGNED_VALUE_P): New
	  macro.
	  (AddExponent): Don't overflow on signed integer multiplication.
	  (VpCtoV): Don't overflow on signed integer arithmetic.
	  (VpCtoV): Don't overflow on signed integer arithmetic.

Wed Apr 10 06:32:12 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (MUL_OVERFLOW_INT_P): New macro.

	* sprintf.c (GETNUM): Don't overflow on signed integer multiplication.

Tue Apr  9 20:38:20 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (MUL_OVERFLOW_SIGNED_INTEGER_P): New macro.
	  (MUL_OVERFLOW_FIXNUM_P): Ditto.
	  (MUL_OVERFLOW_LONG_P): Ditto.

	* array.c (rb_ary_product): Don't overflow on signed integer
	  multiplication.

	* numeric.c (fix_mul): Ditto.
	  (int_pow): Ditto.

	* rational.c (f_imul): Ditto.

	* insns.def (opt_mult): Ditto.

	* thread.c (sleep_timeval): Don't overflow on signed integer addition.

	* bignum.c (rb_int2big): Don't overflow on signed integer negation.
	  (rb_big2ulong): Ditto.
	  (rb_big2long): Ditto.
	  (rb_big2ull): Ditto.
	  (rb_big2ll): Ditto.

Tue Apr  9 19:45:44 2013  Tanaka Akira  <akr@fsij.org>

	* lib/open-uri.rb: Support multiple fields with same field
	  name (like Set-Cookie).
	  (OpenURI::Meta#metas): New accessor to obtain fields as a Hash from
	  field name (string) to field values (array of strings).
	  [ruby-core:37734] [Bug #4964] reported by ren li.

Tue Apr  9 15:26:12 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): append keyword hash to argument array
	  to splat if needed.  [ruby-core:54094] [Bug #8236]

Tue Apr  9 10:02:39 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (timestamp_file): gather timestamp files in one
	  directory from each extension directories, with considering
	  target_prefix.

Tue Apr  9 04:57:59 JST 2013  Charles Oliver Nutter  <headius@headius.com>

	* error.c: Capture EAGAIN, EWOULDBLOCK, EINPROGRESS exceptions and
	  export them for use in WaitReadable/Writable exceptions.
	* io.c: Create versions of EAGAIN, EWOULDBLOCK, EINPROGRESS that
	  include WaitReadable and WaitWritable. Add rb_readwrite_sys_fail
	  for nonblocking failures using those exceptions. Use that
	  function in io_getpartial and io_write_nonblock instead of
	  rb_mod_sys_fail
	* ext/openssl/ossl_ssl.c: Add new SSLError subclasses that include
	  WaitReadable and WaitWritable. Use those classes for
	  write_would_block and read_would_block instead of rb_mod_sys_fail.
	* ext/socket/ancdata.c: Use rb_readwrite_sys_fail instead of
	  rb_mod_sys_fail in bsock_sendmsg_internal and
	  bsock_recvmsg_internal.
	* ext/socket/init.c: Use rb_readwrite_sys_fail instead of
	  rb_mod_sys_fail in rsock_s_recvfrom_nonblock and
	  rsock_s_connect_nonblock.
	* ext/socket/socket.c: Use rb_readwrite_sys_fail instead of
	  rb_mod_sys_fail in sock_connect_nonblock.
	* include/ruby/ruby.h: Export rb_readwrite_sys_fail for use instead
	  of rb_mod_sys_fail. Introduce new constants RB_IO_WAIT_READABLE and
	  RB_IO_WAIT_WRITABLE for first arg to rb_readwrite_sys_fail.

Tue Apr  9 02:44:32 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/extconf.rb: $defs needs -D or -U.  nothing is added
	  otherwize.

	* ext/socket/extconf.rb: check struct in_addr6, which is defined in
	  VC6 instead of in6_addr.

	* ext/socket/option.c (optname_to_sym): fix macro name.

	* ext/socket/constants.c (rsock_cmsg_type_arg): fix macro name.

Mon Apr  8 23:57:21 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (id_for_setter): extract common code from const, class
	  variable, instance variable setters.

Mon Apr  8 23:55:53 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/depend (ENCOBJS, TRANSOBJS): use explicit path to ruby.h for
	  nmake.

	* ext/depend (ENCOBJS, TRANSOBJS): fix header dependency, VPATH has
	  $(srcdir)/include/ruby but not $(srcdir)/include, so cannot find out
	  ruby/ruby.h.  use ruby.h instead and ../ruby for include/ruby.h.

Mon Apr  8 20:30:37 2013  Yuki Yugui Sonoda  <yugui@google.com>

	* ext/depend (ENCOBJS, TRANSOBJS): Add missing dependencies.

Mon Apr  8 17:19:28 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/win32ole/win32ole.c (fole_missing): should check actual argument
	  count before accessing.

Mon Apr  8 16:03:55 2013  Yuki Yugui Sonoda  <yugui@google.com>

	Fixes a build failure of ext/ripper/ripper.c on building out of place.
	* common.mk (id.h, id.c): Always generated in $(srcdir).
	(ext/ripper/ripper.c): Passes $(PATH_SEPARATOR) too to the sub make.

Mon Apr  8 12:05:02 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* object.c (rb_obj_ivar_set): call to_str for string only once.
	  to_str was called from rb_is_const_name and rb_to_id before.

	* object.c (rb_mod_const_set): ditto.

	* object.c (rb_mod_cvar_set): ditto.

Sun Apr  7 13:56:16 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_require.rb (TestRequire#test_require_nonascii_path):
	  RUBY_PLATFORM should escape as Regexp,
	  because RUBY_PLATFORM may contain '.'.

Sun Apr  7 10:44:01 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/defines.h: Simplify the logic to include sys/select.h.
	  This fixes a compilation error on Haiku (gcc2 and gcc4).

	* configure.in: Use shared linker as $(CC) for Haiku.
	  This fixes a build error on Haiku (gcc2).

Sun Apr  7 10:41:30 2013  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (MDNSOneShot#sender): Delete an unused variable.

Sun Apr  7 03:24:36 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: use more generic type:
	  * u_char -> unsigned char
	  * u_short -> unsigned short
	  * u_int -> unsigned int
	  * u_long -> unsigned long
	  * quad_t -> int64_t
	  * u_quad_t -> uint64_t

	* addr2line.c (imax): inline is defined by configure.

Sun Apr  7 01:40:39 2013  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-electric.el (ruby-electric-hash): New electric
	  function that expands a hash sign inside a string or regexp to
	  "#{}".

	* misc/ruby-electric.el (ruby-electric-curlies): Do not insert
	  spaces inside when the curly brace is a delimiter of %r, %w,
	  etc.

	* misc/ruby-electric.el (ruby-electric-curlies): Insert another
	  space before a closing curly brace when
	  ruby-electric-newline-before-closing-bracket is nil.

Sun Apr  7 01:01:26 2013  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): Test yday range.
	  [ruby-core:44088] [Bug #6247] reported by Ruby Submit.

Sat Apr  6 23:46:54 2013  Naohisa Goto  <ngotogenome@gmail.com>

	* configure.in (AC_CHECK_HEADERS): atomic.h for Solaris atomic_ops.

	* ruby_atomic.h: Skip using Solaris10 atomic_ops on Solaris 9 or
	  earlier if atomic.h is not available. [ruby-dev:47229] [Bug #8228]

Sat Apr  6 23:40:40 2013  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: Support LOC resources.
	  [ruby-core:23361] [Feature #1436] by JB Smith.

Sat Apr  6 23:38:09 2013  Naohisa Goto  <ngotogenome@gmail.com>

	* addr2line.c: quad_t and u_quad_t is not available on Solaris.
	  __inline is not available with old compilers on Solaris.
	  [ruby-dev:47229] [Bug #8227]

Sat Apr  6 23:31:38 2013  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: Add one-shot multicast DNS support.
	  [ruby-core:53387] [Feature #8089] by Eric Hodel.

Sat Apr  6 22:12:01 2013  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS.fetch_resource): New method to obtain
	  full result.
	  [ruby-dev:43587] [Feature #4788] proposed by Makoto Kishimoto.

Sat Apr  6 20:17:51 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_sys_fail_raddrinfo): Renamed from
	  rsock_sys_fail_addrinfo.
	  (rsock_sys_fail_raddrinfo_or_sockaddr): Renamed from
	  rsock_sys_fail_addrinfo_or_sockaddr.

	* ext/socket/rubysocket.h: Follow the above change.

Sat Apr  6 19:24:59 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_sys_fail_sockaddr): Takes struct sockaddr
	  and socklen_t instead of String object.
	  (rsock_sys_fail_addrinfo_or_sockaddr): Follow the above change.

	* ext/socket/rubysocket.h (rsock_sys_fail_sockaddr): Follow the above
	  change.

Sat Apr  6 14:28:23 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (SockAddrStringValueWithAddrinfo): New macro.
	  (rsock_sockaddr_string_value_with_addrinfo): New declaration.
	  (rsock_addrinfo_inspect_sockaddr): Ditto.
	  (rsock_sys_fail_addrinfo): Ditto.
	  (rsock_sys_fail_sockaddr_or_addrinfo): Ditto.

	* ext/socket/raddrinfo.c (rsock_addrinfo_inspect_sockaddr): Renamed
	  from addrinfo_inspect_sockaddr and exported.
	  (rsock_sockaddr_string_value_with_addrinfo): New function to obtain
	  string and possibly addrinfo object.

	* ext/socket/socket.c (rsock_sys_fail_sockaddr): Don't use
	  rsock_sys_fail_host_port which is IP dependent.  Invoke
	  rsock_sys_fail_addrinfo.
	  (rsock_sys_fail_addrinfo): New function using
	  rsock_addrinfo_inspect_sockaddr.
	  (rsock_sys_fail_addrinfo_or_sockaddr): New function.
	  (sock_connect): Use SockAddrStringValueWithAddrinfo and
	  rsock_sys_fail_addrinfo_or_sockaddr.
	  (sock_connect_nonblock): Ditto.
	  (sock_bind): Ditto.

Sat Apr  6 13:34:20 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_sys_fail_sockaddr): Delete 2nd argument.

	* ext/socket/rubysocket.h (rsock_sys_fail_sockaddr): Follow above
	  change.

Sat Apr  6 13:13:39 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_sys_fail_path): Use rb_str_inspect only
	  for String to avoid SEGV.

Sat Apr  6 12:40:16 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (rsock_sys_fail_host_port): Wrap by NORETURN.
	  (rsock_sys_fail_path): Ditto.
	  (rsock_sys_fail_sockaddr): Ditto.

Sat Apr  6 11:49:35 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_sys_fail_path): Use rb_str_inspect if the
	  path contains a NUL.

Sat Apr  6 11:39:19 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket: Improve socket exception message to show socket address.
	  [ruby-core:45617] [Feature #6583] proposed Eric Hodel.

	* ext/socket/rubysocket.h (rsock_sys_fail_host_port): Declared.
	  (rsock_sys_fail_path): Ditto.
	  (rsock_sys_fail_sockaddr): Ditto.

	* ext/socket/udpsocket.c (udp_connect): Use rsock_sys_fail_host_port.
	  (udp_bind): Ditto.
	  (udp_send): Ditto.

	* ext/socket/init.c (rsock_init_sock): Specify a string for rb_sys_fail
	  argument.
	  (make_fd_nonblock): Ditto.
	  (rsock_s_accept): Ditto.

	* ext/socket/ipsocket.c (init_inetsock_internal): Use
	  rsock_sys_fail_host_port.

	* ext/socket/socket.c (rsock_sys_fail_host_port): Defined.
	  (rsock_sys_fail_path): Ditto.
	  (rsock_sys_fail_sockaddr): Ditto.
	  (setup_domain_and_type): Use rsock_sys_fail_sockaddr.
	  (sock_connect_nonblock): Ditto.
	  (sock_bind): Ditto.
	  (sock_gethostname): Specify a string for rb_sys_fail argument.
	  (socket_s_ip_address_list): Ditto.

	* ext/socket/basicsocket.c (bsock_shutdown): Specify a string for
	  rb_sys_fail argument.
	  (bsock_setsockopt): Use rsock_sys_fail_path.
	  (bsock_getsockopt): Ditto.
	  (bsock_getpeereid): Refine the argument for rb_sys_fail.

	* ext/socket/unixsocket.c (rsock_init_unixsock): Use
	  rsock_sys_fail_path.
	  (unix_path): Ditto.
	  (unix_send_io): Ditto.
	  (unix_recv_io): Ditto.
	  (unix_addr): Ditto.
	  (unix_peeraddr): Ditto.

Sat Apr  6 11:23:18 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_nonascii_path):
	  fix load path for encoding to run the test as stand-alone.

Sat Apr  6 09:54:20 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (NATINT_LEN): fix definition order, must be after
	  NATINT_PACK.

Sat Apr  6 03:11:07 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: fix symbol keys in coder
	  emission.  Thanks @tjwallace
	* test/psych/test_coder.rb: test for change

Sat Apr  6 02:54:08 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/exception.rb: there should be only one exception
	  base class. Fixes tenderlove/psych #125
	* ext/psych/lib/psych.rb: require the correct exception class
	* ext/psych/lib/psych/syntax_error.rb: ditto
	* ext/psych/lib/psych/visitors/to_ruby.rb: ditto

Sat Apr  6 02:30:28 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (new_defined): remove all extra parentheses, and return
	  "nil" for defined? with empty expression.
	  [ruby-core:54024] [Bug #8224]

Sat Apr  6 02:06:04 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: correctly register
	  self-referential strings. Fixes tenderlove/psych #135

	* test/psych/test_string.rb: appropriate test.

Sat Apr  6 01:21:56 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (cloexec_accept): Fix a compile error on
	  Debian GNU/kFreeBSD.  Consider HAVE_ACCEPT4 is defined
	  but SOCK_CLOEXEC is not defined.

Sat Apr  6 00:19:30 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* load.c (features_index_add): use rb_str_subseq() to specify C string
	  position properly to fix require non ascii path.
	  [ruby-core:53733] [Bug #8165]

	* test/ruby/test_require.rb (TestRequire#test_require_nonascii_path):
	  a test for the above.

Fri Apr  5 20:41:49 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/defines.h (HAVE_TRUE_LONG_LONG): Defined to distinguish
	  availability of long long and availability of 64bit integer type.

	* pack.c: Use HAVE_TRUE_LONG_LONG to distinguish q! and Q! support.

Fri Apr  5 20:19:42 2013  Tanaka Akira  <akr@fsij.org>

	* addr2line.c: Include ruby/missing.h to fix compile error on Debian.

Fri Apr  5 19:39:52 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): fix of defined? with empty
	  expression.  [ruby-core:53999] [Bug #8220]

Fri Apr  5 13:22:59 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/curses/curses.c (Init_curses): fix implementation function,
	  crmode should be same as cbreak.  [ruby-core:54013] [Bug #8222]

Fri Apr  5 12:06:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/curses/hello.rb: Typo in Curses example by Drew Blas
	  [Fixes GH-273]

Thu Apr  4 23:45:13 2013  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (bind_random_port): Rescue EACCES for SunOS.
	  bind() on SunOS for port 2049 (nfs) and 4045 (lockd) causes
	  EACCES with unprivileged process.  cf. PRIV_SYS_NFS in privileges(5)
	  [ruby-core:48064] [Bug #7183] reported by Frank Meier.

Thu Apr  4 23:24:45 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Remove condition for bcc.

Thu Apr  4 22:53:23 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (FIX2LONG): Parenthesize the macro body.

Thu Apr  4 22:32:32 2013  Tanaka Akira  <akr@fsij.org>

	* time.c (time_strftime): Describe %L and %N truncates digits under
	  the specified length.
	  [ruby-core:52130] [Bug #7829]

Thu Apr  4 22:08:46 2013  Tanaka Akira  <akr@fsij.org>

	* object.c (rb_mod_cvar_set): Reverted "avoid inadvertent
	  symbol creation" to avoid SEGV by
	  Class.new.class_variable_set(1, 2).

Thu Apr  4 20:07:19 2013  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_write): New method.
	  (path_binwrite): Ditto.
	  [ruby-core:49468] [Feature #7378]

Thu Apr  4 16:51:29 2013  Yuki Yugui Sonoda  <yugui@google.com>

	* thread_pthread.c: Fixes wrong scopes of #if USE_SLEEPY_TIMER_THREAD
	  .. #endif sections.  This fixes a build error on NativeClient.

Wed Apr  3 17:25:31 2013  Yuki Yugui Sonoda  <yugui@google.com>

	* thread_pthread.c (ruby_init_stack): Avoid using uninitialized value.
	  stackaddr and size are not set if get_stack() fails.

Thu Apr  4 16:55:08 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* struct.c (make_struct): avoid inadvertent symbol creation.
	  (rb_struct_aref): ditto.
	  (rb_struct_aset): ditto.

Thu Apr  4 16:54:40 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_mod_const_set): avoid inadvertent symbol creation.
	  (rb_obj_ivar_set): ditto.
	  (rb_mod_cvar_set): ditto.

Thu Apr  4 15:46:48 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_inject): avoid inadvertent symbol creation.

Thu Apr  4 14:37:07 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_aref): avoid inadvertent symbol creation.
	  (rb_thread_variable_get): ditto.
	  (rb_thread_key_p): ditto.
	  (rb_thread_variable_p): ditto.

Thu Apr  4 11:33:57 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (ossl_bn_to_i): Use bn2hex to speed up.
	  In general, binary to/from decimal needs extra cost.

Thu Apr  4 07:24:18 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Specify arguments to test functions.

Thu Apr  4 03:25:09 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (ossl_bn_initialize): fix can't create from bn.

Wed Apr  3 22:09:25 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: Test functions and libraries after headers.

Wed Apr  3 21:23:29 2013  Tanaka Akira  <akr@fsij.org>

	 * io.c (rb_io_seek_m): Accept :CUR, :END, :SET as "whence" argument.
	   (interpret_seek_whence): New function.
	   [ruby-dev:45818] [Feature #6643]

Wed Apr  3 20:52:49 2013  Tanaka Akira  <akr@fsij.org>

	* process.c: Describe the behavior which Ruby invokes a commandline
	  directly without shell if the commandline is simple enough.
	  [ruby-core:50459] [Bug #7489]

Wed Apr  3 20:27:37 2013  Tanaka Akira  <akr@fsij.org>

	* ext/extmk.rb (extmake): Invoke Logging::log_close in a ensure
	  clause.

Wed Apr  3 18:53:58 2013  Tanaka Akira  <akr@fsij.org>

	* ext/extmk.rb (extmake): Use Logging.open to switch stdout and
	  stderr.  Delay Logging::log_close until the failure message is
	  written.  Write the failure message only if log file is opened.

	* lib/mkmf.rb (Logging.log_opened?): New method.

	  [ruby-dev:47215] [Bug #8209]

Wed Apr  3 17:11:15 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (constat_apply): pass through unknown sequence which
	  starts with ESC but is not followed by a bracket.  [ruby-core:53879]
	  [Bug #8201]

Wed Apr  3 16:35:32 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_eq): hide intermediate Bignums not just freeing
	  memory.  [ruby-core:53893] [Bug #8204]

	* object.c (rb_obj_hide): hide an object by clearing klass.

	* bignum.c (rb_big_eq): test as Fixnum if possible and get rid of zero
	  length Bignum.  [ruby-core:53893] [Bug #8204]

Tue Apr  2 23:56:03 2013  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb (SecureRandom.random_bytes): Use
	  OpenSSL::Random.random_add instead of OpenSSL::Random.seed and
	  specify 0.0 as the entropy.
	  [ruby-core:47308] [Bug #6928]

Tue Apr  2 20:24:52 2013  Tanaka Akira  <akr@fsij.org>

	* pack.c: Support Q! and q! for long long.
	  (natstr): Moved to toplevel.  Add q and Q if there is long long type.
	  (endstr): Moved to toplevel.
	  (NATINT_PACK): Consider long long.
	  (NATINT_LEN_Q): New macro.
	  (pack_pack): Support Q! and q!.
	  (pack_unpack): Ditto.
	  [ruby-dev:43970] [Feature #3946]

Tue Apr  2 19:24:26 2013  Tanaka Akira  <akr@fsij.org>

	* ext/-test-/num2int/num2int.c: Define utility methods
	  as module methods of Num2int.

	* test/-ext-/num2int/test_num2int.rb: Follow the above change.

Tue Apr  2 18:49:01 2013  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb: Don't use Array#to_s.
	   [ruby-core:52058] [Bug #7811] fixed by zzak (Zachary Scott).

Tue Apr  2 17:38:20 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_to_s): suppress duplicated charclass warning.
	  Regexp#to_s suppress extra its whole regexp options by calling
	  onig_new with its source, but it doesn't call rb_reg_preprocess.
	  Therefore its Unicode escapes (\u{XXXX}) are given as is,
	  and it may cause duplicated charclass warning for example
	  "[\u{33}]" (3 is duplicated) or "[\u{a}\u{b}]" (u is duplicated).
	  [ruby-core:53649] [Bug #8151]

Tue Apr  2 16:00:06 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_dump.c (rb_print_backtrace): separate to ease showing C backtrace.

	* internal.h (rb_print_backtrace): ditto.

Tue Apr  2 15:22:09 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/envutil.rb (assert_separately): stop_auto_run of
	  Test::Unit::Runner to prevent auto runner use ARGV.

	* test/ruby/envutil.rb (assert_separately): add $: to separate process.

	* test/ruby/envutil.rb (assert_separately): fail if stderr is not
	  empty and ignore_stderr is false.

Tue Apr  2 06:46:59 2013  Tanaka Akira  <akr@fsij.org>

	* ext/-test-/num2int/num2int.c: Rename utility methods
	  to global functions to ease manual experiments.

	* test/-ext-/num2int/test_num2int.rb: Follow the above change.

Mon Apr  1 22:26:17 2013  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c (rb_gzfile_set_mtime): Use NUM2UINT.
	  The old logic doesn't work well on LP64 platforms as:
	  .. -2**63-1 => error,
	  -2**63 .. -2**62-1 => success,
	  -2**62 .. -2**31-1 => error,
	  -2**31 .. 2**31-1 => success,
	  2**31 .. 2**62-1 => error,
	  2**62 .. 2**64-1 => success,
	  2**64 ..  => error.

Mon Apr  1 22:08:02 2013  Benoit Daloze  <eregontp@gmail.com>

	* ext/zlib/zlib.c (Zlib::Inflate.new):
	  Fix documentation syntax and naming errors.
	  Based on patch by Robin Dupret. Fix GH-271.

Mon Apr  1 21:22:31 2013  Tanaka Akira  <akr@fsij.org>

	* test/-ext-/num2int/test_num2int.rb: Test small bignums.

Mon Apr  1 21:10:56 2013  Tanaka Akira  <akr@fsij.org>

	* numeric.c (rb_num2ulong_internal): Don't cast a negative double value
	  into unsigned long, which is undefined behavior.
	  (rb_num2ull): Don't cast a value bigger than LLONG_MAX into
	  long long, which is undefined behavior.

Mon Apr  1 20:57:57 2013  Tanaka Akira  <akr@fsij.org>

	* ext/-test-/num2int/num2int.c: Return string for result, instead of
	  printing.

	* test/-ext-/num2int/test_num2int.rb: updated to follow above change.

Mon Apr  1 20:08:07 2013  Tanaka Akira  <akr@fsij.org>

	* numeric.c (rb_num2long): Don't use SIGNED_VALUE uselessly.
	  (check_int): Ditto.
	  (check_short): Ditto.
	  (rb_num2fix): Ditto.
	  (rb_num2ulong_internal): Add a cast.

Mon Apr  1 18:41:35 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: skip autoconf 2.64 and 2.66, 2.67 seems short-lived
	  but stick on it for Debian Squeeze.

Mon Apr  1 14:22:52 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check clang version by predefined macro values.
	  [Bug #8192]

Mon Apr  1 12:05:15 2013  Tanaka Akira  <akr@fsij.org>

	* numeric.c (check_uint): Take the 1st argument as unsigned long,
	  instead of VALUE.  Refine the validity test conditions.
	  (check_ushort): Ditto.

Mon Apr  1 07:15:03 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* configure.in: use quadrigraph to put '[' or ']'. [Bug #8192]

Mon Apr  1 04:16:41 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: kick old clang. [ruby-dev:47204] [Bug #8192]

Mon Apr  1 01:12:46 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h (FIX2ULONG): Make it consistent with NUM2ULONG.

	* ext/-test-/num2int/num2int.c: Add utility methods for FIX2XXX tests.

	* test/-ext-/num2int/test_num2int.rb: Add tests for FIX2XXX.

Sun Mar 31 17:17:56 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (rb_mod_define_method): consider visibility in define_method.
	  patch by mashiro <mail AT mashiro.org>.  fix GH-268.

Sun Mar 31 15:40:30 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/configure.bat: try to fix option arguments split by commas and
	  equals here.  this batch file no longer run with old command.com.

	* tool/mkconfig.rb: no hacks for cmd.exe.

Sun Mar 31 13:47:04 2013  Tanaka Akira  <akr@fsij.org>

	* numeric.c (rb_num2ulong_internal): New function similar to
	  rb_num2ulong but integer wrap around flag is also returned.
	  (rb_num2ulong): Use rb_num2ulong_internal.
	  (rb_num2uint): Use rb_num2ulong_internal and the wrap around flag is
	  used instead of negative_int_p(val).
	  (rb_num2ushort): ditto.

Sun Mar 31 06:27:17 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (HAVE_METACLASS_P): should check FL_SINGLETON flag before get
	  instance variable to get rid of wrong warning about __attached__.
	  [ruby-core:53839] [Bug #8188]

Sat Mar 30 14:11:28 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* bcc32: removed. agreed at
	  http://bugs.ruby-lang.org/projects/ruby/wiki/DevelopersMeeting20130223Japan

Sat Mar 30 03:58:00 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/file.c (code_page): use cp1252 instead of cp20127 as US-ASCII.
	  fix [ruby-core:53079] [Bug #7996]
	  reported and patched by mmeltner (Michael Meltner).

Sat Mar 30 03:49:21 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (wrename): use MoveFileExW instead of MoveFileW,
	  because the latter fails on cross device file move of some
	  environments.
	  fix [ruby-core:53492] [Bug #8109]
	  reported by mitchellh (Mitchell Hashimoto).

Fri Mar 29 22:09:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_mutex_synchronize_m): yield no block params.  patch by
	  splattael (Peter Suschlik) in [ruby-core:53773] [Bug #8097].
	  fix GH-266.

Fri Mar 29 16:51:39 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_next_argv): set init flag if succeeded to forward, after
	  skipping.

	* io.c (argf_block_call_i, argf_block_call): no more forwarding if
	  forwarded after skipping.  [ruby-list:49185]

	* io.c (argf_close): deal with init flag.

	* io.c (argf_block_call_i, argf_block_call): forward next file if
	  skipped while iteration, to get rid of IOError.  [ruby-list:49185]

Fri Mar 29 11:09:48 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): not include all CFLAGS in CXXFLAGS, to
	  use different set than C for C++.  [ruby-core:45273] [Bug #6504]

Fri Mar 29 10:24:10 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h: undef POSIX compliant names on AIX, which are no
	  longer needed.  patch suggested by edelsohn (David Edelsohn) in
	  [ruby-core:53815].  [Bug #8174]

Fri Mar 29 06:39:42 2013  Tanaka Akira  <akr@fsij.org>

	* numeric.c (rb_num2ull): Cast double to unsigned LONG_LONG via
	  LONG_LONG instead of double to unsigned LONG_LONG directly.
	  This is a challenge to fix a test_num2ull(TestNum2int)
	  failure (NUM2ULL(-1.0) should be "18446744073709551615" but was "0")
	  on Mac OS X with 32bit clang.
	  http://a.mrkn.jp/~mrkn/chkbuild/mountain_lion/ruby-trunk-m32-o0/log/20130328T191100Z.diff.html.gz

Fri Mar 29 00:54:54 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MAIN_DOES_NOTHING): ensure symbols for tests to be
	  preserved.  [ruby-core:53745] [Bug #8169]

Thu Mar 28 23:11:25 2013  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: Test Windows platform by detecting LoadError when
	  require 'win32/resolv' suggested by Nobuyoshi Nakada [ruby-core:53389].
	  [ruby-core:53388] [Feature #8090] Reported by Charles Nutter.

Thu Mar 28 23:10:10 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h: rename SVR3,4 member names as POSIX compliant,
	  to get rid of conflict on AIX.  [ruby-core:53765] [Bug #8174]

Thu Mar 28 18:22:21 2013  Tanaka Akira  <akr@fsij.org>

	* test/-ext-/num2int/test_num2int.rb: extract
	  assert_num2i_success_internal and assert_num2i_error_internal and
	  provide assertion messages as "NUM2XXX(NNN)".

Thu Mar 28 07:05:25 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h: Delete redundant inclusions caused by
	  AC_INCLUDES_DEFAULT in defines.h.

	* include/ruby/defines.h: Ditto.

	* include/ruby/ruby.h: Ditto.

	* include/ruby/st.h: Ditto.

Thu Mar 28 06:51:31 2013  Tanaka Akira  <akr@fsij.org>

	* include/ruby/defines.h: Fix a compilation error on NetBSD,
	  "type of formal parameter 1 is incomplete" for the rb_thread_wait_for
	  invocation in rb_file_flock, by including header files as
	  AC_INCLUDES_DEFAULT of autoconf.

Wed Mar 27 22:09:14 2013  Tanaka Akira  <akr@fsij.org>

	* numeric.c (LONG_MIN_MINUS_ONE_IS_LESS_THAN): New macro.
	  (LLONG_MIN_MINUS_ONE_IS_LESS_THAN): Ditto.
	  (rb_num2long): Use LONG_MIN_MINUS_ONE_IS_LESS_THAN.
	  (rb_num2ulong): Ditto.
	  (rb_num2ll): Use LLONG_MIN_MINUS_ONE_IS_LESS_THAN.
	  (rb_num2ull): Ditto.

	* test/-ext-/num2int/test_num2int.rb (assert_num2i_success): Test the
	  value converted into a Float if Float can represent the value
	  exactly.
	  (assert_num2i_error): Ditto.

Wed Mar 27 20:59:47 2013  Tanaka Akira  <akr@fsij.org>

	* test/-ext-/num2int/test_num2int.rb (assert_num2i_success): New
	  utility method.
	  (assert_num2i_error): Ditto.

Wed Mar 27 20:37:59 2013  Tanaka Akira  <akr@fsij.org>

	* time.c (num_exact): Use to_r method only if to_int method is
	  available.
	  [ruby-core:53764] [Bug #8173] Reported by Hiro Asari.

Wed Mar 27 12:07:40 2013  Tanaka Akira  <akr@fsij.org>

	* test/-ext-/num2int/test_num2int.rb (test_num2ll): test LLONG_MIN,
	  not LONG_MIN.

Wed Mar 27 12:02:45 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (TIMET_MAX_PLUS_ONE): definition simplified.

Wed Mar 27 06:39:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MAIN_DOES_NOTHING): force to refer symbols for tests
	  to be preserved.  [ruby-core:53745] [Bug #8169]

Wed Mar 27 05:15:37 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_REPLACE_TYPE): define SIGNEDNESS_OF_type same as
	  check_signedness of mkmf.rb.

	* internal.h (TIMET_MAX, TIMET_MIN, TIMET_MAX_PLUS_ONE): use
	  SIGNEDNESS_OF_TIME_T.

Wed Mar 27 00:28:45 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h (TIMET_MAX_PLUS_ONE): Defined.

	* thread.c (double2timeval): Saturate out-of-range values.

Tue Mar 26 23:41:18 2013  Tanaka Akira  <akr@fsij.org>

	* internal.h: Define TIMET_MAX and TIMET_MIN here.

	* time.c: Remove TIMET_MAX and TIMET_MIN definitions.

	* thread.c: Ditto.

	* thread_pthread.c: Remove TIMET_MAX definition.

	* thread_win32.c: Ditto.

Tue Mar 26 22:31:10 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sockaddr_len): return the shortest length for
	  unknown socket address.

Tue Mar 26 22:14:46 2013  Tanaka Akira  <akr@fsij.org>

	* thread.c (double2timeval): convert the infinity to TIME_MAX to avoid
	  SEGV by Thread.new {}.join(Float::INFINITY) on
	  Debian GNU/Linux (amd64).

Mon Mar 25 07:09:20 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rinda/tuplespace.rb:  Only return tuple entry once on move,
	  either through port or regular return, not both.  This results in a
	  120% speedup when combined with #8125.  Patch by Joel VanderWerf.
	  [ruby-trunk - Feature #8119]

Mon Mar 25 06:59:01 2013  Eric Hodel  <drbrain@segment7.net>

	* test/rinda/test_rinda.rb:  Skip IPv6 tests if no IPv6 addresses
	  exist.  Skip fork-dependent test if fork is not available.
	  [ruby-trunk - Bug #8159]

Sun Mar 24 10:38:24 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* addr2line.c (putce): suppress unused return value warning.

Mon Mar 25 02:01:03 2013  Narihiro Nakamura  <authornari@gmail.com>

	* proc.c (bm_free): need to clean up the mark flag of a free and
	  unlinked method entry. [Bug #8100] [ruby-core:53439]

Sun Mar 24 22:13:51 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_rpartition): revert r39903, and convert byte offset
	  to char offset; the return value of rb_reg_search is byte offset,
	  but other than it of rb_str_rpartition expects char offset.
	  [Bug #8138] [ruby-dev:47183]

Sun Mar 24 18:29:46 2013  Akinori MUSHA  <knu@iDaemons.org>

	* string.c (rb_str_rpartition): Fix String#rpartition(/re/)
	  against a multibyte string. [Bug #8138] [ruby-dev:47183]

Sun Mar 24 13:42:24 2013  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (GC_ENABLE_LAZY_SWEEP): new macro to switch lazy sweeping
	  for debugging. [Feature #8024] [ruby-dev:47135]

Sun Mar 24 12:55:47 2013  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: We have no chance to expand the heap when lazy sweeping is
	  restricted. So collecting is often invoked if there is not
	  enough free space in the heap. Try to expand heap when this is
	  the case.

Sun Mar 24 11:03:31 2013  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_require.rb: Remove temporally files in the tests.

	* test/ruby/test_rubyoptions.rb: Ditto.

	* test/logger/test_logger.rb: Ditto.

	* test/psych/test_psych.rb: Ditto.

	* test/readline/test_readline.rb: Ditto.

	* test/syslog/test_syslog_logger.rb: Ditto.

	* test/webrick/test_httpauth.rb: Ditto.

	* test/zlib/test_zlib.rb: Ditto.

Sun Mar 24 05:36:29 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rinda/ring.rb:  Added documentation for multicast support.

	* NEWS:  Point to above documentation.

Sun Mar 24 05:32:39 2013  Eric Hodel  <drbrain@segment7.net>

	* test/rinda/test_rinda.rb:  Restore tests commented out while fixing
	  test slowdown bug before r39895.

Sun Mar 24 05:03:36 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rinda/ring.rb:  Add multicast support to Rinda::RingFinger and
	  Rinda::RingServer.  [ruby-trunk - Bug #8073]
	* test/rinda/test_rinda.rb:  Test for the above.

	* NEWS: Update with Rinda multicast support

Sun Mar 24 04:13:27 2013  Eric Hodel  <drbrain@segment7.net>

	* test/rinda/test_rinda.rb:  Fixed test failures in r39890 and r39891
	  due to stopping DRb service.

Sun Mar 24 03:34:02 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rinda/rinda.rb:  Fixed loss of tuple when remote is alive but the
	  call stack was unwound.  Patch by Joel VanderWerf.
	  [ruby-trunk - Bug #8125]
	* test/rinda/test_rinda.rb:  Test for the above.

Sun Mar 24 02:14:53 2013  Tanaka Akira  <akr@fsij.org>

	* test/mkmf/test_have_macro.rb: remove temporally files in the tests.

Sat Mar 23 23:50:04 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (kprintf): added from FreeBSD libstand's printf.
	  this is consided as async signal safe function.

	* addr2line.c (rb_dump_backtrace_with_lines): use kfprintf.
	  [Bug #8144] [ruby-core:53632]

Sat Mar 23 23:28:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_divide): Use Qnil and NIL_P
	  instead of (VALUE)0 as a return value.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_div): ditto.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_divremain): ditto.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_remainder): ditto.

Sat Mar 23 17:39:49 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (check_funcall_respond_to): preserve passed_block, which
	  is modified in vm_call0_body() via vm_call0(), and caused a bug of
	  rb_check_funcall() by false negative result of rb_block_given_p().
	  re-fix [ruby-core:53650] [Bug #8153].
	  [ruby-core:53653] [Bug #8154]

Fri Mar 22 17:48:34 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/forwardable.rb (Forwardable::FILE_REGEXP): create regexp object
	  outside sources for eval, to reduce allocations in def_delegators
	  wrappers.  //o option does not make each regexps shared.  patch by
	  tmm1 (Aman Gupta) in [ruby-core:53620] [Bug #8143].

Fri Mar 22 17:38:42 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_feature_p), vm_core.h (rb_vm_struct): turn
	  loaded_features_index into st_table.  patches by tmm1 (Aman Gupta)
	  in [ruby-core:53251] and [ruby-core:53274] [Bug #8048]

Fri Mar 22 10:29:00 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c: Fix style.

Fri Mar 22 05:30:49 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (ambiguous_operator): refine warning message, since this
	  warning is shown after literal too.

Fri Mar 22 04:51:14 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_callee_setup_keyword_arg): should check required
	  keyword arguments even if rest hash is defined.  [ruby-core:53608]
	  [Bug #8139]

Fri Mar 22 01:00:17 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* process.c (rb_execarg_addopt, run_exec_pgroup): use rb_pid_t
	  instead of pid_t.

	* ext/pty/pty.c (raise_from_check, pty_check): ditto.

Fri Mar 22 00:04:15 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (rb_dump_backtrace_with_lines): output line at once.

Thu Mar 21 23:17:08 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (ruby_kill): get rid of deadlock on signal 0.
	  [ruby-dev:47182] [Bug #8137]

Thu Mar 21 22:39:46 2013  Naohisa Goto  <ngotogenome@gmail.com>

	* marshal.c (marshal_dump, marshal_load): workaround for segv on
	  Intel Solaris compiled with Oracle SolarisStudio 12.3.
	  Partly revert r38174. [ruby-core:52042] [Bug #7805]

Thu Mar 21 16:48:06 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (simple_re_meta): escape all closing characters, not only
	  round parenthesis.  [ruby-core:53578] [Bug #8133]

Thu Mar 21 13:50:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (UNINITIALIZED_VAR): suppress warnings by clang 4.2.
	  [ruby-core:51742] [Bug #7756]

Thu Mar 21 07:34:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/date/date_core.c: Typo in Date::MONTHNAMES by Matt Gauger
	  [GH fixes #261]

Wed Mar 20 22:53:14 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (find_library): fix to format message.
	  [ruby-core:53568] [Bug #8130]

Wed Mar 20 22:52:52 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (install_dirs, with_destdir): prefix with DESTDIR
	  directories to install only unless bundled extension libraries.
	  [ruby-core:53502] [Bug #8115]

Wed Mar 20 17:47:53 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/win32ole/test_err_in_callback.rb (TestErrInCallBack#setup):
	  allow using different root for source and build directories.
	  this may fixes a minor problem of r39834.

Wed Mar 20 16:40:48 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/ruby/test_signal.rb (test_hup_me): skip if HUP isn't supported.
	  On Windows this test causes ArgumentError.

Wed Mar 20 16:24:12 2013  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/rubygems/test_gem_installer.rb (test_install_extension_flat):
	  use ruby in build directory in case ruby is not installed.
	  [ruby-core:53265] [Bug #8058]

Wed Mar 20 15:22:07 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/win32ole/test_err_in_callback.rb (TestErrInCallBack#setup): use
	  relative path to get rid of "too long commandline" error.

Wed Mar 20 04:27:42 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/rinda/test_rinda.rb: remove unused variables.
	  patched by Vipul A M <vipulnsward@gmail.com>

Wed Mar 20 04:15:32 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* ext/bigdecimal/bigdecimal.c: fixed typo.
	  patched by Vipul A M <vipulnsward@gmail.com>

Sat Mar 16 03:40:49 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_signal.rb (test_hup_me): added a few comments.

Sat Mar 16 03:39:38 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (ruby_kill): added a few comments.

Sat Mar 16 03:36:56 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (ruby_kill): release GVL while waiting signal delivered.

Tue Mar 19 19:50:48 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby_kill (internal.h, thread.c): use rb_pid_t instead of pid_t.
	  this fixes the build failure of mswin introduced at r39819.

Tue Mar 19 17:09:30 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_conv_enc_opts): convert with one converter, instead
	  of re-creating converters for each buffer expansion.

Tue Mar 19 17:06:50 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (glob_helper): compose HFS file names from UTF8-MAC.
	  [ruby-core:48745] [Bug #7267]

Sat Mar 16 01:44:29 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* internal.h: added a declaration of ruby_kill().
	* thread.c (ruby_kill): helper function of kill().

	* signal.c (rb_f_kill): use ruby_kill() instead of kill().
	* signal.c (rb_f_kill): call rb_thread_execute_interrupts()
	  to ensure that make SignalException if sent a signal
	  to myself. [Bug #7951] [ruby-core:52864]

	* vm_core.h (typedef struct rb_thread_struct): added
	  th->interrupt_cond.
	* thread.c (rb_threadptr_interrupt_common): added to
	  initialization of th->interrupt_cond.
	* thread.c (thread_create_core): ditto.

	* test/ruby/test_signal.rb (TestSignal#test_hup_me): test for
	  the above.

Sat Mar 16 00:42:39 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (linux_iocparm_len): enable only exist _IOC_SIZE().
	  Because musl libc doesn't have it. [Bug #8051] [ruby-core:53229]

Tue Mar 19 10:05:04 2013  Shota Fukumori  <her@sorah.jp>

	* ext/objspace/objspace.c: Fix typo in doc. Patch by Sho Hashimoto.
	  [Bug #8116] [ruby-dev:47177]

Tue Mar 19 02:13:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: set ac_cv_prog_cxx if CXX is supplied.

Tue Mar 19 01:18:00 2013  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: Fix c++ compiler auto-selection not only for
	  Darwin 11.x, but also the other versions of Darwin.

Tue Mar 19 00:26:22 2013  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: Improve accuracy of objspace_live_num() and
	  allocated/freed counters. patched by tmm1(Aman Gupta).
	  [Bug #8092] [ruby-core:53392]

Mon Mar 18 21:42:48 2013  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: Avoid unnecessary heap growth. patched by tmm1(Aman Gupta).
	  [Bug #8093] [ruby-core:53393]

Mon Mar 18 17:58:36 2013  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: Fix unlimited memory growth with large values of
	  RUBY_FREE_MIN. patched by tmm1(Aman Gupta).
	  [Bug #8095] [ruby-core:53405]

Mon Mar 18 14:46:19 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/win32ole/test_err_in_callback.rb
	  (TestErrInCallBack#test_err_in_callback): shouldn't create a file in
	  the top of build directory.

Mon Mar 18 13:29:52 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_dump.c (backtrace): on darwin use custom backtrace() to trace
	  beyond _sigtramp. darwin's backtrace can't trace beyond signal
	  trampoline with sigaltstack.

	* configure.in: check execinfo.h on darwin.

Mon Mar 18 11:03:23 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.h (END_INSN): revert r39517 because the segv seems fixed by
	  r39806.

Mon Mar 18 10:41:06 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c: Correct predefined macro name. This typo is introduced by
	  r36534 and should be backported to ruby_2_0_0.

Mon Mar 18 03:18:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c: Typo in Array#delete by Timo Sand [GH fixes #258]

Mon Mar 18 01:14:56 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_fillbuf): show fd number on failure to debug.
	  http://c5632.rubyci.org/~chkbuild/ruby-trunk/log/20130316T050302Z.diff.html.gz

Sun Mar 17 02:38:21 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/date/date_core.c: include sys/time.h for avoiding implicit
	  declaration of gettimeofday().

Sun Mar 17 00:55:31 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/missing.h: removed __linux__. it's unnecessary.

Fri Mar 15 14:57:16 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c: disabled _FORTIFY_SOURCE for avoid to hit glibc bug.
	  [Bug #8080] [ruby-core:53349]
	* test/ruby/test_io.rb (TestIO#test_io_select_with_many_files):
	  test for the above.

Wed Mar 13 15:16:35 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/missing.h (__syscall): moved to...
	* io.c: here. because __syscall() is only used from io.c.

	* include/ruby/missing.h: move "#include <sys/type.h>" to ....
	* include/ruby/intern.h: here. because it was introduced for
	  fixing NFDBITS issue. [ruby-core:05179].

Wed Mar 13 14:38:53 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/missing.h (struct timespec): include <sys/time.h>

Wed Mar 13 13:54:45 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: check struct timeval exist or not.
	* include/ruby/missing.h (struct timeval): check HAVE_STRUCT_TIMEVAL
	  properly. and don't include sys/time.h if struct timeval exist.

	* file.c: include sys/time.h explicitly.
	* random.c: ditto.
	* thread_pthread.c: ditto.
	* time.c: ditto.
	* ext/date/date_strftime.c: ditto.

Fri Mar 15 14:45:02 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in (_FORTIFY_SOURCE): added a few comments.

Fri Mar 15 14:17:55 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (numberof): renamed from ARRAY_SIZE() because
	  other all files use numberof().

Say Mar 15 01:33:00 2013  Charles Oliver Nutter <headius@headius.com>

	* test/ruby/test_lazy_enumerator.rb (TestLazyEnumerator#test_drop_while):
	  Modify while condition to show dropping remains off after first false
	  value. This change was made in 39711.

Fri Mar 15 23:06:18 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (GetTimeval): check if already initialized instance.

	* time.c (GetNewTimeval): check if newly created instance.

	* time.c (time_init_0, time_init_1, time_init_copy, time_mload): must
	  be newly created instance.  [ruby-core:53436] [Bug #8099]

Fri Mar 15 14:51:33 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_sys_fail_path_with_func): share same function, and path
	  may be nil.

Fri Mar 15 08:24:51 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_sys_fail_path): define & use rb_sys_fail_path0 like r39752

Fri Mar 15 04:08:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* proc.c: Typo in Proc.arity found by Jack Nagel [Bug #8094]

Thu Mar 14 16:59:09 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_function_name_string): macro for function name
	  string predefined identifier, __func__ in C99, or __FUNCTION__ in
	  gcc.

	* file.c (rb_sys_fail_path): use RUBY_FUNCTION_NAME_STRING.

Thu Mar 14 14:12:34 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (rb_sys_fail_path): use rb_sys_fail_path0 only on GCC.
	  __func__ is C99 feature.

Thu Mar 14 12:59:59 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (rb_sys_fail_path0): add to append the name of called function
	  to ease debugging for example blow umask_spec failure.
	  http://fbsd.rubyci.org/~chkbuild/ruby-trunk/log/20130309T010202Z.diff.html.gz

	* file.c (rb_sys_fail_path): use rb_sys_fail_path0.

Thu Mar 14 12:53:15 2013  Luis Lavena  <luislavena@gmail.com>

	* win32/file.c (get_user_from_path):  add internal function that retrieves
	  username from supplied path (refactored).
	* win32/file.c (rb_file_expand_path_internal):  refactor expansion of user
	  home to use get_user_from_path and cover dir_string corner cases.
	  [ruby-core:53168] [Bug #8034]

Thu Mar 14 11:53:01 2013  Narihiro Nakamura  <authornari@gmail.com>

	* NEWS: describe RUBY_HEAP_SLOTS_GROWTH_FACTOR.

Thu Mar 14 10:01:12 2013  Eric Hodel  <drbrain@segment7.net>

	* doc/globals.rdoc:  $? is thread-local

Wed Mar 13 23:25:59 2013  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: allow to tune growth of heap by environment variable
	  RUBY_HEAP_SLOTS_GROWTH_FACTOR. patched by tmm1(Aman Gupta).
	  [Feature #8015] [ruby-core:53131]

Wed Mar 13 19:43:46 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* doc/irb/irb.rd.ja: fix typo

	* ext/tk/MANUAL_tcltklib.eng: fix typos

	* ext/tk/sample/tktextframe.rb (Tk#component_delegates): fix typo

Wed Mar 13 15:13:04 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_obj_singleton_methods): collect methods from the origin
	  class.  [ruby-core:53207] [Bug #8044]

Wed Mar 13 14:51:26 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (rb_export_method): directly override the flag of method
	  defined in prepending class too, not adding zsuper entry.
	  [ruby-core:53106] [Bug #8005]

Wed Mar 13 13:06:26 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rm, shvar_to_cpp, unexpand_shvar): local is not
	  available on old shells.

	* configure.in (shvar_to_cpp): escape quotes for old shells.
	  [Bug #7959] [Bug #8071]

Wed Mar 13 11:11:07 2013  Shugo Maeda  <shugo@ruby-lang.org>

	* object.c (Init_Object): remove Module#used, which has been
	  introduced in Ruby 2.0 by mistake.  [Bug #7916] [ruby-core:52719]

Wed Mar 13 05:49:29 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/irb.rb:  Fix typo

Tue Mar 12 22:20:47 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_arguments, iseq_compile_each): support required
	  keyword arguments.   [ruby-core:51454] [Feature #7701]

	* iseq.c (rb_iseq_parameters): ditto.

	* parse.y (f_kw, f_block_kw): ditto.  this syntax is still
	  experimental, the notation may change.

	* vm_core.h (rb_iseq_struct): ditto.

	* vm_insnhelper.c (vm_callee_setup_keyword_arg): ditto.

Tue Mar 12 17:02:53 2013  TAKANO Mitsuhiro <tak@no32.tk>

	* date_core.c: clearly specify operator precedence.

Tue Mar 12 17:00:45 2013  TAKANO Mitsuhiro <tak@no32.tk>

	* insns.def: fix condition.

Tue Mar 12 16:48:19 2013  TAKANO Mitsuhiro <tak@no32.tk>

	* rational.c: fix dangling if, else-if and else.

Tue Mar 12 06:27:59 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/commands/setup_command.rb:  Don't delete non-rubygems
	  files when installing RubyGems.
	* test/rubygems/test_gem_commands_setup_command.rb:  Test for the
	  above.

	* lib/rubygems/ext/ext_conf_builder.rb:  Use full path to siteconf.rb
	  in case the extconf.rb changes directories (like memcached does).

	* lib/rubygems/package.rb:  Remove double slash from path.
	* test/rubygems/test_gem_package.rb:  Test for the above.
	* test/rubygems/test_gem_package_old.rb:  ditto.

	* lib/rubygems/source.rb:  Revert automatic HTTPS upgrade
	* lib/rubygems/spec_fetcher.rb:  ditto.
	* test/rubygems/test_gem_remote_fetcher.rb:  ditto.
	* test/rubygems/test_gem_source.rb:  ditto.
	* test/rubygems/test_gem_spec_fetcher.rb:  ditto.

Tue Mar 12 02:25:19 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/net/smtp.rb:  Added Net::SMTP#rset method to implement the SMTP
	  RSET command.  [ruby-trunk - Feature #5373]
	* NEWS:  ditto.
	* test/net/smtp/test_smtp.rb:  Test for the above.

Mon Mar 11 22:44:57 2013  Tanaka Akira  <akr@fsij.org>

	* lib/resolv-replace.rb (TCPSocket#initialize): resolve the 3rd
	  argument only if non-nil value is given.
	  [ruby-dev:47150] [ruby-trunk - Bug #8054] reported and analyzed by
	  mrkn.

Mon Mar 11 19:22:54 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/mkmf/base.rb: class name conflict.

Mon Mar 11 18:45:09 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* enumerator.c (enumerator_with_index): try to convert given offset to
	  integer. fix bug introduced in r39594.

Mon Mar 11 17:27:57 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/envutil.rb (EnvUtil.with_default_external): add for
	  changing Encoding.default_external without warnings.

	* test/ruby/envutil.rb (EnvUtil.with_default_internal): ditto.

	* test/ruby/test_io_m17n.rb: use above with_default_external.

Mon Mar 11 16:57:00 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (extract_binmode): raise error even if binmode and textmode
	  don't conflict. [Bug #5918] [ruby-core:42199]

Mon Mar 11 12:25:12 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* Merge Onigmo d4bad41e16e3eccd97ccce6f1f96712e557c4518.
	  fix lookbehind assertion fails with /m mode enabled. [Bug #8023]
	  fix \Z matches where it shouldn't. [Bug #8001]

Mon Mar 11 11:53:35 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#dir_config, MakeMakefile#_libdir_basename):
	  defer use of instance variable until needed.  [Bug #8074]

Thu Mar  7 10:42:28 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/thread.rb (Queue#clear): return self.
	  Patch by Cubing Cube. Thank you! [Bug #7947] [ruby-dev:47098]
	* lib/thread.rb (Queue#push): ditto.
	* lib/thread.rb (SizedQueue#push): ditto.
	* test/thread/test_queue.rb: add tests for the above.

Thu Mar  7 10:40:49 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* tool/change_maker.rb (#diff2index): check Encoding::BINARY.
	  BASERUBY may still be 1.8.x.

Thu Mar  7 08:47:42 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* NEWS (Mutex#owned?): no longer experimental.

Sun Mar 10 23:38:15 2013  Luis Lavena  <luislavena@gmail.com>

	* win32/file.c (rb_file_expand_path_internal):  Expand home directory when
	  used as second parameter (dir_string).  [ruby-core:53168] [Bug #8034]
	* test/ruby/test_file_exhaustive.rb: add test to verify.

Sun Mar 10 23:27:05 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/ext/ext_conf_builder.rb (Gem::Ext::ExtConfBuilder.build):
	  it is impossible to predict which file will be installed to where,
	  by the arguments, so use intermediate destination directory always.
	  [Bug #7698]

Sun Mar 10 17:00:22 2013  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: edited rdoc.
	* rational.c: ditto.

Sun Mar 10 15:02:39 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (setup_communication_pipe): remove unused function.
	  it was unintentionally added r39683.

Wed Mar  6 00:30:40 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* tool/gen_ruby_tapset.rb: add tapset generator.

Wed Mar  6 03:27:43 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* probes.d (symbol-create): change argument name `string' to
	  `str'. `string' is a keyword for systemtap.

Tue Mar  5 22:23:01 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* probes.d: added argument name

Thu Mar  7 01:17:00 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/thread/test_queue.rb (TestQueue#test_thr_kill): reduce
	  iterations from 2000 to 250. When running on uniprocessor
	  systems, every th.kill needs TIME_QUANTUM_USEC time (i.e.
	  100msec on posix systems). Because, "r.read 1" is 3 steps
	  operations that 1) release GVL 2) read 3) acquire gvl and
	  (1) invoke context switch to main thread. and then, main
	  thread's th.kill resume (1), but not (2). Thus read interrupt
	  need TIME_QUANTUM_USEC. Then maximum iteration is 30sec/100msec
	  = 300.

Thu Mar  7 00:14:51 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_update_max_fd): use ATOMIC_CAS because this function
	  is used from timer thread too.

Wed Mar  6 23:30:21 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (ARRAY_SIZE): new.
	* thread_pthread.c (gvl_acquire_common): use low priority
	  notification for avoiding timer thread interval confusion.
	  If we use timer_thread_pipe[1], every gvl_yield() request
	  one more gvl_yield(). It lead to thread starvation.
	  [Bug #7999] [ruby-core:53095]
	* thread_pthread.c (rb_reserved_fd_p): adds timer_thread_pipe_low
	  to reserved fds.

Wed Mar  6 22:36:19 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (rb_thread_wakeup_timer_thread_fd): add fd
	  argument and remove hardcoded dependency of timer_thread_pipe[1].
	* thread_pthread.c (consume_communication_pipe): add fd argument.
	* thread_pthread.c (close_communication_pipe): ditto.

	* thread_pthread.c (timer_thread_sleep): adjust the above changes.

	* thread_pthread.c (setup_communication_pipe_internal): factor
	  out pipe initialize logic.

Wed Mar  6 22:56:14 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (ubf_select): add to small comments why we
	  need to call rb_thread_wakeup_timer_thread().

Wed Mar  6 21:42:24 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (rb_thread_create_timer_thread): factor out
	  creating communication pipe logic into separate function.
	* thread_pthread.c (setup_communication_pipe): new helper function.
	* thread_pthread.c (set_nonblock): moves a definition before
	  setup_communication_pipe.

Sun Mar  3 02:42:29 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (consume_communication_pipe): retry when
	  read returned CCP_READ_BUFF_SIZE.

Wed Mar  6 21:31:35 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (timer_thread_sleep): use poll() instead of
	  select(). select doesn't work if timer_thread_pipe[0] is
	  greater than FD_SETSIZE.
	* thread_pthread.c (USE_SLEEPY_TIMER_THREAD): add a dependency
	  against poll.

Wed Mar  6 21:00:23 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (USE_SLEEPY_TIMER_THREAD): use more accurate
	  ifdef conditions.

Sun Mar  3 02:30:36 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (set_nonblock): new helper function for set
	  O_NONBLOCK.
	* thread_pthread.c (rb_thread_create_timer_thread): set O_NONBLOCK
	  to timer_thread_pipe[0] too.

Sun Mar 10 09:12:51 2013  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c: described syntax of string form.
	* rational.c: ditto.

Sat Mar  9 11:58:39 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (w_extended): check for prepended object.
	  [ruby-core:53206] [Bug #8043]

Sat Mar  9 08:36:58 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (features_index_add_single, rb_feature_p): store single index
	  as Fixnum to reduce the number of arrays for the indexes.  based on
	  the patch by tmm1 (Aman Gupta) in [ruby-core:53216] [Bug #8048].

Sat Mar  9 00:25:57 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* marshal.c (r_object0): load prepended objects.  treat the class of
	  extended object in the included modules as prepended singleton
	  class. [ruby-core:53202] [Bug #8041]

Fri Mar  8 19:44:00 2013  Akinori MUSHA  <knu@iDaemons.org>

	* man/rake.1, man/ruby.1: Use the Pa macro to make URLs stand out.

Fri Mar  8 13:20:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/pathname/pathname.c (path_f_pathname): rdoc for Pathname()

Fri Mar  8 12:00:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* man/rake.1: Document ENVIRONMENT variables on RAKE(1) manpage

Fri Mar  8 10:44:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/webrick/httpproxy.rb: Fix typos in HTTPProxyServer [Bug #8013]
	  Patch by Nobuhiro IMAI [ruby-core:53127]

Fri Mar  8 03:16:15 2013  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* class.c (rb_mod_ancestors): Include singleton_class in ancestors
	  list [Feature #8035]

	* test/ruby/test_module.rb (class): test for above

	* test/ruby/marshaltestlib.rb (module): adapt test

	* NEWS: list change

Thu Mar  7 14:21:37 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): pass keyword arguments to zsuper,
	  with current values.  [ruby-core:53114] [Bug #8008]

Thu Mar  7 12:53:47 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/commands/setup_command.rb:  Install .pem files.
	* test/rubygems/test_gem_commands_setup_command.rb:  Test for the
	  above.

	* lib/rubygems/spec_fetcher.rb:  Test HTTPS upgrade with URI::HTTPS,
	  not URI::HTTP.  Fixes bug in automatic HTTPS upgrade.
	* test/rubygems/test_gem_spec_fetcher.rb:  Test for the above.

	* lib/rubygems.rb:  Version 2.0.2

	* lib/rubygems/test_utilities.rb:  Ensure scheme and uri class match.

Thu Mar  7 10:39:04 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): Gem.ensure_gem_subdirectories now has mode
	  option since r39607.  refix of r38870.

Wed Mar  6 13:14:28 2013  Eric Hodel  <drbrain@segment7.net>

	* test/rubygems/test_gem_spec_fetcher.rb:  Removed unused variable.

Wed Mar  6 08:10:15 2013  Eric Hodel  <drbrain@segment7.net>

	* test/rubygems/test_require.rb:  Fix tests when 'a.rb' exists.
	  [ruby-trunk - Bug #7749]

Wed Mar  6 08:00:59 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems.rb:  Allow specification of directory permissions.
	  [ruby-trunk - Bug #7713]
	* test/rubygems/test_gem.rb:  Test for the above.

Wed Mar  6 07:40:21 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/commands/query_command.rb:  Only fetch remote specs when
	  showing details.  [ruby-trunk - Bug #8019]  RubyGems bug #487
	* lib/rubygems/remote_fetcher.rb:  ditto.
	* lib/rubygems/security/policy.rb:  ditto.
	* test/rubygems/test_gem_commands_query_command.rb:  Test for the
	  above.

	* lib/rubygems/security.rb:  Make OpenSSL optional for RubyGems.
	* lib/rubygems/commands/cert_command.rb:  ditto.

	* lib/rubygems/config_file.rb:  Display file with YAML error, not
	  ~/.gemrc

	* lib/rubygems/remote_fetcher.rb:  Only create gem subdirectories when
	  installing gems.
	* lib/rubygems/dependency_resolver.rb:  ditto.
	* lib/rubygems/test_utilities.rb:  ditto.
	* test/rubygems/test_gem_commands_fetch_command.rb:  Test for the
	  above.

	* lib/rubygems/spec_fetcher.rb:  Only try to upgrade
	  http://rubygems.org to HTTPS
	* test/rubygems/test_gem_spec_fetcher.rb:  Test for the above.

	* lib/rubygems.rb:  Update win_platform? check for JRuby compatibility.

	* test/rubygems/test_gem_installer.rb:  Update for Ruby 1.9.2
	  compatibility

Wed Mar  6 01:19:28 2013  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* enumerator.c (enumerator_with_index, lazy_take): use INT2FIX(0)
	  instead of INT2NUM(0).

	* ext/bigdecimal/bigdecimal.c (BigMath_s_exp): ditto.

	* ext/fiddle/function.c (function_call): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509store_initialize): ditto.

	* process.c (proc_getsid): ditto.

	* transcode.c (econv_finish): ditto.

Tue Mar  5 21:36:43 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_prepend_module): check redefinition of built-in optimized
	  methods.  [ruby-dev:47124] [Bug #7983]

	* vm.c (rb_vm_check_redefinition_by_prepend): ditto.

Tue Mar  5 20:29:25 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (mnew): revert r39224.  [ruby-core:53038] [Bug #7988]

Tue Mar  5 20:23:54 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_check_arity): make a static inline
	  function so it can be used as an expression and argc would be
	  evaluated only once.

Tue Mar  5 12:30:55 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems.rb:  Bump version to 2.0.1 for upcoming bugfix release

	* lib/rubygems/ext/ext_conf_builder.rb:  Restore ruby 1.8 compatibility
	  for [Bug #7698]
	* test/rubygems/test_gem_installer.rb:  Ditto.

	* lib/rubygems/package.rb:  Restore ruby 1.8 compatibility.

	* test/rubygems/test_gem_dependency_installer.rb:  Fix warnings

Tue Mar  5 12:24:23 2013  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c (enumerator_with_index):  Restore handling of a nil memo
	  from r39594.

Tue Mar  5 10:40:22 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/objspace/objspace.c (count_nodes): count also newly added nodes,
	  and fix key for unknown node.  patch by tmm1 (Aman Gupta) in
	  [ruby-core:53130] [Bug #8014]

Tue Mar  5 10:20:16 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (enumerator_with_index_i): allow Bignum as offset, to
	  get rid of conversion exception and integer overflow.
	  [ruby-dev:47131] [Bug #8010]

	* numeric.c (rb_int_succ, rb_int_pred): shortcut optimization for
	  Bignum.

Tue Mar  5 10:02:48 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/ext/ext_conf_builder.rb (Gem::Ext::ExtConfBuilder.build):
	  clear DESTDIR so RUBYARCHDIR and RUBYLIBDIR are not be overridden.
	  [Bug #7698]

Mon Mar  4 15:33:40 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/ext/ext_conf_builder.rb (Gem::Ext::ExtConfBuilder.build):
	  fix for unusual cases again.  install to a temporary directory once
	  and move installed files to the destination directory, if it is same
	  as the current directory.  [Bug #7698]

Mon Mar  4 14:13:36 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (miniruby, ruby): move MAINLIBC because linker arguments
	  must appear after object files with newer versions of gcc.  patch by
	  tmm1 (Aman Gupta) in [ruby-core:53121] [Bug #8009]

Mon Mar  4 10:23:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* encoding.c: Typo in Encoding overview by Tom Wardrop [GH fixes #255]

Sun Mar  3 12:35:08 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#libpath_env): set runtime library path for
	  the case rpath is disabled.

Sun Mar  3 12:17:47 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/ext/ext_conf_builder.rb
	  (Gem::Ext::ExtConfBuilder.hack_for_obsolete_style_gems): remove
	  circular dependencies in install-so too.  [ruby-core:52882]
	  [Bug #7698]

Sun Mar  3 07:33:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/socket/tcpserver.c: Grammar for TCPServer.new from r39554

Sun Mar  3 01:17:20 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rubygems/ext/ext_conf_builder.rb
	  (Gem::Ext::ExtConfBuilder.hack_for_obsolete_style_gems): remove
	  circular dependencies for old style gems which locate extconf.rb on
	  the toplevel.  [ruby-core:53059] [ruby-trunk - Bug #7698]

	* lib/rubygems/ext/ext_conf_builder.rb (Gem::Ext::ExtConfBuilder.build):
	  use RUBYOPT instead of -r option, and revert some tests.  [Bug #7698]

	* lib/rubygems/ext/ext_conf_builder.rb (Gem::Ext::ExtConfBuilder.build):
	  revert use of temporary directory for build, to work some buggy
	  extconf.rb which cannot build outside the source directory.
	  [ruby-core:53056] [Bug #7698]

Sun Mar  3 00:04:20 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend (CPPFLAGS), lib/mkmf.rb (MakeMakefile#create_makefile):
	  define RUBY_EXPORT for static-linked-ext mswin.  [Bug #7960]

Sat Mar  2 22:49:47 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (ENCOBJS, EXTOBJS, config.h): definitions for
	  static-linked-ext.  [Bug #7960]

Sat Mar  2 17:34:19 2013  Tanaka Akira  <akr@fsij.org>

	* lib/webrick/utils.rb: use Socket.tcp_server_sockets to create server
	  sockets.
	  fix [Bug #7100] https://bugs.ruby-lang.org/issues/7100
	  reported by sho-h (Sho Hashimoto).

Sat Mar  2 02:45:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c: typo in comment patch by Nami-Doc [Github fixes #253]

Sat Mar  2 01:33:17 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* Merge Onigmo 0fe387da2fee089254f6b04990541c731a26757f
	  v5.13.3 [Bug#7972] [Bug#7974]

Fri Mar  1 11:09:06 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/fileutils.rb:  Revert r34669 which altered the way
	  metaprogramming in FileUtils occurred.  [ruby-trunk - Bug #7958]

	* test/fileutils/visibility_tests.rb:  Refactored tests of FileUtils
	  options modules to expose bug found in #7958
	* test/fileutils/test_dryrun.rb:  ditto.
	* test/fileutils/test_nowrite.rb:  ditto.
	* test/fileutils/test_verbose.rb:  ditto.

Fri Mar  1 09:18:00 2013  Zachary Scott <zachary@zacharyscott.net>

	* lib/psych.rb: specify in rdoc what object is returned in parser
	  By Adam Stankiewicz [Github tenderlove/psych#133]

Fri Mar  1 07:21:41 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/ext/builder.rb:  Fix incompatibilities when installing
	  extensions.  Patch by Nobu.
	  [ruby-trunk - Bug #7698] [ruby-trunk - Bug #7971]
	* lib/rubygems/ext/ext_conf_builder.rb:  ditto.
	* lib/rubygems/installer.rb:  ditto.
	* test/rubygems/test_gem_ext_ext_conf_builder.rb:  Test for the above.
	* test/rubygems/test_gem_installer.rb:  ditto.

	* lib/rubygems/commands/sources_command.rb:  Prefer HTTPS over HTTP.
	* lib/rubygems/defaults.rb:  ditto
	* lib/rubygems/dependency_resolver.rb:  Ditto.
	* lib/rubygems/source.rb:  ditto.
	* lib/rubygems/spec_fetcher.rb:  ditto.
	* lib/rubygems/specification.rb:  ditto.
	* lib/rubygems/test_utilities.rb:  ditto.
	* test/rubygems/test_gem.rb:  Test for the above.
	* test/rubygems/test_gem_commands_sources_command.rb:  ditto.
	* test/rubygems/test_gem_dependency_resolver_api_set.rb:  ditto.
	* test/rubygems/test_gem_remote_fetcher.rb:  ditto.
	* test/rubygems/test_gem_source.rb:  ditto.
	* test/rubygems/test_gem_spec_fetcher.rb:  ditto.

Fri Mar 1 03:25:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/psych/lib/psych.rb: rdoc for Psych overview by Adam Stankiewicz
	  [Github tenderlove/psych#134]

Thu Feb 28 22:57:48 2013  Koichi Sasada  <ko1@atdot.net>

	* compile.c (iseq_compile_each): remove redundant trace(line)
	  instruction. for example, at the following script
	    def m()
	      p:xyzzy
	      1
	      2
	    end
	  compiler ignores `1' because there is no effect. However,
	  `trace(line)' instruction remains in bytecode.
	  This modification removes such redundant trace(line) instruction.

	* test/ruby/test_iseq.rb: add a test.

Thu Feb 28 22:23:27 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c (inspect_sockaddr): don't show that Unix
	  domain socket filename is bigger than sizeof(sun_path).
	  This limit is not rigid on some platforms such as Darwin and SunOS.

Thu Feb 28 21:33:01 2013  WATANABE Hirofumi  <eban@ruby-lang.org>

	* configure.in(AC_DISABLE_OPTION_CHECKING): avoid warning "WARNING:
	  Unrecognized options: --with-PACKAGE".

Thu Feb 28 20:22:04 2013  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_data_to_ary): fix condition.
	  r34303 introduces a bug to avoid all line information from
	  a result of ISeq#to_a. This is a regression problem from 2.0.0p0.

	* test/ruby/test_iseq.rb: add a test of lines after ISeq#to_a.

Thu Feb 28 08:20:33 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/available_set.rb:  Undent for style

	* lib/rubygems/dependency_installer.rb:  Pick latest prerelease gem to
	  install.  Fixes RubyGems bug #468.
	* test/rubygems/test_gem_dependency_installer.rb:  Test for the above.

	* lib/rubygems/dependency_installer.rb:  Don't display "Done installing
	  documentation" if documentation will not be installed.
	* lib/rubygems/rdoc.rb:  ditto

	* lib/rubygems/dependency_list.rb:  Use Array#concat for Ruby 1.x
	  performance.

	* lib/rubygems/installer.rb:  Use formatted program name when comparing
	  executables.  RubyGems pull request #471
	* test/rubygems/test_gem_installer.rb:  Test for the above.

	* lib/rubygems/package.rb:  Use more explicit feature check to work
	  around JRuby bug #552

	* lib/rubygems/ssl_certs/GeoTrust_Global_CA.pem:  Added GeoTrust root
	  certificate.

	* test/rubygems/test_gem_source_list.rb:  Use "example" instead of real
	  hostname

Thu Feb 28 05:57:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c: rdoc formatting for Thread, ThreadGroup, and ThreadError

Thu Feb 28 02:42:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* vm.c: Typo in overview for example of Thread#status returning false
	  Reported by Lee Jarvis

Wed Feb 27 22:54:27 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (union_sockaddr): make it longer for SunOS
	  and Darwin.

Wed Feb 27 21:14:34 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/security.rb (REXML::Security): create.
	* lib/rexml/rexml.rb: move entity_expansion_limit and
	  entity_expansion_text_limit accessors to ...
	* lib/rexml/security.rb: ... here.
	* lib/rexml/document.rb: use REXML::Security.
	* lib/rexml/text.rb: use REXML::Security.
	* test/rexml/test_document.rb: use REXML::Security.

Wed Feb 27 19:53:32 2013  Benoit Daloze  <eregontp@gmail.com>

	* vm.c (Thread): fix typos in overview

Wed Feb 27 13:21:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* vm.c (Thread): Typo in overview, swap setting and getting

Wed Feb 27 13:02:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* vm.c (Thread): Documentation overview of Thread class

Wed Feb 27 12:57:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c (rb_thread_wakeup): rdoc formatting

Wed Feb 27 12:53:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c (rb_thread_group): rdoc formatting

Wed Feb 27 12:33:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/ostruct.rb: Typo in OpenStruct overview [Github Fixes #251]
	  Patch by Chun-wei Kuo

Wed Feb 27 12:13:32 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.h (END_INSN): llvm-gcc may optimize out reg_cfp and cause
	  Stack/cfp consistency error when the instruction doesn't use reg_cfp.
	  Usually instructions use PUSH() but for example trace doesn't.
	  This hack cause speed down but you shouldn't use llvm-gcc, use clang.
	  [Bug #7938]

Wed Feb 27 10:23:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c (thread_raise_m): rdoc formatting

Tue Feb 26 23:32:44 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/document.rb: move entity_expansion_limit accessor to ...
	* lib/rexml/rexml.rb: ... here for consistency.
	* lib/rexml/document.rb (REXML::Document.entity_expansion_limit):
	  deprecated.
	* lib/rexml/document.rb (REXML::Document.entity_expansion_limit=):
	  deprecated.

Tue Feb 26 23:26:13 2013  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/document.rb: move entity_expansion_text_limit accessor to ...
	* lib/rexml/rexml.rb: ... here to make rexml/text independent from
	  REXML::Document. It causes circular require.
	* lib/rexml/document.rb (REXML::Document.entity_expansion_text_limit):
	  deprecated.
	* lib/rexml/document.rb (REXML::Document.entity_expansion_text_limit=):
	  deprecated.
	* lib/rexml/text.rb: add missing require "rexml/rexml" for
	  REXML.entity_expansion_text_limit.
	  Reported by Robert Ulejczyk. Thanks!!! [ruby-core:52895] [Bug #7961]

Tue Feb 26 15:12:11 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb: reconstruct comma separated list values.  a
	  command line to Windows batch file is split not only by spaces
	  and equal signs but also by commas and semicolons.

Tue Feb 26 15:04:19 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (unexpand_shvar): get rid of non-portable shell
	  behavior on OpenBSD, so no extra quotes.  [Bug #7959]

Tue Feb 26 10:24:49 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (IS_LABEL_POSSIBLE): allow labels for keyword arguments just
	  after method definition without a parenthesis.  [ruby-core:52820]
	  [Bug #7942]

Tue Feb 26 04:50:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* error.c: clarify reason for sleep in SignalException example

Tue Feb 26 03:47:00 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c: clarify a document of SignalException. Process.kill()
	  doesn't have any guarantee when signal will be delivered.
	  [Bug #7951] [ruby-core:52864]

Mon Feb 25 23:51:04 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/version.h: bump RUBY_API_VERSION same as RUBY_VERSION.

Mon Feb 25 21:03:34 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (str_byte_substr): don't set coderange if it's not known.
	  [Bug #7954] [ruby-dev:47108]

Mon Feb 25 16:47:02 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (realclean-local): miniprelude.c is made by srcs, so it
	  should not removed by distclean but by realclean.  [Bug #6807]

Mon Feb 25 16:30:30 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/config_file.rb:  Lazily load .gem/credentials to only
	  check permissions when necessary.  RubyGems bug #465
	* test/rubygems/test_gem_config_file.rb:  Test for the above.

	* test/rubygems/test_gem_commands_push_command.rb:  Remove duplicated
	  test.

Mon Feb 25 15:47:18 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/depend (ARFLAGS): VisualC++ linker does not allow spaces between
	  output option and the output file name.  [Bug #7950]

	* enc/depend (RANLIB): set default command to do nothing, or make the
	  entire line a label on Windows.

Mon Feb 25 14:41:07 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#init_mkmf): default libdirname to libdir.

	* tool/rbinstall.rb: ditto.

Mon Feb 25 13:12:39 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (setup): find Setup file from target_os 1. by
	  suffix (e.g. Setup.nacl, Setup.atheos), 2. by "platform"
	  option (e.g. Setup.nt, Setup.emx), and 3. default Setup.  And
	  Setup.dj had been removed.

Mon Feb 25 12:48:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c: Document Thread::new, clean up ::fork and mention calling
	  super if subclassing Thread

Mon Feb 25 12:38:50 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: don't test ss_family and ss_len member of
	  struct sockaddr_storage.  They are not used now except SunOS
	  specific code.

Mon Feb 25 11:03:38 2013  Akinori MUSHA  <knu@iDaemons.org>

	* configure.in (unexpand_shvar): Use the numeric comparison
	  operator instead of '==' which is a ksh extension. [Bug #7941]

Mon Feb 25 02:37:56 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket: define and use union_sockaddr instead of struct
	  sockaddr_storage for less casts.

	* ext/socket/rubysocket.h (union_sockaddr): defined.

	* ext/socket/socket.c (sock_accept): use union_sockaddr.
	  (sock_accept_nonblock): ditto.
	  (sock_sysaccept): ditto.
	  (sock_s_getnameinfo): ditto.

	* ext/socket/basicsocket.c (bsock_getsockname): ditto.
	  (bsock_getpeername): ditto.
	  (bsock_local_address): ditto.
	  (bsock_remote_address): ditto.

	* ext/socket/ancdata.c (bsock_recvmsg_internal): ditto.

	* ext/socket/init.c (recvfrom_arg): ditto.
	  (recvfrom_blocking): ditto.
	  (rsock_s_recvfrom): ditto.
	  (rsock_s_recvfrom_nonblock): ditto.
	  (rsock_getfamily): ditto.

	* ext/socket/raddrinfo.c (rb_addrinfo_t): ditto.
	  (ai_get_afamily): ditto.
	  (inspect_sockaddr): ditto.
	  (addrinfo_mdump): ditto.
	  (addrinfo_mload): ditto.
	  (addrinfo_getnameinfo): ditto.
	  (addrinfo_ip_port): ditto.
	  (extract_in_addr): ditto.
	  (addrinfo_ipv6_to_ipv4): ditto.
	  (addrinfo_unix_path): ditto.

	* ext/socket/tcpserver.c (tcp_accept): ditto.
	  (tcp_accept_nonblock): ditto.
	  (tcp_sysaccept): ditto.

	* ext/socket/ipsocket.c (ip_addr): ditto.
	  (ip_peeraddr): ditto.
	  (ip_s_getaddress): ditto.

Sun Feb 24 21:15:05 2013  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: [ruby-core:52303]

Sun Feb 24 15:33:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rb_random_ulong_limited): limit is inclusive, but generic
	  rand method should return a number less than it, so increase for the
	  difference.  [ruby-core:52779] [Bug #7935]

Sun Feb 24 15:32:36 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rb_random_ulong_limited): limit is inclusive, but generic
	  rand method should return a number less than it, so increase for the
	  difference.  [ruby-core:52779] [Bug #7935]

Sun Feb 24 15:14:43 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Removed duplicate Accept-Encoding in Net::HTTP#get.
	  [ruby-trunk - Bug #7924]
	* test/net/http/test_http.rb:  Test for the above.

Wed Feb 20 14:28:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c: Document ThreadGroup::Default

Wed Feb 20 14:23:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c: Grammar for #backtrace_locations and ::handle_interrupt

Sun Feb 24 13:35:57 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): block level control frame does not
	  have method entry, so obtain the method entry from method top-level
	  control frame to be compared with refined method entry.
	  [ruby-core:52750] [Bug #7925]

Wed Feb 20 13:23:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* object.c: Document methods receiving string and convert to symbol
	  Patch by Stefan Rusterholz
	* vm_eval.c: ditto
	* vm_method.c: ditto

Wed Feb 20 07:20:56 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sigsegv): suppress unused result warning. Because
	  write(2) is marked __warn_unused_result__ on Linux glibc.

Sun Feb 24 07:50:53 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_arguments): no keyword check if any keyword rest
	  argument exists, even unnamed.  [ruby-core:52744] [Bug #7922]

Sat Feb 23 16:51:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c: Documentation for Thread#backtrace_locations

Sat Feb 23 16:05:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* vm.c: Typo in ObjectSpace::WeakMap overview

Sat Feb 23 16:00:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* thread.c: Improved rdoc for ::handle_interrupt, ::pending_interrupt?
	  and #pending_interrupt?

Sat Feb 23 12:26:43 2013  Akinori MUSHA  <knu@iDaemons.org>

	* misc/ruby-electric.el (ruby-electric-curlies)
	  (ruby-electric-matching-char, ruby-electric-bar): Avoid electric
	  insertion when there is a prefix argument.

	* misc/ruby-electric.el (ruby-electric-insert)
	  (ruby-electric-cua-replace-region-p)
	  (ruby-electric-cua-replace-region): Avoid electric insertion and
	  fall back when cua-mode is enabled and a region is active.

Sat Feb 23 12:35:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c: Document #<=> return values and formatting
	* bignum.c: ditto
	* file.c: ditto
	* object.c: ditto
	* numeric.c: ditto
	* rational.c: ditto
	* string.c: ditto
	* time.c: ditto

Sat Feb 23 10:50:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* array.c (rb_ary_diff, rb_ary_and, rb_ary_or): Document return order
	  [RubySpec #7803]

Sat Feb 23 10:17:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* object.c (rb_obj_comp): Documenting Object#<=> return values
	  Patch by Stefan Rusterholz

Sat Feb 23 09:48:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (file_s_fnmatch, fnmatch_brace): encoding-incompatible pattern
	  and string do not match, instead of exception.  [ruby-dev:47069]
	  [Bug #7911]

Sat Feb 23 08:57:46 2013  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* doc/NEWS-*: Update NEWS from their respective branches

Sat Feb 23 08:14:43 2013  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* NEWS: many additions for Ruby 2.0.0

	* object.c: Add doc for Module.prepended

Sat Feb 23 07:52:53 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in: reorder library flags which may refer library
	  names.  [Bug #7913]

Fri Feb 22 23:46:20 2013  CHIKANAGA Tomoyuki  <nagachika@ruby-lang.org>

	* lib/rexml/document.rb (REXML::Document.entity_expansion_text_limit):
	  fix a typo in comment in r39384.

Fri Feb 22 18:31:46 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/rexml/document.rb (REXML::Document.entity_expansion_text_limit):
	  new attribute to read/write entity expansion text limit.  the default
	  limit is 10Kb.

	* lib/rexml/text.rb (REXML::Text.unnormalize): check above attribute.

Fri Feb 22 17:36:23 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/test_rbconfig.rb (TestRbConfig): fix r39372.
	  It must see RbConfig::CONFIG instead of CONFIG.

Fri Feb 22 14:55:41 2013  Naohisa Goto  <ngotogenome@gmail.com>

	* signal.c (ruby_abort): fix typo in r39354 [Bug #5014]

Fri Feb 22 12:46:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (rb_random_ulong_limited): fix error message for negative
	  value.  [ruby-dev:47061] [Bug #7903]

Fri Feb 22 11:36:45 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/test_rbconfig.rb (TestRbConfig): skip user defined values by
	  configuration options.  [Bug #7902]

Fri Feb 22 11:33:42 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#init_mkmf): adjust default library path
	  for multiarch.  [Bug #7874]

Fri Feb 22 11:10:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* enum.c (Enumerable#chunk: Improved examples, grammar, and formatting
	  Patch by Dan Bernier and Rich Bruchal of newhaven.rb
	  [Github documenting-ruby/ruby#8]

Fri Feb 22 11:00:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* numeric.c: Examples and formatting for Numeric and Float
	  Based on a patch by Zach Morek and Oren K of newhaven.rb
	  [Github documenting-ruby/ruby#5]

Fri Feb 22 07:04:41 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/installer.rb (build_extensions):  Create extension
	  install destination before building extension.  Patch by Kenta Murata.
	  [ruby-trunk - Bug #7897]
	* test/rubygems/test_gem_installer.rb:  Test for the above.

Fri Feb 22 06:30:57 2013  Eric Hodel  <drbrain@segment7.net>

	* doc/globals.rdoc:  Document what setting $DEBUG does.

	* doc/globals.rdoc:  Added pointer to $-d for full documentation.

Fri Feb 22 06:27:07 2013  Eric Hodel  <drbrain@segment7.net>

	* doc/globals.rdoc:  Document what setting $VERBOSE does.  [Bug #7899]

	* doc/globals.rdoc:  Added pointer to $-w and $-v for full
	  documentation.

Fri Feb 22 02:33:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/abbrev.rb: Add words parameter to Abbrev::abbrev
	  Patch by Devin Weaver [Github documenting-ruby/ruby#7]

Thu Feb 21 17:28:14 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/merger.rb: add interaction when only ChangeLog is modified.

Thu Feb 21 16:34:46 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* signal.c (check_stack_overflow): extract duplicated code and get rid
	  of declaration-after-statement.  [Bug #5014]

Thu Feb 21 14:14:13 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sigsegv): avoid to use async signal unsafe functions
	  when nested sigsegv is happen.
	  [Bug #5014] [ruby-dev:44082]

Thu Feb 21 13:47:59 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (rb_group_member): added an error check. SUS says,
	  getgroups(small_value) may return EINVAL.

Thu Feb 21 13:37:07 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (RB_MAX_GROUPS): moved to
	* internal.h (RB_MAX_GROUPS): here.

	* file.c (rb_group_member): use RB_MAX_GROUPS instead of
	  RUBY_GROUP_MAX. They are the same.

Thu Feb 21 13:15:40 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (access_internal): removed.
	* file.c (rb_file_readable_real): use access() instead of
	  access_internal().
	* file.c (rb_file_writable_real): ditto.
	* file.c (rb_file_executable_real): ditto.

Thu Feb 21 13:04:59 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (eaccess): use access() when not using setuid nor setgid.
	  This is minor optimization.

Thu Feb 21 12:56:19 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (rb_group_member): get rid of NGROUPS dependency.
	  [Bug #7886] [ruby-core:52537]

Thu Feb 21 12:45:03 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): try two levels upper for stripping
	  libdir name.  [Bug #7874]

	* configure.in (libdir_basename): expand with multiarch in configure,
	  not to defer the expansion till ruby.pc.in and mkmf.rb.  [Bug #7874]

	* configure.in (libdir_basename): also -rpath and -install_name flags
	  are affected when libruby directory changes.  [Bug #7874]

Wed Feb 20 19:27:02 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (HAVE_RB_SCAN_ARGS_OPTIONAL_HASH): for
	  rb_scan_args() optional hash feature.  [Bug #7861]

Wed Feb 20 18:02:26 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (target_os): do not strip -gnu suffix on Linux if
	  --target is given explicitly.  [Bug #7874]

	* configure.in (libdirname): adjust library path name which libruby
	  files will be installed.  [Bug #7874]

	* tool/rbinstall.rb (libdir): ditto.

Wed Feb 20 13:37:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/pty/pty.c: Documentation for the PTY module

Wed Feb 20 12:18:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* object.c: Document Data class [Bug #7890] [ruby-core:52549]
	  Patch by Matthew Mongeau

Wed Feb 20 11:50:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/mutex_m.rb: Add rdoc for Mutex_m module

Wed Feb 20 09:34:43 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/commands/update_command.rb:  Create the installer after
	  options are processed.  [ruby-trunk - Bug #7779]
	* test/rubygems/test_gem_commands_update_command.rb:  Test for the
	  above.

Wed Feb 20 07:51:19 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/installer.rb:  Use gsub instead of gsub! to avoid
	  altering @bin_dir.  Fixes tests on windows.  [ruby-trunk - Bug #7885]

Tue Feb 19 20:50:00 2013  Kenta MURATA  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.gemspec: bump to 1.2.0.
	  [ruby-core:51777] [Bug #7761]

Tue Feb 19 13:07:25 2013  Akinori MUSHA  <knu@iDaemons.org>

	* ext/syslog/syslog.c (Init_syslog): Define inspect as a singleton
	  method and remove it as an instance method. [Bug #6502]

Tue Feb 19 12:30:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* object.c: rdoc formatting for Kernel#Array()
	* array.c: Add rdoc for Array() method to Creating Arrays section

Tue Feb 19 10:35:52 2013  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c (class OpenSSL):  Use only inner parenthesis in
	  create_extension examples.

Tue Feb 19 10:27:12 2013  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c (class OpenSSL):  Fixed ExtensionFactory example.
	  Patch by Richard Bradley.  [ruby-trunk - Bug #7551]

Tue Feb 19 08:32:11 2013  Koichi Sasada  <ko1@atdot.net>

	* vm_eval.c (vm_call0_body): check interrupts after method dispatch
	  from C methods. [Bug #7878]

Tue Feb 19 08:14:40 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/installer.rb:  Fixed placement of executables with
	  --user-install.  [ruby-trunk - Bug #7779]
	* test/rubygems/test_gem_installer.rb:  Test for above.

Tue Feb 19 06:04:06 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_dump: FreeBSD ports' libexecinfo's backtrace(3) can't trace
	  beyond signal trampoline, and as described in r38342 it can't
	  trace on -O because it see stack frame pointers.
	  libunwind unw_backtrace see dwarf information in the binary
	  and it works with -O (without frame pointers).

	* configure.in: remove r38342's hack and check libunwind.

Tue Feb 19 04:26:29 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: check whether backtrace(3) works well or not.

	* vm_dump.c: set HAVE_BACKTRACE 0 if BROKEN_BACKTRACE.

Mon Feb 18 16:30:18 2013  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb (IPAddr#in6_addr): Fix a typo with the closing
	  parenthesis.

Mon Feb 18 12:32:24 2013  Akinori MUSHA  <knu@iDaemons.org>

	* lib/ipaddr.rb (IPAddr#in6_addr): Fix the parser so that it can
	  recognize IPv6 addresses with only one edge 16-bit piece
	  compressed, like [::2:3:4:5:6:7:8] or [1:2:3:4:5:6:7::].
	  [Bug #7477]

Mon Feb 18 10:09:54 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (unexpand_shvar): regularize a shell variable by
	  unexpanding shell variables in it.

Sun Feb 17 20:55:44 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compar.c (rb_invcmp): compare by inversed comparison, with preventing
	  from infinite recursion.  [ruby-core:52305] [Bug #7870]

	* string.c (rb_str_cmp_m), time.c (time_cmp): get rid of infinite
	  recursion.

Sun Feb 17 17:23:22 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: remove extra topdir in VPATH, which was in
	  win32/Makefile.sub for some reason and moved from there.
	  [ruby-dev:46998] [Bug #7864]

Sun Feb 17 01:19:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* ext/psych/lib/psych/y.rb: Document Kernel#y by Adam Stankiewicz
	  [Github tenderlove/psych#127]

Sun Feb 17 00:52:14 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/mkconfig.rb: remove prefix from rubyarchdir.
	  r39267 expands variables, it changes expansion timing,
	  breaks RbConfig::CONFIG["includedir"] and building
	  extension libraries with installed ruby.

Sat Feb 16 20:51:17 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c (ENV_IN_HEAP_P): fix off-by-one error.

Sat Feb 16 20:47:16 2013  Akinori MUSHA  <knu@iDaemons.org>

	* configure.in (LIBRUBY_DLDFLAGS): Fix a bug where --with-opt-dir
	  options given were not reflected to LIBRUBY_DLDFLAGS on many
	  platforms including Linux and other GNU-based systems, NetBSD,
	  AIX and BeOS.

Sat Feb 16 20:43:20 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (rsock_recvmsg): ignore truncated part of
	  socket address returned from recvmsg().

	* ext/socket/init.c (recvfrom_blocking): ignore truncated part of
	  socket address returned from recvfrom().
	  (rsock_s_recvfrom_nonblock): ditto.

Sat Feb 16 20:05:26 2013  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/ruby/test_thread.rb: fixed typo
	  patched by Hiroki Matsue via https://github.com/ruby/ruby/pull/248

Sat Feb 16 16:08:35 2013  Koichi Sasada  <ko1@atdot.net>

	* vm.c (rb_thread_mark): mark a working Proc of bmethod
	  (a method defined by define_method) even if the method was removed.
	  We could not trace working Proc object which represents the body
	  of bmethod if the method was removed (alias/undef/overridden).
	  Simply, it was mark miss.
	  This patch by Kazuki Tsujimoto. [Bug #7825]

	  NOTE: We can brush up this marking because we do not need to mark
	  `me' on each living control frame. We need to mark `me's
	  only if `me' was free'ed. This is future work after Ruby 2.0.0.

	* test/ruby/test_method.rb: add a test.

Sat Feb 16 15:45:56 2013  Koichi Sasada  <ko1@atdot.net>

	* proc.c (rb_binding_new_with_cfp): create binding object even if
	  the frame is IFUNC. But return a ruby-level binding to keep
	  compatibility.
	  This patch fix degradation introduced from r39067.
	  [Bug #7774] [ruby-dev:46960]

	* test/ruby/test_settracefunc.rb: add a test.

Sat Feb 16 13:40:13 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (shvar_to_cpp): do not substitute exec_prefix itself
	  with RUBY_EXEC_PREFIX, which cause recursive definition.
	  [ruby-core:52296] [Bug #7860]

Sat Feb 16 13:13:04 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/io-console.gemspec: bump to 0.4.2.  now explicitly
	  requires ruby 1.9.3 or later.  [Bug #7847]

	* ext/io/console/console.c (console_dev): compatibility with ruby 1.8.

	* ext/io/console/console.c (rawmode_opt, console_dev): compatibility
	  with ruby 1.9.  [ruby-core:52220] [Bug #7847]

Sat Feb 16 12:45:50 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: unexpand arch sitearch and exec_prefix values, so
	  directly specified bindir, libdir, rubyprefix, etc can be properly
	  substituted.  [ruby-core:52296] [Bug #7860]

Sat Feb 16 12:15:20 2013  Aaron Patterson <aaron@tenderlovemaking.com>

	* parse.y: add dtrace probe for symbol create.

	* probes.d: ditto

Sat Feb 16 09:27:37 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: don't test sys/feature_tests.h which is not
	  used now.
	  It was included in r7901 as "bug of gcc 3.0 on Solaris 8 ?".

Sat Feb 16 09:24:37 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: reorder header tests to consider inclusion
	  order in rubysocket.h.

Sat Feb 16 08:42:58 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in, ext/socket/extconf.rb: test netinet/in_systm.h in
	  ext/socket/extconf.rb instead of configure.in.

	  Originally, netinet/in_systm.h is included for NextStep, OpenStep,
	  and Rhapsody.  [ruby-core:1596]

Sat Feb 16 07:55:40 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: don't test xti.h here.

	* ext/socket/extconf.rb: test xti.h here.

	  Originally, xti.h is included for IRIX [ruby-core:14447].

Sat Feb 16 07:16:49 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test struct sockaddr_un and its member,
	  sun_len.

	* ext/socket/sockport.h (INIT_SOCKADDR_UN): new macro defined.

	* ext/socket/socket.c (sock_s_pack_sockaddr_un): use INIT_SOCKADDR_UN.

	* ext/socket/unixsocket.c (rsock_init_unixsock): ditto.

	* ext/socket/raddrinfo.c (init_unix_addrinfo): ditto.
	  (addrinfo_mload): ditto.

Sat Feb 16 07:05:59 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/sockport.h (INIT_SOCKADDR_IN): don't need family
	  argument.  it is always AF_INET.

	* ext/socket/raddrinfo.c (make_inetaddr): follow INIT_SOCKADDR_IN
	  change.
	  (addrinfo_ipv6_to_ipv4): ditto.

Sat Feb 16 04:21:07 2013  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: workaround for mswin/mingw build problem.
	  sendmsg emulation in win32/win32.c is not enough.

Sat Feb 16 00:19:20 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: use all all tested available headers for
	  have_func.

Fri Feb 15 22:21:37 2013  Akinori MUSHA  <knu@iDaemons.org>

	* configure.in: Fix a bug introduced in r38342 that the cflagspat
	  substitution is messed up by the way CFLAGS and optflags are
	  modified, which affected FreeBSD and NetBSD/amd64 when
	  configured to use libexecinfo.  This bug resulted in CFLAGS and
	  CXXFLAGS in RbConfig::CONFIG having warnflags expanded in them,
	  forcing third-party C/C++ extensions to follow what warnflags
	  demands, like ANSI/ISO-C90 conformance.  ref [Bug #7101]

Fri Feb 15 20:29:11 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/sockport.h (SET_SIN_LEN): defined for strict-aliasing
	  rule.
	  (INIT_SOCKADDR_IN): ditto.

	* ext/socket/raddrinfo.c (make_inetaddr): use INIT_SOCKADDR_IN.
	  (addrinfo_ipv6_to_ipv4): ditto.

Fri Feb 15 18:24:48 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#try_run): bail out explicitly if cross
	  compiling, because it cannot work of course.

Fri Feb 15 12:34:58 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test struct sockaddr_storage directly.

	* ext/socket/rubysocket.h: use HAVE_TYPE_STRUCT_SOCKADDR_STORAGE.

Fri Feb 15 12:26:13 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/getaddrinfo.c (GET_AI): don't cast 1st argument for
	  INIT_SOCKADDR.

Fri Feb 15 08:12:11 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/sockport.h (SET_SS_LEN): removed.
	  (SET_SIN_LEN): removed.
	  (INIT_SOCKADDR): new macro.

	* ext/socket/ancdata.c (extract_ipv6_pktinfo): use INIT_SOCKADDR.

	* ext/socket/raddrinfo.c (make_inetaddr): use INIT_SOCKADDR.
	  (addrinfo_ipv6_to_ipv4): ditto.

	* ext/socket/getaddrinfo.c (GET_AI): use INIT_SOCKADDR.

Fri Feb 15 07:49:27 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb:  Update to release version of 4.0.0

	* lib/rubygems.rb:  Update to release version of 2.0.0

Fri Feb 15 07:07:27 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/sockport.h (SA_LEN): removed because unused now.
	  (SS_LEN): ditto.
	  (SIN_LEN): ditto.

Thu Feb 14 10:45:31 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_process.rb (test_setsid): Added a workaround for
	  MacOS X. Patch by nagachika. [Bug #7826] [ruby-core:52126]

Fri Feb 15 00:15:31 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/sockport.h (VALIDATE_SOCKLEN): new macro to validate
	  sa_len member of 4.4BSD socket address.

	* ext/socket/getnameinfo.c (getnameinfo): use VALIDATE_SOCKLEN,
	  instead of SA_LEN.

	* ext/socket/socket.c (sock_s_getnameinfo): use VALIDATE_SOCKLEN
	  instead of SS_LEN.

Thu Feb 14 22:25:54 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (sockaddr_len): extracted from sockaddr_obj.
	  (sockaddr_obj): add an argument to length of socket address.
	  (socket_s_ip_address_list): call sockaddr_obj with actual socket
	  address length if given, use sockaddr_len otherwise.

Thu Feb 14 20:11:23 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket: always operate length of socket address companion with
	  socket address.

	* ext/socket/rubysocket.h (rsock_make_ipaddr): add an argument for
	  socket address length.
	  (rsock_ipaddr): ditto.

	* ext/socket/ipsocket.c (ip_addr): pass length to rsock_ipaddr.
	  (ip_peeraddr): ditto.
	  (ip_s_getaddress): pass length to rsock_make_ipaddr.

	* ext/socket/socket.c (make_addrinfo): pass length to rsock_ipaddr.
	  (sock_s_getnameinfo): pass actual address length to rb_getnameinfo.
	  (sock_s_unpack_sockaddr_in): pass length to rsock_make_ipaddr.

	* ext/socket/init.c (rsock_s_recvfrom): pass length to rsock_ipaddr.
	  (rsock_s_recvfrom_nonblock): ditto.

	* ext/socket/tcpsocket.c (tcp_sockaddr): pass length to
	  rsock_make_ipaddr.

	* ext/socket/raddrinfo.c (make_ipaddr0): add an argument for socket
	  address length.  pass the length to rb_getnameinfo.
	  (rsock_ipaddr): ditto.
	  (rsock_make_ipaddr): add an argument for socket address length.
	  pass the length to make_ipaddr0.
	  (make_inetaddr): pass length to make_ipaddr0.
	  a local variable renamed.
	  (host_str): a local variable renamed.
	  (port_str): ditto.

Thu Feb 14 14:31:43 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Removed OpenSSL dependency from Net::HTTP.

	* test/net/http/test_http.rb:  Remove Zlib dependency from tests.
	* test/net/http/test_http_request.rb:  ditto.

Thu Feb 14 11:08:15 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (include_modules_at): detect cyclic prepend with original
	  method table.  [ruby-core:52205] [Bug #7841]

Thu Feb 14 10:30:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c: call method_removed hook on called class, not on
	  prepending iclass.  [ruby-core:52207] [Bug #7843]

Thu Feb 14 10:05:57 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http:  Do not handle Content-Encoding when the user sets
	  Accept-Encoding.  This allows users to handle Content-Encoding for
	  themselves.  This restores backwards-compatibility with Ruby 1.x.
	  [ruby-trunk - Bug #7831]
	* lib/net/http/generic_request.rb:  ditto.
	* lib/net/http/response.rb:  ditto
	* test/net/http/test_http.rb:  Test for the above.
	* test/net/http/test_http_request.rb:  ditto.
	* test/net/http/test_httpresponse.rb:  ditto.

Thu Feb 14 08:18:47 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: don't define HAVE_SA_LEN and HAVE_SA_LEN.
	  use HAVE_STRUCT_SOCKADDR_SA_LEN and HAVE_STRUCT_SOCKADDR_IN_SIN_LEN
	  instead.

Wed Feb 13 20:59:48 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: don't define socklen_t here, just test.

	* ext/socket/rubysocket.h: define socklen_t if not available.

Wed Feb 13 18:37:50 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (mnew): skip prepending modules and return the method bound
	  on the given class.  [ruby-core:52160] [Bug #7836]

Wed Feb 13 18:11:59 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (method_original_name): new methods Method#original_name and
	  UnboundMethod#original_name.  [ruby-core:52048] [Bug #7806]
	  [EXPERIMENTAL]

	* proc.c (method_inspect): show the given name primarily, and
	  original_id if aliased.  [ruby-core:52048] [Bug #7806]

Wed Feb 13 17:56:39 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): disable -Werror by default unless
	  development.  [ruby-core:52131] [Bug #7830]

Wed Feb 13 06:05:52 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems.rb:  Return BINARY strings from Gem.gzip and Gem.gunzip.
	  Fixes intermittent test failures.  RubyGems issue #450 by Jeremey
	  Kemper.
	* test/rubygems/test_gem.rb:  Test for the above.

Wed Feb 13 05:49:21 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test functions just after struct members.

Tue Feb 12 12:02:35 2013  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: merge JSON 1.7.7.
	  This includes security fix. [CVE-2013-0269]
	  https://github.com/flori/json/commit/d0a62f3ced7560daba2ad546d83f0479a5ae2cf2
	  https://groups.google.com/d/topic/rubyonrails-security/4_YvCpLzL58/discussion

Mon Feb 11 23:08:48 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: enable rb_cv_page_size_log test for MirOS BSD.

Mon Feb 11 20:06:38 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: use -pthread on mirbsd*.

Mon Feb 11 16:07:09 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: add SOLIBS and LIBRUBY_SO definition for mirbsd*.

Mon Feb 11 13:17:20 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rubysitearchprefix): sitearchdir and vendorarchdir
	  should use sitearch, not arch.  [ruby-dev:46964] [Bug #7823]

	* win32/Makefile.sub (config.status): site and vendor directories
	  should use sitearch, not arch.  [ruby-dev:46964] [Bug #7823]

Mon Feb 11 12:31:25 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: move OS specific header/function knowledge before
	  automatic header tests.

Mon Feb 11 11:04:29 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: move the test for -march=i486 just after
	  RUBY_UNIVERSAL_ARCH/RUBY_DEFAULT_ARCH.

Sun Feb 10 23:42:26 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test structure members just after types test.

Sun Feb 10 20:58:17 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test types just after headers test.

Sun Feb  10 16:00:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/rake/doc/MIT-LICENSE: Add license file from upstream
	* lib/rake/doc/README.rdoc: Link to license file from Rake README
	* lib/rake/version.rb: Include README rdoc for Rake module overview

Sun Feb  10 15:26:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/rake/doc/*: Sync Rake rdoc files from upstream

Sun Feb 10 15:50:02 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_exec.h (DISPATCH_ARCH_DEPEND_WAY): use __asm__ __volatile__
	  instead of asm volatile.

Sun Feb 10 15:50:02 2013  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* gc.h (SET_MACHINE_STACK_END): use __volatile__ instead of volatile.

Sun Feb 10 14:25:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* doc/rake/, lib/rake/doc/: Move Rake rdoc files to lib/rake

Sun Feb 10 12:10:25 2013  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test headers at first.

Sun Feb  10 12:00:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* doc/rake/*: Removed stale Rake static files

Sun Feb  10 09:10:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* lib/pp.rb, lib/prettyprint.rb: Documentation for PP and PrettyPrint
	  Based on a patch by Vincent Batts [ruby-core:51253] [Bug #7656]

Sat Feb  9 21:11:21 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: move header files check to the beginning of
	  "header and library section".
	  test rlim_t with sys/types.h and sys/time.h for MirOS BSD.
	  sys/types.h and sys/time.h is guarded by #ifdef and the above
	  move is required for this change.

Sat Feb  9 17:45:58 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, version.c: prevent duplicated load paths by empty
	  version string, it does not work right now.

Sat Feb  9 17:38:41 2013  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: fix arch parameters in help message.  [Bug #7804]

Sat Feb  9 13:13:00 2013  Zachary Scott  <zachary@zacharyscott.net>

	* vm_trace.c: Note about TracePoint events set, and comment on
	  Kernel#set_trace_func to prefer new TracePoint API

Sat Feb  9 10:07:47 2013  Kazuki Tsujimoto  <kazuki@callcc.net>

	* BSDL: update copyright notice for 2013.

Sat Feb  9 09:24:38 2013  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/package/old.rb:  Fix behavior only on ruby 1.8.

	* lib/rubygems/package.rb:  Include checksums.yaml.gz signatures for
	  verification.
	* test/rubygems/test_gem_package.rb:  Test for the above.

Sat Feb  9 01:23:24 2013  Tanaka Akira  <akr@fsij.org>

	* test/fiddle/helper.rb: specify libc and libm locations for MirOS BSD.

	* test/dl/test_base.rb: ditto.

Fri Feb  8 23:25:33 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: change CFLAGS temporally to test
	  ARCH_FLAG="-march=i486".

Fri Feb  8 21:19:41 2013  Tanaka Akira  <akr@fsij.org>

	* configure.in: don't define ARCH_FLAG="-march=i486" if it causes
	  compilation problem.

For the changes before 2.0.0, see doc/ChangeLog-2.0.0
For the changes before 1.9.3, see doc/ChangeLog-1.9.3
For the changes before 1.8.0, see doc/ChangeLog-1.8.0

Local variables:
coding: us-ascii
add-log-time-format: (lambda ()
  (let* ((time (current-time))
	 (system-time-locale "C")
	 (diff (+ (cadr time) 32400))
	 (lo (% diff 65536))
	 (hi (+ (car time) (/ diff 65536))))
  (format-time-string "%a %b %e %H:%M:%S %Y" (list hi lo) t)))
indent-tabs-mode: t
tab-width: 8
change-log-indent-text: 2
end:
vim: tabstop=8 shiftwidth=2
