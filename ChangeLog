Mon May 30 22:19:33 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring): don't
	  close stderr.

Mon May 30 20:22:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_signal.rb (TestSignal#test_signal_requiring): small
	  but critical typo of r31642.  sorry...
	  [Bug #4798] [ruby-core:36550]

Mon May 30 15:44:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* insns.def (opt_mult): as r31805, volatile it.
	  Without this, clang -O fails calculation.

	* numeric.c (fix_mul): ditto.

	* rational.c (f_imul): ditto.

Mon May 30 10:26:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_pow): make sure to assign the result of x * z.
	  If xz is optimized out, the value won't overflow.

Sun May 29 23:17:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* re.c (rb_reg_match): fix rdoc of Regexp#=~.
	  patched by Tsuyoshi Sawada. [Bug #4781]

Sun May 29 23:10:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/https.rb (WEBrick::HTTPRequest#parse_uri):
	  keep parse_uri as private. patched by okkez. [Bug #4773]

Sun May 29 17:53:03 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* numeric.c: add #include "interna.h" for rb_big_uminus() prototype.

Sun May 29 15:09:05 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): fix for negative value.

Sun May 29 02:16:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/net/http/utils.rb (TestNetHTTPUtils#teardown): add nil check.

Sun May 29 00:22:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec, after_exec): change from macro to function.

Sat May 28 19:30:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec, after_exec): change SIGPIPE handler to SIG_DFL
	  before calling execve(). Because r31760 reintroduced an issue that
	  system() may hang up (i.e. [ruby-dev:12261]).
	* process.c (save_sigpipe, restore_sigpipe): new.

Sat May 28 16:08:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (Init_signal, default_handler): change default SIGPIPE handler
	  from empty function to SIG_IGN. [ruby-dev:43215]
	* signal.c (sigpipe): removed.

Sat May 28 03:04:27 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (fill_cbuf): return MORE_CHAR_SUSPENDED when cbuf is not empty.

Sat May 28 02:22:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (rb_str_bytesize): rb_str_bytesize() should use LONG2NUM().
	  Patch by Nikolai Weibull. [Bug #4789] [ruby-core:36511]

Sat May 28 02:06:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (fill_cbuf): Fix test-all crash.

Sat May 28 00:58:40 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/ostruct.rb (method_missing): Handle [] and []= correctly.
	  Based on a patch by Caius Durling, bug #4179 [ruby-core:33792]

Fri May 27 23:56:54 2011  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb (Tester::test_text_frozen): split frozen
	  string test. refs #4783

Fri May 27 22:46:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): install gemspec of json.  fixed #4784

Fri May 27 22:45:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (validate_enc_binmode): do not clear textmode flag if
	  default.  fixed #4732

	* io.c (fill_cbuf): finish reading at EOF.

Fri May 27 11:31:51 2011  misfo <tedwardo2@gmail.com>

	* lib/rexml/text.rb (REXML::Text#initialize): prevent an error
	  when passing a frozen string to REXML::Text.new

	  dup the string passed in instead of cloning so that it's frozen
	  state is ignored

Fri May 27 08:47:26 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* thread.c (ppoll): typo bug fix.

Fri May 27 08:35:04 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: hang-up at exit before calling Tk.mainloop.

	* ext/tk/lib/tk/extconf.rb: cannot make on MinGW [Ruby 1.9 - Bug #4141].

Thu May 27 00:34:07 2011  James Edward Gray II  <jeg2@ruby-lang.org>

    * lib/csv.rb: Enhance each() to support Enumerator.

Thu May 26 10:32:11 2011  James Edward Gray II  <jeg2@ruby-lang.org>

    * lib/csv.rb: Documentation improvements from Ysiad Ferreiras.
      [Ruby 1.9 - Bug #4785]

Thu May 26 15:42:02 2011  Cezary Baginski <cezary.baginski@gmail.com>

	* lib/xmlrpc/parser.rb (FaultException): fix to_s and inspect

	* test/xmlrpc/parser.rb: test for the above

Wed May 25 11:54:31 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Remove color constants block.
	  [Ruby 1.9 - Bug #4748]

Wed May 25 09:56:45 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Add missing documentation for button state, MIN
	  and MAX comments.  Add Curses. to TABSIZE= and ESCDELAY= methods.
	  [Ruby 1.9 - Bug #4747]

Wed May 25 09:35:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Restore nodoc for Benchmark::Job and
	  Benchmark::Report.  [Ruby 1.9 - Bug #4726]

Wed May 25 09:29:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/pop.rb:  Hide implementation details from RDoc.
	  [Ruby 1.9 - Bug #4711]

Wed May 25 09:26:29 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/ftp.rb:  Add :nodoc: for private methods.
	  [Ruby 1.9 - Bug #4710]

Wed May 25 09:19:17 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Fix Document-method declarations.  Improve
	  Zlib::GzipFile's method catalog.  [Ruby 1.9 - Bug #4695]

Wed May 25 08:22:12 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/erb.rb:  Hide documentation for implementation details of ERB.
	  [Ruby 1.9 - Bug #4694]

Wed May 25 07:58:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile.{mkdir,rmdir}): revert for backward
	  compatibility.

Wed May 25 07:13:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* spec/README: update the description.

Wed May 25 07:12:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tempfile.rb (Tempfile.{lock,unlock}_tempfile): refactor.

Tue May 24 17:30:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* spec/README: fix typo.
	  patched by bowsersenior. https://github.com/ruby/ruby/pull/24

Tue May 24 07:06:34 2011  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/tk.rb: fail to start Tk.mainloop (exit immediately) on
	  some environment (reported on [ruby-talk:381444]).

	* ext/tk/lib/tk/canvas.rb: support creating a canvas item object from
	  an item ID number.

	* ext/tk/lib/tk/image.rb: import documents which are pull-requested.
	  [Ruby 1.9 - Feature #4595]

	* ext/tk/lib/tk/extconf.rb: search directories for 64bit library (e.g.
	  /usr/lib64), add some new configure options (see README.tcltklib),
	  and bug fix.

	* ext/tk/lib/tk/README.tcltklib: modify docs for some new configure
	  options.

Tue May 24 04:01:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/yaml.rb: switch default YAML engine to Psych, old syck engine
	  may be enabled via YAML::ENGINE.yamler = "syck". [ruby-core:36374]

Mon May 23 09:45:26 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): Revert r30508. Forgot to
	  include this file in the commit r31692. __APPLE__ is not
	  CASEFOLD_FILESYSTEM again, from this time.

Mon May 23 10:01:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Do not parse zero-tagged values as EOC. Do
	not let current length become negative for infinite length constructed
	values. Support constructed values of length zero. Added tests.

Mon May 23 09:19:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/smtp.rb:  Document Net::SMTP::Response.  Patch by J.R. Garcia.
	  [Ruby 1.9 - Bug #4768]

Mon May 23 09:03:52 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Never Ignore SIGINT. When received
	Interrupt, immediately puts result and exit. [ruby-dev:43571]

	* lib/test/unit.rb: When received Interrupt, wait results from workers
	and collect them. [ruby-dev:43571]

Mon May 23 09:08:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4767]

Mon May 23 08:45:55 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ostruct.rb:  Improve documentation.  Patch by Franklin Webber.
	  [Ruby 1.9 - Bug #4761]

Mon May 23 08:35:24 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c:  Improve documentation of Hash#key.  Patch by Utkarsh
	  Kukreti.  [Ruby 1.9 - Bug #4760]

Mon May 23 08:32:59 2011  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c:  Improve documentation.  Patch by Dave Copeland.
	  [Ruby 1.9 - Bug #4757]

Mon May 23 07:19:45 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS (openssl): Infinite length support. Different behavior of
	Constructive and Primitive constructors.

Mon May 23 06:58:33 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Forbid Constructives whose value is not an
	Array to prevent segfault. Added test.

Mon May 23 06:33:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Forbid Constructive without infinite
	length. This also prevents a segfault. Added test and improved
	documentation.

Mon May 23 05:58:14 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Fix decoding of infinite length values.
	Simplified ossl_asn1_decode0 by splitting it into three separate
	functions. Add tests.
	[Ruby 1.9 - Bug #4374][ruby-core:35123]

Mon May 23 04:03:46 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1_initialize): Allow creation of
	Constructives with an explicit tag_class parameter without
	automatically setting tagging to :EXPLICIT. Fixes a bug when encoding
	infinite length primitive values.

Mon May 23 04:03:46 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1_cons_to_der): Add an additional
	EOC for infinite length Constructives that are supposed to be encoded
	with explicit tagging. Also tabify method correctly.

Mon May 23 03:44:39 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c (ossl_asn1data_to_der): Remove redundant
	flag tmp_cons.

Mon May 23 00:35:00 2001  Kenta Murata  <mrkn@mrkn.jp>

	* bignum.c (dump_bignum, bigmul1_balance, big_split, biglsh_bang,
	  bigrsh_bang, big_split3, bigmul1_toom3, bigmul0): implement Toom3 (Toom-Cook)
	  multiplication.

	* include/ruby/defines.h: add format prefixes for BDIGIT and BDIGIT_DBL.

Sun May 22 23:24:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Instead of rb_intern use static symbols to
	improve performance.

Sun May 22 21:56:51 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Use OpenSSL constants V_ASN1_xxx instead of
	hardcoded numbers for initializing class_tag_map.

Sun May 22 21:29:29 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): Revert r30508. See #4255.
	  Now __APPLE__ is not CASEFOLD_FILESYSTEM again.

	* load.c (loaded_feature_path, rb_feature_p, load_lock): Revert r30508.
	  See #4255. Make $LOADED_FEATURES scanning case-sensitive again.

Sun May 22 18:59:27 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_asn1.c(ossl_asn1_default_tag): avoid using RCLASS_SUPER
	  to make it compilable. Plus, tabify and change variable definition style.

Sun May 22 18:26:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (vm_xcalloc): use calloc provided by platforms.
	  fixes #4754

Sun May 22 11:44:53 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/pty/pty.c:  Improve documentaton.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4756]

Sun May 22 11:26:39 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4755]

Sun May 22 11:21:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ipaddr.rb:  Improve documentation.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4753]

Sun May 22 11:14:40 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/forwardable.rb:  Document def_delegator.  Patch by Sandor Szucs.
	  [Ruby 1.9 - Bug #4752]

Sun May 22 11:11:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/fileutils.rb:  Document block behavior of FileUtils.cd.  Patch by
	  Bil Kleb.  [Ruby 1.9 - Bug #4751]

Sun May 22 11:07:47 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/curses/curses.c:  Complete documentation.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4748]

Sun May 22 09:29:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  use spawn. it prevent that other tests inherit renamed $0.

Sun May 22 08:57:13 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Default tag lookup in constant time via hash
	instead of previous linear algorithm.
	[Ruby 1.9 - Feature #4309][ruby-core:34813]

Sun May 22 07:54:16 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: Explain DSS and DSS1 in documentation.

Sun May 22 07:10:25 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Add tests for sign/verify.

Sun May 22 06:07:17 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_x509cert.rb: Merge DSA-related tests from ruby_1_8
	branch.

Sun May 22 04:11:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (Init_Thread): add a code comment why the meaningless
	  line is necessary.

Sun May 22 01:35:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified documentation.

Sat May 21 22:46:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime(date_strftime_with_tmx): "%v" means "%e-%b-%Y".

Sat May 21 22:14:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_extract_modeenc): accept combination hash and
	  File::Constants. (eg. File.open('yo', :mode => File::WRONLY))
	  [Feature #4742][ruby-core:36338]
	* test/ruby/test_io.rb (TestIO#test_open_mode): new test.

Sat May 21 21:44:14 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_switch_hitter.rb: new.

Sat May 21 21:18:29 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{core,parse}.c: moved nearly all core code from ext/date/lib.
	* ext/date/lib/{date,date/format}.rb: removed nearly all code.

Sat May 21 02:58:46 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/.document:  Add curses to documented extensions.
	* ext/curses/curses.c:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4747]

Sat May 21 02:51:01 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/bigdecimal/lib/bigdecimal/util.rb:  Improve documentation.  Patch
	  by Pete Higgins.  [Ruby 1.9 - Bug #4746]

Sat May 21 02:44:10 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/bigdecimal/lib/bigdecimal/jacobian.rb:  Document isEqual.  Patch
	  by Kuba Fietkiewicz.  [Ruby 1.9 - Bug #4744]

Sat May 21 02:22:34 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/date/lib/date/format.rb:  Document date formats.  Patch by
	  Clinton Nixon.  [Ruby 1.9 - Bug #4743]

Fri May 20 05:15:19 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* gc.c: Fix build on m68k by 'error: too few arguments to
	  function 'mark_locations_array''.

Fri May 20 04:23:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/scanf.rb:  Improve documentation.  Patch by Gabe McArthur.
	  [Ruby 1.9 - Bug #4735]

Fri May 20 00:58:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/trans/ibm737-tbl.rb: greek code page.  fixes #4738

Thu May 19 14:44:05 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_signal.rb (test_signal_requiring): skip on Windows.
	  we can send SIGINT only to pid 0 and the process itself.

Thu May 19 09:07:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib: revert r31635-r31638 and untabify with expand(1).

Thu May 19 07:47:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_rsa.rb: Add tests for sign/verify.

Thu May 19 07:19:16 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey.c: Add documentation.

Thu May 19 07:06:56 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Fix indentation.
	* lib/net/imap.rb:  Fix indentation of regular expressions.

Thu May 19 06:36:11 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/imap.rb:  Fix indentation of EOF for heredoc.
	* lib/debug.rb (Commands):  Fix indentation of EOHELP for heredoc.

Thu May 19 06:30:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mkmf.rb:  Fix indentation of EOM for heredoc.

Thu May 19 06:16:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib:  Convert tabs to spaces for ruby files per
	  http://redmine.ruby-lang.org/projects/ruby/wiki/DeveloperHowto#coding-style
	  Patch by Steve Klabnik [Ruby 1.9 - Bug #4730]
	  Patch by Jason Dew [Ruby 1.9 - Feature #4718]

Thu May 19 06:06:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi/util.rb:  Improve documentation.  Patch by Clinton Nixon.
	  [Ruby 1.9 - Bug #4733]
	* lib/cgi/core.rb:  ditto
	* lib/cgi/cookie.rb:  ditto

Thu May 19 06:02:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/tempfile.rb:  Document Dir.mkdir and Dir.rmdir.  Patch by Clinton
	  Nixon.  [Ruby 1.9 - Bug #4728]

Thu May 19 05:57:52 2011  Eric Hodel  <drbrain@segment7.net>

	* encoding.c:  Improve documentation for Encoding#default_external and
	  Encoding#default_internal.

Wed May 18 22:45:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/lib/console/size.rb (IO#console_size): new
	  method.  (EXPERIMENTAL)

Wed May 18 22:41:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* internal.h: add for internal use only.

Wed May 18 22:36:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (setup_exception): internal exception should be hidden

Wed May 18 20:25:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/timeout.rb (Timeout#timeout): don't leak "execution expired"
	  exception. [Bug #4283] [ruby-core:34534].

Wed May 18 06:09:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Add some examples and improve documentation.  Patch by
	  Sandor Szucs.  [Ruby 1.9 - Bug #4727]

Wed May 18 05:40:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/benchmark.rb:  Remove nodoc from Benchmark::Job and
	  Benchmark::Report.  Patch by Sandor Szucs.  [Ruby 1.9 - Bug #4726]

Wed May 18 05:29:26 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/compat.rb:  Improve documentation.  Patch by Sandor
	  Szucs.  [Ruby 1.9 - Bug #4725]

Wed May 18 05:10:35 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/tracer.rb:  Improve documentation.  Patch by Richard Ramsden.
	  [Ruby 1.9 - Feature #4720]

Wed May 18 04:53:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cmath.rb:  Improve documentation.  Patch by Jason Dew.
	  [Ruby 1.9 - Feature #4717]

Wed May 18 04:50:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/ftp.rb:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4710]

Wed May 18 03:14:49 2011  Eric Hodel  <drbrain@segment7.net>

	* test/test_singleton.rb:  Add tests from lib/singleton.rb.  Patch by
	  Pete Higgins.  [Ruby 1.9 - Bug #4715]

Wed May 18 03:03:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/singleton.rb:  Improve documentation.  Patch by Pete Higgins.
	  [Ruby 1.9 - Bug #4709]

Tue May 17 21:24:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_lock): remove remove_signal_thread_list() call.
	  It's meaningless because lock_interrupt doesn't call
	  add_signal_thread_list().

Tue May 17 20:20:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (rb_thread_struct): add volatile to
	  transition_for_lock because it is not protected by lock.

Tue May 17 20:08:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* LEGAL (missing/{elf,tgamma,lgamma_r}.c): they've been replaced by
	  public domain implementations.

	* LEGAL (vsnprintf.c): it has moved to srcdir from missing/.

	* LEGAL (missing/crypt.c): list its original license.

Tue May 17 19:54:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* LEGAL (configure): add missing/setproctitle.c

Tue May 17 19:35:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	Fix FreeBSD test failure.

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  use ps -o command instead of ps -o cmd. FreeBSD doesn't support
	  -o cmd option.

Tue May 17 08:04:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: Add documentation.

Tue May 17 07:14:58 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Improve documentation of proxy configuration
	  methods.  Patch by Alf Mikula.  [Ruby 1.9 - Bug #4714]

Tue May 17 07:09:01 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/pop.rb:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4711]
	* lib/net/telnet.rb:  ditto

Tue May 17 07:00:41 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Fix nodoc for Net::HTTP::version_1_1?.  Patch by
	  Alf Mikula.  [Ruby 1.9 - Bug #4713]

Tue May 17 06:56:26 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/optparse.rb:  Add link to make_switch to improve documentation.
	  Patch by David Copeland.  [Ruby 1.9 - Bug #4708]

Tue May 17 06:50:40 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/observer.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4707]

Tue May 17 06:42:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/logger.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4706]

Tue May 17 06:28:14 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/gserver.rb:  Improve documentation.  Patch by David Copeland.
	  [Ruby 1.9 - Bug #4705]

Tue May 17 06:21:15 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/cgi.rb: Add toplevel documentation to class CGI
	* lib/cgi/session.rb: Add overview documentation to CGI::Cookie
	* lib/cgi/html.rb:  Don't add CGI::TagMaker documentation to CGI.
	  Patch by David Copeland.  [Ruby 1.9 - Bug #4704]
	* lib/cgi/core.rb:  Clean up CGI documentation.  Patch by David
	  Copeland.  [Ruby 1.9 - Bug #4704]
	* lib/cgi/cookie.rb:  Clean up CGI::Cookie documentation.  Patch by
	  David Copeland.  [Ruby 1.9 - Bug #4704]

Tue May 17 05:52:30 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/digest: Improve documentation of Digest, Digest::HMAC and
	  Digest::SHA2.  Patch by Pete Higgins.  [Ruby 1.9 - Bug #4702]

Tue May 17 03:51:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/abbrev.rb:  Hide copyright and revision information from RDoc.
	  Inspired by patch from David Copeland, bug #4703.

Tue May 17 03:33:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/timeout.rb (module Timeout):  Hide internal constants.  Patch by
	  Pete Higgins.  [Ruby 1.9 - Bug #4701]

Mon May 16 11:21:09 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (RUBY_SO_NAME): add CPU as prefix
	  of RUBY_SO_NAME on x64/ia64 mswin/mingw.
	  [Feature #4602]

Mon May 16 08:00:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb:  Update to RDoc 3.6.1, allows OpenSSL::Digest to be
	  found.

Mon May 16 05:49:54 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/drb/acl.rb:  Add documentation.

Mon May 16 05:13:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Add documentation.

Mon May 16 00:32:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_signal.rb (TestSignal#test_signal_process_group):
	  skip if the platform doesn't have :pgroup capability. (i.e. skip
	  if mswin32)

Sun May 15 23:53:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h: resurrect old rb_fd_copy().
	* thread.c (rb_fd_copy): ditto.

Sun May 15 23:45:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h: remove rb_fd_copy() to rb_fd_dup() and
	  rb_w32_fdcopy() to rb_w32_fd_dup().
	* win32/win32.c: ditto.
	* thread.c: ditto.

Sun May 15 22:26:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* signal.c (rb_f_kill): accept '-SIGXXX' style signal with Symbol or
	  implicit convertion with #to_str. [ruby-dev:43169] fixes #4362
	* test/ruby/test_signal.rb (test_signal_process_group): add a test
	  for send signal to process group.

Sun May 15 21:22:35 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (cont_init): clear macihne_stack_start/end of saved thread to
	  prevent mark machine stack of GC'ed Thread. root Fiber is not
	  initialized by fiber_init().
	  based on a patch by Serge Balyuk [ruby-core:35891] fixes #4612
	* test/ruby/test_fiber.rb (test_gc_root_fiber): add test for it.

Sun May 15 21:04:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (econv_init): revert r31353.  [ruby-dev:43512]

Sun May 15 03:39:35 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Improve documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4695]

Sun May 15 03:23:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/erb.rb:  Document ERB::Compiler.  Patch by Simon Chiang.
	  [Ruby 1.9 - Bug #4694]

Sun May 15 00:58:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix mswin32 build error.

	* missing/setproctitle.c: oadd #ifdef HAVE_UNISTD_H.
	* win32/Makefile.sub (MISSING): add setproctitle.obj

Sat May 14 22:45:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* missing/setproctitle.c: add to include "ruby/util.h".

Sat May 14 19:52:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions#test_set_program_name):
	  add for $0 test.

Sat May 14 19:50:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* missing/setproctitle.c (compat_init_setproctitle): use
	  ruby_strdup() instead of strdup().

Sat May 14 19:37:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/missing.h: add setproctitle() declaration.
	* missing/setproctitle.c: added.
	* configure.in: add check for missing/setproctitle.c.

	* ruby.c (ruby_process_options): add to call compat_init_setproctitle().
	* ruby.c (set_arg0): remove all platform specific code. it's
	  moved to missing/setproctitle.c.
	* ruby.c (origarg): remove len field. It's no longer used.
	* ruby.c (get_arglen): removed.

	This patch makes a lot of cleanup set_arg0 related code and fixes
	[Feature #4689].

Sat May 14 17:42:21 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* process.c (rb_proc_times): improve documentation.
	  [ruby-core:35785] fixes #4581, reported by Andrew Grimm.

Sat May 14 12:12:54 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_dsa.rb: Add basic tests and tests that
	  ensure new public key PEM encoding behavior and ensure backward
	  compatibility.
	  [Ruby 1.9 - Bug #4422] [ruby-core:35328]
	* test/openssl/test_pkey_rsa.rb: Remove line with 'puts'.

Sat May 14 12:06:49 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/context.rb (class RDoc):  Fix infinite loop caused by
	  re-encountering BasicObject.

Sat May 14 10:32:36 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkey_rsa.rb: Add tests that ensure new public key
	  encoding behavior and also ensure backward compatibility.
	  [Ruby 1.9 - Bug #4421] [ruby-core:35327]

Sat May 14 09:50:10 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/yaml/dbm.rb:  Add documentation.  Patch by Justin Collins.
	  [Ruby 1.9 - Bug #4693]
	* lib/yaml/store.rb:  ditto

Sat May 14 09:31:43 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb: Updated to RDoc 3.6

Sat May 14 07:30:29 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: released a new gem, so increasing version.

Sat May 14 05:08:32 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c
	* ext/openssl/ossl_pkey.c
	* ext/openssl/ossl_pkey.h
	* test/openssl/pkey/test_pkey_rsa.rb
	  Reverted premature commit. Sorry for the noise!

Sat May 14 05:02:58 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/uri.rb:  Add toplevel documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4690]

Sat May 14 04:19:06 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* NEWS: Describe altered behaviour for RSA and DSA public key
	  encoding. [Ruby 1.9 - Bug #4421, Bug #4422]
	  [ruby-core:35327,35328]

Sat May 14 02:57:52 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/ipaddr.rb (unless Socket):  Document valid*? methods.  Patch by
	  Sebastian Martinez.  [Ruby 1.9 - Feature #4687]

Sat May 14 02:54:04 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rexml/functions.rb:  Add some documentation for REXML::Functions.
	  Patch by Sebastian Martinez.  [Ruby 1.9 - Feature #4688]

Sat May 14 02:51:42 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/resolv.rb:  Hide private method and state-tracking constants from
	  RDoc.  Patch by Mark Turner.  [Ruby 1.9 - Feature #4691]

Fri May 13 19:23:21 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* numeric.c (flo_coerce): Add #flo_coerce documentation.
	  Patch by Sebastian Martinez.
	  https://github.com/ruby/ruby/pull/21

Fri May 13 18:42:22 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* README.EXT: fix typo.  Patch by William Blackerby.
	  https://github.com/ruby/ruby/pull/19

	* README.EXT.ja: ditto.

Fri May 13 15:22:34 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_select): check invalid handle before doing
	  select operations.  see [ruby-dev:43513], [ruby-dev:43535]

Fri May 13 08:34:00 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/rdoc.rb:  Output summary after documentation report.
	* lib/rdoc/stats/normal.rb:  Don't output information for users when
	  we're not on a TTY

Fri May 13 07:49:02 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/fileutils.rb:  Hide internal methods from RDoc.  Patch by Darragh
	  Curran.  [Ruby 1.9 - Bug #4684]

Fri May 13 07:36:23 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpservlet/erbhandler.rb:  Add documentation.

Fri May 13 07:04:33 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Fix indentation.  Patch by Jason Dew.
	  [Ruby 1.9 - Feature #4682]

Fri May 13 06:50:43 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mathn.rb:  Add documentation.  Patch by Jason Dew.  [Ruby 1.9 -
	  Feature #4667]

Fri May 13 05:44:19 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/logger.rb (class Logger):  Document Logger#datetime_format.
	  Patch by Sergio Gil Perez de la Manga.  [Ruby 1.9 - Bug #4678]

Fri May 13 05:39:11 2011  Eric Hodel <drbrain@segment7.net>

	* re.c (Init_Regexp): Document option constants.  Patch by Vincent
	  Batts.  [Ruby 1.9 - Bug #4677]
	* lib/uri/common.rb (module URI):  Documentation for URI.  Patch by
	  Vincent Batts.  [Ruby 1.9- Bug #4677]
	* lib/uri/ftp.rb (module URI):  ditto
	* lib/uri/generic.rb (module URI):  ditto
	* lib/uri/http.rb (module URI):  ditto
	* lib/uri/https.rb (module URI):  ditto
	* lib/uri/ldap.rb (module URI):  ditto
	* lib/uri/ldaps.rb (module URI):  ditto
	* lib/uri/mailto.rb (module URI):  ditto
	* process.c (Init_process):  Document Process constants.  Patch by
	  Vincent Batts.  [Ruby 1.9- Bug #4677]

Fri May 13 05:16:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rss/atom.rb (module RSS):  Document URIs.  Patch by Mark Turner.
	  [Ruby 1.9 - #4671]
	* lib/rss/rss.rb (module RSS):  Document exception classes.  Patch by
	  Mark Turner.  [Ruby 1.9 - #4671]

Fri May 13 02:15:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (select_internal): remove unused variable (interrupt_flag).

Thu May 12 18:24:34 2011  Kouhei Sutou  <kou@clear-code.com>

	* configure.in: limit to "T" type for prefix of external symbols
	  because x86_64-w64-mingw32-gcc on Debian GNU/Linux generates the
	  following symbol:
	    0000000068483390 D _GLOBAL__F__conftest_external

	  Approved by nobu.

Thu May 12 14:50:52 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/dl/test_base.rb (Fiddle::LIBC_SO): its always msvc*.dll on
	  mswin/mingw.

Thu May 12 14:47:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (Logging.postpone): copy only when tmporary logfile
	  exists.

Thu May 12 12:24:22 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* ext/openssl/ossl_ssl.c: By trunk@31346, function check of SSLv2 is
	  executed.
	  However, the problem is not revised in this.
	  This adds the control of using function of SSLv2 in made macro by
	  function check.

Thu May 12 08:10:46 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/set.rb (class Set):  Add nodoc to internal-use methods.  Patch
	  by Pete Higgins.  [Ruby 1.9 - Bug #4665]

Thu May 12 08:01:14 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_ec.c: Allow encryption when PEM-encoding
	  Elliptic Curve private keys.
	  [ruby-core:35329] [Bug #4423]

Thu May 12 07:54:59 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c (rb_obj_equal):  Add documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #4664]
	* lib/rexml:  ditto
	* lib/mkmf.rb:  ditto
	* ext/socket/lib/socket.rb:  ditto

Thu May 12 07:30:08 2011  Eric Hodel  <drbrain@segment7.net>

	* Various .document files: Update .document files to match files which
	  have documentation.

Thu May 12 07:18:45 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dsa.c: Use generic X.509 SubjectPublicKeyInfo
	  format for PEM-encoding DSA public keys.
	  [ruby-core:35328] [Bug #4422]

Thu May 12 06:27:31 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_rsa.c: Use generic X.509 SubjectPublicKeyInfo
	  format for encoding RSA public keys.
	  [ruby-core:35327] [Bug #4421]

Wed May 11 19:45:27 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/forwardable.rb: support 'delegate :foo => :bar' for to meet
	  by specification of RDOC.

Wed May 11 08:36:38 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick: Add documentation for WEBrick::HTTPAuth

Wed May 11 03:06:35 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rss.rb: Add documentation for RSS.  Patch by Steve Klabnik.
	  [Ruby 1.9 - Bug #4663]

Tue May 10 14:50:32 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add option for hiding skip messages when test
	  ends. #4657

	* test/testunit/test_hideskip.rb, test/testunit/test4test_hideskip.rb:
	  test for above.

Tue May 10 10:53:04 2011  Eric Hodel  <drbrain@segment7.net>

	* common.mk (rdoc): Add rdoc-coverage rule

Tue May 10 09:13:21 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick: Add Documentation

Tue May 10 04:22:09  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/log.rb: Hide copyright info from ri
	* lib/webrick/httpstatus.rb: ditto
	* lib/webrick/htmlutils.rb: ditto
	* lib/webrick/httpversion.rb: ditto
	* lib/webrick/version.rb: ditto
	* lib/webrick/httpauth/userdb.rb: ditto
	* lib/webrick/httpauth/authenticator.rb: ditto
	* lib/webrick/accesslog.rb: ditto

Mon May  9 20:57:13 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex,rational}.rb: added tests.

Mon May  9 20:29:44 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c (string_to_c_internal): a refactoring.

Mon May  9 18:33:05 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c: Improve documentation for String#start_with? and
	  String#end_with?. fixes #4652
	  patched by Andrew Grimm <andrew.j.grimm at gmail.com>

Mon May  9 13:49:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* complex.c (string_to_c_internal): support scientific notation.
	  patched by Tinco Andringa. https://github.com/ruby/ruby/pull/16
	  [ruby-core:36046][Bug #4655]

Mon May  9 11:52:48 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_ord): remove K&R style.
	  patched by Daehyub Kim. https://github.com/ruby/ruby/pull/17

Sun May  8 22:17:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex2,complexrational}.rb: use skip.
	* test/date/*.rb: ditto.

Sun May  8 21:02:31 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/ruby/test_{complex2,complexrational}.rb: NEVER SKIP.

Sun May  8 21:01:21 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_date_base.rb: fixed.

Sun May  8 20:54:11 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: NEVER SKIP.

Sun May  8 20:37:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: reverted 31432.

Sun May  8 20:32:43 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: reverted 31483.

Sun May  8 19:39:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_cond_timedwait): add to care EINTR.
	* thread_pthread.c (thread_timer): remove EINTR check.

Sun May  8 19:04:15 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/time.rb (xmlschema): avoid passing any negative numbers.

Sun May  8 18:40:03 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{parse,strptime}.c: introduced some macros.

Sun May  8 17:17:13 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/*.rb: use skip /w messages.

Sun May  8 17:04:55 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_httpdate): omitted to call zone_to_diff.

Sun May  8 16:56:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_s_test_*): use macros.

Sun May  8 10:24:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: cleanup signal_thread_list related ifdef.
	  1) we don't have to use #ifdef FOO-PLATFORM directly 2) About
	  half #ifdef didn't care symbian properly.

Sun May  8 05:19:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: Linux socketpair(2) only support
	  AF_UNIX, but windows socketpair doesn't support it. we can't
	  avoid platform check. sigh!

Sun May  8 00:13:05 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: use Socket.pair instead of pipe.
	  Windows can only treat a socket.

Sat May  7 22:43:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_zero): remove redundant zero fill.

Sat May  7 22:38:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_init): remove volatile qualifier.

Sat May  7 22:34:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_init_copy): new internal api. It provide efficient
	  copy constructor semantics.
	* thread.c (do_select): use rb_fd_init_copy().

Sat May  7 15:18:06 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix incorrect native_cond_signal call when deadlock was detected.

	* thread.c (lock_func): decrement cond_waiting if timeout was happen.

Sat May  7 18:28:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (USE_MONOTONIC_COND): check the availability
	  more strictly.

	* thread_pthread.h (rb_thread_cond_t): ditto.

Sat May  7 15:15:10 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	fix win32 native_cond_timedwait() makes SIGSEGV.

	* thread_win32.h (rb_thread_cond_struct): add prev field instead of
	  last. (ie cond_event_entry is now using double linked list instead of
	  single)
	* thread_win32.c (cond_event_entry): add prev field.

	* thread_win32.c (__cond_timedwait): remove entry properly if timeout
	  was happen.

	* thread_win32.c (native_cond_signal): change for double linked list.
	* thread_win32.c (native_cond_broadcast): ditto.
	* thread_win32.c (native_cond_initialize): ditto.

Sat May  7 12:41:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	fix mutex deadlock test hang-up.

	* thread_win32.c (abs_timespec_to_timeout_ms): fix 1000x calculation
	  mistake. (ie fix hang-up native_cond_timedwait())

Sat May  7 03:14:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	sleep_cond use monotonic time if possible.

	* thread_pthread.c (native_thread_init): change sleep_cond
	  attribute to monotonic.
	* thread_pthread.c (native_sleep): use native_cond_timeout().

	* thread_pthread.c (native_cond_timeout): add overflow care.
	* thread_win32.c (native_cond_timeout): ditto.

Sat May  7 02:49:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>
	  fix win32 compile error.

	* thread_win32.c (RB_CONDATTR_CLOCK_MONOTONIC): define
	  RB_CONDATTR_CLOCK_MONOTONIC always.
	* thread_pthread.c (RB_CONDATTR_CLOCK_MONOTONIC): ditto.

Sat May  7 02:29:41 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	  mutex: deadlock check timeout use monotonic time.

	* thread_pthread.c (native_cond_timeout): new internal api.
	  it calculate a proper time for argument of native_cond_timedwait().
	* thread_win32.c (native_cond_timeout): ditto.

	* thread_pthread.c (thread_timer): use native_cond_timeout()
	  instead of get_ts.
	* thread.c (lock_func): ditto.

	* thread_pthread.c (get_ts): removed. use native_cond_timeout().
	* thread.c (init_lock_timeout): ditto.

Sat May  7 01:54:21 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (get_ts): add monotonic clock capability.
	* thread_pthread.c (rb_thread_create_timer_thread): use monotonic
	  clock if possible.

Sat May  7 01:43:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.h (rb_thread_cond_t): add clockid field. it's
	  no longer an alias of pthread_cond_t.
	* thread_pthread.c: adapt new rb_thread_cond_t type.
	* thread.c (mutex_alloc): ditto.
	* thread_win32.c (native_cond_initialize): ditto.
	* configure.in: add check for pthread_cond_attr_setclock() and
	  clockid_t type.

Fri May  6 23:29:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): use ppoll() instead of poll()
	  if possible. based on a patch from Eric Wong. [ruby-core:36003].

Fri May  6 23:13:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: remove nanosleep check. we no longer use it.
	  r20124 removed last usage.

Fri May  6 22:35:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): extra digits are not used.

Fri May  6 17:43:07 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): remove unused variable offset.

	* ext/syck/syck.h: use #ifdef instead of #if DEBUG.

Fri May  6 16:27:33 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (DAY_IN_NANOSECONDS): refix: 31438.
	  check with LONG_MAX and cast as long; without this the calculation
	  will be done as int and overflow.

Fri May  6 15:01:11 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): avoid buffer overrun, by
	  silently ignoring lesser significant digits.  Required buffer
	  length can be computable so you might at first think of
	  allocating enough memory space on the fly using alloca().  That
	  is a wrong idea because when using alloca there is always risk
	  of integer overflow.  A function that accepts outer-process
	  resources like this should not blindly trust its inputs.  In
	  this particular case we just want to generate milliseconds
	  resolution by strtod() so the string in question needs no more
	  length than what we originally have.  Ignoring lesser
	  significant digits should suffice I believe.

Fri May  6 14:25:53 2011  Tinco Andringa <mail@tinco.nl>

	* ext/syck/rubyext.c (mktime_do): YAML.load time correctly parse
	  usecs smaller than 1 fixes #4571

Thu May  5 22:23:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_mutex_reinitialize_atfork): removed
	  unused macro.
	* thread_win32.c (native_mutex_reinitialize_atfork): ditto.

Thu May  5 22:09:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (DAY_IN_NANOSECONDS): long long int is not
	  available on all platforms.

Thu May  5 17:36:31 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* eval.c (frame_func_id): store result of method_entry_of_iseq() to
	  cfp->me because method_entry_of_iseq() might become expensive.

Thu May  5 15:03:51 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* eval.c (frame_func_id): __method__ return different name from
	  methods defined by Module#define_method with a same block.
	  [ruby-core:35386] fixes #4606
	* eval.c (method_entry_of_iseq): new helper function. search control
	  frame stack for a method entry which has given iseq.
	* test/ruby/test_method.rb: add tests for #4696

Wed May  4 22:13:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pipe.rb: Reduced iterations. Too slow benchmark
	  is bad.
	* benchmark/bm_vm4_thread_pass.rb: ditto.

Wed May  4 22:08:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/date/test_date_base.rb: don't use no message skip().

Wed May  4 21:11:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select2.rb: reduce number of using file
	  descriptors. because gdb need some fds.

Wed May  4 19:00:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): Fix wrong return value.
	* test/-ext-/wait_for_single_fd/test_wait_for_single_fd.rb
	  (TestWaitForSingleFD#test_wait_for_closed_pipe): test for it.

Wed May  4 18:46:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/-test-/wait_for_single_fd: New. for testing
	  rb_wait_for_single_fd() internal function.
	  The patch was written by Eric Wong. [ruby-core:35991]

	* test/-ext-/wait_for_single_fd/test_wait_for_single_fd.rb: ditto.

Wed May  4 12:46:25 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): Added POLLNVAL check.
	  based on a patch from Eric Wong at [ruby-core:35991].

Wed May  4 11:51:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_select): remove useless ifdef.

Wed May  4 11:42:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (wait_connectable): fix error handling code.
	  RB_WAITFD_OUT is turned on even though an error occur.

Wed May  4 10:12:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/readline/readline.c (readline_event): use rb_wait_for_single_fd().
	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 10:10:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (wait_connectable): use rb_wait_for_single_fd().
	  The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

	* ext/socket/init.c (try_wait_connectable, wait_connectable_ensure):
	  removed.

Wed May  4 10:07:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/io/wait/wait.c (io_wait): use rb_wait_for_single_fd().
	  The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 10:01:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): new. poll(2) based backend for
	  rb_wait_for_single_fd().
	  Now only Linux uses it.

	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 09:56:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_wait_for_single_fd): new.
	* thread.c (select_single): select(2) based backend for
	  rb_wait_for_single_fd().

	* io.c (make_writeconv): use rb_wait_for_single_fd() instead of
	  rb_thread_fd_select().
	* io.c (rb_io_wait_readable): ditto.
	* thread.c (rb_thread_wait_fd_rw): ditto.

	* io.c (wait_readable): removed.
	* thread.c (init_set_fd): new helper function.
	* include/ruby/io.h (RB_WAITFD_IN, RB_WAITFD_PRI, RB_WAITFD_OUT):
	  new constant for rb_single_wait_fd().

	The patch was written by Eric Wong. [Ruby 1.9 - Feature #4531]

Wed May  4 08:04:59 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: fix time dumping so that
	  Syck can load UTC times that Psych dumps.

Wed May  4 07:33:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_copy): fix wrong argument.This issue was pointed
	  out by Eric Wong. [ruby-core:35982]

Tue May  3 20:29:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_symbol_mode):
	  Skip sticky bit test if the platform is FreeBSD. It doesn't allow to
	  change sticky bit if a target is regular file.

Tue May  3 18:23:57 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/date/test_date.rb (TestDate#test_coerce):
	  test for [ruby-core:35127].

Tue May  3 04:27:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_select): preserve errno if no error
	  occurred.

Tue May  3 03:57:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_w32_fdcopy): add prototype.  fixes
	  #4640

Mon May  2 01:02:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/fileutils.rb (FileUtils#chmod): accept symbolic mode argument.
	  The patch was written by takkanm. [ruby-core:26029][Feature #2190]

	* lib/fileutils.rb (FileUtils#fu_mode): new helper function.
	* lib/fileutils.rb (FileUtils#symbolic_modes_to_i): ditto.
	* lib/fileutils.rb (FileUtils#mode_mask): ditto.
	* lib/fileutils.rb (FileUtils#user_mask): ditto.

	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_symbol_mode):
	  new test for the above symbolic mode.
	* test/fileutils/test_fileutils.rb (TestFileUtils#test_chmod_R): ditto.

Mon May  2 00:36:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/init.c (rsock_connect): add to care EINTR. based
	  on a patch from Eric Wong at [ruby-core:35621][Bug #4555]

Sun May  1 01:06:24 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_select): release GVL while waiting select().

Sat Apr 30 23:10:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_fdcopy): New. This can copy even though
	  fdset size exceed FD_SETSIZE.
	* include/ruby/intern.h (rb_fd_copy): use rb_w32_fdcopy()

Sat Apr 30 20:18:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): Change argument type to rb_fdset_t.
	  Now do_select() is free from unexpected hangup if
	  HAVE_RB_FD_INIT=1 [Bug #4636]

	* thread.c (rb_thread_fd_select, rb_thread_wait_fd_rw):
	  adapt new argument type.

	* thread.c (rb_thread_select): make dummy implementation.

Sat Apr 30 20:16:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_copy): Change function argument. Now
	  rb_fd_copy() has fully copy semantics.
	* include/ruby/intern.h: ditto.

Sat Apr 30 20:11:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/intern.h (rb_thread_select): mark as deprecated.

	* ext/io/wait/wait.c (wait_readable): use rb_thread_fd_select
	  instead of rb_thread_select.
	* ext/socket/init.c (wait_connectable0): ditto.
	* ext/readline/readline.c (readline_event): ditto.
	* io.c (rb_io_wait_readable, wait_readable, rb_io_wait_writable,
	  wait_writable): ditto.

Sat Apr 30 20:06:36 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): remove useless ifdef. time calculation
	  is not heavy weight.

Sat Apr 30 16:48:36 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select3.rb: New.

Sat Apr 30 16:27:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (copy_stream_body, rb_io_s_copy_stream): move rb_fd_init()
	  from copy_stream_body to rb_io_s_copy_stream. fds of passing
	  rb_fd_term() have to be guaranteed initialized.

Sat Apr 30 16:13:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_io_select.rb, benchmark/bm_io_select2.rb: New.
	  based on a patch from Eric Wong at [Feature #4531]

Sat Apr 30 03:25:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/wait/test_io_wait.rb: New. for testing ext/io/wait.
	  the patch was written by Eric Wong. [Feature #4531]

Sat Apr 30 00:34:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/win32.h: remove redundant declaration of
	  rb_w32_time_subtract().

Sat Apr 30 00:16:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_init): fix hangup if GVL_SIMPLE_LOCK=1.
	  We don't have to call mutex_unlock() before initialize it!

Fri Apr 29 13:15:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_win32.c (native_cond_timedwait): New. r31373 caused
	  win32 build failure.

	* thread_win32.c (__cond_timedwait, abs_timespec_to_timeout_ms):
	  New helper functions.

	* win32/win32.c (rb_w32_time_subtract): rename from subtract and
	  remove static.

Fri Apr 29 10:43:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/bm_vm4_pipe.rb: Add two new benchmark for GVL
	  performance. They was written by Koichi Sasada.
	* benchmark/bm_vm4_thread_pass.rb: ditto.

Fri Apr 29 10:25:31 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_method.c (rb_clear_cache_by_class): Revert r29673. It made
	  a segmentation fault regression. [Bug #4289][ruby-core:34554].

Fri Apr 29 10:24:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (make_writeconv): do not add textmode newline decorator if any
	  newline decorator is set already.  fixes #4618, fixes #4619

Fri Apr 29 10:17:42 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (lock_func): small cleanup.

Fri Apr 29 10:07:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_mutex_lock, lock_func): Avoid busy loop and
	  performance regression. bm_vm3_thread_mutex.rb performance
	  change from 109.064sec to 16.331sec. [Feature #4607]

	* thread.c (init_lock_timeout): New helper function.

Thu Apr 28 16:15:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{win32.c,dir.h} (rb_w32_uopendir): new API to pass UTF-8 path.

	* win32/win32.c (opendir_internal, rb_w32_opendir): extract and merge
	  common part of rb_w32_opendir() and rb_w32_uopendir().

	* dir.c (do_opendir, glob_helper): encoding.

	* dir.c (dir_initialize, do_opendir): convert path to UTF-8 and call
	  rb_w32_uopendir() instead of rb_w32_opendir() on Windows.
	  fixes #4491, reported by Joey Zhou.

Thu Apr 28 15:32:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/dl/test_base.rb (DL::LIBC_SO): its always msvc*.dll on
	  mswin/mingw.

Thu Apr 28 06:07:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/csv.rb (CSV::open): suppress universal newline decorator.
	  fixes #4603

	* lib/csv.rb (CSV.read): no mode is needed.

Thu Apr 28 06:06:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_extract_modeenc, rb_f_backquote): set default text
	  mode.  fixes #4619

	* io.c (pipe_open): set universal newline decorator if needed.

Wed Apr 27 11:33:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/emoji_iso2022_kddi.trans: ISO-2022-JP-KDDI doesn't have
	  CP932 UDA. Another reason is emacs-mule: the implementation of
	  stateless-iso-2022-jp doesn't support beyond 94x94 (0x7fxx);
	  but CP932 UDA is in 7Fxx-92xx.

Wed Apr 27 07:42:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (STRIP): use proper toolchain.  based on a patch
	  from Jon Forums at [ruby-core:35909].  fixes #4617

Wed Apr 27 01:20:59 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_zone_to_diff): renamed.
	* ext/date/date_parse.c: ditto.
	* ext/date/date_strptime.c: ditto.

Wed Apr 27 01:16:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_find): accept Encoding objects.

Wed Apr 27 00:55:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (econv_opts): add newline option.

	* io.c (validate_enc_binmode, rb_io_extract_modeenc): set newline
	  decorator according to open mode.

	* transcode.c (rb_econv_prepare_options): new function, to prepare
	  econv options with newline flags.

	* include/ruby/encoding.h (ECONV_NEWLINE_DECORATOR_MASK): add.

Wed Apr 27 00:51:01 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_truncate): fix function.

	* include/ruby/win32.h (ftruncate, truncate, ftello, fseeko): non-64
	  versions on mingw are useless because they use int32_t.  fixes #4564

Wed Apr 27 00:50:33 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: modified validation methods.
	* ext/date/lib/date.rb: ditto.

Wed Apr 27 00:00:37 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (dt_lite_set_tmx): should get df value.

Tue Apr 26 22:34:04 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): allowed day only civil
	  date.  disallowed separatorless day only ordinal date.

Mon Apr 25 21:31:36 2011  Nobuhiro Iwamatsu  <iwamatsu@nigauri.org>

	* ext/openssl/extconf.rb: Should check SSLv2_*method.
	  openssl compiled with "no-ssl2" the extconf don't fail
	  when running `make' having this compilation errors.
	  Patched by Laurent Arnoud. fixes #4562, #4556

Mon Apr 25 20:53:32 2011  Tajima, Akio <artonx@yahoo.co.jp>

	* win32/win32.c (kill): accept 0 only sig is SIGINT #4596

Mon Apr 25 19:59:47 2011  Tajima, Akio <artonx@yahoo.co.jp>

	* win32/win32.c (kill): accept 0 as pid, fixes #4596

Mon Apr 25 16:43:45 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (random_rand): remove unused variables.

	* struct.c (rb_struct_define_without_accessor): ditto.

	* strftime.c (rb_strftime_with_timespec): ditto.

	* sprintf.c: ditto.

	* time.c (time_asctime): remove useless GetTimeval().

	* thread_pthread.c: cast to (void *) for %p.

Mon Apr 25 11:02:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/ripper/lib/ripper/sexp.rb: fix rdoc around sexp.
	  patched by Sho Hashimoto. fixes #4599

Mon Apr 25 08:24:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* random.c (rb_f_rand, random_s_rand): RDocs for them.

Mon Apr 25 07:18:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* random.c (random_s_rand, Init_Random): Random.rand should behave as
	  Random::DEFAULT.rand rather than Kernel#rand.

	* random.c (rand_range, random_rand): rand_range function extracted
	  from random_rand function.

	* random.c (rb_f_rand): accept a Range argument as Random#rand
	  [ruby-dev:43427] #4605

Mon Apr 25 03:31:06 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/time.rb: require 'date'.
	* ext/date/lib/date/format.rb: removed require line.

Mon Apr 25 03:08:39 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: require 'date'.

Mon Apr 25 03:04:16 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): added a pattern.

Mon Apr 25 02:51:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/lib/date/format.rb: require 'date_core.so'.
	  date/format needs methods which are now in date_core.so.
	  This breaks make rdoc which uses Date._parse from time.rb.

Mon Apr 25 02:47:46 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb (_iso8601): fixed a bug of regex.

Mon Apr 25 02:12:26 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: an adjustment of regex.

Mon Apr 25 01:58:50 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib/date/format.rb: omitted to call _parse.

Mon Apr 25 01:03:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (rb_to_id): remove unused variable.

Sun Apr 24 22:19:05 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c: omitted some method calls.

Sun Apr 24 02:57:27 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c (n2i): takes long.

Sun Apr 24 02:51:06 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: reverted.

Sun Apr 24 02:25:23 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/intern.h: pcc can't use __builtin_constant_p.

	* vm_exec.c: change condition.

Sun Apr 24 01:58:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (leap_p): suppress warning: parentheses.

	* ext/date/date_core.c (date_s__parse_internal): remove unused
	  variable "str".

	* ext/date/date_parse.c (parse_ddd_cb): use RSTRING_LENINT.

	* ext/date/date_strftime.c (date_strftime_with_tmx): remove unused
	  variable.

Sun Apr 24 00:34:23 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: removed some unused macros.  use strchr()
	  instead of index().

Sat Apr 23 21:29:42 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  _parse.  [experimental]
	* ext/date/date_parse.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of _parse.

Fri Apr 22 12:04:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_sort_bang): fix rdoc.
	  patched by burningTyger. https://github.com/ruby/ruby/pull/11

Fri Apr 22 11:49:49 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/xmlrpc/create.rb (XMLRPC::Create#conv2value):
	  XML-RPC's int is 32bit int, and Fixnum also may be beyond 32bit.

	* lib/xmlrpc/create.rb (XMLRPC::Create#conv2value):
	  XML-RPC doesn't allow Infinity and NaN.
	  http://www.xmlrpc.com/spec

Fri Apr 22 04:16:14 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): strings from psych have proper taint
	  markings.

	* test/psych/test_tainted.rb: test for string taint

Thu Apr 21 01:30:02 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rb_f_srand): fix rdoc: srand(0)'s 0 is a seed.
	  [ruby-core:35833] fixes #4590

Thu Apr 21 01:01:28 2011  Masaya Tarui  <tarui@ruby-lang.org>

	* win32/win32.c (CreateChild): maximum length of lpCommandLine is
	  32,768 characters, including the Unicode terminating null character.

Wed Apr 20 21:32:11 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strptime.c (date__strptime_internal): do not
	  overwrite local variables.

Wed Apr 20 14:41:28 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_each_line): check string's length when compare
	  separator and string. [ruby-core:35815] fixes #4586

Wed Apr 20 00:02:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): use position of open paren.

Tue Apr 19 01:00:21 2011  Tajima Akio <artonx@yahoo.co.jp>

	* test/ruby/test_io.rb (TestIO#test_cross_thread_close_fd):
	  skip cross thread pipe close if windows

Mon Apr 18 12:15:46 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_range.rb (TestRange#test_step_ruby_core_35753):
	  avoid float error. [ruby-core:35804]

Sun Apr 17 00:20:14 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{core,strftime}.c: use struct tmx instead of vtm.
	* ext/date/date_tmx.h: new.

Sat Apr 16 22:23:52 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c (date_strftime_wo_timespec): changed
	  the way of validation of locale modifiers.

Sat Apr 16 21:55:12 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  _strptime.  [experimental]
	* ext/date/date_strptime.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of _strptime.

Sat Apr 16 10:18:30 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vm.c (Init_VM): suppress warning: "OPT_BASIC_OPERATIONS" is not
	  defined.

Fri Apr 15 23:41:18 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ruby.c (proc_options): suppress warning:
	  "ALLOW_DEFAULT_SOURCE_ENCODING" is not defined.

Fri Apr 15 15:10:29 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/uri/generic.rb (#route_from_path): Fix a bug where
	  URI('http://h/b/').route_to('http://h/b') wrongly returned './'
	  (should be '../b'). [Bug #4476]

Fri Apr 15 14:58:06 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/fileutils.rb (FileUtils#touch): Fix corrupted output when
	  mtime is specified in addition to nocreate (and verbose).
	  ref [ruby-dev:43401]

Thu Apr 14 23:43:43 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (ruby_float_step): wrong loop condition.
	  fixes [ruby-core:35753], reported by Joey Zhou.

	* test/ruby/test_range.rb (TestRange#test_step_ruby_core_35753):
	  test above change.

Thu Apr 14 22:48:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Options#setup_options): set possible
	  values for completion. no conversion is needed.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#initialize): use
	  positional arguments instead of keyword arguments.

	* lib/test/unit.rb (Test::Unit::Runner#jobs_status): io/console may
	  not be available. use 80 as the last resort if IO#winsize and
	  COLUMNS are unavailable.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#died): rename using a
	  verb.

	* lib/test/unit.rb (Test::Unit::Runner#_run_parallel): check if worker
	  is signaled and use its exit status.

	* lib/test/unit.rb (Test::Unit::Runner::Worker#dead): no longer @in
	  and @out are separated.

Thu Apr 14 21:23:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_autoload_p): search superclasses as same as actual
	  loading.  fixes [ruby-core:35679]

Thu Apr 14 21:21:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/win32.h (frexp, modf): wrongly declared as pure in
	  mingw math.h.

	* include/ruby/win32.h (ftruncate, truncate): mingw64 misses
	  prototypes.

	* win32/win32.c (rb_w32_read): suppress warning.

Thu Apr 14 19:55:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/fileutils.rb (FileUtils#touch): fix corrupted output when
	  FileUtils.touch(:nocreate => true, :verbose => true) case.
	  The patch was written by Hiroyuki Iwatsuki. [ruby-dev:43401]

Thu Apr 14 16:01:45 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_f_syscall): suppress warning: "HAVE___SYSCALL" is not
	  defined.

Thu Apr 14 00:41:09 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (thread_fd_close_i): IOError exception should be assigned
	  to rb_thread_t::thrown_errinfo.

Wed Apr 13 20:12:26 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_io_fdatasync): remove unused variable.

Tue Apr 12 20:54:12 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/st.h: parenthesize macro arguments.

Tue Apr 12 19:19:50 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb: avoid race condition. fixes #4572

Tue Apr 12 18:07:13 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/extconf.rb: --disable-libedit to disable
	  libedit. fixes #4550

Tue Apr 12 10:37:39 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h: VC doesn't have ftruncate() and others, but
	  ruby needs HAVE_ macros to use our emulation functions.
	  (fix the problem of 31262)

Tue Apr 12 01:33:00 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: properly evaluate existence of truncate, ftruncate
	  and ftello for MinGW. [ruby-core:35678]
	* win32/win32.c: rename truncate, ftruncate and ftello to avoid
	  redefinitions.
	* win32/win32.h: ditto.

Mon Apr 11 21:51:52 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c: revert r31230. Because it made a regression.
	  [ruby-core:35631]

Mon Apr 11 21:49:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb: Added TestIO#test_cross_thread_close_stdio
	  and TestIO#test_cross_thread_close_fd.
	  The patch was written by Eric Wong. [ruby-core:35669]

Mon Apr 11 21:15:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (rb_group_member): kill 256K of stack usage.
	  the patch was written by Eric Wong. [ruby-core:35699]

Mon Apr 11 07:24:13 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c:  Fix typo, document version constants.

Sun Apr 10 22:23:45 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/ruby.h: parenthesize macro arguments.

Sat Apr  9 23:31:47 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each, strio_readlines):
	  Use `NUM2LONG` instead of `FIX2INT`. Fixes [ruby-dev:43395].

Sat Apr  9 23:22:27 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each):
	  Fix exception message and don't raise immediately if block is not
	  given.
	  Fixes [ruby-dev:43394].

	* test/stringio/test_stringio.rb (test_each_line_limit_0):
	  Fix test for above.

Sat Apr  9 21:54:15 2011  Shota Fukumori  <sorah@tubusu.net>

	* ext/stringio/stringio.c (strio_each, strio_readlines):
	  limit must not be zero. Fixes [ruby-dev:43392].

	* test/stringio/test_stringio.rb: Add tests for above.

Sat Apr  9 18:01:36 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/util.h: parenthesize macro arguments.

Fri Apr  8 16:01:56 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): check whether str is
	  a string when str and lim are given.
	  https://twitter.com/watson1978/status/56225052152168449

Thu Apr  7 20:03:52 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/io.h: parenthesize macro arguments.

Wed Apr  6 21:08:31 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h: parenthesize macro arguments.

Wed Apr  6 15:12:40 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_pkey_dh.c (ossl_dh_initialize):
	  pop pushed error after each try of reading. fixes #4550

	* ext/openssl/ossl_pkey_dsa.c (ossl_dsa_initialize): ditto.

	* ext/openssl/ossl_pkey_ec.c (ossl_ec_initialize): ditto.

Wed Apr  6 11:36:44 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_pkey_rsa.c (ossl_rsa_initialize):
	  pop pushed error after each try of reading. fixes #4550

Tue Apr  5 20:33:43 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/encoding.h: parenthesize macro arguments.

Mon Apr  4 22:02:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/io/nonblock/nonblock.c (io_nonblock_set): Avoid F_SETFL if
	  we're not changing the O_NONBLOCK bit. F_SETFL is an expensive
	  operation since it needs to affect all processes with the same
	  file object.
	  The patch is written by Eric Wong. [ruby-core:35556]

Mon Apr  4 21:41:26 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_syswrite): While local FS writes are usually
	  buffered, the buffers can be full or the file opened with
	  O_SYNC. IO#syswrite can also be used on blocking IOs
	  (pipe/socket) just like IO#write.
	  The patch is written by Eric Wong. [ruby-core:35554]

Mon Apr  4 11:50:40 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/test_tempfile.rb: simply ignore platform dependent testcases
	  instead of skipping.

Sun Apr  3 22:52:22 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/syslog/syslog.c: improve rdoc.
	  a patch by Jonas Pfenniger. [ruby-core:35592] fixes #4545

Sun Apr  3 22:10:09 2011  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c: parenthesize macro arguments.

Sun Apr  3 21:33:58 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: disable fdatasync again on Mac OS X.
	  [ruby-core:35493][Bug #4500]

Sun Apr  3 21:16:20 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_reopen): IO#close releases GVL if possible.
	  close() may block for certain file types (NFS, SO_LINGER
	  sockets, inotify), so let other threads run. The patch was
	  created by Eric Wong [ruby-core:35555][Bug #4527]

	* io.c (fptr_finalize): ditto.

	* io.c (maygvl_fclose): new.
	* io.c (nogvl_fclose): ditto.
	* io.c (maygvl_close): ditto.
	* io.c (nogvl_close): ditto.

Fri Apr  1 22:25:50 2011  Tanaka Akira  <akr@fsij.org>

	* ext/syslog/syslog.c: parenthesize macro arguments.

Fri Apr 1 18:53:06 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/cookie.rb (WEBrick::Cookie.parse): 'white space is
	  permitted between tokens' according to RFC2965. Though 'Netscape
	  spec' does not define the syntax clearly, make it tolerant as a
	  server. As a real-world example, rest-client gem sends
	  'Cookie: foo=1;bar=2'

	* test/webrick/test_cookie.rb (test_parse_non_whitespace): test it.

Fri Apr  1 13:19:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (RUBY_VM_CHECK_INTS_TH): merge a patch by ko1
	  in [ruby-dev:43373].

Thu Mar 31 23:15:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-brace-to-do-end, ruby-do-end-to-brace):
	  adjust space between block beginning and block arguments

Thu Mar 31 20:42:05 2011  Tanaka Akira  <akr@fsij.org>

	* ext/strscan/strscan.c:  parenthesize macro arguments.

Thu Mar 31 18:06:12 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): should ignore crefs with
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag.

Thu Mar 31 16:49:56 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): search root cref properly.
	  [ruby-dev:43365]

Thu Mar 31 14:50:25 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* eval.c (rb_mod_s_constants): should ignore crefs with
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag.

Wed Mar 30 22:55:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-toggle-block): toggle do/end and {}.

	* misc/ruby-mode.el (ruby-move-to-block): move to opening of
	  block.

Wed Mar 30 14:35:15 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_insnhelper.h (COPY_CREF): should copy
	  the NODE_FL_CREF_PUSHED_BY_EVAL flag to hide constants from
	  methods defined by class_eval.  [ruby-dev:43365]

Wed Mar 30 00:24:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/stringio/stringio.c: parenthesize macro arguments.

Tue Mar 29 21:51:31 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* object.c (rb_String): Kernel#String should call to_str before to_s.

Tue Mar 29 10:28:08 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/test_filehandler.rb
	  (WEBrick::TestFileHandler#test_short_filename): the cgi doesn't exist
	  on current directory.

Tue Mar 29 05:19:57 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/raddrinfo.c: parenthesize macro arguments.

Tue Mar 29 00:03:51 2011 Tajima Akio <artonx@yahoo.co.jp>

	* test/webrick/test_filehandler.rb (test_short_filename):
	  read real short filename by cmd because smb mounted files
	  have different naming convention.

Mon Mar 28 11:38:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (date_s_today): use int for year.

	* ext/date/date_core.c (datetime_s_now): ditto.

Mon Mar 28 11:07:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/extmk.rb: set MFLAGS from MAKEFLAGS when using nmake.

Mon Mar 28 11:07:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (love): all you need is love.

Sun Mar 27 23:16:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c: parenthesize macro arguments.

Sun Mar 27 16:55:34 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-map): remove unnecessary
	  binding. fixes
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=468952

	* misc/ruby-mode.el: suppress warnings at byte compile.  fixes
	  http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502926

Sun Mar 27 11:18:35 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: removed unused variables.

Sat Mar 26 15:16:09 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/getaddrinfo.c: parenthesize macro arguments.

Sat Mar 26 05:27:34 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/lib/date/format.rb (DateTime#strftime): removed because
	  date_core defines it.

Fri Mar 25 21:59:45 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: should not force cast with macros.

Fri Mar 25 21:56:10 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/init.c: parenthesize macro arguments.

Fri Mar 25 19:39:40 2011  Ben Walton <bwalton@artsci.utoronto.ca>

	* test/test_syslog.rb:
	  Skip syslog tests that rely on LOG_PERROR unless it's defined

	  Instead of checking looking at the platform to determine if the tests
	  relying on LOG_PERROR should be run, look for the definition of the
	  constant as this will be robust against all platforms as long as the
	  underlying syslog.c code sets it up correctly.

	  This specifically addresses failures on Solaris 9.

	  Use LOG_PID instead of LOG_PERROR in Syslog.open test

	  LOG_PERROR isn't a POSIX option for syslog, so it fails on platforms
	  that don't define it.  Solaris 9 and 10 are examples of this.

	  Use LOG_PID instead.

Fri Mar 25 15:42:17 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/sdbm/_sdbm.c (sdbm_open): use size_t.

	* ext/syck/bytecode.c: ditto.

	* ext/sdbm/_sdbm.c (delpair): use ptrdiff_t.

	* ext/sdbm/init.c: use RSTRING_LENINT.

	* ext/dl/handle.c: suppress warning: shorten-64-to-32.

	* ext/strscan/strscan.c: ditto.

	* ext/syck/emitter.c: ditto.

	* ext/syck/implicit.c: ditto.

	* ext/syck/syck.c: ditto.

	* ext/syck/token.c: ditto.

Fri Mar 25 12:14:58 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: import nkf 7f18e30.

Fri Mar 25 11:49:29 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#test_no_curdir): skip silently
	  on Windows, because this tests a platform specific feature and it'll
	  never be supported on ruby on Windows.

	* test/ruby/test_dir_m17n.rb
	  (TestDir_M17N#test_filename_extutf8_invalid,
	  TestDir_M17N#test_filename_as_bytes_extutf8): ditto.

	* test/open-uri/test_open-uri.rb
	  (TestOpenURI#test_find_proxy_case_sensitive_env): ditto.

	* test/dl/test_handle.rb (DL::TestHandle#test_NEXT,
	  DL::TestHandle#test_DEFAULT): ditto.

Thu Mar 24 23:06:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_ev_const): should not autoload in
	  defined? mode.

	* variable.c (rb_const_defined_0): fix autoloading base.
	  [ruby-core:35509]

Thu Mar 24 22:48:43 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c: parenthesize macro arguments.

Thu Mar 24 14:45:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl.c: suppress warning: shorten-64-to-32.

	* ext/openssl/ossl.h: ditto.

	* ext/openssl/ossl_asn1.c: ditto.

	* ext/openssl/ossl_bio.c: ditto.

	* ext/openssl/ossl_bn.c: ditto.

	* ext/openssl/ossl_cipher.c: ditto.

	* ext/openssl/ossl_hmac.c: ditto.

	* ext/openssl/ossl_ns_spki.c: ditto.

	* ext/openssl/ossl_ocsp.c: ditto.

	* ext/openssl/ossl_pkcs5.c: ditto.

	* ext/openssl/ossl_pkey.c: ditto.

	* ext/openssl/ossl_pkey_dh.c: ditto.

	* ext/openssl/ossl_pkey_dsa.c: ditto.

	* ext/openssl/ossl_pkey_ec.c: ditto.

	* ext/openssl/ossl_pkey_rsa.c: ditto.

	* ext/openssl/ossl_rand.c: ditto.

	* ext/openssl/ossl_ssl.c: ditto.

	* ext/openssl/ossl_x509ext.c: ditto.

	* ext/openssl/ossl_x509name.c: ditto.

Thu Mar 24 11:48:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_rand.c (ossl_rand_egd_bytes): use NUM2INT because
	  the result is used with functions whose argument is int.

	* ext/openssl/ossl_ssl.c (ossl_sslctx_setup): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_purpose): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509store_set_trust): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_set_purpose): ditto.

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_set_trust): ditto.

Thu Mar 24 11:36:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_x509name.c: id_aref's type is ID.

Thu Mar 24 10:04:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/io/console/console.c (console_set_winsize):
	  suppress warning: shorten-64-to-32.

Thu Mar 24 09:56:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_ocsp.c (ossl_ocspreq_verify): flags is VALUE,
	  so it should use NUM2INT.

	* ext/openssl/ossl_ocsp.c (ossl_ocspbres_verify): ditto.

Wed Mar 23 21:09:29 2011  Tanaka Akira  <akr@fsij.org>

	* ext/readline/readline.c: parenthesize macro arguments.

Wed Mar 23 08:07:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): fix inaccurate results.

Wed Mar 23 00:12:16 2011  Tajima Akio <artonx@yahoo.co.jp>

	* win32/win32.c: wait process real termination after reading
	  exit code. fixes #4518

Tue Mar 22 21:20:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rubygems/test_case.rb: save current dir to @current_dir
	  before Dir.chdir.

Tue Mar 22 20:10:04 2011  Tanaka Akira  <akr@fsij.org>

	* ext/psych/parser.c: parenthesize macro arguments.

Tue Mar 22 20:10:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ruby_missing.h: parenthesize macro arguments.

Tue Mar 22 13:33:22 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/buffering.rb: removed circular require of
	  openssl.rb.

	* ext/openssl/lib/openssl/*: removed following comment for transition
	  measures of avoiding circular require. No one claimed about this as
	  far as I know.
	  ##
	  # Should we care what if somebody require this file directly?
	  # require "openssl"

Tue Mar 22 10:57:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/runner.rb: set Gem::TestCase's @@project_dir.

	* lib/rubygems/test_case.rb: set Gem::TestCase's @@project_dir only
	  when it is not defined.

Tue Mar 22 09:38:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (flo_round): use pow instead of while-loop. fixes #4510
	  patched by Alex Young [ruby-core:35526]

Tue Mar 22 06:47:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_strftime.c (date_strftime_wo_timespec):
	  suppress warning: shorten-64-to-32.

Tue Mar 22 06:42:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c: suppress warning: shorten-64-to-32.

Tue Mar 22 06:41:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit/parallel.rb: remove unused variable.

Tue Mar 22 06:19:42 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_16le.c: suppress warning: shorten-64-to-32.

	* ext/dbm/dbm.c: ditto.

	* ext/gdbm/gdbm.c: ditto.

	* parse.y (Init_ripper): suppress warning: unused value.

Mon Mar 21 11:21:32 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Refactoring. Unified if and elsif.

Sun Mar 20 23:09:34 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c: checks duplicated modifiers.

Sun Mar 20 22:32:30 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c: removed unused code and arguments.

Sun Mar 20 21:34:49 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: replacement of implementation of
	  strftime. It has some limitations that is same as Time's
	  one.  [experimental]
	* ext/date/date_strftime.c: new.
	* ext/date/lib/date/format.rb: removed ruby version of strftime.

Sun Mar 20 12:43:12 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509store.c: parenthesize macro arguments.

Sun Mar 20 01:39:48 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): check env process block size with OS ver.
	* win32/win32.c: export rb_w32_osver for above patch.
	* include/ruby/win32.h: declare rb_w32_osver for Win32 Libs.

Sat Mar 19 18:35:05 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): calculate total env block size for win32.
	* test/ruby/test_env.rb: add test for above patch.

Sat Mar 19 17:14:46 2011  Tajima Akio <artonx@yahoo.co.jp>

	* hash.c (ruby_setenv): checking with max process environment
	  block size for Win32. 32767 for 2000/XP, 2003. if failed to
	  read the block, then checking with 5120 for earlier Windows.

Sat Mar 19 12:30:25 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509revoked.c: parenthesize macro arguments.

Fri Mar 18 20:44:36 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509req.c: parenthesize macro arguments.

Fri Mar 18 08:48:06 2011  Oleg Shaldybin  <oleg.shaldybin@gmail.com>

	* lib/fileutils.rb (FileUtils::Entry_#copy_file): updated FileUtils.cp
	  to still copy file permissions when :preserve is false (as cp does
	  this even when -p isn't set).

Fri Mar 18 00:59:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/win32ole/extconf.rb (create_docfile): removed.  should not
	  modify source directory unnecessarily, platform dependent
	  documentation should be dealt with by rdoc.  [ruby-core:35495]

Fri Mar 18 00:54:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_funcall_passing_block): add prototype.
	  a patch by James M. Lawrence at [ruby-core:35501]

Wed Mar 17 06:23:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509name.c: parenthesize macro arguments.

Wed Mar 16 20:36:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c (init_inetsock_internal): raise an error on
	  listen(2) failure.
	  reported by Xavier Shay.  [ruby-core:35505]

Wed Mar 16 15:06:21 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/buffering.rb (module OpenSSL): #flush should
	  not change sync mode on exception.
	* test/openssl/test_buffering.rb: added

Wed Mar 16 13:45:28 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/buffering.rb: de-nest Buffering module

	* ext/openssl/lib/openssl/buffering.rb: add RDoc

Wed Mar 16 08:40:39 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509ext.c: parenthesize macro arguments.

Tue Mar 15 18:34:27 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509crl.c: parenthesize macro arguments.

Tue Mar 15 09:49:03 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/misc/test_ruby_mode.rb (test_singleton_class): Skip for Pending.

Mon Mar 14 21:20:44 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_require.rb (test_require_too_long_filename):
	  increase path length, because MAXPATHLEN is defined as 4096 on linux.

	* test/ruby/test_require.rb (test_require_path_home_1): ditto.

	* test/ruby/test_require.rb (test_require_path_home_2): ditto.

Mon Mar 14 19:54:37 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509cert.c: parenthesize macro arguments.

Sun Mar 13 18:11:28 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_x509attr.c: parenthesize macro arguments.

Sun Mar 13 16:07:58 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/pstore.rb: Fix don't raise "nested transaction" when thread_safe
	  is true. Patch by Masaki Matsushita (Glass_saga). [ruby-dev:43337]

	* test/test_pstore.rb: Test for above.
	  Patch by Masaki Matsushita (Glass_saga) [ruby-dev:43337]

Sat Mar 12 04:12:41 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl_session.c: parenthesize macro arguments.

Sat Mar 12 02:27:07 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c ({d,dt}_lite_marshal_load): checks the given
	  argument.

Sat Mar 12 01:26:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: changed some directives.

Sat Mar 12 01:16:02 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c, ext/date/lib/*: moved rdoc descriptions.

Sat Mar 12 00:06:24 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/lib: moved from lib.

Fri Mar 11 23:32:38 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta*: removed undocumented delta.

Fri Mar 11 18:42:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (find_executable0): should exclude directories.

Fri Mar 11 01:40:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getmaxgroups, proc_setmaxgroups): Process#maxgroups
	  and Process#maxgroups= now raise NotImplementedError if the
	  platform don't support supplementary groups concept.

Fri Mar 11 01:25:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (get_sc_ngroups_max): return -1 if platform don't
	  support NGROUPS_MAX.

Thu Mar 10 22:28:15 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.h: parenthesize macro arguments.

Thu Mar 10 21:59:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (parser_encode_length): add exception as UTF8-MAC for
	  magic comment's emacs newline specifier
	  patched by James M. Lawrence [ruby-core:35476] fixes #4489

Thu Mar 10 16:00:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (parser_encode_length): fix typo: the length of
	  "-dos" and "-mac" is not 5 but 4.
	  patched by James M. Lawrence [ruby-core:35476] fixes #4489

Thu Mar 10 10:52:01 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_require.rb: setting too long string to ENV causes
	  Errno::EINVAL on Windows.  long path name errors may causes over
	  about 1024 bytes, then limit it about 4000 bytes.

Thu Mar 10 10:09:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Runner::Worker#read): fix for the case
	  when IO#read or IO#gets returns nil.

Thu Mar 10 07:12:03 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.6.2 (release candidate @ 2026fbb5)
	* test/rubygems: Ditto
	* test/runner.rb: Added test to load path to fix test requires.

Thu Mar 10 03:00:43 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ssl.c: parenthesize macro arguments.

Wed Mar  9 23:51:26 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_io_m17n.rb (test_io_new_enc): "sjis" is now an alias
	  of Windows-31J.

Wed Mar  9 23:06:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): fix indent after aref.

Wed Mar  9 12:50:24 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: Rescue exceptions when
	  people implement the method method. Thanks Lin Jen-Shin.
	  [ruby-core:35255]

	* test/psych/visitors/test_yaml_tree.rb: test for implementation of
	  method method.

Wed Mar  9 11:53:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c: Change SJIS as an alias of Windows-31J.
	  [ruby-dev:43027] fixes #4280

	* enc/shift_jis.c: Add PCK as an alias of Windows-31J.

Wed Mar  9 00:45:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: nmake substitutes all occurrences in macro.

	* ext/extmk.rb: workaround for nmake.

Tue Mar  8 23:49:45 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setgroups): cleanup.

Tue Mar  8 23:40:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/misc/test_ruby_mode.rb: test for ruby-mode.el.

Tue Mar  8 23:27:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (get_sc_ngroups_max): try to use NGROUPS_MAX at first if
	  _SC_NGROUP_MAX is not defined.

Tue Mar  8 23:10:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-parse-partial): fix for array in block.

Tue Mar  8 21:44:49 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_rand.c: parenthesize macro arguments.

Tue Mar  8 16:45:31 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (ruby_setenv): MSDN says that Windows XP or earlier limits
	  the total size of environment block to 5,120 chars.  and on such
	  OS, putenv() causes SEGV.  So, ruby should limit the size of an
	  environment variable to 5,120 bytes for workaround.

Tue Mar  8 15:57:20 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rubygems/test_gem_spec_fetcher.rb
	  (TestGemSpecFetcher#test_cache_dir_escapes_windows_paths): cache_dir
	  may have driveletter and `:' for base of cache_dir itself, so need
	  to skip it for checking.

Tue Mar  8 12:30:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-deep-indent-paren-p, ruby-calculate-indent):
	  do not apply deep-indent inside parens at the beginning of
	  expressions.

Tue Mar  8 09:32:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (configure-ext, build-ext), ext/extmk.rb (extmake):
	  support parallel-make under ext.

Tue Mar  8 09:25:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_setgroups): use getgrnam() if getgrnam_r() is
	  not available.

	* process.c: RARRAY_LEN() returns long int.

Tue Mar  8 09:07:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_REPLACE_TYPE): enclose in quotes for multiple
	  type names.

Tue Mar  8 01:43:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (get_sc_ngroups_max): define to wrap sysconf(3).
	  this also supports Windows which doesn't have sysconf(3).

	* process.c (maxgroups): use get_sc_ngroups_max.

	* process.c (proc_setmaxgroups): ditto.

Tue Mar  8 01:16:49 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (rb_objspace): an initializer must be a constant.

Tue Mar  8 01:11:44 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* process.c (maxgroups): cast because sysconf(3)'s return value is long.

	* process.c (proc_setmaxgroups): ditto.

	* process.c (proc_setgroups): cast because RARRAY_LEN() is long.

Tue Mar  8 00:02:47 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_rsa.c: parenthesize macro arguments.

Mon Mar  7 22:59:39 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/pstore.rb: Delete variable @transaction and fix #4474. Patch by
	  Masaki Matsushita (Glass_saga).

	* test/test_pstore.rb(test_thread_safe): Add test for #4474.

Mon Mar  7 21:31:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setgroups): replace getgrnam() with getgrnam_r()
	  because getgrnam() isn't thread safe.

Mon Mar  7 20:49:12 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getmaxgroups, proc_setmaxgroups): reflect
	  platform maxgroups limitation by default instead hardcoded 65536.

Mon Mar  7 17:13:00 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (rb_gc_set_params): allow GC parameter configuration by
	  environment variables.  based on a patch from funny-falcon at
	  https://gist.github.com/856296, but honors safe level.

Mon Mar  7 09:05:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c: NUM2RLIM is defined but no getrlimit and setrlimit on
	  mingw.

Mon Mar  7 08:38:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/date/date_core.c (DateTimeData): should not use bare 'long long'
	  and 'long double', which are not defined by C89.

	* ext/date/date_core.c (dt_lite_plus): get rid of overflow at casting
	  down double to integer.

Mon Mar  7 00:21:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_getgroups): get rid of maxgroups dependency.
	  ngroups can be calculated dynamically.

Sun Mar  6 23:45:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: rlim_t use standard RUBY_REPLACE_TYPE mechanism.

Sun Mar  6 23:26:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (proc_setmaxgroups): added negative value check.
	  This was suggested by Daniel Berger. Thanks Daniel!
	  [ruby-core:35426][Bug#4467]

Sun Mar  6 23:18:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (maxgroups, proc_setmaxgroups): increase max groups
	  limitation up to 65536.

Sun Mar  6 22:20:59 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_ec.c: parenthesize macro arguments.

Sun Mar  6 21:49:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* sample/list.rb (MyElem#initialize): initialize @head
	  explicitly. Otherwise -W2 option makes following warning.
	  "warning: instance variable @head not initialized".
	  This issue was founded by Andrew Grimm. Thanks Andrew!
	  [ruby-core:35435][Bug#4471]

Sun Mar  6 05:21:41 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* class.c: fix camelCase to snake_case in documentation code examples.
	  patched by Andrew Grimm. fixes Bug #4469

	* marshal.c: ditto.

	* proc.c: ditto.

	* sample/biorhythm.rb: ditto.

	* vm_eval.c: ditto.

	* vm_method.c: ditto.


Sun Mar  6 03:22:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl): use rb_thread_io_blocking_region() instead
	  rb_thread_blocking_region().

Sat Mar  5 22:54:36 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* include/ruby/intern.h: fix a typo of prototype declaration.
	  rb_mutex_try_lock -> rb_mutex_trylock [ruby-dev:43213]

Sat Mar  5 19:44:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (TestIO#test_fcntl_lock): small clean up.

Sat Mar  5 01:33:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl, nogvl_io_cntl): IO.fcntl() and IO.ioctl()
	  release GVL during calling kernel interface.
	  Suggested by Eric Wong. [ruby-core:35417][Bug #4463]

	* test/ruby/test_io.rb (TestIO#test_fcntl_lock): add new test for
	  IO.fcntl().

Fri Mar  4 23:09:12 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/testunit/test_parallel.rb
	  (test_should_run_all_without_any_leaks): consider that the order of
	  testcase could change. [ruby-dev:43300] [Bug #4466]

Fri Mar  4 22:01:14 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (io_cntl): change 'cmd' type to int. ioctl and fcntl need to
	  be passed int.
	* io.c (rb_io_ctl): ditto.

Fri Mar  4 21:10:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: save warnflags. the patch is created by Eric Wong.
	  [Bug #4465]

Wed Mar  2 21:15:00 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_dsa.c: parenthesize macro arguments.

Thu Mar  3 22:10:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* process.c (check_exec_redirect_fd, check_exec_redirect): raise
	  ArgumentError if fd >= 3 on Windows because the feature is not
	  supported.

	* test/ruby/test_process.rb (test_execopts_redirect): remove meaningless
	  argument.

Thu Mar  3 21:21:42 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (test_execopts_redirect): redirecting fd
	  >= 3 is not supported on Windows, so should not specify such options
	  when calling spawn or others.

Thu Mar  3 18:59:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_slice_bang): raise error when the string is frozen.

Thu Mar  3 14:25:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* strftime.c (STRFTIME): return 0 and ERANGE when precision is too
	  large. [ruby-dev:43284] fixes #4456

Thu Mar  3 00:46:51 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (uleb128): cast the value to unsigned long.

	* addr2line.c (fill_lines): print error when lseek fails.

Thu Mar  3 00:36:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/rexml/encoding.rb (REXML::Encoding#encoding=): store @encoding
	  a String which means the name of the encoding.
	  this partially revert r29646.

	* lib/rexml/document.rb: follow above.

	* lib/rexml/output.rb: ditto.

	* lib/rexml/parsers/baseparser.rb: ditto.

	* lib/rexml/source.rb: ditto.

	* lib/rexml/xmldecl.rb: ditto.

Wed Mar  2 23:19:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_byte_substr): return nil for negative length.

Wed Mar  2 21:15:00 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey_dh.c: parenthesize macro arguments.

Wed Mar  2 14:24:04 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Fix name from `inclement_io` to
	  `increment_io`.

Wed Mar  2 14:06:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_slice_bang): move treatments which is only needed
	  when the result is not nil.

Wed Mar  2 14:02:29 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb(TestParallel#spawn_runner):
	  Fix outputing empty line in running test.

	* test/testunit/tests_for_parallel/test_third.rb: Remove `sleep`

Tue Mar  1 22:29:10 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey.h: parenthesize macro arguments.

Tue Mar  1 22:02:35 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: Fix number.

Tue Mar  1 21:48:22 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit/parallel.rb: For Windows.

	* test/testunit/test_parallel.rb(TestParallelWorker#test_quit_in_test):
	  Fix for above specification change.
	* test/testunit/test_parallel.rb(TestParallel#spawn_runner):
	  Fix outputing empty line in running test.

Tue Mar  1 20:51:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  remove tests for [bug#4396]. because we decided to reject this
	  ticket.

Tue Mar  1 19:46:19 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/{test_date.rb,test_date_attr.rb}: [ruby-dev:43280]

Tue Mar  1 18:40:38 2011  Ryan Davis  <ryan@YPCMC09457>

	* lib/rubygems*: Import rubygems 1.6.0 (released version @ 58d8a0b9)
	* test/rubygems: Ditto

Tue Mar  1 16:22:22 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c: revert r30987 because it causes some failures in
	  test-all, especially webrick.

Tue Mar  1 15:59:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_byteslice): the resulted encoding should keep
	  original encoding. this also fixes the encoding when the result
	  shares internal string. [ruby-core:35376]

Tue Mar  1 13:25:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (VpMemAlloc): CVE-2011-0188.
	  Fixes a bug reported by Drew Yao <ayao at apple.com>

Tue Mar  1 10:34:39 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_byteslice): Add String#byteslice. [ruby-core:35376]

Tue Mar  1 00:12:49 2011  Tajima Akio <artonx@yahoo.co.jp>

	* include/ruby/win32.h: define WIN32 if neither _WIN64 nor WIN32
	  defined. it forces to use push/pop for pack(4) pragma.

Mon Feb 28 23:52:13 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/testunit/test_rake_integration.rb (test_with_rake_runner):
	  use assert_in_out_err for suppress messages.

Mon Feb 28 22:48:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_spawn): use shell if a commandline contain
	  double-quote character.
	* win32/win32.c (is_internal_cmd): similar, use shell if a commandline
	  contain caret character.

	* test/ruby/test_system.rb (TestSystem#test_system_at): fix
	  wrong test case. if system() invoke a command by using shell,
	  system() never return nil. Also, "" quotation must not appear
	  twice in a command line.

Mon Feb 28 17:36:57 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkcs7.c: parenthesize macro arguments.

Mon Feb 28 16:48:42 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkcs12.c: parenthesize macro arguments.

Mon Feb 28 16:28:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_trans): when the hash for multibyte repl is empty,
	  tr is inverse mode, and a character doesn't much the table, the
	  character should be replaced by last replacement. Bug #4449

Mon Feb 28 16:38:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ocsp.c: parenthesize macro arguments.

Mon Feb 28 13:02:15 2011  Danial Pearce <github@tigris.id.au>

	* lib/tempfile.rb: Fix example file paths in docs for tempfile.
	  https://github.com/ruby/ruby/pull/5

Mon Feb 28 12:56:18 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_init): typo fix.
	  https://github.com/ruby/ruby/pull/8

Mon Feb 28 12:28:13 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/date/date_core.c (datetime_s_now): localtime() and localtime_r()
	  required time_t pointer as 1st parameter, and tv_sec member of struct
	  timeval is long.

Mon Feb 28 11:57:40 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb: Temporally disable test on Windows.

Mon Feb 28 07:28:35 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Runner#after_worker_quit):
	  method name more be natural English.

	* lib/test/unit.rb(Test::Unit::Runner::Worker.launch):
	  IO.sync doesn't need. Should use "b" for mode.

Sun Feb 27 21:59:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_redirect_win):
	  add test for system().

Sun Feb 27 18:00:09 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Refactoring; Worker never use Hash for internal
	  storage.

	* lib/test/unit.rb: Never use Kernel#spawn. Use IO.popen instead.

Sun Feb 27 13:16:48 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_ns_spki.c: parenthesize macro arguments.

Sat Feb 26 17:07:53 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: [Feature #4257]

	* ext/date/extconf.rb: new

	* ext/date/date_core.c: new

Sat Feb 26 16:10:23 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: --jobs-status won't puts over 2 lines.

	* test/testunit/test_parallel.rb: Fix test for above.

	* lib/test/*: refactoring.

Sat Feb 26 07:10:05 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: fix parsing timezone's whose
	  whose format is (+/-)hhmm.  Thanks Goncalo Silva!

	* test/psych/test_scalar_scanner.rb: test for bug.

Thu Feb 24 23:02:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_hmac.c: parenthesize macro arguments.

Thu Feb 24 22:53:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (love): for the birthday.

Thu Feb 24 22:51:54 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_vm_destruct): run vm exit hooks after all objects are
	  destructed.

Thu Feb 24 14:40:33 2011  Shota Fukumori  <sorah@tubusu.net>

	* ChangeLog (vim): Modeline for vim

Thu Feb 24 13:39:25 2011  Shota Fukumori  <sorah@tubusu.net>

	* common.mk: Use $RUNRUBY for worker process.

	* lib/test/unit.rb: Fix bug.

	* lib/test/unit.rb: @options[:ruby](@opts[:ruby]) is now Array.

	* test/testunit/parallel.rb: Fix for above.

Thu Feb 24 10:05:55 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/tests_for_parallel/misc.rb: Fix bug in r30947.

	* lib/test/unit.rb, lib/test/unit/assertions.rb: For this test.

Wed Feb 23 23:07:38 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb, test/testunit/parallel/*:
	  Test for r30939.

	* lib/test/unit.rb: For test.

	* lib/test/parallel.rb: For test.

	* lib/test/unit/testcase.rb: For test.

Wed Feb 23 22:05:13 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_engine.c: parenthesize macro arguments.

Tue Feb 22 23:15:17 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Fix --ruby option doesn't effect.

	* lib/test/unit.rb: Fix typo.

Tue Feb 22 21:39:28 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_digest.c: parenthesize macro arguments.

Tue Feb 22 14:34:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Fix merging miss.

Tue Feb 22 12:27:26 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Add new options; --jobs,-j,--ruby,--jobs-status,
	  --no-retry.
	  [Feature #4415] [ruby-dev:43226],[ruby-dev:43222],[ruby-core:35294]

	* lib/test/unit/parallel.rb: Used at test/unit --jobs(-j) option.

	* test/csv/test_serialization.rb: test/unit parallel running ready.

	* test/rake/test_file_task.rb: test/unit parallel running ready.

Tue Feb 22 06:09:10 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/syslog/syslog.c: Apply documentation patch from mathew murphy.
	  [Bug #4149]

Tue Feb 22 03:09:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: increase Psych to 1.1.0 for help with
	  debugging.

Tue Feb 22 03:04:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/streaming.rb: refactor streaming methods to a
	  module.
	* ext/psych/lib/psych/stream.rb: extracted streaming specific methods
	  to a module.
	* ext/psych/lib/psych/json/stream.rb: JSON stream inherits from
	  JSONTree and includes streaming methods.
	* ext/psych/lib/psych/visitors/json_tree.rb: JSON does not support
	  object references, so remove object reference testing when building
	  JSON trees.

Tue Feb 22 02:41:51 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb (accept): use Hash#key?
	  when looking up object references to err on the side of cache
	  misses.

Mon Feb 21 10:58:39 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/yaml_events.rb: refactoring JSON event
	  handling methods to a module for reuse.
	* ext/psych/lib/psych/json/tree_builder.rb: AST builder uses JSON
	  event methods.
	* ext/psych/lib/psych/json/stream.rb: stream emitter uses JSON event
	  methods.

Mon Feb 21 10:54:29 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/stream.rb: do not emit custom tags in maps
	  or sequences when emitting JSON.
	* ext/psych/lib/psych/json/tree_builder.rb: do not emit custom tags in
	  sequences when emitting JSON.
	* test/psych/json/test_stream.rb: tests for custom stream emits.
	* test/psych/test_json_tree.rb: tests for JSON emits.

Mon Feb 21 10:05:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/ruby_events.rb: DRY up ruby event handling
	  for JSON.
	* ext/psych/lib/psych/visitors/json_tree.rb: use ruby events module
	* ext/psych/lib/psych/json/stream.rb: ditto

Mon Feb 21 10:01:01 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/stream.rb: fix JSON stream emits to use
	  double quotes during stream.
	* test/psych/json/test_stream.rb: tests to reflect changes.

Mon Feb 21 00:38:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  add testcase for bug4396.

Sun Feb 20 19:59:32 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_cipher.c: parenthesize macro arguments.

Sun Feb 20 16:26:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (exec_recursive): prevent temporary objects from GC.

	* prevent temporary objects from GC, and should not use
	  RSTRING_PTR() for function calls since it evaluates the argument
	  a couple of times.

Sun Feb 20 16:22:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_flock): use rb_thread_io_blocking_region for the
	  time being.

Sun Feb 20 05:33:17 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.2 r6207.
	* test/minitest/*: ditto

Sun Feb 20 02:14:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sig_trap): avoid pthread_sigmask(xx, &mask, &mask) usage
	  because FreeBSD don't permit it. If it's used, it behave as
	  pthread_sigmask(xx, NULL, &mask).

	* signal.c (init_sigchld): ditto.

Sun Feb 20 00:46:51 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_bn.c: parenthesize macro arguments.

Sat Feb 19 22:37:42 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_insnhelper.c (vm_check_if_namespace): guard temporary object
	  from GC.

Sat Feb 19 06:36:27 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/test/unit.rb: partial revert of r30849. [ruby-core:32864]

	* test/testunit/test_rake_integration.rb: adding an integration test
	  with the rake loader to prevent regressions.

Fri Feb 18 19:31:31 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::remove_entry_secure): there is a
	  race condition in the case where the given path is a directory,
	  and some other user can move that directory, and create a
	  symlink while this method is executing.
	  Reported by: Nicholas Jefferson <nicholas at pythonic.com.au>

Fri Feb 18 00:28:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* compile.c (get_exception_sym2type): guard temporary object from GC.

Thu Feb 17 23:54:29 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* iseq.c (prepare_iseq_build): initialize iseq_compile_data::err_info
	  with nil. this fix exception in rb_iseq_load().

Thu Feb 17 22:32:35 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_marshal.rb (test_marshal_dump_extra_iv):
	  fix a typo of local variable. [Bug #3720] [ruby-dev:42083]

Thu Feb 17 21:32:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl.h: parenthesize macro arguments.

Wed Feb 16 20:37:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* eval_jump.c (rb_exec_end_proc): changed at_exit and END proc
	  evaluation order. [Bug #4400] [ruby-core:35237]
	* eval_jump.c (rb_mark_end_proc): ditto.

	* test/ruby/test_beginendblock.rb (TestBeginEndBlock#test_nested_at_exit):
	  added a test for nested at_exit.
	* test/ruby/test_beginendblock.rb (TestBeginEndBlock#test_beginendblock):
	  changed the test to adopt new spec.

Wed Feb 16 20:17:06 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/openssl_missing.h: parenthesize macro arguments.

Tue Feb 15 21:37:45 2011  Tanaka Akira  <akr@fsij.org>

	* ext/gdbm/gdbm.c: parenthesize macro arguments.

Tue Feb 15 20:34:53 2011  Tanaka Akira  <akr@fsij.org>

	* array.c (ary_join_1): fix array size.

Tue Feb 15 19:43:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: fix and resubmit r30621. [ruby-dev:43203]

Tue Feb 15 15:41:30 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (array_join): copy the encoding of the first element as
	  an initial encoding.

	* array.c (array_join_0): ditto.

	* array.c (array_join_1): ditto.

	* array.c (inspect_ary): ditto.

	* array.c (array_join_1): add an argument to check the appending is
	  first one or not.

Tue Feb 15 15:40:53 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* hash.c (inspect_i): copy the encoding of the first key as
	  an initial encoding.

Mon Feb 14 15:00:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (inspect_ary): don't taint the inspected result of a
	  recursive array.

Tue Feb 15 15:43:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): change the rule for empty strings:
	  remove the special treatment of the US-ASCII encoded empty string.
	  Now Encoding.compatible? usually respect the encoding of the
	  receiver.

Tue Feb 15 15:39:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): remove special treatment of
	  ASCII-8BIT receivers.

	* string.c (str_gsub): set initial encoding of the buffer as the
	  same of the receiver. [ruby-core:35141]

Tue Feb 15 09:49:33 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_system.rb (TestSystem#test_system_at): use findstr
	  command instead of find command, because the latter is confusing
	  another famous Unix command.

Mon Feb 14 23:01:19 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (rb_thread_io_blocking_region): reset th->waiting_fd
	  after blocking region, because remaining waiting_fd might
	  cause unnecessary IOError.

Mon Feb 14 21:06:50 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in: revert r30621.  That revision introduced mkmf test
	  failures and it turned out to be OK to revert. [ruby-dev:43203]

Mon Feb 14 21:04:01 2011  Tanaka Akira  <akr@fsij.org>

	* ext/fiddle/conversions.h: parenthesize macro arguments.

Mon Feb 14 18:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/setup.mak (USE_RUBYGEMS): fixed r30835. It didn't work on
	  mswin32 port. If you changed win32/configure.bat, you should change
	  setup.mak too.

Mon Feb 14 17:28:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_system.rb (TestSystem#test_system_at):
	  added test. [ruby-core:35218] (#4393)

Mon Feb 14 13:15:35 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (is_internal_cmd): if the first char of prog is '@',
	  execute it via shell.  [ruby-core:35218] (#4393)

Mon Feb 14 10:33:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb: revert r30863, because it causes too many noise.

Mon Feb 14 07:34:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c: parenthesize macro arguments.

Sun Feb 13 19:41:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::RequireFiles#non_options): skip
	  test suites failed to load instead of mere messages.

Sun Feb 13 09:56:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/openssl/test_config.rb (OpenSSL#test_freeze): fix error
	  message assertion.

	* test/io/nonblock/test_flush.rb (TestIONonblock#flush_test):
	  return true to finish the test.

	* test/syck/test_string.rb (Syck::TestString#test_non_binary_string):
	  use assert_not instead of refute, unless required minitest
	  explicitly.

	* test/test_prime.rb (TestPrime::sieve.Integer): ditto.

	* test/xmlrpc/webrick_testing.rb (WEBrick_Testing#start_server):
	  catch IOError when server socket was closed.

Sun Feb 13 07:39:51 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enum.c (enum_inject): typo fixed. a patch from Gaku Ueda in
	  [ruby-core:35216].

Sun Feb 13 00:48:47 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (Date#===): [ruby-core:35127]

Sun Feb 13 00:29:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Options#process_args): always
	  return options.

	* lib/test/unit.rb (Test::Unit::RequireFiles#non_options): return
	  if any test case get loaded.

	* lib/test/unit.rb (Test::Unit::AutoRunner#initialize): do not add
	  default directory if it is nil.

	* lib/test/unit.rb (Test::Unit::AutoRunner#process_args): return
	  true if any test cases to run.

Sat Feb 12 23:17:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (assert_include): add alias.

Sat Feb 12 14:44:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_io_blocking_region): new function to run
	  blocking region with GIL released, for fd.

	* thread.c (rb_thread_fd_close): implement.  [ruby-core:35203]

	* vm.c (th_init): rename from th_init2.

Sat Feb 12 14:41:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::AutoRunner#initialize): use
	  default_dir if no test case given.

	* lib/test/unit.rb (Test::Unit::Runner): rename from Test::Unit::Mini.

	* lib/test/unit.rb (Test::Unit::GlobOption#non_options): run tests
	  under base directory if no argument given.

Sat Feb 12 08:03:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_settracefunc.rb (TestSetTraceFunc): ensure to use
	  method_added hook defined in Module.

Sat Feb 12 01:04:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (proc_options): enable rubygems if --gem option is given.

	* ruby.c (process_options): load rubygems if it is disabled but
	  --gem option is given.

Fri Feb 11 23:27:50 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ruby.c (proc_options): add --gem=enabled as an alias of
	  --enable=gems and --gem=disabled as an alias of --disable=gems.
	  Gem named "enabled" or "disabled" has already been reserved
	  legitimately for this purpose.

Fri Feb 11 23:17:04 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dl/cfunc.c: parenthesize macro arguments.

Fri Feb 11 21:41:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bin/testrb, test/runner.rb, lib/test/unit.rb: improve backward
	  compatibility.

Fri Feb 11 19:45:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): use rb_ary_free to free internal object.

	* gc.h (RUBY_FREE_UNLESS_NULL): get rid of double free.
	  [ruby-core:35192]

Fri Feb 11 16:57:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_transcode.rb (test_from_cp50221): fix wrong
	  assertion and move back.

Fri Feb 11 14:33:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_no_match): alias for
	  backward compatibility.

Fri Feb 11 12:06:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (add_gems, require_libraries, proc_options): add
	  --require and --gem options.

Fri Feb 11 12:03:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rubygems): add --disable-rubygems option.

Fri Feb 11 11:39:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in (CROSS_COMPILING): get rid of NameError.

Thu Feb 10 23:12:34 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dl/dl.h: parenthesize macro arguments.

Wed Feb  9 23:11:27 2011  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c: parenthesize macro arguments.

Tue Feb  8 11:47:11 2011  Loren Sands-Ramshaw  <lorensr@gmail.com>

	* array.c: documentation clarification in rotate, rotate!,
	  index, and rindex. [ruby-core:35144]

Wed Feb  9 09:45:43 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_encoding.rb: remove unnecessary (and wrong)
	  platform-dependent hacks.

Wed Feb  9 00:47:18 2011  Tanaka Akira  <akr@fsij.org>

	* ext/etc/etc.c: parenthesize macro arguments.

Tue Feb  8 19:38:00 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg): fix for invalid nest errors.

Tue Feb  8 19:22:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in (AC_MSG_CHECKING): fixed typo. the patch is
	  created by Benoit Daloze. Thanks a lot. [Bug #4384][ruby-core:35148]

Tue Feb  8 16:04:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_s_sysopen): use NUM2MODET() instead NUM2UINT().

Tue Feb  8 15:59:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (rb_run_exec_options_err): use MODET2NUM() instead
	  LONG2NUM().

Tue Feb  8 13:59:56 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: revert r30725. Now we have proper runtime fallback.
	  Therefore, no need compile time disabling. (see r30762).

Tue Feb  8 01:00:21 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* process.c (proc_setgroups): add GC guard to prevent intermediate
	  variable from GC.

Tue Feb  8 00:56:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-expr-beg, ruby-in-here-doc-p): tell
	  singleton class definitions from here documents.

	* misc/ruby-mode.el (ruby-expr-beg, ruby-parse-partial): keyword
	  followed by colon is label.

Mon Feb  7 22:56:16 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/benchmark.rb (Benchmark#bmbm): use ensure clause instead of
	  Object#tap to restore STDOUT.sync.

Mon Feb  7 22:34:20 2011  Tanaka Akira  <akr@fsij.org>

	* lib/net/http.rb (Net::HTTP#connect): support SNI (Server Name
	  Indication) for HTTPS.  [ruby-dev:43164]
	  http://stackoverflow.com/questions/4685736/openssl-server-name-indication-support-in-ruby

Mon Feb  7 16:05:32 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.3  Fixes [Bug #4376]

Mon Feb  7 11:46:59 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (rdoc): add --encoding=UTF-8; ruby's rdoc must be UTF-8.

Mon Feb  7 10:21:50 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_options.rb (TestRDocOptions#test_check_files):
	  there is no easy way to create owner unreadable file on Windows.
	  So, skip the test.

Sun Feb  6 13:48:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/lib/json/common.rb (JSON::MissingUnicodeSupport.iconv):
	  should not drop rest of the result.  use Iconv.conv instead.

Sun Feb  6 12:46:02 2011  Eric Hodel  <drbrain@segment7.net>

	* string.c (gsub): Ensure result encoding is the same as input
	  encoding.  [Bug #4340].

Sun Feb  6 12:18:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (words, qwords): dispatch array events.  based on a
	  patch from Michael Edgar.  [Bug #4365].

Sun Feb  6 12:12:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/fileutils/fileasserts.rb (FileAssertions): separate module.

Sun Feb  6 11:29:23 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c: parenthesize macro arguments.

Sat Feb  5 22:01:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  revert r30796. r30797 and r30798 are an alternative fix.
	  [ruby-dev:43174]

Sat Feb  5 21:47:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (mlhs_basic): include mlhs_post for ripper.  a patch
	  from Michael Edgar at [ruby-core:35078].

Sat Feb  5 21:22:21 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_block): move from
	  test/fileutils/fileasserts.rb.

	* test/fileutils/fileasserts.rb (assert_block): pass arguments
	  as-is.  [ruby-dev:43174]

Sat Feb  5 16:47:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  msg can be passed nil. [Bug #4371] [ruby-dev:43174]

Sat Feb  5 15:18:25 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.2

Sat Feb  5 12:05:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (syck_node_init_copy): SyckNode is not
	  copiable.  [ruby-core:35094]

Sat Feb  5 11:48:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_alloc): leave data ptr
	  NULL.

	* ext/openssl/ossl_cipher.c (ossl_cipher_new, ossl_cipher_initialize):
	  allocate internal structure.  [ruby-core:35094]

	* ext/openssl/ossl_cipher.c (ossl_cipher_copy): ditto.

Sat Feb  5 11:29:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/parser/parser.h (GET_PARSER): raise TypeError.

	* ext/json/parser/parser.rl (cParser_initialize): ditto.

	* ext/json/parser/parser.h (GET_PARSER): check if initialized.
	  [ruby-core:35079]

	* ext/json/parser/parser.rl (cParser_initialize): ditto.

Sat Feb  5 10:09:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_get_expanded_load_path): always expand load paths.

Sat Feb  5 09:38:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (encoded_dup): extract.

Sat Feb  5 03:37:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::LowMethods): make low level methods
	  in NoWrite and DryRun to do nothing.  [ruby-dev:43129]

	* test/fileutils/fileasserts.rb: add message arguments.

	* test/fileutils/fileasserts.rb (Test::Unit::Assertions#assert_block):
	  show the given message.

Sat Feb  5 02:09:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lex_getline, parser_set_encode): set encoding of lines
	  in SCRIPT_LINES__ as source encoding.  [ruby-dev:43168]

Sat Feb  5 02:08:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_thread_data_type): add prefix.

Sat Feb  5 00:59:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (GetThreadPtr): use TypedData_Get_Struct() instead
	  CoreDataFromValue() because we need type check. Otherwise,
	  type mismatch can cause segmentation fault crash.
	  [ruby-core:35086] [Ruby 1.9-Bug#4367]

	* vm.c (thread_data_type): remove static.

Fri Feb  4 19:14:27 2011  Tanaka Akira  <akr@fsij.org>

	* enc/trans/utf8_mac.trans: parenthesize macro arguments.

Fri Feb  4 12:11:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (str_utf8_nth): fixed a condition of optimized lead
	  byte counting. [Bug #4366][ruby-dev:43170]

Fri Feb  4 01:50:13 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* string.c (count_utf8_lead_bytes_with_word): wrote function
	  comments.

Fri Feb  4 00:14:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_reader_get_unused): no need to dup
	  before rb_str_resurrect.

Thu Feb  3 20:04:44 2011  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c (CHECK): unused macro removed.

Thu Feb  3 18:33:26 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_reader_get_unused): use rb_str_resurrect
	  because gz->z.input is hidden string. [ruby-core:35057]

Thu Feb  3 16:34:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c (code_to_mbc): cast as int from the subtraction of
	  pointers.

	* enc/utf_16le.c (utf16le_mbc_enc_len): use ptrdiff_t.

	* enc/utf_32be.c (utf32be_left_adjust_char_head): ditto.

	* enc/utf_32le.c (utf32le_left_adjust_char_head): ditto.

Thu Feb  3 16:31:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/missing.h: don't use HAVE_STDDEF_H because it never
	  defined by configure though configure.bat defines it.

	* include/ruby/ruby.h: move include stddef.h to defines.h

	* include/ruby/defines.h: ditto.

Wed Feb  2 20:25:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/encoding.h (rb_enc_step_back): cast 4th argument 'n'
	  as int because Ruby usually treats length value as long but
	  onigenc_step_back's 4th argument is int.

Thu Feb  3 07:20:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: use Regexp::NOENCODING
	  rather than magic number.

	* ext/syck/lib/syck/rubytypes.rb: ditto

Thu Feb  3 07:16:11 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* re.c (Init_Regexp): added a constant for ARG_ENCODING_NONE
	  [ruby-core:35054]

	* test/ruby/test_regexp.rb: corresponding test.

Thu Feb  3 07:02:16 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: ARG_ENCODING_NONE regular
	  expressions can round trip. [ruby-core:34969]

	* test/psych/test_yaml.rb: test for ARG_ENCODING_NONE regex

	* ext/sych/lib/syck/rubytypes.rb: ARG_ENCODING_NONE regular
	  expressions can round trip.

	* test/syck/test_yaml.rb: test for ARG_ENCODING_NONE regex

Wed Feb  2 17:09:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_fdatasync): Use fsync(2) if the underlying
	  operating system does not support fdatasync(2).

Wed Feb  2 14:51:08 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc/markup/to_tt_only.rb: commit miss
	* test/rdoc/test_rdoc_markup_to_tt_only.rb: ditto
	* test/rdoc/test_rdoc_single_class.rb: ditto

Wed Feb  2 09:27:53 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Upgrade to RDoc 3.5.1

Wed Feb  2 00:30:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/st.h (st_table): Added comment why we need __extension__.

Tue Feb  1 20:45:44 2011  Tanaka Akira  <akr@fsij.org>

	* enc/encdb.c: parenthesize macro arguments.

Tue Feb  1 15:12:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_require.rb (TestRequire#test_require_with_unc):
	  use ``127.0.0.1'' instead of ``localhost'' as host name, because
	  XP or earlier cannot resolv it as NBT hostname.

Tue Feb  1 13:20:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/benchmark/test_benchmark.rb (#capture_bench_output):
	  Added explicit sleep. Windows have imprecise time support.
	  Thus Tms.new.Add!{} may be or may be not equal 0. The
	  test failure started since r30747.

Tue Feb  1 11:03:47 2011  Ryan Davis  <ryan@lust.local>

	* lib/rubygems*: Import rubygems 1.5.0 (released version @ 1fb59d0)
	* test/rubygems: Ditto

Tue Feb  1 08:01:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_set_winsize): new method to set
	  console size.  [EXPERIMENTAL]

	* ext/io/console/console.c (console_winsize): use GetWriteFD.

Tue Feb  1 02:28:14 2011  Masaya Tarui  <tarui@ruby-lnag.org>

	* include/ruby/win32.h, win32/win32.c: add rb_w32_inet_ntop.
	  inet_ntop's minimum supported client is Vista.

Tue Feb  1 00:10:30 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/benchmark.rb: fix benchmark to work with current ruby.
	  patched by Benoit Daloze [ruby-core:33846] [ruby-dev:43143]
	  merged from https://github.com/eregon/ruby/commits/benchmark

	*  lib/benchmark (Report#width): update documentation
	*  lib/benchmark: document the return value of #benchmark and the
	   :list attribute in Report
	*  lib/benchmark (Tms#format): rename variables, use String#%
	   instead of Kernel.format
	*  lib/benchmark: remove undocumented Benchmark::times (an alias
	   of Process::times used twice)
	*  lib/benchmark (#benchmark): use label_width for the caption
	*  lib/benchmark (Tms#initialize): rename variables
	*  lib/benchmark: allow title to not be a String and call #to_s
	*  lib/benchmark (Benchmark#bm): return an Array of the times with
	   the labels
	*  lib/benchmark: correct output for Benchmark#bmbm
	   (remove the extra space)
	*  lib/benchmark: add a few tests for Benchmark::Tms output
	*  lib/benchmark: improve style (enumerators, ljust, unused vars)
	*  lib/benchmark: add spec about output and return value
	*  lib/benchmark: improve basic style and consistency
	   no parenthesis for print and use interpolation instead of printf
	*  lib/benchmark: remove unnecessary conversions and variables
	*  lib/benchmark: correct indentation
	*  lib/benchmark: rename the FMTSTR constant and variable to FORMAT
	*  lib/benchmark: remove useless exception

	*  test/benchmark: remove unused variable warnings

Mon Jan 31 23:27:23 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* node.c (add_id): remove duplicated rb_id2str() call.

Sun Jan 30 17:19:46 2011  Tanaka Akira  <akr@fsij.org>

	* missing/langinfo.c: parenthesize macro arguments.

Mon Jan 31 21:57:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: revert r30698.

Mon Jan 31 21:32:44 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread.c (thread_start_func_2): check deadlock condition before
	  release thread stack. fix memory violation when deadlock detected.
	  reported by Max Aller. [Bug #4009] [ruby-core:32982]

Mon Jan 31 14:45:47 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale::#search_file):
	  Gem might be undefined if --disable-gems. [ruby-core:34990]

Mon Jan 31 12:26:14 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: suppressed shorten-64-to-32 warnings.
	* regcomp.c: ditto.
	* regexec.c: ditto.
	* regint.h: ditto.
	* regparse.c: ditto.
	* regparse.h: ditto.
	* time.c: ditto.
	* variable.c: ditto.

Mon Jan 31 04:45:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_uniq_bang): call ARY_SET_LEN(ary, 0) before
	  ary_resize_capa because ary_resize_capa expects resized length is
	  smaller than current array length. call rb_ary_unshare before
	  ary_resize_capa because ary_resize_capa lost the reference to
	  original shared array. [ruby-core:34997]

Sun Jan 30 17:19:46 2011  Tanaka Akira  <akr@fsij.org>

	* missing/crypt.c: parenthesize macro arguments.

Sun Jan 30 16:40:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rubygems/test_gem_security.rb (TestGemSecurity): valid only
	  if OpenSSL is available.

	* test/dl/test_dl2.rb (TestDL#test_sin): math functions do not
	  work on x86_64 due to the design of DL2.

	* test/dl/test_func.rb (DL::TestFunc#test_{sinf,sin): ditto.

Sun Jan 30 16:09:22 2011  Tanaka Akira  <akr@fsij.org>

	* strftime.c (rb_strftime_with_timespec): %G produces 4 digits.

Sun Jan 30 15:13:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/emacs_mule.c (emacsmule_islead): 7bit range is also leading
	  byte.

Sun Jan 30 13:03:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_fetch_m): use useful message for longer key, not a
	  nonsense id value.

	* string.c (rb_str_ellipsize): new function to ellipsize a string.

	* include/ruby/encoding.h (rb_enc_step_back): new function to step
	  back n characters.

Sun Jan 30 12:53:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/emacs_mule.c (emacsmule_islead): fix inverse condition.

Sun Jan 30 09:37:25 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* io.c (struct argf): char behaves like an unsigned char
	  by default on AIX.

Sun Jan 30 08:02:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: Mac OS X wrongly reports it has fdatasync(3).

Sun Jan 30 03:29:47 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (GetBNPtr): add missing nil case.
	  patched by Martin Bosslet. [ruby-core:34987]

Sun Jan 30 01:02:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/ruby.h: Added NUM2MODET() and MODET2NUM() default
	  definition.
	  Because r30686 introduced win32 build failure.

Sat Jan 29 22:16:26 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_join): [].join.encoding must be US-ASCII.
	  [ruby-list:47790]

Sat Jan 29 20:22:39 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* benchmark/driver.rb (BenchmarkDriver#measure): Show command line
	  when abnormal exiting occur.

Sat Jan 29 10:53:16 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_get_ev_const): no-scope reference to toplevel
	  private constant has been prohibited incorrectly.

	* test/ruby/test_module.rb (test_toplevel_private_constant): add a
	  test for above.

Sat Jan 29 08:43:23 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.5.0 (release candidate @ 09893d9)
	* test/rubygems: Ditto

Sat Jan 29 02:02:37 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (rb_mod_const_of, sv_i): Module#constant should exclude
	  private constants.  see [ruby-core:32912].

	* test/ruby/test_module.rb (test_constants_with_private_constant): add
	  a test for above.

Sat Jan 29 01:36:41 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (rb_const_set): const_set should preserve constant
	  visibility.  see [ruby-core:32912].

	* test/ruby/test_module.rb: add a test for above.

Sat Jan 29 01:24:57 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (NODE_CLASS, NODE_MODULE), insns.def (defineclass): raise
	  an exception when "class Foo::Bar" is evaluated and Foo::Bar is
	  private.  To implement this, define_type of "defineclass" is added
	  so that the instruction can distinguish whether the class definition
	  is scoped (class Foo::Bar) or not (class Bar).

	* test/ruby/test_class.rb (test_redefine_private_class),
	  test/ruby/test_module.rb
	  (test_define_module_under_private_constant): add tests for above.

Sat Jan 29 01:19:17 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* constant.h, variable.c: to ensure compatibility, rb_const_get_* must
	  not raise an exception even when the constant is private.  Instead,
	  rb_public_const_get_* and rb_public_const_defined_* are introduced,
	  which raise an exception when the referring constant is private.
	  see [ruby-core:32912].

	* vm_insnhelper.c (vm_get_ev_const): use rb_public_const_get_* instead
	  of rb_const_get_* to follow the constant visibility when user code
	  refers a constant.

	* test/ruby/test_marshal.rb (test_marshal_private_class): add a test.
	  This test had failed because of incompatibility of rb_const_get.

Sat Jan 29 00:30:44 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): fix typo.  a patch from Tomoyuki
	  Chikanaga in [ruby-core:32919].

Fri Jan 28 23:20:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_no_create,
	  TestGDBM2#test_writer_open_notexist): We only need to skip libgdbm
	  1.8.0, not all 1.8.x. 1.8.1 or later don't have GDBM_WRITER sickness.

Fri Jan 28 21:56:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/dbm/extconf.rb: Added new header places for Fedora13.

Fri Jan 28 21:49:30 2011  Tanaka Akira  <akr@fsij.org>

	* ext/zlib/zlib.c: parenthesize macro arguments.

Fri Jan 28 17:47:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM2#test_writer_open_notexist):
	  gdbm 1.8.x changed GDBM::WRITER behavior. Thus our testcase need
	  to be changed too.

Fri Jan 28 17:33:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/gdbm/test_gdbm.rb (TestGDBM#test_s_open_no_create): skip
	  the test if gdbm version is 1.8.x.

Fri Jan 28 16:30:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_too_long_filename):
	  Added -w option because too long path error don't output a message
	  by default since r30660. [Bug #4336] [ruby-dev:43134]

Fri Jan 28 16:19:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_path_home_{1,2}):
	  Added -w option because too long path error don't output a message
	  by default since r30660. [Bug #4336] [ruby-dev:43134]

Fri Jan 28 16:04:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_require.rb (TestRequire#test_require_path_home_{1,2,3}):
	  split from test_require_path_home.

Fri Jan 28 13:04:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in (--with-valgrind): Fixed r29683. Now this option
	  is really default on.

Fri Jan 28 12:05:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add #include<sys/stat.h> when struct stat is
	  tested. Otherwise, incomplete type dereference error will occur.

Fri Jan 28 11:53:19 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: redundant variable names made strange conftest
	  error. Fixed it.

Fri Jan 28 11:47:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path{,2}):
	  should handle Errno::E2BIG, because this test checks crash of ruby,
	  not the error type system.

Fri Jan 28 11:23:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_open): Use NUM2MODET() instead NUM2UINT().
	* io.c (rb_scan_open_args): ditto.

Fri Jan 28 10:58:20 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Added mode_t type checking.
	* process.c (rb_exec_arg_addopt): Use NUM2MODET() instead
	  NUM2LONG because clang makes compile error by this narrowing
	  conversion.
	* process.c (rb_run_exec_options_err): ditto.

Fri Jan 28 02:37:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* re.c (rb_reg_raise): add GC guard to prevent intermediate
	  variable from GC.

Fri Jan 28 02:35:41 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* hash.c (rb_hash_fetch_m): add GC guard to prevent intermediate
	  variable from GC.

Fri Jan 28 01:33:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path)
	  TestProcess#test_too_long_path): Reduced string size from 100MB
	  to 10MB. 100MB may cause no memory error. It isn't intended.

Fri Jan 28 01:27:42 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_process.rb (TestProcess#test_too_long_path2):
	  Factored out from test_too_long_path. A test should only do
	  one test.

Thu Jan 27 23:29:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_foreach): check if unpacked.

Thu Jan 27 23:14:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-map): remove deprecated binding.
	  use M-; instead.

Thu Jan 27 21:58:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* bignum.c (rb_str_to_inum): get rid of too huge alloca().

Thu Jan 27 21:43:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): rewrite again. use ALLOCV instead
	  rb_str_tmp_new().

Thu Jan 27 21:41:47 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c: get rid of STRNDUPA(). It's dangerous API.

Thu Jan 27 21:31:57 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_aspawn): get rid of too huge alloca().
	  [Bug #4330] [ruby-core:34898]

Thu Jan 27 20:30:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (rb_w32_spawn): get rid of too huge alloca().

Thu Jan 27 18:49:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (open_dir_handle): get rid of too huge alloca().

Thu Jan 27 18:34:58 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* file.c (w32_io_info): get rid of too huge alloca().
	  [Bug #4313] [ruby-core:34830]

Thu Jan 27 18:19:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/win32.c (wstati64): get rid of too huge alloca().
	  [Bug #4316] [ruby-core:34834]

Thu Jan 27 15:11:52 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): get rid of too huge
	  alloca(). this is the real fix of [ruby-core:34833].

Thu Jan 27 12:46:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (ALLOC_ARGV_WITH_STR): fix void pointer arithmetic.

Thu Jan 27 08:41:40 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_exec_v, rb_proc_exec_n, rb_proc_exec)
	  (proc_spawn_n, proc_spawn): get rid of too huge alloca().
	  [ruby-core:34827], [ruby-core:34833]

Thu Jan 27 08:32:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ALLOCV): new API for exception-safe
	  temporary buffer.  [ruby-core:34844]

	* string.c (rb_alloc_tmp_buffer, rb_free_tmp_buffer):
	  implementation of the API.

Thu Jan 27 08:22:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln_find.c (dln_find_1): use rb_warning and return immediately
	  if fname is longer than buffer.

Wed Jan 26 22:57:30 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* class.c (clone_method): add GC guard to prevent intermediate
	  variable from GC. [Bug #4321] [ruby-dev:43107]

Wed Jan 26 22:45:16 2011  Tanaka Akira  <akr@fsij.org>

	* template/id.h.tmpl: parenthesize macro arguments.

Wed Jan 26 22:28:49 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_eval.c (rb_throw_obj): add GC guard to prevent intermediate
	  variable from GC. [Bug #4322] [ruby-dev:43108]

Wed Jan 26 17:08:59 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode0): OpenSSL::ASN1.decode
	  should reject indefinite length primitive encodings as that is
	  illegal. Patch by Martin Bosslet. See #4324.

Wed Jan 26 10:36:28 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (=~): documentation fix; the return value is nil when
	  it doesn't match. patched by Andrei Kulakov [ruby-core:34562]

Tue Jan 25 08:41:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln_find.c (dln_find_1): omit too long pathnames.

Tue Jan 25 08:28:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_resize): get rid of out-of-bound access.

Tue Jan 25 07:48:22 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_thread.rb: remove unused variables.

Tue Jan 25 07:45:44 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_thread.rb (TestThread#test_condvar_nolock_2): get
	  rid of method redefined.

Tue Jan 25 07:00:52 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_string_value_cstr): rb_str_modify can change
	  RSTRING_PTR.

Tue Jan 25 03:24:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_thread.rb: Added various ConditionVariable tests.

Mon Jan 24 22:26:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): Fix again. use rb_str_tmp_new()
	  instead ALLOC_N.

Mon Jan 24 21:50:48 2011  Tanaka Akira  <akr@fsij.org>

	* vm_insnhelper.h: parenthesize macro arguments.

Mon Jan 24 21:28:34 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* object.c (rb_str_to_dbl): use ALLOC_N instead ALLOCA_N because
	  ALLOC_N may cause stack overflow.

Mon Jan 24 21:04:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_invalid_str): prevent intermediate variable from GC.
	  [ruby-core:34820]

Sun Jan 23 23:01:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/io/console/test_io_console.rb: Don't run test if the system
	  don't support io/console.

Sun Jan 23 22:17:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/fiddle/test_fiddle.rb: Don't run test if the system don't support
	  fiddle.

	* test/fiddle/test_function.rb: ditto.
	* test/fiddle/test_closure.rb: ditto.

Sun Jan 23 11:39:18 2011  Tanaka Akira  <akr@fsij.org>

	* vm_exec.h: parenthesize macro arguments.

Sun Jan 23 10:33:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/fake.rb.in (ruby): suppress warnings.

Sun Jan 23 08:00:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_nth_len, str_utf8_nth): return the rest length together.

	* string.c (rb_str_substr): get rid of measure the length always
	  to improve performance for huge string.  [ruby-core:34648]

Sun Jan 23 00:40:10 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/test_syslog.rb: Fix to make a lot of test failure if
	  the platform doesn't support syslog.

Sat Jan 22 11:49:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: fixing merge key support
	  when multiple merge keys are specified.

	* test/psych/test_merge_keys.rb: tests for multi-merge key support

Sat Jan 22 11:33:04 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: merge keys are actually
	  part of YAML 1.1, so they should be supported.  Remove warning and
	  merge keys to parent.  [ruby-core:34679]

	* test/psych/test_merge_keys.rb: test for merge keys

Sat Jan 22 10:25:19 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): add the file name to the exception when
	  parse errors occur.

	* test/psych/test_parser.rb: test for parse error file name

Sat Jan 22 10:12:30 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): fix assertion error when reusing a
	  parser after an exception has been raised

	* test/psych/test_parser.rb: test for assertion error

Sat Jan 22 04:09:22 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/nodes/node.rb: Make Psych::Nodes::Node
	  enumerable.

	* ext/psych/lib/psych/visitors/depth_first.rb: Add a depth-first
	  visitor to enumerate over a YAML AST in a depth-first fashion

	* test/psych/nodes/test_enumerable.rb: test for enumerating nodes

	* test/psych/visitors/test_depth_first.rb: test for depth-first
	  visitor

Sat Jan 22 00:53:42 2011  Tanaka Akira  <akr@fsij.org>

	* vm_core.h: parenthesize macro arguments.

Fri Jan 21 18:15:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: should not use -Werror=* flags while conftests.

Fri Jan 21 09:17:00 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: Fix incorrectly detected x86_64-w64-mingw32 due
	  canonalization of target_os. Bug #3889 [ruby-core:32634]

Thu Jan 20 23:44:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Fix rb_cv_va_args_macro was broken. We are using
	  -Werror=implicit-function-declaration compile option. therefore
	  we need a function declaration explicitly.

Thu Jan 20 23:58:02 2011  Tanaka Akira  <akr@fsij.org>

	* node.h: parenthesize macro arguments.

Thu Jan 20 23:25:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add '#include <stdlib.h>' to
	  rb_cv_localtime_overflow test too. It's reported by Tomoyuki
	  Chikanaga. Thanks.

Thu Jan 20 16:11:00 2011  Kenta Murata <mrkn@mrkn.jp>

	* README.EXT, README.EXT.ja: You shouldn't choose ``conftest.c'' as a
	  name of a source file.

Thu Jan 20 12:15:44 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Add stdlib.h inclusion into rb_cv_negative_time_t
	  test because it's required for exit(3). The patch is
	  created by Tomoyuki Chikanaga. [Bug #4287] [ruby-dev:43060]

Thu Jan 20 11:39:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/utils.rb (TestWEBrick::RubyBin): test CGI does not need
	  to load rubygems.  if it activated, ruby raises LoadError about
	  rbconfig.rb.

Thu Jan 20 09:19:42 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/json_tree.rb: Fix JSON emit for
	  DateTime and Time classes.

	* test/psych/test_json_tree.rb: test for JSON emit

Thu Jan 20 08:02:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/coder.rb (represent_object): arbitrary objects
	  may be passed to the Psych::Coder object.

	* ext/psych/lib/psych/visitors/yaml_tree.rb: support for visiting
	  arbitrary objects set on the coder.

	* test/psych/test_coder.rb: supporting test case.

Thu Jan 20 06:03:17 2011  Tanaka Akira  <akr@fsij.org>

	* method.h: parenthesize macro arguments.

Wed Jan 19 13:16:05 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/commands/sources_command.rb: Finish removing code,
	  (fixes sources command test).

Wed Jan 19 13:04:16 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* proc.c (proc_call): Add gc guard to avoid segfault. The fix
	  is created by Tomoyuki Chikanaga. [Bug #4238][ruby-dev:42963]

Wed Jan 19 12:31:28 2011  Eric Hodel <drbrain@segment7.net>

	* lib/rubygems.rb: Since gem_prelude requires rubygems, enable
	  custom_require always.

Wed Jan 19 12:08:08 2011  Eric Hodel <drbrain@segment7.net>

	* lib/rubygems/commands/dependency_command.rb: Remove require of
	  deleted file.
	* lib/rubygems/commands/fetch_command.rb: ditto
	* lib/rubygems/commands/setup_command.rb: ditto
	* lib/rubygems/commands/sources_command.rb: ditto
	* lib/rubygems/commands/specification_command.rb: ditto

Wed Jan 19 08:13:59 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/rubygems*: Import rubygems 1.5.0 (release candidate)
	* test/rubygems: Ditto

Tue Jan 18 23:31:01 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y: avoid NULL reference.  [ruby-dev:43067]

Wed Jan 19 02:54:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (cvt): set first byte of buf to NUL for the case when
	  no bytes are written to the buf. [ruby-dev:43062]

Tue Jan 18 23:04:51 2011  Tanaka Akira  <akr@fsij.org>

	* gc.h: parenthesize macro arguments.

Tue Jan 18 18:31:14 2011  Keiju Ishitsuka  <keiju@ishitsuka.com>

	* lib/irb/completion.rb: Irb tab completion support for XX::method
	  forms.

Tue Jan 18 15:05:55 2011  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/logger.rb: added RDoc document for logging message escape
	  by Hal Brodigan. See #3869

Tue Jan 18 07:53:52 2011  Tanaka Akira  <akr@fsij.org>

	* eval_intern.h: parenthesize macro arguments.

Tue Jan 18 04:42:44 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/parser.rb (Mark): Adding a class to wrap
	  marker information

	* ext/psych/parser.c (mark): Add a method to return the mark object
	  for the parser

	* test/psych/test_parser.rb: tests for the Mark class.

Tue Jan 18 02:46:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/json_tree.rb (visit_String): JSON
	  strings should be dumped with double quotes. [ruby-core:34186]

	* test/psych/test_json_tree.rb: test for double quotes

Mon Jan 17 23:36:33 2011  Tanaka Akira  <akr@fsij.org>

	* array.c (rb_ary_times): less MEMCPY calls.

Mon Jan 17 22:54:33 2011  Tanaka Akira  <akr@fsij.org>

	* debug.h: parenthesize macro arguments.

Mon Jan 17 21:40:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): revert r30549.

Sun Jan 16 20:55:45 2011  Tanaka Akira  <akr@fsij.org>

	* vsnprintf.c: parenthesize macro arguments.

Sat Jan 15 11:57:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags): add -Werror=implicit-function-declaration
	  if available.

	* lib/mkmf.rb (init_mkmf): ignore warnings in mkmf tests.

	* test/mkmf/base.rb (setup, teardown): restore config values.

	* test/mkmf/test_flags.rb: split from test_find_executable.rb.

Sat Jan 15 10:04:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (process_options): autoload rubygems.

	* tool/compile_prelude.rb (Prelude#initialize): ignore empty
	  preludes.

	* ruby.c (ruby_init_prelude): get rid of global namespace
	  pollution.

Sat Jan 15 09:42:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h: missing prototypes.

Fri Jan 14 23:25:55 2011  Tanaka Akira  <akr@fsij.org>

	* vm_method.c: parenthesize macro arguments.

Fri Jan 14 15:32:29 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* test/net/imap/test_imap.rb: call neither logout nor disconnect
	  unless connected.  patch by Kazuhiro NISHIYAMA.  [ruby-dev:42860]

Fri Jan 14 14:56:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/imap.rb: use bytesize for binary strings.
	  patched by Yoshimasa Niwa. [ruby-core:34222]

Fri Jan 14 14:01:12 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_unpack): the resulted string of unpack('M') must have
	  ASCII-8BIT encoding (and ENC_CODERANGE_VALID). [ruby-core:34482]

Fri Jan 14 13:38:58 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_check_footer): ISIZE (Input SIZE) in
	  gzip's header is the size of uncompressed input data modulo 2^32.
	  [ruby-core:34481] http://www.ietf.org/rfc/rfc1952.txt

Fri Jan 14 11:36:25 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* configure.in, win32/Makefile.sub (RUNRUBY): require path should
	  include "." because rbconfig.rb is there.

Fri Jan 14 10:40:11 2011  Ryan Davis  <ryan@lust.local>

	* gem_prelude.rb: Just require rubygems. Fixes rubygems 1.4.
	* lib/rubygems.rb: removed all Gem::Quickloader code.
	* ruby.c: renamed ruby_init_gems to ruby_init_prelude. Set
	  $disable_rubygems since there is no fine grained mechanism to
	  skip parts of the prelude. Open to suggestions on how to do this
	  better.
	* test/*.rb: Load path isn't set up correctly, so add
	  --disable-gems as needed to failing tests that are explicitly
	  testing stderr w/ ==.

Fri Jan 14 07:30:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_next_argv): go advance when the next file cannot be
	  read.  [ruby-core:34446]

Thu Jan 13 20:49:19 2011  Tanaka Akira  <akr@fsij.org>

	* vm_insnhelper.c: parenthesize macro arguments.

Thu Jan 13 13:21:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* vm_dump.c: delete dashes to make lines 80 chars, Patched by
	  Shota Fukumori (sora_h).  [Bug #4275] [ruby-dev:43021]

Thu Jan 13 13:21:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* vm_dump.c: fix misspelling of CrashReporter, Patched by Shota
	  Fukumori (sora_h).  [Bug #4275] [ruby-dev:43021]

Thu Jan 13 06:27:29 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* error.c: Exception#to_s should actually call to_s.

Thu Jan 13 00:32:54 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (get_nth_dirname): decrement the directory index
	  because the index specifies the index of given included_directories
	  which is separated by NUL and its index is begun from 1.
	  Note that 0 specifies the current directory of the compilation.
	  see also http://www.dwarfstd.org/doc/dwarf-2.0.0.pdf

Thu Jan 13 00:06:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Add warning messages. [ruby-core:34062]

Thu Jan 13 00:00:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Some syscall return unsigned or pointer value.
	  Therefore we should only check the result is -1 or not.
	  [ruby-core:34062]

Wed Jan 12 23:55:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_f_syscall): Add 64bit Linux support. Some syscall takes
	  long type arguments.

Wed Jan 12 19:37:10 2011  Tanaka Akira  <akr@fsij.org>

	* vm_dump.c: parenthesize macro arguments.

Wed Jan 12 19:28:23 2011  Tanaka Akira  <akr@fsij.org>

	* vm.c (thread_free): reset ruby_current_thread if it points the
	  thread to free.
	* gc.c (slot_sweep): don't call RUBY_VM_SET_FINALIZER_INTERRUPT if
	  there is no current thread.
	  [ruby-dev:43000]

Wed Jan 12 19:09:29 2011  Tanaka Akira  <akr@fsij.org>

	* enum.c (sort_by_i): reenter check more strictly.
	  (sort_by_cmp): ditto.
	  [ruby-dev:43003] reported by Usaku NAKAMURA.

Wed Jan 12 16:25:12 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/net/http.rb (Net::HTTP#connect): makes it timeout during
	  SSL handshake too. [ruby-core:34203]
	  Patch by Marc Slemko.

	* test/net/http/test_http.rb (TestNetHTTP_v1_2#test_timeout_during_HTTP_session):
	  test for [ruby-core:34203]

	* test/net/http/test_https.rb (TestNetHTTPS#test_timeout_during_SSL_handshake):
	  ditto.

Wed Jan 12 16:24:53 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* ext/readline/extconf.rb: new checks for RL_PROMPT_START_IGNORE
	  and RL_PROMPT_END_IGNORE. [ruby-core:34331]

	* ext/readline/readline.c: enables USE_INSERT_IGNORE_ESCAPE only if
	  RL_PROMPT_{START,END}_IGNORE are available to get rid of compilation
	  error with libedit.

Wed Jan 12 15:53:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* README.EXT.ja (rb_ensure): typo.

Wed Jan 12 11:33:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: OpenBSD uses the elf_abi.h header file instead of the
	  elf.h header file. patched by Jeremy Evans [ruby-core:34384]

Wed Jan 12 03:59:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/webrick/test_cgi.rb: Removes usage of deprecated
	  :RequestHandler option.
	  patched by Peter Weldon [ruby-core:34010]

	* test/webrick/test_httpproxy.rb: ditto.

	* test/webrick/test_httpserver.rb: Add a test of the deprecation
	  behaviour.

Wed Jan 12 08:37:07 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (hash_i): return different values for inverse hash.
	  [ruby-core:34334]

Tue Jan 11 20:32:59 2011  Tanaka Akira  <akr@fsij.org>

	* variable.c: parenthesize macro arguments.

Tue Jan 11 13:06:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* array.c (rb_ary_resize): should care of embeded array when extending
	  the array.

	* array.c (rb_ary_resize): need to set capa when changing the real
	  size of the array.
	  these are latent bugs.

Mon Jan 10 22:46:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/defines.h (CASEFOLD_FILESYSTEM): HFS+ is case
	  insensitive.

	* load.c (loaded_feature_path, rb_feature_p, load_lock): on a
	  case-insensitive filesystem, loaded features search should
	  ignore case.  [ruby-core:34297]

Mon Jan 10 21:34:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags): show LD commands.

Mon Jan 10 14:32:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_method.rb (TestMethod#test_define_method): method
	  transplanting between class and module is impossible.

Mon Jan 10 13:51:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/rdoc-mode.el (rdoc-mode): show trailing whitespace.

Mon Jan 10 11:22:02 2011  Tanaka Akira  <akr@fsij.org>

	* util.c: parenthesize macro arguments.

Mon Jan 10 07:41:31 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/README: mention rdoc-mode.el and ruby-style.el.

Sun Jan  9 20:37:21 2011  Tanaka Akira  <akr@fsij.org>

	* transcode.c: parenthesize macro arguments.

Sun Jan  9 16:31:53 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* io.c (Kernel.#syscall): implemented on LP64/LLP64 environments too.
	  also uses __syscall if available for *BSD on 64bit architecture.
	  [ruby-core:34062]

Sun Jan  9 16:31:34 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale::LOCALE_NAME_RE):
	  some platform has a locale without territory but with
	  encoding.
	  (#each_sub_locale): ditto.

Sun Jan  9 14:47:50 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c: apply a patch from Nobuyoshi Nakada.
	  fixed #3616 [ruby-core:31484] IRB + readline incorrectly counts
	  non-printing characters in prompt

Sat Jan  8 21:47:26 2011  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_sort_by): use rb_ary_resize.
	  (ary_cutoff): removed.

Sat Jan  8 21:24:17 2011  Tanaka Akira  <akr@fsij.org>

	* pack.c (swapf): compilation condition simplified.
	  (swapd): ditto.

Sat Jan  8 20:51:25 2011  Tanaka Akira  <akr@fsij.org>

	* pack.c (swapd): remove duplicated code.

Sat Jan  8 19:28:55 2011  Tanaka Akira  <akr@fsij.org>

	* thread.c: parenthesize macro arguments.

Fri Jan  7 23:07:40 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (configuration): backref needs to capture.

Fri Jan  7 21:57:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-mode-variables), misc/ruby-style.el:
	  show trailing whitespace.

	* misc/ruby-mode.el (ruby-font-lock-syntactic-keywords): highlight
	  regexp after open bracket.  [ruby-core:34183]

Fri Jan  7 00:37:35 2011  Tanaka Akira  <akr@fsij.org>

	* string.c: parenthesize macro arguments.

Thu Jan  6 22:42:02 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* bignum.c (bigmul1_karatsuba): avoid overflow that make assertion
	  fail in certain case.  this patch is contributed from Ray Chason
	  <chasonr at gmail.com> in personal communication.

Thu Jan  6 20:55:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): ignore rest from first dot from
	  TARGET to generate init function name.
	  this is followup of r30464.

Thu Jan  6 11:27:01 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/json/tree_builder.rb (start_mapping): tags
	  should not be included in JSON mapping

Thu Jan  6 09:23:33 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/protocol.rb (eof?): BufferedIO should proxy eof? to the
	  underlying IO object.

Thu Jan  6 09:12:31 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/mkmf.rb (configuration): fixing gsub when multiple error flags
	  are passed to GCC.

Thu Jan  6 05:25:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_modify): export.

Thu Jan  6 05:14:41 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (get_strio, strio_set_string)
	  (strio_reopen): check if frozen.  [ruby-core:33648]

Thu Jan  6 05:10:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_resize): new utility function.  [ruby-dev:42912]

Thu Jan  6 05:03:26 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (init_funcname_len): ignore rest from first dot.
	  [ruby-dev:41774]

Thu Jan  6 02:55:48 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: use YAML 1.0 output
	  format for serializing nil values.  Thanks Eric Hodel!

	* test/psych/test_nil.rb: test for nil values

Wed Jan  5 14:21:34 2011  Mark Dodwell  <hi@mkdynamic.co.uk>

	* string.c: fix rdoc typo.
	  https://github.com/shyouhei/ruby/pull/3

Wed Jan  5 14:06:01 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rdoc/test_rdoc_options.rb (TestRDocOptions#test_check_files):
	  skip on Windows because chmod 0 doesn't mean unreadable by owner.

Wed Jan  5 13:56:54 2011  Akinori MUSHA  <knu@iDaemons.org>

	* lib/net/http.rb (Net::HTTP#get): A header hash given should not
	  be modified.

Wed Jan  5 12:10:08 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/dl/{cfunc.c,dl.h,handle.c}, ext/fiddle/fiddle.{h,c}: Use _WIN32
	  rather than checking for windows.h.  Thanks Jon Forums!
	  [ruby-core:33977]

Sat Jan  1 17:02:50 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/irb/locale.rb (IRB::Locale#search_file): make it possible
	  to load a localization from a gem.
	  (IRB::Locale#lc_path): obsoleted because of the change of #search_file
	  (IRB::Locale#each_localized_path): new private method, based on
	  lc_path
	  (IRB::Locale#find): follows the change of #search_file.
	  (IRB::Locale#load): removed duplicate with #find.

Sat Jan  1 11:44:42 2011  Tanaka Akira  <akr@fsij.org>

	* strftime.c: parenthesize macro arguments.

Sat Jan  1 11:10:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c: take care of platforms where long is bigger
	  than int.

Sat Jan  1 11:03:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* NEWS (optparse): shell completion support.

	* misc/README (rb_optparse.{bash,zsh}): for shell completion.

	* include/ruby/intern.h (VALUE rb_ary_print_on): I have never seen
	  this function anywhere.

Sat Jan  1 04:20:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* win32/win32.c (rb_w32_write_console): don't raise exception when
	  the conversion is for writing to console.
	  Patched by Heesob Park [ruby-core:33999]

Fri Dec 31 12:02:06 2010  Tanaka Akira  <akr@fsij.org>

	* enum.c (enum_sort_by): use less temporary objects.

Fri Dec 31 11:46:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (warnflags), lib/mkmf.rb (configuration): turn
	  warnings into errors only for bundled extensions.
	  [ruby-core:33815]

Fri Dec 31 11:15:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (sizeof): zlib.h mistakenly assumes the result
	  of sizeof to be int, not size_t.

Fri Dec 31 10:27:34 2010  Tanaka Akira  <akr@fsij.org>

	* st.c: parenthesize macro arguments.

Fri Dec 31 03:23:26 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD__uqtoa): Fix overflow when long != quad_t.
	  patched by Peter Weldon <peter.weldon AT null.net>
	  [ruby-core:33985]

Fri Dec 31 03:00:34 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* Makefile.in: remove unnecessary semicolons.

Thu Dec 30 23:09:47 2010  wanabe  <s.wanabe@gmail.com>

	* vm.c (vm_define_method): guard iseq from GC while method definition.
	  [ruby-dev:42832]

Thu Dec 30 20:18:32 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: ditto.

Thu Dec 30 20:57:09 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* Makefile.in: Check V=1 argument if run "make clean" or similar.

Thu Dec 30 20:41:50 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* Makefile.in: Kill ugly line continuation.

Thu Dec 30 11:49:40 2010  Tanaka Akira  <akr@fsij.org>

	* sprintf.c: parenthesize macro arguments.

Wed Dec 29 21:20:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (maygvl_copy_stream_wait_readwrite): define if USE_SENDFILE

Wed Dec 29 20:37:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb: strip current directory prefix.

	* enc/depend (clean): remove name2ctype.h when out-of-place build.

	* win32/Makefile.sub (clean-enc): pass V to inferior make.

Wed Dec 29 18:23:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_expr_str): need to escape if the coderange is invalid.

Wed Dec 29 10:06:51 2010  Tanaka Akira  <akr@fsij.org>

	* signal.c: parenthesize macro arguments.

Wed Dec 29 07:22:15 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rake/rdoctask.rb: Deprecate in favor of rdoc/task.

Wed Dec 29 07:07:06 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 3.1

Tue Dec 28 18:36:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* error.c, include/ruby/intern.h (rb_compile_error_with_enc): new
	  function to raise syntax error, with source encoding'ed message.

	* parse.y (compile_error): use above function.
	  [ruby-core:33951] (#4217)

Tue Dec 28 07:37:38 2010  Tanaka Akira  <akr@fsij.org>

	* ruby.c: parenthesize macro arguments.

Tue Dec 28 07:17:11 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add ARGF.write and so on.

Tue Dec 28 07:12:38 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add new magic-comment. (warn-indent) [ruby-core:25442]

Tue Dec 28 04:32:37 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/extconf.rb: check for windows.h while building fiddle.
	  Thanks Jon Forums! [ruby-core:33923]

Tue Dec 28 01:45:12 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: Add Zlib.deflate and Zlib.inflate.
	  [ruby-dev:42833]

Mon Dec 27 21:22:33 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/configure.bat: Remove obsoleted coding rule. Now, we
	  don't support to build on Windows 95/98 and Me.

Mon Dec 27 18:27:13 2010  Tanaka Akira  <akr@fsij.org>

	* re.c: parenthesize macro arguments.

Mon Dec 27 15:22:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/README.win32: note to need NT based OS to build ruby.

Mon Dec 27 12:14:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (EXTMK_ARGS): specify to pass macro V, because nmake
	  doesn't pass it via MAKEFLAGS.

Mon Dec 27 10:33:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/zlib/zlib.c (Init_zlib): Add Zlib.deflate and Zlib.inflate.
	  [ruby-dev:42833]

Mon Dec 27 07:38:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: add compdef for generator.

Mon Dec 27 07:32:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/optparse.rb (OptionParser#compsys): escape brackets too.
	  [ruby-dev:42754]

Mon Dec 27 01:30:08 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: add IF_NAMESIZE.
	  add a default for INET6_ADDRSTRLEN.

Sun Dec 26 23:49:47 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: suppress a strange error message when RMALL
	  found no such file.
	* win32/rmall.bat: new.

Sun Dec 26 21:23:23 2010    <kosaki.motohiro@gmail.com>

	* win32/Makefile.sub: fix 'nmake clean-enc' breakage since r28322.

Sun Dec 26 22:25:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/depend (ripper.y): fix messages with nmake.
	  [ruby-dev:42896]

Sun Dec 26 22:24:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): get rid of warnings caused by
	  -Wdeclaration-after-statement on cygwin.

Sun Dec 26 20:28:34 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c (before_exec): add small comment.

Sun Dec 26 20:52:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: define INET_ADDRSTRLEN as 16 if not
	  available.  fix compilation error on mswin32-60.  reported by nobu.

Sun Dec 26 19:37:37 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c: define IFNAMSIZ if not available.
	  fix compilation error on mingw32.  reported by nobu.

Sun Dec 26 12:16:29 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths::HOMEDIR): no exception if
	  HOME is not set.  [ruby-core:33867]

Sun Dec 26 11:39:11 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (stmt): missing ripper rule.  i.e., `a::B ||= c 1'.
	  http://twitter.com/#!/wannabe53/status/18797576396472321
	  http://twitter.com/#!/wannabe53/status/18798416150663168

Sun Dec 26 11:15:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/with_different_ofs.rb (DifferentOFS): should not affect
	  original classes.

Sun Dec 26 09:35:07 2010  Tanaka Akira  <akr@fsij.org>

	* rational.c: parenthesize macro arguments.

Sun Dec 26 09:22:19 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (rb_if_indextoname): new function to abstract
	  environments without if_indextoname.
	  (inspect_ipv6_multicast_if): new function to inspect
	  IPV6_MULTICAST_IF.
	  Socket::Option.new(:INET6, :IPV6, :MULTICAST_IF,
	  [2].pack("I!")).inspect is
	  "#<Socket::Option: INET6 IPV6 MULTICAST_IF eth0>".

Sun Dec 26 04:31:15 2010  Luis Lavena  <luislavena@gmail.com>

	* ext/dl/win32/registry.rb: Corrected RegCreateKeyExA signature.
	  Patch by Rafal Michalski [ruby-core:33874] [Ruby 1.9-Bug#4203]

Sun Dec 26 02:31:58 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (advice_arg_check): Change argument check.
	  Now, an unsupported advice makes NotImplementedError.
	  [ruby-dev:42887] [Ruby 1.9-Feature#4204]

Sun Dec 26 03:00:53 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/socket/extconf.rb: Fix build error which was introduced r30372.

Sun Dec 26 01:37:10 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: check the existence of if_indextoname().

	* ext/socket/option.c: yesterday's akr's commits destroyed the build of
	  some unrelated platforms (such as Windows).

Sat Dec 25 23:29:11 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_ipv4_add_drop_membership): new function
	  to inspect struct ip_mreq and struct ip_mreqn for
	  IP_ADD_MEMBERSHIP and IP_DROP_MEMBERSHIP.
	  Socket::Option.new(:INET, :IP, :ADD_MEMBERSHIP,
	  [239,255,99,81, 0,0,0,0].pack("CCCCCCCC")).inspect is now
	  "#<Socket::Option: INET IP ADD_MEMBERSHIP 239.255.99.81 0.0.0.0>".
	  (inspect_ipv4_multicast_if): new function to inspect struct in_addr
	  and struct ip_mreqn for IP_MULTICAST_IF.
	  Socket::Option.new(:INET, :IP, :MULTICAST_IF,
	  [192,168,0,7].pack("CCCC")).inspect is now
	  "#<Socket::Option: INET IP MULTICAST_IF 192.168.0.7>".

	* ext/socket/extconf.rb: check struct ip_mreq and struct ip_mreqn.

Sat Dec 25 22:49:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv: DifferentOFS needs to be include in each classes.

	* test/digest/test_digest_extend.rb (TestDigestExtend#setup):
	  should not depend on the result of previous tests

	* test/with_different_ofs.rb (DifferentOFS::WithDifferentOFS): give
	  name.

	* test/with_different_ofs.rb (DifferentOFS): test suite for test
	  suites affected by $,.

	* test/digest/test_digest_extend.rb (TestDigestExtend): should not
	  assume $, invariant.

	* test/csv/test_data_converters.rb, test/csv/test_table.rb: don't
	  call setup within tests.

Sat Dec 25 20:01:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (pipe_open): Added rb_thread_atfork(). We must reinitialize
	  GVL at new process creation.

Sat Dec 25 18:26:55 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_ipv6_mreq): new function to inspect
	  struct ipv6_mreq for IPV6_JOIN_GROUP and IPV6_LEAVE_GROUP.
	  Socket::Option.new(:INET6, :IPV6, :JOIN_GROUP,
	  [0xff12,0,0,0,0,0,0,1, 2].pack("nnnnnnnnI!")).inspect is now
	  "#<Socket::Option: INET6 IPV6 JOIN_GROUP ff12::1 eth0>".

	* ext/socket/extconf.rb: check struct ipv6_mreq.

Sat Dec 25 18:04:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/csv.rb (CSV.foreach): 'rb' mode is defaulted in open.

	* lib/csv.rb (CSV#init_separators): cannonicalize encoding options
	  as Encoding objects.

Sat Dec 25 18:30:34 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_atfork): Add small comment why we need
	  reset random seed.

Sat Dec 25 17:33:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv/base.rb (TestCSV.with_different_ofs): give name to
	  anonymous classes.

	* lib/csv.rb (CSV#init_separators): use IO#gets with length
	  parameter to get rid of wrong convertion.

	* lib/csv.rb (CSV::foreach, CSV#initialize): directly use encoding

	* lib/csv.rb, test/csv: should not assume $, invariant.

Sat Dec 25 16:08:06 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c: change rb_atomic_t definition from uchar to uint.

Sat Dec 25 15:04:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/csv/test_encodings.rb (TestEncodings#setup): fix evil test
	  suite writing to the source directory.

Sat Dec 25 15:08:08 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/pty/pty.c (chfunc): Added rb_thread_atfork_before_exec().
	  We must reinitialize GVL at new process creation. Otherwise
	  we may meet an insane deadlock. [Bug#4121][ruby-dev:42686]

Sat Dec 25 14:27:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_extract_encoding_option): accept Encoding object as
	  encoding: optional argument.  [ruby-dev:42884]

Sat Dec 25 13:37:55 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.2 r6093.

Sat Dec 25 13:05:59 2010  Tanaka Akira  <akr@fsij.org>

	* random.c: parenthesize macro arguments.

Sat Dec 25 12:48:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_f_require_relative): don't omit return type.

Sat Dec 25 11:06:00 2010  Eric Hodel  <drbrain@segment7.net>

	* load.c (rb_f_require_relative): Add documentation.

Sat Dec 25 11:02:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/zlib/zlib.c (gzreader_gets): support optional length
	  parameter.

	* ext/zlib/zlib.c (gzfile_read, gzfile_readpartial): length should
	  be long.

Sat Dec 25 10:51:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/json/generator/generator.{c,h} (fbuffer_free_only_buffer):
	  unused.

	* ext/openssl/ossl_pkcs5.c (ossl_pkcs5_pbkdf2_hmac): add casts.

Fri Dec 24 08:46:04 2010  Tanaka Akira  <akr@fsij.org>

	* process.c: parenthesize macro arguments.

Thu Dec 23 19:17:14 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/net/imap/cacert.pem: updated because it has been expired.

	* test/net/imap/server.crt: signed again because CA cert was expired.

Thu Dec 23 11:16:52 2010  Tanaka Akira  <akr@fsij.org>

	* parse.y: parenthesize macro arguments.

Thu Dec 23 11:00:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_type): check for type from extensions for ruby
	  1.8.  see [ruby-core:33797].

Thu Dec 23 08:12:59 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/smtp.rb: refactoring Net::SMTP#esmtp= to use an
	  attr_accessor

Thu Dec 23 06:35:41 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/net/smtp.rb: Net::SMTP should close the SSL connection if the
	  connection verification fails.

Thu Dec 23 01:47:58 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: remove #object_id. [ruby-dev:42840]

Wed Dec 22 08:56:39 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add Module#private_constant and Module#public_constant.
	  [ruby-dev:39685][ruby-core:32698]

Wed Dec 22 07:59:23 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add IO#advise. [ruby-core:33110] [Ruby 1.9-Feature#4038]

Tue Dec 21 23:45:31 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (Init_GC): move back object_id to Kernel. [ruby-dev:42840]

Tue Dec 21 12:45:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (target_archs): remove temporary objects.

	* enc/Makefile.in, enc/depend (clean): remove work directories.

Tue Dec 21 07:39:12 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c: parenthesize macro arguments.

Tue Dec 21 06:25:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rexml/test_contrib.rb (ContribTester#test_pos): should not
	  use fixed path name for tests.  [ruby-dev:42827]

	* test/rexml/test_sax.rb (SAX2Tester#test_socket): should not use
	  fixed port for tests.  [ruby-dev:42828]

Tue Dec 21 06:10:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (caller_setup_args): reverted r30241 and r30243
	  except for the test.

Tue Dec 21 01:41:42 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* io.c : add an extra byte to buffer for the specification of read
	  in Windows. see [ruby-core:33460] and r29980. and, we have to
	  discuss how to do this one byte.

Tue Dec 21 01:18:06 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c: Fix build error for win32. This regression was
	  introduced by r30271.

Tue Dec 21 00:59:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_cleanup_func): Moved interrupted_lock
	  destroying code from native_thread_destroy() to
	  thread_cleanup_func() because it's platform independent logic.

	* thread_win32.c (native_thread_destroy): ditto.
	* thread_pthread.c (native_thread_destroy): ditto.

Tue Dec 21 00:46:20 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (thread_cleanup_func): Don't touch native threading
	  resource at fork. Sadly this is purely bandaid. We need to
	  implement proper fix later. [Bug #4169] [ruby-core:33767]

Tue Dec 21 00:22:44 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c (exit_success_p): Check status code more carefully.
	  status code may have garbage in upper bit.

Mon Dec 20 23:12:37 2010  Tanaka Akira  <akr@fsij.org>

	* node.c: parenthesize macro arguments.

Mon Dec 20 20:04:41 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add #__id__ and #object_id. [ruby-dev:42778]

Mon Dec 20 20:03:21 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (native_thread_destroy): Fixed gvl_cond leak.

Mon Dec 20 13:49:05 2010  Eric Hodel  <drbrain@segment7.net>

	* NEWS: Add item for RDoc 3.0.1

	* lib/rdoc: Import RDoc 3.0.1, remove require for perl parser.

Mon Dec 20 12:15:32 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc: Import RDoc 3.0.

Mon Dec 20 01:55:03 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (Init_IO): Added O_DIRECT. This feature was proposed by
	  Run Paint Run Run.
	  [Feature #4015] [ruby-core:33018]

Sun Dec 19 19:15:23 2010  Tanaka Akira  <akr@fsij.org>

	* marshal.c: parenthesize macro arguments.

Sat Dec 18 21:52:37 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vsnprintf.c (BSD_vfprintf): suppress warning: "_WIN32" is not
	  defined.

Sat Dec 18 16:02:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (caller_setup_args): fix of r30241. lambda block
	  should check argument number.

Sat Dec 18 14:42:29 2010  Tanaka Akira  <akr@fsij.org>

	* load.c: parenthesize macro arguments.

Sat Dec 18 10:07:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (setup_args, iseq_compile_each): optimize AMPER LAMBDA
	  combination as block.

Fri Dec 17 22:07:16 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* gc.c (Init_GC): move #__id__ and #object_id to BasicObject.
	  [ruby-dev:42778]

Fri Dec 17 19:35:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf::FakeLog): capture output from mkmf.

	* test/mkmf/test_find_executable.rb (test_find_executable):
	  suppress meaningless differences for chkbuild.

Fri Dec 17 13:26:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak (BASERUBY): quit with an error when BASERUBY was not
	  able to set, just like configure.in does. [ruby-dev:42782]

Fri Dec 17 07:04:09 2010  Tanaka Akira  <akr@fsij.org>

	* iseq.c: parenthesize macro arguments.

Fri Dec 17 04:18:37 2010  Eric Hodel  <drbrain@segment7.net>

	* transcode.c (str_encode): Alter comment for better wording and ri
	  output.

Fri Dec 17 00:05:40 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_advise): New API. IO#advise() allows to tell the
	  ruby runtime how it expects to use a file handle. This feature
	  can be improved a performance some situations.
	  Note: This feature is mainly developed by Run Paint Run Run.
	  Thank you! [ruby-core:33110] [Ruby 1.9-Feature#4038]

	* io.c (do_io_advise): Helper function.
	* io.c (io_advise_sym_to_const): ditto.

Thu Dec 16 23:29:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (bin-comm): use transformed name.
	  [ruby-dev:42777]

Thu Dec 16 21:52:07 2010  Tanaka Akira  <akr@fsij.org>

	* io.c: parenthesize macro arguments.

Thu Dec 16 21:46:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb (RbConfig): honor ARCHFLAGS and RC_ARCHS to
	  override embedded ARCH_FLAG value on universal-darwin.

Thu Dec 16 19:50:12 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{configure.bat,setup.mak,Makefile.sub} (PROGRAM_PREFIX,
	  PROGRAM_SUFFIX): unite the differences of the names of macros of
	  prefix and suffix.
	  reported by HANEDA Norikatsu. [ruby-dev:42775]

Thu Dec 16 08:04:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (RNode): match the type of flags to RBasic, and renamed
	  nd_file as nd_reserved.

	* iseq.c (set_relation), vm_insnhelper.c (vm_cref_push): nd_file
	  is always zero-cleared.

Thu Dec 16 07:22:30 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/unit.rb: Imported minitest 2.0.1 r6079.

Wed Dec 15 20:45:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb (process_args): need to setup @help to print options.

Wed Dec 15 11:19:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/zlib/test_zlib.rb (test_to_io): forgotten to fix with r30201.

Wed Dec 15 11:07:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (simple_sendfile): enable on Mac OS X.

	* io.c (nogvl_copy_stream_sendfile): moved precheck of copy length.

	* io.c (nogvl_copy_stream_sendfile): should wait for both of
	  read/write fds.

Wed Dec 15 07:11:55 2010  Tanaka Akira  <akr@fsij.org>

	* hash.c: parenthesize macro arguments.

Wed Dec 15 04:02:00 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/openssl/ossl_x509ext.c (ossl_x509extfactory_set_config):
	  fix compile error when !HAVE_X509V3_SET_NCONF. Thanks
	  Chikanaga-san. [ruby-dev:42761] [Ruby 1.9-Bug#4158]

Wed Dec 15 03:41:31 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ripper/test_parser_events.rb (TestRipper#test_block_variables):
	  Limit address space 100MB instead 100KB. Quite frankly, This
	  margin is too narrow to contain ruby. [ruby-dev:42763] [Bug#4159]

Tue Dec 14 23:53:52 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): improve linux compatibility on FreeBSD,
	  and now it works. But without cpuset -l 0, it still gets stuck.

Tue Dec 14 20:31:33 2010  Tanaka Akira  <akr@fsij.org>

	* gc.c: parenthesize macro arguments.

Tue Dec 14 18:31:48 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/test/unit.rb: help messages.

Tue Dec 14 18:19:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (help): there is no reason to use the abbreviation for here.

Tue Dec 14 15:03:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (test_reopen, test_reinitialize): should close
	  the temporary files.

Tue Dec 14 14:24:15 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (make_tempfile): change the prefix from 'foo'
	  to 'test_io' because the old one is meaningless and inconvenient.

	* test/ruby/test_io.rb (test_binmode_after_closed): the temporary file
	  maked by make_temfile is already closed.

Tue Dec 14 13:52:19 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (test_flush_in_finalizer[12]): should close
	  temporary file because it's only used for taking pathname and
	  unlinking the file after the end of the test (in GC phase).

Tue Dec 14 13:34:33 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_s_open): should close the IO if some error
	  occurs in initializing.

Tue Dec 14 13:04:16 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPRequest#send_request_body_data):
	  set binmode to tempfile.

Tue Dec 14 12:55:46 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/zlib/test_zlib.rb (*): should close files associated with zlib.

Tue Dec 14 11:30:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_argf.rb (test_inplace_rename_impossible): unlink
	  the renamed temporary file on no_safe_rename platforms.

	* test/ruby/test_argf.rb (test_readlines_limit_0,
	  test_each_line_limit_0): should close argf because the associated
	  Tempfile object cannot unlink the temporary file when it's gc'ed
	  on some platforms (Windows, etc.)

Tue Dec 14 11:27:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/minitest/unit.rb (Minitest::Unit#_run_suite): split test
	  name and its time. Thiw allows to know test's name when you are
	  running tests and meet a test which spends long time at realtime.

Tue Dec 14 11:25:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: Add -Werror=declaration-after-statement to default
	  warning flag. If you are using GCC, this flag is useful to
	  prevent breaking VC build.

Tue Dec 14 10:25:57 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode0): how many gcc-c99isms
	  must a man mend; before he can build with VC? r30178

Mon Dec 13 21:26:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): disable the use of sendfile(2) on
	  FreeBSD. It blocks on TestIO#test_copy_stream_socket.

Mon Dec 13 18:35:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c: define USE_SENDFILE on FreeBSD or DragonFly BSD.
	  Remove Mac OS X because its argument is different from them.

Mon Dec 13 12:00:09 2010  Tanaka Akira  <akr@fsij.org>

	* file.c: parenthesize macro arguments.

Mon Dec 13 11:21:14 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (simple_sendfile): added for BSD version of sendfile(2).

Mon Dec 13 09:50:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTPRequest#set_form): Added to support
	  both application/x-www-form-urlencoded and multipart/form-data.
	  There is a similar API, Net::HTTPRequest#set_form_data, but
	  to keep its compatibility this is newly added. [ruby-dev:42729]

Sun Dec 12 23:45:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): fix for __goto__ and __label__
	  where were totally broken.

Sun Dec 12 22:45:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (ID_H_INCLUDES): now id.h depends on vm_opts.h.

Sun Dec 12 20:42:47 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* template/id.h.tmpl: suppress all warning: "SUPPORT_JOKE" is not
	  defined.  [ruby-dev:42730]

Sun Dec 12 20:35:07 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: update how to install.

	* misc/rb_optparse.zsh: avoid error when setopt noclobber.

	* lib/optparse.rb: fix typo. pointed out at
	  <http://d.hatena.ne.jp/nagachika/20101207>.

Sun Dec 12 13:27:35 2010  Tanaka Akira  <akr@fsij.org>

	* eval_error.c: parenthesize macro arguments.

Sun Dec 12 11:53:24 2010  Tanaka Akira  <akr@fsij.org>

	* error.c: parenthesize macro arguments.

Sun Dec 12 04:01:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): fix: extra back slash is added when
	  the string is dummy encoding and includes \x22 or \x5C.

Sun Dec 12 02:42:24 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_asn1.c: indefinite length BER to DER encoding is
	  properly supported.  Thanks Martin Bosslet! [ruby-core:33082]

Sat Dec 11 17:43:34 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/bigdecimal/bigdecimal.h: suppress "warning: 'VPrint' declared
	  'static' but never defined".

Sat Dec 11 09:24:57 2010  Tanaka Akira  <akr@fsij.org>

	* encoding.c: parenthesize macro arguments.

Sat Dec 11 08:12:48 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl.c, ext/openssl/ossl_pkey_rsa.c: Document RSA, RSA
	  encryption/decryption and PKCS #5 encryption/decryption.

Sat Dec 11 06:23:41 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_x509name.c: include Comparable to provide #==.
	  Document OpenSSL::X509::Name#<=>.  [Ruby 1.9-Feature#4116]

Sat Dec 11 05:48:28 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/lib/multi-tk.rb: infinite loop on method_missing at loading.
	  [ruby-dev:42716] [Ruby 1.9-Bug#4129]

	* ext/tk/lib/multi-tk.rb: when no eventloop is running, ruby freezes at
	  exit.

Sat Dec 11 02:23:15 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/extconf.rb: try pkgconfig first, then fall back to
	  normal have_library, etc.  Thanks Erik Hollensbe. [ruby-core:32406]

Fri Dec 10 22:33:39 2010  Tanaka Akira  <akr@fsij.org>

	* dln_find.c: parenthesize macro arguments.

Fri Dec 10 20:05:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/id.h.tmpl (ruby_method_ids): suppress warnings.
	  [ruby-dev:42730]

Fri Dec 10 18:29:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (ruby_init_loadpath_safe): relatively called non-shared
	  binary cannot be found in PATH, so use given pathname.

Fri Dec 10 18:28:40 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (SCRIPTPROGRAMS): ignore backup files and etc.

	* cygwin/GNUmakefile.in (scriptbin): set executable bit.

	* tool/rbinstall.rb (install_recursive): always skip default ignored
	  files.  if block is given, call it instead of calling install.

	* tool/rbinstall.rb (bin-comm): use install_recursive.

Fri Dec 10 18:12:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf#config_value): extract macro value from
	  config.h.

	* test/mkmf/test_sizeof.rb (TestMkmf::TestSizeof#test_sizeof_builtin),
	  (TestMkmf::TestSizeof#test_sizeof_struct): more tests.

	* lib/mkmf.rb (check_signedness): should use the prelude code.
	  [ruby-dev:42731]

	* lib/mkmf.rb (Logging.log_close): separate from Logging.logfile.

	* test/mkmf/base.rb (TestMkmf::MKMFLOG): show mkmf.log at failures.

	* test/mkmf/base.rb (TestMkmf#teardown): close log file for each tests.

Fri Dec 10 11:36:43 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* compile.c (enum): remove a comma at end of enumerator list.

	* constant.h (rb_const_flag_t): ditto.

	* iseq.h (enum catch_type): ditto.

	* iseq.h (enum defined_type): ditto.

	* vm_core.h (enum iseq_type): ditto.

	* vm_core.h (enum vm_special_object_type): ditto.

Fri Dec 10 10:47:53 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (_HAVE_SANE_QUAD_): Don't forget LP64, r30156.

Fri Dec 10 10:37:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* sprintf.c (_HAVE_SANE_QUAD_): if a certain platform has LONG_LONG in
	  8 byte, it might be sane quad. [ruby-core:33634]

Fri Dec 10 10:07:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: remove version 1.1 features.

Fri Dec 10 02:18:02 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_x509store.c (ossl_x509stctx_cleanup): removing C
	  implementation of `cleanup`.

	* ext/openssl/lib/openssl/x509.rb: adding ruby implementation of
	  `cleanup`.  OpenSSL::X509::StoreContext#cleanup is deprecated since
	  reusing the underlying struct doesn't make sense. [ruby-dev:42546]

Thu Dec  9 20:14:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (lvar_defined_gen, shadowing_lvar_gen, dvar_defined): no
	  warnings for unused method and block arguments.
	  [ruby-dev:42718] [ruby-dev:42724]

Thu Dec  9 19:25:49 2010  Tanaka Akira  <akr@fsij.org>

	* dln.c: parenthesize macro arguments.

Thu Dec  9 18:51:06 2010  Tanaka Akira  <akr@fsij.org>

	* lib/webrick/accesslog.rb (WEBrick::AccessLog#format): support
	  %{remote}p for logging remote (client) port number.
	  [ruby-dev:42670]

Thu Dec  9 11:00:30 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* array.c (rb_ary_dup): should copy contents only.  no instance
	  variable, no class would be copied.  it would affect methods
	  #sort, #reject, #transpose, #uniq, #compact, and #shuffle.
	  [ruby-core:33640]

	* array.c (rb_ary_reverse_m): ditto.

	* array.c (rb_ary_rotate_m): ditto.

Wed Dec  8 21:38:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl/lib/dl/struct.rb: clean a warning: assigned but unused
	  variable. patched by Kouhei Yanagita. [ruby-dev:42722]

	* ext/dl/lib/dl/import.rb: ditto.

Wed Dec  8 21:36:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (shadowing_lvar_gen): fix line number.  [ruby-dev:42718]

Wed Dec  8 20:37:11 2010  Tanaka Akira  <akr@fsij.org>

	* dir.c: parenthesize macro arguments.

Tue Dec  7 22:37:15 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* io.c (io_read): duplicate string if shared. [ruby-dev:42719]

Tue Dec  7 22:31:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser::Officious): separate completion
	  options from --help.  [ruby-dev:42690]

	* lib/optparse.rb (OptionParser::Completion#candidate),
	  (OptionParser::Switch#compsys): remove unused variables.

Tue Dec  7 22:05:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (transcode_loop): call default handler of the given
	  hash, method, proc or [] method as fallback.  [ruby-dev:42692]

Tue Dec  7 21:59:37 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/light/node.rb: remove circular require.

Tue Dec  7 21:56:01 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_light.rb: really suppress a warning.

Tue Dec  7 21:51:57 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_light.rb: suppress a warning.

Tue Dec  7 21:14:03 2010  Tanaka Akira  <akr@fsij.org>

	* debug.c: parenthesize macro arguments.

Tue Dec  7 21:06:38 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/doctype.rb, test/rexml/test_doctype.rb: suppress warnings.
	  [ruby-core:33305]
	  Reported by Aaron Patterson. Thanks!!!

Tue Dec  7 18:56:52 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/lib/kconv.rb (String#kconv): fix typo and update rdoc.
	  patched by Kouhei Yanagita [ruby-dev:42696]

Tue Dec  7 20:32:11 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_doctype.rb: add Accessor to test case name.

Tue Dec  7 20:31:02 2010  Kouhei Sutou  <kou@clear-code.com>

	* test/rexml/test_doctype.rb: Doctype -> DocType.

Tue Dec  7 20:29:23 2010  Kouhei Sutou  <kou@clear-code.com>

	* test/rexml/test_doctype_mixin.rb: rename to ...
	* test/rexml/test_doctype.rb: ... this to remove needless name.

Tue Dec  7 17:03:16 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (xlist): supported the XLIST command, which is an
	  extension by Apple and Google.  patch by Geoff Youngs.
	  [ruby-core:33521]

Tue Dec  7 08:00:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in, win32/Makefile.sub (WERRORFLAG): flag to treat
	  warnings as errors.

	* lib/mkmf.rb (Logging.postpone): yield log file object.

	* lib/mkmf.rb (xsystem): add options, :werror only right now.

	* lib/mkmf.rb (with_werror): check as if warnings are errors.

	* lib/mkmf.rb (convertible_int): make declaration conflict
	  warnings errors not to pass wrong type.  [ruby-dev:42684]

	* lib/mkmf.rb (COMMON_MACROS): get rid of conflicts.

	* win32/Makefile.sub (WARNFLAGS): make declaration conflict
	  warnings errors if possible.

Sun Dec  7 21:16:10 2010  Tanaka Akira  <akr@fsij.org>

	* cont.c: parenthesize macro arguments.

Tue Dec  7 00:27:14 2010  Masaya Tarui  <tarui@ruby-lnag.org>

	* win32/win32.c (rb_w32_read): fixed more for readline,
	  and so on. [ruby-core:33511]

Mon Dec  6 23:18:22 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/base.rb (TestMkmf#setup): run quietly.

	* test/mkmf/test_find_executable.rb (test_find_executable): use
	  configured results.

	* common.mk (test-build): test for build process.

Mon Dec  6 22:47:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): skip separators.

	* sample/optparse/opttest.rb: should not override --help.
	  [ruby-dev:42690]

Mon Dec  6 19:00:48 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* misc/rb_optparse.zsh: fix typos.

Mon Dec  6 18:59:04 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: add new encodings.

Mon Dec  6 18:56:42 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_string.rb (TestString#test_scan): add a test for
	  [ruby-core:33338] #4087.

Mon Dec  6 18:55:36 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/uri/test_common.rb (TestCommon#test_encode_www_form): add
	  tests for r30015.

Mon Dec  6 10:39:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_pattern):
	  refix for restrict the pattern.

Mon Dec  6 09:45:11 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl (OpenSSL): add toplevel documentation
	* ext/openssl/ossl_ssl.c (SSLContext, SSLSocket: add additional
	  documentation
	* ext/openssl: move "let rdoc know about mOSSL" comments so they don't
	  show up in output

Mon Dec  6 09:16:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_pattern):
	  workaround fix pattern of hostname for RFC 3986. [ruby-dev:42672]

Mon Dec  6 09:14:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/mkmf.rb (check_signedness): rename unused variable prelude.

Sun Dec  5 17:56:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (make_metaclass): fix probable typo.  builtin type flag
	  cannot be used with FL_TEST.

Sun Dec  5 12:09:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/init.rb (IRB.parse_opts): fix typo. [ruby-core:33574]

Sun Dec  5 11:27:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ruby.c (load_file_internal): decrement for ungotten line.
	  [ruby-dev:42680]

Sun Dec  5 10:32:11 2010  Tanaka Akira  <akr@fsij.org>

	* complex.c: parenthesize macro arguments.

Sat Dec  4 11:39:17 2010  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_x509ext.c (initialize): add documentation.

Sat Dec  4 11:21:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_hash_update_by): new API for Hash#update.

Sat Dec  4 11:18:10 2010  Tanaka Akira  <akr@fsij.org>

	* class.c: parenthesize macro arguments.

Sat Dec  4 11:07:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_vm_inc_const_missing_count): missing prototype.

Sat Dec  4 08:50:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Init_iconv): no warnings if $VERBOSE is nil.

Sat Dec  4 08:25:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): revert r30064 and r30071,
	  because of [ruby-core:26761]. Bug#4106 rejected.

Sat Dec  4 07:46:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (String#tr_cpp): substitute * with P like as
	  autoconf.

Fri Dec  3 22:36:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): protected methods should be
	  checked against the real class.

Fri Dec  3 20:23:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (convertible_int): define printf format prefix too.

	* lib/mkmf.rb (convertible_int): detect convertible integer type.
	  port RUBY_REPLACE_INT from configure.in.

	* lib/mkmf.rb (check_sizeof): should return integer always.

Fri Dec  3 12:54:48 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (RCFLAGS): VC10 and after only. fixed the problem
	  of r30015. [ruby-core:33530]

Fri Dec  3 12:41:52 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* gc.c (rb_objspace_free): With our "lazy-sweep" GC engine, it is
	  possible for an object to survive until its surrounding object
	  space is about to be freed.  Those objects, if any, remains
	  leaked for the rest of a process life.  This is problematic
	  because for instance a T_DATA object may have its own destructor
	  to terminate something.

	* vm.c (ruby_vm_destruct): ruby_current_vm termination should be
	  somewhere after rb_objspace_free for above reason.

Fri Dec  3 12:17:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_method): protected singleton methods should
	  be visible from same real class methods.  [ruby-core:33506]

Fri Dec  3 07:08:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_getline): round upto next char
	  boundary.  [ruby-dev:42674]

Fri Dec  3 06:52:46 2010  Tanaka Akira  <akr@fsij.org>

	* compile.c: parenthesize macro arguments.

Fri Dec  3 04:08:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): use st_insert2 and change return
	  value to int.

	* encoding.c (enc_alias): follow enc_alias_internal.

Fri Dec  3 01:52:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): use xfree instead of free.

Thu Dec  2 23:52:26 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* NEWS: entry for ruby_vm_at_exit().

	* eval.c (ruby_cleanup): bug fix around at_exit (1) timing was
	  wrong. (2) execution order was opposite.

Thu Dec  2 23:05:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (RCFLAGS): -nologo switch is only available in
	  newer versions of rc.exe. fixed the problem of r30012.

Thu Dec  2 21:28:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/add/rails.rb: removed.

Thu Dec  2 21:22:05 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (enc_alias_internal): free the copied key and
	  return NULL when given key is already registered.

	* encoding.c (enc_alias): call set_encoding_const only when the
	  alias is not registered yet.

Thu Dec  2 19:58:24 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm.c (ruby_vm_at_exit): new API.  This enables extension libs to
	  hook a VM termination.  Right now, because the VM we have is
	  process global, most extensions do not deallocate resources and
	  leave them to Operating System's reaping userland processes.  But
	  in a future we plan to have multiple VMs to run simultaneously in
	  a single process (MVM project).  At that stage we can no longer
	  rely on OSes and have to manage every resources to be reclaimed
	  properly.  So it is.  For a forward-compatibility reason this API
	  is introduced now, encouraging you to be as gentle as you can for
	  your resources; that is, tidy up your room.

	* include/ruby/vm.h: ditto.

	* vm_core.h (rb_vm_struct): new field.

	* vm.c (vm_init2): initialize above new field.

	* eval.c (ruby_cleanup): trigger those hooks.

Thu Dec  2 17:00:44 2010  Tanaka Akira  <akr@fsij.org>

	* bignum.c: parenthesize macro arguments.

Thu Dec  2 15:31:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): more fix. [ruby-core:33513]

Thu Dec  2 13:41:43 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): workaround for console reading troubles.
	  fixed [ruby-core:33511]

Thu Dec  2 13:10:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form):
	  split key-value when the value is Array like object.

Thu Dec  2 10:39:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP#set_form_data):
	  use URI.encode_www_form for application/x-www-form-urlencoded.

Thu Dec  2 10:38:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/extmk.rb: remove $makeflags.defined?, it should be $mflags.

Thu Dec  2 10:19:47 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (rc): suppress meaningless message.

Thu Dec  2 10:09:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/generator/extconf.rb: remove the lines which set -O3
	  when -O option is not set.
	  Note that -O3 doesn't always exist.

	* ext/json/parser/extconf.rb: ditto.

Thu Dec  2 10:01:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/extmk.rb: define $makeflags.defined? like $mflags.

Thu Dec  2 07:20:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GCStressOption): --gc-stress
	  option.

	* lib/test/unit.rb (Test::Unit::Mini#_run_suites): show the result
	  even when interrupted on the way.

Thu Dec  2 07:08:38 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (setattr): should retry on EINTR.
	  [ruby-dev:42666]

Thu Dec  2 02:30:50 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb: fixed positional wording to match revised order.

Thu Dec  2 01:24:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/lib/json/common.rb: don't use iconv on 1.9.
	  patched by Shota Fukumori [ruby-core:33164]

Thu Dec  2 01:02:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Update github/flori/json from 1.4.2+ to
	  e22b2f2bdfe6a9b0. this fixes some bugs.

Thu Dec  2 00:05:44 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  This change the order of chapter because such overview should
	  begin with simple examples.
	  patched by Eric Hodel [ruby-core:33469]

Wed Dec  1 22:01:49 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (Init_Numeric): fixed a potential bug when using bccwin32
	  ruby with Microsoft's dll, though we already gave up of supporting
	  bccwin32. [ruby-core:33503]

Wed Dec  1 21:43:21 2010  Tanaka Akira  <akr@fsij.org>

	* array.c: parenthesize macro arguments.

Wed Dec  1 21:41:57 2010  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_addrinfo.rb: extract Errno::EADDRINUSE as a method.

	* test/socket/test_socket.rb: ditto.

Wed Dec  1 15:08:32 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/openssl/test_ssl.rb (test_not_started_session): non socket
	  argument of SSLSocket.new is not supported on Windows.

Wed Dec  1 14:36:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_memhash): zero-filled strings should return
	  different values.  [ruby-core:33500]

Wed Dec  1 14:27:49 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 2.0.0 r5952.
	* test/minitest/*.rb: ditto.
	* lib/test/unit.rb: Compatibility fix for minitest changes.

Wed Dec  1 10:16:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): fix typo (not 0xFD but 0xFE).

Wed Dec  1 09:28:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: Follow .gnu_debuglink section.
	  A user of distribution provided ruby will see line
	  info if s/he has a debug package for ruby.
	  patched by Shinichiro Hamaji [ruby-dev:42655]

Wed Dec  1 01:29:15 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): inspect as a dummy encoding string
	  when a UTF-16/32 (not BE/LE) string does not have a BOM.
	  Unicode and some RFCs say that a string labeled as UTF-16/32
	  doesn't have a BOM, it should be considered big endian.
	  But many Windows programs generates little endian UTF-16
	  strings without a BOM. So String#inspect treats a string
	  labeled UTF-16/32 without a BOM as a dummy encoding string.
	  patched by Martin Duerst. [ruby-core:33461]

Tue Nov 30 17:04:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (parse_debug_line_cu): ignore DW_LNE_set_discriminator.
	  To ignore, it needs to read a single unsigned LEB128 integer.

Tue Nov 30 16:29:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_dump.c: undef HAVE_BACKTRACE when the OS is FreeBSD (in other
	  words backtrace() is libexecinfo) and it is optimized.
	  This temporary hack may be also applied to other libexecinfo
	  environments.

Tue Nov 30 16:23:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by Eric Hodel ref #4100

Tue Nov 30 12:23:52 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_read): read only 1 byte at once on console.
	  workaround of Windows bug. see [ruby-core:33460].
	  this is not the final solution.

Tue Nov 30 11:39:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by mathew murphy [ruby-core:33472] ref #4100

Tue Nov 30 05:03:44 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/uri/common.rb (encode_www_form, encode_www_form_component):
	  Improve English in documentation.

	* ext/openssl/ossl_ssl.c (ssl_version=, ciphers=): Document
	  #ssl_version=, add documentation for #ciphers=.

Mon Nov 29 22:55:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/uri/common.rb (URI::WFKV_): get rid of backtrack explosion
	  by nested repeat operators.  [ruby-core:33464]

Mon Nov 29 22:53:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (scriptbin.mk): fix generated rules.

	* win32/win32.c (rb_w32_write_console): fix argument type.

Mon Nov 29 21:12:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* misc/ruby-mode.el (ruby-forward-sexp): stop after literal hash
	  key labels.

	* misc/ruby-mode.el (ruby-font-lock-keywords): highlight literal
	  hash key labels as symbols.

Mon Nov 29 18:31:31 2010  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* test/ruby/test_transcode.rb (test_unicode_public_review_issue_121):
	  - Removed commented-out options that are no longer under discussion.
	  - Added two more tests for forthcomming clarifications.

Mon Nov 29 14:31:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_isatty): use GetConsoleMode() to determine the
	  fd is console or not, just like rb_w32_write_console(). [experimental]

Mon Nov 29 14:19:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h (rb_w32_write_console): wrong prototype.

Mon Nov 29 14:10:55 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_write_console): fixed indentation.

Sun Nov 28 22:13:39 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (NATIVE_MUTEX_LOCK_DEBUG): move and use it.

	* ChangeLog: fix my timezone.

Mon Nov 28 21:58:58 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c: remove pthread_atfork().

Mon Nov 28 21:54:22 2010  Koichi Sasada  <ko1@atdot.net>

	* thread_pthread.c (native_cond_*): Check return code.
	  (Some OSes except Linux return error code).

Sun Nov 28 21:46:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (thread_start_func_1): initialize native thread
	  data immediately before starting.

Sun Nov 28 14:56:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (struct argf): make lineno long, and reorder members.

Sun Nov 28 14:55:42 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_win32.c (gvl_release, gvl_init): suppress warnings.

Sun Nov 28 14:48:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (gvl_release, gvl_init): suppress warnings.

	* vm_core.h (rb_vm_gvl_destroy): add prototype.

Sun Nov 28 14:46:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (gvl_reinit): register atfork handler only in
	  the parent process, to get rid of dead lock.

Sun Nov 28 12:23:57 2010  Koichi Sasada  <ko1@atdot.net>

	* thread.c, vm_core.h: make gvl_acquire/release/init/destruct
	  APIs to modularize GVL implementation.

	* thread_pthread.c, thread_pthread.h: Two GVL implementations.
	  (1) Simple locking GVL which is same as existing GVL.
	  (2) Wake-up queued threads.  The wake-up order is simple FIFO.
	     (We can make several queues to support exact priorities, however
	      this causes some issues such as priority inversion and so on.)
	      This impl. prevents spin-loop (*1) caused on SMP environments.
	  *1: Only one Ruby thread acquires GVL again and again.
	      Bug #2359 [ruby-core:26694]

	* thread_win32.c, thread_win32.h: Using simple lock
	  not by CRITICAL_SECTION but by Mutex.
	  Bug #3890 [ruby-dev:42315]

	* vm.c (ruby_vm_destruct): ditto.

Sun Nov 28 04:40:00 2010  Luis Lavena  <luislavena@gmail.com>

	* io.c (io_fwrite): use rb_w32_write_console under Windows.

	* win32/win32.c (rb_w32_write_console): added to write to write
	  Unicode using WriteConsoleW for stdout/stderr. [ruby-core:33166]

Sun Nov 28 03:58:47 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: improve rdoc.
	  patched by Mike Perham [ruby-core:33433]

Sat Nov 27 19:12:10 2010  Tanaka Akira  <akr@fsij.org>

	* time.c: parenthesize macro arguments.

Sat Nov 27 18:08:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* time.c (leap_year_v_p): fixed typo.  [ruby-dev:42631]

Sat Nov 27 17:57:08 2010  Tanaka Akira  <akr@fsij.org>

	* resolv.rb (Resolv::DNS): use the same DNS server when retry using
	  TCP.  reported by Julian Mehnle.  [ruby-core:32970]

Sat Nov 27 15:45:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): see CrashReport log on Mac OS X.

	* configure.in: link addr2line only for ELF.

Sat Nov 27 13:58:55 2010  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): : was missing.  Thanks,
	  Shota Fukumori.  [ruby-dev:42634]

Sat Nov 27 12:07:05 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* man/ruby.1: Ruby man page from Arthur Gunn in [ruby-core:33412]

Sat Nov 27 11:29:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (OptionParser#candidate): get rid of 1.9 syntax
	  so that BASERUBY can be 1.8.

Sat Nov 27 08:16:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* addr2line.c (rb_dump_backtrace_with_lines): should close fd on
	  edge case.

Fri Nov 26 13:33:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: apply a patch from shinichiro.h.

Fri Nov 26 12:21:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c: added to show source filename and line number of
	  functions in backtrace. [ruby-dev:42625]
	  a patch from shinichiro.h <shinichiro.hamaji AT gmail.com>

	* addr2line.h: ditto.

	* common.mk: add addr2line.$(OBJEXT).

	* configure.in: check dl_iterate_phdr.

	* vm_dump.c (rb_vm_bugreport): use rb_dump_backtrace_with_lines in
	  addr2line.c when the binary is ELF.

Fri Nov 26 12:12:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (setup_tree): restart setup_tree() for a node whose
	  AnchorNode's type is ANCHOR_PREC_BEHIND or ANCHOR_PREC_BEHIND_NOT
	  and divide_look_behind_alternatives() divided it to NT_ALT or
	  NT_LIST. [ruby-core:33370]

Fri Nov 26 11:40:11 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): get only required rights of the target
	  thread because THREAD_ALL_ACCESS causes an access error on XP.
	  reported by Masaya TARUI via IRC.

Fri Nov 26 11:09:07 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): show the displacement from the beginning
	  of the symbol.

Fri Nov 26 10:48:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): follow the output of glibc.
	  see [ruby-dev:42627]

Fri Nov 26 09:48:45 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* re.c (rb_reg_initialize_str): should succeed the taint status from
	  the origin. [ruby-core:33338]

Fri Nov 26 09:32:37 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): seems to be necessary the 3rd argument of
	  SymGetLineFromAddr64(), even though MSDN says it can be zero.

Fri Nov 26 09:03:38 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (onig_is_prelude): added to check whether ruby is still
	  in prelude (or other boot processes) or not.

	* regcomp.c (optimize_node_left): use onig_is_prelude for printing.

	* regcomp.c (set_optimize_info_from_tree): ditto.

	* regcomp.c (onig_compile): ditto.

	* regcomp.c (print_compiled_byte_code_list): print its address.

	* regcomp.c (print_indent_tree): print its contents tree of
	    ANCHOR_PREC_READ(_NOT) and ANCHOR_PREC_BEHIND(_NOT).

Thu Nov 25 23:10:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (print_distance_range): use PRIuSIZE.

	* regcomp.c (print_optimize_info): use %ld because the type of
	  calculated value of integers is long.

	* regexec.c (onig_print_compiled_byte_code): add prototype.

	* regexec.c (match_at): add 2nd argument.

Thu Nov 25 10:29:55 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/callback/mkcallback.rb (gencallback): shouldn't assume that
	  VALUE is the same size with long.

Thu Nov 25 10:03:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/win32ole/test_err_in_callback.rb (teardown): remove tmp file
	  only when it exists.

Thu Nov 25 01:38:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/big5-hkscs-tbl.rb: Update table as HKSCS-2008.
	  patched by oCameLo oTnTh [ruby-core:33256]

	* enc/big5.c: add alias Big5-HKSCS:2008 to Big5-HKSCS.

Wed Nov 24 15:18:07 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vsnprintf (BSD_vfprintf): use QUADINT macro only when _HAVE_SANE_QUAD_
	  macro is defined.

Wed Nov 24 12:47:16 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vsnprintf (BSD_vfprintf): added VC++ compatible size specifications
	  (I, I32, I64).

Wed Nov 24 11:19:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_inspect): treat UTF-16 and UTF-32 as BE or LE.

Wed Nov 24 06:35:32 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: add the UTF-32 converter.

Wed Nov 24 05:40:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

Wed Nov 24 06:13:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (filecp, wstr_to_mbstr, mbstr_to_wstr):
	  refactored.

Wed Nov 24 05:40:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: add a converter from UTF-8 to UTF-16.

Wed Nov 24 03:21:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/utf_16_32.trans: raise error on unpaired upper
	  surrogates.

Wed Nov 24 01:40:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/utf_16_32.h: add UTF-16 and UTF-32 as a dummy encoding.

	* enc/trans/utf_16_32.trans: add a converter from UTF-16 to UTF-8.

Tue Nov 23 21:59:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (wlink, rb_w32_getppid): use typedef instead of
	  repeating complicated function prototypes.

Tue Nov 23 18:54:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_mark): should mark self in control
	  frames.  [ruby-core:33289]

Tue Nov 23 07:57:31 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta/parser.{ry,rb}: fixed a bug of token scanner.

Tue Nov 23 07:29:24 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* complex.c, rational.c ({nucomp,nurat}_expt): added a check.

Tue Nov 23 07:27:27 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb (daynum): should be private.

Tue Nov 23 07:22:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ChangeLog (change-log-indent-text): hanging indent.

Tue Nov 23 06:30:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SITE_DIR, VENDOR_DIR),
	  version.c (ruby_initial_load_paths): exclude directories that
	  are configured without them from $LOAD_PATH. [ruby-core:33267]

	* configure.in (rubylibprefix): No ruby, No libprefix.

Tue Nov 23 01:05:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): don't output floating point
	  when the precision is 0. [ruby-dev:42615]

Mon Nov 22 21:30:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): fix for ascii-compatible external
	  encoding and different encoding string.  [ruby-core:33283]

Mon Nov 22 18:45:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_makefile): should not duplicate rules.
	  bug fix of r29842.

Mon Nov 22 18:04:40 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/big5.c: split CP950 from Big5.

	* enc/big5.c: split CP951 from Big5-HKSCS.

	* enc/trans/big5.trans: import conversion table of Big5, Big5-HKSCS,
	  CP950, and CP951 from ICU. they need fallback conversions.
	  ref [ruby-core:33256]
	  http://source.icu-project.org/repos/icu/data/trunk/charset/data/ucm/

	* tool/transcode-tblgen.rb (import_ucm): add to import ucm files.

Mon Nov 22 18:33:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_inspect): append for each chars instead of bulk
	  copy if encoding conversion is needed.  [ruby-core:33283]

Mon Nov 22 14:22:45 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* time.c (time_zone): use rb_locale_str_new_cstr to set encoding
	  as locale and convert its content to internal encoding.
	  [ruby-core:33278]

Mon Nov 22 11:58:11 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): set ENC_CODERANGE_VALID when the
	  receiver is 7BIT and the argument is non ASCII.

Mon Nov 22 01:48:58 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: some improvements for performance.

Sat Nov 20 07:45:50 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/mkmf.rb: adding compilation support for ObjC/ObjC++ extensions.
	  Thanks Scott Gonyea! [ruby-core:33260]

Sat Nov 20 01:57:55 2010  Akio Tajima  <artonx@yahoo.co.jp>

	* common.mk: add dependency(insns.inc) to compile.obj

Fri Nov 19 23:05:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (insns_rules.mk): remove extra backslash.

	* cygwin/GNUmakefile.in, win32/Makefile.sub (clean): rc files are
	  made at compile time, so should be removed by clean.

Fri Nov 19 22:09:46 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb
	  (Tester#test_pretty_format_long_text_finite): skip a test that
	  uses long string on small memory system. [ruby-dev:42599]

Fri Nov 19 21:07:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb: shell completion support for zsh.  based on
	  <http://d.hatena.ne.jp/rubikitch/20071002/zshcomplete>

	* lib/optparse.rb: shell completion support for bash.

Fri Nov 19 00:00:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (SCRIPTPROGRAMS): no needs on cygwin.

	* win32/Makefile.sub (scriptbin): create script binaries.

Thu Nov 18 23:21:23 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/formatters/pretty.rb (REXML::Formatters::Pretty#wrap):
	  REXML::Formatters::Pretty#wrap used a recursive method call to
	  format text.  This switches it to use an iterative approach.
	  [ruby-core:33245]
	  Patch by Jeremy Evans. Thanks!!!

	* test/rexml/test_core.rb: add a test for it.

Thu Nov 18 22:58:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/io.h (rb_io_buffer_t): extract from rb_io_t.

Thu Nov 18 07:37:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (reconfig): force reconfigure with previous options.

	* common.mk (showconfig): show configure flags, like as
	  `config.status --config' generated by recent autoconf.

Thu Nov 18 07:16:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* missing/langinfo.c (strncasecmp): get rid of redefinition.

Thu Nov 18 00:02:17 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Upgrading output encoding with ASCII content
	  as needed.  [ruby-core:33229]

Wed Nov 17 23:19:21 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/configure.bat: remove quotes from arguments to be quoted.

	* lib/mkmf.rb (create_makefile): use forward slashes in messages.

	* lib/mkmf.rb (create_makefile): make extension libraries messages
	  brief.

	* win32/Makefile.sub (MAKEDIRS): should not include silent flag.

	* common.mk (ext/ripper/ripper.c, ext/json/parser/parser.c): pass
	  Q and ECHO.  [ruby-core:33226]

Wed Nov 17 16:09:52 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_tracer.rb: new test case.
	  minimal regression test for r29280.

Wed Nov 17 16:04:23 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/ruby/envutil.rb (Test::Unit::Assersions#assert_warn):
	  new assertion to assert that a particular warning message is
	  displayed.
	  forward port from branches/ruby_1_9_2@29795.

Wed Nov 17 15:16:48 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regint.h (OnigOpInfoType): constify name.

	* regcomp.c (op2name): constify return value.

	* regcomp.c (onig_print_compiled_byte_code): use PRIuPTR and
	  uintptr_t to clean warnings.

	* regcomp.c (print_indent_tree): use PRIxPTR and intptr_t.

	* regexec.c (match_at): use PRIdPTR and intptr_t.

Wed Nov 17 09:49:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/shift_jis.c (property_name_to_ctype): fix memory leak.

	* enc/euc_jp.c (property_name_to_ctype): ditto.

Wed Nov 17 08:54:04 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Upgrading output encoding as needed.  [ruby-core:33135]

Tue Nov 16 22:30:39 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (vm_throw): remove fear of undefined behavior :-)
	  Coverity Scan found this bug.

Tue Nov 16 09:33:00 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (to_digits): avoid unused
	  variables warning, reported by Aaron Patterson.

Tue Nov 16 06:39:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* pack.c (PACK_ITEM_ADJUST): return nil not result array and yield
	  values if block is given.  [ruby-core:33193]

Tue Nov 16 00:21:20 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* regparse.c (and_cclass, or_cclass): fix memory leak.  Coverity Scan
	  found this bug.  [ruby-dev:42579]

Tue Nov 16 00:07:32 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* gc.c (assign_heap_slot): fix fear of memory leak and memory
	  violation.  Coverity Scan found this bug.

Mon Nov 15 23:54:45 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* eval_intern.h (CHECK_STACK_OVERFLOW): it was not intended to add
	  size_t to a pointer typed VALUE*.  Coverity Scan found this defect.

Mon Nov 15 23:41:21 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* compile.c (iseq_set_exception_local_table, iseq_set_local_table,
	  rb_iseq_build_from_ary): fix type inconsistency (which is benign
	  because sizeof(ID) == sizeof(ID*), though).  Coverity Scan found
	  these bugs.

Mon Nov 15 22:47:27 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_eval.c (rb_funcall): ensure va_end after va_init_list.  Coverity
	  Scan found this bug.

Mon Nov 15 08:36:12 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/racc/parser.rb (do_parse, yyparse): using class eval to define
	  method and avoid __send__.

Mon Nov 15 06:43:48 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* etc/openssl/ossl_ssl.c (ossl_ssl_get_cert): raise exception if
	  pointer is invalid.  Thanks Ippei Obayashi! [ruby-dev:42573]

Sun Nov 14 17:57:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enc/Makefile.in (distclean): should not remove sources which are
	  distributed in tarball.

Sun Nov 14 16:48:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_set_token_info): turn on/off with directives.
	  [ruby-core:25442]

Sun Nov 14 12:05:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_readlines): forward to current_file for arguments
	  check.  http://twitter.com/nagachika/status/3634254856589312

Sun Nov 14 08:48:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/setup.mak (-basic-vars-, -runtime-): suppress trailing
	  space and compiler command line.

Sun Nov 14 04:22:32 2010  Alexander Zavorine  <alexandre.zavorine@nokia.com>

	* symbian/setup (config.h): Added HAVE_LABS and HAVE_LLABS to config.h.

	* symbian/configure.bat: Changed packaging version in line with API
	  style 3 versioning.

Sat Nov 13 16:37:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags, help): emit messages at once.

	* win32/Makefile.sub (MSG, EOM): remove surrounding quotes by %~I.

Sat Nov 13 01:31:30 2010  Akio Tajima <artonx@yahoo.co.jp>

	* win32/Makefile.sub: reorder variable End Of Message (don't display it)

Fri Nov 12 20:52:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (showflags, help): use caret to quote leading spaces on
	  Windows.

	* Makefile.in, common.mk, cygwin/GNUmakefile.in, enc/depend,
	  ext/ripper/depend, lib/mkmf.rb, win32/Makefile.sub: caddle up.

Fri Nov 12 16:35:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: support C level backtrace information on FreeBSD.
	  When devel/libexecinfo is installed on FreeBSD, now ruby
	  can show C level backtrace information.
	  http://www.freebsd.org/cgi/cvsweb.cgi/ports/devel/libexecinfo/

Fri Nov 12 09:58:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak: use findstr.exe instead of find.exe, because all
	  target build platforms should have findstr.exe, and, find.exe often
	  means another command such as cygwin's.

Fri Nov 12 00:30:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (config.h): need PRI_LL_PREFIX.

Thu Nov 11 23:38:32 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: ANSI C-conforming const and volatile are mandatory

	* configure.in (AC_C_CONST, AC_C_INLINE, AC_C_VOLATILE): check
	  before used in other checks.

	* configure.in (RUBY_CHECK_PRINTF_PREFIX): should not break from
	  RUBY_WERROR_FLAG, so that ac_c_werror_flag gets restored.

Thu Nov 11 23:04:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (warn_deprecated): show caller position.

Thu Nov 11 23:03:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_close): untie tied io before closing.

	* io.c (argf_write): add ARGF.write and so on.

	* io.c (argf_read_nonblock): add ARGF.read_nonblock.

Thu Nov 11 21:49:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/stats.rb (RDoc#print): get rid of NaN.

Thu Nov 11 21:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (SHOWFLAGS): show compile flags.

	* common.mk: hide long command lines by default.  verbose-mode is
	  turned on by V=1 as before.
	  http://jarp.does.notwork.org/diary/200605b.html#200605121

Thu Nov 11 21:32:09 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_func): accept variable address.

	* ext/win32ole/extconf.rb: libuuid is needed on cygwin.

Thu Nov 11 21:24:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): use cygwin_conv_path on cygwin 1.7 or
	  later.

	* ruby.c (push_include_cygwin): ditto.

Thu Nov 11 20:49:48 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (PRI_LL_PREFIX): format type specifier for
	  LONG_LONG may vary on platforms.

Thu Nov 11 20:45:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SYMBOL_PREFIX): separate from EXPORT_PREFIX.

	* win32/mkexports.rb (Exports#each_export): use SYMBOL_PREFIX.

Wed Nov 10 07:20:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* cygwin/GNUmakefile.in (scriptbin): make executable file from
	  scripts with stub.

	* ruby.c (load_file_internal): assume xflag for exe file as well
	  as no-shebang file.

	* tool/rbinstall.rb: install script programs.

	* win32/mkexports.rb (Exports#initialize): alias ruby_sysinit for
	  stub.

	* win32/stub.c: stub for scripts.  [EXPERIMENTAL]

Tue Nov  9 21:57:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (init_funcname): allocate and build initialization
	  funciton name at once.

Tue Nov  9 21:14:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (AC_FUNC_GETPGRP, AC_FUNC_SETPGRP): no need when
	  not used.

	* configure.in (EXPORT_PREFIX): check generic prefix.

Tue Nov  9 13:24:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regenc.c (onigenc_minimum_property_name_to_ctype):
	  \p{...} should be case insensitive. [ruby-core:33000]

	* regenc.c (onigenc_property_list_add_property):
	  ditto.

	* enc/euc_jp.c (init_property_list, property_name_to_ctype):
	  to lowercase property names.

	* enc/shift_jis.c (init_property_list, property_name_to_ctype):
	  ditto.

Tue Nov  9 13:29:36 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (overlapped_socket_io): get rid of a warning of 64bit
	  mingw.

Tue Nov  9 10:44:19 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): this code uses FPU's rounding system.
	  But x86's FPU calculates double precision floating-point
	  numbers in 80bit precision, so it fails to round the value.
	  So ensure the value is assigned a variable. [ruby-dev:42551]
	  see also [ruby-math:00802]
	  http://www.shudo.net/java-grandprix99/strictfp/

Tue Nov  9 07:30:15 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_syserr_new): new function to make SystemCallError
	  instance without errno.  [EXPERIMENTAL]

	* error.c (rb_syserr_fail, rb_mod_syserr_fail): ditto.

Tue Nov  9 05:54:57 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/*.rb: Remove unused variable warnings.
	  Patch by Run Paint [ruby-core:30991]

	* lib/rubygems/*, lib/rdoc/*.rb, lib/rake/*.rb: ditto

Mon Nov  8 18:26:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_hdtoa): fix type cast and bufsize.

Mon Nov  8 15:40:56 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): fix precision specifier doesn't
	  work well on %f. [ruby-dev:42552]

Mon Nov  8 14:41:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (get_wsa_extension_function): typos.

Mon Nov  8 13:41:33 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Add Age property to regexp. [ruby-core:33019]
	  patched by Ammar Ali, tested by Run Paint Run Run

Mon Nov  8 12:16:39 2010  Ben Walton  <bwalton@artsci.utoronto.ca>

	* configure.in: support -h for solaris linker when gcc not used

Mon Nov  8 11:47:39 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (finish_overlapped_socket): refactoring.

Mon Nov  8 11:02:21 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (get_proc_address): refactoring.

	* win32/win32.c (get_wsa_exetinsion_function): refactoring.

Mon Nov  8 09:45:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/gbk-tbl.rb: Add euro sign. [ruby-core:33094]
	  CP936, which is de facto definition of GBK, has it.
	  http://msdn.microsoft.com/en-us/goglobal/cc305153.aspx

Mon Nov  8 07:26:20 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check only the first symbol to get rid of
	  duplication.  [ruby-core:33084] #4031

Sun Nov  7 10:13:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (NM): check on all platforms.  #4031

Sun Nov  7 06:16:33 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/openssl/test_ocsp.rb: adding test for r29699.  Thanks Elise
	  Huard! [ruby-core:32460]

Sat Nov  6 07:33:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_export_prefix): check for prefixed
	  underscore of exported symbols

	* tool/rbinstall.rb (bin-comm): prepend prolog shell script if
	  necessary.

	* configure.in (LIBRUBY_RELATIVE): use rpath token expansion.

Sat Nov  6 07:24:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in (arch, sitearch): reordered.

	* configure.in: keep failed file.

Sat Nov  6 07:03:49 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_fork_err): save errinfo before fdopen.

Sat Nov  6 00:43:58 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/openssl/ossl_ocsp.c (ossl_ocspcid_initialize): an optional
	  parameter may be used to specify the OpenSSL::OCSP::CertificateId on
	  initialization.  Thanks Elise Huard! [ruby-core:32460]

Fri Nov  5 12:23:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_{process,system}.rb (test_fallback_to_sh):
	  meaningless and wrong tests where /bin/sh does not exist.

	* process.c (proc_spawn_v): should spawn, not exec.

Fri Nov  5 01:21:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_exec_v, proc_spawn_v): try to execute with sh if
	  no shebang.  [ruby-core:32745] [EXPERIMENTAL]

Fri Nov  5 00:39:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_readlines, rb_io_each_line): limit must not be zero.
	  a patch from Tomoyuki Chikanaga at [ruby-dev:42538].  #4024

Fri Nov  5 00:14:15 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/extconf.rb: fixing ffi library location on windows.
	  Thanks Usa! [ruby-core:32930]

Thu Nov  4 20:04:44 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (rb_newobj): force garbage_collect() if GC.stress == true.

Thu Nov  4 19:48:22 2010  Koichi Sasada  <ko1@atdot.net>

	* ChangeLog: missed to write a last ChangeLog.

	* gc.c (gc_finalize_deferred): removed.

	* gc.c (rb_gc_finalize_deferred): Do not invoke a free_unused_heaps().

Thu Nov  4 19:45:27 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (run_final): do not need argument obj.

Thu Nov  4 19:26:10 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (before_gc_sweep): fix commit miss.

Thu Nov  4 19:20:46 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep, before_gc_sweep):
	  invoke rb_sweep_method_entry() as soon as possible.

Thu Nov  4 19:13:58 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (after_gc_sweep, slot_sweep): finalizers should be invoked
	  as soon as possible.

Thu Nov  4 10:30:40 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* configure.in (--with-valgrind): Now this option is default on.
	  You can still explicitly disable this feature by specifying
	  --without-valgrind.

Thu Nov  4 02:06:16 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (fiber_t_alloc): raise an error when fiber is going to be
	  initialized twice.  [ruby-dev:42524]

Thu Nov  4 02:04:25 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* cont.c (rb_fiber_resume): raise an "double resume" error when root
	  fiber is going to be resumed.  [ruby-dev:42523]

Wed Nov  3 14:17:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/ostruct.rb (OpenStruct#delete_field): also undefine
	  accessor methods.  [ruby-core:33010]

Wed Nov  3 14:13:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_enc_cr_str_buf_cat): concatenation of valid
	  encoding string and invalid encoding string should result
	  invalid encoding.  [ruby-core:33027]

Wed Nov  3 08:58:59 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c, vm.c, vm_core.h: remove USE_VALUE_CACHE option.

Wed Nov  3 07:47:25 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* lib/irb/ruby-lex.rb (RubyLex#identify_string): parse multiple
	  regex options.  a patch from Heesob Park in [ruby-core:32988].

Wed Nov  3 07:33:57 2010  Tanaka Akira  <akr@fsij.org>

	* vm_method.c (rb_clear_cache_by_class): just return if the class has
	  no method.  reported by Eric Wong.  [ruby-core:32689]

Tue Nov  2 22:50:25 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/visitor.rb (initialize): push accessor
	  methods to subclass that actually uses them.

Tue Nov  2 22:47:08 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/visitor.rb (accept): switch to
	  a dispatch cache rather than case / when statement.

Tue Nov  2 21:46:52 2010  Kouhei Sutou  <kou@cozmixng.org>

	* NEWS: fix a typo.

Tue Nov  2 20:10:32 2010  Tajima Akio <artonx@yahoo.co.jp>

	* test/rake/test_tasks.rb: clear env var which is used by the test.
	  [ruby-dev:42508]

Tue Nov  2 00:25:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: win64 is just same with win32 about socket.
	  notice: but wince is not same.

Mon Nov  1 21:25:57 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* main.c: <stdlib.h> is needed, to introduce the getenv(3)
	  prototype declaration.  Without it a C compiler shall infer
	  the getenv type as "int getenv(...);", but this is totally
	  wrong, especially when your machine's sizeof(int) and
	  sizeof(char*) differs.  On such environment a return value
	  of getenv(3), which is in fact a char*, might first casted
	  into a int (loses data here), and then casted back to char*
	  by automatic integral promotion to fit to the prototype of
	  ruby_set_debug_option().

Sun Oct 31 23:27:09 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (finalizer_table, objspace->final.table):
	  Create finalizer_table at Init_heap().
	  Remove all null checks of finalizer_table.

	* gc.c (mark_tbl): skip if no table entries.

	* gc.c (slot_swee): remove useless need_call_final check.

Sun Oct 31 22:32:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_objspace_free): finalizers should be called separately
	  from freeing objspace.  [ruby-dev:42479]

Sun Oct 31 22:24:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval.c (ruby_cleanup): free current VM and its objspace even
	  when exiting by SystemExit.

Sun Oct 31 22:10:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (new_child_iseq): adjust argument types.

	* iseq.c (prepare_iseq_build, rb_iseq_new),
	  (rb_iseq_new_with_bopt_and_opt, rb_iseq_new_with_opt),
	  (rb_iseq_new_with_bopt): ditto.

	* compile.c (iseq_set_exception_table): suppress warnings.

	* insns.def (putspecialobject, defined): ditto.

	* iseq.c (iseq_load): ditto.

Sun Oct 31 09:30:51 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h: some refactoring.
	  - move decl. of rb_compile_option_struct to iseq.h.
	  - define enum iseq_type.
	  - define enum vm_special_object_type.

	* compile.c: some refactoring.
	  - apply above changes.
	  - (struct iseq_link_element): change value of type.
	  - remove unused decl.
	  - fix comment.
	  - rename iseq_build_body and iseq_build_exception to
	    iseq_build_from_ary_body and iseq_build_from_ary_exception.

	* iseq.h: define enum catch_type and enum defined_type.

	* insns.def: apply above changes.

	* iseq.c: define ISEQ_MAJOR_VERSION and ISEQ_MINOR_VERSION.

Sat Oct 30 23:38:59 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/encoding.rb: untabify.

Sat Oct 30 21:06:37 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/encoding.rb: use Ruby native encoding mechanism.
	  [ruby-dev:42464]
	* lib/rexml/encodings/: remove.

	* lib/rexml/document.rb, lib/rexml/formatters/default.rb,
	  lib/rexml/output.rb, lib/rexml/parseexception.rb,
	  lib/rexml/parsers/baseparser.rb, lib/rexml/source.rb,
	  lib/rexml/xmldecl.rb: use Ruby's native Encoding object.

	* test/rexml/, test/rss/: follow the above encoding changes.

	* NEWS: add REXML's incompatible change about encoding.

Sat Oct 30 17:23:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strtod): get rid of overflow/underflow as possible.

Sat Oct 30 14:37:39 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_pc): erase runtime-defined variables and
	  check if generated pc file is valid.

	* template/ruby.pc.in (DEFFILE): need for mingw.

	* template/ruby.pc.in (LIBRUBY): fix the order.

Sat Oct 30 11:33:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/Makefile.sub (ruby_pc): ignore missing variables.

	* template/ruby.pc.in: add missing variables for mswin.

Sat Oct 30 10:24:35 2010  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* object.c: Make BasicObject.new accept no parameter.
	  Revert of r26135 [ruby-core:27080], as per [ruby-core:32952].

Sat Oct 30 09:40:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c: use constants in id.h.

Sat Oct 30 09:08:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/fiddle/closure.c (fiddle_closure): embed cif not reference
	  so that the content surely get initialized.  [ruby-dev:42480]

Sat Oct 30 07:01:53 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv-replace.rb: suppress warning.

	* lib/open-uri.rb: ditto.

Sat Oct 30 06:32:52 2010  Tanaka Akira  <akr@fsij.org>

	* test/pathname/test_pathname.rb (TestPathname#test_grpowned?): the
	  group of the created file is inherited from the parent
	  directory on BSDs and MacOS X.  Linux also inherit the group if
	  the setgid bit of the directory is set.  It causes the test fail.
	  fixed by Shota Fukumori.  [ruby-dev:42458]

Sat Oct 30 05:58:54 2010  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: retry via TCP if UDP reply is truncated.
	  fixed by Julian Mehnle.  [ruby-core:32407]

Sat Oct 30 00:35:13 2010  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_s_compile): fix optional argument.
	  a patch from Yutaka HARA [ruby-core:32953] [Ruby 1.9-Bug#4001]

Sat Oct 30 00:24:42 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (memsize_of): take care of
	  T_CLASS/const_tbl.
	  a patch from nagachika <nagachika00@gmail.com> [ruby-dev:42490]

Fri Oct 29 23:32:36 2010  Koichi Sasada  <ko1@atdot.net>

	* test/profile_test_all.rb: added.
	  You can use test-all profiler with the following command:
	    RUBY_TEST_ALL_PROFILE=true make test-all
	  This command generates ./test_all_profile and you can analyze
	  which tests consume memories.

	* test/runner.rb: ditto.

Fri Oct 29 10:02:03 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Add 'Unknown' Script.
	  patched by Run Paint Run Run. [ruby-core:32937] #3998

Fri Oct 29 05:13:34 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (ObjectSpace.memsize_of_all): rename
	  ObjectSpace.total_memsize_of_all_objects() to
	  ObjectSpace.memsize_of_all([klass]).
	  Accept Class object to filter the objects.

	* test/objspace/test_objspace.rb: fix test for above change.

Fri Oct 29 03:04:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_dump): fix expected length. [ruby-core:32935]

Thu Oct 28 23:31:39 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (before_gc_sweep, run_final): fix decrement timing of final_num.

Thu Oct 28 20:11:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb,
	  enc/unicode/name2ctype.h, enc/unicode/name2ctype.h.blt,
	  enc/unicode/name2ctype.kwd, enc/unicode/name2ctype.src:
	  Update Oniguruma for Unicode 6.
	  patched by Run Paint Run Run. [ruby-core:32923] #3989

Thu Oct 28 20:06:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/oniguruma.h (ONIGENC_CTYPE_SPECIAL_MASK):
	  change mask from 128 to 256. [ruby-core:32931]

Thu Oct 28 12:06:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httprequest.rb (read_request_line): extend max
	  length to 2083. This is from Internet Explorer's max uri
	  length. http://support.microsoft.com/kb/208427 [ruby-core:32924]

Thu Oct 28 04:00:08 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (GC.stat): added.  [ruby-dev:38607]

	* test/ruby/test_gc.rb: add a test for above.

Thu Oct 28 03:13:06 2010  Koichi Sasada  <ko1@atdot.net>

	* ext/objspace/objspace.c (memsize_of): fix rdoc.

	* ext/objspace/objspace.c (total_memsize_of_all_objects): added.

	* test/objspace/test_objspace.rb:
	  - add a test for ObjectSpace.total_memsize_of_all_objects.
	  - add two tests for ObjectSpace.memsize_of (for nil and Fixnum).

Wed Oct 27 23:55:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/iconv/iconv.c (Init_iconv): warn deprecated use.

Wed Oct 27 18:50:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2long, rb_big2ulong): rb2ulong() returns VALUE, but
	  its real range is ulong. So, if the size of VALUE is bigger than
	  ulong, upper bits are always zero even if the actual value is
	  negative.
	  fixed #3490

Wed Oct 27 18:27:17 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): should close write end of pipe
	  before closing read end, to get rid of timing problem.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 27 18:14:27 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getppid): support Win64.

Wed Oct 27 15:07:19 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_error): should get error no only once, because
	  the result of the second getting will indicate the error of the
	  first FormatMessage() call.

Wed Oct 27 13:51:25 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): need to propagate exceptions
	  in read/write thread. fix r29541.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 27 12:05:40 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* class.c (clone_const): need to return value. fix r29602.

Wed Oct 27 11:58:58 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/ruby.h (NUM2LONG_internal): add cast to get rid of a
	  non GCC compiler warning. this is intentional type conversion.

Wed Oct 27 09:25:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c: apply documentation patch by Run Paint Run Run.
	  [ruby-core:32915]

Wed Oct 27 02:12:10 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* object.c (Init_Object), constant.h, variable.c
	  (rb_mod_private_constant, rb_mod_public_constant,
	  set_const_visibility, rb_const_get_0): add Module#public_constant
	  and private_constant.  [ruby-dev:39685][ruby-core:32698]

	* test/ruby/test_module.rb: add tests for above.

Wed Oct 27 02:02:54 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c, constant.h, gc.c, method.h, object.c, variable.c,
	  vm_insnhelper.c: use struct rb_constant_entry_t as entry of
	  RCLASS_CONST_TBL.  RCLASS_CONST_TBL has contained VALUE of constant
	  directly.  Now instead rb_const_entry_t is contained in
	  RCLASS_CONST_TBL,  rb_const_entry_t is managed by malloc, and
	  have not only the value itself but also visibility flag.
	  This is another preparation for private constant (see
	  [ruby-dev:39685][ruby-core:32698]).

Wed Oct 27 01:56:34 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* class.c, gc.c, object.c, variable.c, vm_insnhelper.c,
	  include/ruby/ruby.h: separate RCLASS_CONST_TBL from RCLASS_IV_TBL.
	  RCLASS_IV_TBL has contained not only instance variable table but
	  also constant table.  Now the two table are separated to
	  RCLASS_CONST_TBL and RCLASS_IV_TBL.  This is a preparation for
	  private constant (see [ruby-dev:39685][ruby-core:32698]).

Tue Oct 26 18:51:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/scanf.rb (extract_float): allow 2.e+2 style.
	  [ruby-dev:42452] #3978

Tue Oct 26 18:09:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (ASFLAGS): needs INCFLAGS.

	* configure.in (rb_cv_dynamic_alloca): check if extra source for
	  dynamic size alloca.

	* missing/x86_64-chkstk.s (___chkstk): necessary for alloca of
	  amd64-mingw32msvc-gcc on Ubuntu.

	* thread_win32.c (ruby_alloca_chkstk): check stack overflow

Tue Oct 26 18:04:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in (Libs): needs DLDFLAGS.

Tue Oct 26 12:47:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (pkgconfig-data): moved from Makefile.in.

	* tool/rbinstall.rb: install pc file only if non-empty.
	  [ruby-core:32901] #3983

	* win32/Makefile.sub (ruby_pc): create pc file.

Tue Oct 26 09:13:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rb_cv_gcc_atomic_builtins): check for atomic
	  builtins, all are not available in Apple derivative gcc.

Tue Oct 26 00:29:26 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (pkgconfig-data): create pkg-config metadata file.

	* tool/rbinstall.rb: install pkg-config metadata file.

	* template/ruby.pc.in: template of pkg-config metadata file.

Mon Oct 25 16:38:07 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* signal.c  (rb_atomic_t): GCC (of  at least  recent versions)
	  has  ubiquitous  support  for  atomic operations.   On  that
	  compiler a C program can  issue a memory barrier using these
	  dedicated  instructions.  According to  the GCC  manual they
	  cargo culted  this feature form  the Itanium ABI  so chances
	  are that  other compilers  could also support  this feature.
	  But so far GCC is the  only compiler that I know to have it.
	  Also note that this works on non-Itanium machines.

Mon Oct 25 06:21:35 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): prec digits fractal part should be
	  appended to 0 if prec is given.  [ruby-dev:42453] #3979

Mon Oct 25 02:57:21 2010  Koichi Sasada  <ko1@atdot.net>

	* common.mk (run.gdb): Quit gdb on 'make gdb' when
	  no signals are received.

Mon Oct 25 00:25:23 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: some corrections of documentation.

Sun Oct 24 17:14:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c, gc.c, hash.c, object.c, string.c, struct.c,
	  transcode.c, variable.c, vm.c, vm_insnhelper.c, vm_method.c:
	  replace calls to rb_error_frozen() with rb_check_frozen().  a
	  patch from Run Paint Run Run at [ruby-core:32014]

	* include/ruby/intern.h (rb_check_frozen): optimize.
	  [ruby-core:32878]

Sun Oct 24 15:16:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Mini#run): abort if interrupted.

	* lib/test/unit.rb (Test::Unit::Mini#run_test_suites): show the
	  result even when interrupted on the way.

	* lib/test/unit.rb (Test::Unit::Mini#run_test_suites): ensure
	  output sync mode to be restored.

Sun Oct 24 14:11:16 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_define_method): defined method is run with the default
	  public visibility regardless the visibility context of definition.
	  [ruby-core:30638]

Sun Oct 24 12:08:54 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/test/unit.rb: make test/unit play nicely with the rake test
	  loader. [ruby-core:32864]

Sun Oct 24 00:25:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (test_segv_test): follow up the
	  change at r29556.

Sat Oct 23 14:39:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: $extmk should be true for test/runner.

Sat Oct 23 10:55:37 2010  Koichi Sasada  <ko1@atdot.net>

	* vm_dump.c (rb_vm_bugreport): fix to add bug outputs.
	  - loaded script ($0)
	  - loaded features ($")
	  - process memory map on Linux (/proc/self/maps)

	* vm_dump.c (rb_vmdebug_stack_dump_raw): fix header message.

Fri Oct 22 14:50:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  assertion message must not be nil.

Fri Oct 22 13:59:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/test/unit/assertions.rb (Test::Unit::Assertions#assert):
	  treat nil case. Please run test-all before commit such change.

Thu Oct 21 23:58:14 2010  Koichi Sasada  <ko1@atdot.net>

	* gc.c (gc_lazy_sweep): Variable declarations should be at
	  the head of block.

Thu Oct 21 23:56:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (objspace_each_objects, rb_objspace_each_objects): use
	  struct.

	* gc.c (objspace_each_objects): fix return with no value.

Thu Oct 21 23:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_initialize): remove useless intermediate variable.

Thu Oct 21 16:07:20 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_f_select): change rdoc.
	  patched by Eito Katagiri [ruby-core:31805]

Thu Oct 21 15:55:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httpauth/digestauth.rb
	  (WEBrick::HTTPAuth::ProxyDigestAuth#check_uri): privated.
	  [ruby-dev:42344]

Thu Oct 21 15:50:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_f_select): add correct rdoc.
	  patched by Dave Thomas [ruby-core:32467]

Thu Oct 21 15:42:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/telnet.rb (Net::Telnet#close): added.
	  patched by Erik Hollensbe [ruby-dev:42260] #3830

Thu Oct 21 13:08:00 2010  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (rb_objspace_each_objects): don't lazy sweep in
	  rb_objspace_each_objects. [Bug #3940] [ruby-dev:42369]

Thu Oct 21 00:05:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#pipe): get rid of deadlock on pipe.
	  a patch from Tomoyuki Chikanaga at [ruby-dev:42435].  #3970

	* test/ruby/test_io_m17n.rb (TestIO_M17N#pipe): ditto.

Wed Oct 20 23:54:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dbm/dbm.c: rdoc based on a patch by mathew meta AT
	  pobox.com, at [ruby-core:32853].

Wed Oct 20 10:47:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): reject 0x1.p+0. [ruby-dev:42432] #3966

Wed Oct 20 10:00:57 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): print floating point on "%#a".
	  [ruby-dev:42431] Bug#3965

Tue Oct 19 19:30:11 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): clear ALT flag for %a.
	  [ruby-core:32841] [ruby-core:32848]

Tue Oct 19 12:19:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): fix over-count of field size.

Tue Oct 19 03:08:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): use HEXPREFIX flag for prefix of %a.
	  [ruby-core:32841]

Mon Oct 18 13:18:01 2010  Akinori MUSHA  <knu@iDaemons.org>

	* ext/digest/digest.c (rb_digest_class_init): Define
	  Digest::Class.new(). [Feature #3954]

Mon Oct 18 12:58:40 2010  Tanaka Akira  <akr@fsij.org>

	* pack.c (pack_pack): refine the document.  [ruby-dev:42397]
	  (pack_unpack): ditto.

Mon Oct 18 10:19:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (transport_request): @socket may be nil.
	  patched by Egbert Eich [ruby-core:32829]

Mon Oct 18 09:57:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* sprintf.c (BSD_vfprintf): wrong padding around prefix and
	  floating point with %a. [ruby-dev:42403] Bug #3956

Sun Oct 17 22:36:33 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date/delta.rb: added an rdoc tag.

Sun Oct 17 10:47:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_mod_remove_const): update rdoc.
	  [ruby-core:31957]

Sun Oct 17 10:40:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (rb_define_{class,module}_id_under): register to be
	  marked, which probably are defined and used internally.

Sat Oct 16 11:10:55 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_encoding2cp): set codepage 20936
	  according to GB2312. [Bug #3937] [ruby-core:32758]

Sat Oct 16 10:54:57 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (CPP): already used in .c.i rule.

	* cygwin/GNUmakefile.in (DLLWRAP, WINDRES): add --driver-name and
	  --preprocessor options explicitly.  [ruby-core:32776]

Sat Oct 16 10:06:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/sdbm/_sdbm.c (SEEDUPS, BADMESS): make settable using command
	  line options.

	* ext/sdbm/_sdbm.c (makroom): suppress unused result warning.

	* ext/sdbm/extconf.rb: disable BADMESS, a library should not emit
	  messages directly.

Sat Oct 16 08:39:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dln.c (dln_strerror): get English message first, instead of
	  system default. see [ruby-dev:42358].

Sat Oct 16 00:08:00 2010  Koichi Sasada  <ko1@atdot.net>

	* hash.c (rb_hash_aref): skip calling "default" method
	  if it is not needed, for speed-up.

Fri Oct 15 23:36:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (NUM2DEVT, DEVT2NUM, PRI_DEVT_PREFIX): fallback to
	  unsigned int.

Fri Oct 15 22:54:46 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (ole_hresult2msg): get English message first,
	  instead of system default. [ruby-core:32765]

Fri Oct 15 22:47:31 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (VALUE): prefer long over uintptr_t,
	  FIX2LONG expects VALUE to be long at least.

	* include/ruby/ruby.h (FIX2LONG): parenthesize the argument.

Fri Oct 15 20:30:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (dev_t): use RUBY_REPLACE_TYPE.

	* file.c (rb_stat_inspect): use PRI_DEVT_PREFIX.

Fri Oct 15 17:26:57 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): simplify comparison of explicit_endian
	  as pointed by nobu.

	* pack.c (pack_unpack): ditto.

Fri Oct 15 16:40:37 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): fix more than one modifiers appear in the
	  format string. [ruby-core:32793]

	* pack.c (pack_unpack): ditto.

Thu Oct 14 23:20:42 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb: refactoring.

Thu Oct 14 22:18:29 2010  Koichi Sasada  <ko1@atdot.net>

	* insns.def, iseq.c, vm_insnhelper.c: rename variable name
	  (ip -> iseq).

Thu Oct 14 20:41:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_pack): support endian modifiers: < and >.
	  [ruby-dev:42376] Feature #3491

	* pack.c (pack_unpack): ditto.

Thu Oct 14 20:50:51 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* ext/win32ole/win32ole.c (reg_get_val): expand environment in
	  the pathname. [Bug #3907]

Thu Oct 14 07:35:07 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (DEVT2NUM): added. Size of dev_t is depend on the
	  environment even if POSIX defines dev_t as unsigned integer.
	  For example, OpenVMS, 64bit Solaris 9, and NetBSD 6 defines
	  dev_t as 64bit unsigned integer.

	* file.c (rb_stat_dev): use DEVT2NUM.

	* file.c (rb_stat_dev_major): dev_t is not long. major(3)'s return
	  value is int.

	* file.c (rb_stat_dev_minor): dev_t is not long. minor(3)'s return
	  value is int.

	* configure.in: check size of dev_t.

Thu Oct 14 07:22:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_and, rb_ary_or), class.c (rb_mod_init_copy),
	  gc.c (undefine_final), time.c (time_mload): get rid of
	  type-punning casts.

Thu Oct 14 04:16:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (ruby_float_step): fix Numeric#step with infinity unit
	  doesn't works well. [ruby-core:32779]

Wed Oct 13 23:16:46 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/enc-unicode.rb: get rid of lots of warnings.

	* iseq.c (insn_operand_intern, rb_iseq_disasm): fix format specifiers.

	* vm.c (thread_free): ditto.

	* numeric.c (check_uint): get rid of overflow on LLP64 platforms.

	* insns.def (opt_case_dispatch): use st_data_t.

Wed Oct 13 22:32:34 2010  Takeyuki FUJIOKA  <xibbar@ruby-lang.org>

	* lib/cgi/util.rb (CGI::unescape): bugfix to unescape the multibyte
	  string. Thanks nobu and tDiary dev members. [Bug #3909]

Wed Oct 13 21:13:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_chr): raise error when the value is negative.

Wed Oct 13 19:24:08 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* vm.c (ruby_vm_destruct): This function type was wrong; correct to the prototype.

Wed Oct 13 14:58:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num_to_uint): fix 32bit logic.

Wed Oct 13 12:53:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_num_to_uint): added to check the range of arguments.
	  Mainly for negative value with NUM2UINT on 32bit environment.

	* string.c (rb_str_concat): use rb_num_to_uint.

Wed Oct 13 12:10:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread_win32.c (w32_error): get English message first, instead
	  of system default. see [ruby-core:32765].
	  [experimental]

Wed Oct 13 11:04:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* debug.c (ruby_set_debug_option): define always for binary
	  compatibility with debug env enabled binary.

	* signal.c (ruby_enable_coredump): ditto.

Wed Oct 13 10:52:51 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (ruby_executable_node): missing prototype.

Wed Oct 13 05:23:04 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* missing/strchr.c: add strlen's prototype.

	* missing/strstr.c: ditto.

Wed Oct 13 00:21:17 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (struct mktime_arg): constified.

	* ext/syck/rubyext.c (mktime_do, mktime_r, rb_syck_mktime): fix
	  function signatures.

Wed Oct 13 00:18:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (MurmurMagic): get rid of literal overflow.

	* configure.in (RUBY_CHECK_PRINTF_PREFIX): check for printf format
	  specifier if possible.

Tue Oct 12 23:58:19 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_w32_open_osfhandle, rb_w32_wopen, rb_w32_pipe):
	  use uintptr_t instead of long for win64.

	* win32/win32.c (socketpair_internal): suppress warnings.

	* win32/win32.c (ftruncate): use HANDLE instead of long for win64.

	* vsnprintf.c (BSD_vfprintf): fix cast.

	* numeric.c (rb_num2fix): result of rb_num2long is SIGNED_VALUE.

	* compile.c (iseq_build_body), error.c (set_syserr, get_syserr),
	  (syserr_initialize), gc.c (define_final, rb_gc_copy_finalizer),
	  (run_final), hash.c (rb_hash_aref, rb_hash_lookup2),
	  (rb_hash_fetch_m, rb_hash_clear, rb_hash_aset, eql_i),
	  iseq.c (iseq_load, iseq_data_to_ary), marshal.c (r_symlink),
	  thread.c (rb_thread_local_aref),
	  variable.c (generic_ivar_remove, ivar_get, rb_const_get_0),
	  (rb_cvar_get), vm.c (rb_vm_check_redefinition_opt_method),
	  vm_insnhelper.c (vm_get_ev_const), vm_method.c (remove_method),
	  ext/iconv/iconv.c (map_charset): use st_data_t.

	* compile.c (iseq_build_body), insns.def (getglobal, setglobal),
	  iseq.c (iseq_load, iseq_data_to_ary), util.c (valid_filename):
	  use VALUE.

	* gc.c (obj_free, rb_objspace_call_finalizer): fix truncating
	  cast.

	* gc.c (mark_current_machine_context): suppress warnings.

	* compile.c (iseq_compile_each): fix truncating cast.

	* cont.c (fiber_setcontext): missing variable definition.

Tue Oct 12 19:25:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (exc_to_s): use OBJ_INFECT.

	* error.c (name_err_to_s): ditto.

	* error.c (name_err_mesg_to_str): ditto.

	* error.c (syserr_initialize): ditto.

Tue Oct 12 19:07:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): taint message if mesg is given
	  and it is tainted.

Tue Oct 12 18:25:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ungetc): always see Bignum. On 32bit valid value
	  may be a Bignum. On 64bit for errors. [ruby-dev:42366]

Tue Oct 12 18:25:04 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_concat): use unsigned int for GB18030.

Tue Oct 12 17:53:49 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric (check_uint): the mask must refer to VALUE.

Tue Oct 12 17:47:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric (check_uint): set MSB for negative value.

	* numeric (rb_num2uint): return value's type of rb_num2ulong
	  is VALUE.

	* numeric (int_chr): variable i can't be negative.

Tue Oct 12 16:04:37 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_strerror): get English message first, instead
	  of system default. see [ruby-dev:42358].
	  [experimental]

Tue Oct 12 15:52:35 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_strerror): unmap some range of errno for
	  workaround of VC10's strerror() and sys_nerr problem.
	  based on a patch from Akio Tajima, [ruby-dev:42355].

Tue Oct 12 15:36:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_ungetc): use unsigned int for GB18030.

Tue Oct 12 15:14:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_putc): support multibyte characters.
	  [ruby-core:30697]

Tue Oct 12 15:10:31 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_enc_uint_chr): split from int_chr.

	* numeric.c (int_chr): use rb_enc_uint_chr.

	* include/ruby/encoding.h (rb_enc_uint_chr): added.

Tue Oct 12 14:04:41 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (int_chr): a codepoint of Ruby M17N must be 32bit
	  unsigned int; GB18030 uses MSB. Also note that OnigCodePoint
	  is defined as unsigned int.

Tue Oct 12 12:20:54 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): foolish mistake.

Tue Oct 12 10:39:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_MINGW32): canonicalize only on mingw.

Mon Oct 11 20:20:23 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (HTTP.get): specify ASCII-8BIT as the result
	  encoding of Zlib::GzipReader.
	  http://hibari.2ch.net/test/read.cgi/tech/1281473294/271

Mon Oct 11 17:42:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): use mesg's encoding when locale
	  encoding is US-ASCII. If locale encoding is not US-ASCII,
	  assume err has non ASCII characters. [ruby-dev:42358]

Mon Oct 11 14:03:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (syserr_initialize): set the encoding of Errno::*#message
	  as locale. [ruby-dev:42358]

Mon Oct 11 06:38:27 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/stringio/stringio.c (strio_set_encoding):
	  StringIO#set_encoding can get 2nd argument and optional hash
	  for API compatibility to IO. [ruby-dev:42356]

Mon Oct 11 06:11:30 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_set_encoding): use rb_funcall2 when the io is not
	  a T_FILE. [ruby-dev:42356]

Sun Oct 10 18:42:23 2010  Akinori MUSHA  <knu@iDaemons.org>

	* lib/set.rb (Set#replace): Apply a bit of optimization.

Sun Oct 10 10:20:07 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_MINGW32): canonicalize as like mswin version.

Sun Oct 10 05:33:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (rb_signal_buff_size, rb_signal_exec): moved
	  declarations from thread.c.

Sat Oct  9 16:54:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RSHIFT): quote to get rid of argument expansion
	  for autoconf 2.68.

Sat Oct  9 11:00:06 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (thread_reset_event_flags, exec_event_hooks): ignore
	  hooks marked as removed.

	* thread.c (thread_exec_event_hooks): remove hooks to be removed.

	* thread.c (rb_threadptr_remove_event_hook, rb_remove_event_hook):
	  defer removing hooks if running the hooks.  [ruby-dev:42350]

Sat Oct  9 10:51:00 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_threadptr_exec_event_hooks): suppress each event
	  hooks separately.

	* thread.c (thread_suppress_tracing): split from
	  ruby_suppress_tracing, accepting thread pointer and event mask.

Sat Oct  9 08:16:01 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_threadptr_remove_event_hook): fix typo.

Fri Oct  8 10:52:25 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (RBCONFIG): depends on version.h due to
	  RUBY_PATCHLEVEL.  [ruby-core:32709]

Fri Oct  8 00:24:54 2010  James Edward Gray II  <jeg2@ruby-lang.org>

	* lib/csv.rb: Fixing documentation typos.  [ruby-core:32712]

Thu Oct  7 09:14:28 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_exec.c (vm_exec_core):  Treat clang as non gcc on this
	  context: It has __asm__ but doesn't works well.

Wed Oct  6 12:28:22 2010  Tanaka Akira  <akr@fsij.org>

	* lib/uri/generic.rb (URI::Generic#hostname): new method.
	  (URI::Generic#hostname=): ditto.

	* lib/open-uri.rb: use URI#hostname

	* lib/net/http.rb: ditto.

	  reported by Adam Majer.  [ruby-core:32056]

Wed Oct  6 11:52:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (fptr_finalize): write_mutex might have been destroyed
	  already in finalization phase, as the order of finalizers is not
	  guaranteed.  rb_mutex_t should be used in place of Mutex object
	  in the future.

Tue Oct  5 22:17:02 2010  wanabe  <s.wanabe@gmail.com>

	* win32/mkexports.rb: revert r29320 and r29402.

Mon Oct  4 12:43:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (regexp): dregexp has literal string only at the head
	  and successors are array.  [ruby-core:32682]

Mon Oct  4 10:22:21 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rand_init): This checks the value is in 32bit or not,
	  so use int32_t, not int.

Mon Oct  4 09:47:39 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rand_init): remove useless assignment.

	* re.c (update_char_offset): remove unused variable.

	* re.c (read_escaped_byte): ditto.

Mon Oct  4 09:30:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/lib/openssl/bn.rb (Integer#to_bn): OpenSSL::BN.new
	  accepts only Strings, so call Integer#to_s(16).
	  16 is for an optimization. [ruby-dev:42336]

Mon Oct  4 07:57:51 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (fiber_memsize): Return size.
	  Before this change, fiber_memsize always returns 0.

Mon Oct  4 07:16:55 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/unicode.c (onigenc_unicode_property_name_to_ctype):
	  remove useless assignment.

	* vm.c (vm_make_proc_from_block): ditto.

	* variable.c (rb_ivar_count): ditto.

Mon Oct  4 06:40:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* Makefile.in (clean-rdoc): Don't use \ in variable expansion.
	  BSD make treats it as an escape character.

Mon Oct  4 00:01:53 2010  wanabe  <s.wanabe@gmail.com>

	* tool/config.sub: revert r29320, r29324, r29347, r29354, r29365
	  to automake-1.11.1. [ruby-core:32634]

	* win32/mkexports.rb: no longer use 'mingw64'. a patch from Luis Lavena
	  at [ruby-core:32678].

Sun Oct  3 20:36:37 2010  Akio Tajima (arton)  <artonx@yahoo.co.jp>

	* test/win32ole/test_folderitem2_invokeverb.rb: Change creating
	  shortcut verb to 'Link' [Bug #3339]

Sun Oct  3 19:44:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (Makefile): get rid of duplicated ruby target when
	  already there it was.

Sat Oct  2 22:59:32 2010  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_thread.rb: add for win32ole with Thread.

Fri Oct  1 17:03:00 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/webrick/test_httpproxy.rb (TestWEBrickHTTPProxy::test_upstream_proxy):
	  My machine fails this test at this line, saying 503 service unavailable.

Thu Sep 30 16:11:08 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_getenv): should return NULL if specified name
	  is empty. a patch from Heesob Park at [ruby-core:32650]

Thu Sep 30 15:18:23 2010  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (command_asgn): allow command_call to be right hand side
	  expression of chained assignment.  [ruby-dev:42313]

Thu Sep 30 10:55:38 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (ruby_setenv): workaround for old Windows. a patch from
	  Heesob Park. [ruby-core:32353]

Thu Sep 30 09:29:06 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form): change treatment of
	  undefined value in given array as latest internet draft for
	  application/www-form-urlencoded.
	  http://tools.ietf.org/html/draft-hoehrmann-urlencoded-01

Thu Sep 30 09:34:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): fixed wrong type of return value of
	  SymGetModuleBase64(). [ruby-dev:42306]

Wed Sep 29 21:04:05 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_rubyoptions.rb (TestRubyOptions::test_script_from_stdin):
	  As usual, PTY is not always available.

Wed Sep 29 18:38:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x64): regularize only for pc vendor, and strip
	  useless 64 suffix.

Wed Sep 29 17:53:02 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BIGDECIMAL_ENABLE_VPRINT):
	  VPrint is usually disabled.  It's only used in debugging.

Wed Sep 29 17:41:34 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_limit):
	  return the result of a block.

	* test/bigdecimal/test_bigdecimal.rb (test_save_limit):
	  add a test for the above change.

Wed Sep 29 16:18:03 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (dump_thread): remove unused optional arguments.

Wed Sep 29 13:26:30 2010  Kenta Murata <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_rounding_mode):
	  return the result of a block.

	* test/bigdecimal/test_bigdecimal.rb (test_save_rounding_mode):
	  add a test for the above change.

	* test/bigdecimal/test_bigdecimal.rb (test_save_exception_mode):
	  add a test for the return value of BigDecimal.save_exception_mode.

Wed Sep 29 12:45:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_div2, BigDecimal_add2,
	  BigDecimal_sub2, BigDecimal_mult2, VpLimitRound): remove meaningless
	  casts to get rid of compiler warnings.

Wed Sep 29 12:35:13 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VPrint, VpToString): fix format.

Wed Sep 29 12:31:12 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/known_classes.rb (RDoc::KNOWN_CLASSES): add Encoding.

Tue Sep 28 20:50:23 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x64): regularize same as mswin.

Tue Sep 28 20:06:14 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_dump.c (rb_vm_bugreport): add windows support.
	  based on patches from Peter Weldon at [ruby-core:32551]

Mon Sep 27 23:30:34 2010  Koichi Sasada  <ko1@atdot.net>

	* insns.def (opt_case_dispatch), vm_insnhelper.c:
	  execute the procedures of "when" clauses by bytecode
	  instead of st_foreach() when the object does not hit
	  prepared hash.  [ruby-dev:42304]

Mon Sep 27 15:54:03 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/http/test_https.rb: As always, localhost is not
	  guaranteed to be resolved as 127.0.0.1.  But a SSL
	  certificate needs a socket to listen on a specific address
	  where a CN resolves to.  On situations where localhost is
	  not 127.0.0.1, these tests are not possible.

Mon Sep 27 15:25:05 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/imap/test_imap.rb: resurrection of r29259.
	  this change depends on minitest 1.7.1.

	* lib/test/unit/assertions.rb: ditto.

Sun Sep 26 22:59:45 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub (x86_64-pc-mingw64): regularize.

Sun Sep 26 22:21:07 2010  wanabe  <s.wanabe@gmail.com>

	* ext/openssl/ossl_hmac.c (ossl_hmac_hexdigest, ossl_hmac_s_hexdigest),
	  ext/openssl/ossl_pkey_ec.c (ossl_ec_group_set_seed),
	  ext/openssl/ossl_ssl_session.c (ossl_ssl_session_to_der),
	  ext/openssl/ossl_pkcs7.c (numberof): suppress warnings.
	  [ruby-core:31932]

Sun Sep 26 10:25:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.{guess,sub}: updated to automake-1.11.1.

Sat Sep 25 22:48:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_DLDFLAGS): fix quoting.

Sat Sep 25 10:30:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_DLDFLAGS): use -unexported_symbol only
	  when available.  http://trac.macports.org/ticket/26341

Sat Sep 25 10:05:49 2010  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Always add -mieee for Renesas SH4.
	  Thanks, Nobuhiro Iwamatsu. [Feature #3874] [ruby-core:32548]

Sat Sep 25 01:34:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (install-cross): target to install cross-compiling
	  stuff.

Fri Sep 24 23:44:59 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (sym_call), vm.c (invoke_block_from_c),
	  vm_insnhelper.c (vm_yield_with_cfunc): pass given block.
	  [ruby-core:32075]

	* vm_eval.c (rb_funcall_passing_block): new function to call
	  method with passing given block.

Fri Sep 24 15:50:43 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_to_i): fix rdoc: String#to_i raises an
	  exception when base is invalid. [ruby-core:31685]

Fri Sep 24 15:28:35 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (rb_str_rindex): use rb_enc_prev_char instead of repeated
	  str_nth.
	  patched by Michael Selig [ruby-core:32498]

Fri Sep 24 14:19:12 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/test_pty.rb: Same as 229281; existence of PTY class do not
	  guarantee a successful pty operation.

Fri Sep 24 06:25:55 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.7.2 r5879.
	* test/minitest/*.rb: ditto.

Thu Sep 23 23:09:08 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_cref0): cref is stacked only in normal
	  iseqs, so check if it is the case first.

Thu Sep 23 23:08:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/config.sub: mingw64 should use x86_64.  [ruby-core:32514]

Thu Sep 23 21:40:40 2010  wanabe  <s.wanabe@gmail.com>

	* ext/socket/raddrinfo.c (init_addrinfo, inspect_sockaddr): suppress
	  warnings.  see [ruby-core:31932].

Thu Sep 23 19:27:57 2010  wanabe  <s.wanabe@gmail.com>

	* thread_win32.c (w32_wait_events, w32_close_handle): suppress warnings.
	  see [ruby-core:31932].

Thu Sep 23 18:54:39 2010  wanabe  <s.wanabe@gmail.com>

	* tool/config.sub: add mingw64.

	* win32/mkexports.rb (Exports::Mingw64): added.

	* win32/mkexports.rb (Exports::Mingw32): renamed from Exports::Mingw.

Thu Sep 23 09:01:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_cref_push): no outer cref is needed for proc
	  from method.  Bug #3786, Bug #3860, [ruby-core:32501]

Wed Sep 22 17:12:01 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/openssl/utils.rb (OpenSSL#silent): always restore $VERBOSE.
	  [ruby-dev:42285]

Wed Sep 22 16:59:40 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* test/test_prime.rb (TestPrime#test_new): the warning expected have
	  not been displayed when $VERBOSE == nil. Patch by Shota Fukumori
	  a.k.a. sora_h. [ruby-dev:42272]
	  Recovers $stderr even if StringIO.new fails. Reported by unak.

Wed Sep 22 01:55:48 2010  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_method.rb: fix last commit.

Wed Sep 22 01:49:52 2010  Koichi Sasada  <ko1@atdot.net>

	* bootstraptest/test_method.rb: add a test for [ruby-core:30534].

Wed Sep 22 00:52:44 2010  WATANABE Hirofumi  <eban@ruby-lang.org>

	* lib/rdoc/ri/store.rb (save_cache): remove duplicate entries.

Wed Sep 22 00:00:05 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_f_pathname): Pathname() translated
	  from pathname.rb.

Tue Sep 21 22:18:30 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* tool/mkconfig.rb: fixed build problem on mswin64 introduced in r29278.

Tue Sep 21 02:42:35 2010  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/pathname/test_pathname.rb (TestPathname#test_mkdir): fix typo.

Mon Sep 20 23:23:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (bracket): get rid of scanning at the end of the pattern
	  string, not to raise an exception while globbing command line.
	  [ruby-core:32478]

Mon Sep 20 11:25:49 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (Init_pathname): Pathname#=~ undefinition
	  translated from pathname.rb.

Mon Sep 20 02:34:11 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (check_rounding_mode, BigDecimal_mode):
	  raise ArgumentError instead of TypeError passing invalid modes.

	* test/bigdecimal/test_bigdecimal.rb (test_mode, test_round):
	  change against the above modifications.

Sun Sep 19 22:08:39 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mkmf.rb (try_link): rdoc
	  (try_compile): ditto
	  (try_cpp): ditto
	  (try_func): ditto
	  (try_var): ditto
	  (try_run): ditto
	  (egrep_cpp): ditto

Sun Sep 19 20:43:33 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* configure.in (--disable-install-doc): disables capi too, in addition
	  to rdoc.
	  (--disable-install-rdoc): a new option for disabling only rdoc.
	  (--disable-install-capi): a new option for disabling only capi.

Sun Sep 19 20:37:45 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (clean): removes all documents on cleaning.o
	  (CAPIOUT): new variable.
	  (clean-capi, distclean-capi, realclean-capi): new targets

	* Makefile.in (clean-capi, distclean-capi, realclean-capi): ditto.

	* win32/Makefile.sub (clean-capi, distclean-capi, realclean-capi):
	  ditto.

Sun Sep 19 13:44:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LIBRUBY_SO): fix an oversight of replace
	  RUBY_INSTALL_NAME with RUBY_SO_NAME.  a patch from Jeremy Evans
	  at [ruby-core:32474].

Sun Sep 19 07:48:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_unlink): Pathname#unlink and
	  Pathname#delete translated from pathname.rb.

Sun Sep 19 06:06:07 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (check_rounding_mode): added for
	  converting symbol to rounding mode number.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode, BigDecimal_round):
	  support to specify rounding mode by symbol.

	* test/bigdecimal/test_bigdecimal.rb (test_mode, test_round):
	  add tests for above changes.

Sun Sep 19 05:14:35 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c: fix rounding algorithms for half-down
	  and half-even.  This change is based on the patch created by Matthew
	  Willson, the reporter of this bug.  [Bug #3803] [ruby-core:32136]

	* test/bigdecimal/test_bigdecimal.rb: add tests for above changes.

Sat Sep 18 20:09:51 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_each_entry): Pathname#each_entry
	  translated from pathname.rb.

Fri Sep 17 23:44:07 2010  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/xpath_parser.rb, test/rexml/test_xpath.rb:
	  add missing method availability check. [ruby-core:32447]
	  Reported by Wiebe Cazemier. Thanks!!!

Fri Sep 17 23:23:26 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_sax.rb: don't use thread and sleep to avoid slow test.

Fri Sep 17 23:10:44 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_core.rb: enable.

Fri Sep 17 22:46:02 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: untabify.

Fri Sep 17 22:29:56 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: fix fixture data path. All REXML tests are worked.

Fri Sep 17 22:15:15 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/test_listener.rb: remove needless codes.

Fri Sep 17 22:12:23 2010  Kouhei Sutou  <kou@cozmixng.org>

	* test/rexml/: import REXML tests from
	  http://www.germane-software.com/repos/rexml/trunk/test/.
	  Many tests are failed temporary. I'll fix them quickly. Sorry.

Fri Sep 17 16:48:49 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/io/console/test_io_console.rb (TestIO_Console::helper):
	  PTY.open is not guaranteed to work.  On my machine opening a
	  pty is prohibited via process control group.  On those cases
	  exceptions shall occur, and that doesn't mean our fault.
	  Skip those tests on such situations.

Fri Sep 17 08:30:27 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tracer.rb: count only non-internal libraries in stack trace,
	  ignoring custom_require.  [ruby-core:31858]

Fri Sep 17 02:18:41 2010  Akinori MUSHA  <knu@iDaemons.org>

	* tool/mkconfig.rb: Fix build with m4 1.4.15 generating duplicate
	  lines in config.status.  According to nobu, the mswin32 port may
	  depend on the piece of code in question, so the behavior is left
	  unchanged on mswin32.

Thu Sep 16 23:47:59 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_opendir): Pathname#opendir translated
	  from pathname.rb.

Thu Sep 16 21:40:37 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::GlobOption): merged RejectOption.

	* test/runner.rb: utilize GlobOption.

Thu Sep 16 21:31:24 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/driver.rb (RDoc::RI::Driver.setup_options)
	  (RDoc::RI::Driver.fixup_options): split from process_args.
	  libraries should not parse ARGV inside, since it's a task of
	  applications, not libraries.

Thu Sep 16 21:02:30 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/ri/paths.rb (RDoc::RI::Paths.each): HOMEDIR can be nil
	  if $HOME is unset.

Thu Sep 16 14:50:42 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_file_exhaustive.rb (TestFileExhaustive::test_expand_path):
	  ENV["HOME"] might not be set.  On those cases without it an
	  exception raises here, which effectively disables later
	  tests on this method.

Thu Sep 16 08:30:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_f_sprintf): fix rdoc.  pointed out by Tomoyuki
	  Chikanaga at [ruby-core:32395], and a patch from Daniel
	  Bovensiepen at [ruby-core:32403].

Thu Sep 16 08:27:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/extconf.rb: use expanded sysconfdir with empty DESTDIR.
	  [ruby-core:32394]

Thu Sep 16 06:07:24 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_rmdir): Pathname#rmdir translated
	  from pathname.rb.

Thu Sep 16 00:36:25 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/extconf.rb: Remove Readline 6 check because
	  Ruby's license is now GPLv3 compatible. [ruby-core:28736]

Thu Sep 16 00:26:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* COPYING: change Ruby's License from a dual license with GPLv2
	  to a dual license with 2-clause BSDL.
	  [ruby-dev:42166] [ruby-core:31971]
	  [ruby-dev:39167] [ruby-core:25272]

	* COPYING.ja: ditto.

	* BSDL: added. this is from The FreeBSD License.

Wed Sep 15 21:07:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_mkdir): Pathname#mkdir translated
	  from pathname.rb.

Wed Sep 15 13:37:00 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/imap/test_imap.rb: "localhost" not guaranteed to
	  resolve to "127.0.0.1".  On my machine it is "::1" instead.
	  The problem is, you have to connect to the imaps server via
	  the canonical name written in a server certificate, and that
	  of the server.cert is "localhost".  So you have to listen to
	  the address of what "localhost" resolves to.  I think this
	  situation cannot be resolved in a handy manner because the
	  test "test_imaps_post_connection_check" is actually
	  expecting to connect to a server via an address other than
	  the CN.  On my machine several assertions won't pass because
	  the test cannot connect to the server.

Wed Sep 15 09:12:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_puts): fix for wide char encoding strings.
	  [ruby-dev:42212]

Wed Sep 15 07:27:52 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_format_m): mentioned about Hash argument.  a patch
	  from Daniel Bovensiepen at [ruby-core:32386].

	* sprintf.c (get_hash): ditto, and fix typo.

Wed Sep 15 07:22:20 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_entries): Pathname#entries translated
	  from pathname.rb.

Wed Sep 15 02:13:44 2010  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/fiddle/closure.c : Don't use FFI closure alloc on OpenBSD.
	  Thanks Jeremy Evans! [ruby-core:32384]

Tue Sep 14 20:17:48 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_s_getwd): Pathname.getwd and
	  Pathname.pwd translated from pathname.rb.

Tue Sep 14 05:13:04 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_s_glob): Pathname.glob translated
	  from pathname.rb.

Tue Sep 14 01:24:51 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* ext/socket/raddrinfo.c (ruby_getaddrinfo__aix): suppress a
	  warning.

Mon Sep 13 20:48:30 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_zero_p): Pathname#zero? translated
	  from pathname.rb.

Mon Sep 13 19:56:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/rubysocket.h (__DARWIN_ALIGNBYTES): workaround of a
	  bug in system header of darwin 9.  [ruby-core:32341]

Mon Sep 13 18:11:55 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_do): fix typo.  a patch from Peter Weldon
	  at [ruby-core:32327].

Mon Sep 13 10:12:09 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): reject Float('0x0.').
	  [ruby-dev:42239] Bug #3820

Mon Sep 13 09:23:58 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/openssl/ossl_bn.c (ossl_bn_is_prime): fix comparison
	  with rb_scan_args. Before this fix, OpenSSL::BN#prime?
	  is fully broken. [ruby-dev:42225]

Mon Sep 13 06:45:24 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_writable_real_p):
	  Pathname#writable_real? translated from pathname.rb.

Sun Sep 12 21:21:50 2010  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/date.rb: [ruby-core:32096]  Thanks Colin Bartlett.

Sun Sep 12 19:30:27 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_world_writable_p):
	  Pathname#world_writable? translated from pathname.rb.

Sun Sep 12 09:16:06 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_writable_p): Pathname#writable?
	  translated from pathname.rb.

Sun Sep 12 08:36:15 2010  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_name2int): support more limits:
	  RLIMIT_MSGQUEUE, RLIMIT_NICE, RLIMIT_RTPRIO, RLIMIT_RTTIME and
	  RLIMIT_SIGPENDING.
	  (Init_process): ditto.
	  patch by Run Paint Run Run.  [ruby-core:32262]

Sun Sep 12 04:27:13 2010  Tanaka Akira  <akr@fsij.org>

	* process.c (rlimit_resource_name2int): use STRCASECMP to avoid
	  ALLOCA_N.

Sat Sep 11 16:47:41 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (ruby_setenv): raise if putenv and SetEnvironmentVariable
	  failed, because of the restriction of the size on Windows.
	  based on a patch from Peter Weldon at [ruby-core:32304].  fix:
	  Bug#3812, [ruby-core:32250]

Sat Sep 11 15:19:57 2010  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick/httpauth/digestauth.rb (WEBrick::Config::DigestAuth):
	  Add documentation

	* lib/webrick/config.rb (WEBrick::Config::DigestAuth): Add
	  documentation

Sat Sep 11 12:32:05 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_set_kcode, rb_get_kcode): removed
	  zombie prototype declarations.  a patch from Eric Hodel
	  at [ruby-core:32305].

Sat Sep 11 06:53:12 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_symlink_p): Pathname#symlink?
	  translated from pathname.rb.

Fri Sep 10 23:03:43 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sticky_p): Pathname#sticky? translated
	  from pathname.rb.

Fri Sep 10 19:11:13 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#continue): add
	  method for generating HTTP/1.1 100 continue response if the client
	  expects it, otherwise does nothing.  Patch by Brian Candler.
	  ref #855.

	* test/webrick/test_httprequest.rb: test added.

Fri Sep 10 17:49:34 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/x509-internal.rb: removed unused local
	  variable.

	* test/openssl/*: less warnings while test running with -w.

Fri Sep 10 16:49:20 2010  Akinori MUSHA  <knu@iDaemons.org>

	* class.c (rb_scan_args): Add support for optional keyword
	  argument hash. [ruby-dev:42221] [ruby-dev:38048]

	* README.EXT, README.EXT.ja: Update documentation accordingly.

	* dir.c (dir_initialize): Make use of the new rb_scan_args()
	  feature.

	* io.c (rb_io_s_popen, rb_scan_open_args, rb_io_initialize)
	  (rb_io_s_pipe, open_key_args, io_s_foreach, io_s_readlines)
	  (rb_io_s_read, rb_io_set_encoding): Ditto.

	* transcode.c (str_transcode, econv_args)
	  (econv_primitive_convert): Ditto.

	* ext/zlib/zlib.c (rb_gzreader_initialize): Ditto.

Fri Sep 10 10:33:18 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* random.c (rb_genrand_ulong_limited): renamed from
	  rb_rand_internal and now this is public API.

	* include/ruby/ruby.h (rb_genrand_ulong_limited): added.

	* bignum.c (big_sparse_p): use rb_genrand_ulong_limited.

Fri Sep 10 13:07:22 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/digest/lib/digest.rb: removed unused exception variable
	  assignment to avoid a warning.

Fri Sep 10 07:29:14 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/etc/etc.c (etc_systmpdir): assume system default tmpdir
	  safe.  [ruby-dev:42089]

Fri Sep 10 07:03:23 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_size_p): Pathname#size? translated from
	  pathname.rb.

Fri Sep 10 02:15:29 2010  Tanaka Akira  <akr@fsij.org>

	* ext/socket/option.c (inspect_peercred): support OpenBSD-current.
	  patch by Jeremy Evans.  [ruby-core:32240]

Thu Sep  9 23:25:53 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_backtrace_each): skip allocator frames which have no
	  name.  [ruby-core:32231]

Thu Sep  9 22:39:08 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_size): Pathname#size translated from
	  pathname.rb.

Thu Sep  9 22:34:48 2010  wanabe  <s.wanabe@gmail.com>

	* compile.c (case_when_optimizable_literal): When float value can be
	  treated as integer, add to table hash of case that way.
	  based on a patch from Ikuo KOBORI. [ruby-dev:42038]

	* insns.def (opt_case_dispatch): ditto.

	* test/ruby/test_case.rb: add tests.

Thu Sep  9 17:15:15 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* test/net/http/test_https.rb (test_identity_verify_failure): follows
	  the SSL hostname check error message of openssl.

Thu Sep  9 10:44:46 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/ruby/test_env.rb (test_aset): OpenBSD acts like NetBSD in
	  that it ignores characters after = in ENV.
	  patched by Jeremy Evans [ruby-core:32184]

Thu Sep  9 09:02:01 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/rbinstall.rb (install?): gemspec filename should include
	  its version. patched by Luis Lavena [ruby-core:32165]

Wed Sep  8 22:46:31 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ssl_get_error): Thread context switch was
	  blocked on Windows while blocking call for SSLSocket.  Need to
	  convert errno for letting rb_io_wait_readable detect EWOULDBLOCK.
	  Patch by arton. ref #3794.

Wed Sep  8 20:56:57 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_setgid_p): Pathname#setgid? translated
	  from pathname.rb.

Wed Sep  8 06:25:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_setuid_p): Pathname#setuid? translated
	  from pathname.rb.

Tue Sep  7 21:03:35 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readable_real_p):
	  Pathname#readable_real?  translated from pathname.rb.

Mon Sep  6 23:07:25 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_world_readable_p):
	  Pathname#world_readable?  translated from pathname.rb.

Mon Sep  6 11:03:13 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* Fixed wrong check of missing functions. Patch by Adrian Quark.
	  ref #3400
	  The patch contains following comment:
	    This patch should avoid unnecessary incompatibility with future
	    versions of Openssl.  Changes suggested by bmaher_at_amazon.com.

Mon Sep  6 10:46:55 2010  NAKAMURA, Hiroshi  <nahi@ruby-lang.org>

	* Fixed exception message for SSL post connection check failure. Patch
	  by Paul Betteridge. ref [Bug #3704]

Mon Sep  6 10:31:59 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_s_get_line_buffer):
	  Readline.line_buffer should return locale string.
	  [ruby-dev:42184] #3791

Mon Sep  6 09:47:24 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): check there is at least 1 digit after
	  "0x" before ".". [ruby-dev:42183] #3790

Mon Sep  6 09:44:50 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* util.c (ruby_strtod): check integer overflow.
	  [ruby-dev:42180] #3789

Mon Sep  6 06:17:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readable_p): Pathname#readable?
	  translated from pathname.rb.

Sun Sep  5 23:02:34 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_owned_p): Pathname#owned?
	  translated from pathname.rb.

Sat Sep  4 23:48:47 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_readlink): symlink target should be in
	  filesystem encoding.

Sat Sep  4 10:40:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (ruby_init_ext): export for golfers.

	* vm_core.h (rb_iseq_eval, rb_iseq_compile_with_option): ditto.

Sun May 23 17:29:41 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (capi): uses a timestamp file to get rid of
	  generating twice.

Fri Jun 18 01:33:21 2010  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* enc/Makefile.in (realclean): has been missing. necessary
	  for make realclean-enc.

Fri Sep  3 23:51:26 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_socket_p): Pathname#socket?
	  translated from pathname.rb.

Fri Sep  3 06:40:44 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (chfunc): pass through exceptions.

	* io.c (rb_io_bufwrite, rb_io_bufread): added.

	* process.c (rb_fork_err): protect from exceptions.

Fri Sep  3 06:16:07 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_pipe_p): Pathname#pipe?
	  translated from pathname.rb.

Fri Sep  3 06:14:40 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (chfunc): restore errno from SystemCallError and
	  propagate proper exception to the parent.  [ruby-dev:41965]

Thu Sep  2 22:10:38 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_file_p): Pathname#file?
	  translated from pathname.rb.

Thu Sep  2 09:12:02 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): don't forget to free
	  memory.

Thu Sep  2 09:01:13 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (CreateChild): unicodize.

	* win32/win32.c (rb_w32_spawn, rb_w32_aspawn): convert arguments of
	  CreateChild() from ACP to WideChar.

Thu Sep  2 06:53:43 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_directory_p): Pathname#directory?
	  translated from pathname.rb.

Wed Sep  1 22:03:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_grpowned_p): Pathname#grpowned?
	  translated from pathname.rb.

Wed Sep  1 17:39:02 2010  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*.rb: Imported minitest 1.7.1 r5835.
	* test/minitest/*.rb: ditto.

Wed Sep  1 16:50:42 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): optimized. don't create hash objects
	  when given pattern is ASCII only.

	* string.c (tr_find): ditto.

Wed Sep  1 14:35:29 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_rotate_m): fix typo of rdoc.
	  patched by Andrei Kulakov [ruby-core:31975]

Wed Sep  1 14:33:36 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* enum.c (enum_zip): fix typo of rdoc.
	  patched by Andrei Kulakov [ruby-core:31974]

Wed Sep  1 12:56:36 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (ruby_suppress_tracing): restore the state and invoke
	  the func with normal state.  a patch from Satoshi Shiba <shiba
	  AT rvm.jp> at [ruby-dev:42162].  [ruby-core:31783]

Tue Aug 31 21:10:23 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_exist_p): Pathname#exist? translated
	  from pathname.rb.

Tue Aug 31 17:32:34 2010  Hidetoshi NAGAI  <nagai@ai.kyutech.ac.jp>

	* ext/tk/stubs.c: fix [Bug #3771] "VC++ can't make ext/tk with enabling
	  stubs". Thanks, Akio Tajima [ruby-dev:42159].

Tue Aug 31 03:42:14 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): fix bug in r29146.
	  Initialize table even if cflag is 0; tr_find see whether
	  del is empty or not.

	* string.c (tr_find): nodel can't be NULL; if NULL, it means
	  it is not specified.

Mon Aug 30 21:29:21 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_executable_real_p):
	  Pathname#executable_real? translated from pathname.rb.

Mon Aug 30 15:00:13 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* string.c (tr_setup_table): initialize negating table when
	  negating string is given. [ruby-core:31851]

	* string.c (tr_find): add a sentence for the time when
	  target characters include negating one.

	* string.c (rb_str_count): move definition.

Mon Aug 30 07:32:41 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_executable_p): Pathname#executable?
	  translated from pathname.rb.

Sun Aug 29 23:54:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/rdoc/parser/ruby.rb (RDoc#parse_call_parameters): don't
	  include assignment.  [Bug #3759], [ruby-dev:42154]

	* lib/rdoc/parser/ruby.rb (RDoc#parse_class): ignore non-constant
	  name singleton class.  [Bug #3759], [ruby-dev:42154]

Sun Aug 29 23:25:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_get_path_check): clarify error message for
	  ASCII-incompatible path name.

Sun Aug 29 16:02:54 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (node_name.inc): remove command option -n and give
	  file as stdin, because IronRuby 1.1 still doesn't support it.
	  So now we can use ir.exe as BASERUBY.

	* tool/node_name.rb: read stdin with while gets.

Sun Aug 29 13:22:43 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_thread_method_id_and_class): curried proc has no
	  method.  [ruby-core:31871]

Sun Aug 29 12:51:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_provide_feature): clarify error message for frozen
	  $LOADED_FEATURES.  based on a patch from Run Paint Run Run at
	  [ruby-core:31913].

Sun Aug 29 12:19:58 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_failed): should honor encoding.  [ruby-core:31915]

Sun Aug 29 09:35:10 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* common.mk (clean): exclude *.inc. [ruby-dev:41931]

	* common.mk (distclean): include *.inc.

	* common.mk (help): change description about clean and distclean.

Sat Aug 29 06:34:52 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_chardev_p): Pathname#chardev?
	  translated from pathname.rb.

Sat Aug 28 17:39:33 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_save_exception_mode,
	  BigDecimal_save_rounding_mode, BigDecimal_save_limit): added.

	* test/bigdecimal/test_bigdecimal.rb: added tests for the above
	  features.

Sat Aug 28 08:11:05 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_blockdev_p): Pathname#blockdev?
	  translated from pathname.rb.

Fri Aug 27 16:20:01 2010  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* string.c (rb_str_prepend): new method by Shota Fukumori (sora_h)
	  [Feature #3765]

Fri Aug 27 15:24:20 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* math.c (math_atan2): you should know that M_PI is not the feature
	  of C90.
	  fixed build failure caused by r29115.

Fri Aug 27 15:26:33 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (null_device): move from io.c.

Fri Aug 27 12:47:44 2010  Kenta Murata  <mrkn@mrkn.jp>

	* math.c (math_atan2): change the behavior when x and y are zero.
	  [ruby-dev:42090] [Bug #3736] [ruby-dev:42116]

	* test/ruby/test_math.rb (test_atan2): add tests for the above
	  changes.

Fri Aug 27 12:26:23 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* object.c (rb_obj_class): remove mention of obsolete method.
	  a patch from Run Paint Run Run at [ruby-core:31842].

Fri Aug 27 12:25:03 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (null_device): the name of null device.  [ruby-dev:41791]

Fri Aug 27 07:57:34 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): bail out from modification during
	  shuffle.

	* array.c (rb_ary_sample): ditto.

Fri Aug 27 05:11:51 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_sysopen): Pathname#sysopen translated
	  from pathname.rb.

Thu Aug 26 22:53:56 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle): rdoc fix.  argument name was missing.
	  a patch from Run Paint Run Run at [ruby-core:31848].

Thu Aug 26 21:49:46 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_readlines): Pathname#readlines
	  translated from pathname.rb.

Thu Aug 26 10:37:00 2010  NARUSE, Yui  <naruse@ruby-lang.org>

	* regint.h (OnigStackIndex): the type should be intptr_t.
	  Original Oniguruma assumes the size of long and that of void *
	  are equal, but it's not true on LLP64 platform: mswin64.
	  originally patched by shintaro kuwamoto [ruby-dev:42133]

Thu Aug 26 10:38:11 2010  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* test/dl/test_base.rb: AIX does not have dynamically loadable lib[cm].

	* test/fiddle/helper.rb: AIX does not have dynamically loadable lib[cm].

Thu Aug 26 09:49:50 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang): check number of argument.

Tue Aug 26 09:11:40 2010  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_exception_mode, VpGetException,
	  VpSetException): thread-local exception mode.

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_precision_limit, VpGetPrecLimit,
	  VpSetPrecLimit): thread-local precision limit.

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal,
	  rmpd_set_thread_local_rounding_mode, VpGetRoundMode,
	  VpSetRoundMode, VpException, VpInternalRound):
	  thread-local rounding mode.

	* ext/bigdecimal/bigdecimal.c (BigDecimal_mode, BigDecimal_round,
	  VpIsRoundMode, VpGetRoundMode, VpSetRoundMode, VpActiveRound,
	  VpMidRound, VpLeftRound), ext/bigdecimal/bigdecimal.h:
	  use unsigned short for rounding mode.

	* test/bigdecimal/test_bigdecimal.rb (test_mode): add test for
	  setting rounding mode.

	* test/bigdecimal/test_bigdecimal.rb (test_thread_local_mode):
	  add test for setting mode thread-locally.

Thu Aug 26 07:29:54 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_{shuffle_bang,sample}): use Random class object.

	* random.c (try_get_rnd): use default_rand for Random as same as
	  singleton methods.

	* random.c (rb_random_real): check the range of result.

Wed Aug 25 22:11:11 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_binread): Pathname#binread translated
	  from pathname.rb.

Wed Aug 25 03:42:43 2010  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/cfunc.c (rb_dlcfunc_call): workaround for VC9 for x64.
	  reported by kuwamoto shintaro in [ruby-dev:42125].

Tue Aug 24 23:28:50 2010  Yusuke Endoh  <mame@tsg.ne.jp>

	* .gitignore: updated.

Tue Aug 24 22:07:28 2010  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_read): Pathname#read translated from
	  pathname.rb.

Tue Aug 24 10:11:04 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: read API version from include/ruby/version.h.

	* {bcc,win}32/setup.mak (-version-): ditto.

	* version.h (RUBY_LIB_VERSION): use API version numbers.

Tue Aug 24 07:07:28 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_shuffle_bang, rb_ary_sample): add optional
	  argument random.  [ruby-dev:41923] [EXPERIMENTAL]

	* random.c (rb_random_{int32,real,bytes}): fallback to normal
	  method invocation.

Tue Aug 24 06:08:10 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/version.h (RUBY_API_VERSION_*): renamed and moved
	  from version.h.  [ruby-dev:42103]

Tue Aug 24 05:58:18 2010  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ChangeLog: flushed.  [ruby-dev:42050]

For the changes before 1.9.3, see doc/ChangeLog-1.9.3
For the changes before 1.8.0, see doc/ChangeLog-1.8.0

Local variables:
coding: us-ascii
add-log-time-format: (lambda ()
  (let* ((time (current-time))
	 (system-time-locale "C")
	 (diff (+ (cadr time) 32400))
	 (lo (% diff 65536))
	 (hi (+ (car time) (/ diff 65536))))
  (format-time-string "%a %b %e %H:%M:%S %Y" (list hi lo) t)))
indent-tabs-mode: t
tab-width: 8
change-log-indent-text: 2
end:
vim: tabstop=8
